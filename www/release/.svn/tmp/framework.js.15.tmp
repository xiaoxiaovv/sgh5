var APP=angular.module("starter",["ionic","ngCookies","ionic-datepicker","ngFileUpload","st","ui.router","me-lazyimg","ngAnimate"]),commonConfig=["$ionicConfigProvider",function(e){e.views.maxCache(10),e.scrolling.jsScrolling(!0),e.views.forwardCache(!0),e.views.transition("none"),e.backButton.text(""),e.backButton.icon("ion-ios-arrow-left"),e.backButton.previousTitleText(!1),e.navBar.alignTitle("center"),e.views.swipeBackEnabled(!1)}],interceptors=["$httpProvider","$ionicConfigProvider",function(e,t){e.interceptors.push("LoadingIntercepter"),e.interceptors.push("GetParamIntercepter"),e.interceptors.push("UserIntercepter"),e.interceptors.push("PostParamIntercepter")}];$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("TokenAuthorization",window.localStorage.getItem("sg_login_token_secret"))}}),APP.factory("LoadingIntercepter",["$rootScope","$q",function(e,t){return{request:function(t){return/http:\/\//.exec(t.url)&&((!t.noLoading&&!t.data&&!t.params||t.data&&!t.data.noLoading&&!t.params||t.params&&!t.data&&!t.params.noLoading)&&e.$broadcast("LOADING:SHOW"),t.data&&t.data.noLoading&&delete t.data.noLoading,t.params&&t.params.noLoading&&delete t.params.noLoading),t},response:function(t){var o=/http:\/\//;return(!t||t&&o.exec(t.config.url))&&e.$broadcast("LOADING:HIDE"),t},responseError:function(o){e.$broadcast("http-response:error",o),e.$broadcast("LOADING:HIDE"),t.reject(o)}}}]),APP.factory("UserIntercepter",["UserService","$rootScope","UrlService",function(e,t,o){return{request:function(e){return e.method,e},response:function(e){return e&&e.config&&"GET"==e.config.method?e.data&&e.data.errorCode&&"-100"==e.data.errorCode&&t.$emit("userIntercepted","sessionOut",e):e&&e.config&&"POST"==e.config.method&&e.data&&"-100"==e.data.errorCode&&t.$emit("userIntercepted","sessionOut",e),e},responseError:function(e){}}}]),APP.factory("GetParamIntercepter",["$rootScope","$localstorage",function(e,t){return{request:function(e){if("GET"==e.method){var o=angular.copy(e);delete o.cache,delete o.headers,delete o.method,delete o.paramSerializer,delete o.transformRequest,delete o.transformResponse,delete o.url;var s="";for(var i in o)s?s+="&":s="?",s=s+i+"="+o[i];e.url=e.url+s,e.headers.TokenAuthorization=t.get("sg_login_token_secret")}return e},response:function(t){return-1==t.config.url.indexOf("sg/game/winnerList.json")&&t.data.data&&120==t.data.data.code&&e.$broadcast("tooCrowd",'<div><div style="text-align:center;color:#32BEFF;font-size:14px;margin-bottom:10px;">人数太多,请稍后……</div><div>俗话说：好饭不怕晚，好腰不怕闪，大奖都在后面！<br /></div><div style="text-align:center;"><img style="width:70%;" src="{{imgBaseURL}}img/waitBusy.gif" /></div></div>'),t},responseError:function(e){}}}]),APP.factory("PostParamIntercepter",["$rootScope","$localstorage",function(e,t){return{request:function(e){return"POST"==e.method&&(e.headers.TokenAuthorization=t.get("sg_login_token_secret")),e},response:function(t){return-1==t.config.url.indexOf("sg/game/winnerList.json")&&t.data.data&&120==t.data.data.code&&e.$broadcast("tooCrowd",'<div><div style="text-align:center;color:#32BEFF;font-size:14px;margin-bottom:10px;">人数太多,请稍后……</div><div>俗话说：好饭不怕晚，好腰不怕闪，大奖都在后面！<br /></div><div style="text-align:center;"><img style="width:70%;" src="{{imgBaseURL}}img/waitBusy.gif" /></div></div>'),t},responseError:function(e){}}}]);var route=function(e,t){e.state("mine",{url:"/mine",templateUrl:"templates/mine/Mine.html",controller:"MineController",requiredLogin:!0}).state("accountMessage",{url:"/accountMessage",templateUrl:"templates/mine/account/AccountMessage.html",controller:"AccountMessageController",requiredLogin:!0}).state("changeName",{url:"/changeName/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/ChangeName.html",controller:"ChangeNameController",requiredLogin:!0}).state("changeEmail",{url:"/changeEmail/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/ChangeEmail.html",controller:"ChangeEmailController",requiredLogin:!0}).state("changePassword",{url:"/changePassword",templateUrl:"templates/mine/account/ChangePassword.html",controller:"ChangePasswordController",requiredLogin:!0}).state("selectSex",{url:"/selectSex/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/SelectSex.html",controller:"SelectSexController",requiredLogin:!0}).state("easyConnectIframe",{url:"/easyConnectIframe/:content",templateUrl:"templates/mine/getCash/EasyConnectIframe.html",controller:"EasyConnectIframeController",requiredLogin:!0}).state("bindResult",{url:"/bindResult",templateUrl:"templates/mine/getCash/BindResult.html",controller:"BindResultController",requiredLogin:!0}).state("bindAccount",{url:"/bindAccount",templateUrl:"templates/mine/getCash/BindAccount.html",controller:"BindAccountController",requiredLogin:!0}).state("shopMessage",{url:"/shopMessage",templateUrl:"templates/mine/shop/ShopMessage.html",controller:"ShopMessageController",requiredLogin:!0}).state("shopName",{url:"/shopName/:default",templateUrl:"templates/mine/shop/ShopName.html",controller:"ShopNameController",requiredLogin:!0}).state("shopLegend",{url:"/shopLegend/:default/:provinceId/:cityId/:regionId/:hrCode",templateUrl:"templates/mine/shop/ShopLegend.html",controller:"ShopLegendController",requiredLogin:!0}).state("shopAddress",{url:"/shopAddress/:default/:defaultDetail/:provinceId/:cityId/:regionId:/:hrCode/:memberType",templateUrl:"templates/mine/shop/ShopAddress.html",controller:"ShopAddressController",requiredLogin:!0}).state("aboutUs",{url:"/aboutUs",templateUrl:"templates/mine/AboutUs.html",controller:"AboutUsController",requiredLogin:!0}).state("newClass",{url:"/newClass",templateUrl:"templates/mine/newClass.html",controller:"NewClassController",requiredLogin:!0}).state("address",{url:"/address/:comeFromOrder",templateUrl:"templates/mine/Address/Address.html",controller:"AddressController",requiredLogin:!0}).state("changeAddress",{url:"/changeAddress/:addressData",templateUrl:"templates/mine/Address/ChangeAddress.html",controller:"ChangeAddressController",requiredLogin:!0}).state("addAddress",{url:"/addAddress",templateUrl:"templates/mine/Address/AddAddress.html",controller:"AddAddressController",requiredLogin:!0}).state("AddPrizeAddress",{url:"/AddPrizeAddress/:gameId/:uuid/:prizeId",templateUrl:"templates/mine/Address/AddPrizeAddress.html",controller:"AddPrizeAddressController",requiredLogin:!0}).state("batchDeleteAddress",{url:"/batchDeleteAddress",templateUrl:"templates/mine/Address/BatchDeleteAddress.html",controller:"BatchDeleteAddressController",requiredLogin:!0}).state("shoppingCar",{url:"/shoppingCar",templateUrl:"templates/mine/ShoppingCar.html",controller:"ShoppingCarController",requiredLogin:!0}).state("collection",{url:"/collection",templateUrl:"templates/mine/Collection.html",controller:"CollectionController",requiredLogin:!0}).state("newAuthenticationHome",{url:"/newAuthenticationHome/:promotionCode",templateUrl:"templates/newAuthentication/newAuthenticationHomeV2.html",controller:"newAuthenticationHomeV2"}).state("crowdFunding",{url:"/crowdFunding/:shareId/:type",templateUrl:"templates/crowd_funding/CrowdFunding.html",controller:"CrowdFundingHomeControl"}).state("localSpecialtyHomePage",{url:"/localSpecialtyHomePage/:storeId",templateUrl:"templates/localSpecialty/localSpecialtyHomePage.html",controller:"localSpecialtyHomePageController"}).state("SpecialtyVenueHome",{url:"/SpecialtyVenueHome/:regionId/:streetId/:shareId",templateUrl:"templates/localSpecialty/specialtyVenueHome.html",controller:"SpecialtyVenueHomeController"}).state("secondLevelStore",{url:"/secondLevelStore/:cityId/:shareId",templateUrl:"templates/localSpecialty/secondLevelStore.html",controller:"secondLevelStoreController"}).state("ListOfSpecialtyGoods",{url:"/ListOfSpecialtyGoods/:productCateId/:pageId/:storeId",templateUrl:"templates/localSpecialty/listOfSpecialtyGoods.html",controller:"ListOfSpecialtyGoodsController"}).state("trueAuthentication",{url:"/trueAuthentication/:type",templateUrl:"templates/newAuthentication/trueAuthentication.html",controller:"trueAuthenticationControl"}).state("MechanismDescription",{url:"/MechanismDescription",templateUrl:"templates/newAuthentication/MechanismDescription.html"}).state("trueAuthenticationList",{url:"/trueAuthenticationList",templateUrl:"templates/newAuthentication/trueAuthenticationList.html",controller:"trueAuthenticationListControl"}).state("haierStaff",{url:"/haierStaff",templateUrl:"templates/newAuthentication/haierStaff.html",controller:"haierStaffControl"}).state("bindingBankHome",{url:"/bindingBankHome",templateUrl:"templates/bindingBank/bindingBankHome.html",controller:"bindingBankControl",requiredLogin:!0}).state("verificationCode",{url:"/verificationCode/:ownerName/:identityNo/:cardNo/:mobile/:bankNo/:phoneNumber",templateUrl:"templates/bindingBank/verificationCode.html",controller:"verificationCodeControl",requiredLogin:!0}).state("teamSupervise",{url:"/teamSupervise",templateUrl:"templates/teamSupervise/teamSupervise.html",controller:"teamSuperviseController",requiredLogin:!0}).state("teamMessage",{url:"/teamMessage/:memberId/:type",templateUrl:"templates/teamSupervise/teamMessage.html",controller:"teamMessageController",requiredLogin:!0}).state("userMessage",{url:"/userMessage/:memberId/:name/:mobile/:isTeamNum",templateUrl:"templates/teamSupervise/userMessage.html",controller:"userMessageController",requiredLogin:!0}).state("userSearch",{url:"/userSearch/:selectedIndex",templateUrl:"templates/teamSupervise/userSearch.html",controller:"userSearchController",requiredLogin:!0}).state("crowd_funding_details",{url:"/crowd_funding_details/:zActivityId/:shareId",templateUrl:"templates/crowd_funding/crowd_funding_details/crowd_funding_details.html",controller:"crowd_funding_details_control"}).state("crowd_funding_hot_redound",{url:"/crowd_funding_hot_redound/:zActivityId",templateUrl:"templates/crowd_funding/crowd_funding_hot_redound/crowd_funding_hot_redound.html",controller:"crowd_funding_hot_redound_control"}).state("orderWrite",{url:"/orderWrite/:zStallsId/:number/:shareId",templateUrl:"templates/crowd_funding/mdg-zhongchou/orderWrite.html",controller:"orderWriteController",requiredLogin:!0}).state("myRaiseNo",{url:"/myRaiseNo",templateUrl:"templates/crowd_funding/mdg-zhongchou/MyRaiseNo.html",controller:"MyRaiseNoController"}).state("orderDetails",{url:"/orderDetails/:orderSn/:cOrderSn/:cOrderId",templateUrl:"templates/crowd_funding/mdg-zhongchou/OrderDetails.html",controller:"OrderDetailsController",requiredLogin:!0}).state("RiskDescription",{url:"RiskDescription",templateUrl:"templates/crowd_funding/mdg-zhongchou/RiskDescription.html",controller:"RiskDescriptionController"}).state("SupportersAgreement",{url:"SupportersAgreement",templateUrl:"templates/crowd_funding/mdg-zhongchou/SupportersAgreement.html",controller:"SupportersAgreementController"}).state("messageCenter",{url:"/messageCenter/:messageType",templateUrl:"templates/mine/messageCenter/MessageCenter.html",controller:"MessageCenterController",requiredLogin:!0}).state("ClassifyMessageCenter",{url:"/ClassifyMessageCenter",templateUrl:"templates/mine/messageCenter/ClassifyMessageCenter.html",controller:"ClassifyMessageCenterController",requiredLogin:!0}).state("detailMessageCenter",{url:"/detailMessageCenter/:title/:content",templateUrl:"templates/mine/messageCenter/DetailMessageCenter.html",controller:"DetailMessageCenterController",requiredLogin:!0}).state("buyerCenter",{url:"/buyerCenter/:shareStoreId",templateUrl:"templates/mine/buyerCenter/BuyerCenter.html",controller:"BuyerCenterController",requiredLogin:!0}).state("competition",{url:"/competition/:taskDestId/:taskType/:memberId",templateUrl:"templates/mine/competition.html",controller:"CompetitionController",cache:!1}).state("myWallet",{url:"/myWallet",templateUrl:"templates/mine/wallet/MyWallet.html",controller:"MyWalletController",requiredLogin:!0}).state("walletIntegral",{url:"/walletIntegral",templateUrl:"templates/mine/wallet/walletIntegral.html",controller:"walletIntCtrl",requiredLogin:!0}).state("walletDiamonds",{url:"/walletDiamonds",templateUrl:"templates/mine/wallet/walletDiamonds.html",controller:"walletDiamCtrl",requiredLogin:!0}).state("commonPageView",{url:"/commonPageView/:title/:content",templateUrl:"templates/common/CommonPageView.html",controller:"CommonPageViewController"}).state("commonLocation",{url:"/commonLocation/:flag/:defaultValue/:data/:level/:title",templateUrl:"templates/common/CommonLocation.html",controller:"CommonLocationController"}).state("commonSelect",{url:"/commonSelect/:flag/:defaultValue/:data/:level/:title",templateUrl:"templates/common/CommonSelect.html",controller:"CommonSelectController"}).state("commonUnion",{url:"/commonUnion/:flag/:defaultValue/:data",templateUrl:"templates/common/CommonUnion.html",controller:"CommonUnionController"}).state("productDetail",{url:"/productDetail/:productId/:o2oType/:fromType/:storeId/:shareStoreId",templateUrl:"templates/product/productDetail.html",controller:"ProductDetailController",cache:!1}).state("productEffect",{url:"/productEffect/:vrUrl",templateUrl:"templates/product/productEffect.html",controller:"productEffectController"}).state("productRated",{url:"/productRated/:productId",templateUrl:"templates/product/productRated.html",controller:"ProductRatedController"}).state("myStore",{url:"/myStore/:storeId/:shareStoreId/:token",templateUrl:"templates/shop/MyStore.html",controller:"MyStoreController"}).state("cart",{url:"/cart",templateUrl:"templates/cart/Cart.html",controller:"CartController"}).state("payResultSuccess",{url:"/payResultSuccess",templateUrl:"templates/order/payResultSuccess.html",controller:"payResultSuccessController",requiredLogin:!0}).state("payResultFailure",{url:"/payResultFailure",templateUrl:"templates/order/payResultFailure.html",requiredLogin:!0}).state("custom-made",{url:"/custom-made/:customMadeUrl",templateUrl:"templates/mine/custom-made.html",controller:"CustomMadeController",requiredLogin:!0}).state("CustomPage",{url:"/CustomPage/:customPageId",templateUrl:"templates/shop/CustomPage.html",controller:"CustomPageCtrl"}).state("vip",{url:"/vip/:gameId/:msg",templateUrl:"templates/mine/vip.html",controller:"VipController",requiredLogin:!0}).state("goldgame",{url:"/goldgame/:gameId",templateUrl:"templates/mine/goldgame.html",controller:"VipController",requiredLogin:!0}).state("helpStaff",{url:"/helpStaff/:memberId/:gameId/:channel",templateUrl:"templates/game/helpStaff.html",controller:"helpStaffController"}).state("goldRecord",{url:"/goldRecord",templateUrl:"templates/mine/goldRecord.html",controller:"goldRecordController",cache:!1,requiredLogin:!0}).state("vipGame",{url:"/vipGame/:gameId/:shareStoreId/:isAdmin",templateUrl:"templates/game/vipGame.html",controller:"VipGameController",requiredLogin:!0}).state("missionDetail",{url:"/missionDetail/:taskId",templateUrl:"templates/mine/Mission/missionDetail.html",controller:"MissionDetailController",requiredLogin:!0}).state("ccbfenqi",{url:"/ccbfenqi/:orderSn/:whereName",templateUrl:"templates/order/ccbfenqi.html",controller:"CcbFenqiController",requiredLogin:!0}).state("ccbPay",{url:"/ccbPay/:url/:orderSn",templateUrl:"templates/order/ccbPay.html",controller:"CcbPayController",requiredLogin:!0}).state("paymentxyz",{url:"/paymentxyz/:orderSn/:totalAmount",templateUrl:"templates/order/Paymentxyz.html",controller:"PaymentControllerxyz",requiredLogin:!0}).state("orderConfirm",{url:"/orderConfirm/:orderInitParams",templateUrl:"templates/order/orderConfirm.html",controller:"OrderConfirmController",requiredLogin:!0}).state("choiceOfGifts",{url:"/choiceOfGifts",templateUrl:"templates/order/choiceOfGifts.html",controller:"choiceOfGiftsController",requiredLogin:!0}).state("batchDeleteOrder",{url:"/batchDeleteOrder",templateUrl:"templates/shop/batchDeleteOrder.html",controller:"batchDeleteOrderController",requiredLogin:!0}).state("afterOrderSubmit",{url:"/afterOrderSubmit/:messageData/:paymentCode",templateUrl:"templates/order/afterOrderSubmit.html",controller:"AfterOrderSubmitController",requiredLogin:!0}).state("payment",{url:"/payment/:paymentCode",templateUrl:"templates/order/Payment.html",controller:"PaymentController",requiredLogin:!0}).state("sendGoodsTime",{url:"/sendGoodsTime",templateUrl:"templates/order/SendGoodsTime.html",controller:"SendGoodsTimeController",requiredLogin:!0}).state("homePage",{url:"/homePage",templateUrl:"templates/product/homePage.html",controller:"HomePageController"}).state("seeMore",{url:"/seeMore",templateUrl:"templates/product/seeMore.html",controller:"SeeMoreController"}).state("familytry",{url:"/familytry",templateUrl:"templates/product/familytry.html",controller:"familytryController"}).state("familydetail",{url:"/familydetail/:detailUrl/:title",templateUrl:"templates/product/familydetail.html",controller:"familydetailController",cache:!1}).state("electricalMall",{url:"/electricalMall",templateUrl:"templates/product/electricalMall.html",controller:"ElectricalMallController"}).state("furnish",{url:"/furnish",templateUrl:"templates/product/furnish.html",controller:"furnishController"}).state("superMarket",{url:"/superMarket",templateUrl:"templates/product/superMarket.html",controller:"superMarketController"}).state("goodsSearch",{url:"/goodsSearch/:front/:shareStoreId",templateUrl:"templates/product/GoodsSearch.html",controller:"GoodsSearchController"}).state("CommodityList",{url:"/CommodityList/:couponId",templateUrl:"templates/product/CommodityList.html",controller:"CommodityListController"}).state("imageAndWord",{url:"/imageAndWord/:productId",cache:"false",templateUrl:"templates/product/imageAndWord.html",controller:"ImageAndWordController"}).state("specifications",{url:"/specifications/:productId",templateUrl:"templates/product/Specifications.html",controller:"SpecificationsController"}).state("invoiceSetup",{url:"/invoiceSetup/:invoiceHead/:invoiceType/:enterPage",templateUrl:"templates/invoice/InvoiceSetup.html",controller:"InvoiceSetupController",requiredLogin:!0}).state("branchType",{url:"/branchType",templateUrl:"templates/product/branchType.html",controller:"BranchTypeController"}).state("branchTypeDetail",{url:"/branchTypeDetail/:productCateId",templateUrl:"templates/product/branchTypeDetail.html",controller:"BranchTypeDetailController"}).state("myStoreManage",{url:"/myStoreManage",templateUrl:"templates/mine/myStore/myStoreManage.html",controller:"MyStoreManageController",requiredLogin:!0}).state("customerService",{url:"/customerService",templateUrl:"templates/shop/customerService.html",controller:"CustomerServiceController",requiredLogin:!0}).state("myPhoneManage",{url:"/myPhoneManage",templateUrl:"templates/mine/phone/myPhoneManage.html",controller:"MyPhoneManageController",requiredLogin:!0}).state("myPhoneBindSuccess",{url:"/myPhoneBindSuccess/:phone",templateUrl:"templates/mine/phone/myPhoneBindSuccess.html",controller:"MyPhoneBindSuccessController",requiredLogin:!0}).state("myPhoneCode",{url:"/myPhoneCode",templateUrl:"templates/mine/phone/myPhoneCode.html",controller:"MyPhoneCodeController",requiredLogin:!0}).state("myPhoneBind",{url:"/myPhoneBind/:realName/:identityNo",templateUrl:"templates/mine/phone/myPhoneBind.html",controller:"MyPhoneBindController",requiredLogin:!0}).state("myPhoneBindNewCode",{url:"/myPhoneBindNewCode/:mobile/:realName/:identityNo",templateUrl:"templates/mine/phone/myPhoneBindNewCode.html",controller:"MyPhoneBindNewCodeController",requiredLogin:!0}).state("myIdCardAuthen",{url:"/myIdCardAuthen/:isAuth",templateUrl:"templates/mine/phone/myIdCardAuthen.html",controller:"MyIdCardAuthenController",requiredLogin:!0}).state("shop",{url:"/shop/:token",templateUrl:"templates/shop/Shop.html",controller:"ShopController"}).state("microSchool",{url:"/microSchool",templateUrl:"templates/shop/MicroSchool.html",controller:"MicroSchoolController"}).state("microSchoolDetail",{url:"/microSchoolDetail/:childId/:id/:title",templateUrl:"templates/shop/MicroSchoolDetail.html",controller:"MicroSchoolControllerDetail"}).state("shopRevenue",{url:"/shopRevenue",templateUrl:"templates/shop/ShopRevenue.html",controller:"ShopRevenueController",requiredLogin:!0}).state("revenueDetail",{url:"/revenueDetail/:code/:title/:earningType",templateUrl:"templates/shop/RevenueDetail.html",controller:"RevenueDetailController",requiredLogin:!0}).state("monthReward",{url:"/monthReward/:code/:title/:earningType",templateUrl:"templates/shop/yingshouDetail/monthReward.html",controller:"monthRewardController"}).state("otherReward",{url:"/otherReward/:code/:title/:earningType",templateUrl:"templates/shop/yingshouDetail/otherReward.html",controller:"otherRewardController"}).state("someReward",{url:"/someReward/:code/:title/:earningType/:rewardType",templateUrl:"templates/shop/yingshouDetail/someReward.html",controller:"someRewardController"}).state("yongjinDetail",{url:"/yongjinDetail/:code/:title/:earningType/:start/:end",templateUrl:"templates/shop/yingshouDetail/yongjinDetail.html",controller:"yongjinDetailController"}).state("shopRenovate",{url:"/shopRenovate",templateUrl:"templates/shop/ShopRenovate.html",controller:"ShopRenovateController"}).state("setShopCover",{url:"/setShopCover",templateUrl:"templates/shop/SetShopCover.html",controller:"SetShopCoverController"}).state("chooseShopTemplate",{url:"/chooseShopTemplate",templateUrl:"templates/shop/ChooseShopTemplate.html",controller:"ChooseShopTemplateController"}).state("withdrawSuccess",{url:"/withdrawSuccess/:content",templateUrl:"templates/shop/WithdrawSuccess.html",controller:"WithdrawSuccessController"}).state("newHand",{url:"/newHand",templateUrl:"templates/shop/NewHand.html",controller:"HelpController"}).state("goodsManage",{url:"/goodsManage",templateUrl:"templates/shop/GoodsManage.html",controller:"GoodsManageController",requiredLogin:!0}).state("orderManage",{url:"/orderManage/:orderStatus/:isPayCoupon/:orderType/:orderFlag",templateUrl:"templates/shop/OrderManage.html",controller:"OrderManageController",requiredLogin:!0}).state("orderSearch",{url:"/orderSearch",templateUrl:"templates/order/OrderSearch.html",controller:"OrderSearchController",requiredLogin:!0}).state("orderDetail",{url:"/orderDetail/:orderSn/:cOrderSn/:cOrderId",templateUrl:"templates/shop/OrderDetail.html",controller:"OrderDetailController",requiredLogin:!0}).state("connectionSearch",{url:"/connectionSearch/:searchType",templateUrl:"templates/shop/ConnectionSearch.html",controller:"ConnectionSearchController",requiredLogin:!0}).state("orderTracking",{url:"/orderTracking/:orderSn",templateUrl:"templates/shop/OrderTracking.html",controller:"OrderTrackingController",requiredLogin:!0}).state("carTracking",{url:"/carTracking/:trackUrl",templateUrl:"templates/order/CarTracking.html",controller:"CarTrackController"}).state("refundDetail",{url:"/refundDetail/:orderProductId/:memberId",templateUrl:"templates/shop/RefundDetail.html",controller:"RefundDetailController",requiredLogin:!0}).state("helpDetail",{url:"/helpDetail/:helpId/:content",templateUrl:"templates/shop/HelpDetail.html",controller:"HelpDetailController"}).state("feedback",{url:"/feedback",templateUrl:"templates/shop/Feedback.html",controller:"FeedbackController",requiredLogin:!0}).state("applyRefund",{url:"/applyRefund/:cOrderSn",templateUrl:"templates/shop/ApplyRefund.html",controller:"ApplyRefundController",requiredLogin:!0}).state("publicationEvaluation",{url:"/publicationEvaluation/:cOrderSn",templateUrl:"templates/shop/publicationEvaluation.html",controller:"publicationEvaluationController",requiredLogin:!0}).state("chaseEvaluate",{url:"/chaseEvaluate/:cOrderSn/:isMeorder",templateUrl:"templates/shop/chaseEvaluate.html",controller:"chaseEvaluateController",requiredLogin:!0}).state("criticalSuccess",{url:"/criticalSuccess/:cOrderSn",templateUrl:"templates/shop/criticalSuccess.html",controller:"criticalSuccessController",requiredLogin:!0}).state("evaluationSuccess",{url:"/evaluationSuccess",templateUrl:"templates/shop/evaluationSuccess.html",controller:"evaluationSuccessController"}).state("useExperience",{url:"/useExperience/:cOrderSn",templateUrl:"templates/shop/useExperience.html",controller:"useExperienceController"}).state("lookAssess",{url:"/lookAssess/:orderId/:cOrderSn",templateUrl:"templates/shop/LookAssess.html",controller:"LookAssessController",requiredLogin:!0}).state("confirmReceive",{url:"/confirmReceive/:orderId",templateUrl:"templates/order/ConfirmReceive.html",controller:"ConfirmReceiveController",requiredLogin:!0}).state("VrPage",{url:"/VrPage/:isH5",templateUrl:"templates/shop/VR.html",controller:"VRController",cache:!1}).state("manageMoney",{url:"/manageMoney/:frontState",templateUrl:"templates/shop/ManageMoney.html",controller:"ManageMoneyController",requiredLogin:!0}).state("getCouponsList",{url:"/getCouponsList/:shareStoreId",templateUrl:"templates/coupons/GetCouponsList.html",controller:"GetCouponsListController"}).state("couponsDetail",{url:"/couponsDetail/:cId/:userID/:type/:status/:isUser",templateUrl:"templates/coupons/CouponsDetail.html",controller:"CouponsDetailController"}).state("couponsDetailTwo",{url:"/couponsDetailTwo/:cId/:userID/:type/:status/:couponId/:isUser",templateUrl:"templates/coupons/CouponsDetailTwo.html",controller:"CouponsDetailTwoController"}).state("useCouponsList",{url:"/useCouponsList/:type/:productId/:sku/:couponId",templateUrl:"templates/coupons/UseCouponsList.html",controller:"UseCouponsListController"}).state("Retainage",{url:"/Retainage/:relationOrderSn/:relationOrderAmount/:isPayCoupon",templateUrl:"templates/coupons/Retainage.html",controller:"RetainageController"}).state("myCouponsList",{url:"/myCouponsList",templateUrl:"templates/coupons/MyCouponsList.html",controller:"MyCouponsListController"}).state("personnalCenter",{url:"/personnalCenter",templateUrl:"templates/mine/PersonalCenter.html",controller:"PersonalCenterController",requiredLogin:!0}).state("register",{url:"/register/:hasHistory/:promotionCode",templateUrl:"templates/login/RegisterV2.html",controller:"RegisterV2Controller"}).state("registerForStore",{url:"/registerForStore/:hasHistory",templateUrl:"templates/login/RegisterForStore.html",controller:"RegisterForStoreController"}).state("RegisterForStoreLogin",{url:"/RegisterForStoreLogin/:hasHistory",templateUrl:"templates/login/RegisterForStoreLogin.html",controller:"RegisterForStoreLoginController"}).state("login",{url:"/login",templateUrl:"templates/login/Login.html",controller:"LoginController"}).state("advertisement",{url:"/advertisement/:from",templateUrl:"templates/login/Advertisement.html",controller:"AdvertisementController"}).state("userAgreement",{url:"/userAgreement",templateUrl:"templates/login/UserAgreement.html"}).state("guidePage",{url:"/guidePage/:back",templateUrl:"templates/login/GuidePage.html",controller:"GuidePageController"}).state("shopApplySuccess",{url:"/shopApplySuccess/:totalCommission/:memberCount/:memberRegionCount",templateUrl:"templates/login/ShopApplySuccess.html",controller:"ShopApplySuccessController"}).state("requestPassword",{url:"/requestPassword",templateUrl:"templates/login/RequestPassword.html",controller:"RequestPasswordController"}).state("game",{url:"/game/:gameId/:shareStoreId/:isAdmin",templateUrl:"templates/game/game.html",controller:"GameController"}).state("seckillList",{url:"/seckillList/:shareStoreId",templateUrl:"templates/seckill/seckillList.html",controller:"SeckillListController"}).state("seckillDetail",{url:"/seckillDetail/:productId/:o2oType/:fromType/:storeId/:front/:seckillPrice/:seckillId/:sku/:status/:beginTime/:endTime/:shareStoreId",templateUrl:"templates/seckill/seckillDetail.html",controller:"SeckillDetailController",requiredLogin:!0}).state("orderConfirmSeckill",{url:"/orderConfirmSeckill/:seckillId/:numbers/:productIds/:beginTime/:endTime",templateUrl:"templates/seckill/orderConfirmSeckill.html",controller:"OrderConfirmSeckillController",requiredLogin:!0}).state("bannerTheme",{url:"/bannerTheme/:bannerId/:shareStoreId/:platformType",templateUrl:"templates/shop/BannerTheme.html",controller:"BannerThemeController"}).state("customizehd",{url:"/customizehd/:url",templateUrl:"templates/login/customizehd.html",controller:"CustomizehdController"}).state("bannerDaily",{url:"/bannerDaily/:bannerId/:layout/:shareStoreId/:platformType",templateUrl:"templates/shop/BannerDaily.html",controller:"BannerDailyController"}).state("invoiceHtml",{url:"/invoiceHtml/:invoiceSrc",templateUrl:"templates/common/invoiceHtml.html",controller:"invoiceHtmlController"}).state("Setup",{url:"/Setup",templateUrl:"templates/mine/Setup.html",controller:"SetupController"}).state("taskShare",{url:"/taskShare",templateUrl:"templates/mine/Mission/taskShare.html",controller:"taskShareController",requiredLogin:!0}).state("historyTask",{url:"/historyTask",templateUrl:"templates/mine/Mission/historyTask.html",controller:"historyTaskController",requiredLogin:!0}).state("anAuspiciousStart",{url:"/anAuspiciousStart/:anAuspiciousId",templateUrl:"templates/goodStart/anAuspiciousStart.html",controller:"anAuspiciousStartController",requiredLogin:!0}).state("Customer",{url:"/Customer",templateUrl:"templates/mine/Customer.html"}).state("newUserLogin",{url:"/login/newUserLogin",templateUrl:"templates/login/thirdLogin/newUserLogin.html",controller:"newUserLoginController"}).state("relactOK",{url:"/login/relactOK/:nickname/:mobile/:email",templateUrl:"templates/login/thirdLogin/relactOK.html",controller:"relactOKController"}).state("topic",{url:"/topic",templateUrl:"templates/quanzi/Topic.html",abstract:!0,controller:"TopicController"}).state("qzMessageCenter",{url:"/qzMessageCenter",templateUrl:"templates/quanzi/qzMessageCenter.html",controller:"qzMessageCenterController"}).state("publishEdit",{url:"/publishEdit/:topicId/:noteId/:isShortStory",templateUrl:"templates/quanzi/PublishEdit.html",controller:"PublishEditController"}).state("allCircle",{url:"/allCircle",templateUrl:"templates/quanzi/AllCircle.html",controller:"AllCircleController"}).state("myCirclePages",{url:"/myCirclePages",templateUrl:"templates/quanzi/MyCirclePages.html",controller:"MyCirclePagesController"}).state("myLessones",{url:"/myLessones",templateUrl:"templates/quanzi/MyLessones.html",controller:"MyLessonesController"}).state("applyCircle",{url:"/applyCircle",templateUrl:"templates/quanzi/ApplyCircle.html",controller:"ApplyCircleController"}).state("circlePage",{url:"/circlePage/:circleId",templateUrl:"templates/quanzi/CirclePage.html",controller:"CirclePageController"}).state("signInChart",{url:"/signInChart/:topicId",templateUrl:"templates/quanzi/signInChart.html",controller:"signInChartController"}).state("signDate",{url:"/signDate/:userId/:topicId/:monthFlag",templateUrl:"templates/quanzi/signDate.html",controller:"signDateController"}).state("selectTags",{url:"/selectTags",templateUrl:"templates/quanzi/SelectTags.html",controller:"SelectTagsController"}).state("messageDetails",{url:"/messageDetails",templateUrl:"templates/quanzi/MessageDetails.html",controller:"MessageDetailsController"}).state("publishCircle",{url:"/publishCircle/:identifierCode/:topicId",templateUrl:"templates/quanzi/PublishCircle.html",controller:"PublishCircleController",requiredLogin:!0}).state("allMembers",{url:"/allMembers/:topicId",templateUrl:"templates/quanzi/AllMembers.html",controller:"AllMembersController",cache:!1}).state("selectGoods",{url:"/selectGoods",templateUrl:"templates/quanzi/SelectGoods.html",controller:"SelectGoodsController"}).state("noteDetails",{url:"/noteDetails/:noteId/:isShortStory/:shareStoreId",templateUrl:"templates/quanzi/NoteDetails.html",controller:"NoteDetailsController"}).state("classNoteDetails",{url:"/classNoteDetails/:noteId",templateUrl:"templates/quanzi/ClassNoteDetails.html",controller:"ClassNoteDetailsController"}).state("classesDetails",{url:"/classesDetails",templateUrl:"templates/quanzi/ClassesDetails.html",controller:"ClassesDetailsController"}).state("testPage",{url:"/testPage",
<<<<<<< .mine
templateUrl:"templates/quanzi/TestPage.html",controller:"TestPageController"}).state("testDetails",{url:"/testDetails",templateUrl:"templates/quanzi/TestDetails.html",controller:"TestDetailsController"}).state("questionDetails",{url:"/questionDetails/:wordsId",templateUrl:"templates/quanzi/QuestionDetails.html",controller:"QuestionDetailsController"}).state("topic.qhot",{url:"/qhot",views:{"topic-qhot":{templateUrl:"templates/quanzi/qhot.html",controller:"QhotController"}}}).state("topic.qmine",{url:"/qmine",views:{"topic-qmine":{templateUrl:"templates/quanzi/qmine.html",controller:"QmineController"}},requiredLogin:!0}).state("topic.qwschool",{url:"/qwschool",views:{"topic-qwschool":{templateUrl:"templates/quanzi/qwschool.html",controller:"QwschoolController"}}}).state("heIssue",{url:"/heIssue/:title/:who/:id",templateUrl:"templates/quanzi/heIssue.html",controller:"heIssueController",requiredLogin:!0}).state("qdatabase",{url:"/qdatabase",templateUrl:"templates/quanzi/qdatabase.html",controller:"QdatabaseController"}).state("topicdetails",{url:"/topicdetails",templateUrl:"templates/quanzi/Topicdetails.html",controller:"TopicdetailsController",params:{huatiid:null}}).state("qSearch",{url:"/qSearch",templateUrl:"templates/quanzi/qSearch.html",controller:"qSearchController"}).state("qSearchTwo",{url:"/qSearchTwo",templateUrl:"templates/quanzi/qSearchTwo.html",controller:"qSearchTwoController",params:{tagIds:null,tagname:null}}).state("qSearchThree",{url:"/qSearchThree",templateUrl:"templates/quanzi/qSearchThree.html",controller:"qSearchThreeController",params:{keywords:null}}).state("qSearchBiao",{url:"/qSearchBiao",templateUrl:"templates/quanzi/qSearchBiao.html",controller:"qSearchBiaoController",params:{keywords:null}}).state("qSearchTie",{url:"/qSearchTie",templateUrl:"templates/quanzi/qSearchTie.html",controller:"qSearchTieController",params:{keywords:null}}).state("qSearchUser",{url:"/qSearchUser",templateUrl:"templates/quanzi/qSearchUser.html",controller:"qSearchUserController",params:{keywords:null}}).state("personalHomepageMe",{url:"/personalHomepageMe",templateUrl:"templates/quanzi/personalHomepageMe.html",controller:"personalHomepageMeCtrl",requiredLogin:!0}).state("personalHomepageHe",{url:"/personalHomePageHe/:othersId",templateUrl:"templates/quanzi/personalHomePageHe.html",controller:"personalHomepageHeCtrl"}).state("myFollow",{url:"/personalHomepageMe/myFollow",templateUrl:"templates/quanzi/myFollow.html",controller:"myFollowCtrl"}).state("myFans",{url:"/personalHomepageMe/myFans",templateUrl:"templates/quanzi/myFans.html",controller:"myFansCtrl"}).state("moreInteresting",{url:"/personalHomepageMe/moreInteresting",templateUrl:"templates/quanzi/moreInteresting.html",controller:"moreInterestingCtrl"}).state("mySettings",{url:"/personalHomepageMe/mySettings",templateUrl:"templates/quanzi/mySettings.html",controller:"mySettingsCtrl"}).state("quanziRecommend",{url:"/quanziRecommend",templateUrl:"templates/quanzi/quanziRecommend.html",controller:"communityRecommendCtrl"}).state("exam",{url:"/exam",templateUrl:"templates/quanzi/exam.html",controller:"examCtrl"}).state("customerConversation",{url:"/customerConversation",templateUrl:"templates/quanzi/CustomerConversation.html",controller:"CustomerConversationController",params:{products:void 0}}).state("serviceConversation",{url:"/serviceConversation/:chatId/:from/:to",templateUrl:"templates/quanzi/ServiceConversation.html",controller:"ServiceConversationController"}).state("groupSetting",{url:"/groupSetting/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("discussionGroup",{url:"/discussionGroup/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("bankCard",{url:"/bankCard",templateUrl:"templates/mine/Bank/bankCard.html",controller:"BankCardController"}).state("bankCardDetail",{url:"/bankCardDetail/:cardNoShow/:nameKjt",templateUrl:"templates/mine/Bank/bankCardDetail.html",controller:"bankCardDetailController"}).state("chooseTheBank",{url:"/chooseTheBank",templateUrl:"templates/mine/Bank/chooseTheBank.html",controller:"chooseTheBankController"}).state("bankSupport",{url:"/bankSupport",templateUrl:"templates/mine/Bank/bankSupport.html",controller:"bankSupportController"}).state("mentionCenter",{url:"/mentionCenter/:canAmount",templateUrl:"templates/mine/Bank/mentionCenter.html",controller:"mentionCenterController",requiredLogin:!0}).state("dataAnalysis",{url:"/dataAnalysis/:memberId",templateUrl:"templates/statistics/dataAnalysis.html",controller:"dataAnalysisController"}).state("VisitorBrowHistory",{url:"/VisitorBrowHistory/:userId/:daysType",templateUrl:"templates/mine/VisitorBroHistory/VisitorBrowHistory.html",controller:"VisiBroHisController"}).state("Partner",{url:"/Partner/:title/:memberId",templateUrl:"templates/mine/Partner/Partner.html",controller:"PartnerController"}).state("team",{url:"/team",templateUrl:"templates/mine/teamData/team.html",controller:"TeamController"}).state("storeTeamOwner",{url:"/storeTeamOwner",templateUrl:"templates/mine/storeTeamOwner/storeTeamOwner.html",controller:"storeTeamOwnerController"}).state("teamProductMsg",{url:"/teamProductMsg/:num/:type",templateUrl:"templates/mine/storeTeamOwner/teamProductMsg.html",controller:"teamProductMsgController"}).state("schoolGroupDiscuss",{url:"/schoolGroupDiscuss",templateUrl:"templates/quanzi/SchoolGroupDiscuss.html",controller:"SchoolGroupDiscussController"}).state("circleGroupDiscuss",{url:"/circleGroupDiscuss/:groupId/:circleId",templateUrl:"templates/quanzi/CircleGroupDiscuss.html",controller:"CircleGroupDiscussController"}).state("groupAddMember",{url:"/groupAddMember/:groupId/:circleId",templateUrl:"templates/quanzi/GroupAddMember.html",controller:"GroupAddMemberController"}).state("groupEditMember",{url:"/groupEditMember/:groupId",templateUrl:"templates/quanzi/GroupEditMember.html",controller:"GroupEditMemberController"}).state("groupsToShare",{url:"/groupsToShare",templateUrl:"templates/quanzi/GroupsToShare.html",controller:"GroupsToShareController",params:{shareList:void 0}}).state("shareListPage",{url:"/shareListPage",templateUrl:"templates/quanzi/ShareListPage.html",controller:"ShareListPageController",params:{sl:void 0}}).state("feedbackPlus",{url:"/feedbackPlus",templateUrl:"templates/mine/FeedbackPlus.html",controller:"FeedbackPlusController"}).state("newSend",{url:"/newSend",templateUrl:"templates/newsend/newSend.html",controller:"newsendCtrl",cache:!1}).state("flashsale",{url:"/flashsale/:type",templateUrl:"templates/flashsale/flashsale.html",controller:"flashsaleCtrl"}).state("newres",{url:"/newres/:type",templateUrl:"templates/newres/newres.html",controller:"newresCtrl",cache:!1}).state("myAppointment",{url:"/myAppointment",templateUrl:"templates/mine/myAppointment.html",controller:"myAppointmentController"}).state("presell",{url:"/presell",templateUrl:"templates/presell/presell.html",controller:"presellCtrl",cache:!1}).state("accsetting",{url:"/accsetting",templateUrl:"templates/mine/accsetting.html",controller:"accsettingCtrl"}).state("accsafe",{url:"/accsafe",templateUrl:"templates/mine/accsafe.html",controller:"accsafeCtrl"}).state("relatedProduct",{url:"/relatedProduct",templateUrl:"templates/quanzi/relatedProduct.html",controller:"relatedProductController"}).state("topicRewardList",{url:"/topicRewardList/:tipId",templateUrl:"templates/quanzi/topicRewardList.html",controller:"topicRewardListController"}).state("CircleSetAdmin",{url:"/CircleSetAdmin/:topicId",templateUrl:"templates/quanzi/CircleSetAdmin.html",controller:"CircleSetAdminController"}).state("selectAdmin",{url:"/selectAdmin/:topicId",templateUrl:"templates/quanzi/selectAdmin.html",controller:"selectAdminController",cache:!1}).state("manageUser",{url:"/manageUser/:topicId",templateUrl:"templates/quanzi/manageUser.html",controller:"manageUserController",cache:!1}).state("financialMoney",{url:"/financialMoney/:whereId",templateUrl:"templates/shop/financialMoney.html",controller:"FinancialMoneyController"}).state("applyForWhite",{url:"/applyForWhite",templateUrl:"templates/mine/wallet/ApplyForWhite.html",controller:"ApplyForWhiteController"}).state("bankCardChose",{url:"/bankCardChose/:orderSn/:totalAmount",templateUrl:"templates/order/bankCardPaymentList.html",controller:"BankCardChoseController"}).state("debitCardPayment",{url:"/debitCardPayment/:orderSn/:totalAmount/:whereName",templateUrl:"templates/order/debitCardPayment.html",controller:"debitCardPaymentController"}).state("applyForCard",{url:"/applyForCard",templateUrl:"templates/product/applyForCard.html",controller:"applyForCardController"}).state("spendBaiInstallment",{url:"/spendBaiInstallment/:orderSn",templateUrl:"templates/order/spendBaiInstallment.html",controller:"spendBaiInstallmentController"}).state("fullHouseSolution",{url:"/fullHouseSolution/:soluteId",templateUrl:"templates/product/newVision/fullHouseSolution.html",controller:"fullHouseSolutionController"}).state("houseSoluteDetail",{url:"/houseSoluteDetail/:solutionId",templateUrl:"templates/product/newVision/houseSoluteDetail.html",controller:"houseSolutionDetailController"}).state("exportDetail",{url:"/exportDetail/:exportId",templateUrl:"templates/product/newVision/exportDetail.html",controller:"exportDetailController"}).state("exStoreDetail",{url:"/exStoreDetail/:nearbyId",templateUrl:"templates/product/newVision/exStoreDetail.html",controller:"exStoreDetailController"}).state("itSoluteDetail",{url:"/itSoluteDetail/:solutionId/:shareId",templateUrl:"templates/product/newVision/itSoluteDetail.html",controller:"itSoluteDetailController"}).state("homeDetail",{url:"/homeDetail/:solutionId",templateUrl:"templates/product/newVision/homeDetail.html",controller:"homeDetailController"}).state("homeDesignsth",{url:"/homeDesignsth",templateUrl:"templates/product/newVision/homeDesignsth.html",controller:"homeDesignsthController"}).state("designDetail",{url:"/designDetail/:soluteId",templateUrl:"templates/product/newVision/designDetail.html",controller:"designDetailController"}).state("zhihuichangjing",{url:"/zhihuichangjing/:solutionId",templateUrl:"templates/product/newVision/zhihuichangjing.html",controller:"zhcjController"}).state("newHome",{url:"/newHome",templateUrl:"templates/product/newVision/newHome.html",controller:"newHomeController"}).state("newHomeMake",{url:"/newHomeMake",templateUrl:"templates/product/newVision/newHomeMake.html",controller:"newHomeMakeController"}).state("newTestingStore",{url:"/newTestingStore",templateUrl:"templates/product/newVision/newTestingStore.html",controller:"newTestingStoreController"}).state("newHomeLife",{url:"/newHomeLife",templateUrl:"templates/product/newVision/newHomeLife.html",controller:"newHomeLifeController"}).state("newHomeOrder",{url:"/newHomeOrder",templateUrl:"templates/product/newVision/newHomeOrder.html",controller:"newHomeOrderController"}).state("homeMakeList",{url:"/homeMakeList/:index",templateUrl:"templates/product/newVision/homeMakeList.html",controller:"homeMakeListController"}).state("homeMakeActList",{url:"/homeMakeActList",templateUrl:"templates/product/newVision/homeMakeActList.html",controller:"homeMakeActListController"}).state("testingStoreList",{url:"/testingStoreList/:nearbyType",templateUrl:"templates/product/newVision/testingStoreList.html",controller:"testingStoreListController"}).state("newHomeSend",{url:"/newHomeSend",templateUrl:"templates/product/newVision/newSend.html",controller:"newHomesendCtrl"}).state("newsuperMarket",{url:"/NewsuperMarket",templateUrl:"templates/product/newVision/superMarket.html",controller:"NewsuperMarketController"}),JSON.parse(window.localStorage.getItem("USER_CACHE_KEY"))?t.otherwise("/newHome"):t.otherwise("/guidePage/:")};route.$inject=["$stateProvider","$urlRouterProvider"],APP.run(["GoodsService","AccountMessageService","trueAuthenticationService","HomePageService","$ionicPlatform","$rootScope","UserService","$state","CacheService","$ionicHistory","$timeout","$ionicLoading","PopupService","$location","$ionicPopup","AreaService","CommonAddressService","LoginService","AdvertisementService","$localstorage","$http","UrlService","CreditService","IMService","ShareService","$interval","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b,A,P){function x(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function L(){var e=y.getUrl("JINBI_JILU");w.get(e).success(function(e){e.success})}function D(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return a.isCommission=o[i].list[0].checked,a.cashSwitch=o[i].list[1].checked,a.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0}}function N(){a.missionLists&&(a.missionLists(),a.missionLists=null)}function _(e){a.goldRainSwitch?a.isRaining||(a.isRaining=!0,goldFall(function(){a.isRaining=!1}),processLightMessage(e)):processLightMessage(e)}function O(e){e.levelOrder&&e.levelName&&u.levelUp(e.levelName,e.levelOrder,e.needCreditNum)}function k(){m.confirm({title:"<strong>退出应用</strong>",template:"确定要退出应用吗?",okText:"退出",okType:"button-assertive",cancelText:"取消"}).then(function(e){e&&ionic.Platform.exitApp()})}if(window.runRnCode=function(){$("[ng-click='goBack()']").not("[hasClick]").on("click",function(){0==l.viewHistory().histories.root.cursor&&window.postMessage("goback")}).attr("hasClick","1")},-1!=window.location.href.indexOf("sg_rn_app")){var E=window.location.href.indexOf("sg_rn_app"),U=window.location.href.slice(E+9),M=unescape(U),R=U.slice(U.indexOf("regionName")+17),B=R.slice(0,R.length-9),H=JSON.parse(M);window.RNmsg=H,a.RNmsg=window.RNmsg,n.setUser(window.RNmsg.userMsg),I.set("sg_login_token_secret",window.RNmsg.userMsg.userToken),e.addAddress(window.RNmsg.addressInfo.provinceId,window.RNmsg.addressInfo.cityId,window.RNmsg.addressInfo.areaId,decodeURIComponent(B),window.RNmsg.addressInfo.streetId).success(function(e,t,o,s){})}a.firstLocationPage=window.history.length,a.countTime=10,a.tooCrowdToastFlag=!1;var F;window.closeTooCrowdToast=function(){"确定"==$(".popup-body .countToast").html()&&(a.countTime=10,a.tooCrowdToastFlag=!1,F.close())},a.$on("tooCrowd",function(e,t){if(!a.tooCrowdToastFlag){a.tooCrowdToastFlag=!0;var o=A(function(){a.countTime-1<=0?($(".popup-body .countToast").html("确定"),A.cancel(o)):(a.countTime--,$(".popup-body .countToast").html(a.countTime+"s"))},1e3);F=m.show({template:'<div style="color: black;text-align: left;font-size: 12px;text-align:center;padding-bottom:20px;">'+t+'<div class="countToast" style="position: absolute;bottom: 0;left: 0;width: 100%;height: 34px;line-height:34px;border-top: 1px solid #3333" onClick="closeTooCrowdToast();">10s</div></div>',buttons:[]});var s=A(function(){a.tooCrowdToastFlag?"确定"!=$(".popup-body .countToast").html()?$(".popup-body .countToast").css("color","#666666"):$(".popup-body .countToast").css("color","#32BEFF"):A.cancel(s)},200)}}),a.couponXyzType=!1;var G=unescape(window.location.href),V=null;-1!=G.indexOf("circlePage/662")&&(V=G.substr(G.indexOf("&token=")+7)),V&&I.set("sg_login_token_secret","Bearer"+V),w.get(y.getUrl("TOKEN_LOGIN_GET")).success(function(e){e.data?I.set("sg_login_token_secret","Bearer"+e.data):I.set("sg_login_token_secret","Bearer"+P.generateUUID())}).error(function(e){I.set("sg_login_token_secret","Bearer"+P.generateUUID())}),a.globalConstant={},a.globalConstant.lon=120.457091,a.globalConstant.lat=36.108883,a.globalConstant.autoPosition="定位中···",a.globalConstant.positionStatus=!0,a.globalConstant.storeId="20219251",a.globalConstant.versionIOS="4.2.5",a.globalConstant.versionANDROID="4.2.5",a.globalConstant.androidDownLoadUrl="http://www.baidu.com",a.globalConstant.iosDownLoadUrl="http://www.baidu.com",a.globalConstant.mobileNumberRegExp=/^1([3578][0-9]|4[01356789]|66|9[89])\d{8}$/,a.globalConstant.passwordRegExp=/^((?=.*?\d)(?=.*?[A-Za-z])|(?=.*?\d)(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~])|(?=.*?[A-Za-z])(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]))[\dA-Za-z\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]{6,20}$/,a.imgBaseURL="http://cdn09.ehaier.com/shunguang/H5/www/",a.tabsImg={background:"",wdHover:a.imgBaseURL+"img/newvision/Mine.png",fl:a.imgBaseURL+"img/newvision/guang@2x.png",flHover:a.imgBaseURL+"img/newvision/guang x@2x.png",sgHover:a.imgBaseURL+"img/newvision/home.png",gwcHover:a.imgBaseURL+"img/newvision/car.png",sq:a.imgBaseURL+"img/newvision/sqs.png",sqHover:a.imgBaseURL+"img/newvision/sq.png",wd:a.imgBaseURL+"img/newvision/Mines.png",sg:a.imgBaseURL+"img/newvision/homes.png",gwc:a.imgBaseURL+"img/newvision/cars.png"},a.tabsTextColor={wdHoverFontColor:"#2577e3",flFontColor:"gray",flHoverFontColor:"#2577e3",sgHoverFontColor:"#2577e3",gwcHoverFontColor:"#2577e3",sqFontColor:"gray",sqHoverFontColor:"#2577e3",wdFontColor:"gray",sgFontColor:"gray",gwcFontColor:"gray"};var j=y.getNewUrl("ACTIVITY_ICON_TABS_NEW");w.get(j,{iconType:2}).success(function(e){e.success&&null!==e.data&&(null!==e.data.iconImageConfig&&(a.tabsImg=e.data.iconImageConfig),null!==e.data.iconFontConfig&&(a.tabsTextColor=e.data.iconFontConfig))}),a.appIsPaused=!1,a.invoiceType=2;var z;x("loginId");x("loginId")?z=x("loginId"):(z=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}(),function(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}("loginId",z)),a.loginIsAccord=!1,a.loginIsAuthentication=!1,a.goUpgrade=function(){a.loginIsAccord=!1,r.go("newAuthenticationHome")},a.goAuthentication=function(){n.isUserLogin()?(a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("trueAuthenticationList")):r.go("login")},a.goMechanismDescription=function(){a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("MechanismDescription")},a.closePopup=function(){a.loginIsAccord=!1,a.loginIsAuthentication=!1,a.loginIsAccord2=!1},a.signOut=function(){if(n.isUserLogin()){a.userCount="",a.password="";void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}else r.go("login")},a.goChangePhoneNum=function(){n.isUserLogin()?(a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("myPhoneManage")):r.go("login")},i.on("resume",function(){a.appIsPaused=!1,C.validateWebSocket(),n.getUser().mid&&L()}),i.on("pause",function(){a.appIsPaused=!0});var W=p.show,q=p.hide;a.curOrder=0,a.totalOrder=0,p.show=function(e){a.loadingStart=(new Date).getTime(),W(e),e.duration&&d(function(){a.loadingStart=0,a.curMsg=null},e.duration)},p.hide=function(){q(),a.loadingStart=0,a.curMsg=null},window.closeLevelUpPop=function(){p.hide(),a.isLevelUp=!1,processLightMessageQueue()},window.closeGoodCoupon=function(e){e.parentNode.parentNode.remove()},window.gomyCouponsList=function(e){e.parentNode.parentNode.parentNode.remove(),r.go("myCouponsList")},D(n.getUser().mid),a.$on("sessionTimeout",function(){n.clearUser(),r.go("login")});var J=null,Y=null,K=!1;a.registOrderSuccessCallback=function(e,t,o){K=!1,Y=e,t&&d(function(){!1===K&&o&&o(e,!0,null)},t),J=o},window.processMessage=function(e){if("advertisement"==a.toState||"shopApplySuccess"==a.toState||"trueAuthentication"==a.toState)return void Q.unshift(e);var t=e.messageType,o=e.extendData;"ORDER_COMMIT_RESULT"===t?J&&(K=!0,J(Y,!1,e)):(a.isLevelUp=a.isLevelUp||o.popupMessage&&null!=o.popupMessage,null==o||$.isEmptyObject(o)||(a.freshMission&&(N(),a.freshMission=!1),"1"==o.goldRain&&_(e.msg),"1"==o.openStoreReward&&u.showGoodCoupon(o.amount),null!=o.voiceMessage&&a.cashSwitch&&Z._playAudio(),o.popupMessage&&O(o),o.lightMessage&&processLightMessage(e.msg),o.dynamicMessage&&("productDetail"!=a.toState&&"homePage"!=a.toState||($(".mess-tip").html(e.msg),$(".mess-tip").css("display","block"),setTimeout(function(){$(".mess-tip").css("display","none")},3e3)))))},window.processMessageQueue=function(){for(D(n.getUser().mid);;){var e=Q.pop();if(!e)break;processMessage(e)}},window.processLightMessage=function(e){a.isLevelUp?X.unshift(e):u.goldIncrease(e)};var Q=[],X=[];a.$on("$stateChangeSuccess",function(e,i,c,l,p){if(a.fromState=l.name,a.toState=i.name,a.xnFromState=l,a.xnToState=i,a.xnFromParams=p,a.xnToParams=c,P.GetUserInfo(i.name,l.name,c),"advertisement"!=a.fromState&&"shopApplySuccess"!=a.fromState||processMessageQueue(),n.getUser().mid&&(gio_userId=n.getUser().mid,gio_userRole="1"==v.getRole()?1:0,window.gio&&(gio("setUserId",gio_userId),gio("people.set",{userRole:gio_userRole+""}))),("RegisterForStoreLogin"==a.fromState||"registerForStore"==a.fromState)&&"login"==a.toState){a.userCount="",a.password="";void 0==n.getUser().sessionValue?(n.clearUser(),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}if(!("login"!=a.fromState&&"RegisterForStoreLogin"!=a.fromState&&"register"!=a.fromState||"homePage"!=a.toState&&"personnalCenter"!=a.toState&&"cart"!=a.toState&&"productDetail"!=a.toState&&"messageCenter"!=a.toState&&"topic"!=a.toState&&"circlePage"!=a.toState&&"noteDetails"!=a.toState&&"allcircle"!=a.toState&&"personalHomePageHe "!=a.toState&&"newres"!=a.toState&&"crowd_funding_details"!=a.toState&&"getCouponsList"!=a.toState)){var g,f;g=I.get("OLDTIMEONE"),f=I.get("loginMemberId"),a.nowTime=(new Date).getDate(),v.checkOpenStore(a.loginMemberId).success(function(e,i,c,l){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){w.get(y.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(a.isBuyer=1,v.setRole(a.isBuyer),a.loginIsAccord=!1,a.loginIsAuthentication=!1,s.isWdHost().success(function(e){e.success?(a.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o?a.myPopups=m.show({template:a.o2oMessage,buttons:[{text:"退出",onTap:function(){a.userCount="",a.password="",void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}}]}):null==e.data.o2o?a.loginIsAuthentication=!1:o.doInit().success(function(e){e.success&&(e.data.isAuth?(a.loginIsAccord=!1,a.loginIsAuthentication=!1,n.isUserLogin()&&d(function(){u.showToast("登录成功，请继续您的旅程...")},800)):(a.isCloseBtn=e.data.forceAuthFlag,a.isCloseBtn?a.loginIsAuthentication=!0:g==a.nowTime&&a.loginMemberId==f?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(I.set("OLDTIMEONE",a.nowTime),I.set("loginMemberId",a.loginMemberId),n.isUserLogin()&&(a.loginIsAccord=!1,a.loginIsAuthentication=!0))))}))):u.showToast("获取数据信息失败！")})):(a.isBuyer=0,v.setRole(a.isBuyer),g==a.nowTime&&a.loginMemberId==f?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(I.set("OLDTIMEONE",a.nowTime),I.set("loginMemberId",a.loginMemberId),n.isUserLogin()&&(a.loginIsAuthentication=!1,window.cordova&&(a.loginIsAccord=!0),a.loginIsAccord=!1)))}).error(function(e){u.showToast("网络连接失败！")})}});var Z=new Cash;!function(){var e=function(e,t){return processMessage(e),!0};a.token=null,C.initWebSocket(e)}(),a.$on("REQUIRE_LOGIN",function(){c.get("REQUIRE_LOGIN_SHOW")||(c.set("REQUIRE_LOGIN_SHOW",!0),u.showConfirm("提示","尚未登录，是否去登录？",function(e){e?r.go("login"):n.clearUser(),c.set("REQUIRE_LOGIN_SHOW",!1)},"去登录"))});var ee=0;if(a.$on("LOADING:SHOW",function(){if(ee++,!a.isLoadShowing){var e={template:'<div style="width:35px;height:35px;background:#666666;border-radius:5px;"><img src="{{imgBaseURL}}img/ic_refresh_02.gif" style="width: 35px;height:35px;"/></div>',duration:7e3};p.show(e)}a.isLoadShowing=!0}),a.$on("LOADING:HIDE",function(){--ee<=0&&(a.isLoadShowing=!1,p.hide())}),s.isWdHost().success(function(e){a.isWdHost=e.data.isHost}),S.getAdImage().success(function(e){if(e.data[0]&&e.data[0].image){I.get("bannerId")!=e.data[0].bannerId&&(I.set("openCount",0),I.set("hasAD","noAD"));var t=e.data[0].image;I.set("hasAD",t),I.set("bannerId",e.data[0].bannerId)}else I.set("hasAD","noAD")}).error(function(e){I.set("hasAD","noAD")}),window._czc&&_czc.push(["_setAccount","1259430011"]),a.$on("$stateChangeSuccess",function(e,t,o,s,i){var a=g.$$absUrl.substring(location.origin.length);window._czc&&_czc.push(["_trackPageview",a]),window.doGetData&&doGetData()}),window.sgOnNotificationReceived=function(e){},n.isUserLogin()){var te=n.getUser().mid;v.checkOpenStore(te).success(function(e,i,c,l){e.data?(a.isBuyer=1,v.setRole(a.isBuyer),s.isWdHost().success(function(e){e.success?(a.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o?a.myPopup=m.show({template:a.o2oMessage,buttons:[{text:"退出",onTap:function(){a.userCount="",a.password="",void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}}]}):null==e.data.o2o?a.loginIsAuthentication=!1:o.doInit().success(function(e){e.success&&(e.data.isAuth?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(a.isCloseBtn=e.data.forceAuthFlag,a.loginIsAccord=!1,a.isCloseBtn&&(a.loginIsAuthentication=!0)))}))):u.showToast("获取数据信息失败！")})):(a.isBuyer=0,v.setRole(a.isBuyer))}).error(function(e){u.showToast("网络连接失败！")})}i.ready(function(){function e(e){d(function(){a.keyboardHeight={bottom:e.keyboardHeight+"px"};var t=e.keyboardHeight+25;a.contentMarginBottom={"margin-bottom":t+"px"}},100)}function t(e){d(function(){a.keyboardHeight={bottom:0},a.contentMarginBottom={"margin-bottom":0}},100)}function o(e){a.globalConstant.lon=e.position.getLng(),a.globalConstant.lat=e.position.getLat(),a.globalConstant.positionStatus=!0,h.addAddressInfo()}function s(e){a.globalConstant.positionStatus=!1,h.addAddressInfo()}navigator.splashscreen&&navigator.splashscreen.hide(),L();var i=y.getUrl("DEVICE_INFO"),n=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";if(window.UmengPush&&(window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken([],function(e){w.get(i+"?device_token="+e+"&device_type="+n)}),window.UmengPush.onReceiveMessage))try{window.UmengPush.onReceiveMessage(function(e){window.UmengPush.onReceiveMessage(arguments.callee,null),e&&T.getGameId(function(t){r.go("vip",{gameId:t,msg:e})})},null)}catch(e){}if(a.hasWechat=!1,window.wechatPay&&window.wechatPay.checkAppInstalled&&window.wechatPay.checkAppInstalled(function(e){a.hasWechat=!!e}),a.hasQQ=!0,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.cordova&&window.cordova.InAppBrowser&&(window.open=window.cordova.InAppBrowser.open),a.isIOS=!!window.cordova&&-1!=ionic.Platform.platform().indexOf("ios"),a.isApp=!!window.cordova||void 0,a.screenThreeWidth={height:(window.screen.width-50)/3+10+"px"},a.screenListThreeWidth={height:(window.screen.width-20)/3+"px"},-1!=ionic.Platform.platform().indexOf("ios")?(window.addEventListener("native.keyboardshow",e),window.addEventListener("native.keyboardhide",t)):d(function(){a.keyboardHeight={bottom:0}},100),!window.cordova){var c=navigator.userAgent,l=c.indexOf("Android")>-1||c.indexOf("Adr")>-1,p=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);a.downAppUrl=p?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":l?"http://app.qq.com/#id=detail&appid=1104761357":""}a.toDownLoad=function(){var e=a.isIOS?a.globalConstant.iosDownLoadUrl:a.globalConstant.androidDownLoadUrl;window.cordova?cordova.InAppBrowser.open(e,"_system"):window.open(e,"_system")},window.navigator.userAgent.indexOf("ShunGuangRN")<=-1&&(ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(e){a.globalConstant.lat=e.latitude,a.globalConstant.lon=e.longitude,h.addAddressInfo()},function(e){"12"==e.errorCode&&m.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">打开“定位服务”来允许“顺逛”确定您的位置</div><div style="color: #000;font-size: 12px;">顺逛将获取您的位置，为您提供更精准的服务</div>'}),h.addAddressInfo()}):(mapObj=new AMap.Map(""),mapObj.plugin("AMap.Geolocation",function(){var e=new AMap.Geolocation;e.getCurrentPosition(),AMap.event.addListener(e,"complete",o),AMap.event.addListener(e,"error",s)})))}),i.registerBackButtonAction(function(e){if("advertisement"==a.fromState)r.go("homePage");else if("/paymentxyz"==g.path().substring(0,11)){var t=l.viewHistory().backView;"orderManage"==t.stateName?l.goBack(-1):l.goBack(-2)}else if("orderManage"==l.currentStateName())l.backView()?"batchDeleteOrder"==l.viewHistory().backView.stateName?l.goBack(-2):"afterOrderSubmit"==l.backView().stateName?l.goBack(-3):"ccbPay"==l.backView().stateName||"paymentxyz"==l.backView().stateName||"payResultSuccess"==l.viewHistory().backView.stateName||"payResultFailure"==l.viewHistory().backView.stateName?(v.getRole(),r.go("homePage"),l.clearCache()):l.goBack(-1):(r.go("homePage"),l.clearCache());else if("ccbPay"==l.currentStateName())r.go("orderManage");else if("homePage"==l.currentStateName()||"guidePage"==l.currentStateName()||"directPurchase"==l.currentStateName())k();else if("homePage"==l.currentStateName()||"cart"==l.currentStateName()||"personalCenter"==l.currentStateName()||"topic.qhot"==l.currentStateName()||"branchType"==l.currentStateName())r.go("homePage"),l.clearCache();else if("payResultSuccess"==l.currentStateName()||"payResultFailure"==l.currentStateName())r.go("orderManage");else if("shopRevenue"==l.currentStateName()){if(!l.backView()||"mentionCenter"==l.viewHistory().backView.stateName)return void r.go("homePage");l.backView()&&l.backView().url.indexOf("login")>0?l.goBack(-2):l.goBack()
}else if("bankCard"==l.currentStateName())null==l.viewHistory().backView?r.go("personnalCenter"):"shopRevenue"==l.viewHistory().backView.stateName||"paymentxyz"==l.viewHistory().backView.stateName?l.goBack():r.go("personnalCenter");else if("criticalSuccess"==l.currentStateName())l.goBack(-2);else if("bankCardDetail"==l.currentStateName())r.go("bankCard");else if("noteDetails"==l.currentStateName())if(a.globalConstant.showvideo){a.$apply(function(){a.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),s=0;s<o.length;s++)o[s].pause();$(".bof").css("display","block")}else a.nextPageBefore="noteDetails",l.goBack();else if("classNoteDetails"==l.currentStateName())a.nextPageBefore="classNoteDetails",l.goBack();else if("publishCircle"==l.currentStateName()||"publishEdit"==l.currentStateName())if(a.backgo="publish",a.globalConstant.showvideo){a.$apply(function(){a.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),s=0;s<o.length;s++)o[s].pause();$(".pcbf").css("display","block"),$(".pebf").css("display","block")}else l.goBack();else"letterGroupFriend"==l.currentStateName()?(a.nextPageBefore="letterGroupFriend",l.goBack()):"letterSend"==l.currentStateName()?(a.nextPageBefore="letterSend",l.goBack()):"privateLetter"==l.currentStateName()?(a.nextPageBefore="privateLetter",l.goBack()):l.goBack()},101),a.$on("$stateChangeStart",function(e,t,o,i,l){if(("homePage"==t.name||"productDetail"==t.name)&&-1!=window.location.href.indexOf("_aPlatform")&&-1!=window.location.href.indexOf("_aToken")){var d=window.location.href.split("?")[1],p=d.split("&")[0].split("=")[1],u=d.split("&")[1].split("=")[1];window.localStorage._aToken=p,window.localStorage._aPlatform=u,3==u&&s.isAuthoMid(p)}r.get(t.name).requiredLogin&&!n.isUserLogin()&&(e.preventDefault(),n.clearUser(),c.set("toState",t),c.set("toParams",o),r.go("login")),a.$on("userIntercepted",function(e){n.clearUser(),r.go("login")}),(""==i.name&&"homePage"==t.name||"login"==i.name&&"homePage"==t.name||"advertisement"==i.name&&"homePage"==t.name||"guidePage"==i.name&&"homePage"==t.name)&&w.get(y.getGameUrl("IS_KAIMENHONG_AVAILABLE")).success(function(e){!0===e&&r.go("bannerTheme",{bannerId:y.getCPUrl("KMH_ID")})})})}]),APP.service("UrlService",[function(){var e=[{SERVER_DATA:"https://m.ehaier.com/v3/",SERVER_DATA_GAME:"https://m.ehaier.com/v4/",AMAP_SERVER:"https://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"https://m.ehaier.com/",SHARELINKHEADER:"https://m.ehaier.com/www/index.html#/",SERVER_DATA_V2:"https://m.ehaier.com/v2/",ZC_SERVER_DATA:"https://m.ehaier.com/",CCB_SERVER_DATA:"https://pay.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://message.ehaier.com:8080/",SEARCH_SERVER_DATA:"https://s.ehaier.com/search/",ITEM_SERVER_DATA:"https://detail.ehaier.com/v3/",ITEM_SERVER_DATA_NEW:"https://detail.ehaier.com/",COOPERATE_URL:"OFFICIAL_",PAY_CENTER:"https://pay.ehaier.com/",SERVER_TOP:"https://store.ehaier.com/appapi",PAY_LIVING:"https://cdn09.ehaier.com/shunguang/livingPay/www/index.html"},{SERVER_DATA:"http://mobiletest.ehaier.com:20306/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:20306/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:20306/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:20306/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:20306/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:20306/",COOPERATE_URL:"TEST_",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/"},{SERVER_DATA:"http://mobiletest.ehaier.com:38080/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38080/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38080/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38080/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38080/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38080/v3/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:38080/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/",PAY_LIVING:"http://cdn09.ehaier.com/shunguang/livingPaytest/www/index.html"},{SERVER_DATA:"http://mobiletest.ehaier.com:38081/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38081/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38081/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38081/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38081/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38081/v3/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:38081/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/",PAY_LIVING:"http://cdn09.ehaier.com/shunguang/livingPaytest/www/index.html",SERVER_TOP:"http://mobiletest.ehaier.com:38081/v3/thirdparty/app"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://mdev.ehaier.com:81/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http:/mdev.ehaier.com:81/mstatic",SHARELINKHEADER:"http:/mdev.ehaier.com:81/www/index.html#/",SERVER_DATA_V2:"http:/mdev.ehaier.com:81/v2/",ZC_SERVER_DATA:"http://mdev.ehaier.com:81/",CCB_SERVER_DATA:"http://mdev.ehaier.com:81/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",ITEM_SERVER_DATA_NEW:"http://detaildev.ehaier.com:81/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://m.pre.ehaier.com/v3/",SERVER_DATA_GAME:"http://m.pre.ehaier.com/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://m.pre.ehaier.com/mstatic",SHARELINKHEADER:"http://m.pre.ehaier.com/www/index.html#/",SERVER_DATA_V2:"http://m.pre.ehaier.com/v2/",ZC_SERVER_DATA:"http://m.pre.ehaier.com/",CCB_SERVER_DATA:"http://m.pre.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://s.pre.ehaier.com/v3/",ITEM_SERVER_DATA:"http://detail.pre.ehaier.com/v3/",ITEM_SERVER_DATA_NEW:"http://detaildev.ehaier.com:81/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://localhost:8100/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://localhost:8100/mstatic",SHARELINKHEADER:"http://localhost:8100/www/index.html#/",SERVER_DATA_V2:"http://mdev.ehaier.com:81/v2/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/"}],t=e[2].SERVER_DATA,o=e[2].ZC_SERVER_DATA,s=e[2].SERVER_DATA_V2,i=e[2].SERVER_MQ_WEBSOCKET,a=e[2].ZC_SERVER_DATA,n=e[2].CCB_SERVER_DATA,r=e[2].COOPERATE_URL,c=e[2].PAY_CENTER,l=e[2].SERVER_TOP,d=e[2].PAY_LIVING,p={GETTUIGUANGMA:"mstore/sg/store/wdSpreading.html",CHANGEDATA_INIT:"changeData.json",KUNBIND_INIT:"kjt/sg/kjtAccountUnbind.html",KBIND_INIT:"kjt/sg/kjtAccountBind.html",KBIND_ACTIVATION:"kjt/sg/kjtAccountActivation.html",KBIND_REALNAME:"kjt/sg/kjtAccountAuthRealName.html",SETDEFAULT_INIT:"h5/order/updateDefaultAddress.json",ADDRESS_INIT:"h5/order/memberAddresses.json",COLLECTION_LIST:"mstore/sg/collections.html",DELETECOLLECTION_INIT:"h5/sg/item/cancelProductCollection.json",COLLECTION_INIT:"h5/sg/item/productCollection.json",MESSAGECENTER_INIT:"mstore/sg/msgCenter.html",DETAILMESSAGECENTER_INIT:"detailMessageCenterfalseData.json",EASYCONNECT_INIT:"kjt/sg/withdrawSetting.html",EASYCONNECTRESULT_INIT:"mstore/sg/kjtInfo.html",EASYCONNECTACCOUNT_INIT:"mstore/sg/kjtInfo.html",GETCASH_INIT:"mstore/sg/local/myApply.html",NEW_GETCASH_INIT:"kjt/myApply.html",UNLOAD_INIT:"platform/web/member/logoutNew.json",UPDATEMEMBER_INIT:"platform/web/member/updateMember.json",UPDATE_EMAIL:"platform/web/member/updateEmail.json",UPDATEPASSWORD_INIT:"platform/web/member/updatePassword.json",SET_PASSWORD_INIT:"platform/web/member/setPassword.json",DETELEADDR_INIT:"h5/order/deleteAddress.json",CHANGEADDR_INIT:"h5/order/updateAddress.json",ADDADDRESS_INIT:"h5/order/insertAddress.json",CHECKSHOPNAME_INIT:"mstore/sg/checkSensitiveWords.html",CHANGESHOPNAME_INIT:"mstore/sg/store/changeStoreName.html",CHECKHRCODE_INIT:"mstore/sg/checkHrCode.html",EDITSHOP_INIT:"mstore/sg/wdStoreInfoEdit.html",SHOPINFO_INIT:"mstore/sg/storeInfo.html",SHOPKIND_INIT:"mstore/sg/getMemberType.html",UPLOAD_IMAGE:"platform/web/app/uploadImage",SELECT_INIT:"mstore/sg/wdMarketData.html",FAXIAN_INIT:"loadFindProductsNew.html",ASYNC_ACCESS_PRICE:"getPriceByProductList.html",CHANGESUCCESS_INIT:"mstore/sg/addMarketTypeToCookie.html",CHANGECHOOSESTATEDUI_INIT:"mstore/sg/removeProductShelvesSubmit.html",CHANGECHOOSESTATEJIA_INIT:"mstore/sg/updateProductShelvesSubmit.html",SEARCHGOODS_INIT:"mstore/sg/wdMarketSearchItem.html",ADDCART_INIT:"h5/cart/add.json",LOADMOREPRODUCTS_INIT:"mstore/sg/commonLoadItem.html",ADDADDRESSSELECTION_INIT:"mstore/sg/addPositionToCookie.json",GET_POSITION_FROM_COOLIE:"mstore/sg/getPositionFromCookie.json",CHOOSE_ADDR:"h5/order/changeAddress.json",GET_ADDRESS_ID:"mstore/sg/getAddressId.html",GET_SELECTION_IMAGE:"mstore/sg/wdMarket.html",CHECK_NOTICE:"h5/sg/checkOnly.html",ARRIVE_NOTICE:"h5/sg/insertNotice.html",START_NOTICE:"h5/sg/insertActivityNotice.html",MESSAGE_CLASSIFY:"mstore/sg/messageCenter.html",CUSTOMPAGE_MODEL:"activity/page/getCustomPageDetail.json",LOCAL_SPECIALTY:"sg/cms/chara/charaIndex.json",NEW_AND_LIMIT:"sg/cms/flashSales/chara.json",NEW_LOCAL_FLASHSALE:"sg/cms/flashSales/charasale.json",LOCAL_SPECIALTY_LIKE_TYPE:"sg/cms/chara/charaCate.json",LOCAL_SPECIALTY_LIKE_DATA:"sg/cms/chara/charaProducts.json",ALL_SPECIALTY:"sg/cms/chara/charaRegions.json",SPECIALTY_CART_NUM:"h5/cart/num.json",SPECIALY_VENUE_HOME:"/sg/cms/chara/charaPage.json",SPECIALY_PRODUCTS_LIST:"charaLoadItem.json",STORE_COLLECTIONLIST:"mstore/sg/storeCollection.json",SECONDLEVEL_PRODUCTLIST:"charaLoadItem.json",SECONDLEVEL_SECTYPELIST:"sg/cms/chara/cityChara.json",ADD_COLLECT:"v3/mstore/sg/collectStore.json",CANCEL_COLLECT:"v3/mstore/sg/collectCancel.json",LOGIN:"platform/web/member/login.json",CAPTCHALOGIN:"platform/web/member/captchaLogin.json",LOGIN_CHECK:"platform/web/widget/login.html",GET_CAPTCHA:"platform/web/member/captcha.json",GET_LOGIN_CAPTCHA:"platform/web/member/getImgCaptchafromUC.html",GET_IMG_CAPTCHA:"platform/web/member/register/getImgCaptcha.html",REGISTER_USER_INFO:"platform/web/member/register.json",GET_PASSWORD_CAPTCHA:"platform/web/member/captchaForFindPaw.json",CAPTCHA_CHECK:"platform/web/member/verifyCaptcha.json",REQUEST_PASSWORD:"platform/web/member/resetPassword.json",OTHER_LOGIN:"platform/web/member/getMember.json",STATISTICS:"mstore/sg/statistics/portal.json",SECOND_MANAGE:"mstore/sg/store/subMembers.html",THIRD_MANAGE:"mstore/sg/store/grandMembers.html",ORDER_AMOUNT:"v3/h5/order/getOrderCount.json",ORDER_MANAGE:"v3/h5/order/getOrderList.json",CANCEL_ORDER:"h5/sg/order/cancelOrder.html",SUBMIT_APPLY_REFUND:"h5/sg/order/submitOrderRepair.html",FEEDBACK:"h5/sg/content/recommend.html",FEEDBACK_PLUS:"h5/sg/content/recommendNew.html",CHECK_REFUND:"h5/sg/order/checkOrderRefund.html",CHECK_TEXT:"mstore/sg/checkSensitiveWords.html",GET_PROMOTION_USER_INFO:"platform/web/member/getPromotionUserInfo.json",SHOP_APPLY:"mstore/sg/wdApplySubmit.html",REFUND_DETAIL:"h5/sg/order/getOrderRepairsInfo.html",ORDER_TRACKING:"h5/sg/order/orderTrack.html",APPLY_REFUND:"h5/sg/order/orderRefund.html",COMMON_UNION:"mstore/sg/getMemberType.html",ORDER_DETAIL:"h5/order/getOrderDetail.json",THIRD_PARTY_LOGINS:"platform/web/member/thirdLogin.json",CUSTOMER_SERVE:"h5/sg/common/customService.html",SHUNGUANG_HELP:"mstore/sg/shunguangHelp.html",HELP_DETAIL:"mstore/sg/helpDetail.html",WECHAT_PAY:"h5/pay/wxpay.html",PAY_ORDER:"",GET_ALIPAY_INFO:"h5/sg/orderSign.html",UPLOAD_ASSESS_IMG:"h5/sg/upLoadCommentPicture.html",NEW_USER_CONTACT:"platform/web/member/bindAndLoginForThird.json",FIND_STATUS:"platform/web/wechat/bindState.json",CHECK_ASSESS_TEXT:"h5/sg/comment/checkSensitiveWords.json",UPLOAD_ASSESS_IMG_NEW:"h5/sg/comment/upLoadCommentPicture.json",EVALUCTION_NEW:"h5/sg/comment/commentPage.json",SUBMIT_EVALUCTION_NEW:"h5/sg/comment/submitComment.json",CRITICALSUC:"h5/sg/comment/commentSuccessPage.json",GET_IMG_CAPTCHA_NEW:"h5/sg/comment/getImgCaptcha.html",FAST_LOGIN_CAPTCHA_COMMENT:"h5/sg/comment/userCommentSendSmsCode.json",USER_COMMENT_PAGE:"h5/sg/comment/userCommentPage.json",SUBMIT_BUYER_COMMENT:"h5/sg/comment/submitUserComment.json",PRODUCT_RATED_ASSESS_LIST:"h5/sg/getCommentsByCondition.json",PRODUCT_ASSESS_MARK:"h5/sg//getProductImpressions.json",LOOK_ASSESS_INGO:"h5/sg/comment/getComment.json",ADD_ASSESS_SUBMIT:"h5/sg/comment/submitExperience.json",WINNING_LIST:"mstore/sg/game/winnerList.json",LOTTERY:"mstore/sg/game/luckDraw.json",GAME_INFORMATION:"mstore/sg/game/gameApp.json",GAME_HELLP:"mstore/sg/game/help/powerShare.json",GAME_HELLP_INIT:"mstore/sg/game/help/helpRecord.json",GAME_HAVE_PRIZE:"mstore/sg/game/addAddress.json",IS_KAIMENHONG_AVAILABLE:"mstore/sg/game/needRedirect.json",HASPROGRAM:"sg/cms/home/product/hasProgram.json",STORE_INFO:"platform/web/app/app_store_info",APP_HOME_DATA:"platform/web/app/app_home_data",GOODS_LIST:"mstore/sg/wdComManageDataInit.html",DELETE_GOODS:"mstore/sg/removeProductShelvesSubmit.html",UPDATE_GOODS:"mstore/sg/updateProductShelvesSubmit.html",UPDATE_GOODS_BATCH:"mstore/sg/updateStoreProductsBatch.html",DELETE_GOODS_BATCH:"mstore/sg/deleteStoreProductsBatch.html",SEARCH_GOODS:"mstore/sg/wdCommonSearch.html",REVENUE_INFO:"mstore/sg/local/wdRevenue.json",REVENUE_LIST:"mstore/sg/local/myRevenueList.json",MICRO_SCHOOL:"mstore/sg/microSchool.json",PRODUCTS_LIST:"mstore/sg/data/products.html",ACTIVITY_PRODUCTS_LIST:"mstore/sg/data/activityProducts.html",GET_SHOP_TEMPLATES:"mstore/sg/store/wdStyleChoice.html",SET_SHOP_TEMPLATES:"mstore/sg/store/changeStoreStyle.json",GET_SHOP_COVER:"mstore/sg/store/wdShopCover.html",SET_SHOP_COVER:"mstore/sg/store/changeShopCover.json",MY_STORE:"mstore/sg/manage.html",MY_STORE_NEW:"mstore/sg/manage.json",MY_STORE_FILTER_LIST:"myStoreFilter.json",GET_PRODUCTS_LIST:"mstore/sg/commonLoadItemNew.html",GET_FILTER_DATA:"wdMarketFiltrate.html",GET_ACCOUNT_STATE:"kjt/sg/wdWithdraw.html",GET_BANNER_THEME:"mstore/sg/activity/toActivityPage.html",GET_BANNER_DAILY:"mstore/sg/activity/dailyActivityProducts.json",GET_O2O_NAME:"h5/getO2OStoreInfo.html",IS_HAS_STORE:"platform/web/app/is_has_store",GET_STORE_INFO:"platform/web/app/app_store_info_new",GET_SELECTION_PRODUCTS:"mstore/sg/loadSelectProducts.html",GET_AD_IMAGE:"platform/web/app/app_navigate_banner",DELETE_ORDER:"h5/sg/order/deleteOrder.json",BATCH_DELETE_ORDER:"h5/sg/order/deleteAllOrders.json",GET_MERGE_IMAGE:"h5/sg/getMergeImage.html",CHECK_KJT_LOGIN:"kjt/checkLogin.html",GET_KJT_TOKEN:"kjt/genToken.html",GET_HAIRONGYI_ACTIVITYIFNO:"kjt/queryPromotionActivity.html",GET_PROMOTE_REWARD:"kjt/queryPromoteReward.html",GET_TOTAL_COMMISSION:"kjt/queryPromotionDailyReward.html",GET_REF_CODE:"kjt/queryPromoCode.html",GET_WALLET:"h5/sg/getBenefitMember.json",GET_WALLETDETAIL:"h5/sg/getBenefitDetails.json",GET_GETSGSTOREATTRIBUTE:"item/attribute/getSgStoreAttribute.json",GET_GETDETAILATTRIBUTE:"h5/sg/item/getDetailAttribute.json",GET_ISSHOWATTR:"item/attribute/isShowAttr.json",GET_CARTNUM:"h5/cart/getCartNum.json",HAS_BANK_LIST_NEW:"kjt/bank/getBankCardList.json",BANK_LIST_DETAIL_NEW:"kjt/bank/getCardDetail.json",BANK_DELETE_NEW:"kjt/bank/unBindCard.json",BANK_DELETE_CAPTCHA:"kjt/bank/getCaptchaForUnbind.json",BANK_HASBINGNUM_NEW:"kjt/bank/bankCardCount.json",SHOP_APPLY_SUCCESS:"mstore/sg/mechanism/openStoreRank.json",DATA_ANALYSIS_UPDATE:"mstore/sg/mechanism/findLastOrderProduct.json",DATA_ANALYSIS_DISTRIBUTION:"mstore/sg/mechanism/getSaleNumByCate.json",DATA_ANALYSIS_ACTIVITY:"mstore/sg/mechanism/getActionAnalysis.json",DATA_ANALYSIS_SALES:"mstore/sg/mechanism/getSaleNumByCity.json",GET_CDK_TOKEN:"h5/sg/cdk/getToken.json",GET_COUPONS_LIST:"mstore/sg/coupons/getCouponsByArea.html",NEW_GET_COUPONS_LIST:"activity/coupons/getCouponsCenter.html",NEW_GET_COUPONS_TYPE:"activity/coupons/getViewCouponCate.html",NEW_SHOP_COUPONS_LIST:"h5/sg/coupons/getCouponsByProductId.html",USE_COUPONS_LIST:"h5/sg/coupons/getProductsByCouponId.html",COUPONS_DETAIL_LIST:"h5/sg/coupons/getCouponDetail.html",PRODUCT_COUPONS_HAS:"activity/coupons/getHasCoupons.html",REMIND_COUPONS_LIST:"h5/sg/coupons/setRemind.html",GET_NEW_COUPONS:"activity/coupons/receiveCoupon.html",COUPONS_DONATION:"h5/sg/coupons/couponForTransferNew.html",COUPONS_GET_MENBERID:"mstore/sg/coupon/getMemberById.html",MY_COUPONS_LIST:"h5/sg/coupon/getCouponsByMemberId.html",MY_COUPONS_LIST_LATE:"h5/sg/coupon/getCouponsByMemberIdOneDay.html",SELECT_GOODS_COUPONS:"h5/order/getStoreCoupon.json",SELECT_GOODS_COUPONS0:"h5/coupons/selectCouponsForTailOrdersIncludeUnable.html",REDIRECT_URL:"platform/web/member/wxWebLogin.json",CHECK_LOGIN:"platform/web/member/checkLogin.json",STATE_ID:"platform/web/member/saveState.json",SELECT_GOODS_COUPONS1:"h5/sg/order/submitTailCoupon.json",SELECT_PLATFORM_COUPONS:"h5/order/getOrderCoupon.json",SELECT_COUPONS:"h5/order/choiceStoreCoupon.json",SELECT_COUPONS_PT:"h5/order/choiceOrderCoupon.json",CARD_COUPONS_USED:"h5/sg/order/checkCardValidate.html","CARD_ CODE_CHECK":"h5/sg/order/checkCaptcha.html",GIFT_CARD_COUPONS_USED:"h5/order/checkGift.json",GIFT_CARD_COUPONS_CANCLE:"h5/order/cancelGift.json",PAY_WAY:"h5/order/getCanChoiceDate.json",SUBMIT_PAY_WAY:"h5/order/updatePay.json",SUBMIT_DELIVE_WAY:"h5/order/choiceDate.json",CART_LIST:"h5/cart/list.html",GOODS_NUMBER:"h5/cart/update.json",DELETE:"h5/cart/delect.json",CONFIRM_ORDER:"h5/order/createOrder.json",UPDATE_ORDER:"h5/order/getPageInfo.json",CHECK_PAGE_INFO:"h5/sg/order/checkPageInfo.html",ZC_ORDER_CONFIRM:"activity/zhongchou/order/submitOrder",CONFIRM_ORDER_INFO:"h5/sg/order/orderInfo.html",LOCATION_CHANGE:"item/purchase/checkStock.json",PAY_CHECK_STOCK:"item/purchase/checkStockForNum.json",PRODUCTDETAIL_LODEDATA:"item/purchase/",EVALUATE_INFO:"item/evaluation/",POST_STORE_INFO:"h5/sg/shop/info/",PRODUCTDETAIL_PROMOS:"item/purchase/promos.json",ORDER_SUBMIT:"h5/order/asynSubmitOrder.json",GET_COUPONS_DETAIL:"h5/sg/coupon/toListItem.html",RECEIVE_COUPONS:"mstore/sg/coupons/getCouponForMember.html",ORDER_INVOICE:"h5/order/toInvoice.json",ORDER_INVOICE_LIST:"h5/sg/order/getMemberInvoicesListsByMemberId.html",SUBMIT_INVOICE:"h5/order/submitMemInvoice.json",SUBMIT_INVOICE_SECKILL:"pmt/sg/order/submitInvoice.html",ORDERDETAIL_SPECIFICATIONS:"item/purchase/specifications.json",GET_CONFIRM_RECEIVE_LIST:"h5/sg/order/confirmList.html",CONFIRM_RECEIVE:"h5/sg/order/confirmOrderProduct.html",GAME_INFO:"mstore/sg/game/oldGameApp.json",GAME_ADD_ADRESS:"mstore/sg/game/addAddress.html",SECKILL_LIST:"pmt/sg/seckill/getSeckillAllRedis.html",SECKILL_SERVICE_TIME:"pmt/sg/getServiceTime.html",CHECK_STOCK:"pmt/sg/item/checkStock.json",SECKILLDETAIL:"h5/sg/purchase/",SECKILLBUY:"pmt/sg/order/pageInfo.html",SECKILL_CONFIRM_ORDER_INFO:"pmt/sg/order/orderSubmit.html",UNRED_MESSAGE:"platform/web/member/unread_message.json",MSG_CENTER:"mstore/sg/msgCenter.html",READALL:"mstore/sg/readAllMessage.json",CHECKREAD:"mstore/sg/checkRead.json",PAY_KJT:"h5/pay/kjtpay/request.json",APP_VERSION:"platform/web/app/appVersion.json",BIND_MOBILE:"platform/web/member/bindMobile.json",WD_APPLY:"mstore/sg/wdApply.html",GETREGIONBYID:"mstore/sg/getRegionByParentId.html",GET_REGION_BY_ID_TYPE:"mstore/sg/getRegionByPIdAndReType.html",ORDER_200PAYCHECK:"h5/sg/orderPayCheckNew.html",PRODUCT_RATED_TOASSESS_LIST:"h5/sg/toAssessList.html",TEST_KQT_ID:200000055141,OFFICIAL_KQT_ID:200000030019,TEST_KMH_ID:758,OFFICIAL_KMH_ID:2668,TEST_WXSQ_ID:"wxb9b3b8793f9c3d7a",OFFICIAL_WXSQ_ID:"wxb03a523baf487993",TEST_WXSQ_URL:"http://mobiletest.ehaier.com:38080/v3/",OFFICIAL_WXSQ_URL:"http://m.ehaier.com/v3/",TEST_KQT_URL:"https://zmgs.kjtpay.com/mgs/common/page.htm",OFFICIAL_KQT_URL:"https://mgs.kjtpay.com/mgs/common/page.htm",TEST_TTQ_URL:"https://zzhuanle-h5.kjtpay.com/shunguang/myttj",OFFICIAL_TTQ_URL:"https://m-ally.hairongyi.com/shunguang/myttj",TEST_SZD_URL:"http://203.187.186.136:8130/haiercms/waterQuality",OFFICIAL_SZD_URL:"http://uhome.haier.net:8280/watercms/waterQuality",TEST_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5test/",OFFICIAL_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5/",TEST_BIG_DATA:"http://jxh.ehaier.com:1188/jslog",OFFICIAL_BIG_DATA:"http://crmxjz.ehaier.com:1188/jslog",TEST_CDK_URL:"http://map.mankaa.com/",OFFICIAL_CDK_URL:"http://map.rrskx.com/",CCB_FENQI:"paycenter/pay/fenqi/cost.html",CCB_FENQI_W:"paycenter/pay/request.html",UNION_PAY:"paycenter/unionpay/request.html",PAY_TYPE_LIST:"paycenter/pay/payTypeList",HB_COST:"paycenter/pay/hbfenqi/hbCost.html",HB_PAY_APP:"v2/h5/pay/app/Hb/request.json",HB_PAY_H5:"v2/h5/pay/Hb/alipay/request.html",JINBI_JILU:"h5/sg/member/appLoginRecord.json",SHARESUCCESS:"h5/sg/member/getShareSuccess.json",SHUNGUANG_VIP:"mstore/sg/credit/getUserCreditInfo.html",CREDIT_DETAIL:"mstore/sg/credit/findCreditDetail.html",DEVICE_INFO:"platform/web/app/saveDeviceToken.json",ORDER_INFO:"mstore/sg/findOrderInfoByOrderId.json",DINGZHI_ZHONGCHUANGHUI:"mstore/sg/diy/login/request.html",FIND_GAME_ID:"mstore/sg/findLatestGame.json",MISSION_DETAIL:"mstore/sg/task/findTaskDetail.html",MISSION_SHARE:"mstore/sg/task/doTask.html",CONNECTION_INDEX:"mstore/sg/store/getRelationships.html",SPREAD_CONNECTION:"mstore/sg/store/getContacts.html",PARTNER_DETAIL:"mstore/sg/store/getRelationshipsDetial.html",REPORT_DETAIL:"mstore/sg/selfBrokerageReportDetail.html",REPORT_DETAIL_PLUS:"mstore/sg/brokerageSettlement.html",BATCH_DELETE_ADDRESS:"h5/order/deleteBatchAddress.json",GET_QRCODE:"mstore/sg/task/generalQRCode.html",HOMEPAGE_TOP:"sg/cms/indexTop.json",HOMEPAGE_MIDDLE:"sg/cms/floor.json",HOMEPAGE_ISWDHOST:"sg/cms/isWdHost.json",HOMEPAGE_FALSHSALES:"sg/cms/flashSales/indexsale.json",PERSONAL_CENTER:"v3/mstore/sg/myManage.json",GET_NEW_DIAMOND:"v3/mstore/sg/wallet.json",FURNISH_TOP:"sg/cms/adornhome/topRecommendProducts.json",FURNISH_BOTTOM:"sg/cms/adornhome/lowRecommendProducts.json",SUPERMARKET_TOP:"sg/cms/supermarket/topRecommendProducts.json",SUPERMARKET_BOTTOM:"sg/cms/supermarket/lowRecommendProducts.json",MYAPPOINTMENT:"sg/cms/reserve/myReserve.json",FURNISH_BANNER:"sg/cms/adornhome/adornHomeBanner.json",SUPERMARKET_BANNER:"sg/cms/supermarket/supermarketBanner.json",ELECTRICALMALL_TOP:"sg/cms/electricalSecond.json",FAST_LOGIN_CAPTCHA:"platform/web/member/captchaForSmsLogin.json",FAST_LOGIN:"platform/web/member/smsLogin.json",ACTIVITY_ICON_TABS_NEW:"sg/cms/iconConfig.json",ACTIVITY_BG:"sg/cms/middleImageConfig.json",TOKEN_GET:"platform/web/member/queryAccessToken.json",TOKEN_LOGIN_GET:"platform/web/token/getToken.json",VIDEO_ADVERTISEMENT:"platform/web/app/getBannerMovie.html",ADORNHOME_CATES:"sg/cms/adornhome/productCates.json",SUPERMARKET_CATES:"sg/cms/supermarket/productCates.json",TO_ORDER_SUBMIT_SUCCESS:"h5/sg/order/toOrderSubmitSuccess.html",SHAER_TASK:"mstore/sg/task/findTaskList.html",SHAER_HISTORY_TASK:"mstore/sg/task/findHistoryTaskList.html",MEMER_COMPETE:"mstore/sg/credit/findStoreMemberRecord.html",HOT_WORDS:"search/hotSearch.html",DEFAULTSEARCH_WORDS:"search/defaultSearch.html",ASSOCIATIONAL_WORDS:"search/suggestJson.html",GET_MY_COMMENT_LIST:"sgcommunity/story/getMyCommentList.ajax",GET_UCTIP_LIST:"sgcommunity/uctip/getucTipList.ajax",GET_USER_ISSUE_LIST:"sgcommunity/story/getUserStoryList.ajax",GET_USER_JOINTOPIC_LIST:"sgcommunity/getUserJoinTopicList.ajax",GET_USER_CREATETOPIC_LIST:"sgcommunity/getUserCreateTopicList.ajax",GET_USER_PRAISE_LIST:"sgcommunity/story/getUserPraiseStoryList.ajax",GET_USER_COLLECTION_LIST:"sgcommunity/Circle/getUserCllectionStoryList.ajax",CIRCLE_SIGNIN:"sgcommunity/sign.ajax",CIRCLE_SIGN_DATE:"sgcommunity/getSignCalendar.ajax",CIRCLE_SIGN_CHART:"sgcommunity/getRank.ajax",CIRCLE_REPLENISH_SIGN:"sgcommunity/replenishSign.ajax",GET_WECHAT_OPENID:"sgcommunity/Circle/getOpenId.ajax",GET_WECHAT_URL:"sgcommunity/Circle/getWeChatURL.ajax",USER_SIMPLE_INFO_ONE:"sgcommunity/user/userSimpleInfo1.ajax",USER_SIMPLE_INFO_TWO:"sgcommunity/user/userSimpleInfo2.ajax",USER_SIMPLE_INFO_THREE:"sgcommunity/user/userSimpleInfo3.ajax",GETUSERMESSAGECOUNT:"sgcommunity/user/getUserMessageCount.ajax",GETBANNERLIST:"sgcommunity/Circle/getBannerList.ajax",GETHOTTOPICLIST:"sgcommunity/Circle/getHotTopicList.ajax",GETHOTSTORYLIST:"sgcommunity/Circle/getHotStoryList.ajax",GETMYTOPICLIST:"sgcommunity/Circle/getMyTopicList.ajax",EXITTOPIC:"sgcommunity/schoolstory/exitTopic.ajax",GETMYFOLLOWINGSTORYLIST:"sgcommunity/Circle/getMyFreshNewsList.ajax",GETCOURSEINFO:"sgcommunity/Course/getCourseInfo.ajax",GETUPDATELIST:"sgcommunity/schoolstory/getschoolUpdateList.ajax",GETSTORYINFO:"sgcommunity/schoolstory/getStoryInfo.ajax",GETSTORYCOMMENT:"sgcommunity/schoolstory/getSchoolComment.ajax",SUBMITCOMMENT:"sgcommunity/schoolstory/submitComment.ajax",CLASS_DELETE_COMMENT:"sgcommunity/schoolstory/deleteSchoolCommentById.ajax",SCHOOLPRAISESTORY:"sgcommunity/schoolstory/schoolPraiseStory.ajax",SCHOOLCOLLECTION:"sgcommunity/schoolstory/schoolCollectionStory.ajax",SCHOOLCOMMENTPARISE:"sgcommunity/schoolCommentParise.ajax",SCHOOLCOMMENTPARISENUM:"sgcommunity/schoolstory/getCountForSchoolPraise.ajax ",GETTOPICLIST:"sgcommunity/schoolstory/getTopicList.ajax",GET_MY_STORY_LIST:"sgcommunity/story/getMyStoryList.ajax",MYCREATE_TOPIC:"sgcommunity/getMyCreateTopicList.ajax",MYJOINED_TOPIC:"sgcommunity/getMyJoinTopicList.ajax",GET_COLLECTION_STORY_LIST:"sgcommunity/Circle/getCllectionStoryList.ajax",GET_SCHOOL_COLLECTION_STORY_LIST:"sgcommunity/schoolstory/getCllectionStoryList.ajax",GET_LIKE_STORY_LIST:"sgcommunity/story/getLikeStoryList.ajax",SUBMITREPLY:"sgcoummunity/story/submitReply.ajax",FOLLOW:"sgcommunity/user/follow.ajax",GETMYFANS:"sgcoummunity/user/getMyFans.ajax",MY_FANS:"sgcommunity/user/getMyFans.ajax",INTERESTED:"sgcommunity/user/getMyInterested.ajax",MY_FOLLOWS:"sgcommunity/user/getMyFollows.ajax",RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicList.ajax",LAUNGCH_RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicListFirstPage.ajax",JOIN_TOPIC:"sgcommunity/schoolstory/joinInTopic.ajax",PLATFORM_INFO:"sgcommunity/user/getPlatformInfo.ajax",SCHOOL_INFO:"sgcommunity/user/getSchoolInfo.ajax",OTHER_INFO:"sgcommunity/user/getOtherInfo.ajax",APPLY_TOPIC:"sgcommunity/schoolstory/entryCreateTopicAndTags.ajax",EXIST_APPLY_TOPIC:"sgcommunity/schoolstory/getEntryTopicStatus.ajax",REVIEW_APPLY_TOPIC:"sgcommunity/searchEntryTopicInfo.ajax",DELETE_APPLY_TOPIC_DRAFT:"sgcommunity/Circle/delCircleTopic.ajax",STORAGE_APPLY_DRAFT:"sgcommunity/schoolstory/entryDraftTopicAndTags.ajax",STORAGE_APPLY_REFUSE:"sgcommunity/schoolstory/UpdateTopicEntryForReback.ajax",TOPIC_TAGS:"sgcommunity/schoolstory/getStoryPraiseAndUnread.ajax",TOPIC_INFO:"sgcommunity/schoolstory/getTopicInfo.ajax",BY_CONDITION:"sgcommunity/Circle/getSensitiveByCondition.ajax",CIRCLE_STORY_INFO:"sgcommunity/Circle/getStoryInfo.ajax",UPDATE_STORY:"sgcommunity/schoolstory/updateStoryNew.ajax",LIST:"sgcommunity/schoolstory/getUpdateList.ajax",TOP_STORY:"sgcommunity/Circle/topStory.ajax",DELETESTORY:"sgcommunity/Circle/deleteStory.ajax",SUBMIT_STORY:"sgcommunity/schoolstory/insertStoryNew.ajax",IS_FOLLOWED:"sgcommunity/user/getIsFollowed.ajax",SELECT_TAGS_BY_TOPICID:"sgcommunity/schoolstory/selectTagsByTopicId.ajax",SHOP_INFO:"mstore/sg/manage.html",SHOP_INFO_LIST:"mstore/sg/commonLoadItem.html",SHOP_ADD_CART:"h5/sg/cart/add.json",HIS_SHARE:"sgcommunity/Circle/getShareList.ajax",GETLISTBYCONDITION:"sgcommunity/Circle/getListByCondition.ajax",GETUSERBYCONDITION:"sgcommunity/Circle/getUserByCondition.ajax",GETSTORYBYCONDITION:"sgcommunity/Circle/getStoryByCondition.ajax",GETTOPICBYCONDITION:"sgcommunity/Circle/getTopicByCondition.ajax",GETSTORYPRAISEANDUNREAD:"sgcommunity/schoolstory/getSchoolStoryPraiseAndUnread.ajax",ADDUSER:"sgcommunity/user/addUser.ajax",GETLISTBYCODE:"sgcommunity/Circle/getListByCode.ajax",SELECT_TAGNAME:"sgcommunity/schoolstory/selectTagsCountByTagName.ajax",PERFECT_INFORMATION:"mstore/sg/checkStoreParam.json",COMMON_COMMENT:"sgcommunity/schoolstory/getStoryComment.ajax",INSERT_COMMON_COMMENT:"sgcommunity/schoolstory/insertStoryComment.ajax",COMMENT_PRAISE:"sgcommunity/story/praiseStory.ajax",COLLECTION_TOPIC:"sgcommunity/Circle/cllectionStory.ajax",TOPIC_PRAISE:"sgcommunity/schoolstory/commentParise.ajax",NOTE_PERSON_TYPE:"sgcommunity/schoolstory/selectStory2.ajax",GET_STORY_PRAISE:"sgcommunity/Circle/getStoryPraiseAndUnread.ajax",COMMENT_STORY_PRAISE:"sgcommunity/schoolstory/getCommentPraise.ajax",DELETE_COMMON_COMMENT:"sgcommunity/schoolstory/deleteComment.ajax",SHARE:"sgcommunity/Circle/share.ajax",APPLY_LECTURER:"sgcommunity/user/applyTeacher.ajax",START_APPLY_LECTURER:"sgcommunity/user/startApplyTeacher.ajax ",ENTRYFORUM:"sgcommunity/Circle/entryForum.ajax",ENLARGE_CONTENT:"sgcommunity/getEntrycapacity.ajax",DISCUSSION_STATE:"sgcommunity/Circle/getDiscussionState.ajax",CONNECT_PROUCT:"sgcommunity/circle/getProductsDetailList.ajax",EXIT_TOPIC:"sgcommunity/schoolstory/exitTopic.ajax",CANCEL_TOP:"sgcommunity/cancelTopStory.ajax",ADD_USER:"sgcommunity/user/addUser.ajax",COURSE_INFO:"sgcommunity/notice/getNoticeCourseyByCourseId.ajax",TEACHED_COURSE:"sgcommunity/story/getTeachCourse.ajax",JOINED_COURSE:"sgcommunity/story/getJoinCourse.ajax",COURSE_ALL_MEMBER:"sgcommunity/notice/getCoursePersonByCourseId.ajax",COURSE_TEACH_LIST:"sgcommunity/notice/selectCourseForTeacher.ajax",MESSAGE_BOARD_LIST:"sgcommunity/schoolstory/getWordsListByCourseID.ajax",CLASSES_LIST:"sgcommunity/course/getCourseMaterials.ajax",CLASSES_TOPIC_LIST:"sgcommunity/schoolstory/getSchoolStoryListByCourse.ajax",GET_QUESTION_DETAILS:"sgcommunity/schoolstory/getAnswersByWordsId.ajax",QUESTION_ANSWER:"sgcommunity/schoolstory/insertWords.ajax",STUDENT_SHARE:"sgcommunity/course/getStudentsShare.ajax",TEST_LIST:"sgcommunity/Circle/startAnswerList.ajax",TEST_ESSENTIAL_INFORMATION:"sgcommunity/Circle/getCourseAnswerInfo.ajax",TEST_CONSULT:"sgcommunity/Circle/getCourseAnswerResult.ajax",REGIST_MESSAGE_TOKEN:"mstore/sg/registMessageToken.html",MESSAGE_WS_URL:"ws",BROKERAGE_SETTLEMENT:"mstore/sg/brokerageSettlement.html",FLASH_TWO:"sg/cms/flashSales/docker.json",GET_BUSINESS:"sgcommunity/schoolstory/getStoryCategory.ajax",GET_RELATEDSHOP:"sgcommunity/product/commonLoadItem.html",GET_AREADYSHOP:"sgcommunity/product/getPaidProductInfo.html",GET_HOLDPRO:"sgcommunity/product/getCollectionList.ajax",SEARCH_GOODS_CIRCLE:"sgcommunity/product/wdCommonSearch.html",SEARCH_HOLDPRO:"sgcommunity/product/searchCollectionList.ajax",CIRCLE_GET_GOLD:"sgcommunity/user/getConsumeCreditNum.ajax",CIRCLE_SHAN_LIST:"sgcommunity/getTipList.ajax",CIRCLE_SHAN_TOPIC:"sgcommunity/story/tipStory.ajax",CIRCLE_SHAN_COMMENT:"sgcommunity/story/tipComment.ajax",CIRCLE_SELECT_SHOP:"sgcommunity/user/isWd.ajax",CIRCLE_GET_CIRCLE_LIST:"sgcommunity/getUcTopicCategoryList.ajax",CIRCLE_GET_SECONDLIST:"sgcommunity/getUcTopicListByCategoryId.ajax",CIRCLE_CIRCLEPERSON:"sgcommunity/Circle/getUserListByTopicId.ajax",CIRCLE_SET_ADMIN:"sgcommunity/Circle/setManager.ajax",CIRCLE_MANAGE_USER:"sgcommunity/Circle/setIsGap.ajax",CIRCLE_DELECT_USER:"sgcommunity/schoolstory/deleteUser.ajax",CIRCLE_CANG_COMMENT:"sgcommunity/schoolstory/updateCommentDisplayStatus.ajax",CIRCLE_CANG_TOPIC:"sgcommunity/hiddenStory.ajax",
CIECLE_DEL_CANG_TOPIC:"sgcommunity/cancleHiddenStory.ajax",CIRCLE_TOP_TOPIC:"sgcommunity/setTopStory.ajax",CIRCLE_SPEAK:"sgcommunity/schoolstory/getUserIsGag.ajax",CIRCLE_AGREE:"sgcommunity/story/adoptionComments.ajax",CIRCLE_SELECT_TOPIC:"sgcommunity/Circle/choiceTopicList.ajax",CIRCLE_JING_TOPIC:"sgcommunity/setChoiceStory.ajax",CIRCLE_JING_CANCLE:"sgcommunity/cancelChoiceStory.ajax",ZC_INDEX:"activity/zhongchou/index",ZC_INDEX_ACTIVITY:"activity/zhongchou/indexZActivitys",ZC_ZSTALLS_SINGLE_PAGE:"activity/zhongchou/getZStallsSinglePage",ZC_CHECK:"activity/zhongchou/check",ZC_ORDER_COMMIT:"activity/zhongchou/order/pageInfo",ZC_ACTIVITY_SINGLE_PAGE:"activity/zhongchou/getZActivitySinglePage",ZC_COMMIT_ORDER:"activity/zhongchou/order/submitOrder",GETNAVIGATIONS:"sg/cms/navigation/getNavigations.json",COMMONLOADITEMNEW:"commonLoadItemNew.html",WDCOMMONSEARCHNEW:"wdCommonSearchNew.html",MYSTORE:"mstore/sg/myStore.json",ISREALNAMEAUTH:"kjt/bank/isRealNameAuth.json",CAPTCHAMOBILE:"platform/web/member/captchaMobile.json",REALNAMEAUTH:"kjt/bank/realNameAuth.json",REALNAMECHECK:"kjt/bank/realNameCheck.json",CHECKMOBILE:"platform/web/member/checkMobile.json",CHANGEMOBILE:"platform/web/member/changeMobile.json",NEW_SEND:"sg/cms/reserve/index.json",NEW_RES:"sg/cms/reserve/preSale.json",NEW_SLIDE:"sg/cms/secondPageBanner.json",NEW_FLASHSALE:"sg/cms/flashSales/dockersale.json",SUC_ZHONGCHOU:"activity/zhongchou/successZActivitys",GET_SMSS:"sg/cms/reserve/sendSmsCaptcha.json",SUB_PRESS:"sg/cms/reserve/reserve.json",CHECK_RES:"sg/cms/reserve/checkMemberReserve.json",GET_PRODUCTCATENAME:"item/purchase/getProductCateName.json",GET_STORE_DETAIL:"mstore/sg/mechanism/findStoreMemberDetail.json",GET_APPLY_MENGZHU:"mstore/sg/mechanism/getTeamLevelApplyStatus.json",APPLY_MENGZHU:"mstore/sg/mechanism/teamLevelApply.json",APPLY_MENGZHU_NOT:"mstore/sg/mechanism/findTeamLevelApplyDesc.json",GET_VISI_BROW_HIS:"mstore/sg/mechanism/findStoreVisitStatistic.json",GET_STORE_DATA:"mstore/sg/mechanism/findVisitStatistic.json",GET_TEAM_DATA:"mstore/sg/mechanism/statisticalTeamData.json",GET_OWNER_DATA:"mstore/sg/mechanism/statisticalPersonalData.json",GET_PARTNER_TEAM:"mstore/sg/mechanism/pagingChildren.json",TEAM_SUPERVISE:"mstore/sg/mechanism/pagingChildren.json",TEAM_USERINFO:"mstore/sg/mechanism/findStoreMemberDetail.json",ORDER_LIST:"h5/order/getOrderList.json",TEAM_USERS:"mstore/sg/mechanism/findOrderProductUserInfo.json",TEAM_MESSAGE:"mstore/sg/mechanism/findOrderProductUserInfoDetail.json",STORE_PRODUCT:"mstore/sg/mechanism/findVisitStatistic.json",REGISTERS:"mstore/sg/checkRegisterParam.json",GET_HAIER_STAFF_MSG:"kjt/bank/sendSmsForEmp.json",POST_HAIER_STAFF_MSG:"kjt/bank/employerAuth.json",REGISTERS_NEW:"platform/web/member/checkRegisterParam.json",TRUE_REALNAMEAUTH:"kjt/bank/isRealNameAuth.json",POST_USERDATAANDID:"kjt/bank/realNameAuth.json",POST_USERDATA:"kjt/bank/realNameCheckPC.json",GET_NAMEORID:"kjt/bank/realNameCheck.json",SHOP_SUCCESS_APPLY:"mstore/sg/registerNew.json",GET_PHONEAUTH:"kjt/bank/phoneAuth.json",GET_NAMEAUTH:"kjt/bank/nameAuth.json",GET_PROMOTION_CODE:"platform/web/member/findPromotionCodeByRegion.json",NEW_SHOP_STORE:"platform/web/member/registerAndStore.json",SHOP_STORE:"mstore/sg/wdApplySubmit.html",GET_BANKNAME:"kjt/bank/getBankName.json",GET_USORID:"kjt/bank/toBindCard.html",POST_CHECKS:"kjt/bank/bindCardCheck.json",GET_CODEID:"kjt/bank/captcha.json",POST_BANKDATA:"kjt/bank/bindCard.json",GET_learningHaier:"sg/h5/web/auth/mobile/learningHaier.json",GET_homeking:"sg/h5/web/auth/mobile/homeking.json",WHITE_SHOWS_APPLY:"v3/kjt/applyForOpen.json",WHITE_SHOWS_QUERY_AVALIAMT:"v3/kjt/queryAvaliAmt.json",WHITE_SHOWS_PAY:"v3/kjt/payApply.json",WHITE_SHOWS_QUERY_STATUS:"v3/kjt/queryIousStatus.json",WHITE_SHOWS_COST:"v3/kjt/iouc/cost.json",GET_STORE_MSG:"item/home/point.json",POST_PRIVILEGE_CODE:"h5/order/checkCodeAndGift.json",IF_CIRCLEPAGE:"/circle/getSqzbLink.ajax",LIFE_SERVICES:"sg/cms/home/life.json",SMART_HOME:"sg/cms/home/smart.json",HOME_MAKE:"sg/cms/home/diy.json",NEW_HOME_BANNER:"sg/cms/home/banner.json",NEW_HOME_TOPIC:"sg/cms/home/storys.json",ACT_LIST:"sg/cms/home/designer/list.json",FULL_SOLUTION:"sg/cms/home/programs.json",FILTER_TAG:"sg/cms/home/case/label.json",FILTER_PRODUCTLIST:"sg/cms/home/case/list.json",HOME_DETAIL:"sg/cms/home/case/details.json",HOUSE_YUYUE:"sg/cms/home/design.json",HOUSE_LISTDETAIL:"sg/cms/home/programs/list.json",HOUSE_FROM_PRODETAIL:"sg/cms/home/programs/listByProductId.json",ITSOLU_DETAIL:"sg/cms/home/programs/details.json",ITSOLU_PRODUCTLIST:"sg/cms/home/programs/details/products.json",ITSOLU_PRODUCTLIST:"sg/cms/home/programs/details/sequenceProducts.json",DESIGN_DETAIL:"sg/cms/home/designer/details.json",DESIGN_SOLULIST:"sg/cms/home/designer/case/list.json",EXPORT_DETAIL:"sg/cms/home/experts.json",RECENTLY_WORK:"sg/cms/home/nearby.json",TEST_STORE_DETAIL:"sg/cms/home/nearbyDetail.json",NEARBY_TYPES:"sg/cms/home/nearby/types.json",NEARBY_LIST:"sg/cms/home/nearby/list.json",SMART_SCENES:"sg/cms/home/smart/scenes.json",SMART_SPACE:"sg/cms/home/smart/space.json",GET_SERVICE_PRO:"item/purchase/getDes.json",GET_GIFTS:"h5/order/getGiftBag.json",PRESERVATION_GIFTS:"h5/order/choiceGiftBag.json"},u=[{username:"message_user_ro",password:"nYXPFND2"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"}],g=[{name:"LOADMOREPRODUCTS_INIT",value:"SEARCH_SERVER_DATA"},{name:"GET_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SHOP_INFO_LIST",value:"SEARCH_SERVER_DATA"},{name:"ACTIVITY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"GET_FILTER_DATA",value:"SEARCH_SERVER_DATA"},{name:"SEARCHGOODS_INIT",value:"SEARCH_SERVER_DATA"},{name:"SEARCH_GOODS",value:"SEARCH_SERVER_DATA"},{name:"HOT_WORDS",value:"SEARCH_SERVER_DATA"},{name:"DEFAULTSEARCH_WORDS",value:"SEARCH_SERVER_DATA"},{name:"ASSOCIATIONAL_WORDS",value:"SEARCH_SERVER_DATA"},{name:"PRODUCTDETAIL_LODEDATA",value:"ITEM_SERVER_DATA_NEW"},{name:"PRODUCTDETAIL_PROMOS",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_PRODUCTCATENAME",value:"ITEM_SERVER_DATA_NEW"},{name:"ORDERDETAIL_SPECIFICATIONS",value:"ITEM_SERVER_DATA_NEW"},{name:"SECKILLDETAIL",value:"ITEM_SERVER_DATA"},{name:"CHECK_NOTICE",value:"ITEM_SERVER_DATA"},{name:"START_NOTICE",value:"ITEM_SERVER_DATA"},{name:"ARRIVE_NOTICE",value:"ITEM_SERVER_DATA"},{name:"GET_O2O_NAME",value:"ITEM_SERVER_DATA"},{name:"GET_MERGE_IMAGE",value:"ITEM_SERVER_DATA"},{name:"NEW_SHOP_COUPONS_LIST",value:"ITEM_SERVER_DATA"},{name:"PRODUCT_COUPONS_HAS",value:"ITEM_SERVER_DATA"},{name:"POST_STORE_INFO",value:"ITEM_SERVER_DATA"},{name:"LOCATION_CHANGE",value:"ITEM_SERVER_DATA_NEW"},{name:"EVALUATE_INFO",value:"ITEM_SERVER_DATA_NEW"},{name:"WDCOMMONSEARCHNEW",value:"SEARCH_SERVER_DATA"},{name:"COMMONLOADITEMNEW",value:"SEARCH_SERVER_DATA"},{name:"FAXIAN_INIT",value:"SEARCH_SERVER_DATA"},{name:"ASYNC_ACCESS_PRICE",value:"SEARCH_SERVER_DATA"},{name:"SPECIALY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SECONDLEVEL_PRODUCTLIST",value:"SEARCH_SERVER_DATA"},{name:"ADD_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"CANCEL_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"GET_GETSGSTOREATTRIBUTE",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_GETDETAILATTRIBUTE",value:"ITEM_SERVER_DATA"},{name:"GET_ISSHOWATTR",value:"ITEM_SERVER_DATA_NEW"},{name:"PAY_CHECK_STOCK",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_STORE_MSG",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_SERVICE_PRO",value:"ITEM_SERVER_DATA_NEW"}];this.getUrl=function(t){for(var o=e[2],s=o.SERVER_DATA,i=0;i<g.length;i++)if(t===g[i].name){o[g[i].value]&&(s=o[g[i].value]);break}return s+p[t]},this.getLiveingUrl=function(){return d},this.getNewUrl=function(e){return o+p[e]},this.getTopUrl=function(e){return l+p[e]},this.getWSUrl=function(e){return i+p[e]},this.getCPUrl=function(e){return p[r+e]},this.getMQAuth=function(){return u[2]},this.getAMAPUrl=function(){return e[2].AMAP_SERVER},this.getFakeUrl=function(e){return"./data/"+p[e]},this.getHead=function(){return t},this.getHeadV2=function(){return s},this.getZCUrl=function(e){return a+p[e]},this.getThirdUrl=function(e){return a+e},this.getCcbUrl=function(e){return n+p[e]},this.getPayCenter=function(e){return c+p[e]},this.getWhiteShowsUrl=function(e){return n+p[e]},this.getEnviroment=function(){return 0},this.getSharePicHeader=function(){return e[2].SHAREPICHEADER},this.getShareLinkHeader=function(){return e[2].SHARELINKHEADER},this.getServiceV2=function(t){return e[2].SERVER_DATA_V2+p[t]},this.getGameUrl=function(t){return e[2].SERVER_DATA_GAME+p[t]}}]),APP.controller("bindingBankControl",["UrlService","InAppBrowserService","$ionicPopup","trueAuthenticationService","$ionicHistory","$timeout","$scope","$state","bindingBankService","$stateParams","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d){n.isComplete=!1,n.isPrompts=!1,n.isHasKey=!1,n.isHasVal=!1,n.isPhoneNum=!1,n.isType=!1,n.isOkType=!1,n.isEffective=!1,n.agreement=!1,n.isOther=!1,n.isAccord=!1,n.isReplaces=!1,n.isInputs=!1,n.isIdNumber=!1,n.isShows=!1,n.isOKTel=!1,n.isTrueMsg=!1,n.isNotAuthentication=!1,n.phoneNumber="",n.IDNumber="",n.userName="",n.bankNo="",n.isBankType=!1,n.isBankNum=!0,n.hasChooseBankCode="",n.hasChooseBank="",n.slice=window.slice,n.selectionStart=window.selectionStart,n.selectionEnd=window.selectionEnd,n.$on("$ionicView.beforeEnter",function(e,t){d.$on("haveChooseBank",function(e,t,o,s){n.hasChooseBank=s,n.hasChooseBankCode=o}),n.obj.bankNames=n.hasChooseBank,"back"!=t.direction&&(n.isOkType=!1,n.isEffective=!1,n.isShows=!1,n.isInputs=!1,n.isIdNumber=!1,n.isReplaces=!1,n.isAccord=!1,n.isOther=!1,n.isBankType=!1,n.isComplete=!1,n.asyncs=!1,n.isType=!1,n.isOKTel=!1,n.isBankNum=!0,n.obj.isMyBank="",n.obj.isMyName="",n.obj.isMyIdNumber="",n.obj.phoneNumber="",n.hasChooseBank="",n.obj.bankNames="",n.init())}),n.goBack=function(){i.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(n.paddingtopClass={"margin-top":"16px"},n.paddingtopClasscontent={top:"60px"}):(n.paddingtopClass={"margin-top":"0px"},n.paddingtopClasscontent={top:"44px"}),n.toRules=function(o,s){-1!=navigator.userAgent.indexOf("iPhone")?t.open(e.getHead()+"mstore/sg/helpDetail.html?id="+o,s):r.go("helpDetail",{helpId:o,content:s})},n.obj={isMyName:"",isMyIdNumber:"",isMyBank:"",phoneNumber:"",bankNames:"",agreement:!1},n.init=function(){s.doInit().success(function(e){e.success?(n.isNotAuthentication=e.data.isAuth,n.isNotAuthentication?(n.isTrueMsg=!1,n.isInputs||c.getUsOrId().success(function(e){e.success?(n.IDNumber=e.data.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,s){for(var i="";i.length<o.length;)i+="*";return t+i+s}),n.userName=e.data.realName.replace(/.{1}/,"*"),n.name=e.data.realName,n.ids=e.data.identityNo):(n.message=e.message,n.isAccord=!0)})):n.isTrueMsg=!0):(n.message=e.message,n.isRetry=!0)})},n.goTrueAutThentication=function(){n.isTrueMsg=!1,r.go("trueAuthentication",{type:5})},n.isNoTrue=function(){i.goBack(),n.isTrueMsg=!1},n.isAgreement=function(){n.obj.agreement=!n.obj.agreement},n.retry=function(){n.isOther=!1},n.isClear=function(){n.obj.isMyBank="",n.hasChooseBankCode="",n.hasChooseBank="",n.obj.phoneNumber="",n.isPhoneNum=!1},n.isClearVal=function(){n.obj.phoneNumber=""},n.isMoreInfo=function(){n.isOther=!0},n.phoneClose=function(){n.isAccord=!1},n.isRepl=function(){n.isReplaces=!0},n.replaceInfoOk=function(){n.isInputs=!0,n.isIdNumber=!0,n.isReplaces=!1,n.isType=!1,n.isOkType=!1,n.isOKTel=!1,n.isShows=!0,n.obj.isMyBank="",n.obj.phoneNumber="",n.hasChooseBankCode="",n.hasChooseBank="",n.isPhoneNum=!1,n.isBankNum=!1},n.replaceInfoClose=function(){n.isReplaces=!1,n.isInputs=!1,n.isIdNumber=!1,n.isBankNum=!0},n.mobileFun=function(){d.globalConstant.mobileNumberRegExp.test(n.obj.phoneNumber)?(n.isOKTel=!1,n.obj.agreement||""==n.userName||""==n.IDNumber?n.isComplete=!1:n.isComplete=!0):(n.isComplete=!1,n.obj.phoneNumber.length>=11?n.isOKTel=!0:n.isOKTel=!1)},n.logicFn=function(){9==n.obj.isMyBank.length?(n.bankCodes=n.obj.isMyBank.replace(/\s*/g,""),c.getBankName(n.bankCodes).success(function(e){null==e.data.bankNames?(n.isOkType=!1,n.isType=!0,n.bankNo=n.hasChooseBankCode,n.obj.bankNames=n.hasChooseBank,n.bankPhone=""):1==e.data.bankNames.cardTypeCode?(n.bankPhone=e.data.bankPhone,n.bankNo=e.data.bankNames.bankNo,n.isOkType=!0,n.isType=!1,n.isBankType=!1,n.obj.bankNames=e.data.bankNames.bankName):(n.isPhoneNum=!1,n.isBankType=!0,n.isComplete=!1)})):n.obj.isMyBank.length<9&&(n.isOkType=!1,n.isType=!1),!n.isOkType||23!=n.obj.isMyBank.length&&19!=n.obj.isMyBank.length?(n.isComplete=!1,n.isOKTel=!1,n.isOkType&&(n.isPhoneNum=!1),n.isType&&n.mobileFun()):(n.isEffective=!1,n.isEffectiveOK=!1,n.isPhoneNum=!0,n.mobileFun())},n.async=function(){""!=n.obj.isMyName&&n.obj.isMyIdNumber.length<19&&s.getUsNameOrId(n.obj.isMyName,n.obj.isMyIdNumber).success(function(e){e.data?(n.isBankNum=!0,n.info=e.message,n.isEffective=!0):(n.info=e.message,n.isEffective=!0,n.isBankNum=!1)})};n.$watch("obj",function(){""==n.obj.bankNames||23!=n.obj.isMyBank.length&&19!=n.obj.isMyBank.length?n.isPhoneNum=!1:n.isPhoneNum=!0,n.isShows?/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,15}$/.test(n.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(n.obj.isMyIdNumber)?(n.asyncs||s.getUsNameOrId(n.obj.isMyName,n.obj.isMyIdNumber).success(function(e){n.asyncs=!0,e.data?(n.info=e.message,n.isEffective=!0,n.isBankNum=!0):(n.info=e.message,n.isEffective=!0,n.isBankNum=!1)}),n.logicFn()):(n.isComplete=!1,n.isEffective=!1,n.asyncs=!1,n.isBankNum=!1):n.logicFn(),""!=n.obj.isMyBank?n.isHasKey=!0:n.isHasKey=!1,""!=n.obj.phoneNumber?n.isHasVal=!0:n.isHasVal=!1},!0);n.join=window.join,n.keyFun=function(e){var t=document.getElementById("keyRoom"),o=t.value;if(8==(e||event).keyCode){if(o){for(var s=0;s<o.length;s++)var i=o.replace(/\s$/g,"");t.value=i}}else{for(var s=0;s<o.length;s++){var a=o.split("");(s+1)%5==0&&a.splice(s,0," ")}t.value=a.join("")}},n.commonFun=function(e,t,o,s){c.bankCheck(e,t,o,s).success(function(i){i.success?i.data.isThrough&&(n.isAccord=!1,c.VerificationCode(s).success(function(i){n.message=i.message,i.success?(r.go("verificationCode",{ownerName:e,identityNo:t,cardNo:o,mobile:s,bankNo:n.bankNo,phoneNumber:n.bankPhone}),n.isAccord=!1):n.isAccord=!0})):(n.message=i.message,n.isAccord=!0)})},n.goAuthentication=function(e,t,o,s,i,a){n.bankCodes=n.obj.isMyBank.replace(/\s*/g,""),n.obj.phoneNumber=n.obj.phoneNumber.replace(/\s*/g,""),n.isShows?n.commonFun(n.obj.isMyName,n.obj.isMyIdNumber,n.bankCodes,n.obj.phoneNumber):n.commonFun(n.name,n.ids,n.bankCodes,n.obj.phoneNumber)}}]),APP.service("bindingBankService",["$http","UrlService",function(e,t){this.doInit=function(o,s){var i={userName:o,password:s};return e.get(t.getUrl("HOME_INIT"),i)},this.getBankName=function(o){var s={cardNo:o};return e.get(t.getUrl("GET_BANKNAME"),s)},this.getUsOrId=function(){return e.get(t.getUrl("GET_USORID"))},this.bankCheck=function(o,s,i,a){var n={ownerName:o,identityNo:s,cardNo:i,mobile:a};return e({method:"POST",url:t.getUrl("POST_CHECKS"),params:n})},this.VerificationCode=function(o){var s={mobile:o};return e.get(t.getUrl("GET_CODEID"),s)}}]),APP.controller("verificationCodeControl",["$ionicHistory","PopupService","$interval","$timeout","$scope","$state","verificationCodeService","$stateParams",function(e,t,o,s,i,a,n,r){i.isComplete=!1,i.captchaFlag=!0,i.isOK=!1,i.isBindBackOK=!1,i.paracont="重新获取",i.isAccord=!1,i.obj={numbers:""},i.name=r.ownerName,i.idNum=r.identityNo,i.bankCode=r.cardNo,i.mobile=r.mobile,i.phoneNum=r.mobile.replace(/^(\d{3})\d{4}(\d{4})$/,"$1****$2"),i.bankNo=r.bankNo,i.phoneNumber=r.phoneNumber;var c,l=void 0;i.goBack=function(){e.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.commonFnCode=function(){c=60,l=o(function(){c<=0?(o.cancel(l),l=void 0,c=60,i.paracont="重新获取",i.captchaFlag=!0):(i.paracont=c-1+"秒后可重发",i.captchaFlag=!1,c--)},1e3,100)},i.init=function(){n.VerificationCode(i.mobile).success(function(e){e.success?i.commonFnCode():t.showToast("获取验证码失败！")})},i.$on("$ionicView.beforeEnter",function(){i.captchaFlag=!0,c=60,i.paracont="重新获取",o.cancel(l),i.commonFnCode(),i.isAccord=!1,i.isOK=!1,i.isBindBackOK=!1,i.obj.numbers=""}),i.goAuthentication=function(){n.bankCheckOK(i.name,i.bankCode,i.bankNo,i.mobile,i.obj.numbers).success(function(e){i.message=e.message,e.success?(i.isBindBackOK=!0,i.isOK=!1,s(function(){i.isBindBackOK=!1,a.go("personnalCenter")},1e3)):(i.isBindBackOK=!1,i.isOK=!0)})},i.phoneClose=function(){i.isAccord=!1},i.Close=function(){i.isOK=!1},i.isReceived=function(){i.isAccord=!0},i.againGet=function(){i.captchaFlag&&i.init()},i.myFun=function(){/^\d{6}$/.test(i.obj.numbers)?i.isComplete=!0:i.isComplete=!1}}]),APP.service("verificationCodeService",["$http","UrlService",function(e,t){this.VerificationCode=function(o){var s={mobile:o};return e.get(t.getUrl("GET_CODEID"),s)},this.bankCheckOK=function(o,s,i,a,n){var r={ownerName:o,cardNo:s,bankNo:i,mobile:a,captcha:n};return e.post(t.getUrl("POST_BANKDATA")+"?ownerName="+r.ownerName+"&cardNo="+r.cardNo+"&bankNo="+r.bankNo+"&mobile="+r.mobile+"&captcha="+r.captcha)}}]),APP.controller("CartController",["$rootScope","HomePageService","$scope","$stateParams","CartService","$state","$ionicPopup","LoginService","$timeout","$cookies","PopupService","ProductDetailService","$ionicScrollDelegate","GetCouponsService","$location","UserService","$localstorage","IMService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){o.remindSuccess=!1;var S=1;o.getcoupons=!0,o.hasMoreCoupons=!1;var I=[];o.all={isAllChecked:!0},o.orderInitParams=null;var w,y;o.logConpous=function(){p.getShopCoupons(I[0],I[1],I[2],I[3],S,5,I[4]).success(function(e,t,s,i){e.success?1==S?(S++,o.shopCoupons=e.data,u.$getByHandle("mainScroll").scrollTop(),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(S++,o.shopCoupons=o.shopCoupons.concat(e.data),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)})},o.closeCoupons=function(){S=1,I=[],o.getcoupons=!1},o.openCoupons=function(e,t,s,i,a){I[0]=e,I[1]=t,I[2]=s,I[3]=i,I[4]=a,o.logConpous(),o.getcoupons=!0},o.getNewCoupons=function(s){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?a.go("login"):g.doGetNewCoupons(s).success(function(t){t.success?(e.couponXyzType=!0,u.scrollTop(),S=1,o.logConpous()):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(){o.tabNav="cart",o.isShow=!1,o.noGoods=!1,o.cartMessage={},o.cartSelectedMode=[],o.htmlContent=s.content,o.title=s.title,t.isWdHost().success(function(t){e.isWdHost=t.data.isHost}),p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)}),i.loadCartMessage().success(function(e,t,s,i){o.isShow=!1,0==e.totalCount?o.noGoods=!0:(o.cartMessage=e,o.cartSubTitle="总共"+o.cartMessage.totalCount+"件商品",o.noGoods=!1,o.isShow=!0,o.checkAll(!0))}).error(function(){o.isShow=!1,o.showPopup("查询购物车失败")}),o.all.isAllChecked=!1},o.$on("$ionicView.beforeEnter",function(){o.remindSuccess=!1,o.getcoupons=!1,o.hasMoreCoupons=!1,o.isBuyerForCart=r.getRole(),o.init(),o.footerSubmit={position:"fixed",bottom:"49px"},w=window.navigator.userAgent.toLowerCase(),y="micromessenger"==w.match(/MicroMessenger/i)}),o.htmlContent=s.content,o.title=s.title,o.all.isAllChecked=!1,o.totalMoney=0,o.saveSelectedIndex=function(e,t){var s=o.cartSelectedMode.indexOf(e);t?s<0&&o.cartSelectedMode.push(e):o.cartSelectedMode.splice(s,1)},o.selectedChanged=function(e,t,s){o.saveSelectedIndex(s,t),o.all.isAllChecked=o.cartSelectedMode.length==o.cartMessage.data.carts.length,o.accountTotalMoney()},o.checkAll=function(e){o.all.isAllChecked=e,angular.forEach(o.cartMessage.data.carts,function(t,s){t.isChecked=e,o.saveSelectedIndex(s,e)}),o.accountTotalMoney()},o.deleteProduct=function(e){if(o.cartSelectedMode.splice(e,1),null==o.cartMessage.data.carts[e].skku||"null"==o.cartMessage.data.carts[e].skku)var t=o.cartMessage.data.carts[e].sku;else var t=o.cartMessage.data.carts[e].skku;i.deleteProduct(t,o.cartMessage.data.carts[e].productId).success(function(e,t,s,i){1==e.success?(o.init(),void 0!=o.cartMessage.data&&o.accountTotalMoney()):alert("删除商品失败")})};var T=!1;o.nus=function(t){if(!T)if(o.cartMessage.data.carts[t].number<=1)o.cartMessage.data.carts[t].number=1;else{if(T=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var s=o.cartMessage.data.carts[t].sku;else var s=o.cartMessage.data.carts[t].skku;i.nusplus(s,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number-1).success(function(s,i,a,n){o.cartMessage.data.carts[t].number-=1,o.accountTotalMoney(),T=!1,p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}};var C=!1;o.plus=function(t){if(!C){if(C=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var s=o.cartMessage.data.carts[t].sku;else var s=o.cartMessage.data.carts[t].skku;i.nusplus(s,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number+1).success(function(s,a,n,r){if(0==s.success){var c=s.message;if(null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var l=o.cartMessage.data.carts[t].sku;else var l=o.cartMessage.data.carts[t].skku;i.nusplus(l,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number).success(function(e){return d.showToast(c),C=!1,!1})}else o.cartMessage.data.carts[t].number+=1,o.accountTotalMoney(),C=!1;p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}},o.accountTotalMoney=function(){var e=0;angular.forEach(o.cartMessage.data.carts,function(t,s){o.cartSelectedMode.indexOf(s)>-1&&(e+=t.number*t.nowPrice,o.cartSelectedMode.sort(function(e,t){return e>t?1:-1}))}),o.totalMoney=e},o.settlement=function(){if(-1==e.isWdHost)return void a.go("login");if(o.cartSelectedMode.length>0){for(var t=[],s=[],n=[],r=[],c="",d="",p="",u=0;u<o.cartSelectedMode.length;u++)t[u]=o.cartMessage.data.carts[o.cartSelectedMode[u]];angular.forEach(t,function(e,t){s[t]=e.productId,n[t]=e.number,r[t]=e.productName,null==e.attrValueNames||"null"==e.attrValueNames?c+="null;":c+=e.attrValueNames+";",null==e.skku||"null"==e.skku?d+="null;":d+=e.skku+";",null==e.o2oAttrId||"null"==e.o2oAttrId?p+="null;":p+=e.o2oAttrId+";"}),c=c.substring(0,c.length-1),d=d.substring(0,d.length-1),p=p.substring(0,p.length-1),s=s.join(","),n=n.join(","),r=r.join(","),i.checkPageInfo(s,n).success(function(e){if(0==e.success)o.showPopup(e.message);else{for(var t=[],r=0;r<s.split(",").length;r++)"null"!=c.split(";")[r]?t.push({proId:s.split(",")[r],num:n.split(",")[r],sku:d.split(";")[r],name:c.split(";")[r]}):t.push({proId:s.split(",")[r],num:n.split(",")[r]});o.orderInitParams={proList:t,street:""},i.settlement(o.orderInitParams).success(function(e,t,s,i){if(0==e.success)o.showPopup(e.message);else if(1==e.success&&null!=e.data){o.cartSelectedMode=[];var n=new Date;n.setDate(n.getDate()+1),l.put("is_book","",{expires:n,path:"/"}),a.go("orderConfirm",{orderInitParams:JSON.stringify(o.orderInitParams)})}else o.showPopup("结算失败")})}})}else o.showPopup("您未选择任何商品")},o.showPopup=function(e){var t=n.show({template:e});c(function(){t.close()},1e3)}}]),APP.service("CartService",["$http","UrlService",function(e,t){this.loadCartMessage=function(){return e.get(t.getUrl("CART_LIST"))},this.getNumber=function(){return e.get(t.getUrl("SPECIALTY_CART_NUM"))},this.nusplus=function(o,s,i){var a={sku:o,productId:s,number:i,noLoading:!0};return e.get(t.getUrl("GOODS_NUMBER"),a)},this.deleteProduct=function(o,s){var i={sku:o,productId:s};return e.get(t.getUrl("DELETE"),i)},this.settlement=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.checkPageInfo=function(o,s){var i={productIds:o,productNames:s};return e.get(t.getUrl("CHECK_PAGE_INFO"),i)},this.check_login=function(){return e.get(t.getUrl("CHECK_LOGIN"))},this.state_id=function(o){var s={data:o};return e.get(t.getUrl("STATE_ID"),s)}}]),APP.controller("CommonLocationController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CommonAddressService","GoodsService","$timeout","PopupService",function(e,t,o,s,i,a,n,r,c){e.addressTitle=o.title,e.data=o.data,e.flag=o.flag,e.defaultValue=o.defaultValue,e.level=o.level;var l={};e.init=function(){e.addressTitle=o.title,o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.level=o.level,o.data?e.data=JSON.parse(o.data):s.getLocationList(0,0).success(function(t){e.data=t.data}).error(function(e){c.showToast("获取地址信息失败！")})};var d=!1;e.goSelect=ionic.Utils.debounce(function(){var o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.level>-4)s.getLocationList(o.value,o.grade).success(function(t){e.data=t.data,i.go("commonLocation",{defaultValue:JSON.stringify(e.defaultValue),data:JSON.stringify(e.data),flag:e.flag,level:e.level})}).error(function(e){c.showToast("获取地址信息失败！")});else{if(d)return;r(function(){d=!1},1500),t.$broadcast(e.flag,e.defaultValue),d=!0,e.$ionicGoBack(e.level)}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){l=a.getAddressInfo();var o=l.regionName+"/"+l.streetName;n.addAddress(l.provinceId,l.cityId,l.areaId,o,l.streetId).success(function(){var o={"text-1":l.provinceName,"text-2":l.cityName,"text-3":l.regionName,"text-4":l.streetName,"value-1":l.provinceId,"value-2":l.cityId,"value-3":l.areaId,"value-4":l.streetId};t.$broadcast(e.flag,o),e.$ionicGoBack(e.level-1)})}},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonLocationService",["$http","UrlService","$timeout",function(e,t,o){this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)}}]),APP.controller("CommonPageViewController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init(),e.htmlContent=t.content})}]),APP.controller("invoiceHtmlController",["$scope","$stateParams","$sce",function(e,t,o){e.deviceHeight=window.innerHeight,e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc),e.init=function(){e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc)},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("CommonSelectController",["$http","CommonLocationService","$scope","$rootScope","$stateParams","$state","CacheService","PopupService",function(e,t,o,s,i,a,n,r){o.data=i.data,o.flag=i.flag,o.defaultValue=i.defaultValue,o.level=i.level,o.title=i.title,o.init=function(){o.addressMessage=n.get("addressInfo"),i.defaultValue?o.defaultValue=JSON.parse(i.defaultValue):o.defaultValue={},o.level=i.level,i.data?o.data=JSON.parse(i.data):e.get("data/region.json").success(function(e){o.data=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.goSelect=function(i,n){o.level=o.level-1,"全部"==n.text&&"全国"==n.text||(o.defaultValue["text"+o.level]=n.text,o.defaultValue["value"+o.level]=n.value),o.level>-2?e.get("data/region.json").success(function(e){-1==o.level?o.data=e.data[i].children:o.data=o.data[i].children,a.go("commonSelect",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")}):o.level>-4?(ah=-1*o.level,t.getLocationList(n.value,ah).success(function(e){o.data=e.data,a.go("commonLocation",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")})):(s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level))},o.doSelectAll=function(){o.level?o.level:o.defaultValue={"text-1":"","text-2":"","text-3":"","value-1":"","value-2":"","value-3":""},s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level-1)},o.doSelectDingWei=function(){o.defaultValue={"text-1":o.addressMessage.provinceName,"text-2":o.addressMessage.cityName,"text-3":o.addressMessage.regionName,"text-4":o.addressMessage.streetName,"value-1":o.addressMessage.provinceId,"value-2":o.addressMessage.cityId,"value-3":o.addressMessage.areaId,"value-4":o.addressMessage.streetId},s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){o.init()})}]),APP.directive("titleType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="tType"/>',link:function(e,t,o){var s=o.titleType;e.tType="templates/common/TitleTemplate"+s+".html"}}}]),APP.directive("listType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="lType"/>',link:function(e,t,o){var s=o.listType;e.lType="templates/common/ListTemplate"+s+".html"}}}]),APP.controller("CommonUnionController",["$scope","$rootScope","$stateParams","CommonUnionService","$timeout","$ionicLoading",function(e,t,o,s,i,a){e.dataUnion=[],e.flag=o.flag,e.defaultValue=o.defaultValue,e.selectSigal=o.data,e.init=function(){o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.dataUnion=[],s.getUnionList().success(function(o){for(var s=void 0,i=0,a=o.data.length;i<a;i++)e.selectSigal==o.data[i].dictionary_display_value&&(s=i),e.dataUnion.push({key:o.data[i].dictionary_db_value,text:o.data[i].dictionary_display_value,imgSelect:t.imgBaseURL+"img/ic_select.png",imgUnselect:t.imgBaseURL+"img/ic_check.png",isSelect:!1});s&&(e.dataUnion[s].isSelect=!0)})},e.goSelect=function(o,s){e.defaultValue.text=o.text,e.defaultValue.value=o.key,angular.forEach(e.dataUnion,function(e){e.isSelect=!1}),e.dataUnion[s].isSelect=!0,t.$broadcast(e.flag,e.defaultValue),e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonUnionService",["$http","UrlService",function(e,t){this.getUnionList=function(){return e.get(t.getUrl("COMMON_UNION"))}}]),APP.service("GetStatisticInfoService",["LoginService","$rootScope","$http","UserService","$localstorage","UrlService",function(e,t,o,s,i,a){function n(e){function t(e){return e>9?e:"0"+e}if(e){var o=new Date;o.setTime(e);var s=o.getFullYear(),i=o.getMonth()+1,a=o.getDate(),n=o.getHours(),r=o.getMinutes(),c=o.getSeconds();return s+"-"+t(i)+"-"+t(a)+" "+t(n)+":"+t(r)+":"+t(c)}}function r(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}function c(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}this.GetUserInfo=function(o,l,d){function p(){t.globalConstant.positionStatus?(u=t.globalConstant.lon,g=t.globalConstant.lat):setTimeout(function(){p()},5e3)}var u,g,m,f=window.location.origin,h=f+"/#/"+o,v=f+"/#/"+l,$=document.getElementsByTagName("title")[0].innerHTML,S="",I=window.innerWidth+"*"+window.innerHeight,w=n((new Date).getTime()),y="",T=navigator.language,C=navigator.platform||"",b=s.getUser().mid||"",A=i.get("IsThirdLoginType")||"",P="",x="";m=e.getRole()>0?1:0;var L="",D=t.xnFromState.url.split("/:");if(D.length>0){for(var N=1;N<D.length;N++)L+="/"+t.xnFromParams[D[N]];v=f+"/www/index.html#/"+t.xnFromState.name+L}var _="",O=t.xnToState.url.split("/:");if(O.length>0){for(var N=1;N<O.length;N++)_+="/"+t.xnToParams[O[N]];h=f+"/www/index.html#/"+t.xnToState.name+_}p(),P=-1!=location.href.indexOf("?fs")?"fromShare":"",c("visitorId")?y=c("visitorId"):(y=this.generateUUID(),r("visitorId",y));var k="",E=""
;d.storeId&&(k=d.storeId),d.productId&&(E=d.productId);var U=navigator.userAgent,M=U.indexOf("Android")>-1||U.indexOf("Adr")>-1;S=!U.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?M?"android":"pc":"ios","micromessenger"==U.toLowerCase().match(/MicroMessenger/i)?x="wx":"weibo"==U.toLowerCase().match(/WeiBo/i)?x="wb":"qq"==U.toLowerCase().match(/QQ/i)&&(x="qq");var R=["sg_h5",S,w,y,b,A,k,E,"",v,h,$,I,"",T,C,"",P,x,m],B=R.join("|");B=B.replace(/,/g,"");var H=a.getCPUrl("BIG_DATA")+"?data="+encodeURIComponent(B);jQuery.getScript(H,function(e){})},this.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}}]),APP.directive("errSrc",[function(){return{link:function(e,t,o){t.bind("error",function(){o.$set("src",o.errSrc?o.errSrc:"http://cdn09.ehaier.com/shunguang/H5/www/img/errPlaceholder.png")})}}}]);var JSON;JSON||(JSON={}),function(){function str(e,t){var o,s,i,a,n,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,o=0;o<a;o+=1)n[o]=str(o,c)||"null";return i=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+r+"]":"["+n.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(a=rep.length,o=0;o<a;o+=1)"string"==typeof rep[o]&&(s=rep[o],(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i));else for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i);return i=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+r+"}":"{"+n.join(",")+"}",gap=r,i}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var s;if(gap="",indent="","number"==typeof o)for(s=0;s<o;s+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,s,i=e[t];if(i&&"object"==typeof i)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s=walk(i,o),void 0!==s?i[o]=s:delete i[o]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},s=function(){};s.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var s=this._listeners[e];-1===o.arrIndexOf(s,t)&&s.push(t)},s.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var s=this._listeners[e],i=o.arrIndexOf(s,t);return-1!==i?void(s.length>1?this._listeners[e]=s.slice(0,i).concat(s.slice(i+1)):delete this._listeners[e]):void 0}},s.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var s=0;s<this._listeners[t].length;s++)this._listeners[t][s].apply(this,o)};var i=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var a=function(e){var t=this;t._events=e||[],t._listeners={}};a.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var s=0;s<t._listeners[e].length;s++)t._listeners[e][s].apply(t,o)}},a.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},a.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},a.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var n="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||n.length;var o,s=[];for(o=0;o<e;o++)s.push(n.substr(Math.floor(Math.random()*t),1));return s.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};o.polluteGlobalNamespace=function(){"_jp"in t||(t._jp={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var s=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=s.protocol+t),0===t.indexOf("/")&&(t=s.protocol+"//"+s.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var s=o.arrIndexOf(e,t);return-1===s?e.slice():e.slice(0,s).concat(e.slice(s+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var r,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},d=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return l[e]})),'"'+e+'"'},u=function(e){var t,o={},s=[];for(t=0;t<65536;t++)s.push(String.fromCharCode(t));return e.lastIndex=0,s.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=p(e);return d.lastIndex=0,d.test(t)?(r||(r=u(d)),t.replace(d,function(e){return r[e]})):t};var g=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];o.probeProtocols=function(){for(var e={},t=0;t<g.length;t++){var o=g[t];e[o]=w[o]&&w[o].enabled()}return e},o.detectProtocols=function(e,t,o){var s={},i=[];t||(t=g);for(var a=0;a<t.length;a++){var n=t[a];s[n]=e[n]}var r=function(e){var t=e.shift();s[t]?i.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),s["xhr-streaming"]&&!o.null_origin?i.push("xhr-streaming"):!s["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),s["xhr-polling"]&&!o.null_origin?i.push("xhr-polling"):!s["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var m="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(m in t)){var s={};t[m]=function(e){return e in s||(s[e]={id:e,del:function(){delete s[e]}}),s[e]}}return t[m](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,s){void 0!==t.addEventListener?t.addEventListener(o,s,!1):(e.attachEvent("on"+o,s),t.attachEvent("on"+o,s))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,s){void 0!==t.addEventListener?t.removeEventListener(o,s,!1):(e.detachEvent("on"+o,s),t.detachEvent("on"+o,s))};var f={},h=!1,v=function(){for(var e in f)f[e](),delete f[e]},$=function(){h||(h=!0,v())};o.attachEvent("unload",$),o.unload_add=function(e){var t=o.random_string(8);return f[t]=e,h&&o.delay(v),t},o.unload_del=function(e){e in f&&delete f[e]},o.createIframe=function(t,s){var i,a,n=e.createElement("iframe"),r=function(){clearTimeout(i);try{n.onload=null}catch(e){}n.onerror=null},c=function(){n&&(r(),setTimeout(function(){n&&n.parentNode.removeChild(n),n=null},0),o.unload_del(a))},l=function(e){n&&(c(),s(e))},d=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};return n.src=t,n.style.display="none",n.style.position="absolute",n.onerror=function(){l("onerror")},n.onload=function(){clearTimeout(i),i=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(n),i=setTimeout(function(){l("timeout")},15e3),a=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,s){var i,a,n,r=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},l=function(){r&&(c(),o.unload_del(a),n.parentNode.removeChild(n),n=r=null,CollectGarbage())},d=function(e){r&&(l(),s(e))},p=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};r.open(),r.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),r.close(),r.parentWindow._jp=t._jp;var u=r.createElement("div");return r.body.appendChild(u),n=r.createElement("iframe"),u.appendChild(n),n.src=e,i=setTimeout(function(){d("timeout")},15e3),a=o.unload_add(l),{post:p,cleanup:l,loaded:c}};var S=function(){};S.prototype=new a(["chunk","finish"]),S.prototype._start=function(e,s,i,a){var n=this;try{n.xhr=new XMLHttpRequest}catch(e){}if(!n.xhr)try{n.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(s+=(-1===s.indexOf("?")?"?":"&")+"t="+ +new Date),n.unload_ref=o.unload_add(function(){n._cleanup(!0)});try{n.xhr.open(e,s,!0)}catch(e){return n.emit("finish",0,""),void n._cleanup()}if(a&&a.no_credentials||(n.xhr.withCredentials="true"),a&&a.headers)for(var r in a.headers)n.xhr.setRequestHeader(r,a.headers[r]);n.xhr.onreadystatechange=function(){if(n.xhr){var e=n.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&n.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),n.emit("finish",t,e.responseText),n._cleanup(!1)}}},n.xhr.send(i)},S.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},S.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new S,(o.XHRLocalObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s,{no_credentials:!0})})}).prototype=new S;var I=o.XDRObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s)})};I.prototype=new a(["chunk","finish"]),I.prototype._start=function(e,t,s){var i=this,a=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var n=a.ontimeout=a.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};a.onprogress=function(){i.emit("chunk",200,a.responseText)},a.onload=function(){i.emit("finish",200,a.responseText),i._cleanup(!1)},i.xdr=a,i.unload_ref=o.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(s)}catch(e){n()}},I.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},I.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:k.enabled()?3:4};var w=function(e,s,i){if(this===t)return new w(e,s,i);var a,n=this;n._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&o.objectExtend(n._options,i),n._base_url=o.amendUrl(e),n._server=n._options.server||o.random_number_string(1e3),n._options.protocols_whitelist&&n._options.protocols_whitelist.length?a=n._options.protocols_whitelist:(a="string"==typeof s&&s.length>0?[s]:o.isArray(s)?s:null)&&n._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),n._protocols=[],n.protocol=null,n.readyState=w.CONNECTING,n._ir=F(n._base_url),n._ir.onfinish=function(e,t){n._ir=null,e?(n._options.info&&(e=o.objectExtend(e,n._options.info)),n._options.rtt&&(t=n._options.rtt),n._applyInfo(e,t,a),n._didClose()):n._didClose(1002,"Can't connect to server",!0)}};w.prototype=new s,w.version="0.3.4",w.CONNECTING=0,w.OPEN=1,w.CLOSING=2,w.CLOSED=3,w.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},w.prototype._dispatchOpen=function(){var e=this;e.readyState===w.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=w.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},w.prototype._dispatchMessage=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new i("message",{data:e}))},w.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},w.prototype._didClose=function(e,t,s){var a=this;if(a.readyState!==w.CONNECTING&&a.readyState!==w.OPEN&&a.readyState!==w.CLOSING)throw new Error("INVALID_STATE_ERR");a._ir&&(a._ir.nuke(),a._ir=null),a._transport&&(a._transport.doCleanup(),a._transport=null);var n=new i("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&a.readyState===w.CONNECTING&&!s){if(a._try_next_protocol(n))return;n=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:n})}a.readyState=w.CLOSED,o.delay(function(){a.dispatchEvent(n)})},w.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),s=0;s<o.length;s++)t._dispatchMessage(o[s]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},w.prototype._try_next_protocol=function(t){var s=this;for(s.protocol&&(s._debug("Closed transport:",s.protocol,""+t),s.protocol=null),s._transport_tref&&(clearTimeout(s._transport_tref),s._transport_tref=null);;){var i=s.protocol=s._protocols.shift();if(!i)return!1;if(w[i]&&!0===w[i].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return s._protocols.unshift(i),s.protocol="waiting-for-load",o.attachEvent("load",function(){s._try_next_protocol()}),!0;if(w[i]&&w[i].enabled(s._options)){var a=w[i].roundTrips||1,n=(s._options.rto||0)*a||5e3;s._transport_tref=o.delay(n,function(){s.readyState===w.CONNECTING&&s._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=s._base_url+"/"+s._server+"/"+r;return s._debug("Opening transport:",i," url:"+c," RTO:"+s._options.rto),s._transport=new w[i](s,c,s._base_url),!0}s._debug("Skipping transport:",i)}},w.prototype.close=function(e,t){var s=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(s.readyState===w.CONNECTING||s.readyState===w.OPEN)&&(s.readyState=w.CLOSING,s._didClose(e||1e3,t||"Normal closure"),!0)},w.prototype.send=function(e){var t=this;if(t.readyState===w.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===w.OPEN&&t._transport.doSend(o.quote(""+e)),!0},w.prototype._applyInfo=function(t,s,i){var a=this;a._options.info=t,a._options.rtt=s,a._options.rto=o.countRTO(s),a._options.info.null_origin=!e.domain;var n=o.probeProtocols();a._protocols=o.detectProtocols(n,i,t)};var y=w.websocket=function(e,s){var i=this,a=s+"/websocket";a="https"===a.slice(0,5)?"wss"+a.slice(5):"ws"+a.slice(4),i.ri=e,i.url=a;var n=t.WebSocket||t.MozWebSocket;i.ws=new n(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=o.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};y.prototype.doSend=function(e){this.ws.send("["+e+"]")},y.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},y.enabled=function(){return!(!t.WebSocket&&!t.MozWebSocket)},y.roundTrips=2;var T=function(){};T.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},T.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},T.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},T.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},T.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var C=function(t,s,i){var a=this;if(!("_send_form"in a)){var n=a._send_form=e.createElement("form"),r=a._send_area=e.createElement("textarea");r.name="d",n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",n.appendChild(r),e.body.appendChild(n)}var n=a._send_form,r=a._send_area,c="a"+o.random_string(8);n.target=c,n.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,n.appendChild(l),l.style.display="none";try{r.value=s}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}n.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",i(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},b=function(e){return function(t,o,s){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){s(200===e||204===e,"http status "+e)},function(e){s(!1,e)}}},A=function(t,s){var i,a,n=e.createElement("script"),r=function(e){a&&(a.parentNode.removeChild(a),a=null),n&&(clearTimeout(i),n.parentNode.removeChild(n),n.onreadystatechange=n.onerror=n.onload=n.onclick=null,n=null,s(e),s=null)},c=!1,l=null;if(n.id="a"+o.random_string(8),n.src=t,n.type="text/javascript",n.charset="UTF-8",n.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},n.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(e){if(/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){c=!0;try{n.onclick()}catch(e){}}n&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===n.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))a=e.createElement("script"),a.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=a.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch(e){}n.async=!0}void 0!==n.async&&(n.async=!0),i=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(n,d.firstChild),a&&d.insertBefore(a,d.firstChild),r},P=w["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var s=this;s.ri=e,s.trans_url=t,s.send_constructor(C),s._schedule_recv()};P.prototype=new T,P.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=x(e.trans_url+"/jsonp",A,t)},P.enabled=function(){return!0},P.need_body=!0,P.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var x=function(e,s,i){var a="a"+o.random_string(6),n=e+"?c="+escape("_jp."+a),r=0,c=function(e){switch(r){case 0:delete t._jp[a],i(e);break;case 1:i(e),r=2;break;case 2:delete t._jp[a]}},l=s(n,c);return t._jp[a]=l,function(){t._jp[a]&&(r=1,t._jp[a](o.closeFrame(1e3,"JSONP user aborted read")))}},L=function(){};L.prototype=new T,L.prototype.run=function(e,t,o,s,i){var a=this;a.ri=e,a.trans_url=t,a.send_constructor(b(i)),a.poll=new z(e,s,t+o,i)},L.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var D=w["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",K,o.XHRCorsObject)};D.prototype=new L,D.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},D.roundTrips=2,D.need_body=!0;var N=w["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",K,o.XDRObject)};N.prototype=new L,N.enabled=function(){return!!t.XDomainRequest},N.roundTrips=2;var _=w["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XHRCorsObject)};_.prototype=new L,_.enabled=D.enabled,_.roundTrips=2;var O=w["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XDRObject)};O.prototype=new L,O.enabled=N.enabled,O.roundTrips=2;var k=function(){};k.prototype.i_constructor=function(e,t,s){var i=this;i.ri=e,i.origin=o.getOrigin(s),i.base_url=s,i.trans_url=t;var a=s+"/iframe.html";i.ri._options.devel&&(a+="?t="+ +new Date),i.window_id=o.random_string(8),a+="#"+i.window_id,i.iframeObj=o.createIframe(a,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=o.bind(i.onmessage,i),o.attachMessage(i.onmessage_cb)},k.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},k.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),s=e.data.slice(8,9),i=e.data.slice(9);if(o===t.window_id)switch(s){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([w.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},k.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},k.prototype.doSend=function(e){this.postMessage("m",e)},k.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var E,U=function(e,s){parent!==t?parent.postMessage(E+e+(s||""),"*"):o.log("Can't postMessage, no parent window.",e,s)},M=function(){};M.prototype._didClose=function(e,t){U("t",o.closeFrame(e,t))},M.prototype._didMessage=function(e){U("t",e)},M.prototype._doSend=function(e){this._transport.doSend(e)},M.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,w.bootstrap_iframe=function(){var s;E=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var i=e.data.slice(0,8),a=e.data.slice(8,9),n=e.data.slice(9);if(i===E)switch(a){case"s":var r=JSON.parse(n),c=r[0],l=r[1],d=r[2],p=r[3];if(c!==w.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+w.version+'".'),!o.flatUrl(d)||!o.flatUrl(p))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(p))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,p])+")");s=new M,s._transport=new M[l](s,d,p);break;case"m":s._doSend(n);break;case"c":s&&s._doCleanup(),s=null}}};o.attachMessage(i),U("s")};var R=function(e,t){var s=this;o.delay(function(){s.doXhr(e,t)})};R.prototype=new a(["finish"]),R.prototype.doXhr=function(e,t){var s=this,i=(new Date).getTime(),a=new t("GET",e+"/info"),n=o.delay(8e3,function(){a.ontimeout()});a.onfinish=function(e,t){if(clearTimeout(n),n=null,200===e){var o=(new Date).getTime()-i,a=JSON.parse(t);"object"!=typeof a&&(a={}),s.emit("finish",a,o)}else s.emit("finish")},a.ontimeout=function(){a.close(),s.emit("finish")}};var B=function(t){var s=this,i=function(){var e=new k;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),i=o[0],a=o[1];s.emit("finish",i,a)}else s.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:o,_didMessage:o};e.i_constructor(i,t,t)};e.body?i():o.attachEvent("load",i)};B.prototype=new a(["finish"]);var H=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};H.prototype=new a(["finish"]);var F=function(e){if(o.isSameOriginUrl(e))return new R(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new R(e,o.XHRLocalObject);case 2:return new R(e,o.XDRObject);case 3:return new B(e);default:return new H}};(M["w-iframe-info-receiver"]=function(e,t,s){new R(s,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var G=w["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};G.prototype=new k,G.enabled=function(){return"EventSource"in t&&k.enabled()},G.need_body=!0,G.roundTrips=3,(M["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",W,o.XHRLocalObject)}).prototype=new L;var V=w["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};V.prototype=new k,V.enabled=function(){return t.XMLHttpRequest&&k.enabled()},V.need_body=!0,V.roundTrips=3,(M["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XHRLocalObject)}).prototype=new L;var j=w["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};j.prototype=new k,j.enabled=function(){return k.enabled()},j.need_body=!0,j.roundTrips=3,(M["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",Y,o.XHRLocalObject)}).prototype=new L;var z=function(e,t,o,s){var i=this;i.ri=e,i.Receiver=t,i.recv_url=o,i.AjaxObject=s,i._scheduleRecv()};z.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},z.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var W=function(e){var t=this,s=new EventSource(e);s.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=s.onerror=function(e,a){var n=a?"user":2!==s.readyState?"network":"permanent";t.es_close=s.onmessage=s.onerror=null,s.close(),s=null,o.delay(200,function(){t.dispatchEvent(new i("close",{reason:n}))})}};W.prototype=new s,W.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var q,J=function(){if(void 0===q)if("ActiveXObject"in t)try{q=!!new ActiveXObject("htmlfile")}catch(e){}else q=!1;return q},Y=function(e){var s=this;o.polluteGlobalNamespace(),s.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+s.id);var a,n=J()?o.createHtmlfile:o.createIframe;t._jp[s.id]={start:function(){a.loaded()},message:function(e){s.dispatchEvent(new i("message",{data:e}))},stop:function(){s.iframe_close({},"network")}},s.iframe_close=function(e,o){a.cleanup(),s.iframe_close=a=null,delete t._jp[s.id],s.dispatchEvent(new i("close",{reason:o}))},a=n(e,function(e){s.iframe_close({},"permanent")})};Y.prototype=new s,Y.prototype.abort=function(){var e=this
;e.iframe_close&&e.iframe_close({},"user")};var K=function(e,t){var o=this,s=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var a=t.slice(s),n=a.indexOf("\n");if(-1===n)break;s+=n+1;var r=a.slice(0,n);o.dispatchEvent(new i("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var s=200===e?"network":"permanent";o.dispatchEvent(new i("close",{reason:s}))}};return K.prototype=new s,K.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},w.getUtils=function(){return o},w.getIframeTransport=function(){return k},w}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});var JSON;JSON||(JSON={}),function(){function str(e,t){var o,s,i,a,n,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,o=0;o<a;o+=1)n[o]=str(o,c)||"null";return i=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+r+"]":"["+n.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(a=rep.length,o=0;o<a;o+=1)"string"==typeof rep[o]&&(s=rep[o],(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i));else for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i);return i=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+r+"}":"{"+n.join(",")+"}",gap=r,i}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var s;if(gap="",indent="","number"==typeof o)for(s=0;s<o;s+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,s,i=e[t];if(i&&"object"==typeof i)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s=walk(i,o),void 0!==s?i[o]=s:delete i[o]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},s=function(){};s.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var s=this._listeners[e];-1===o.arrIndexOf(s,t)&&s.push(t)},s.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var s=this._listeners[e],i=o.arrIndexOf(s,t);return-1!==i?void(s.length>1?this._listeners[e]=s.slice(0,i).concat(s.slice(i+1)):delete this._listeners[e]):void 0}},s.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var s=0;s<this._listeners[t].length;s++)this._listeners[t][s].apply(this,o)};var i=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var a=function(e){var t=this;t._events=e||[],t._listeners={}};a.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var s=0;s<t._listeners[e].length;s++)t._listeners[e][s].apply(t,o)}},a.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},a.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},a.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var n="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||n.length;var o,s=[];for(o=0;o<e;o++)s.push(n.substr(Math.floor(Math.random()*t),1));return s.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};var r="_jp";o.polluteGlobalNamespace=function(){r in t||(t[r]={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var s=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=s.protocol+t),0===t.indexOf("/")&&(t=s.protocol+"//"+s.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var s=o.arrIndexOf(e,t);return-1===s?e.slice():e.slice(0,s).concat(e.slice(s+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var c,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},p=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,u=JSON&&JSON.stringify||function(e){return l.lastIndex=0,l.test(e)&&(e=e.replace(l,function(e){return d[e]})),'"'+e+'"'},g=function(e){var t,o={},s=[];for(t=0;t<65536;t++)s.push(String.fromCharCode(t));return e.lastIndex=0,s.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=u(e);return p.lastIndex=0,p.test(t)?(c||(c=g(p)),t.replace(p,function(e){return c[e]})):t};var m=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];o.probeProtocols=function(){for(var e={},t=0;t<m.length;t++){var o=m[t];e[o]=y[o]&&y[o].enabled()}return e},o.detectProtocols=function(e,t,o){var s={},i=[];t||(t=m);for(var a=0;a<t.length;a++){var n=t[a];s[n]=e[n]}var r=function(e){var t=e.shift();s[t]?i.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),s["xhr-streaming"]&&!o.null_origin?i.push("xhr-streaming"):!s["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),s["xhr-polling"]&&!o.null_origin?i.push("xhr-polling"):!s["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var f="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(f in t)){var s={};t[f]=function(e){return e in s||(s[e]={id:e,del:function(){delete s[e]}}),s[e]}}return t[f](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,s){void 0!==t.addEventListener?t.addEventListener(o,s,!1):(e.attachEvent("on"+o,s),t.attachEvent("on"+o,s))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,s){void 0!==t.addEventListener?t.removeEventListener(o,s,!1):(e.detachEvent("on"+o,s),t.detachEvent("on"+o,s))};var h={},v=!1,$=function(){for(var e in h)h[e](),delete h[e]},S=function(){v||(v=!0,$())};o.attachEvent("unload",S),o.unload_add=function(e){var t=o.random_string(8);return h[t]=e,v&&o.delay($),t},o.unload_del=function(e){e in h&&delete h[e]},o.createIframe=function(t,s){var i,a,n=e.createElement("iframe"),r=function(){clearTimeout(i);try{n.onload=null}catch(e){}n.onerror=null},c=function(){n&&(r(),setTimeout(function(){n&&n.parentNode.removeChild(n),n=null},0),o.unload_del(a))},l=function(e){n&&(c(),s(e))},d=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};return n.src=t,n.style.display="none",n.style.position="absolute",n.onerror=function(){l("onerror")},n.onload=function(){clearTimeout(i),i=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(n),i=setTimeout(function(){l("timeout")},15e3),a=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,s){var i,a,n,c=new ActiveXObject("htmlfile"),l=function(){clearTimeout(i)},d=function(){c&&(l(),o.unload_del(a),n.parentNode.removeChild(n),n=c=null,CollectGarbage())},p=function(e){c&&(d(),s(e))},u=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};c.open(),c.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),c.close(),c.parentWindow[r]=t[r];var g=c.createElement("div");return c.body.appendChild(g),n=c.createElement("iframe"),g.appendChild(n),n.src=e,i=setTimeout(function(){p("timeout")},15e3),a=o.unload_add(d),{post:u,cleanup:d,loaded:l}};var I=function(){};I.prototype=new a(["chunk","finish"]),I.prototype._start=function(e,s,i,a){var n=this;try{n.xhr=new XMLHttpRequest}catch(e){}if(!n.xhr)try{n.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(s+=(-1===s.indexOf("?")?"?":"&")+"t="+ +new Date),n.unload_ref=o.unload_add(function(){n._cleanup(!0)});try{n.xhr.open(e,s,!0)}catch(e){return n.emit("finish",0,""),void n._cleanup()}if(a&&a.no_credentials||(n.xhr.withCredentials="true"),a&&a.headers)for(var r in a.headers)n.xhr.setRequestHeader(r,a.headers[r]);n.xhr.onreadystatechange=function(){if(n.xhr){var e=n.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&n.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),n.emit("finish",t,e.responseText),n._cleanup(!1)}}},n.xhr.send(i)},I.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},I.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new I,(o.XHRLocalObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s,{no_credentials:!0})})}).prototype=new I;var w=o.XDRObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s)})};w.prototype=new a(["chunk","finish"]),w.prototype._start=function(e,t,s){var i=this,a=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var n=a.ontimeout=a.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};a.onprogress=function(){i.emit("chunk",200,a.responseText)},a.onload=function(){i.emit("finish",200,a.responseText),i._cleanup(!1)},i.xdr=a,i.unload_ref=o.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(s)}catch(e){n()}},w.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},w.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:E.enabled()?3:4};var y=function(e,s,i){if(this===t)return new y(e,s,i);var a,n=this;n._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&o.objectExtend(n._options,i),n._base_url=o.amendUrl(e),n._server=n._options.server||o.random_number_string(1e3),n._options.protocols_whitelist&&n._options.protocols_whitelist.length?a=n._options.protocols_whitelist:(a="string"==typeof s&&s.length>0?[s]:o.isArray(s)?s:null)&&n._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),n._protocols=[],n.protocol=null,n.readyState=y.CONNECTING,n._ir=G(n._base_url),n._ir.onfinish=function(e,t){n._ir=null,e?(n._options.info&&(e=o.objectExtend(e,n._options.info)),n._options.rtt&&(t=n._options.rtt),n._applyInfo(e,t,a),n._didClose()):n._didClose(1002,"Can't connect to server",!0)}};y.prototype=new s,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},y.prototype._dispatchOpen=function(){var e=this;e.readyState===y.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=y.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new i("message",{data:e}))},y.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},y.prototype._didClose=function(e,t,s){var a=this;if(a.readyState!==y.CONNECTING&&a.readyState!==y.OPEN&&a.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");a._ir&&(a._ir.nuke(),a._ir=null),a._transport&&(a._transport.doCleanup(),a._transport=null);var n=new i("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&a.readyState===y.CONNECTING&&!s){if(a._try_next_protocol(n))return;n=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:n})}a.readyState=y.CLOSED,o.delay(function(){a.dispatchEvent(n)})},y.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),s=0;s<o.length;s++)t._dispatchMessage(o[s]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(t){var s=this;for(s.protocol&&(s._debug("Closed transport:",s.protocol,""+t),s.protocol=null),s._transport_tref&&(clearTimeout(s._transport_tref),s._transport_tref=null);;){var i=s.protocol=s._protocols.shift();if(!i)return!1;if(y[i]&&!0===y[i].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return s._protocols.unshift(i),s.protocol="waiting-for-load",o.attachEvent("load",function(){s._try_next_protocol()}),!0;if(y[i]&&y[i].enabled(s._options)){var a=y[i].roundTrips||1,n=(s._options.rto||0)*a||5e3;s._transport_tref=o.delay(n,function(){s.readyState===y.CONNECTING&&s._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=s._base_url+"/"+s._server+"/"+r;return s._debug("Opening transport:",i," url:"+c," RTO:"+s._options.rto),s._transport=new y[i](s,c,s._base_url),!0}s._debug("Skipping transport:",i)}},y.prototype.close=function(e,t){var s=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(s.readyState===y.CONNECTING||s.readyState===y.OPEN)&&(s.readyState=y.CLOSING,s._didClose(e||1e3,t||"Normal closure"),!0)},y.prototype.send=function(e){var t=this;if(t.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===y.OPEN&&t._transport.doSend(o.quote(""+e)),!0},y.prototype._applyInfo=function(t,s,i){var a=this;a._options.info=t,a._options.rtt=s,a._options.rto=o.countRTO(s),a._options.info.null_origin=!e.domain;var n=o.probeProtocols();a._protocols=o.detectProtocols(n,i,t)};var T=y.websocket=function(e,s){var i=this,a=s+"/websocket";a="https"===a.slice(0,5)?"wss"+a.slice(5):"ws"+a.slice(4),i.ri=e,i.url=a;var n=t.WebSocket||t.MozWebSocket;i.ws=new n(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=o.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};T.prototype.doSend=function(e){this.ws.send("["+e+"]")},T.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},T.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},T.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},C.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},C.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var b=function(t,s,i){var a=this;if(!("_send_form"in a)){var n=a._send_form=e.createElement("form"),r=a._send_area=e.createElement("textarea");r.name="d",n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",n.appendChild(r),e.body.appendChild(n)}var n=a._send_form,r=a._send_area,c="a"+o.random_string(8);n.target=c,n.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,n.appendChild(l),l.style.display="none";try{r.value=s}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}n.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",i(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},A=function(e){return function(t,o,s){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){s(200===e||204===e,"http status "+e)},function(e){s(!1,e)}}},P=function(t,s){var i,a,n=e.createElement("script"),r=function(e){a&&(a.parentNode.removeChild(a),a=null),n&&(clearTimeout(i),n.parentNode.removeChild(n),n.onreadystatechange=n.onerror=n.onload=n.onclick=null,n=null,s(e),s=null)},c=!1,l=null;if(n.id="a"+o.random_string(8),n.src=t,n.type="text/javascript",n.charset="UTF-8",n.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},n.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(e){if(/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){c=!0;try{n.onclick()}catch(e){}}n&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===n.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))a=e.createElement("script"),a.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=a.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch(e){}n.async=!0}void 0!==n.async&&(n.async=!0),i=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(n,d.firstChild),a&&d.insertBefore(a,d.firstChild),r},x=y["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var s=this;s.ri=e,s.trans_url=t,s.send_constructor(b),s._schedule_recv()};x.prototype=new C,x.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",P,t)},x.enabled=function(){return!0},x.need_body=!0,x.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(e,s,i){var a="a"+o.random_string(6),n=e+"?c="+escape(r+"."+a),c=0,l=function(e){switch(c){case 0:delete t[r][a],i(e);break;case 1:i(e),c=2;break;case 2:delete t[r][a]}},d=s(n,l);return t[r][a]=d,function(){t[r][a]&&(c=1,t[r][a](o.closeFrame(1e3,"JSONP user aborted read")))}},D=function(){};D.prototype=new C,D.prototype.run=function(e,t,o,s,i){var a=this;a.ri=e,a.trans_url=t,a.send_constructor(A(i)),a.poll=new W(e,s,t+o,i)},D.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var N=y["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XHRCorsObject)};N.prototype=new D,N.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},N.roundTrips=2,N.need_body=!0;var _=y["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XDRObject)};_.prototype=new D,_.enabled=function(){return!!t.XDomainRequest},_.roundTrips=2;var O=y["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRCorsObject)};O.prototype=new D,O.enabled=N.enabled,O.roundTrips=2;var k=y["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XDRObject)};k.prototype=new D,k.enabled=_.enabled,k.roundTrips=2;var E=function(){};E.prototype.i_constructor=function(e,t,s){var i=this;i.ri=e,i.origin=o.getOrigin(s),i.base_url=s,i.trans_url=t;var a=s+"/iframe.html";i.ri._options.devel&&(a+="?t="+ +new Date),i.window_id=o.random_string(8),a+="#"+i.window_id,i.iframeObj=o.createIframe(a,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=o.bind(i.onmessage,i),o.attachMessage(i.onmessage_cb)},E.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},E.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),s=e.data.slice(8,9),i=e.data.slice(9);if(o===t.window_id)switch(s){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([y.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},E.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},E.prototype.doSend=function(e){this.postMessage("m",e)},E.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var U,M=function(e,s){parent!==t?parent.postMessage(U+e+(s||""),"*"):o.log("Can't postMessage, no parent window.",e,s)},R=function(){};R.prototype._didClose=function(e,t){M("t",o.closeFrame(e,t))},R.prototype._didMessage=function(e){M("t",e)},R.prototype._doSend=function(e){this._transport.doSend(e)},R.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,y.bootstrap_iframe=function(){var s;U=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var i=e.data.slice(0,8),a=e.data.slice(8,9),n=e.data.slice(9);if(i===U)switch(a){case"s":var r=JSON.parse(n),c=r[0],l=r[1],d=r[2],p=r[3];if(c!==y.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+y.version+'".'),!o.flatUrl(d)||!o.flatUrl(p))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(p))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,p])+")");s=new R,s._transport=new R[l](s,d,p);break;case"m":s._doSend(n);break;case"c":s&&s._doCleanup(),s=null}}};o.attachMessage(i),M("s")};var B=function(e,t){var s=this;o.delay(function(){s.doXhr(e,t)})};B.prototype=new a(["finish"]),B.prototype.doXhr=function(e,t){var s=this,i=(new Date).getTime(),a=new t("GET",e+"/info"),n=o.delay(8e3,function(){a.ontimeout()});a.onfinish=function(e,t){if(clearTimeout(n),n=null,200===e){var o=(new Date).getTime()-i,a=JSON.parse(t);"object"!=typeof a&&(a={}),s.emit("finish",a,o)}else s.emit("finish")},a.ontimeout=function(){a.close(),s.emit("finish")}};var H=function(t){var s=this,i=function(){var e=new E;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),i=o[0],a=o[1];s.emit("finish",i,a)}else s.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:o,_didMessage:o};e.i_constructor(i,t,t)};e.body?i():o.attachEvent("load",i)};H.prototype=new a(["finish"]);var F=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new a(["finish"]);var G=function(e){if(o.isSameOriginUrl(e))return new B(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new B(e,o.XHRLocalObject);case 2:return new B(e,o.XDRObject);case 3:return new H(e);default:return new F}};(R["w-iframe-info-receiver"]=function(e,t,s){new B(s,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var V=y["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};V.prototype=new E,V.enabled=function(){return"EventSource"in t&&E.enabled()},V.need_body=!0,V.roundTrips=3,(R["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",q,o.XHRLocalObject)}).prototype=new D;var j=y["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};j.prototype=new E,j.enabled=function(){return t.XMLHttpRequest&&E.enabled()},j.need_body=!0,j.roundTrips=3,(R["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRLocalObject)}).prototype=new D;var z=y["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};z.prototype=new E,z.enabled=function(){return E.enabled()},z.need_body=!0,z.roundTrips=3,(R["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",K,o.XHRLocalObject)}).prototype=new D;var W=function(e,t,o,s){var i=this;i.ri=e,i.Receiver=t,i.recv_url=o,i.AjaxObject=s,i._scheduleRecv()};W.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},W.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var q=function(e){var t=this,s=new EventSource(e);s.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=s.onerror=function(e,a){var n=a?"user":2!==s.readyState?"network":"permanent";t.es_close=s.onmessage=s.onerror=null,s.close(),s=null,o.delay(200,function(){t.dispatchEvent(new i("close",{reason:n}))})}};q.prototype=new s,q.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var J,Y=function(){if(void 0===J)if("ActiveXObject"in t)try{J=!!new ActiveXObject("htmlfile")}catch(e){}else J=!1;return J},K=function(e){var s=this;o.polluteGlobalNamespace(),s.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(r+"."+s.id);var a,n=Y()?o.createHtmlfile:o.createIframe;t[r][s.id]={start:function(){a.loaded()},message:function(e){s.dispatchEvent(new i("message",{data:e}))},stop:function(){s.iframe_close({},"network")}},s.iframe_close=function(e,o){a.cleanup(),s.iframe_close=a=null,delete t[r][s.id],s.dispatchEvent(new i("close",{reason:o}))},a=n(e,function(e){s.iframe_close({},"permanent")})};K.prototype=new s,K.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var Q=function(e,t){var o=this,s=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var a=t.slice(s),n=a.indexOf("\n")
;if(-1===n)break;s+=n+1;var r=a.slice(0,n);o.dispatchEvent(new i("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var s=200===e?"network":"permanent";o.dispatchEvent(new i("close",{reason:s}))}};return Q.prototype=new s,Q.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},y.getUtils=function(){return o},y.getIframeTransport=function(){return E},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS})(function(){var e,t,o,s,i={}.hasOwnProperty,a=[].slice;e={LF:"\n",NULL:"\0"},o=function(){function t(e,t,o){this.command=e,this.headers=null!=t?t:{},this.body=null!=o?o:""}var o;return t.prototype.toString=function(){var o,s,a,n,r;o=[this.command],a=!1===this.headers["content-length"],a&&delete this.headers["content-length"],r=this.headers;for(s in r)i.call(r,s)&&(n=r[s],o.push(s+":"+n));return this.body&&!a&&o.push("content-length:"+t.sizeOfUTF8(this.body)),o.push(e.LF+this.body),o.join(e.LF)},t.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},o=function(o){var s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S;for(n=o.search(RegExp(""+e.LF+e.LF)),r=o.substring(0,n).split(e.LF),a=r.shift(),c={},m=function(e){return e.replace(/^\s+|\s+$/g,"")},$=r.reverse(),f=0,v=$.length;f<v;f++)u=$[f],d=u.indexOf(":"),c[m(u.substring(0,d))]=m(u.substring(d+1));if(s="",g=n+2,c["content-length"])p=parseInt(c["content-length"]),s=(""+o).substring(g,g+p);else for(i=null,l=h=g,S=o.length;(g<=S?h<S:h>S)&&(i=o.charAt(l))!==e.NULL;l=g<=S?++h:--h)s+=i;return new t(a,c,s)},t.unmarshall=function(t){var s,i,a,n;return i=t.split(RegExp(""+e.NULL+e.LF+"*")),n={frames:[],partial:""},n.frames=function(){var e,t,a,n;for(a=i.slice(0,-1),n=[],e=0,t=a.length;e<t;e++)s=a[e],n.push(o(s));return n}(),a=i.slice(-1)[0],a===e.LF||-1!==a.search(RegExp(""+e.NULL+e.LF+"*$"))?n.frames.push(o(a)):n.partial=a,n},t.marshall=function(o,s,i){var a;return a=new t(o,s,i),a.toString()+e.NULL},t}(),t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var i;return t.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},i=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(e,t,s){var i;for(i=o.marshall(e,t,s),"function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}},t.prototype._setupHeartbeat=function(t){var o,a,n,r,c,l;if((c=t.version)===s.VERSIONS.V1_1||c===s.VERSIONS.V1_2)return l=function(){var e,o,s,i;for(s=t["heart-beat"].split(","),i=[],e=0,o=s.length;e<o;e++)r=s[e],i.push(parseInt(r));return i}(),a=l[0],o=l[1],0!==this.heartbeat.outgoing&&0!==o&&(n=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+n+"ms"),this.pinger=s.setInterval(n,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==a?(n=Math.max(this.heartbeat.incoming,a),"function"==typeof this.debug&&this.debug("check PONG every "+n+"ms"),this.ponger=s.setInterval(n,function(e){return function(){var t;if((t=i()-e.serverActivity)>2*n)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+t+"ms"),e.ws.close()}}(this))):void 0},t.prototype._parseConnect=function(){var e,t,o,s;switch(e=1<=arguments.length?a.call(arguments,0):[],s={},e.length){case 2:s=e[0],t=e[1];break;case 3:e[1]instanceof Function?(s=e[0],t=e[1],o=e[2]):(s.login=e[0],s.passcode=e[1],t=e[2]);break;case 4:s.login=e[0],s.passcode=e[1],t=e[2],o=e[3];break;default:s.login=e[0],s.passcode=e[1],t=e[2],o=e[3],s.host=e[4]}return[s,t,o]},t.prototype.connect=function(){var t,n,r,c;return t=1<=arguments.length?a.call(arguments,0):[],c=this._parseConnect.apply(this,t),r=c[0],this.connectCallback=c[1],n=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(s){var a,r,c,l,d,p,u,g,m,f,h,v,$;if(l="undefined"!=typeof ArrayBuffer&&s.data instanceof ArrayBuffer?(a=new Uint8Array(s.data),"function"==typeof t.debug&&t.debug("--- got data length: "+a.length),function(){var e,t,o;for(o=[],e=0,t=a.length;e<t;e++)r=a[e],o.push(String.fromCharCode(r));return o}().join("")):s.data,t.serverActivity=i(),l===e.LF)return void("function"==typeof t.debug&&t.debug("<<< PONG"));for("function"==typeof t.debug&&t.debug("<<< "+l),m=o.unmarshall(t.partialData+l),t.partialData=m.partial,v=m.frames,$=[],f=0,h=v.length;f<h;f++)switch(d=v[f],d.command){case"CONNECTED":"function"==typeof t.debug&&t.debug("connected to server "+d.headers.server),t.connected=!0,t._setupHeartbeat(d.headers),$.push("function"==typeof t.connectCallback?t.connectCallback(d):void 0);break;case"MESSAGE":g=d.headers.subscription,u=t.subscriptions[g]||t.onreceive,u?(c=t,p=d.headers["message-id"],d.ack=function(e){return null==e&&(e={}),c.ack(p,g,e)},d.nack=function(e){return null==e&&(e={}),c.nack(p,g,e)},$.push(u(d))):$.push("function"==typeof t.debug?t.debug("Unhandled received MESSAGE: "+d):void 0);break;case"RECEIPT":$.push("function"==typeof t.onreceipt?t.onreceipt(d):void 0);break;case"ERROR":$.push("function"==typeof n?n(d):void 0);break;default:$.push("function"==typeof t.debug?t.debug("Unhandled frame: "+d):void 0)}return $}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof n?n(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),r["accept-version"]=s.VERSIONS.supportedVersions(),r["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",r)}}(this)},t.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&s.clearInterval(this.pinger),this.ponger)return s.clearInterval(this.ponger)},t.prototype.send=function(e,t,o){return null==t&&(t={}),null==o&&(o=""),t.destination=e,this._transmit("SEND",t,o)},t.prototype.subscribe=function(e,t,o){var s;return null==o&&(o={}),o.id||(o.id="sub-"+this.counter++),o.destination=e,this.subscriptions[o.id]=t,this._transmit("SUBSCRIBE",o),s=this,{id:o.id,unsubscribe:function(){return s.unsubscribe(o.id)}}},t.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},t.prototype.begin=function(e){var t,o;return o=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:o}),t=this,{id:o,commit:function(){return t.commit(o)},abort:function(){return t.abort(o)}}},t.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},t.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},t.prototype.ack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("ACK",o)},t.prototype.nack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("NACK",o)},t}(),s={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,o){var i,a;return null==o&&(o=["v10.stomp","v11.stomp"]),i=s.WebSocketClass||WebSocket,a=new i(e,o),new t(a)},over:function(e){return new t(e)},Frame:o},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=s),"undefined"!=typeof window&&null!==window?(s.setInterval=function(e,t){return window.setInterval(t,e)},s.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=s):exports||(self.Stomp=s)}).call(this),APP.controller("CouponsDetailController",["$rootScope","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","CouponsDetailNewService","$ionicScrollDelegate","GetCouponsService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(){for(var e=0;e<window.screen.availWidth/12;e++)t.divStr[e]=12*e+4}function g(e){return!!/^1[34578]\d{9}$/.test(e)}function m(e){return e=e<10?"0"+e:e}function f(e,o){t.endT=o-e,S=p(function(){t.endTt=m(Math.floor(t.endT/86400)),t.endTh=m(Math.floor((t.endT-86400*t.endTt)/3600)),t.endTm=m(Math.floor((t.endT-86400*t.endTt-3600*t.endTh)/60)),t.endTs=m(t.endT-86400*t.endTt-3600*t.endTh-60*t.endTm),-1==--t.endT&&($state.reload(),p.cancel(S))},1e3)}var h=n.cId,v="",$="";t.data="";var S;t.remindme=!1,t.remindSuccess=!1,t.canSubmit=!1,t.endT="",t.endTt="",t.endTh="",t.endTm="",t.endTs="",t.divStr=[],t.backGroundBlue={background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},t.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},t.openRemindMe=function(e){h=e,t.remindme=!0},t.closeRemindMe=function(){t.remindme=!1},t.telVerification=function(e){11==e.length&&g(e)?(v=e,t.canSubmit=!0):t.canSubmit=!1},t.submitBackstage=function(){d.doRemindCoupons(v,h).success(function(o){t.message=o.message,t.remindme=!1,t.remindSuccess=!0,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500),o.success&&(l.scrollTop(),t.getCouponsData(),e.$broadcast("COUPONS_DETAIL_STATE",$))})},t.progress=function(e){return.9*e},t.getNewCoupons=function(o){d.doGetNewCoupons(o).success(function(o){o.success?(l.scrollTop(),e.$broadcast("COUPONS_DETAIL_STATE",$),startIndex=1,t.getCouponsData()):(t.remindSuccess=!0,t.message=o.message,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500))})},t.goBack=function(){"advertisement"==e.fromState?$state.go("homePage"):t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.getCouponsData=function(){p.cancel(S),c.getCouponsDataNew(h).success(function(e){t.data=e.data,f(e.data.nowTime,e.data.activityStartTime)})},t.$on("$ionicView.beforeEnter",function(){t.data="",$=n.type,u(),t.getCouponsData()}),t.$on("$ionicView.beforeLeave",function(){p.cancel(S)})}]),APP.service("CouponsDetailNewService",["$http","UrlService",function(e,t){this.getCouponsDataNew=function(o){var s={couponId:o};return e.get(t.getUrl("COUPONS_DETAIL_LIST"),s)}}]),APP.controller("CouponsDetailTwoController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CouponsDetailTwoService","$timeout","UrlService","$ionicPopup","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d){e.htmlContent=o.content,e.title=o.title,e.id=o.cId,e.userID=o.userID,e.type=o.type,e.status=o.status,e.couponId=o.couponId,e.isUser=o.isUser,e.$on("$ionicView.beforeEnter",function(){e.data="",e.init()}),e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=c.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(t){t.preventDefault(),null!=e.data.memberId?a.getMemberName(e.data.memberId).success(function(t,s,i,a){1==t.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,e.couponId),e.data.messsage=t.data):(e.findMember=!1,e.data.messsage=t.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){c.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?a.donationCoupons(e.data.memberId,o).success(function(t,o,s,i){1==t.success&&0!=t.result?(d.goBack(),e.data.messsage=t.data):0==t.result&&l.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.init=function(){e.htmlContent=o.content,e.title=o.title,a.initData(e.id,e.userID,e.type,e.couponId).success(function(t,o,s,i){e.data=t.data,e.haveCity=!1,e.haveArea=!1,e.haveStreet=!1;for(var a in e.data.cityNameMap)e.haveCity=!0;for(var n in e.data.areaNameMap)e.haveArea=!0;for(var r in e.data.streetNameMap)e.haveStreet=!0})},e.getCouponSuccess="",e.getCoupon=!1,e.getCoupons=function(){a.receiveCoupons(e.data.coupon.id).success(function(t,o,s,i){e.getCouponSuccess=t.data,e.getCoupon=!e.getCoupon}),n(function(){e.getCouponSuccess=""},5e3),e.share=function(){if(window.umeng){var t=r.getSharePicHeader()+"mstatic/wd/v2/img/sg.png",o=r.getShareLinkHeader()+"mstore/sg/coupon/toList.html?id="+e.id+"&type=0&storeId="+UserService.getUser().mid+"&lastUrl=4";window.umeng.share("顺逛领领券频道,优惠券等您来抢","给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",t,o,0)}}}}]),APP.service("CouponsDetailTwoService",["$http","UrlService",function(e,t){this.donationCoupons=function(o,s){var i={memberId:o,id:s};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:i})},this.getMemberName=function(o){var s={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:s})},this.initData=function(o,s,i,a){var n={id:o,storeId:s,type:i,lastUrl:"",mId:a};return e.get(t.getUrl("GET_COUPONS_DETAIL"),n)},this.receiveCoupons=function(o){var s={couponId:o};return e({method:"POST",url:t.getUrl("RECEIVE_COUPONS"),params:s})}}]),APP.controller("GetCouponsListController",["$rootScope","HomePageService","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","GetCouponsService","$ionicScrollDelegate","$state","$interval","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(){for(var e=0;e<window.screen.availWidth/12;e++)o.divStr[e]=12*e+4}function f(e){return!!/^1[34578]\d{9}$/.test(e)}function h(e){return e=e<10?"0"+e:e}function v(e,t,s){o.endT[s]=t-e,T[s]=u(function(){o.endTt[s]=h(Math.floor(o.endT[s]/86400)),o.endTh[s]=h(Math.floor((o.endT[s]-86400*o.endTt[s])/3600)),o.endTm[s]=h(Math.floor((o.endT[s]-86400*o.endTt[s]-3600*o.endTh[s])/60)),o.endTs[s]=h(o.endT[s]-86400*o.endTt[s]-3600*o.endTh[s]-60*o.endTm[s]),-1==--o.endT[s]&&(p.reload(),u.cancel(T[s]))},1e3)}o.dataList="",o.typeIdDefault="";var $="",S="";o.divStr=[],o.remindme=!1,o.remindSuccess=!1,o.canSubmit=!1;var I=[],w=[],y=[],T=[],C="";o.hasmore=!1,o.isHasCoupons=!1;var b=1;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.endT=[],o.endTt=[],o.endTh=[],o.endTm=[],o.endTs=[],o.goBack=function(){"advertisement"==e.fromState?p.go("homePage"):o.$ionicGoBack()},o.share=function(){if(window.cordova){if(!g.getUser().mid)return void p.go("login");o.showShare=!0}else i.showAlert("只能在app分享","抱歉，只能在app分享")},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"},o.typeClass={top:"59px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"},o.typeClass={top:"43px"}),o.backGroundBlue={background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},o.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},o.typeAllShow=!1,o.typeDefault=0,o.typeDataList=[],o.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},o.noTypeStyle={color:"rgba(102,102,102,0.87)"},o.isTypeStyleAll={border:"1px solid #2979FF",color:"#2979FF"},o.noTypeStyleAll={color:"rgba(76,76,76,0.87)",border:"1px solid #999"},o.typeButton=function(e,t){o.isHasCoupons=!1,o.typeDefault=e,o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.allTypeButton=function(e,t){if(o.isHasCoupons=!1,e>1){var s=o.typeDataList[e];o.typeDataList.splice(e,1),o.typeDataList.splice(1,0,s),o.typeDefault=1}else o.typeDefault=e;o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.cotAllType=function(e){o.typeAllShow=e},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="顺逛领券频道,优惠券等您来抢",s="给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",r=n.getShareLinkHeader()+"getCouponsList/"+g.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,s,i,r,0,null,a.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,s,i,r,0,null,a.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,s,i,r,0,null,a.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,s,i,r,0,null,a.shareSuccessCallback),a.qqShare()):4==e&&(window.umeng.shareToQzone(t,s,i,r,0,null,a.shareSuccessCallback),a.qqShare()),5==e?o.copeText(r):a.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.openRemindMe=function(e){$=e,o.remindme=!0},o.closeRemindMe=function(){o.remindme=!1},o.telVerification=function(e){11==e.length&&f(e)?(S=e,o.canSubmit=!0):o.canSubmit=!1},o.submitBackstage=function(){l.doRemindCoupons(S,$).success(function(e){o.message=e.message,o.remindme=!1,o.remindSuccess=!0,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500),e.success&&(b=1,o.init(o.typeIdDefault))})},o.progress=function(e){return.9*e},o.getNewCoupons=function(s){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?p.go("login"):l.doGetNewCoupons(s).success(function(t){t.success?(e.couponXyzType=!0,b=1,o.init(o.typeIdDefault)):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(e){for(var t=0;t<y.length;t++)u.cancel(T[y[t]]);y=[],o.dataList="",l.doInit(1,5,e).success(function(e,t,s,i){if(e.success)if(null!==e.data){o.dataList=e.data;for(var a=0;a<o.dataList.length;a++)3!=o.dataList[a].displayType&&4!=o.dataList[a].displayType||(y.push(a),I[a]=o.dataList[a].nowTime,w[a]=o.dataList[a].activityStartTime);for(var n=0;n<y.length;n++)v(I[y[n]],w[y[n]],y[n]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.isHasCoupons=!0;else o.hasmore=!1})},o.initType=function(){l.doInitType().success(function(e,t,s,a){e.success?(o.typeDataList=e.data,o.typeIdDefault=o.typeDataList[0].id,o.init(o.typeIdDefault)):i.showToast(e.message)})},o.loadMore=function(){b++,l.doInit(b,5).success(function(e,t,s,i){if(e.success){C=y.length,y=[],e.data&&(o.dataList=o.dataList.concat(e.data));for(var a=0;a<o.dataList.length;a++)3!=o.dataList[a].displayType&&4!=o.dataList[a].displayType||(y.push(a),I[a]=o.dataList[a].nowTime,w[a]=o.dataList[a].activityStartTime);for(var n=C;n<y.length;n++)v(I[y[n]],w[y[n]],y[n]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.hasmore=!1})},o.$on("$ionicView.beforeEnter",function(i,a){if("back"==a.direction)return"ClassifyMessageCenter"==s.viewHistory().forwardView.stateName&&t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1}),e.couponXyzType&&(o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})),void(e.couponXyzType=!1);d.scrollTop(),o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})}),o.$on("$ionicView.beforeLeave",function(){for(var e=0;e<y.length;e++)u.cancel(T[y[e]])}),e.$on("COUPONS_DETAIL_STATE",function(e,t){o.init(t)})}]),APP.service("GetCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i){var a={startIndex:o,pageSize:s,couponCateId:i};return e.get(t.getNewUrl("NEW_GET_COUPONS_LIST"),a)},this.doInitType=function(){return e.get(t.getNewUrl("NEW_GET_COUPONS_TYPE"))},this.doRemindCoupons=function(o,s){var i={phone:o,couponId:s};return e.get(t.getUrl("REMIND_COUPONS_LIST"),i)},this.doGetNewCoupons=function(o){var s={couponId:o};return e.get(t.getNewUrl("GET_NEW_COUPONS"),s)}}]),APP.controller("MyCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","GoodsService","$state","AreaService","$timeout","MyCouponsListService","$ionicPopup","PopupService","CacheService","UserService","$ionicScrollDelegate","$ionicModal","$http","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(){for(var t=0;t<window.screen.availWidth/12;t++)e.divStr[t]=12*t+4}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"},e.typeClass={top:"59px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"},e.typeClass={top:"43px"}),e.typeDefault=0,e.backGroundBlue={background:"url("+t.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+t.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.noTypeStyle={color:"rgba(102,102,102,0.87)"},e.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},e.toDetail=function(t,o){var s=u.getUser().mid;a.go("couponsDetailTwo",{cId:t,userID:s,type:0,status:e.status,couponId:o})},e.typeButton=function(t){e.typeDefault=t},e.typeThreeData=["未使用","已使用","即将过期"],e.divStr=[],e.goBack=function(){h.goBack()},e.province=null,e.city=null,e.area=null,e.provinceId="",e.cityId="",e.areaId="",e.streetId="",e.status=1,e.$on("$ionicView.beforeEnter",function(o,s){if(v(),"back"==s.direction)return t.couponXyzType&&(e.status=1,e.init()),void(t.couponXyzType=!1);e.status=1,e.init()}),e.init=function(){c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.getCouponsSta=function(t,o){e.data="",e.status=t,0==o&&3==e.status?(e.status=4,c.doGetNewCouponsLate(100,1,1).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})):c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=l.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(s){s.preventDefault(),null!=e.data.memberId?c.getMemberName(e.data.memberId).success(function(s,i,a,n){1==s.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,t),e.data.messsage=s.data):(e.findMember=!1,e.data.messsage=s.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){l.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?c.donationCoupons(e.data.memberId,o).success(function(t,o,s,i){1==t.success&&0!=t.result?(e.getCouponSuccess=t.message,r(function(){e.getCouponSuccess=""},1e3),e.data.messsage=t.data,e.init(),g.resize()):0==t.result&&d.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.goCouponCenter=function(){a.go("getCouponsList")}}]),APP.service("MyCouponsListService",["$http","UrlService",function(e,t){this.getMyCouponsList=function(o,s,i,a,n){var r={status:o,provinceId:s||"",cityId:i||"",areaId:a||"",streetId:n||"",startIndex:1,pageSize:100};return e({method:"POST",url:t.getUrl("MY_COUPONS_LIST"),params:r})},this.donationCoupons=function(o,s){var i={memberId:o,id:s};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:i})},this.getMemberName=function(o){var s={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:s})},this.doGetNewCouponsLate=function(o,s,i){var a={pageSize:o,startIndex:s,status:i};return e.get(t.getUrl("MY_COUPONS_LIST_LATE"),a)}}]),APP.controller("RetainageController",["RetainageService","$scope","$rootScope","$stateParams","$state","PopupService",function(e,t,o,s,i,a){t.relationOrderSn=s.relationOrderSn,t.isChecked=!0,t.couponList="",t.selectCoupon=function(e,o,s){s?angular.forEach(t.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(t.couponList,function(e,t){e.isChecked=!1})},t.init=function(){e.getOrderList(t.relationOrderSn).success(function(e){0==e.success?a.showToast(e.message):t.couponList=e.data.couponList})},t.confirm=function(){var e=!1,o=0;angular.forEach(t.couponList,function(t,s){t.isChecked&&(e=!0,o=t.memberCouponId)}),e?t.getCoupons(t.relationOrderSn,o):(o="",t.getCoupons(t.relationOrderSn,o))},t.getCoupons=function(t,o){e.selectCoupons(t,o).success(function(e,o,s,n){if(1==e.success){var r=e.data.price;i.go("paymentxyz",{orderSn:t,totalAmount:r})}else a.showToast(e.message)}).error(function(){alert("使用优惠券失败")})},t.$on("$ionicView.beforeEnter",function(){t.noCanUseStyle={opacity:"0.4"},t.init()})}]),APP.service("RetainageService",["$http","UrlService",function(e,t){this.getOrderList=function(o){var s={relationOrderSn:o};return e.get(t.getUrl("SELECT_GOODS_COUPONS0"),s)},this.selectCoupons=function(o,s){var i={relationOrderSn:o,memberCouponId:s};return e({method:"POST",url:t.getUrl("SELECT_GOODS_COUPONS1"),params:i})}}]),APP.controller("UseCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","UseCouponsListService","PopupService","$ionicHistory","UserService",function(e,t,o,s,i,a,n,r,c){e.htmlContent=o.content,e.tabNav="selection",e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,e.couponId=o.couponId,e.sku=o.sku,e.isChecked=!0,e.couponButton=void 0,e.isNull,e.green=[!1],e.blue=[!1],e.pink=[!1],e.$on("$ionicView.beforeEnter",function(){e.noCanUseStyle={opacity:"0.4"},e.couponList="",e.init()}),e.selectCoupon=function(t,o,s){s?angular.forEach(e.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(e.couponList,function(e,t){e.isChecked=!1})},e.init=function(){e.isNull=!1,e.htmlContent=o.content,e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,1==e.type?a.selectGoodsCoupons(e.productId,e.number).success(function(t,o,s,i){e.couponList=t.data,0==e.couponList.length&&(e.isNull=!0);for(var a=0;a<e.couponList.length;a++)e.couponList[a].isChecked=e.couponId==e.couponList[a].memberCouponId,4!=e.couponList[a].useCondition||e.couponList[a].storeId?4==e.couponList[a].useCondition||e.couponList[a].storeId?e.couponList[a].storeId&&0!=e.couponList[a].storeId&&(e.pink[a]=!0):e.blue[a]=!0:e.green[a]=!0}):2==e.type&&a.selectPlatformCoupons().success(function(t,o,s,i){e.couponList=t.data,0==e.couponList.length&&(e.isNull=!0);for(var a=0;a<e.couponList.length;a++)e.couponList[a].isChecked=e.couponId==e.couponList[a].memberCouponId,4!=e.couponList[a].useCondition||e.couponList[a].storeId?4==e.couponList[a].useCondition||e.couponList[a].storeId||(e.blue[a]=!0):e.green[a]=!0})},e.confirm=function(){var t=!1,o=0;angular.forEach(e.couponList,function(e,s){e.isChecked&&(t=!0,o=e.memberCouponId)}),t?e.getCoupons(o,e.type):(o=null,e.getCoupons(o,e.type))},e.getCoupons=function(t,o){1==o&&a.selectCoupons(e.sku,t).success(function(e,t,o,s){1==e.success&&r.goBack()}).error(function(){alert("使用优惠券失败")}),2==o&&a.selectPTCoupons(t).success(function(e,t,o,s){1==e.success&&r.goBack()}).error(function(){alert("使用优惠券失败")})},e.toDetail=function(e,t){var o=c.getUser().mid;i.go("couponsDetailTwo",{cId:e,userID:o,type:0,isUser:!0,couponId:t})}}]),APP.service("UseCouponsListService",["$http","UrlService",function(e,t){this.selectGoodsCoupons=function(o,s){var i={product:o};return e({method:"POST",url:t.getUrl("SELECT_GOODS_COUPONS"),params:i})},this.selectPlatformCoupons=function(){return e({method:"POST",url:t.getUrl("SELECT_PLATFORM_COUPONS")})},this.selectCoupons=function(o,s){var i={p:o,c:s};return e({method:"POST",url:t.getUrl("SELECT_COUPONS"),params:i})},this.selectPTCoupons=function(o){var s={c:o};return e({method:"POST",url:t.getUrl("SELECT_COUPONS_PT"),params:s})}}]),APP.controller("MyRaiseController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseHaveController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseNoController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("OrderDetailsController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher",function(e,t,o,s,i,a,n,r,c,l,d,p){o.orderSnDetail=a.orderSn,o.cOrderSnDetail=a.cOrderSn,o.orderDetailList=[];var u=r.getUser();o.loginMemberId=u.mid,o.uname=u.userName,o.userlevel=0,o.shareStoreId="";var g=a.cOrderId;o.loadData=function(e,t,s){i.getOrderDetail(e,t,s).success(function(e){e.success&&(o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.shareStoreId=e.data.storeDetail.ownerId)})},o.goOrderTrack=function(e){s.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void n.showToast("退款受理中，请稍后刷新查看状态！");i.checkRefund(e).success(function(t){t.success?s.go("applyRefund",{cOrderSn:e}):n.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?s.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):s.go("productDetail",{productId:o.orderDetailList.productDetail.productId,o2oType:o.orderDetailList.productDetail.o2oType,storeId:o.orderDetailList.storeDetail.ownerId})},o.asse=function(e,t,i){i?o.isShowPcTips=!0:s.go("assess",{orderId:e,cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),s=null;s=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){s.executeScript({
code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,s.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(p.nextDirection("forward"),s.go("orderManage")):n.showToast(e.message)})}n.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,g=a.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.orderSnDetail,o.cOrderSnDetail,g)}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.controller("RiskDescriptionController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("SupportersAgreementController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("crowd_funding_details_control",["$localstorage","LoginService","HomePageService","PopupService","CreditService","UrlService","$sce","$ionicSlideBoxDelegate","$rootScope","$stateParams","$state","$scope","CrowdFundingServerSingle","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(){p.memberId=m.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==p.memberId&&(p.settingsList=e[t].list,!0)}p.productDataId=l.zActivityId,p.productList=[],p.isShowBtn=!1,p.showQQ=!1,p.showWeChat=!1,p.isShowCopyButton=!1,p.showQRimg=!1,p.isSurplus=!1,p.isStarts=!1,p.isError=!1,p.isTrues=!0,p.detailsBanner=[],p.Math=window.Math,p.init=function(e){p.isError=!0,p.isTrues=!0,p.showShare=!1,p.detailsBanner=[],l.shareId&&(c.shareId=l.shareId),u.detailsListZC(e).success(function(e){1==e.success&&(p.productList=e.data,p.detailsBanner=e.data.imageUrls,r.$getByHandle("crowd_funding_details_slider").update(),r.$getByHandle("crowd_funding_details_slider").loop(!0),p.richText=n.trustAsHtml(e.data.activityDetails),p.activityStatus=p.productList.activityStatus,0==p.activityStatus?(p.isStatus="预热中",p.isShowBtn=!0,p.isStarts=!0,p.isSurplus=!1,p.isError=!0,p.isTrues=!0):1==p.activityStatus?(p.isStatus="众筹中",p.isShowBtn=!0,p.isSurplus=!0,p.isStarts=!1,p.isError=!0,p.isTrues=!0):2==p.activityStatus?(p.isStatus="众筹成功",p.isShowBtn=!1,p.isSurplus=!0,p.isError=!0,p.isTrues=!0):3==p.activityStatus?(p.isStatus="众筹失败",p.isSurplus=!0,p.isShowBtn=!1,p.isError=!1,p.isTrues=!1):100==p.activityStatus?(p.isStatus="计算中",p.isShowBtn=!1,p.isSurplus=!0,p.isError=!0,p.isTrues=!0):(p.isStatus="获取失败",p.isError=!0,p.isTrues=!1))})},p.goToSupport=function(e){d.go("crowd_funding_hot_redound",{zActivityId:e})},p.$on("$ionicView.beforeEnter",function(){p.isBuyer=t.getRole(),v(),p.init(p.productDataId)}),p.customerServe=function(){o.isWdHost().success(function(t){if(c.isWdHost=t.data.isHost,-1==c.isWdHost)d.go("login");else{if(window.cordova){var o=ionic.Platform.isAndroid(),s=null;s=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&g(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else p.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+p.productList.id+"&flag="+p.kfTocken);return}})},p.showShare=!1,c.isApp=!!window.cordova||void 0,p.share=function(){if(!m.getUser().mid)return void d.go("login");p.moreShow=!1,window.device&&window.device.hasNewShare&&(p.showShare=!p.showShare)},p.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功"),p.isShowCopyButton=!1):s.showToast("请下载APP执行此操作")},p.hideblackCover=function(){p.showShare=!1},p.shareToPlatform=function(e){var t=p.productList.activityName,o=p.productList.activityDsp||p.productList.activityName,s=p.productList.imageUrls[0],n=a.getShareLinkHeader()+"crowd_funding_details/"+p.productList.id+"/"+m.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,n,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,n,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,n,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,n,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,n,0,null,i.shareSuccessCallback),i.qqShare()),5==e?p.copeText(n):i.successShare()):alert("umeng undefined 只能在app分享"),p.showShare=!1}}]),APP.service("CrowdFundingServerSingle",["$http","UrlService",function(e,t){this.detailsListZC=function(o){var s={zActivityId:o};return e.get(t.getZCUrl("ZC_ACTIVITY_SINGLE_PAGE"),s)}}]),APP.controller("crowd_funding_hot_redound_control",["$rootScope","HomePageService","$stateParams","$state","$scope","CrowdFundingServer_hot","$timeout","UserService","GoodsService","CommonAddressService","LoginService",function(e,t,o,s,i,a,n,r,c,l,d){function p(){i.memberId=r.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==i.memberId&&(i.settingsList=e[t].list,!0)}i.redoundId=o.zActivityId,i.isHotPopup=!1,i.hotPopupNum=1,i.isExcess=!1,i.isGo=!1,i.isFull=!1,i.isStatus=!1,i.isStars=!1,i.isEnd=!1,i.isMore=!1,i.isFind=!1,i.isGo=!0,i.notGo=!1,i.settingsList="",i.isBuyer=d.getRole(),i.init=function(e){a.redoundList(e).success(function(e){1==e.success&&(i.isHotPopup=!1,i.hotRedoundList=e.data,i.redound_status=e.data.activityStatus,1==i.redound_status&&(i.isStatus=!0,i.isStars=!1,i.isEnd=!1,i.isFull=!1),0==i.redound_status&&(i.isStars=!0,i.isFull=!0,i.isStatus=!1,i.isEnd=!1),100!=i.redound_status&&2!=i.redound_status&&3!=i.redound_status||(i.isEnd=!0,i.isFull=!0,i.isStatus=!1,i.isStars=!1))})},i.$on("$ionicView.beforeEnter",function(){i.isHotPopup=!1,i.hotPopupNum=1,i.init(i.redoundId),p(),i.isBuyer=d.getRole()}),i.plus=function(){0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0):i.hotPopupNum>=i.moreNum?(i.isExcess=!0,i.hotPopupNum=i.moreNum):(i.hotPopupNum++,i.isExcess=!1),i.moreNum==i.hotPopupNum&&(i.isExcess=!0)},i.nus=function(){1==i.moreNum?i.isExcess=!0:0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0):i.isExcess=!1,i.hotPopupNum<=1?i.hotPopupNum=1:i.hotPopupNum--},i.hot_close=function(){i.isHotPopup=!1,i.hotPopupNum=1,i.isExcess=!1},i.goPostData=function(){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?s.go("login"):s.go("orderWrite",{zStallsId:i.goPostId,number:i.hotPopupNum})})},i.goSupport=function(e,t,o,s,a,n,r,c){i.isHotPopup=!1,i.hotImg=o,i.hotAmounts=t,i.goPostId=e,i.returnTime=s,i.freight=a,i.commissionRate=r,i.remainingNum=-1==n?"无限额":n,i.isLottery=c,i.commonFn(e,t,o,s,a,n,r,c)},i.commonFn=function(e,t,o,s,n,r,c,l){("无限额"==i.remainingNum||i.remainingNum>=1)&&(i.isGo=!0,i.isHotPopup=!0,a.redoundNum(e).success(function(e){1==e.success?(i.hotNumber=e.data,i.moreNum=e.data.num,i.hotPopupNum=1,i.isExcess=!1,i.limintNum=e.data.limit,"无限额"==i.limintNum?i.isFind=!0:i.isFind=!1,0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0,i.isGo=!1,i.notGo=!0):(i.isExcess=!1,i.isGo=!0,i.notGo=!1),i.moreNum,i.hotPopupNum):i.isFind=!0}))}}]),APP.service("CrowdFundingServer_hot",["$http","UrlService",function(e,t){this.redoundList=function(o){var s={zActivityId:o};return e.get(t.getZCUrl("ZC_ZSTALLS_SINGLE_PAGE"),s)},this.redoundNum=function(o){var s={zStallsId:o};return e.get(t.getZCUrl("ZC_CHECK"),s)},this.postProduct=function(o,s){var i={zStallsId:o,num:s};return e.post(t.getZCUrl("ZC_ORDER_COMMIT")+"?zStallsId="+i.zStallsId+"&number="+i.num)}}]),APP.controller("CrowdFundingHomeControl",["$timeout","$ionicScrollDelegate","PopupService","CreditService","UrlService","$ionicSlideBoxDelegate","$rootScope","$scope","CrowdFundingServer","UserService","GoodsService","CommonAddressService","$stateParams","$state","$ionicPopup","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){r.typeNumber=u.type,r.typeNumber=2==r.typeNumber?2:1,r.flagNum=!1;var h=[2,3,1];r.selectedIndex=0,r.isFindTab=!0,r.brandList=[],r.HomeBanner=[],r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,r.moreProduct=!0,r.productList=[],r.newsList=[],r.endList=[],r.soonList=[],r.hasmore=!1,r.page=1,r.isHasData=!1,r.isMoreData=!0,r.Math=window.Math,r.init=function(e,o,s){u.shareId&&(n.shareId=u.shareId),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]}),f.getUnReadMsg().success(function(e){e.data>0?r.flagNum=!0:r.flagNum=!1}),t.scrollTop(),c.bannerList(r.typeNumber).success(function(e){1==e.success?(r.HomeBanner=e.data.zBannerList,r.peopleList=e.data.top3ZActivity,a.$getByHandle("crowd_funding_slider").update(),a.$getByHandle("crowd_funding_slider").loop(!0),0==r.peopleList.length?(r.isHasData=!0,r.isMoreData=!1):(r.isMoreData=!0,r.isHasData=!1)):(r.isHasData=!0,r.isMoreData=!1)}),c.moreData(e,o,r.typeNumber).success(function(e){1==e.success&&(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,1==o?(r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<r.newsNum))}),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]})},r.calculateWH=function(e,t){var o=new Image;o.src=e,o.width>o.height?$("#img"+t).attr("width","100%"):$("#img"+t).attr("height","100%")},r.$on("$ionicView.beforeEnter",function(){r.page=1,t.scrollTop(),r.init(h[r.selectedIndex],r.page)}),r.showShare=!1,n.isApp=!!window.cordova||void 0,r.share=function(){if(!l.getUser().mid)return void g.go("login");r.moreShow=!1,window.device&&window.device.hasNewShare&&(r.showShare=!r.showShare)},r.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),o.showToastShort("复制成功"),r.isShowCopyButton=!1):o.showToast("请下载APP执行此操作")},r.hideblackCover=function(){r.showShare=!1},r.shareToPlatform=function(e){var t="顺逛众筹为您提供与众不同的品质生活",o="http://m.ehaier.com/www/img/ic_aboutUS_1.png",a=i.getShareLinkHeader()+"crowdFunding/"+l.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback),s.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback),s.qqShare()),5==e?r.copeText(a):s.successShare()):alert("umeng undefined 只能在app分享"),r.showShare=!1},r.crowdTab=function(e){r.page=1,c.changeSuccess(h[e]).success(function(o,s,i,a){1==o.success&&(r.page=1,r.selectedIndex=e,0==r.selectedIndex?(r.isTab=!0,r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):r.newsList=[]})):1==r.selectedIndex?(r.isFindEnd=!0,r.isFindSoon=!1,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.endNum=e.data.zActivitylistTotalCount,r.endList=e.data.zActivitylist,r.hasmore=r.endList.length<r.endNum):r.endList=[]})):2==r.selectedIndex?(r.isFindEnd=!1,r.isFindSoon=!0,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.soonNum=e.data.zActivitylistTotalCount,r.soonList=e.data.zActivitylist,r.hasmore=r.soonList.length<r.soonNum):r.endList=[]})):r.isTab=!1)})},r.loadMore=function(){r.$broadcast("scroll.infiniteScrollComplete"),r.page+=1,r.loadMoreProducts(h[r.selectedIndex],r.page,r.typeNumber)},r.loadMoreProducts=function(e,t,o){c.moreData(e,t,r.typeNumber).success(function(e){1==e.success?(r.isFind?(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<e.data.zActivitylistTotalCount):r.isFindEnd?(r.endList=r.endList.concat(e.data.zActivitylist),r.hasmore=r.endList.length<e.data.zActivitylistTotalCount):r.isFindSoon&&(r.soonList=r.soonList.concat(e.data.zActivitylist),r.hasmore=r.soonList.length<e.data.zActivitylistTotalCount),r.$broadcast("scroll.infiniteScrollComplete")):(r.$broadcast("scroll.infiniteScrollComplete"),r.hasmore=!1)})}}]),APP.service("CrowdFundingServer",["$http","UrlService",function(e,t){this.bannerList=function(o){var s={from:o};return e.get(t.getZCUrl("ZC_INDEX"),s)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getZCUrl("ZC_INDEX"),s)},this.moreData=function(o,s,i){var a={type:o,page:s,from:i};return e.get(t.getZCUrl("ZC_INDEX_ACTIVITY"),a)}}]),APP.controller("crowdfunding_child_end_control",["$scope","CrowdFundingServer_end","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a){}]),APP.service("CrowdFundingServer_end",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_new_control",["$state","$scope","CrowdFundingServer_new","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a,n){t.goDetails=function(){e.go("crowd_funding_details")}}]),APP.service("CrowdFundingServer_new",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_soon_control",["$scope","CrowdFundingServer_soon","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a){e.init=function(){t.bannerList().success(function(t){e.HomeBanner=t.data.zBannerList,e.activityList=t.data.top3ZActivity,e.list=0,e.loadMore=function(){},e.selectTab=function(t){i.changeSuccess(typeList[t]).success(function(o,s,a,n){1==o.success&&(i.getFilterData().success(function(t){t.success&&(e.brandList=t.data.brandList,void 0!=t.data.filterMap?(e.otherList=t.data.filterMap.lstAttributes,e.resetFilter()):(e.otherList=[],e.resetFilter()))}),e.page=1,e.selectedIndex=t)})}})},e.init()}]),APP.service("CrowdFundingServer_soon",["$http","UrlService",function(e,t){this.bannerList=function(){return e.get(t.getZCUrl("ZC_INDEX"))}}]),APP.controller("orderWriteController",["$localstorage","InAppBrowserService","UserService","$scope","$stateParams","$rootScope","$state","orderWriteService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){s.invoiceHead=void 0,s.zzsInvoice=void 0,s.htmlContent=i.content,s.checkStatus=!0,s.list={},s.zStallsId=i.zStallsId,s.number=i.number,s.$on("$ionicView.afterLeave",function(e,t){a.isInvoice=!1}),s.$on("$ionicView.beforeEnter",function(e,t){s.init(s.zStallsId,s.number)}),s.init=function(e,t){r.getZStallsSinglePage(e,t).success(function(e){s.list=e.data})},s.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?t.open(g.getHead()+"mstore/sg/helpDetail.html?id="+e,o):n.go("helpDetail",{helpId:e,content:o})},s.checkInfo=function(e){s.checkStatus=!s.checkStatus},s.toInvoice=function(e){n.go("invoiceSetup",{invoiceHead:s.list.billCompany,invoiceType:e,enterPage:0})},s.toSubmit=function(){if(window.cordova?s.storeId=e.get("storeId",a.globalConstant.storeId):s.storeId=a.shareId?a.shareId:e.get("storeId",a.globalConstant.storeId),s.list.memberAddress)if(s.checkStatus)if(/^[^&<>]+$/.test(s.regAddress))r.commitOrder(s.zStallsId,s.number,s.list.invoiceType,s.storeId).success(function(e,t,o,s){if(1==e.success)n.go("paymentxyz",{orderSn:e.data,totalAmount:e.totalCount});else{c.confirm({template:e.message,okText:"返回上一页",cancelText:"留在此页"}).then(function(e){e&&m.goBack(-1)})}}).error(function(){});else{c.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{c.alert({template:"支持者协议必须选中！",okText:"知道了"})}else{c.alert({template:"收货地址必须填写！",okText:"知道了"})}}}]),APP.service("orderWriteService",["$http","UrlService",function(e,t){this.getZStallsSinglePage=function(o,s){return e({method:"POST",url:t.getZCUrl("ZC_ORDER_COMMIT"),params:{zStallsId:o,number:s}})},this.commitOrder=function(o,s,i,a){return e({method:"POST",url:t.getZCUrl("ZC_COMMIT_ORDER"),params:{zStallsId:o,number:s,invoiceType:i,sharePeopleId:a}})}}]),APP.controller("submitSuccessController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("flashsaleCtrl",["$stateParams","$scope","$state","$http","$interval","UrlService","flashService","GoodsService","$rootScope","$localstorage","$ionicSlideBoxDelegate","$ionicHistory","UserService","$ionicScrollDelegate","BannerThemeService",function($stateParams,$scope,$state,$http,$interval,UrlService,flashService,GoodsService,$rootScope,$localstorage,$ionicSlideBoxDelegate,$ionicHistory,UserService,$ionicScrollDelegate,BannerThemeService){function countDown(e,t){$scope.endT=t-e,timer=$interval(function(){$scope.endTt=Format(Math.floor($scope.endT/86400)),$scope.endTh=Format(Math.floor(($scope.endT-86400*$scope.endTt)/3600)),$scope.endTm=Format(Math.floor(($scope.endT-86400*$scope.endTt-3600*$scope.endTh)/60)),$scope.endTs=Format($scope.endT-86400*$scope.endTt-3600*$scope.endTh-60*$scope.endTm),$scope.endT--,$scope.Timetotal=$scope.endTh+":"+$scope.endTm+":"+$scope.endTs,-1==$scope.endT&&$interval.cancel(timer)},1e3)}function Format(e){return e=e<10?"0"+e:e}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.index=0,$scope.index1=0,$scope.isWd=!1,$scope.flashInfoTwototal=[],$scope.flashInfoTwo=[],$scope.storeId=0;var timer,NowTer;$scope.endT="",$scope.endTt="",$scope.endTh="",$scope.endTm="",$scope.endTs="",$scope.Timetotal="",$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(re){var obj=eval(re.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId,flashService.getFlashone($scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e){if(1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,e.data.dates&&0!=e.data.dates[$scope.index].list.length){$scope.systemTime=e.data.systemTime,$scope.flashInfoTwototal=e.data,$scope.flashInfoTwo=$scope.flashInfoTwototal.dates[$scope.index].list;for(var t=$scope.flashInfoTwo,o=0;o<t.length;o++){if($scope.systemTime>=t[o].startTime&&$scope.systemTime<=t[o].endTime){$scope.index1=o,NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=t[o].endTime&&($interval.cancel(NowTer),$scope.init())},1e3);break}if($scope.systemTime<t[o].startTime){$scope.index1=o,NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=t[o].startTime&&($interval.cancel(NowTer),$scope.init())},1e3);break}}$interval.cancel(timer),$scope.systemTime>=$scope.flashInfoTwo[$scope.index1].startTime&&$scope.systemTime<=$scope.flashInfoTwo[$scope.index1].endTime?countDown($scope.systemTime/1e3,$scope.flashInfoTwo[$scope.index1].endTime/1e3):$scope.systemTime<$scope.flashInfoTwo[$scope.index1].startTime&&countDown($scope.systemTime/1e3,$scope.flashInfoTwo[$scope.index1].startTime/1e3)}})}),flashService.slidedata().success(function(e){$scope.bannerList=e.data.topBanner,$scope.others=e.data.others,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("flashsale_slide").loop(!0)})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.changecolor=function(e){$scope.index=e,$ionicScrollDelegate.$getByHandle("hxScroll").resize(),$scope.flashInfoTwo=$scope.flashInfoTwototal.dates[e].list;for(var t=0;t<$scope.flashInfoTwo.length;t++){if($scope.systemTime>=$scope.flashInfoTwo[t].startTime&&$scope.systemTime<=$scope.flashInfoTwo[t].endTime){$scope.index1=t;break}if($scope.systemTime<$scope.flashInfoTwo[t].startTime){$scope.index1=t;break}}$interval.cancel(timer),$scope.systemTime>=$scope.flashInfoTwo[$scope.index1].startTime&&$scope.systemTime<=$scope.flashInfoTwo[$scope.index1].endTime?countDown($scope.systemTime/1e3,$scope.flashInfoTwo[$scope.index1].endTime/1e3):$scope.systemTime<$scope.flashInfoTwo[$scope.index1].startTime&&countDown($scope.systemTime/1e3,$scope.flashInfoTwo[$scope.index1].startTime/1e3)},$scope.changetime=function(e){$scope.index1=e,$interval.cancel(timer),$scope.systemTime>=$scope.flashInfoTwo[e].startTime&&$scope.systemTime<=$scope.flashInfoTwo[e].endTime?countDown($scope.systemTime/1e3,$scope.flashInfoTwo[e].endTime/1e3):$scope.systemTime<$scope.flashInfoTwo[e].startTime&&countDown($scope.systemTime/1e3,$scope.flashInfoTwo[e].startTime/1e3)},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"!=t.direction&&$scope.init()}),$scope.goback=function(){$interval.cancel(timer),$interval.cancel(NowTer),$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()},$rootScope.$on("$stateChangeStart",function(e,t,o,s,i){"flashsale"==s.name&&($interval.cancel(timer),$interval.cancel(NowTer))})}]),APP.service("flashService",["$http","UrlService",function(e,t){this.PrefixInteger=function(e){return e<10?"0"+e:e},this.getFlashone=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,from:n};return e.get(t.getNewUrl("NEW_FLASHSALE"),r)},this.slidedata=function(){var o={type:2};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.factory("$localstorage",["$window",function(e){return{set:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},setObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")},setArray:function(t,o){e.localStorage[t]=JSON.stringify(o)},getArray:function(t){return JSON.parse(e.localStorage[t]||"[]")}}}]),APP.service("CommonAddressService",["AreaService","GoodsService","CacheService","$rootScope","$localstorage",function(e,t,o,s,i){var a={};return{addAddressInfo:function(){e.getLocalArea().then(function(e){var i=e.regeocode.addressComponent;t.getAddressId(i.province,i.city,i.district,i.township,i.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){var n=e.data,r=i.district+"/"+i.township;-1==window.location.href.indexOf("sg_rn_app")?t.addAddress(n.provinceId,n.cityId,n.regionId,r,n.streetId).success(function(e){s.dingWeiSuccess=!0,s.globalConstant.positionStatus?s.globalConstant.autoPosition=r:s.globalConstant.autoPosition="定位失败：崂山区/中韩街道",a={provinceId:n.provinceId,cityId:n.cityId,areaId:n.regionId,streetId:n.streetId,provinceName:i.province,cityName:i.city,regionName:i.district,streetName:i.township},setTimeout(function(){s.$broadcast("CACHE_SUCCESS",a)},2e3),o.set("addressInfo",a)},function(e){}):(s.dingWeiSuccess=!0,s.globalConstant.positionStatus?s.globalConstant.autoPosition=r:s.globalConstant.autoPosition="定位失败：崂山区/中韩街道",a={provinceId:n.provinceId,cityId:n.cityId,areaId:n.regionId,streetId:n.streetId,provinceName:i.province,cityName:i.city,regionName:i.district,streetName:i.township},setTimeout(function(){s.$broadcast("CACHE_SUCCESS",a)},2e3),o.set("addressInfo",a))}},function(e){})},function(e){a={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"};var s=a.regionName+"/"+a.streetName;t.addAddress(a.provinceId,a.cityId,a.areaId,s,a.streetId).success(function(e){o.set("addressInfo",a)},function(e){})})},getAddressInfo:function(){return o.get("addressInfo")?o.get("addressInfo"):a={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"}}}}]),APP.config(commonConfig),APP.config(route),APP.config(interceptors),APP.config(["$httpProvider",function(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"]}]),APP.factory("AreaService",["$rootScope","UrlService","$q","$http",function(e,t,o,s){return{init:function(){var e=o.defer();return navigator.geolocation.getCurrentPosition(function(t){e.resolve(t)},function(t){e.reject(t)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),e.promise},getLocalArea:function(){var t=o.defer();return AMap.plugin("AMap.Geocoder",function(){geocoder=new AMap.Geocoder({city:"010"});var o=[e.globalConstant.lon,e.globalConstant.lat];geocoder.getAddress(o,function(e,o){"complete"===e&&"OK"===o.info?t.resolve(o):t.reject(o)})}),t.promise}}}]),APP.service("CacheService",[function(){var e={};this.get=function(t){return e[t]},this.set=function(t,o){return e[t]=o},this.pop=function(t){var o=e[t];return e[t]="",o}}]),APP.factory("CalculateStrLength",function(){var e={};return e.limitStrLength=function(e,t){for(var o=0,s=0;s<e.length;s++)if(e.charCodeAt(s)>127||94==e.charCodeAt(s)){if((o+=2)>t)return e.substring(0,s-1)+"..."}else if(++o>t)return e.substring(0,s-1)+"...";if(o<=t)return e},e.dealPrice=function(e){if(null!=e&&void 0!=e){var e=e.toString(),t=e.indexOf(".");if(-1==t)return{priceInt:e,priceFloat:"00"};return{priceInt:e.substring(0,t),priceFloat:e.substring(t+1).substring(0,2)}}},e}),APP.service("CreditService",["UrlService","$http","$timeout",function(e,t,o){this.shareSuccessCallback=function(o){var s={};arguments.length>1&&(s=arguments[1]);var i=e.getUrl("SHARESUCCESS"),a=[];for(var n in s)a.push(n+"="+s[n]);t.get(i+"?"+a.join("&")).success(function(e){e.success}).error(function(e,t,o,s){})},this.successShare=function(e){},this.qqShare=function(){};var s=null;this.getGameId=function(o){if(s)o(s);else{var i=e.getUrl("FIND_GAME_ID");t.get(i).success(function(e){e.success?(s=e.data,o(e.data)):o("f265383f0538834f")}).error(function(e,t,s,i){o("f265383f0538834f")})}}}]),APP.service("FileUploadService",["$http","UrlService",function(e,t){if(window.FileTransfer){var o=new FileTransfer;this.upload=function(e,t,s,i,a,n,r,c){var l=new FileUploadOptions;l.fileKey=s||"imageFile",l.fileName=i||e.substr(e.lastIndexOf("/")+1),a&&(l.mimeType="image/jpeg");var d={};d.userName="18560683520",l.params=d,o.upload(e,encodeURI(t),r,c,l)}}}]),APP.filter("ImageFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/ic_haier_2.png"}}]).filter("ImageUserFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/user.jpg"}}]).filter("ImageTopicFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/quanzi.png"}}]).filter("scoleFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/scoleimg.png"}}]).filter("bgImgFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/bgImg.png"}}]).filter("Num4Filter",[function(){return function(e){return parseInt(e)>9999&&(e="9999+"),e}}]).filter("Num2Filter",[function(){return function(e){return parseInt(e)>99?e="99+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("BigNumFilter",[function(){return function(e){return parseInt(e)>99999?e="10万+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("bluetext",["$sce","$log",function(e,t){return function(t,o){if(!o)return e.trustAsHtml(t);var s=new RegExp(o,"gi"),i=t.replace(s,'<span style="color: #0076fd">$&</span>');return e.trustAsHtml(i)}}]).filter("cutTwoFilter",[function(){return function(e){return"number"==typeof number&&(e=e.toFixed(2),e=parseFloat(e)),e}}]).filter("formatNumber",function(){return function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}).filter("addImgURLPostfix",[function(){return function(e,t,o){return/cdn[23][0-9].ehaier.com/.test(e)&&(e=e+"@"+t+"_"+o),e}}]).filter("keepInt",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".");return e.toFixed(2).toString().slice(0,t)}return 0}}).filter("keepFloat",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".");return e.toFixed(2).toString().slice(t)}return".00"}}).filter("encryptPhone",function(){return function(e){return 11==e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):e}}).filter("totext",[function(){return function(e){return"1"==e?"收入":"支出"}}]).filter("chinaDate",function(){return function(e){return e.substring(4,6)+"月"+e.substring(6,8)+"日"}}).filter("FilterRealName",function(){return function(e){if(e.length>=2){for(var t=e.length,o="",s=0;s<t-1;s++)o+="*";return e=o+e.substring(t-1,t)}return e}}).filter("flashsaleDenum",function(){return function(e){return 0==e.substring(0,1)?e=e.substring(1,5):e}}).filter("delLing",function(){return function(e){return e="0"==e.substring(5,6)?e.substring(6).replace("/","月")+"日":e.substring(5).replace("/","月")+"日"}}).filter("collectsFilter",[function(){return function(e){
return e<1e4?e:e=e%100>0&&e%100<50?(e/1e4).toFixed(2)+.01:(e/1e4).toFixed(2)}}]).filter("datachange",function(){return function(e){return e=e.replace("年","/").replace("月","/").replace("日","")}}).filter("rewardToword",function(){return function(e){return"YC"==e&&(e="育成奖励"),"BC"==e&&(e="补差奖励"),"ST"==e&&(e="生态奖励"),"JY"==e&&(e="经营奖励"),"FWB"==e&&(e="服务兵奖励"),"PT"==e&&(e="平台奖励"),"PX"==e&&(e="培训奖励"),e}}).filter("highlight",["$sce","$log",function(e,t){return function(o,s){if(t.info("text: "+o),t.info("search: "+s),!s)return e.trustAsHtml(o);o=encodeURI(o),s=encodeURI(s);var i=new RegExp(s,"gi"),a=o.replace(i,'<span style="color:#2979FF">$&</span>');return a=decodeURI(a),t.info("result: "+a),e.trustAsHtml(a)}}]).filter("whiteUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),APP.service("H5LocationService",[function(){this.getLocation=function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e):alert("Geolocation is not supported by this browser.")}}]),APP.service("IMService",["$rootScope","$ionicPopup","$interval","$ionicLoading","UrlService","UserService",function(e,t,o,s,i,a){function n(){for(var e=[],t="0123456789abcdef",o=0;o<36;o++)e[o]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}var r=null,c=null,l=null,d=this;this.destroyWebSocket=function(e){if(null!=c)try{c.disconnect(function(){if(c=null,null!=l){try{l.close(),l=null}catch(e){}e&&window.setTimeout(e,3e3)}})}catch(e){}},this.validateWebSocket=function(){null!=l&&1!=l.readyState&&this.initWebSocket()},this.initWebSocket=function(t){r&&t||t&&(r=t);try{l=new WebSocket(i.getWSUrl("MESSAGE_WS_URL")),c=Stomp.over(l),c.debug=function(){window.console&&console.log&&console.log.apply};var o=function(){$.ajax({url:i.getUrl("REGIST_MESSAGE_TOKEN"),type:"post",dataType:"json",success:function(t){if(t.success){var o=t.data,s=o;e.token=o;var i="stomp-subscription-"+n();c.subscribe("/exchange/message_topic_exchange/"+s,function(e){r(JSON.parse(e.body))},{"x-queue-name":i});c.subscribe("/exchange/message_fanout_exchange",function(e){r(JSON.parse(e.body))},{"x-queue-name":i})}else d.destroyWebSocket()}})},s=function(){d.destroyWebSocket(d.initWebSocket)};c.connect(i.getMQAuth().username,i.getMQAuth().password,o,s,"/")}catch(e){}}}]),APP.factory("InAppBrowserService",["PopupService","$rootScope",function(e,t){ionic.Platform.isAndroid();return window.device&&window.device.hasNewBrowser?{open:function(t,o){var s=ionic.Platform.isAndroid(),i=null;return i=s?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),i.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&i.close(),s?e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1)||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1?i.showMyButton():i.hideMyButton():e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1||e.url.indexOf("helpDetail")>-1)?(i.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),i.addMyTitle(o))):i.hideMyButton()}),i.addEventListener("loaderror",function(t){setTimeout(function(){i.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),i}}:{open:function(t,o){var s=ionic.Platform.isAndroid(),i=null;return i=s?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),i.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&i.close(),s||(e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("helpDetail")>-1)?(i.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),i.addMyTitle(o))):i.hideMyButton())}),i.addEventListener("loaderror",function(t){setTimeout(function(){i.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),i}}}]),APP.directive("inputClear",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,s){return{restrict:"E",replace:!0,scope:{},require:"ngModel",template:'<i class="icon ion-close-circled" ng-show="isShow" style="font-size: 20px ;vertical-align: middle;color: #9b9b99;position: relative;right: 25px;margin-left: -4px;display: inline-block;width: 0"></i>',link:function(e,t,o,i){e.isShow=!1;var a=t[0].previousElementSibling;a.onblur=function(){s(function(){e.isShow=!1})},a.onfocus=function(){s(function(){a.value&&(e.isShow=!0)})},e.$watch(function(){return a.value},function(t,o,s){angular.equals(t,o)||(e.isShow=!!a.value)}),t.on("click",function(o){t[0].focus(),i.$setViewValue(""),e.isShow=!1;var n=a.blur;a.blur=function(){},s(function(){a.blur=n},100)})}}}]),APP.directive("goTop",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,s){return{restrict:"AE",replace:!0,template:'<img ng-src="{{imgBaseURL}}img/icon_toTop.png" style="width: 44px;"  ng-show="showGoTop"/>',link:function(e,t,o){var i=void 0,a=void 0,n=!1;e.showGoTop=!1,s(function(){var s="z-index:10;width:44px;position:fixed;right:10px;bottom:"+(o.offset||20)+"px!important";i=e.$$childHead.scrollCtrl,a=i.element,t[0].setAttribute("style",s)},100);var r=function(){if(i&&i.getScrollPosition()&&!n){var t=i.getScrollPosition().top;e.showGoTop=t>500,n=!0,e.$apply(function(){n=!1},500)}};s(function(){ionic.on("scroll",r,a)},1e3),t.on("click",function(){i.scrollTop(!0),s(function(){e.showGoTop=!1},200)})}}}]),APP.service("MediaService",["$http","UrlService","$ionicPopup","$rootScope",function(e,t,o,s){function i(e){try{e&&e.data&&(d?(c+=e.data.length,r=r.concat(e.data)):(c=e.data.length,r=e.data,d=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function a(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}this.getPicture=function(e,t,o){navigator.camera&&navigator.camera.getPicture&&(0==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==e&&navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}))};var n={},r=[],c=0;window.URL=window.URL||window.webkitURL;var l="",d=!0;this.addAudioEventOnWindow=function(){window.addEventListener("audioinput",i,!1),window.addEventListener("audioinputerror",a,!1)},this.removeAudioEventOnWindow=function(){window.removeEventListener("audioinput",i),window.removeEventListener("audioinputerror",a)},this.startCapture=function(e,t){try{window.audioinput&&!audioinput.isCapturing()&&(n={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(n))}catch(e){alert("startCapture exception: "+e)}};var p=function(e,t,o){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),c=0;var i=new WavAudioEncoder(n.sampleRate,n.channels);i.encode([r]);var a=i.finish("audio/wav");window.resolveLocalFileSystemURL(s.isIOS?cordova.file.dataDirectory:cordova.file.externalDataDirectory,function(s){var i="temp"+(new Date-0)+".wav";s.getFile(i,{create:!0},function(s){s.createWriter(function(i){i.write(a),setTimeout(function(){l=s.toURL(),document.getElementById(e).src=l,document.getElementById(t).load(),o&&o()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};this.stopCapture=p;var u=function(){window.resolveLocalFileSystemURL(l,function(e){e.remove(function(){d=!1},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};this.deleteMedia=u,this.getAudioUrl=function(){return l}}]),APP.service("PlatformService",[function(){this.getPlatform=function(){return window.cordova?"APP":"WEB"}}]),APP.service("PopupService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService",function(e,t,o,s,i){this.showConfirm=function(e,o,s,i){t.confirm({title:e||"提示",okText:i||"确定",cancelText:"取消",template:o||"默认提示信息"}).then(s)},this.showAlert=function(e,o,s){t.alert({title:e||"提示",okText:"确定",template:o||"默认提示信息"}).then(s)},this.showToast=function(e){var t=e||"默认提示消息";s.show({template:'<div style="background:rgba(0,0,0,0.4);border-radius:4px;padding:8px;">'+t+"</div>",duration:2e3})},this.goldIncrease=function(t){e.curMsg=0,s.show({template:'<div style="width:240px;position:absolute;left:50%;margin-left:-120px;bottom:100px;background:rgba(0,0,0,0.4);border-radius:18px;padding:8px;">'+t+"</div>",duration:2e3,animation:"fade-in",showBackdrop:!1})},this.showGoodCoupon=function(e){$("<div/>").html('<div style="width:100%;height:100%;position:fixed;background: rgba(0,0,0,0.70);z-index:100;top:0;left:0;" flex="cross:center main:center">\n    <div style="width:250px;height:264px;background: #fff url(http://cdn09.ehaier.com/shunguang/H5/www/img/im-quant@2x.png) no-repeat;background-size:100% 185px;border-radius: 8px;position:relative;">\n      <div style="position:absolute;width:24px;height:24px;top:0;right:0;" onclick="closeGoodCoupon(this)">\n        <img style="width:100%;height:100%;padding:5px;" src="http://cdn09.ehaier.com/shunguang/H5/www/img/ic-close@2x.png">\n      </div>\n      <div style="height:185px;padding:32px 24px 0;">\n        <div style="font-size: 12px;color: #fff;text-shadow: 0 1px 1px rgba(111,0,0,0.75);text-align:center;">贵店开张，价值<span style="font-size:20px;color:#FFE447;">'+e+'</span>优惠券大礼包放入你的钱包，供你任性消费！</div>\n      </div>\n      <div style="height:79px;padding-top:17px">\n        <div onclick="gomyCouponsList(this)" style="background: #f40;box-shadow: 0 1px 2px 0 rgba(255,68,0,0.50);border-radius: 78px;height:44px;margin:0 21px;font-size: 16px;color: #fff;text-align:center;line-height:44px;">我的优惠券</div>\n    </div>\n    </div>\n  </div>').appendTo($("body"))},this.levelUp=function(e,t,o){s.show({template:'<div style="width:335px;position:absolute;top:-2px;left:0;bottom:0;right:0;margin: auto;z-index:10;">\n                    <img src="http://cdn09.ehaier.com/shunguang/H5/www/img/levelUp.png" style="width:100%;position:absolute;top:0;left:0;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'<11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage'+t+'.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'==11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage mengzhu.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <p style="width:82px;height:28px;line-height:28px;font-size:20px;color:#ff3232;letter-spacing:-0.49px;text-align:center;\n                    position: absolute;top:72px;left:10px;bottom:0;right:0;margin: auto;"\n                    >'+e+'</p>\n                    <p ng-if="'+o+'" style="height:20px;position: absolute;top:253px;left:10px;bottom:0;right:0;margin: auto;font-size:14px;color:#4a4a4a;letter-spacing:-0.34px;text-align:center;">距离下一个级别还有'+o+'成长值</p>\n                    <div style="width:24px;height:24px;position: absolute;top:-210px;left:0;bottom:0;right:-220px;margin: auto;"\n                    onclick="closeLevelUpPop()" ></div>\n                </div>\n                <div class="myBackDrop" style="width:100%;height:100%;position:fixed;top:0;left:0;background:rgba(0,0,0,0.3);visibility: visible;"></div>',animation:"fade-in"})},this.dynamic=function(e){s.show({template:'<div style="width:70%;height:35px;line-height:35px;background:#000;opacity:0.5;position:absolute;top:5px;left:8px;z-index:99;border-radius:5px;font-size:12px;">'+e+"</div>",duration:3e3,showBackdrop:!1})},this.showToastShort=function(e){s.show({template:e||"默认提示消息",duration:1e3})},this.showToastWithTime=function(e,t){s.show({template:e||"默认提示消息",duration:t})},this.showImgViewer=function(e,o){var s="";if(!arguments[1]||arguments[1]){var a="default.png";null!=e&&""!=e&&(a=e),s=i.getImageUrlData()+a}else s=e;var n=t.show({template:'<img ng-src="'+s+'">',title:"",subTitle:"",cssClass:"jsh-img-viewer",buttons:[{text:"&#xe642;",type:"jsh-img-viewer-close dhcfont",onTap:function(e){n.close()}}]})},this.dialog=function(e){var t=$("<div style='background-color:rgba(0,0,0,0.5);width:100%;position:absolute;top:-2px;left:0;bottom:0;right:0;margin: auto;z-Index:10;display:flex;flex-direction: column;align-content:center;justify-content:center;align-items:center'/>").append(e.content).appendTo($("body"));return e.onOpen&&e.onOpen.call(t),e.buttons&&$(e.buttons).each(function(){this.handler&&$(this.selector).click(this.handler)}),t}}]),APP.factory("UserService",["$rootScope","$localstorage",function(e,t){var o,s=function(){this.mobile=void 0,this.rankName=void 0,this.cartNumber=void 0,this.sessionKey=void 0,this.userId=void 0,this.token=void 0,this.userName=void 0,this.mid=void 0,this.avatarImageFileId=void 0,this.nickName=void 0,this.gender=void 0,this.email=void 0,this.birthday=void 0,this.sessionValue=void 0,this.loginName=void 0,this.accessToken=void 0,this.ucId=void 0};return{getUser:function(){if(!o){o=new s;var e=t.getObject("USER_CACHE_KEY");e&&(o.mobile=e.mobile,o.rankName=e.rankName,o.cartNumber=e.cartNumber,o.sessionKey=e.sessionKey,o.userId=e.userId,o.token=e.token,o.userName=e.userName,o.mid=e.mid,o.avatarImageFileId=e.avatarImageFileId,o.nickName=e.nickName,o.gender=e.gender,o.email=e.email,o.birthday=e.birthday,o.sessionValue=e.sessionValue,o.loginName=e.loginName,o.accessToken=e.accessToken,o.ucId=e.ucId)}return o},setUser:function(i){o||(o=new s),i&&(o.mobile=i.mobile,o.rankName=i.rankName,o.cartNumber=i.cartNumber,o.sessionKey=i.sessionKey,o.userId=i.userId,o.ucId=i.ucId,o.token=i.token,o.userName=i.userName,o.mid=i.mid,o.avatarImageFileId=i.avatarImageFileId,o.nickName=i.nickName,o.gender=i.gender,o.email=i.email,o.birthday=i.birthday,o.sessionValue=i.sessionValue,o.loginName=i.loginName,o.accessToken=i.accessToken,t.setObject("USER_CACHE_KEY",o),e.$broadcast("USER:REFLASH",o))},clearUser:function(){o&&(o.mobile=void 0,o.rankName=void 0,o.cartNumber=void 0,o.sessionKey=void 0,o.userId=void 0,o.token=void 0,o.userName=void 0,o.mid=void 0,o.avatarImageFileId=void 0,o.nickName=void 0,o.gender=void 0,o.email=void 0,o.birthday=void 0,o.sessionValue=void 0,o.accessToken=void 0),t.setObject("USER_CACHE_KEY",null),e.$broadcast("USER:CLEAR")},isUserLogin:function(){return o||(o=this.getUser()),!!o.token}}}]),APP.service("VersionService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService","$http",function(e,t,o,s,i,a){window.cordova&&ionic.Platform.platform().indexOf("ios");this.checkVersion=function(){return}}]),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".play-sound {\n    padding-top: 5px;\n    padding-bottom: 5px;\n}\n\n.play-sound svg {\n    margin-bottom: -3px\n}\n\n.play-sound :first-child {\n    min-width: 50px;\n    max-width: 180px;\n    text-align: left;\n    ;\n}\n\n.play-sound i {\n    box-shadow: none !important;\n}\n\n.play-sound i::before {\n    transform: rotate(45deg);\n    color: #808080;\n}\n\n.play-sound span {\n    font-size: 8px;\n    color: #9D9D9B;\n    vertical-align: -webkit-baseline-middle;\n}\n\n.play-sound .refresh {\n    padding: 3px;\n    color: #d50000;\n    font-size: 20px;\n}\n\n.play-sound .new {\n    color: #d50000;\n}\n\n.play-sound-right {\n    transform: rotate(180deg);\n}\n\n.play-sound-right :first-child {\n    background-color: #FFFFFF !important;\n}\n\n.play-sound-right span {\n    display: inline-block;\n    transform: rotate(180deg) !important;\n}\n\n.play-sound-right div i::before {\n    color: #DDDDDD !important;\n}"),function(e){try{e=angular.module("play-sound.templates")}catch(t){e=angular.module("play-sound.templates",[])}e.run(["$templateCache",function(e){e.put("play-sound.html",'<div class="play-sound">\n    <div class="button padding-horizontal" style="padding: 0;padding-left: 8px;" ng-disabled="isLoading" ng-click="play()">\n        <img class="" src="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/playaudio.png" ng-show="!isLoading" />\n        <svg width=\'15px\' height=\'15px\' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" ng-show="isLoading"\n             preserveAspectRatio="xMidYMid" class="uil-spin" style="    position: relative;bottom: 12px;">\n            <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>\n            <g transform="translate(50 50)">\n                <g transform="rotate(0) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(45) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.12s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.12s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(90) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.25s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.25s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(135) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.37s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.37s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(180) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.5s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.5s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(225) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.62s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.62s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(270) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.75s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.75s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(315) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.87s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.87s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n            </g>\n        </svg>\n    </div>\n    <span ng-bind="dur|DurFilter" ng-if="!isLoading&&!isError"></span>\n    <span class="icon ion-ios-refresh refresh" ng-if="isError" ng-click="reload()"></span>\n    <span class="icon ion-record new" ng-if="isNew && !isLoading&&!isError"></span>\n    <audio preload="auto">\n        <source ng-src="{{url|Trusted}}" type="audio/wav">\n    </audio>\n    <loading ng-include=""></loading>\n</div>\n')}])}(),angular.module("play-sound.directive",[]).directive("playSound",["$state","$timeout","$interval","$rootScope",function(e,t,o,s){return{restrict:"E",replace:!0,scope:{url:"@url",side:"@side",isNew:"@isNew"},templateUrl:"play-sound.html",link:function(e,t,o,i){"right"==e.side&&(t[0].className="play-sound play-sound-right");var a=s.chatScope.targetScope;e.isLoading=!0,e.isError=!1;var n=t[0].getElementsByTagName("audio")[0],r=(t[0].getElementsByTagName("source")[0],t[0].getElementsByClassName("button")[0]);n.addEventListener("loadedmetadata",function(t){e.dur=n.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),n.addEventListener("canplaythrough",function(t){e.dur=n.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),n.addEventListener("ended",function(){n.pause(),n.currentTime=0},!1),n.addEventListener("error",function(){e.isError=!0},!1),a.$on("play-sound:stop",function(t,o){o.who.$id!=e.$id&&(n.pause(),n.currentTime=0)}),e.$on("$ionicParentView.beforeLeave",function(e,t){n.pause()}),e.play=function(){a.$broadcast("play-sound:stop",{who:e}),n.currentTime?(n.pause(),n.currentTime=0):(n.volume=1,e.isNew=!1,n.pause(),n.currentTime=0,n.play())},e.reload=function(){n.load(),e.isLoading=!0}}}}]),angular.module("play-sound.filter",[]).filter("DurFilter",[function(){return function(e){if(e)return isNaN(e)&&(e="?"),Math.round(e)+'"'}}]).filter("Trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("play-sound",["ionic","play-sound.filter","play-sound.directive","play-sound.templates"]),APP.controller("GameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService","$ionicScrollDelegate","$http","ProductDetailService","CommonAddressService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){function $(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var S="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var I=.22*window.innerWidth;e.gridHeight={height:I+"px"},e.gridHeightMiddle={height:2*I+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var w=330,y=window.innerHeight,T=y-373+"px";e.contentHeight={height:T},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION_GAME",e.defaultValue=null,e.level=0;var C={};e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.goBackFlag=!0,e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init(),e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&m.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=$(1e3*e.game.beginTime),e.endTime=$(1e3*e.game.endTime),p.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):l.showToast(t.message)}).error(function(){l.showMsg("网络错误")})};var b,A,P,x,L=0,D=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success&&-1!=t.result.prizeType)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.success&&-1==t.result.prizeType)r.alert({template:t.result.message});else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,s.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*D+e.endP;b=5,A=4==D?15:10,P=4==D?t-15:t-10,x=4==D?t-10:t-5}},e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=i(function(){if(L++,L>=b?w=100:L>=A?w=60:L>=P?w=100:L>=x&&(w=500),L>12*D&&e.curP===e.endP)return L=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},w))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||e.goBackFlag&&(e.goBackFlag=!1,d.goBack())},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,m.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var N=!1;e.goSelect=ionic.Utils.debounce(function(o,s){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var s=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=m.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(s.value,ah).success(function(t){1==ah&&(areaValueCity=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,m.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})
};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=m.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=m.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,h.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),m.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else{if(N)return;i(function(){N=!1},1500),t.$broadcast(e.flag,e.defaultValue),N=!0,e.closeAddressModal()}},300),t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){C=v.getAddressInfo();var o=C.regionName+"/"+C.streetName;h.addAddress(C.provinceId,C.cityId,C.areaId,o,C.streetId).success(function(){var o={"text-1":C.provinceName,"text-2":C.cityName,"text-3":C.regionName,"text-4":C.streetName,"value-1":C.provinceId,"value-2":C.cityId,"value-3":C.areaId,"value-4":C.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",s=S,i=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):3==t?(window.umeng.shareToQQ("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback),g.qqShare()):4==t&&(window.umeng.shareToQzone("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback),g.qqShare()),5==t?e.copeText(i):g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("helpStaffController",["$scope","$state","helpStaffService","$localstorage","$stateParams","$ionicPopup","PopupService",function(e,t,o,s,i,a,n){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.memberId=i.memberId,e.gameId=i.gameId,e.numberInit="";var r;e.init=function(){o.gameHellpInit(e.gameId,e.memberId).success(function(t,o,s,i){1==t.success?(r=t.data.helpNum,e.number=t.data.helpedNum,e.numberInit=t.data,e.number==r?(e.numberColor="34%",e.renshuColor="27.8%"):e.number==2*r?(e.numberColor="66.5%",e.renshuColor="60.3%"):e.number>=3*r?(e.numberColor="100%",e.renshuColor="93.8%"):(e.numberColor=e.number*(100/(3*r))+"%",e.renshuColor=e.number*(100/(3*r))-6.2+"%")):n.showToast(t.message)})},e.zhuli=function(){o.gameHellp(e.gameId,e.memberId,e.channel).success(function(t,o,s,i){1==t.success?(e.showBg=!0,e.codeNum=t.code,e.init()):t.message&&n.showToast(t.message)})},e.closeShow=function(){e.showBg=!1},e.$on("$ionicView.beforeEnter",function(){e.showBg=!1,e.codeNum="",e.memberId=i.memberId,e.gameId=i.gameId,e.channel=i.channel,e.init()})}]),APP.service("helpStaffService",["$http","UrlService",function(e,t){this.gameHellp=function(o,s,i){var a={gameId:o,memberId:s,channel:i};return e.get(t.getGameUrl("GAME_HELLP"),a)},this.gameHellpInit=function(o,s){var i={gameId:o,memberId:s};return e.get(t.getGameUrl("GAME_HELLP_INIT"),i)}}]),APP.controller("VipGameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var f="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var h=.22*window.innerWidth;e.gridHeight={height:h+"px"},e.gridHeightMiddle={height:2*h+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var v=330;e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeEnter",function(){e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init()}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=m(1e3*e.game.beginTime),e.endTime=m(1e3*e.game.endTime),p.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):alert(t.message)}).error(function(){l.showMsg("网络错误")})};var $,S,I,w,y=0,T=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,s.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*T+e.endP;$=5,S=4==T?15:10,I=4==T?t-15:t-10,w=4==T?t-10:t-5}},e.start=function(){!e.endP||e.endP>11||(e.isRuning=!0,e.timer=i(function(){if(y++,y>=$?v=100:y>=S?v=60:y>=I?v=100:y>=w&&(v=500),y>12*T&&e.curP===e.endP)return y=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},v))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||d.goBack()},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",s=f,i=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,s,i):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,s,i):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,s,i):3==t?window.umeng.shareToQQ("顺逛抽奖活动",o,s,i):4==t?window.umeng.shareToQzone("顺逛抽奖活动",o,s,i):5==t&&e.copeText(i),g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("anAuspiciousStartController",["$scope","anAuspiciousStartService","GameService","$ionicPopup","$timeout","CreditService","UrlService","$http","$ionicHistory","$stateParams","PopupService","UserService","InAppBrowserService","$state","$interval",function(e,t,o,s,a,n,r,c,l,d,p,u,g,m,f){function h(){P=f(e.initWinningList,2e4)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={"padding-top":"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={"padding-top":"44px"});var v=0;e.isShowForm=!1,e.picLists=[],e.surplusChance="",e.gameId=d.anAuspiciousId,e.curP=0;var S="";e.isRuning=!1;var I,w,y,T,C=330,b=0,A=Math.floor(3*Math.random())+2;e.prizeLists=[];var P=null;e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=a(function(){if(b++,b>=I?C=100:b>=w?C=60:b>=y?C=100:b>=T&&(C=500),b>12*A&&e.curP===e.endP)return b=0,e.isRuning=!1,void(e.isShowForm=!0);e.curP<12?e.curP++:e.curP=0,e.start()},C))},Array.prototype.shuffle||(Array.prototype.shuffle=function(){for(var e,t,o=this.length;o;e=parseInt(Math.random()*o),t=this[--o],this[o]=this[e],this[e]=t);return this}),e.gameButton=function(){if(!e.isRuning){t.drawPrize(e.gameId).success(function(t){if(t.success){if(e.prizeData=t.result,e.surplusChance=t.result.surplusChance,v=t.result.playTimes?t.result.playTimes:v,3!=t.result.prizeType&&-1!=t.result.prizeType){var o={mobile:"",prizeName:""};o.mobile=u.getUser().mobile,o.mobile=o.mobile.substr(0,3)+"****"+o.mobile.substr(7),o.prizeName=t.result.prizeName,e.prizeLists.shuffle(),e.prizeLists.splice(9,0,o)}-1!=t.result.prizeType?(e.endP=t.result.postion-1,e.start()):(e.curP=void 0,p.showToast(t.result.message))}else t.message&&p.showToast(t.message)}).error(function(e){p.showToast("网络错误")});var o=12*A+e.endP;I=5,w=4==A?15:10,y=4==A?o-15:o-10,T=4==A?o-10:o-5}},e.hideForm=function(){e.isShowForm=!1},function(t){t.fn.extend({RollTitle:function(t){if(!t)var t={};var o=this;e.timer=o.timer=null,o.lineH=o.find("p:first").height(),o.line=t.line?parseInt(t.line,15):parseInt(o.height()/o.lineH,10),o.speed=t.speed,o.timespan=t.timespan,0==o.line&&(this.line=1),o.scrollUp=function(){o.animate({marginTop:0},o.speed,function(){for(i=1;i<=o.line;i++)o.find("p:first").appendTo(o);o.css({marginTop:0})})},o.hover(function(){clearInterval(o.timer)},function(){o.timer=setInterval(function(){o.scrollUp()},o.timespan)}).mouseout()}})}(jQuery),e.goBack=function(){l.goBack()},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?g.open(r.getHead()+"mstore/sg/helpDetail.html?id=1034","活动规则").addEventListener("exit",function(e){}):m.go("helpDetail",{helpId:"1034",content:"活动规则"})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},e.isShowShare=function(){if(e.isShowForm=!1,v<e.information.partNum)p.showAlert("分享","每人默认1次抽奖机会，机会用完才可以分享助力哦！");else if(window.cordova){if(!u.getUser().mid)return void m.go("login");e.showShare=!0}else p.showAlert("只能在app分享","抱歉，只能在app分享")},e.chanceShare=function(e){1==e?S="WX":2==e?S="PYQ":3==e?S="QQ":4==e?S="QQKJ":5==e?S="FZLJ":0==e&&(S="WB")},e.shareToPlatform=function(t){e.chanceShare(t);var o=e.information.gameTitle,s="助力可以获得更多的抽奖机会，帮他助个力吧！",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=r.getShareLinkHeader()+"helpStaff/"+e.memberId+"/"+e.gameId+"/"+S;window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,null):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,null):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,null):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,null),n.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,null),n.qqShare()),5==t?e.copeText(a):n.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.hideblackCover=function(){e.showShare=!1},e.initWinningList=function(){t.winningList(e.gameId).success(function(t,o,s,i){1==t.success?t.data&&(e.prizeLists=t.data):t.message&&p.showToast(t.message)})},e.initInformation=function(){t.gameInformation(e.gameId).success(function(t,o,s,i){1==t.success?(e.picLists=t.data.gameImgVos,e.information=t.data,e.surplusChance=t.data.surplusChance,v=t.data.playTimes):t.message&&p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(t){e.showShare=!1,e.memberId=u.getUser().mid,e.gameId=d.anAuspiciousId,e.isShowForm=!1,e.initInformation(),e.initWinningList(),h()}),e.$on("$ionicView.enter",function(e){$(".record_list").RollTitle({line:1,speed:3e3,timespan:600})}),e.$on("$ionicView.beforeLeave",function(){f.cancel(P)})}]),APP.service("anAuspiciousStartService",["$http","UrlService",function(e,t){this.winningList=function(o){var s={gameId:o,noLoading:!0};return e.get(t.getGameUrl("WINNING_LIST"),s)},this.drawPrize=function(o){var s={gameId:o,timeStamp:(new Date).getTime()};return e.get(t.getGameUrl("LOTTERY"),s)},this.gameInformation=function(o){var s={gameId:o};return e.get(t.getGameUrl("GAME_INFORMATION"),s)}}]),APP.controller("HomeController",["$scope","HomeService","H5LocationService",function(e,t,o){e.mine="test mine angularJS",e.fangfa=function(e){o.getLocation(function(e){})},t.doInit().success(function(e,t,o,s){})}]),APP.service("HomeService",["$http","UrlService",function(e,t){this.doInit=function(o,s){var i={userName:o,password:s};return e.get(t.getUrl("HOME_INIT"),i)}}]),APP.controller("TestController",["$scope",function(e){}]),APP.controller("InvoiceSetupController",["$scope","$state","$stateParams","$rootScope","$ionicScrollDelegate","InvoiceService","$ionicPopup","$ionicHistory","$ionicModal","PopupService","ADDADDRESSService","CommonAddressService","$http","$ionicPlatform",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.htmlContent=o.content,e.enterPage=o.enterPage,e.title=o.title,e.invoiceModel={},e.addressback="",e.normalInvoiceType=1,e.normalInvoice={TaxpayerNumber:""};var m="",f={invoiceHead:"",TaxpayerNumber:""};e.faPiao={faPiaoTaiTou:"",gongSiMingCheng:"",shiBieHao:"",zhuCeDiZhi:"",zhuCeDianHua:"",kaiHuYinHang:"",kaiHuZhangHao:""},e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.receipt={consignee:"",address:"",zipcode:"",mobile:""},e.isChoose=void 0,e.invoiceType,e.whichActive,e.init=function(){e.addressRegionName="邮寄地址所在地区:",e.addressStreet="街道:",e.invoiceType=o.invoiceType,e.htmlContent=o.content,e.title=o.title,a.loadData().success(function(t,o,s,i){t.success&&(e.faPiao.gongSiMingCheng=t.data.bc,"2"==e.invoiceType?e.normalInvoice.TaxpayerNumber=t.data.tpn:"1"==e.invoiceType&&(e.faPiao.shiBieHao=t.data.tpn),m=t.data.nit,f={invoiceHead:t.data.iti,TaxpayerNumber:t.data.tpn},e.faPiao.faPiaoTaiTou=t.data.iti,e.normalInvoiceType=t.data.nit,e.faPiao.zhuCeDiZhi=t.data.rga,e.faPiao.zhuCeDianHua=t.data.rgp,e.faPiao.kaiHuYinHang=t.data.bn,e.faPiao.kaiHuZhangHao=t.data.cbn,e.addressRegionName=t.data.rca?t.data.rca.substring(0,t.data.rca.indexOf(",")):"邮寄地址所在地区:",e.addressStreet=t.data.rca?t.data.rca.substring(t.data.rca.indexOf(",")+1,t.data.rca.lastIndexOf(",")):"街道:",e.receipt.address=t.data.rca?t.data.rca.substring(t.data.rca.lastIndexOf(",")+1):"",e.receipt.consignee=t.data.rcc,e.receipt.zipcode=t.data.rcz,e.receipt.mobile=t.data.rcm)}),a.loadList().success(function(t,o,s,i){t.success&&(e.invoiceList=t.data,0==e.invoiceList.length?e.isChoose=!1:e.isChoose=!0)})},e.StreetTop=function(){e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="","邮寄地址所在地区:"!=e.addressRegionName?e.addressModalStreet.show():(l.showToast("请选择所在地"),e.addressStreet="街道:")},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,s,a){if(e.addressTipFlag=!1,i.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=a,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1)}else e.finish=!1,e.dataAdd="",d.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1},e.goSelectStreet=ionic.Utils.debounce(function(t,o){e.level=e.level-1,e.addressStreet=o.text,e.streetMsg=o.text,e.isChangeOrDefault=3,e.isDef=!0,e.addChangeAddress.regionName=e.addChangeAddress.pca+" "+e.addressStreet,e.addChangeAddress.streetId=o.value,e.positionAddress.streetId=o.value,e.positionAddress.regionName=e.positionAddress.pca+" "+e.addressStreet,e.addressModalStreet.hide(),"街道"==e.addressStreet?e.streetTextColor="color-text-s":e.streetTextColor="color-text-l"});var h=!1;e.goSelect=ionic.Utils.debounce(function(t,o){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.nowLevelIndex[e.nowLevel]=t;var o=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.hasChangeArr=e.defaultValue,e.level>-2)-1==e.level&&(e.selectProvince=o.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=i.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){1==ah&&(areaValueCity=o.value),e.dataAdd=t.data,e.addressTipFlag=!1;var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",d.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,i.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})};else if(e.level>-4&&-3!=e.level)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,e.selectArea=o.text,e.addressStreet="街道",e.textColor="color-text-l",e.cityTop=i.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=o.value);var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.level=e.levelArea,d.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),i.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else if(-3==e.level)e.addressModal.hide(),e.regionTrue=!0,e.isChangeOrDefault=4,e.streetTextColor="color-text-s",e.streetTrue=!0,e.panGoOn=!0,e.panOrgoOn=!0,e.textOne=e.defaultValue["text-1"],e.textTwo=e.defaultValue["text-2"],e.textThree=e.defaultValue["text-3"],e.address.provinceId=e.defaultValue["value-1"],e.address.cityId=e.defaultValue["value-2"],e.address.areaId=e.defaultValue["value-3"],e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addressRegionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addChangeAddress={provinceId:e.defaultValue["value-1"],cityId:e.defaultValue["value-2"],areaId:e.defaultValue["value-3"],streetId:0,pca:e.textOne+" "+e.textTwo+" "+e.textThree,regionName:""},e.selectArea=o.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=i.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,d.getLocationList(o.value,ah).success(function(t){e.dataAddStreet=t.data,2==ah&&(areaValue=o.value);var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1;else{if(h)return;$timeout(function(){h=!1},1500),s.$broadcast(e.flag,e.defaultValue),h=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){addressMessage=p.getAddressInfo();var t=addressMessage.regionName+"/"+addressMessage.streetName;d.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,t,addressMessage.streetId).success(function(){var t={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};d.getLocationList(addressMessage.areaId,3).success(function(t){e.dataAddStreet=t.data;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.positionAddress={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:0,pca:addressMessage.provinceName+" "+addressMessage.cityName+" "+addressMessage.regionName,regionName:""},e.isPosition=!0,s.$broadcast(e.flag,t),e.streetTextColor="color-text-s",e.addressModal.hide(),e.addressRegionName=e.positionAddress.pca,e.addressStreet="街道:"})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),c.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModalStreet=t}),e.closeAddressModal=function(){e.addressModal.hide(),e.addressModalStreet.hide()},e.preservation=function(){e.positionCommonFun=function(){e.address.provinceId=e.positionAddress.provinceId,e.address.cityId=e.positionAddress.cityId,e.address.areaId=e.positionAddress.areaId,e.address.streetId=e.positionAddress.streetId,e.address.regionName=e.positionAddress.regionName},e.isPosition&&e.positionCommonFun(),d.doInit(e.address).success(function(t,o,i,a){1==t.success&&(e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.addressRegionName="",s.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},s.addressStr=void 0,e.isChangeOrDefault=0,e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.panGoOn=!1,e.fromOrder?e.$ionicGoBack(-2):e.$ionicGoBack())})},e.chooseNormalType=function(t){t!=e.normalInvoiceType&&(e.normalInvoiceType=t,e.normalInvoiceType!=m?(e.faPiao.faPiaoTaiTou="",e.normalInvoice.TaxpayerNumber=""):(e.faPiao.faPiaoTaiTou=f.invoiceHead,e.normalInvoice.TaxpayerNumber=f.TaxpayerNumber))},e.dzClick=function(){e.faPiao.shiBieHao="",e.whichActive=0,e.invoiceType="2"},e.zzClick=function(){e.faPiao.shiBieHao="",e.whichActive=1,e.invoiceType="1"},e.dianZiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.faPiaoTaiTou)?2==e.normalInvoiceType?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.normalInvoice.TaxpayerNumber)?(e.errMessage="",e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):(e.errMessage="识别号为15位或18位或20位的数字或字母",i.scrollTop([shouldAnimate=!0])):(e.errMessage=null,e.normalInvoice.TaxpayerNumber="",e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):e.errMessage="发票抬头必填,且不能包含特殊字符"},e.naShuiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.gongSiMingCheng)&&e.faPiao.gongSiMingCheng?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.faPiao.shiBieHao)?/^.[^&<>]{4,}$/.test(e.faPiao.zhuCeDiZhi)&&e.faPiao.zhuCeDiZhi?e.faPiao.zhuCeDianHua&&e.faPiao.zhuCeDianHua.length<8||!e.faPiao.zhuCeDianHua?(e.errMessage="注册电话格式：0532-12345678",i.scrollTop([shouldAnimate=!0])):e.faPiao.kaiHuYinHang?e.faPiao.kaiHuZhangHao?"邮寄地址所在地区:"!=e.addressRegionName||"街道:"!=e.addressStreet&&"街道"!=e.addressStreet||e.receipt.address?"邮寄地址所在地区:"==e.addressRegionName?(e.errMessage="请选择所在地区",i.scrollTop([shouldAnimate=!0])):"街道:"==e.addressStreet||"街道"==e.addressStreet?(e.errMessage="请选择所在街道",i.scrollTop([shouldAnimate=!0])):e.receipt.address?(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="请填写详细地址",i.scrollTop([shouldAnimate=!0])):(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="开户账号为必填",i.scrollTop([shouldAnimate=!0])):(e.errMessage="开户银行为必填",i.scrollTop([shouldAnimate=!0])):(e.errMessage="注册地址至少5个字符，且不能包含特殊字符",i.scrollTop([shouldAnimate=!0])):(e.errMessage="识别号为15位或18位或20位的数字或字母",i.scrollTop([shouldAnimate=!0])):(e.errMessage="公司名称必填,且不能包含特殊字符",i.scrollTop([shouldAnimate=!0]))},e.toSubmit=function(t,o,i,n,c,l,d,p,u,g,m,f,h){0==e.enterPage?a.submitInvoice(t,i,o,n,c,l,d,p,u,g,m,f,h).success(function(e,t,o,i){e.success&&(s.isInvoice=!0,r.goBack())}):1==e.enterPage&&a.submitInvoiceSeckill(payment,t,o,i,n,c,l,d,p,u,g,m,f,h).success(function(e,t,o,s){e.success&&r.goBack()})},e.popMessage=function(){n.alert({templateUrl:"http://www.ehaier.com/mstatic/test/wd/activity/invoiceRule.html",cssClass:""})},e.choose=function(){t.go("invoiceList")},c.fromTemplateUrl("templates/invoice/InvoiceList.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show(),a.loadList().success(function(t,o,s,i){t.success&&(e.invoiceList=t.data)})},e.closeModal=function(){e.modal.hide()},e.listClick=function(t){e.closeModal(),a.loadList().success(function(o,s,i,a){o.success&&(e.invoiceList=o.data,e.faPiao.gongSiMingCheng=e.invoiceList[t].invoiceTitle,e.faPiao.shiBieHao=e.invoiceList[t].taxPayerNumber,e.faPiao.zhuCeDiZhi=e.invoiceList[t].registerAddress,e.faPiao.zhuCeDianHua=e.invoiceList[t].registerPhone,e.faPiao.kaiHuYinHang=e.invoiceList[t].bankName,e.faPiao.kaiHuZhangHao=e.invoiceList[t].bankCardNumber)})},e.note=function(){l.showAlert("",'<div style="text-align:left;color:#666;">普通发票分为电子发票与纸质发票两种，以实际开票为准，不支持更换选择，订单确认后可在订单详情-发票信息模块查看具体信息；<br><br>电子发票是经过国家税务局机关认可的有效凭证,同样具有保修与财务报销的效力。相关内容您可以咨询海尔商城在线客服,或拨打海尔商城服务热线4006 999 999,同时您也可以拨打税务热线12366进行咨询。电子发票相关政策您还可以查看《青岛市国家税务局电子发票管理办法（试行）》,或登录青岛市电子发票服务平台www.chinaeinv.com查询。<br><br>纸质发票是由顺逛官方授权店进行开具。<br><br>增值税专用发票需自行选择，并详细填写公司名称、税号、地址、电话、开户银行和帐号，并注意所填的内容须与纳税信息一致。<br>另外需提供一般纳税人认证资料（营业执照副本、税务登记证副本、一般纳税人资格证书、银行开户许可证复印件）及顺逛订单号发送邮件至fapiao@ehaier.com，我们会根据您提供的资料进行资质审核，审核无误后将在订单完成关闭1-2周左右的时间为您开具发票并安排邮寄。</div>')},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("InvoiceService",["$http","UrlService",function(e,t){this.loadData=function(){return e({method:"POST",url:t.getUrl("ORDER_INVOICE")})},this.loadList=function(o){return o={},e.get(t.getUrl("ORDER_INVOICE_LIST"),o)},this.submitInvoice=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={it:o,bc:s,iti:i,tpn:a,rga:n,rgp:r,bn:c,cbn:l,rcc:d,rca:p,rcz:u,rcm:g,nit:m};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE"),data:f})},this.submitInvoiceSeckill=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={payment:o,invoiceType:s,billCompany:i,invoiceTitle:a,taxPayerNumber:n,registerAddress:r,registerPhone:c,bankName:l,bankCardNumber:d,receiptConsignee:p,receiptAddress:u,receiptZipcode:g,receiptMobile:m};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE_SECKILL"),params:f})},this.pageSubmit=function(){var o={isFromInvoices:1};return e.get(t.getUrl("CONFIRM_ORDER"),o)}}]),
APP.controller("ListOfSpecialtyGoodsController",["CartService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","ListOfSpecialtyGoodsControllerService","LoginService","HomePageService","CreditService","BannerThemeService","CommonAddressService",function(CartService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,localSpecialtyHomePageService,ListOfSpecialtyGoodsControllerService,LoginService,HomePageService,CreditService,BannerThemeService,CommonAddressService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",$scope.priceArr=[],$scope.showShare=!1,$scope.canLoadMore=!0,$scope.chooseIndex=3,$scope.switch=!0,$scope.filterData="",$scope.qs="saleDesc",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.pageIndex=1,$scope.midCommList=[],$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.arrowState=[$rootScope.imgBaseURL+"img/ic_sort_state_0.png",$rootScope.imgBaseURL+"img/ic_sort_state_1.png",$rootScope.imgBaseURL+"img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/ic_screen_state_0.png",$rootScope.imgBaseURL+"img/ic_screen_state_1.png"],$scope.filter_index=0,$scope.iSDataLeftRight=!1,$scope.isListNull=!1,$scope.leftDataListIndex=1,$scope.leftDataList=[{navigationName:"全部",id:""}],$scope.rightDataList=[],$scope.listModal=null,$ionicModal.fromTemplateUrl("templates/localSpecialty/specialClassificationSelection.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.listModal=e}),$scope.closeListModal=function(){$scope.listModal.hide(),$scope.leftDataList=[{navigationName:"全部",id:""}]},$scope.getQueryString=function(e,t){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=t.substr(0).match(o);return null!=s?s[2]:""},$scope.backToList=function(e){$scope.midCommList=[],$scope.priceArr=[];var t=$scope.getQueryString("productCateId",e.url),o=$scope.getQueryString("brandId",e.url);""!=o?$scope.filterData="hasStock@"+o+"@0":$scope.qs="saleDesc",$scope.filter_index=0,$scope.chooseIndex=3,$scope.title=e.navigationName,$scope.productCateId=t,$scope.listModal.hide(),$scope.getListData(),$ionicScrollDelegate.scrollTop()};var parentId="0";$scope.getList=function(){ListOfSpecialtyGoodsControllerService.getLeftList($scope.pageId).success(function(e){if(e.success&&e.data.length>0){$scope.leftDataList=[{navigationName:"全部",id:""}];for(var t=0;t<e.data.length;t++)$scope.leftDataList.push(e.data[t]);parentId=e.data[0].id,ListOfSpecialtyGoodsControllerService.getRightList($scope.leftDataList[$scope.leftDataListIndex].id,$scope.pageId).success(function(e){if(e.success){0==e.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var t=[],o=[],s=0;s<e.data.length;s++)e.data[s].parentId==parentId&&2==e.data[s].levels?(e.data[s].children=[],t.push(e.data[s])):1==e.data[s].levels&&o.push(e.data[s]);for(var s=0;s<e.data.length;s++)for(var i=0;i<t.length;i++)e.data[s].parentId==t[i].id&&t[i].children.push(e.data[s]);$scope.rightDataList=t,$scope.slideImage=o,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()})}else $scope.iSDataLeftRight=!0})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.selectTab=function(e,t){if(parentId=e,0==t)return $scope.productCateId=0,$scope.title="全部商品",$scope.listModal.hide(),$scope.commission_index=0,$scope.price_index=0,void $scope.chooseTab(3);t!=$scope.leftDataListIndex&&($scope.leftDataListIndex=t,ListOfSpecialtyGoodsControllerService.getRightList(e,$scope.pageId).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],s=[],i=0;i<t.data.length;i++)t.data[i].parentId==e&&2==t.data[i].levels?(t.data[i].children=[],o.push(t.data[i])):1==t.data[i].levels&&s.push(t.data[i]);for(var i=0;i<t.data.length;i++)for(var a=0;a<o.length;a++)t.data[i].parentId==o[a].id&&"1"!=t.data[i].levels&&o[a].children.push(t.data[i]);$scope.rightDataList=o,$scope.slideImage=s,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}))},$scope.bannerClick=function(e){$scope.listModal.hide();var t=e.bannerId,o=e.url,s=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.memberId});break;case 2:if(o){var a=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:a,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var n=o.split("=")[1];$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"});var provinceId,cityId,districtId,streetId;$scope.$on("$ionicView.beforeEnter",function(event,data){if("back"==data.direction)return $scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),void GetSwitchChecked();$scope.title="全部商品",$scope.chooseIndex=3,$scope.commission_index=0,$scope.filter_index=0,$scope.price_index=0,$scope.pageId=$stateParams.pageId,$scope.productCateId=$stateParams.productCateId,$scope.qs="saleDesc",ListOfSpecialtyGoodsControllerService.getPositionId().success(function(res){if(res.success){var data=eval(res.data)[0];if(provinceId=data.provinceId,cityId=data.cityId,districtId=data.areaId,streetId=data.streetId,void 0!=provinceId&&void 0!=cityId&&void 0!=districtId&&void 0!=streetId)$scope.getListData();else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),GetSwitchChecked()}),$scope.settingsList="",$scope.getListData=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.$on("$ionicView.beforeLeave",function(){$scope.resetFilter(),$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"}),$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!0}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$scope.goClassification=function(){$scope.pageIndex=1,$scope.listModal.show(),$scope.getList(),$scope.leftDataListIndex=1},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),2==e){null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show();var t={productCateId:$scope.productCateId};$scope.getFilterDataLists(t)}else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==o?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var s=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==s?"price":"priceDesc"}$scope.pageIndex=1,$scope.canLoadMore=!1,$scope.ResGetList()}},$scope.ResGetList=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.getFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(e.data.brandList[t].id)>-1?t>0&&(e.data.brandList[t].active="true"):e.data.brandList[t].active="false":e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if(null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.loadMore=function(){$scope.pageIndex++,ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){if(e.success){for(var t=0;t<e.data.productList.length;t++)$scope.midCommList.push(e.data.productList[t]);e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0;o<t.products.length;o++)$scope.priceArr.push(t.products[o]);e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,$scope.$broadcast("scroll.infiniteScrollComplete")})}})},$scope.goBack=function(){$scope.pageIndex=1,$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMoreActive.png")},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!1},$scope.toShare=function(){return $scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",window.cordova?UserService.isUserLogin()?($scope.showShare=!0,void(window.device&&($scope.shareToPlatform(),$scope.showShare=!$scope.showShare))):void $state.go("login"):void $scope.showPopup("请下载APP执行此操作")},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t=$localstorage.get("storeId",$rootScope.globalConstant.storeId),o="顺逛•特产惠 汇集全国优质特产",s="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",i=$scope.shareImgUrl,a=UrlService.getShareLinkHeader()+"ListOfSpecialtyGoods/"+$scope.productCateId+"/"+$scope.pageId+"/"+t,n={},r=function(e){CreditService.shareSuccessCallback(e,n)};window.umeng?(0==e?window.umeng.shareToSina(o,s,i,a,0,null,r):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,r):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,r):3==e?(window.umeng.shareToQQ(o,s,i,a,0,null,r),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(o,s,i,a,0,null,r),CreditService.qqShare()),5==e?$scope.copeText(a):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("ListOfSpecialtyGoodsControllerService",["$http","UrlService","UserService",function(e,t,o){this.getProductsList=function(s,i,a,n,r,c,l,d,p){var u=o.getUser().mid||"20219251",g={storeMemberId:u,pageIndex:s,pageSize:10,filterData:i,qs:p,productCateId:a,provinceId:n,cityId:r,districtId:c,streetId:l,pageId:d,noLoading:"true"};return e.get(t.getUrl("SPECIALY_PRODUCTS_LIST"),g)},this.getAsyncPrice=function(o){var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})},this.getFilterData=function(o){return e.get(t.getUrl("GET_FILTER_DATA"),o)},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getLeftList=function(o){var s={module:2,parentId:0,regionId:o};return e.get(t.getZCUrl("GETNAVIGATIONS"),s)},this.getRightList=function(o,s){var i={module:2,parentId:o,regionId:s};return e.get(t.getZCUrl("GETNAVIGATIONS"),i)}}]),APP.controller("localSpecialtyHomePageController",["CommonAddressService","$ionicLoading","CreditService","CartService","newsendService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","BannerThemeService","PopupService","localSpecialtyHomePageService","HomePageService",function(CommonAddressService,$ionicLoading,CreditService,CartService,newsendService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,BannerThemeService,PopupService,localSpecialtyHomePageService,HomePageService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function mainRes(e){localSpecialtyHomePageService.getMaster(e).success(function(e){e.success&&(null!=e.data.topBannerList&&null!=e.data.topBannerList.bannerList?($scope.arrList.bannerList=e.data.topBannerList.bannerList,$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").update(),$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").loop(!0)):$scope.arrList.bannerList=[],null!=e.data.regionList&&null!=e.data.regionList.regionList&&(e.data.regionList.regionList.length>3?$scope.arrList.navList=e.data.regionList.regionList.slice(0,3):$scope.arrList.navList=e.data.regionList.regionList),null!=e.data.drinkList&&(null!=e.data.drinkList.bannerList||null!=e.data.drinkList.topBanner?($scope.isDrinkList=!0,$scope.arrList.specialtyListDrink=e.data.drinkList,$scope.drinkList=e.data.drinkList.bannerList):($scope.isDrinkList=!1,$scope.arrList.specialtyListDrink=[],$scope.drinkList=[])),null!=e.data.foodList&&(null!=e.data.foodList.productList||null!=e.data.foodList.topBanner?($scope.isFoodList=!0,$scope.arrList.specialtyListFood=e.data.foodList,$scope.foodList=e.data.foodList.productList):($scope.isFoodList=!1,$scope.arrList.specialtyListFood=[],$scope.foodList=[])),null!=e.data.communityList&&null!=e.data.communityList.bannerList?$scope.arrList.midCommList=e.data.communityList:$scope.arrList.midCommList=null)})}function countTimeNew(e,t,o){$scope.endT[o]=t-e,newTime[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=checkTime($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&$interval.cancel(newTime[o])},1e3)}function checkTime(e){return e<10&&(e="0"+e),e}$scope.allSpecialtyArr=[],$scope.showReserveList=!1,$scope.crowdFundingList=!1,$scope.selectedIndex=0,$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png",$scope.showShare=!1,$scope.localSelect=0,$scope.isTimeOver=!1,$scope.flashHour="",$scope.textTime="",$scope.drinkList=[],$scope.foodList=[],$scope.isDrinkList=!1,$scope.isFoodList=!1,$scope.Timetotal=[],$scope.youLikeTypeArr=[],$scope.youLikeDataArr=[],$scope.cateId=0,$scope.dealPrice=CalculateStrLength.dealPrice,$scope.newAndlimit={flashProductList:[],newSendList:[]},$scope.systemTime=0,$scope.clickFlag=0,$scope.arrList={bannerList:[],navList:[],specialtyListDrink:[],specialtyListFood:[],touristsList:[],midCommList:[]},$scope.addressMsg={provinceId:"",cityId:"",areaId:"",streetId:""},$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596";var NowTer;$scope.chooseTimer=function(e){$scope.clickFlag=e},$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[];var newTime=[],addressMessage,remindArray=[],countDownNowTime=[],countDownendTime=[],nowT=(new Date).getTime(),timerLength="";$scope.preheatingTime=0,$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.settingsList="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"}),$scope.init=function(){$scope.cartTotalNum=0,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.getAddress(),$scope.crowdFundingMsg(2),$scope.youLikeType(),$scope.getUserMsg(),$scope.getCartNum()},$scope.getUserMsg=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.newProductAndTimeLimit=function(e,t,o,s){localSpecialtyHomePageService.getNewAndLimit(e,t,o,s).success(function(e){if(e.success)if(null!=e.data)if(null!=e.data.reverse)if(timerLength=remindArray.length,$scope.newAndlimit.newSendList=e.data.reverse.acReserveList,$scope.newAndlimitLength=e.data.reverse.acReserveList.length,0==$scope.newAndlimit.newSendList.length||$scope.newAndlimit.newSendList==[])$scope.showReserveList=!1;else{$scope.showReserveList=!0;for(var t=0;t<$scope.newAndlimit.newSendList.length;t++)remindArray.push(t),countDownNowTime[t]=parseInt(nowT/1e3),countDownendTime[t]=parseInt($scope.newAndlimit.newSendList[t].reserveEndTime/1e3);for(var o=timerLength;o<remindArray.length;o++)countTimeNew(countDownNowTime[remindArray[o]],countDownendTime[remindArray[o]],remindArray[o])}else $scope.showReserveList=!1;else $scope.showReserveList=!1;else $scope.showReserveList=!1})},$scope.getflashsale=function(e,t,o,s){$interval.cancel(NowTer),localSpecialtyHomePageService.getflashsale(e,t,o,s).success(function(e){e.data.flash.list&&0!=e.data.flash.list.length&&($scope.newAndlimit.flashProductList=e.data.flash.list,$scope.systemTime=e.data.flash.systemTime,$scope.systemTime>=$scope.newAndlimit.flashProductList[0].startTime&&(NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=$scope.newAndlimit.flashProductList[0].endTime&&($interval.cancel(NowTer),$scope.getflashsale($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId))},1e3)),$scope.systemTime<$scope.newAndlimit.flashProductList[0].startTime&&(NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=$scope.newAndlimit.flashProductList[0].startTime&&($interval.cancel(NowTer),$scope.getflashsale($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId))},1e3)))})},$scope.crowdFundingMsg=function(e){newsendService.getcrowold(e).success(function(e){e.success&&(0!=e.data.zActivitySuccessList.length||0!=e.data.zActivityBeginningList.length||0!=e.data.zActivityToBeginList.length)?($scope.crowdFundingList=!0,$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList):($scope.crowdFundingList=!1,$scope.zcold=[],$scope.zcnow=[],$scope.zcpre=[])})},$scope.youLikeType=function(){localSpecialtyHomePageService.getSpecialtyLikeType(3).success(function(e){e.success&&0!=e.data.length?($scope.youLikeTypeArr=e.data,0==$scope.selectedIndex&&($scope.cateId=e.data[0].cId)):$scope.youLikeTypeArr=[]})},$scope.youLikeDataList=function(e,t,o,s,i,a){localSpecialtyHomePageService.getSpecialtyLikeDta(e,t,o,s,i,a).success(function(e){e.success&&null!=e.data?$scope.youLikeDataArr=e.data:$scope.youLikeDataArr=[]})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId,shareStoreId:$rootScope.shareId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId,shareStoreId:$rootScope.shareId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goBack=function(){for(var e=0;e<=remindArray.length;e++)$interval.cancel(newTime[remindArray[e]]);remindArray=[],$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg="img/ic_lookMoreActive.png")},$scope.toShare=function(){if(window.cordova){if(!UserService.isUserLogin())return void $state.go("login");$scope.showShare=!0}else PopupService.showToast("请下载APP执行此操作")},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},
$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t="顺逛·特产汇 汇集全国优质特产",o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的带来",s="http://cdn09.ehaier.com/shunguang/H5/www/img/specialty_share_pic.png",i=UrlService.getShareLinkHeader()+"localSpecialtyHomePage/"+$scope.storeId,a=function(){CreditService.shareSuccessCallback()};window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,a):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,a):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,a):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,a),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,a),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.cancelShare=function(){$scope.showShare=!1,$scope.isDisplay=!1},$scope.goToSpecialtyVenue=function(e,t){$scope.localSelect=e,$scope.moreSpecialtyModal.hide(),$timeout(function(){$state.go("SpecialtyVenueHome",{regionId:t,streetId:$scope.addressMsg.streetId})},600)},$scope.moreSelectSpecialty=function(){$scope.moreSpecialtyModal.show(),localSpecialtyHomePageService.getAllMsg().success(function(e){e.success&&($scope.allSpecialtyArr=e.data)})},$scope.closeMoreSpecialty=function(){$scope.moreSpecialtyModal.hide()},$scope.getAddressInit=function(){mainRes($scope.addressMsg.streetId),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId),$scope.getflashsale($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId),$timeout(function(){$scope.youLikeDataList(3,$scope.cateId,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},800)},$scope.getAddress=function(){localSpecialtyHomePageService.getPositionId().success(function(res){res.success?(addressMessage=eval(res.data)[0],void 0!=addressMessage.provinceId&&void 0!=addressMessage.cityId&&void 0!=addressMessage.areaId&&void 0!=addressMessage.streetId?($scope.addressMsg={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:addressMessage.streetId},$scope.getAddressInit()):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())}).error(function(){$scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit()})},$rootScope.$on("CACHE_SUCCESS",function(e,t){for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1);var s={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(s),$scope.getAddress()}),$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId,shareStoreId:$rootScope.shareId})},$ionicModal.fromTemplateUrl("templates/localSpecialty/moreSpecialtyModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.moreSpecialtyModal=e}),$scope.$on("$destroy",function(){$scope.moreSpecialtyModal.remove()}),$scope.goToClassify=function(e,t){$scope.selectedIndex=e,$scope.cateId=t,$scope.youLikeDataList(3,t,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},$scope.toGoSecialtyVenueHome=function(e){$state.go("SpecialtyVenueHome",{regionId:e,streetId:$scope.addressMsg.streetId})},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.isDisplay=!1;for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.$on("$ionicView.beforeEnter",function(e,t){$rootScope.shareId||($rootScope.shareId=$stateParams.storeId),$scope.isDisplay=!1,nowT=(new Date).getTime(),"back"==t.direction?($scope.getCartNum(),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId),$scope.getflashsale($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)):($scope.init(),GetSwitchChecked(),$scope.showShare=!1,$scope.localSelect=0)})}]),APP.service("localSpecialtyHomePageService",["$http","UrlService",function(e,t){this.getAllMsg=function(){return e.get(t.getNewUrl("ALL_SPECIALTY"))},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getMaster=function(o){var s={streetId:o,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY"),s)},this.getNewAndLimit=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a,noLoading:!0};return e.get(t.getNewUrl("NEW_AND_LIMIT"),n)},this.getflashsale=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("NEW_LOCAL_FLASHSALE"),n)},this.getSpecialtyLikeType=function(o){var s={type:o};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_TYPE"),s)},this.getSpecialtyLikeDta=function(o,s,i,a,n,r){var c={type:o,cateId:s,pId:i,cId:a,rId:n,sId:r,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_DATA"),c)}}]),APP.controller("secondLevelStoreController",["UrlService","UserService","CreditService","PopupService","$stateParams","secondLevelStoreService","CartService","HomePageService","GoodsService","$q","$localstorage","$scope","$state","LoginService","$rootScope","$ionicModal","BranchTypeDetailService","$ionicScrollDelegate","$ionicHistory",function(UrlService,UserService,CreditService,PopupService,$stateParams,secondLevelStoreService,CartService,HomePageService,GoodsService,$q,$localstorage,$scope,$state,LoginService,$rootScope,$ionicModal,BranchTypeDetailService,$ionicScrollDelegate,$ionicHistory){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function sortById(e,t){return e.sort-t.sort}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function getProductList(){secondLevelStoreService.getSecondLevelProduct($scope.storeId,$scope.pageIndex,$scope.pageSize,$scope.filterData,$scope.productCateId,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.regionId,$scope.qs).success(function(e){if(e.success){if(e.data.productList){var t=e.data.productList;$scope.productList=$scope.productList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}6*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else $scope.productList=[],PopupService.showToast(e.message)})}window.cordova?$scope.isApp=!0:$scope.isApp=!1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.iosAppHeight={height:"64px",paddingTop:"20px"},$scope.iosAppPadding={paddingTop:"64px"}):($scope.iosAppHeight={height:"44px",paddingTop:"2px"},$scope.iosAppPadding={paddingTop:"44px"}),$scope.isBuyer=LoginService.getRole(),$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png",$scope.filterData="",$scope.productCateIdType="0",$scope.switch=!0,$scope.filter_index=0,$scope.pageIndex="1",$scope.pageSize="6",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.hasmore=!1,$scope.settingsList="",$scope.checkedIndex=0,$scope.tempList=[],$scope.productList=[],$scope.arrowState=["img/ic_sort_state_0.png","img/ic_sort_state_1.png","img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/ic_screen_state_0.png","img/ic_screen_state_1.png"],$scope.filter_index=0;var tabState=["",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.filterData="",$scope.chooseIndex=3,$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.qs="saleDesc",$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.showMoreInfo=function(){$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!$scope.showShare},$scope.goToShare=function(e){if(e.preventDefault(),e.stopPropagation(),!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.clickSecondLevel=function(e){$scope.checkedIndex=e,$scope.productCateId=$scope.secTypeList[e].cId,$scope.tempList=[],$scope.productList=[],$scope.pageIndex=1,$scope.pageSize=6,$scope.resetFilter(),$scope.filterData="",getProductList()},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.hideMoreDetail=function(){$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.shareToPlatform=function(e){var t=$scope.secTitle,o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的到来~",s=$scope.sPic,i=UrlService.getShareLinkHeader()+"secondLevelStore/"+$stateParams.cityId+"/"+$scope.storeId;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.customerServe=function(){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.openFilterModal();else{if($scope.page=2,1==e){$scope.chooseIndex=e;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.chooseIndex=e,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.chooseIndex=e;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList()}},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.init=function(){var e=$q.defer(),t=$q.defer(),o=$q.all([e.promise,t.promise]);$scope.tempList=[],$scope.productList=[],$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),$scope.cartTotalNum=0,$scope.filterParams="",$scope.regionId=$stateParams.cityId,$scope.pageIndex=1,$scope.pageSize=6,$scope.checkedIndex=0,$scope.chooseIndex=3,secondLevelStoreService.getSecTypeList($scope.regionId).success(function(t){t.success&&($scope.secTitle=t.data.pathName,$scope.sPic=t.data.sPic,$scope.secTypeList=JSON.parse(t.data.classify).sort(sortById),$scope.productCateId=$scope.secTypeList[0].cId,e.resolve())}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,$scope.page=1,t.resolve()}),o.then(function(){$scope.filterData="",getProductList()}),CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.loadMore=function(){$scope.pageIndex=$scope.pageIndex+1,getProductList()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.resetFilter(),$scope.hideMoreDetail()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0});$stateParams.shareId&&($rootScope.shareId=$stateParams.shareId),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.init()})}]),APP.service("secondLevelStoreService",["$http","UrlService",function(e,t){this.getSecondLevelProduct=function(o,s,i,a,n,r,c,l,d,p,u){var g={storeMemberId:o,pageIndex:s,pageSize:i,filterData:a,qs:u||"",productCateId:n,provinceId:r,cityId:c,districtId:l,streetId:d,pageId:p};return e.get(t.getUrl("SECONDLEVEL_PRODUCTLIST"),g)},this.getSecTypeList=function(o){var s={regionId:o};return e.get(t.getNewUrl("SECONDLEVEL_SECTYPELIST"),s)}}]),APP.controller("SpecialtyVenueHomeController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","specialtyVenueHomeControllerService","$ionicPopup","CartService","LoginService","HomePageService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,P,x,L,D,N){function _(){m.memberId=$.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==m.memberId&&(m.settingsList=e[t].list,!0)}m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png",m.pageTitle="",m.collects=0,m.topImgSrc="",m.topBanners=[],m.recommendations=[],m.communities=[],m.competitiveProducts=[],m.recommendProducts=[],m.hotProducts=[],m.cities=[],m.showShare=!1,m.shareImgUrl="",m.isCollected=0,m.dealPrice=p.dealPrice,m.regionId=f.regionId,m.streetId=f.streetId,m.storeId=i.get("storeId",I.globalConstant.storeId),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_1.png",m.isBuyer=parseInt(L.getRole()),m.flashProductList=[],m.midActivtyList=[],m.midCommList=[],m.getCollected=function(){return m.isCollected?"已收藏":"收藏"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(m.paddingtopClass={"margin-top":"16px"},m.paddingtopClasscontent={top:"64px"}):(m.paddingtopClass={"margin-top":"0px"},m.paddingtopClasscontent={top:"44px"}),m.$on("$ionicView.beforeEnter",function(e,t){if(f.shareId&&(I.shareId=f.shareId),"back"==t.direction)return m.getCartNum(),D.isWdHost().success(function(e){I.isWdHost=e.data.isHost}),void _();A.getAllProducts(m.regionId,m.streetId).success(function(e){e.success&&(m.topImgSrc=e.data.topImageUrl,m.shareImgUrl=e.data.simplePicUrl,m.cities=e.data.cities,m.topBanners=e.data.topBanners,m.isCollected=e.data.isCollected,m.isCollected&&(m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_0.png"),m.recommendations=e.data.recommendations,m.hotProducts=e.data.hotProducts,m.communities=e.data.communities,m.competitiveProducts=e.data.competitiveProducts,m.pageTitle=e.data.pageTitle,m.collects=e.data.collects,m.recommendProducts=e.data.recommendProducts,h.$getByHandle("sepcialty_top_banner").update(),h.$getByHandle("sepcialty_top_banner").loop(!0),h.$getByHandle("specialty_recommond_banner").update(),h.$getByHandle("specialty_recommond_banner").loop(!0),null!=m.hotProducts&&(m.hotProdcutTitle=m.hotProducts[0].moudleTitle),null!=m.recommendations&&(m.curatorOfRecommendedTitle=m.recommendations[0][0].moduleTitle),null!=m.competitiveProducts&&(m.boutiqueTitle=m.competitiveProducts[0].moudleTitle))}),m.getCartNum(),D.isWdHost().success(function(e){I.isWdHost=e.data.isHost}),_()}),m.settingsList="",m.getCartNum=function(){x.getNumber().success(function(e){e.success?m.cartTotalNum=e.data:m.cartTotalNum=0})},m.$on("$ionicView.beforeLeave",function(){m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"}),m.goBack=function(){t.goBack()},m.showPopup=function(e){var t=P.show({template:e});S(function(){t.close()},1e3)},m.collected=function(){m.isCollected?A.cancelCollect(m.regionId).success(function(e){e.success&&(m.isCollected=0,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)-1+""),m.showPopup("取消成功"),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_1.png")}):A.addCollect(m.regionId).success(function(e){e.success&&(m.isCollected=1,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)+1+""),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_0.png",m.showPopup("收藏成功"))})},m.goToListOfSpecialtyGoods=function(){v.go("ListOfSpecialtyGoods",{pageId:m.regionId,productCateId:0})},m.showMenu=function(){m.isDisplay?(m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"):(m.isDisplay=!0,m.menuImg=I.imgBaseURL+"img/ic_lookMoreActive.png")},m.hideMenu=function(){m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"},m.cancelShare=function(){m.showShare=!1},m.goSecondLevelStore=function(e){v.go("secondLevelStore",{cityId:e})},m.goProductDetail=function(){v.go("")},m.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:T.getBannerTheme(o).success(function(e){v.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:v.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:m.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);v.go("couponsDetail",{cId:a,userID:m.storeId,type:2})}else v.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);v.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?T.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){v.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&v.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:v.go("crowdFunding");break;case 7:t?v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:m.storeId}):v.go("newSend");break;case 8:t?v.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):v.go("topic.qhot")}},m.toShare=function(){return m.isDisplay=!1,window.cordova?(m.menuImg=I.imgBaseURL+"img/ic_lookMore.png",$.isUserLogin()?(m.showShare=!0,void(window.device&&(m.shareToPlatform(),m.showShare=!m.showShare))):void v.go("login")):void m.showPopup("请下载APP执行此操作")},m.toHomePage=function(){m.isDisplay=!1,v.go("homePage")},m.contactCustomer=function(){if(m.isDisplay=!1,$.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+i.get("sg_login_token_secret").substring(6),"_blank","location=no")}else v.go("login")},m.shareToPlatform=function(e){if(!$.getUser().mid)return void v.go("login");var t=i.get("storeId",I.globalConstant.storeId),s=m.pageTitle,a="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",n=m.shareImgUrl,r=o.getShareLinkHeader()+"SpecialtyVenueHome/"+m.regionId+"/"+m.streetId+"/"+t,c={},l=function(e){N.shareSuccessCallback(e,c)};window.umeng?(0==e?window.umeng.shareToSina(s,a,n,r,0,null,l):1==e?window.umeng.shareToWechatSession(s,a,n,r,0,null,l):2==e?window.umeng.shareToWechatTimeline(s,a,n,r,0,null,l):3==e?(window.umeng.shareToQQ(s,a,n,r,0,null,l),N.qqShare()):4==e&&(window.umeng.shareToQzone(s,a,n,r,0,null,l),N.qqShare()),5==e?m.copeText(r):N.successShare()):alert("umeng undefined 只能在app分享"),m.showShare=!1},m.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),C.showToastShort("复制成功"),m.isShowCopyButton=!1):C.showToast("请下载APP执行此操作")}}]),APP.service("specialtyVenueHomeControllerService",["$http","UrlService",function(e,t){this.getAllProducts=function(o,s){var i={regionId:o,streetId:s};return e.get(t.getZCUrl("SPECIALY_VENUE_HOME"),i)},this.addCollect=function(o){var s={type:2,collectId:o};return e.get(t.getZCUrl("ADD_COLLECT"),s)},this.cancelCollect=function(o){var s={type:2,collectId:o};return e.get(t.getZCUrl("CANCEL_COLLECT"),s)}}]),APP.controller("AdvertisementController",["$scope","$rootScope","$timeout","$state","$interval","$stateParams","AdvertisementService","PopupService",function(e,t,o,s,i,a,n,r){function c(){var t=window.localStorage.getItem("hasAD");"noAD"!=t?(e.imgUrl=t,l=i(function(){e.second<=1?e.skipAd():e.second--},1e3)):s.go(d)}var l,d=a.from;e.imgUrl="",e.second=9,e.skipAd=function(){i.cancel(l),s.go(d)},e.$on("$ionicView.beforeEnter",function(){d=a.from,e.second=9,c()})}]),APP.service("AdvertisementService",["$http","UrlService",function(e,t){this.getAdImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_AD_IMAGE"),o)}}]),APP.controller("DirectPurchaseController",["$scope","UserService","AccountMessageService","$state","LoginService","RegisterService","PopupService","$ionicPopup",function(e,t,o,s,i,a,n,r){e.topPlus={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topPlus={"padding-top":"42px"}),e.init=function(){var o=t.getUser();e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.userLogOut=function(){e.sessionId?o.unloadAccount(e.token,e.sessionId,e.header).success(function(e,o,a,n){if(e.success){t.clearUser(),i.setRole(void 0),s.go("guidePage");var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r)}}):(t.clearUser(),i.setRole(void 0),s.go("guidePage"))},e.goToDelete=function(){r.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.userLogOut()})},e.goShopApply=function(){a.wdApply().success(function(e){e.success?e.data?s.go("newAuthenticationHome"):s.go("registerForStore"):n.showToast("服务端错误")}).error(function(){alert("网络错误")})},e.goSelection=function(){s.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("GuidePageController",["$scope","UserService","$state","LoginService","$localstorage",function(e,t,o,s,i){e.$on("$ionicView.beforeEnter",function(){})}]),APP.controller("LoginController",["$timeout","HomePageService","$location","newUserLoginService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w){function y(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return a.isCommission=o[i].list[0].checked,a.cashSwitch=o[i].list[1].checked,a.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0}}function T(e){r.set("IsThirdLoginType",e),C++;var t={qq:4,sina:6,wechat:7};window.umeng.login(e,function(o){o=JSON.parse(o);var s={uid:o.uid,source:t[e],nickName:o.name,headerPic:o.profile_image_url?o.profile_image_url:o.headimgurl,openid:o.openid,unionid:o.unionid};if(s.uid){var i={userId:s.uid,userName:s.nickName,loginType:t[e],icon:s.headerPic,openid:s.openid,unionid:s.unionid};c.loginThird(i).success(function(e){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.success){d.setUser(e.data),I.initWebSocket();var t=e.data.mid;a.loginMemberId=e.data.mid,y(t),c.checkOpenStore(t).success(function(e){e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",t)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))}),d.setUser(e.data),e.data.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),f.wdApply().success(function(e){e.success?e.data?(d.setUser(e.data),
b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(a.loginGoNum=1,m.goBack(-1)):(a.loginGoNum=0,l.go("newHome"))):l.go("RegisterForStoreLogin",{hasHistory:1}):g.showToast("服务端错误")})}else e.message?g.showToast(e.message):g.showToast("登录失败！")}).error(function(e){p.alert({title:"提示",template:"网络连接失败！"})})}else C>3?g.showToast("授权失败，请稍后再试"):T(e)},function(e){p.alert({title:"提示",template:"第三方登录失败！"})})}-1!=window.location.href.indexOf("fromCommunity")&&(a.fromCommunity=!0),n.isBuyer="1",n.isFocusShow=!0,n.identifyCodeImg="",n.showCaptcha=!1,n.showCaptchaForPhone=!1,n.eyeIndex=0,n.loginIndex=0,n.showVC=!1,n.canGetVcode=!0,n.VCodeTips="获取验证码",n.eyeArr=[a.imgBaseURL+"img/eye_close@2x.png",a.imgBaseURL+"img/eye_open@2x.png"],n.pwdArr=["password","text"],n.loginTypeArr=["短信验证码登录","账号密码登录"],n.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var C=0,b=m.viewHistory().backView,A=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";n.leftArrow={},n.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(n.leftArrow={"margin-top":"36px"},n.rightButton={top:"36px"});n.xyzloginName=d.getUser().loginName,n.userInfo={userName:n.xyzloginName,mobile:d.getUser().mobile,password:"",captcha:"",verificationCode:""},n.VCodeStyle={color:"#2979FF"},n.showVCode=function(){n.showVC=!n.showVC,n.identifyCodeImg="",n.userInfo.captcha="",1==n.loginIndex?(n.loginIndex=0,n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!1):(n.loginIndex=1,n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!0)},n.getVCode=function(){n.canGetVcode&&(n.userInfo.mobile&&0!=n.userInfo.mobile.length?n.globalConstant.mobileNumberRegExp.test(n.userInfo.mobile)?0==n.userInfo.captcha.length&&1==n.showCaptchaForPhone?g.showToast("请输入图形验证码"):c.fastLoginCaptcha(n.userInfo.mobile,n.userInfo.captcha,n.showCaptchaForPhone).success(function(e){if(e.data)if(-1==e.data&&0==n.userInfo.captcha.length)n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!0,g.showToast("请输入图形验证码");else{n.canGetVcode=!n.canGetVcode;var t=60;n.timer=i(function(){t-1<0?(n.VCodeTips="获取验证码",n.VCodeStyle={color:"#2979FF"},i.cancel(n.timer),n.canGetVcode=!0):(n.VCodeStyle={color:"#666666"},t--,n.VCodeTips="重发 "+t+"s")},1e3)}else g.showToast(e.message)}):g.showToast("请输入正确的手机号格式"):g.showToast("请输入手机号"))},n.toggleEye=function(){n.eyeIndex=(n.eyeIndex+1)%2},n.setImgCaptcha=function(){n.identifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+r.get("sg_login_token_secret").substring(6)},n.setImgCaptchaForPhone=function(){n.identifyCodeImg=f.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+r.get("sg_login_token_secret").substring(6)},n.canClickLoginOrNot=function(){0!=n.userInfo.mobile.length&&0!=n.userInfo.verificationCode.length?n.canClickLogin=!0:n.canClickLogin=!1},n.toRegister=function(){b&&"guidePage"!=b.stateName?l.go("register",{hasHistory:1}):l.go("register",{hasHistory:0})},n.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&n.loginSG()},n.loginSG=function(){r.set("IsThirdLoginType","PT"),1==n.loginIndex?0==n.userInfo.mobile.length?g.showToast("请输入手机号"):n.globalConstant.mobileNumberRegExp.test(n.userInfo.mobile)?0==n.userInfo.verificationCode.length?g.showToast("请输入短信验证码"):n.userInfo.verificationCode.length>0&&n.userInfo.verificationCode.length<6||n.userInfo.verificationCode.length>6?g.showToast("短信验证码长度必须是6位"):c.fastLogin(n.userInfo.mobile,n.userInfo.verificationCode).success(function(e){if(e.data){var t=e.data.mid;y(t),a.loginMemberId=e.data.mid,d.setUser(e.data),I.initWebSocket(),a.userCount=n.userInfo.mobile,a.password="",window.localStorage.setItem("isLogin",d.isUserLogin()),g.showToast("登录成功"),e.data.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),a.fromCommunity?window.history.back(-1):b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?m.goBack(-1):l.go("newHome"),window.cordova&&(a.gio.setUserId(t.toString()),a.gio.people.set({name:d.getUser().userName,mobile:d.getUser().mobile,email:d.getUser().email,gender:d.getUser().gender,birthday:d.getUser().birthday})),setTimeout(function(){window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var o={member_id:t,device_type:a.isIOS?"ios":"android",device_token:e};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){})},0),c.checkOpenStore(t).success(function(e,o,s,i){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",t)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))})}else g.showToast(e.message)}):g.showToast("请输入正确的手机号格式"):0==n.userInfo.userName.length?g.showToast("请输入用户名"):0==n.userInfo.password.length?g.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==n.userInfo.captcha.length&&1==n.showCaptcha?g.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(n.userInfo.userName,n.userInfo.password,n.userInfo.captcha).success(function(o){if(o.success){var s=o.data.mid;y(s),a.loginMemberId=o.data.mid,d.setUser(o.data),I.initWebSocket(),a.userCount=n.userInfo.userName,a.password=n.userInfo.password,window.localStorage.setItem("isLogin",d.isUserLogin()),g.showToast("登录成功"),o.data.sessionValue?r.set("sg_login_token_secret","Bearer"+o.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),window.cordova&&(a.gio.setUserId(s.toString()),a.gio.people.set({name:d.getUser().userName,mobile:d.getUser().mobile,email:d.getUser().email,gender:d.getUser().gender,birthday:d.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var t={member_id:s,device_type:a.isIOS?"ios":"android",device_token:e};c.saveDeviceToken(t).success(function(e){e.success}).error(function(e){})},function(e){}),f.wdApply().success(function(e){e.success?e.data?a.fromCommunity?window.history.back(-1):b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(m.goBack(-1),a.loginGoNum=1):(a.loginGoNum=0,l.go("newHome")):t.isWdHost().success(function(e){e.success?(n.o2oMessage=e.message,1==e.data.isHost?a.fromCommunity?window.history.back(-1):1==e.data.o2o||null==e.data.o2o?l.go("newHome"):l.go("RegisterForStoreLogin",{hasHistory:1}):l.go("RegisterForStoreLogin",{hasHistory:1})):g.showToast("获取数据信息失败！")}):g.showToast("服务端错误")}),c.checkOpenStore(s).success(function(e){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",s)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))})}else o.message?"forget_password"==o.errorCode?(g.showToast(o.message),e(function(){l.go("requestPassword")},2e3)):-1==o.data?(g.showToast(o.message),n.showCaptcha=!0,n.setImgCaptcha()):g.showToast(o.message):g.showToast("登录失败")})},n.isHideFooter=function(){n.isFocusShow=!1},n.isShowFooter=function(){n.isFocusShow=!0},n.thirdLogin=function(e){if(C=0,!window.umeng)return void alert("umeng 插件 未加载");T(e)},n.goBack=function(){window.location.href.indexOf("?fromCommunity")>-1?window.history.back():m.goBack()},n.$on("$ionicView.beforeEnter",function(e,t){if(n.showCaptcha=!1,n.showCaptchaForPhone=!1,n.setImgCaptchaForPhone(),c.checkLogin().success(function(e,t,o,s){n.setImgCaptcha(),n.setImgCaptchaForPhone()}),b=m.viewHistory().backView,"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i))if(n.urlbase=o.absUrl(),n.urlbase.indexOf("code")>0)n.codeString=n.urlbase.substring(n.urlbase.indexOf("code"),n.urlbase.indexOf("&")),n.getCode=n.codeString.substring(5),s.findStatus(n.getCode).success(function(e){if(e.success&&e.data.unionid)if(n.userData=e.data,1==n.userData.isBinded){var t=r.get("backfront");if(t){var o=JSON.parse(t);n.frontView=o.stateName,n.params=o.stateParams,e.data.memberViewA.mid,a.loginMemberId=e.data.memberViewA.mid,d.setUser(e.data.memberViewA),I.initWebSocket(),a.userCount=n.userInfo.mobile,a.password="",window.localStorage.setItem("isLogin",d.isUserLogin()),a.isWdHost=1,e.data.memberViewA.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.memberViewA.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),"guidePage"==n.frontView||"register"==n.frontView||"changePassword"==n.frontView||"myPhoneBindSuccess"==n.frontView?(l.go("newHome"),r.set("backfront","")):(l.go(n.frontView,n.params),r.set("backfront",""))}}else n.url=encodeURIComponent(v.getThirdUrl("www/#/login/newUserLogin")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+n.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"});else{var i=JSON.stringify(b);r.set("backfront",i),n.url=encodeURIComponent(v.getThirdUrl("www/index.html#/login")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+n.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"}})}]),APP.service("LoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,s,i){var a={userName:o,password:encodeURIComponent(s),captcha:i,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),a)},this.loginUserInfo=function(o,s){var i={userName:o,password:s,noLoading:!0};return e.get(t.getUrl("LOGIN"),i)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var s={memberId:o};else s={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),s)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,s,i){if(i){var a={mobile:o,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:a,headers:{Authorization:"open the gate"}})}return a={mobile:o},e.get(t.getUrl("FAST_LOGIN_CAPTCHA"),a)},this.fastLogin=function(o,s){var i={mobile:o,captcha:s};return e.post(t.getUrl("FAST_LOGIN")+"?mobile="+i.mobile+"&captcha="+i.captcha)}}]),APP.controller("RegisterController",["$rootScope","$localstorage","$scope","$http","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){function w(t){var o=t;if(localStorage.getItem("setSwitch")){for(var s=JSON.parse(localStorage.getItem("setSwitch")),i=!1,a=s.length-1;a>=0;a--)if(s[a].id==o)return e.isCommission=s[a].list[0].checked,e.cashSwitch=s[a].list[1].checked,e.goldRainSwitch=s[a].list[2].checked,void(i=!0);if(!i){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var n={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};s.push(n),localStorage.setItem("setSwitch",JSON.stringify(s))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=[e.imgBaseURL+"img/eye_close@2x.png",e.imgBaseURL+"img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=e.imgBaseURL+"img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var y=h.hasHistory,T=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=n(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},n.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else a.showToast(e.message)}):a.showToast("请输入正确的手机号格式"):a.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?a.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?a.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?a.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(i){if(i.data){var n=i.data.mid;w(n),e.loginMemberId=i.data.mid,l.setUser(i.data),v.initWebSocket(),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+S.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?f.goBack(-1):r.go("newHome"),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(e,i,a,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get($.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?a.showToast("请输入用户名"):0==o.loginInfo.password.length?a.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?a.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(s){if(s.success){var n=s.data.mid;w(n),e.loginMemberId=s.data.mid,l.setUser(s.data),v.initWebSocket(),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),s.data.sessionValue?t.set("sg_login_token_secret","Bearer"+s.data.sessionValue):t.set("sg_login_token_secret","Bearer"+S.generateUUID()),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),i.wdApply().success(function(t){t.success?t.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("newHome")):r.go("RegisterForStoreLogin",{hasHistory:1}):a.showToast("服务端错误")}),c.checkOpenStore(n).success(function(e){e.data?t.set("storeId",n):t.set("storeId",20219251)})}else s.message?(a.showToast(s.message),-1==s.data&&(o.showCaptcha=!0),o.setImgCaptcha()):a.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)};var C=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?a.showToast("请输入验证码！"):i.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;C=n(function(){t<=0?(n.cancel(C),C=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?a.showToast("该手机号已经注册过顺逛用户，请直接登录。"):e.message?a.showToast(e.message):a.showToast("获取验证码失败！")}):a.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?a.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?a.showToast("请输入短信验证码！"):0==o.xychecked?a.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》！"):i.newAddRegisterUserInfo(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(e.data.isCanRegister){var s={mobileNum:o.userInfo.mobileNum,password:o.userInfo.password,captcha:o.userInfo.captcha,imgCaptcha:o.userInfo.captchaImg};t.setObject("register_obj",s),m(function(){r.go("newAuthenticationHome",{promotionCode:o.promotionCode,types:100})},0)}}else a.showToast(e.message)}):a.showToast("密码不符合规则！"):a.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=!1,c.checkLogin().success(function(e,t,s,i){o.setImgCatpcha()}),y=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?I.open($.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e}}]),APP.service("RegisterService",["$http","UrlService",function(e,t){this.addRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:i,imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:n})},this.newAddRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(assword),imgCaptcha:a,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:n})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RegisterForStoreController",["$localstorage","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","$rootScope","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){t.captchaFlag=!0,t.isAgreeConsent=!1,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.iconImage=f.imgBaseURL+"img/ic_photo.png";var $=m.hasHistory;t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.agreeConsent=function(){t.isAgreeConsent=!t.isAgreeConsent};var S=void 0;t.getIdentifyCode=function(){t.captchaFlag&&(t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?s.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e){if(e.success){var o=60;S=i(function(){o<=0?(i.cancel(S),S=void 0,o=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=o+"秒后可重发",t.captchaFlag=!1,o--)},1e3,100)}else"1102"==e.errorCode?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！"))},t.registerUserInfo=function(){var e=t.globalConstant.passwordRegExp;t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.password.length?s.showToast("请输入密码！"):e.test(t.userInfo.password)?0==t.userInfo.captcha.length?s.showToast("请输入短信验证码！"):t.isAgreeConsent?s.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):o.bindMobile(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void s.showToast(e.message);r.getUser();r.getUser().mobile=t.userInfo.mobileNum,a.go("newAuthenticationHome")}else"该手机已被注册！"==e.message?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("注册失败！")}):s.showToast("密码不符合规则！"):s.showToast("请输入在正确的手机号！")},t.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})},t.setHeaderImg=function(){return},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha(),$=m.hasHistory})}]),APP.controller("RegisterForStoreLoginController",["$localstorage","$rootScope","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){o.captchaFlag=!0,o.isAgreeConsent=!1,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=t.imgBaseURL+"img/ic_photo.png";var $=f.hasHistory;o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.setImgCatpcha=function(){o.identifyCodeImg=s.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.agreeConsent=function(){o.isAgreeConsent=!o.isAgreeConsent},o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})};var S=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?i.showToast("请输入验证码！"):s.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;S=a(function(){t<=0?(a.cancel(S),S=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?i.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?i.showToast("请输入短信验证码！"):o.isAgreeConsent?i.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):s.bindMobile(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void i.showToast(e.message);c.getUser();c.getUser().mobile=o.userInfo.mobileNum,t.fromCommunity?window.history.back(-2):0==t.loginGoNum?n.go("homePage"):m.goBack(-2)}else"该手机已被注册！"==e.message?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("注册失败！")}):i.showToast("密码不符合规则！"):i.showToast("请输入在正确的手机号！")},o.setHeaderImg=function(){return},o.$on("$ionicView.beforeEnter",function(){o.setImgCatpcha(),$=f.hasHistory})}]),APP.controller("RegisterV2Controller",["$rootScope","$localstorage","$scope","$http","RegisterV2Service","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w){function y(t){var o=t;if(localStorage.getItem("setSwitch")){for(var s=JSON.parse(localStorage.getItem("setSwitch")),i=!1,a=s.length-1;a>=0;a--)if(s[a].id==o)return e.isCommission=s[a].list[0].checked,e.cashSwitch=s[a].list[1].checked,e.goldRainSwitch=s[a].list[2].checked,void(i=!0);if(!i){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var n={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};s.push(n),localStorage.setItem("setSwitch",JSON.stringify(s))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}var T='<div style="background:#ffffff;width:304px;border-radius:10px;position:relative;padding:10px 0;">                          <div class="cancel-btn" style="position:absolute;top:10px;right:10px;width:20px;height: 20px;"><img src="'+e.imgBaseURL+'img/regist/xxx@2x.png" style="width:100%"></div>                          <div style="padding:20px 0px;">                            <h5 align="center" style="color:#333333 ;front-size:16px;line-height: 22px;font-weight: 600;">恭喜您成为顺逛会员</h5>                            <h5 align="center" style="color:#666666;font-size:14px;line-height:22px;">升级微店主领佣金，可享更多权益</h5>                          </div>                          <div style="width:100%">                            <img src="'+e.imgBaseURL+'img/regist/open_store.png" style="width:100%"/>                          </div>                          <div class="ok-btn new_authentication_home_btn" style="height:44px;line-height: 44px;">                              <span style="background: #2979FF;font-size: 16px;">立即升级微店主</span>                          </div>                        </div>';o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=["img/eye_close@2x.png","img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage="img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var C=h.hasHistory,b=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=n(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},n.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else a.showToast(e.message)}):a.showToast("请输入正确的手机号格式"):a.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?a.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?a.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?a.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(i){if(i.data){v.initWebSocket();var n=i.data.mid;if(y(n),e.loginMemberId=i.data.mid,l.setUser(i.data),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var d=n.toString();window.xneng.NTalkerLogin(d,l.getUser().userName,"0",function(e){},function(e){})}if(b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?f.goBack(-1):r.go("newHome"),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var p={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(n+"",p)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(e,i,a,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?a.showToast("请输入用户名"):0==o.loginInfo.password.length?a.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?a.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(n){if(n.success){v.initWebSocket();var d=n.data.mid;if(y(d),e.loginMemberId=n.data.mid,l.setUser(n.data),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),n.data.sessionValue?t.set("sg_login_token_secret","Bearer"+n.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var p=d.toString();window.xneng.NTalkerLogin(p,l.getUser().userName,"0",function(e){},function(e){})}if(window.cordova&&(e.gio.setUserId(d.toString()),e.gio.people.set({name:l.getUser().userName,
mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var u={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(d+"",u)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:d,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),i.wdApply().success(function(t){t.success?t.data?b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("newHome")):r.go("RegisterForStoreLogin",{hasHistory:1}):a.showToast("服务端错误")}),c.checkOpenStore(d).success(function(e){e.data?t.set("storeId",d):t.set("storeId",20219251)})}else n.message?(a.showToast(n.message),-1==n.data&&(o.showCaptcha=!0),o.setImgCaptcha()):a.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.isNeedCaptcha=function(){var e=(new Date).getTime(),o=t.get("sms_captcha_timestamp"),s=o&&null!=o&&e-o<864e5;return s};var A=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?o.showCaptcha&&0==o.userInfo.captchaImg.length?a.showToast("请输入验证码！"):c.fastLoginCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg,o.showCaptcha).success(function(e){if(e.success){t.set("sms_captcha_timestamp",(new Date).getTime());var s=60;return void(A=n(function(){s<=0?(n.cancel(A),A=void 0,s=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=s+"秒后可重发",o.captchaFlag=!1,s--)},1e3,100))}o.showCaptcha=!0,e.message?a.showToast(e.message):a.showToast("获取验证码失败！")}):a.showToast("请输入正确的手机号码！"))},o.doLoginSuccess=function(){b&&"guidePage"!=b.stateName&&"login"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?f.goBack(-1):r.go("newHome")},o.registerUserInfo=function(){o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captcha.length?a.showToast("请输入短信验证码！"):c.fastLogin(o.userInfo.mobileNum,o.userInfo.captcha).success(function(i){if(i.data){v.initWebSocket();var n=i.data.mid;if(y(n),l.setUser(i.data),e.isNewUser=i.data.isNewUser,e.loginMemberId=i.data.mid,e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var d=n.toString();window.xneng.NTalkerLogin(d,l.getUser().userName,"0",function(e){},function(e){})}if(window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var p={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(n+"",p)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(i,l,d,p){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),i.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251)),"0"==o.isBuyer&&h.promotionCode&&null!=h.promotionCode&&""!=$.trim(h.promotionCode))return void r.go("newAuthenticationHome",{promotionCode:h.promotionCode});if(e.isNewUser)var u=a.dialog({content:T,buttons:[{selector:".ok-btn",handler:function(){u.remove(),r.go("newAuthenticationHome",{promotionCode:h.promotionCode})}},{selector:".cancel-btn",handler:function(){u.remove(),o.doLoginSuccess()}}]});else o.doLoginSuccess()})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.canGoBack=function(e){e.pageX<32&&f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=o.isNeedCaptcha(),c.checkLogin().success(function(e,t,s,i){o.setImgCatpcha()}),C=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?w.open(S.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e},o.isShowService=!0,o.closeRule=function(){o.isShowService=!1},o.toLogin=function(){r.go("login")},o.goHelpDetail=function(){r.go("helpDetail",{helpId:1002,content:"顺逛微店注册协议"})}}]),APP.service("RegisterV2Service",["$http","UrlService","$state","$localstorage",function(e,t,o,s){this.setPassword=function(o){var i={password:o},a={TokenAuthorization:s.get("sg_login_token_secret")};return e({method:"POST",url:t.getUrl("SET_PASSWORD_INIT"),headers:a,params:i})},this.addRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:i,imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:n})},this.newAddRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:n})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RequestPasswordController",["$localstorage","$scope","RequestPasswordService","PopupService","$interval","$state","$timeout",function(e,t,o,s,i,a,n){t.captchaFlag=!0,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.getIdentifyCode=function(){t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?s.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e,o,a,n){if(e.success){var r=60,c=void 0;c=i(function(){r<=0?(i.cancel(c),c=void 0,r=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=r+"秒后可重发",t.captchaFlag=!1,r--)},1e3,100)}else e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！")},t.passwordSubmit=function(){0==t.userInfo.mobileNum.length?s.showToast("请输入您的手机号！"):t.globalConstant.passwordRegExp.test(t.userInfo.password)?0==t.userInfo.captcha.length?s.showToast("获取验证码失败！"):o.requestPassword(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e,o,i,r){e.success?(s.showToast("修改成功"),n(function(){a.go("login")},1e3)):e.message?(s.showToast(e.message),t.setImgCatpcha()):(s.showToast("提交失败！"),t.setImgCatpcha())}):s.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)")},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha()})}]),APP.service("RequestPasswordService",["$http","UrlService",function(e,t){this.requestPassword=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a};return e({method:"POST",url:t.getUrl("REQUEST_PASSWORD"),params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_PASSWORD_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")}}]),APP.controller("ShopApplyController",["$scope","$rootScope","$state","ShopApplyService","MyStoreService","GoodsService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){e.addressName="",e.goToAddress=!1,e.categoryData=[],e.selectText="",e.selectKey="";var $=window.innerHeight,S=$-373+"px";e.contentHeight={height:S},e.addressTitle="配送至",e.dataAdd=null,e.flag="SHOP_APPLY_ADDRESS",e.defaultValue=null,e.level=0;var I,w,y={};e.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:""},e.mid=l.getUser().mid,e.promotionCode=p.promotionCode,e.init=function(){e.showAlert=!1,e.goToAddress?e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour:e.addressName="",e.selectText=e.textUnion,e.selectValue=e.valueUnion,e.mid=l.getUser().mid,p.promotionCode&&(e.applyInfo.promotionCode=p.promotionCode),e.mid&&d.getStoreInfo(e.mid).success(function(t,o,s,i){t.success&&(e.storeCode=t.data.storeCode,e.storeType=t.data.storeType)})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,f.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",a.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var T=!1;e.goSelect=ionic.Utils.debounce(function(o,s){for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var s=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=f.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){1==ah&&(w=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(w,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,f.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=f.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=f.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,i.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(I=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,i.getLocationList(I,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),f.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else{if(T)return;g(function(){T=!1},1500),t.$broadcast(e.flag,e.defaultValue),T=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){y=n.getAddressInfo();var o=y.regionName+"/"+y.streetName;i.addAddress(y.provinceId,y.cityId,y.areaId,o,y.streetId).success(function(){var o={"text-1":y.provinceName,"text-2":y.cityName,"text-3":y.regionName,"text-4":y.streetName,"value-1":y.provinceId,"value-2":y.cityId,"value-3":y.areaId,"value-4":y.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.$on("$destroy",function(){e.addressModal.remove()}),t.$on("SHOP_APPLY_ADDRESS",function(t,o){e.goToAddress=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.adrProvinceId=o["value-1"],e.adrCityId=o["value-2"],e.adrAreaId=o["value-3"],e.adrStreetId=o["value-4"],e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour}),t.$on("SHOP_APPLY_UNION",function(t,o){e.textUnion=o.text,e.valueUnion=o.value}),e.checkChange=function(t,o){s.checkText(t).success(function(s){s.data||""==t||("-100"!=s.errorCode&&r.showToast("请不要使用违禁词！"),1==o?e.applyInfo.ownerName="":e.applyInfo.storeName="")})},e.shopApplySubmit=function(){return e.applyInfo.ownerName?e.applyInfo.address?e.applyInfo.storeName?(e.showAlert=!1,void(/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.ownerName)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{2,50}$/.test(e.applyInfo.address)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.storeName)?/^(HR|hr|Hr|hR).{6,18}$/.test(e.applyInfo.hrCode)||"10"!=e.selectValue?0==e.addressName.length?r.showToast("请选择所在地区！"):e.selectText?"10"!=e.selectValue?(e.showAlertCheck=!1,e.showAlert=!1,e.applyInfo.hrCode="",s.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:Math.round(t.data.totalCommission),memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):(t.errorCode="-100")?(u.show({template:"您尚未登录或登录失效,请先登录",duration:3500}),o.go("login")):r.showToast(t.message)})):(e.showAlertCheck=!1,e.showAlert=!1,s.check(e.applyInfo.hrCode).success(function(t,i,a,n){t?s.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:t.data.totalCommission,memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):r.showToast(t.message)}):e.showAlertCheck=!0})):r.showToast("请选择联盟分类！"):e.showAlert=!0:r.showToast("店铺名字为1～20的常用字符！"):r.showToast("详细地址为2～50的常用字符！"):r.showToast("店主姓名为1～20的常用字符！"))):void r.showToast("店铺名称必须填写！"):void r.showToast("详细地址必须填写！"):void r.showToast("店主姓名必须填写！")},e.clearInput=function(){e.applyInfo.ownerName=void 0,e.applyInfo.address=void 0,e.applyInfo.storeName=void 0,e.promotionCode||(e.applyInfo.promotionCode=""),e.addressName="",e.applyInfo.hrCode=void 0,e.selectText=void 0},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(t,s){if(e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&f.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.promotionCode=p.promotionCode,l.isUserLogin()){if(1==c.getRole())return u.show({template:"您已经是店主了,进店看看吧",duration:2500}),void g(function(){},2e3).then(function(){o.go("shop")});e.init()}else e.init();"back"==s.direction||e.clearInput(),e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.controller("ShopApplySuccessController",["trueAuthenticationService","$scope","$stateParams","ShopApplySuccessService","$ionicHistory","$state","$rootScope","RegisterV2Service","PopupService",function(e,t,o,s,i,a,n,r,c){var l='<div style="background:#ffffff;width:304px;border-radius:5px;position:relative;padding: 20px 20px 5px 20px;">                        <div class="cancel-btn" style="position:absolute;top:10px;right:10px;width:20px;height: 20px;">                          <img src="'+n.imgBaseURL+'img/regist/xxx@2x.png" style="width:100%">                        </div>                        <div>                          <h5 style="font-size: 16px;line-height:22px;color:#333333;opacity: 0.86;">请输入您的登录密码</h5>                        </div>                        <div style="padding:20px 0 0 0px;border-bottom:1px solid #E4E4E4;">                          <input name="password" type="password" placeholder="请输入您的密码" style="width:100%;padding:10px;font-size:14px;line-height:22px;"/>                        </div>                        <div class="ok-btn new_authentication_home_btn" style="margin-top:15px;height:44px;line-height: 44px;width:100%;">                            <span style="background: #2979FF;font-size: 16px;">提交</span>                        </div>                    </div>';t.$on("$ionicView.beforeEnter",function(){t.isNewUser=n.isNewUser;i.viewHistory().histories.root;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),s.getShopData().success(function(e){e.success?(t.memberCount=e.data.openStoreRank,"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr2","ownerregist","1"])):t.memberCount=888888}),t.isOrNoGoHomePage=function(){a.go("newHome")},t.setPassword=function(){var e=c.dialog({content:l,buttons:[{selector:".ok-btn",handler:function(){var o=e.find(":input[type='password']").val(),s=t.globalConstant.passwordRegExp;0==o.length?c.showToast("请输入密码！"):s.test(o)?(e.remove(),r.setPassword(o).success(function(e,t,o,s){e.success?(c.showToast("设置登陆密码成功！"),a.go("newHome")):e.message?c.showToast(e.message):c.showToast("设置登陆密码发生异常！")})):c.showToast("密码不符合规则！")}},{selector:".cancel-btn",handler:function(){e.remove(),a.go("newHome")}}]})}})}]),APP.service("ShopApplySuccessService",["$http","UrlService",function(e,t){this.getShopData=function(){return e.post(t.getUrl("SHOP_APPLY_SUCCESS"))}}]),APP.controller("CustomizehdController",["$scope","$stateParams","$ionicHistory","$rootScope","$state",function(e,t,o,s,i){e.imgUrl=t.url,e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},e.goBack=function(){"advertisement"==s.fromState?i.go("homePage"):e.goBackFlag&&(e.goBackFlag=!1,o.goBack())},e.$on("$ionicView.beforeEnter",function(o,s){e.goBackFlag=!0,e.imgUrl=t.url})}]),APP.controller("haierStaffControl",["trueAuthenticationService","$interval","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","haierStaffService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){g.captchaFlag=!0,g.paracont="获取验证码",g.isStaff=!1,g.isBtnShow=!1,g.isActiveTimer=!1,g.staffId="",g.obj={staffId:"",verification:""},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(g.paddingtopClass={"margin-top":"16px"},g.paddingtopClasscontent={top:"60px"}):(g.paddingtopClass={"margin-top":"0px"},g.paddingtopClasscontent={top:"44px"}),g.init=function(){e.doInit().success(function(e){e.success?null!=e.data.empInfo?(g.isStaff=!0,g.staffId=e.data.empInfo.empNo,f.getActiveIsStart().success(function(e){g.isActiveTimer=!!e})):(g.isStaff=!1,g.isActiveTimer=!1):o.showToast(e.message)})};g.$watch("obj",function(){/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)&&/^[0-9]{6}$/.test(g.obj.verification)?g.isBtnShow=!0:g.isBtnShow=!1},!0);g.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?n.open(a.getHead()+"mstore/sg/helpDetail.html?id="+e,t):m.go("helpDetail",{helpId:e,content:t})},g.goBack=function(){c.goBack()},g.submitStaffMsg=function(){var e=g.obj.staffId.toLowerCase();f.postStaffMsg(e,g.obj.verification).success(function(e){e.success&&null!=e.data?(o.showToast("海尔员工认证成功!"),f.getActiveIsStart().success(function(e){e?(g.init(),g.isActiveTimer=!0):(g.isActiveTimer=!1,m.go("trueAuthenticationList"))})):o.showToast(e.message)})};var $,S=void 0;g.getIdentifyCode=function(){if(g.captchaFlag)if(/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)){var e=g.obj.staffId.toLowerCase();f.doInit(e).success(function(e){e.success?($=60,S=t(function(){$<=0?(t.cancel(S),S=void 0,$=60,g.paracont="重发验证码",g.captchaFlag=!0):(g.paracont=$+"秒后可重发",g.captchaFlag=!1,$--)},1e3,100)):o.showToast(e.message)})}else o.showToast("请输入正确的员工编号！")},g.goNewYearActive=function(){m.go("bannerTheme",{bannerId:a.getCPUrl("KMH_ID")})},g.$on("$ionicView.beforeEnter",function(){g.obj={staffId:"",verification:""},g.staffId="",g.captchaFlag=!0,$=60,g.paracont="获取验证码",t.cancel(S),g.init()})}]),APP.service("haierStaffService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={empNo:o};return e.get(t.getUrl("GET_HAIER_STAFF_MSG"),s)},this.postStaffMsg=function(o,s){var i={empNo:o,captcha:s};return e({method:"POST",url:t.getUrl("POST_HAIER_STAFF_MSG"),params:i})},this.getActiveIsStart=function(){return e.get(t.getGameUrl("IS_KAIMENHONG_AVAILABLE"))}}]),APP.controller("newAuthenticationHome",["GetStatisticInfoService","HomePageService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","ShopApplyService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){n.localStorage=window.localStorage,n.addressName="请选择",n.goToAddress=!1,n.categoryData=[],n.selectText="",n.selectKey="",n.isComplete=!1,n.isHasKey=!1,n.hrCodes=!1,n.promotionCode="",n.avatarImage="img/registerSuccess.png",n.userInfo={picTempFile:""};var T=window.innerHeight,C=T-373+"px";n.contentHeight={height:C},n.addressTitle="配送至",n.dataAdd=null,n.flag="SHOP_APPLY_ADDRESS",n.defaultValue=null,n.level=0;var b={};n.user={},n.mid=m.getUser().mid,n.init=function(){n.user=m.getUser(),void 0!=n.user.avatarImageFileId&&(n.avatarImage=n.user.avatarImageFileId),n.addressName="请选择",n.showAlert=!1,n.goToAddress?n.addressName=n.textOne+n.textTwo+n.textThree:n.addressName="",n.selectText=n.textUnion,n.applyInfo.category=n.selectText,n.selectText&&(n.infos=n.selectText.substring(0,4),"人人服务"==n.infos?n.hrCodes=!0:n.hrCodes=!1),n.selectValue=n.valueUnion,n.mid=m.getUser().mid,n.mid&&f.getStoreInfo(n.mid).success(function(e,t,o,s){e.success&&(n.storeCode=e.data.storeCode,n.storeType=e.data.storeType)})},n.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},n.addressTop=function(){n.addressTipFlag=!1,n.provinceTop=0,n.nowLevel=0,n.nowLevelIndex=[-1,-1,-1,-1],n.provinceDis=!1,n.cityDis=!1,n.areaDis=!1,n.addressModal.show(),n.dataAdd=null,n.defaultValue=null,n.selectProvince="",n.selectCity="",n.selectArea="",n.addressInit(n.dataAdd,n.defaultValue,"SHOP_APPLY_ADDRESS",0)},n.addressInit=function(e,t,o,s){if(n.addressTipFlag=!1,I.$getByHandle("mainScroll").scrollTop(),n.addressTitle="配送至",n.defaultValue=e?JSON.parse(e):{},n.level=s,t){n.dataAdd=JSON.parse(t),n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel,n.applyInfo.arr=n.nowLevelIndex;for(var i=0;i<n.nowLevelIndex.length;i++)i>n.nowLevel&&(n.nowLevelIndex[i]=-1)}else n.finish=!1,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",d.getLocationList("",0).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1,n.finish=!0,n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel,n.applyInfo.num=n.nowLevel;for(var t=(JSON.stringify(n.defaultValue),JSON.stringify(n.dataAdd),0);t<n.nowLevelIndex.length;t++)t>n.nowLevel&&(n.nowLevelIndex[t]=-1)}).error(function(e){u.showToast("获取地址信息失败！")})},n.bottomBorder={"border-bottom":"2px solid red"},n.provinceFlag=!1,n.cityFlag=!1,n.areaFlag=!1,n.selectFlag=!0,n.provinceDis=!1,n.cityDis=!1,n.areaDis=!1,n.provinceSel=function(){n.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),n.selectCity="",n.selectArea="",n.provinceFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!1,n.areaDis=!1};var A=!1;n.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<n.nowLevelIndex.length;o++)o>n.nowLevel&&(n.nowLevelIndex[o]=-1);n.dataAdd="",n.nowLevelIndex[n.nowLevel]=e;var t=arguments[1],e=arguments[0];if(n.level=n.level-1,n.defaultValue["text"+n.level]=t.text,n.defaultValue["value"+n.level]=t.value,n.level>-2)-1==n.level&&(n.selectProvince=t.text,n.provinceIndex=e,n.provinceFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.provinceTop=I.$getByHandle("mainScroll").getScrollPosition().top,n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel),ah=-1*n.level,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,d.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),n.dataAdd=e.data,n.addressTipFlag=!1;var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1,n.citySel=function(){n.level=n.levelArea,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",d.getLocationList(areaValueCity,1).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1;var t=JSON.stringify(n.defaultValue),o=JSON.stringify(n.dataAdd);n.addressInit(t,o,n.flag,-1),n.selectArea="",n.cityFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!1,I.$getByHandle("mainScroll").scrollTo(0,n.cityTop)}).error(function(e){u.showToast("获取地址信息失败！")})};else if(n.level>-4&&-3!=n.level)n.selectCity=n.defaultValue["text-2"],n.provinceFlag=!1,n.cityFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!1,n.cityTop=I.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*n.level,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,s.getLocationList(t.value,ah).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1,n.areaSel=function(){n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",n.level=n.levelArea,s.getLocationList(areaValue,2).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1;var t=JSON.stringify(n.defaultValue),o=JSON.stringify(n.dataAdd);n.addressInit(t,o,n.flag,n.level),I.$getByHandle("mainScroll").scrollTo(0,n.areaTop),n.areaFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!0}).error(function(e){u.showToast("获取地址信息失败！")})};else if(-3==n.level)n.addressModal.hide(),n.regionTrue=!0,n.textOne=n.defaultValue["text-1"],n.textTwo=n.defaultValue["text-2"],n.textThree=n.defaultValue["text-3"],n.adrProvinceId=n.defaultValue["value-1"],n.adrCityId=n.defaultValue["value-2"],n.adrAreaId=n.defaultValue["value-3"],n.addressName=n.textOne+" "+n.textTwo+" "+n.textThree,n.selectArea=t.text,n.cityFlag=!1,n.areaFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!0,n.areaTop=I.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*n.level,s.getLocationList(t.value,ah).success(function(e){n.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1;else{if(A)return;$(function(){A=!1},1500),r.$broadcast(n.flag,n.defaultValue),A=!0,n.closeAddressModal()}},300),n.getPosition=function(){if("定位中···"!=r.globalConstant.autoPosition){b=p.getAddressInfo();var e=b.regionName+"/"+b.streetName;d.addAddress(b.provinceId,b.cityId,b.areaId,e,b.streetId).success(function(){var e={"text-1":b.provinceName,"text-2":b.cityName,"text-3":b.regionName,"value-1":b.provinceId,"value-2":b.cityId,"value-3":b.areaId};r.$broadcast(n.flag,e),n.addressModal.hide()})}},w.fromTemplateUrl("templates/common/CommonLocation.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.addressModal=e}),n.closeAddressModal=function(){n.addressModal.hide()},n.$on("$destroy",function(){n.addressModal.remove()}),r.$on("SHOP_APPLY_ADDRESS",function(e,t){n.goToAddress=!0,n.textOne=t["text-1"],n.textTwo=t["text-2"],n.textThree=t["text-3"],n.adrProvinceId=t["value-1"],n.adrCityId=t["value-2"],n.adrAreaId=t["value-3"],n.addressName=n.textOne+n.textTwo+n.textThree}),r.$on("SHOP_APPLY_UNION",function(e,t){n.textUnion=t.text,n.valueUnion=t.value}),n.checkChange=function(e,t){l.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&u.showToast("请不要使用违禁词！"),1==t?n.applyInfo.ownerName="":n.applyInfo.storeName="")})},n.goCommonUnion=function(){"请选择"==n.addressName?u.showToast("请选择所在地区！"):c.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};n.$watch("applyInfo",function(){n.applyInfo.storeName&&n.applyInfo.category?0==n.promotionCode.length&&0==n.applyInfo.promotionCode.length?n.isComplete=!1:n.isComplete=!0:n.isComplete=!1},!0);n.goAuthentication=function(){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(n.showAlert=!1,n.applyInfo.storeName.length<=1)u.showToast("店铺名字为2～20的常用字符！");else if(/[\ud800-\udbff][\udc00-\udfff]/g.test(n.applyInfo.storeName))u.showToast("亲，不可以使用表情喔!");else if(t.test(n.applyInfo.storeName))u.showToast("店铺名称不能包含特殊字符!");else if(0==n.addressName.length)u.showToast("请选择所在地区！");else if(n.selectText)if(/^(HR|hr|Hr|hR).{6,18}$/.test(n.applyInfo.hrCode)||"10"!=n.selectValue)if(0==n.promotionCode.length&&0==n.applyInfo.promotionCode.length)u.showToast("请填写推荐码!");else{
n.xyzPromotionCode=0==n.promotionCode.length?n.applyInfo.promotionCode:n.promotionCode;var s={storeName:n.applyInfo.storeName,memberType:n.selectValue,provinceId:n.adrProvinceId,cityId:n.adrCityId,regionId:n.adrAreaId,regionName:n.addressName,address:n.applyInfo.address,promotionCode:n.applyInfo.promotionCode,hrCode:n.applyInfo.hrCode,isPromotionCode:n.promotionCode};a.setObject("newAuthentication_obj",s);var i=0==n.promotionCode.length?n.applyInfo.promotionCode:n.promotionCode;n.register_obj=a.getObject("register_obj"),n.register_obj.mobileNum!=n.iphoneNumber&&100==n.types?l.newShop(n.applyInfo.storeName,n.selectValue,i,n.applyInfo.hrCode,n.adrProvinceId,n.adrCityId,n.adrAreaId,n.addressName,n.applyInfo.address,n.register_obj.mobileNum,n.register_obj.password,n.register_obj.captcha,n.register_obj.imgCaptcha).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?a.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):a.set("sg_login_token_secret","Bearer"+e.generateUUID())),o.initWebSocket(),$(function(){c.go("shopApplySuccess")},100)):u.showToast(t.message)}):l.applySubmitStore(n.memberId,n.applyInfo.storeName,n.selectValue,i,n.applyInfo.hrCode,n.adrProvinceId,n.adrCityId,n.adrAreaId,n.addressName,n.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?a.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):a.set("sg_login_token_secret","Bearer"+e.generateUUID())),$(function(){c.go("shopApplySuccess")},100)):u.showToast(t.message)})}else u.showToast("上岗证号必须为HR开头，总长度8-20位！");else u.showToast("请选择类别！")},n.getPromotionCode=function(){if(!(n.adrAreaId||"请选择"!=n.addressName||n.adrCityId||n.adrProvinceId))return void u.showToast("请选择地址");0!=n.promotionCode.length?u.showToast("您已有推荐码，快快完成注册吧。"):0!=n.applyInfo.promotionCode.length?u.showToast("您已有推荐码，快快完成注册吧。"):l.getPromotion(n.adrAreaId).success(function(e){e.success?null!=e.data&&(n.applyInfo.promotionCode=e.data):u.showToast(e.message)})},n.isFocus=function(){n.isHasKey=!0},n.isBlur=function(){n.isHasKey=!1},n.isClear=function(){n.applyInfo.address="",n.isHasKey=!1},n.clearInput=function(){n.applyInfo.ownerName=void 0,n.applyInfo.address=void 0,n.applyInfo.storeName=void 0,n.addressName="请选择",n.applyInfo.hrCode=void 0,n.selectText="请选择"},n.$on("$ionicView.beforeLeave",function(e,t){n.watch()}),n.$on("$ionicView.beforeEnter",function(e,t){if(n.memberId=m.getUser().mid,n.iphoneNumber=m.getUser().mobile,n.dataAdd=null,n.defaultValue=null,n.hrCodes=!1,n.promotionCode=h.promotionCode,n.types=h.types,n.nowLevel=0,n.nowLevelIndex=[-1,-1,-1,-1],n.provinceTop=0,n.cityTop=0,n.areaTop=0,n.finish=!1,n.watch=n.$watch("finish",function(e,t){e&&I.$getByHandle("mainScroll").scrollTo(0,n.provinceTop)}),m.isUserLogin()){if(10==g.getRole())return v.show({template:"您已经是店主了,进店看看吧",duration:2500}),void $(function(){},2e3).then(function(){c.go("homePage")});n.init()}else n.init();"back"==t.direction?(void 0==n.selectValue&&(n.selectText="请选择"),n.addressName=n.textOne+" "+n.textTwo+" "+n.textThree):(n.clearInput(),n.applyInfo.storeName="",n.applyInfo.category="",n.applyInfo.promotionCode="",n.addressName="请选择",n.selectText="请选择"),n.addressInit(n.dataAdd,n.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("ShopApplyService",["$http","UrlService","$window",function(e,t,o){this.applySubmit=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,storeName:s,memberRealName:i,provinceId:a,cityId:n,regionId:r,streetId:c,regionName:l,address:d,memberType:p,memberName:u,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:$})},this.checkPerfectInformation=function(o,s,i,a,n,r,c,l,d,p){var u={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,streetId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:u})},this.checkText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),s)},this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.getPromotion=function(o){var s={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:s})},this.newShop=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,regionName:l,address:d,mobileNum:p,password:encodeURIComponent(u),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,s,i,a,n,r,c,l,d,p){var u={memberId:o,storeName:s,memberType:i,promotionCode:a,hrCode:n,provinceId:r,cityId:c,regionId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:u})}}]),APP.controller("newAuthenticationHomeV2",["GetStatisticInfoService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","OpenStoreService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w){a.localStorage=window.localStorage,a.promotionEditable=!0,a.addressName="请选择",a.goToAddress=!1,a.categoryData=[],a.selectText="请选择",a.selectKey="",a.isComplete=!1,a.isHasKey=!1,a.hrCodes=!1,a.promotionCode="",a.avatarImage="img/registerSuccess.png",a.userInfo={picTempFile:""};var y=window.innerHeight,T=y-373+"px";a.contentHeight={height:T},a.addressTitle="配送至",a.dataAdd=null,a.flag="SHOP_APPLY_ADDRESS",a.defaultValue=null,a.level=0;var C={};a.user={},a.mid=g.getUser().mid,a.init=function(){a.user=g.getUser(),void 0!=a.user.avatarImageFileId&&(a.avatarImage=a.user.avatarImageFileId),a.showAlert=!1,a.goToAddress?a.addressName=a.textOne+a.textTwo+a.textThree:"请选择"==a.addressName&&n.globalConstant.positionStatus&&a.getPosition(),a.textUnion&&(a.selectText=a.textUnion),a.applyInfo.category=a.selectText,a.selectText&&(a.infos=a.selectText.substring(0,4),"人人服务"==a.infos?a.hrCodes=!0:a.hrCodes=!1),a.selectValue=a.valueUnion,a.mid=g.getUser().mid,a.mid&&m.getStoreInfo(a.mid).success(function(e,t,o,s){e.success&&(a.storeCode=e.data.storeCode,a.storeType=e.data.storeType)})},a.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)},a.addressInit=function(e,t,o,s){if(a.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=e?JSON.parse(e):{},a.level=s,t){a.dataAdd=JSON.parse(t),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.arr=a.nowLevelIndex;for(var i=0;i<a.nowLevelIndex.length;i++)i>a.nowLevel&&(a.nowLevelIndex[i]=-1)}else a.finish=!1,a.dataAdd="",w.get("data/region.json").success(function(e){a.dataAdd=e.data,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel;for(var t=0;t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var b=!1;a.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=e;var t=arguments[1],e=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=t.text,a.defaultValue["value"+a.level]=t.value,a.level>-2)w.get("data/region.json").success(function(o){-1==a.level?(a.selectProvince=t.text,a.provinceIndex=e,a.dataAdd=o.data[e].children,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel,a.citySel=function(){a.dataAdd="",a.addressInit(s,i,a.flag,-1),a.dataAdd=o.data[e].children,a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}):a.dataAdd=a.dataAdd[e].children;var s=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(s,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")});else if(a.level>-4&&-3!=a.level)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,a.selectArea=t.text,a.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,o.getLocationList(t.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(o,s,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",a.level=a.levelArea,o.getLocationList(areaValue,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),S.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else if(-3==a.level)a.addressModal.hide(),a.regionTrue=!0,a.textOne=a.defaultValue["text-1"],a.textTwo=a.defaultValue["text-2"],a.textThree=a.defaultValue["text-3"],a.adrProvinceId=a.defaultValue["value-1"],a.adrCityId=a.defaultValue["value-2"],a.adrAreaId=a.defaultValue["value-3"],a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree,a.selectArea=t.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,o.getLocationList(t.value,ah).success(function(e){a.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(o,s,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1;else{if(b)return;v(function(){b=!1},1500),n.$broadcast(a.flag,a.defaultValue),b=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=n.globalConstant.autoPosition){C=d.getAddressInfo();var e=C.regionName+"/"+C.streetName;l.addAddress(C.provinceId,C.cityId,C.areaId,e,C.streetId).success(function(){var e={"text-1":C.provinceName,"text-2":C.cityName,"text-3":C.regionName,"value-1":C.provinceId,"value-2":C.cityId,"value-3":C.areaId};n.$broadcast(a.flag,e),a.addressModal.hide()})}},I.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},a.$on("$destroy",function(){a.addressModal.remove()}),n.$on("SHOP_APPLY_ADDRESS",function(e,t){a.goToAddress=!0,a.textOne=t["text-1"],a.textTwo=t["text-2"],a.textThree=t["text-3"],a.adrProvinceId=t["value-1"],a.adrCityId=t["value-2"],a.adrAreaId=t["value-3"],a.addressName=a.textOne+a.textTwo+a.textThree}),n.$on("SHOP_APPLY_UNION",function(e,t){a.textUnion=t.text,a.valueUnion=t.value}),a.checkChange=function(e,t){c.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&p.showToast("请不要使用违禁词！"),1==t?a.applyInfo.ownerName="":a.applyInfo.storeName="")})},a.goCommonUnion=function(){r.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};a.$watch("applyInfo",function(){a.selectValue&&a.applyInfo.category&&a.addressName&&null!=a.addressName&&0!=a.addressName.length&&"请选择"!=a.addressName&&(0!=a.promotionCode.length||0!=a.applyInfo.promotionCode.length)?a.isComplete=!0:a.isComplete=!1},!0);a.goAuthentication=function(){new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(a.showAlert=!1,0==a.addressName.length)p.showToast("请选择所在地区！");else if(a.selectValue)if(/^(HR|hr|Hr|hR).{6,18}$/.test(a.applyInfo.hrCode)||"10"!=a.selectValue)if(0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length)p.showToast("请填写推荐码!");else{a.promotionCode&&a.promotionCode.length>0?a.promotionCode:a.applyInfo.promotionCode;c.getPromotionUserInfo(a.promotionCode&&a.promotionCode.length>0?a.promotionCode:a.applyInfo.promotionCode).success(function(o){if(o.success){if(!o.data||null==o.data)return void p.showToast("推荐码不存在！");var s=p.dialog({onOpen:function(){this.find(".promotion-code").html(o.data.promotionCode),this.find(".parent-name").html(o.data.realName),this.find(".parent-mobile").html(o.data.mobile)},content:'<div style="background:#ffffff;width:304px;border-radius:8px;">                            <div style="padding:20px 10px;">                              <div>                                <h6 align="center" style="font-size:16px;line-height: 16px;color:#333333;">请确认您的推荐人信息</h6>                                <h2 align="center" class="promotion-code" style="font-size:22px;line-height:22px;"></h2>                              </div>                              <div style="padding:10px;margin:-10px auto;">                                <div style="margin: 0 auto;width: 0px;height: 0px;border-width: 10px;border-style: solid;border-color: #ffffff #ffffff #EEEEEE #ffffff;"></div>                                <div style="background:#EEEEEE;padding:20px;border-radius:4px;width:231px;margin:0px auto;">                                  <h5 style="color:#666666;font-size: 16px;line-height: 22px;">推荐人姓名：<span class="parent-name"></span></h5>                                  <h5 style="color:#666666;font-size: 16px;line-height: 22px;">推荐人电话：<span class="parent-mobile"></span></h5>                                </div>                                <h6 style="font-size:12px;line-height: 17px;color:#666666;">推荐人将成为您的服务导师，助您快速创业，请谨慎填写，一旦提交不支持修改!</h6>                              </div>                            </div>                            <div style="display:flex;flex-direction: row;justify-content:center;">                              <div class="cancel-btn" style="flex:1;text-align: center;background:#FFFFFF ;padding:10px;border-top:1px solid #EEEEEE;border-radius:0 0 0 8px;color:#2979FF;font-size:17px">取消</div>                              <div class="ok-btn" style="flex:1;text-align: center;background:#2979FF;padding:10px; border-radius:0 0 8px 0;color:#FFFFFF;font-size:17px">确定</div>                            </div>                          </div>',buttons:[{selector:".ok-btn",handler:function(){s.remove(),a.xyzPromotionCode=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;var o={memberType:a.selectValue,provinceId:a.adrProvinceId,cityId:a.adrCityId,regionId:a.adrAreaId,regionName:a.addressName,promotionCode:a.applyInfo.promotionCode,hrCode:a.applyInfo.hrCode,isPromotionCode:a.promotionCode};i.setObject("newAuthentication_obj",o);var n=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;a.memberId?c.applySubmitStore(a.memberId,a.applyInfo.storeName,a.selectValue,n,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(g.setUser(t.data.member),t.data.member.sessionValue?i.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):i.set("sg_login_token_secret","Bearer"+e.generateUUID())),v(function(){r.go("shopApplySuccess")},100)):p.showToast(t.message)}):(a.register_obj=i.getObject("register_obj"),c.newShop(a.applyInfo.storeName,a.selectValue,n,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address,a.register_obj.mobileNum,a.register_obj.password,a.register_obj.captcha,a.register_obj.imgCaptcha).success(function(o){o.success?(null!=o.data.member&&(g.setUser(o.data.member),o.data.member.sessionValue?i.set("sg_login_token_secret","Bearer"+o.data.member.sessionValue):i.set("sg_login_token_secret","Bearer"+e.generateUUID())),t.initWebSocket(),v(function(){r.go("shopApplySuccess")},100)):p.showToast(o.message)}))}},{selector:".cancel-btn",handler:function(){s.remove()}}]})}else o.message?p.showToast(o.message):p.showToast("获取推荐人信息失败！")})}else p.showToast("上岗证号必须为HR开头，总长度8-20位！");else p.showToast("请选择类别！")},a.getPromotionCode=function(){if(!(a.adrAreaId||"请选择"!=a.addressName||a.adrCityId||a.adrProvinceId))return void p.showToast("请选择地址");0!=a.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):0!=a.applyInfo.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):c.getPromotion(a.adrAreaId).success(function(e){e.success?null!=e.data&&(a.applyInfo.promotionCode=e.data):p.showToast(e.message)})},a.isFocus=function(){a.isHasKey=!0},a.isBlur=function(){a.isHasKey=!1},a.isClear=function(){a.applyInfo.address="",a.isHasKey=!1},a.clearInput=function(){a.applyInfo.ownerName=void 0,a.applyInfo.address=void 0,a.applyInfo.storeName=void 0,a.addressName="请选择",a.applyInfo.hrCode=void 0,a.selectText="请选择"},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(e,t){if(a.promotionEditable=f.promotionCode&&null!=f.promotionCode&&""!=f.promotionCode,a.memberId=g.getUser().mid,a.dataAdd=null,a.defaultValue=null,a.hrCodes=!1,a.promotionCode=f.promotionCode,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),g.isUserLogin()&&1==u.getRole())return h.show({template:"您已经是店主了,进店看看吧",duration:2500}),void v(function(){},2e3).then(function(){r.go("homePage")});a.init(),a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("OpenStoreService",["$http","UrlService","$window",function(e,t,o){this.getPromotionUserInfo=function(o){return e({method:"GET",url:t.getUrl("GET_PROMOTION_USER_INFO")+"?promotionCode="+o})},this.applySubmit=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,storeName:s,memberRealName:i,provinceId:a,cityId:n,regionId:r,streetId:c,regionName:l,address:d,memberType:p,memberName:u,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:$})},this.checkPerfectInformation=function(o,s,i,a,n,r,c,l,d,p){var u={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,streetId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:u})},this.checkText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),s)},this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.getPromotion=function(o){var s={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:s})},this.newShop=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,regionName:l,address:d,mobileNum:p,password:encodeURIComponent(u),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,s,i,a,n,r,c,l,d,p){var u={memberId:o,memberType:i,promotionCode:a,hrCode:n,provinceId:r,cityId:c,regionId:l,regionName:d};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:u})}}]),APP.controller("trueAuthenticationControl",["PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){p.isMake=!1,p.isMatching=!1,p.isPrompts=!1,p.isPopup=!1,p.isRetry=!1,p.isOther=!1,p.isTrueMsg=!1,p.isAgain=!1,p.userType=l.type,p.IDNumber="",p.userName="",p.storeCode=0,p.storeType=0,p.channal="APP",p.obj={isMyName:"",isMyIdNumber:""},p.init=function(){g.doInit().success(function(e){e.success?(p.isNotAuthentication=e.data.isAuth,null!=e.data.identity&&p.isNotAuthentication?(p.isOkAuthentication={color:"#999"},p.IDNumber=e.data.identity.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,s){for(var i="";i.length<o.length;)i+="*";return t+i+s}),p.userName=e.data.identity.realName.replace(/.{1}/,"*"),p.obj.isMyName=e.data.identity.realName,p.obj.isMyIdNumber=e.data.identity.identityNo,p.phoneNumber=e.data.identity.mobile):(p.isOkAuthentication={color:"#000"},p.isNotAuthentication=!1,p.phoneNumber=a.getUser().mobile,p.isPopup=!1,p.isMake=!1,p.isMatching=!1,p.isPrompts=!1)):(p.message=e.message,p.isRetry=!0)})},p.retry=function(){p.isRetry=!1},p.IwantETC=function(){p.isTrueMsg=!1},p.commonFunctions=function(){p.isPopup=!0,d(function(){p.isPopup=!1,u.go("homePage")},1e3)},p.clickOk=function(){t.checkOpenStore(p.memberId).success(function(e,t,i,a){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){f.get(s.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?p.isTrueMsg=!0:(p.isTrueMsg=!1,g.postUserMsg(p.obj.isMyName,p.obj.isMyIdNumber,p.phoneNumber,p.channal).success(function(e){e.data?(p.message=e.message,o.loginIsAuthentication=!1,p.isPopup=!0,p.isMatching=!1,p.isRetry=!1,p.isOther=!1,d(function(){p.isPopup=!1,u.go("homePage")},1e3)):(p.message=e.message,p.isRetry=!0,p.isMatching=!0,p.isPrompts=!1,p.isPopup=!1)}))}).error(function(t){e.showToast("网络连接失败！")})},p.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,t):u.go("helpDetail",{helpId:e,content:t})},p.isSubmit=function(){p.isTrueMsg=!1,g.postUserMsg(p.obj.isMyName,p.obj.isMyIdNumber,p.phoneNumber,p.channal).success(function(e){e.data?(p.message=e.message,p.isMatching=!1,p.isRetry=!1,p.isOther=!1,p.isPopup=!0,p.isPrompts=!1,o.loginIsAuthentication=!1,p.mentionCenterNum=o.canGetMount,d(function(){p.isPopup=!1,5==p.userType?u.go("bankCard"):2==p.userType?u.go("homePage"):8==p.userType?u.go("mentionCenter",{canAmount:p.mentionCenterNum}):u.go("personnalCenter")},600)):(p.message=e.message,p.isRetry=!0,p.isMatching=!0,p.isPrompts=!1,p.isPopup=!1)})},p.retry=function(){p.isRetry=!1};p.$watch("obj",function(){/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/.test(p.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(p.obj.isMyIdNumber)?g.getUsNameOrId(p.obj.isMyName,p.obj.isMyIdNumber).success(function(e){e.data?(p.message=e.message,p.isPrompts=!0,p.isMake=!0,p.isMatching=!1,p.isRetry=!1):(p.message=e.message,p.isMake=!1,p.isPrompts=!1,p.isMatching=!0,p.isRetry=!1)}):(p.isMake=!1,p.isPrompts=!1,p.isMatching=!1)},!0);p.goBack=function(){n.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"60px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"44px"}),p.$on("$ionicView.beforeEnter",function(){p.memberId=a.getUser().mid,p.isPopup=!1,p.isRetry=!1,p.isMake=!1,p.isMatching=!1,p.isPrompts=!1,p.newAuthentication_obj=r.getObject("newAuthentication_obj"),p.register_obj=r.getObject("register_obj"),p.promotionCodeRouter=p.newAuthentication_obj.isPromotionCode,p.promotionCodeRouter&&(p.phoneNumber=p.register_obj.mobileNum),p.memberId&&p.promotionCodeRouter&&(p.phoneNumber=p.register_obj.mobileNum),p.init(),p.obj.isMyName="",p.obj.isMyIdNumber=""})}]),APP.service("trueAuthenticationService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("TRUE_REALNAMEAUTH"))},this.getUsNameOrId=function(o,s){var i={realName:o,identityNo:s};return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:i})},this.postUserMsg=function(o,s,i,a){var n={realName:o,identityNo:s,mobile:i,channal:a};return e({method:"POST",url:t.getUrl("POST_USERDATAANDID"),params:n})},this.postUserInfoPC=function(o,s,i){var a={realName:o,identityNo:s,mobile:i};return e({method:"POST",url:t.getUrl("POST_USERDATA"),params:a})}}]),APP.controller("trueAuthenticationListControl",["trueAuthenticationService","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationListService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){u.isTrueAuthentication=!1,u.isStaff=!1,u.init=function(){e.doInit().success(function(e){e.success?(null!=e.data.identity?u.isTrueAuthentication=!0:u.isTrueAuthentication=!1,null!=e.data.empInfo?u.isStaff=!0:u.isStaff=!1):t.showToast(e.message)})},u.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?a.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,t):g.go("helpDetail",{helpId:e,content:t})},u.goBack=function(){r.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.$on("$ionicView.beforeEnter",function(){u.init()})}]),APP.service("trueAuthenticationListService",["$http","UrlService",function(e,t){}]),APP.controller("AboutUsController",["$scope","$rootScope",function(e,t){var o=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=o?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.softwareUpdate=function(){}}]),APP.controller("CollectionController",["$rootScope","$scope","CollectionService","$timeout","UserService","GoodsService","CommonAddressService","HomePageService",function($rootScope,$scope,CollectionService,$timeout,UserService,GoodsService,CommonAddressService,HomePageService){function getCollectionProduct(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,CollectionService.showCollection(provinceId,cityId,districtId,streetId).success(function(e,t,o,s){e.success&&($scope.items=e.data.productsList)})}else alert("获取收藏失败")}).error(function(e){var t=CommonAddressService.getAddressInfo();CollectionService.showCollection(t.provinceId,t.cityId,t.areaId,t.streetId).success(function(e,t,o,s){e.success&&($scope.items=e.data.productsList)})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}function getCollectionStoreList(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,$scope.streetId=streetId,CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,s){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})}else alert("获取收藏失败")}).error(function(e){CommonAddressService.getAddressInfo();CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,s){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})})}$scope.items=[],$scope.typeArr=["商品","店铺/场馆"],$scope.updateResult=!0,$scope.updateContent="",$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.init=function(){$scope.collectionType="product",$scope.storePage=1,$scope.storePageSize=5,$scope.hasMore=!1,$scope.items=[],getCollectionProduct()},$scope.loadMore=function(){$scope.storePage+=1,getCollectionStoreList()},$scope.checkType=function(e){0==e?($scope.collectionType="product",getCollectionProduct(),$(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px")):($scope.collectionType="store",$scope.items=[],getCollectionStoreList(),$(".collection_type>div:nth-child(2)").css("color","#2979FF"),$(".collection_type>div:nth-child(2) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(1)").css("color","#666666"),$(".collection_type>div:nth-child(1) div").css("borderBottom","0px"))},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction?$scope.direction="back":($scope.storeId=UserService.getUser().mid,$scope.direction="forword",$scope.init())}),$scope.$on("$ionicView.enter",function(){"back"==$scope.direction||($(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px"))}),$scope.delete=function(e){CollectionService.deleteCollection($scope.items[e].productId).success(function(e,t,o,s){e.success?($scope.showResult("删除成功"),$scope.init()):$scope.showResult("删除失败")})},$scope.showResult=function(e){$scope.updateContent=e,$scope.updateResult=!1,$timeout(function(){$scope.updateResult=!0},1e3)}}]),APP.service("CollectionService",["$http","UrlService",function(e,t){this.showCollection=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getUrl("COLLECTION_LIST"),n)},this.deleteCollection=function(o){var s={productId:o};return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),params:s})},this.getStoreCollection=function(o,s){var i={page:o,pageSize:s};return e.get(t.getUrl("STORE_COLLECTIONLIST"),i)}}]),APP.controller("FeedbackPlusController",["$scope","$state","FeedbackPlusService","PopupService","$ionicActionSheet","AssessService","UserService",function(e,t,o,s,i,a,n){function r(){e.feedbackType=6,e.canCommit=!1,e.feedback={content:"",phoneNumber:""},e.imageCount=0;for(var t=0;t<3;t++)e.imageList[t]="",d[t]=""}function c(t){e.$apply(function(){for(var o=0;o<3;o++)if(!e.imageList[o]){e.imageList[o]=t;break}e.imageCount++});var o=function(e){for(var t=JSON.parse(e.response),o=0;o<3;o++)if(!d[o]){d[o]=t.urls;break}},s=function(e){},i=new FileUploadOptions,r=new Date,c=r.getTime();i.fileKey="imageFile",i.fileName=n.getUser.userName+c,i.mimeType="image/jpeg",(new FileTransfer).upload(t,encodeURI(a.uploadImage()),o,s,i)}function l(e){}e.feedback={content:"",phoneNumber:""},e.feedbackType=6,e.imageCount=0,e.imageList=["","",""];var d=["","",""];e.canCommit=!1,e.checkLength=function(){setTimeout(function(){e.$apply(function(){e.feedback.content.length>=500&&(e.feedback.content=e.feedback.content.substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)},e.changeType=function(t){e.feedbackType=t},e.addImage=function(){window.cordova&&i.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),d.splice(t,1),e.imageCount--},e.phoneCheck=function(){},e.submitFeedback=function(){
if(e.feedback.phoneNumber&&!e.globalConstant.mobileNumberRegExp.test(e.feedback.phoneNumber))return void s.showToast("请输入正确的手机号码！");var i={site:"mstore",type:e.feedbackType,content:e.feedback.content,contact:e.feedback.phoneNumber,file:d[0]?d[0]:"",file1:d[1]?d[1]:"",file2:d[2]?d[2]:""};o.commitFeedback(i).success(function(e){e.success&&(s.showToast("提交成功！"),setTimeout(function(){t.go("Setup")},2017))})},e.$watch("feedback.content",function(t,o){setTimeout(function(){e.$apply(function(){t.length>=500&&(e.feedback.content=t.toString().substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)}),e.$on("$ionicView.beforeEnter",function(){r()})}]),APP.service("FeedbackPlusService",["$http","UrlService",function(e,t){this.commitFeedback=function(o){return e({method:"POST",url:t.getUrl("FEEDBACK_PLUS"),params:o})}}]),APP.controller("MineController",["$scope","$timeout","UserService","ShopService","PlatformService","MESSAGECENTERService","CreditService","$state",function(e,t,o,s,i,a,n,r){e.tabNav="mine",e.account="",e.flagNum=!1,e.goMemberCenter=function(){n.getGameId(function(e){r.go("vip",{gameId:e})})},e.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},e.init=function(){s.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1});for(var t=[],i=0;i<o.getUser().userName.length;i++)t[i]=i>=3&&i<=6?"*":o.getUser().userName[i];e.account="";for(var a=0;a<t.length;a++)e.account=e.account+t[a];e.account.length>20&&(e.account=e.account.slice(0,20)+"..."),e.accreditation="海尔官方认证"},e.$on("$ionicView.beforeEnter",function(){e.init(),a.unreadMessage()})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){}]),APP.controller("PersonalCenterController",["trueAuthenticationService","$localstorage","$rootScope","RegisterService","HomePageService","OrderManageService","$http","UrlService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","PersonalCenterService","$state","WhiteShowsService","PopupService","ProductDetailService","GoodsService",function(trueAuthenticationService,$localstorage,$rootScope,RegisterService,HomePageService,OrderManageService,$http,UrlService,InAppBrowserService,CreditService,ShopService,$scope,$timeout,UserService,PersonalCenterService,$state,WhiteShowsService,PopupService,ProductDetailService,GoodsService){$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.user=UserService.getUser(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],$scope.gotoSecondPage=function(e,t){$state.go("orderManage",{orderFlag:e,orderType:t})},$scope.goOrderManage=function(e,t){$state.go("orderManage",{orderFlag:e,orderStatus:t})},$scope.goMemberCenter=function(){CreditService.getGameId(function(e){$state.go("vip",{gameId:e})})},$scope.goGoldGame=function(){CreditService.getGameId(function(e){$state.go("goldgame",{gameId:e})})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isWhatApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isWhatApp="android":$scope.isWhatApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isWhatApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.goToMyStore=function(){1==$scope.isHost&&$state.go("myStore",{storeId:$scope.storeId})},$scope.goLearningHaier=function(){PersonalCenterService.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else $state.go("login")})},$scope.goToManageMoney=function(e){$state.go("financialMoney",{whereId:"personnalCenter"})},$scope.toApplyForWhite=function(){WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}))})},$scope.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&$timeout(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else $scope.kfTocken=$localstorage.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$scope.kfTocken);return},$scope.goNewHand=function(){var e=UrlService.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},$scope.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},t=function(e){function t(e){$scope.avatarImage=e,$timeout(function(){$scope.avatarImage=e},200);var t=function(e){$ionicLoading.hide(),PopupService.showToast("上传成功");var t=JSON.parse(e.response);$scope.avatarImage=t.data.avatarImageFileId,$scope.user.avatarImageFileId=$scope.avatarImage,UserService.setUser($scope.user)},o=function(e){$ionicLoading.hide(),PopupService.showToast("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=$scope.avatarImage.substr($scope.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var i={};s.params=i,(new FileTransfer).upload($scope.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,s);var a={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(a)}function o(e){}function s(e){$scope.avatarImage=e,$timeout(function(){$scope.avatarImage=e},200);var t=function(e){PopupService.showToast("上传成功"),$ionicLoading.hide();var t=JSON.parse(e.response);$scope.avatarImage=t.data.avatarImageFileId,$scope.user.avatarImageFileId=$scope.avatarImage,UserService.setUser($scope.user)},o=function(e){PopupService.showToast("上传失败"),$ionicLoading.hide()},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=$scope.avatarImage.substr($scope.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var i={};s.params=i,(new FileTransfer).upload($scope.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,s);var a={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(a)}function i(e){}1==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,t),$timeout(function(){window.plugins.actionsheet.hide()},5e3)}else $ionicPopup.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},$scope.checkPhoneNumber=function(){RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")})},$scope.init=function(){trueAuthenticationService.doInit().success(function(e){e.success&&(e.data.isAuthByOne?$scope.changeOpacity={opacity:"1"}:$scope.changeOpacity={opacity:"0.5"})}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,null==e.data.o2o||1==e.data.o2o?$scope.iso2o=!0:$scope.iso2o=!1}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),PersonalCenterService.personalInit().success(function(e){$scope.isHost=e.data.isHost,$scope.storeName=e.data.storeName,$scope.card=e.data.card,$scope.level=e.data.level,$scope.nowLevelName=$scope.levelArr[$scope.level-1],11!=$scope.level&&($scope.nextLevelName=$scope.levelArr[$scope.level]),$scope.revenue=e.data.revenue,$scope.coupon=e.data.coupon,$scope.gold=e.data.gold,$scope.card=e.data.card}),PersonalCenterService.diamondInit().success(function(e){$scope.babyCoupon=e.data.c,$scope.babyGold=e.data.g;var t=e.data.d;parseInt(t)>9999?$scope.babyDiamond="9999+":$scope.babyDiamond=t}),OrderManageService.getOrderAmount().success(function(e){e.success&&($scope.orderAmountData=e.data)}),CreditService.getGameId(function(e){var t=UrlService.getUrl("SHUNGUANG_VIP"),o={gameId:e,withLevelPath:!0};$http.get(t,o).success(function(e){if(e.success){$scope.order=e.data.userCreditWithLevel.order,$scope.levelGrowArr=e.data.levels;$scope.levelGrowArr[e.data.userCreditWithLevel.order]&&($scope.levelUpExp=$scope.levelGrowArr[e.data.userCreditWithLevel.order].creditNum-e.data.userCreditWithLevel.totalCreditNum,$scope.levelUpExp<0&&($scope.levelUpExp=0)),$scope.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,$scope.creditNum=e.data.userCreditWithLevel.totalCreditNum}})}),PersonalCenterService.personalApply().success(function(e){e.success&&(e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2),$scope.applyName=e.data.name,$scope.applyStatus=e.data.status)}),ShopService.getMessage().success(function(e){e.success&&(PersonalCenterService.userMemberId=e.data.memberId)})},$scope.$on("$ionicView.beforeEnter",function(){$scope.avatarImage=UserService.getUser().avatarImageFileId,$scope.storeId=UserService.getUser().mid,$scope.user=UserService.getUser(),$scope.tabNav="personnalCenter",$scope.init()})}]),APP.service("PersonalCenterService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.diamondInit=function(){return e.get(t.getNewUrl("GET_NEW_DIAMOND"))},this.personalApply=function(o){var s=t.getUrl("GET_APPLY_MENGZHU");return e.get(s,o)},this.userMemberId="",this.learningHaier=function(){return e.get(t.getNewUrl("GET_learningHaier"))}}]),APP.controller("SetupController",["$ionicPopup","AccountMessageService","$rootScope","$scope","PlatformService","LoginService","UserService","$state","$localstorage","IMService",function(e,t,o,s,i,a,n,r,c,l){s.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==i.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==i.getPlatform()?cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==i.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},s.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},s.switchOff={background:"#fff","border-color":"#e6e6e6"},s.borderBottom={"margin-bottom":"3px"},s.switchState=function(e){s.settingsList[e].checked=!s.settingsList[e].checked;for(var t=JSON.parse(localStorage.getItem("setSwitch")),i=t.length-1;i>=0;i--)s.memberId==t[i].id&&(t[i].list[e].checked=s.settingsList[e].checked,localStorage.setItem("setSwitch",JSON.stringify(t)));switch(e){case 0:o.isCommission=s.settingsList[e].checked;break;case 1:o.cashSwitch=s.settingsList[e].checked;break;case 2:o.goldRainSwitch=s.settingsList[e].checked}},s.init=function(){s.memberId=n.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==s.memberId&&(s.settingsList=e[t].list,!0)},s.goGuidePage=function(){r.go("guidePage")},s.user=n.getUser(),s.accountToken=s.user.token,s.accountSessionId=s.user.sessionValue,s.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",s.unload=function(){l.destroyWebSocket(),void 0==s.user.sessionValue?(n.clearUser(),s.goGuidePage(),a.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),c.set("storeId","")):t.unloadAccount(s.accountToken,s.accountSessionId,s.accountHeaderKey).success(function(e,t,o,i){if(e.success){n.clearUser(),a.setRole(void 0),s.goGuidePage();var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r),window.localStorage.setItem("isLogin",n.isUserLogin()),c.set("storeId","")}})},s.goToDelete=function(){e.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&s.unload()})},s.$on("$ionicView.enter",function(){s.init()})}]),APP.controller("ShoppingCarController",["$scope",function(e){}]),APP.controller("accsafeCtrl",["$scope","accsafeService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.accountMessage="",e.accountEmail="",e.accountNumber="",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=n.getUser(),e.accountMessage=e.user.userName,e.accountEmail=e.user.email,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,n.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){u.set("ROLE_INFO","undefined"),s.go("guidePage")},o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,n.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){s.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("accsafeService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("accsettingCtrl",["AccountMessageService","$scope","$location","accsettingService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){var o=e[0];if(window.FileReader){var s=new FileReader;s.readAsDataURL(o),s.onloadend=function(e){t.$apply(t.iconImage=e.target.result)}}}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.isPhone=!!window.cordova,t.userInfo={picTempFile:""},t.user={},t.sexMap=["保密","男","女"],t.accountMessage="",t.accountName="",t.accountSexValue="0",t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday="",t.iconImage=i.imgBaseURL+"img/ic_login_user.png",t.accountToken="",t.accountSessionId="",t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.updateResult=!0,t.updateContent="",t.init=function(){t.user=c.getUser(),t.sexMap=["保密","男","女"],void 0!=t.user.avatarImageFileId&&(t.iconImage=t.user.avatarImageFileId),t.accountMessage=t.user.userName,t.accountName=t.user.nickName,t.accountSexValue=t.user.gender,t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday=t.user.birthday,t.accountToken=t.user.token,t.accountSessionId=t.user.sessionValue,t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(t.accountNumber)||(t.showMobile=!1)},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goGuidePage=function(){"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(t.urlbase=o.absUrl(),window.location.href=t.urlbase.substring(0,t.urlbase.indexOf("?"))+"#/guidePage"):(m.set("ROLE_INFO","undefined"),a.go("guidePage"))},t.changeIcon=function(){if("APP"==d.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(o){function s(o){t.iconImage=o,r(function(){t.iconImage=o},200);var s=function(e){l.hide(),t.showResult("上传成功");var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,c.setUser(t.user)},i=function(e){l.hide(),t.showResult("上传失败")},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),s,i,a);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};l.show(d)}function i(e){}function a(o){t.iconImage=o,r(function(){t.iconImage=o},200);var s=function(e){t.showResult("上传成功"),l.hide();var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,c.setUser(t.user)},i=function(e){t.showResult("上传失败"),l.hide()},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),s,i,a);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};l.show(d)}function n(e){}1==o?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(a,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,s),r(function(){window.plugins.actionsheet.hide()},5e3)}else{u.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},t.$watch("userInfo.picTempFile",function(){t.userInfo&&t.userInfo.picTempFile&&t.userInfo.picTempFile.length>0&&f(t.userInfo.picTempFile)},!1),t.unload=function(){void 0==t.user.sessionValue?(c.clearUser(),t.goGuidePage(),g.setRole(void 0),window.localStorage.setItem("isLogin",c.isUserLogin()),m.set("storeId","")):e.unloadAccount(t.accountToken,t.accountSessionId,t.accountHeaderKey).success(function(e,o,s,i){if(e.success){c.clearUser(),t.goGuidePage(),g.setRole(void 0);var a="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",a),window.localStorage.setItem("isLogin",c.isUserLogin()),m.set("storeId","")}})},t.goToDelete=function(){u.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&t.unload()})},t.selectDate=function(){if("APP"==d.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){r(function(){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),e.changeMessage(t.accountMessage,a+"-"+i+"-"+s,t.accountSexValue,t.accountName).success(function(e,o,n,r){e.success?(t.accountBirthday=a+"-"+i+"-"+s,t.user.birthday=a+"-"+i+"-"+s,c.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i);var a=new Date(o).getFullYear()+"-"+s+"-"+i;e.changeMessage(t.accountMessage,a,t.accountSexValue,t.accountName).success(function(e,o,s,i){e.success?(t.accountBirthday=a,t.user.birthday=a,c.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})}};p.openDatePicker(s)}},i.$on("SELECT_SEX",function(e,o){t.accountSexValue=o,t.accountSex=t.sexMap[t.accountSexValue],t.user.gender=o,c.setUser(t.user),t.showResult("修改成功")}),i.$on("CHANGE_NAME",function(e,o){t.accountName=o,t.user.nickName=o,c.setUser(t.user),t.showResult("修改成功")}),t.goBack=function(){a.go("personnalCenter")},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,r(function(){t.updateResult=!0},1e3)}}]),APP.service("accsettingService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,s,i){var a=o,n="Bearer "+i+" "+a,r={Authorization:n},c={sessionId:s};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("CompetitionController",["$scope","$ionicHistory","MemberCompleteService","PopupService","CreditService","UrlService","$state","$stateParams","$http","InAppBrowserService","$ionicSlideBoxDelegate","$location","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(e,t,o,s){for(;;){var i,a=!1;i=s?(e+(t-e-e)*Math.random()).toFixed(2):Math.ceil(e+(t-e-e)*Math.random());for(var n=0;n<o.length;n++)if(i===o[n]){a=!0;break}if(a||o.push(i),o.length===S)break}}function m(e,t){for(var o,s,i=e.slice(0),a=e.length,n=a-t;a-- >n;)s=Math.floor((a+1)*Math.random()),o=i[s],i[s]=i[a],i[a]=o;return i.slice(n)}var f=r.taskDestId;e.taskType=r.taskType,e.xyzMemberId=r.memberId;var h=["赵","钱","孙","李","周","吴","郑","王","冯","陈","褚","卫","蒋","沈","韩","杨","朱","秦","尤","许","何","吕","施","张","孔","曹","严","华","金","魏","陶","姜","戚","谢","邹","喻","柏","水","窦","章","苏","潘","葛","奚","范","彭","郎","鲁","韦","昌","马","苗","凤","花","方","俞","任","袁","柳","酆","鲍","史","唐","费","廉","岑","薛","雷","贺","倪","汤","滕","殷","罗","毕","郝","邬","安","常","乐","于","时","傅","皮","卞","齐","康","伍","余","元","卜","顾","孟","平","黄","和","穆","萧","尹","姚","邵","湛","汪","祁","毛","禹","狄","米","贝","明","臧","计","伏","成","戴","谈","宋","茅","庞","熊","纪","舒","屈","项","祝","董","梁","杜","阮","蓝","闵","席","季","麻","强","贾","路","娄","危","江","童","颜","郭","梅","盛","林","刁","钟","徐","邱","骆","高","夏","蔡","田","樊","胡","凌","霍","虞","万","支","柯","昝","管","卢","莫","经","房","裘","缪","干","解","应","宗","丁","宣","贲","邓","郁","单","杭","洪","包","诸","左","石","崔","吉","钮","龚","程","嵇","邢","滑","裴","陆","荣","翁","荀","羊","於","惠","甄","麴","家","封","芮","羿","储","靳","汲","邴","糜","松","井","段","富","巫","乌","焦","巴","弓","牧","隗","山","谷","车","侯","宓","蓬","全","郗","班","仰","秋","仲","伊","宫","宁","仇","栾","暴","甘","钭","厉","戎","祖","武","符","刘","景","詹","束","龙","叶","幸","司","韶","郜","黎","蓟","薄","印","宿","白","怀","蒲","邰","从","鄂","索","咸","籍","赖","卓","蔺","屠","蒙","池","乔","阴","郁","胥","能","苍","双","闻","莘","党","翟","谭","贡","劳","逄","姬","申","扶","堵","冉","宰","郦","雍","舄","璩","桑","桂","濮","牛","寿","通","边","扈","燕","冀","郏","浦","尚","农","温","别","庄","晏","柴","瞿","阎","充","慕","连","茹","习","宦","艾","鱼","容","向","古","易","慎","戈","廖","庾","终","暨","居","衡","步","都","耿","满","弘","匡","国","文","寇","广","禄","阙","东","殴","殳","沃","利","蔚","越","夔","隆","师","巩","厍","聂","晁","勾","敖","融","冷","訾","辛","阚","那","简","饶","空","曾","毋","沙","乜","养","鞠","须","丰","巢","关","蒯","相","查","後","荆","红","游","竺","权","逯","盖","益","桓","公","万",,"俟","司马","上官","欧阳","夏侯","诸葛","闻人","东方","赫连","皇甫","尉迟","公羊","澹台","公冶","宗政","濮阳","淳于","单于","太叔","申屠","公孙","仲孙","轩辕","令狐","钟离","宇文","长孙","慕容","鲜于","闾丘","司徒","司空","亓官","司寇","仉","督","子车","颛孙","端木","巫马","公西","漆雕","乐正","壤驷","公良","拓跋","夹谷","宰父","谷梁","晋","楚","闫","法","汝","鄢","涂","钦","段干","百里","东郭","南门","呼延","归","海","羊舌","微生","岳","帅","缑","亢","况","后","有","琴","梁丘","左丘","东门","西门","商","牟","佘","佴","伯","赏","南宫","墨","哈","谯","笪","年","爱","阳","佟","第五","言","福"],v=["奕柯","消沉","天乐","维妙","峻","哲","晓培","益申","莹莹","占宇","雨","凌昕","婉婷","建雄","小文","小冉","子安","老杰","胖胖","文","剑","霖","锰","克谦","小仙","帅帅","逸","旭梅","萍","元雪","晓莉","明燕","九庆","留强","汝彬","台铭","帆","昆仑","万里","中锋","志伟","明汉","琴","珍美","明君","涛","文武","艳艳","小刚","霞","浩","志豪","军林","叶东","远青","伟军","明浩","佑军","盛露","少青","发祥","钟森","永发","运瑞","自珍","家宝","建联","迪","慧","盛锦","素素","生平","海峰","喧喧","文宏","景翔","子博","炳良","保胜","希玮","莱","宇佳","博飞","文诺","宸萧","萍","利","墨语","宇凡","方丰","景宝","乐新","康帅","睿继","温雁","呈远","运","恩","叶","涵琰","文文","杰宪","迪勋","颜悦","杭","彬","信","帅鸿","庭达","然","睿进","锦远","康飞","茂轩"];e.indexNum=0;var S=10;e.moneyRandoms=[],g(50,3e3,e.moneyRandoms,!0);e.timeRandoms=[],g(1,60,e.timeRandoms,!1);e.userImg=[],g(0,198,e.userImg,!1),e.userList=[],e.firstName=m(h,S),e.lastName=m(v,S),e.allName=[],function(t,o){for(var s=0;s<S;s++)e.allName.push(t[s]+""+o[s]);e.allName}(e.firstName,e.lastName);for(var I=0;I<S;I++)e.userList.push({src:u.imgBaseURL+"img/userImg/"+e.userImg[I]+".jpg",money:e.moneyRandoms[I],allName:e.allName[I],time:e.timeRandoms[I]});e.goBack=function(){t.goBack()},e.share=function(){window.cordova?e.showShare=!0:s.showAlert("只能在app分享","抱歉，只能在app分享")},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?l.open(a.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):n.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"22px",height:"66px"}:e.paddingtopClass={"padding-top":"6px",height:"50px"},e.copeText=function(t){window.cordova?(cordova.plugins.clipboard.copy(t),s.showToastShort("复制成功"),e.isShowCopyButton=!1):s.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var s=e.competition.storeName+"的综合竞争力指数",n="综合竞争力指数全球排名"+e.competition.userRank+"位颤抖吧人类",r=e.competition.avatarImageFileId,c=a.getShareLinkHeader()+"competition//"+e.taskType+"/"+e.xyzMemberId;window.umeng?0==t?window.umeng.shareToSina(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"微博").success(function(){}),i.shareSuccessCallback("微博")}):1==t?window.umeng.shareToWechatSession(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"微信").success(function(){}),i.shareSuccessCallback("微信")}):2==t?window.umeng.shareToWechatTimeline(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("朋友圈")}):3==t?window.umeng.shareToQQ(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("QQ")}):4==t?window.umeng.shareToQzone(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("QQ空间")}):5==t&&e.copeText(c):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){f=r.taskDestId,e.taskType=r.taskType,e.competition="",e.showShare=!1,e.xyzMemberId=r.memberId,e.gameId=r.gameId,e.storeId="";var t=(new Date).getTime();o.myComplete(e.xyzMemberId).success(function(o){e.competition=o.data,void 0==e.competition.myInCome&&(t=(new Date).getTime(),$.ajax({url:a.getUrl("BROKERAGE_SETTLEMENT"),data:{memberId:e.xyzMemberId},type:"post",dataType:"json",success:function(t){t.success&&t.data&&(e.competition.myInCome=t.data.totalBrokerageAmount,e.$apply())},error:function(){}})),e.storeId=o.data.memberId,e.userCurrentLevelId=o.data.order;for(var s=[[248,46,91],[172,123,171],[88,234,231],[217,226,109],[253,181,70],[248,115,60]],i=[["店铺单数",e.competition.ordersCount/1],["招募结识了",e.competition.partner/2],["进行评价",e.competition.accessCount/1],["分享",e.competition.sharesCount/50],["登录",e.competition.loginsCount/50],["社区互动",e.competition.comunityCount/30]],n=1,r=0;r<i.length;r++)i[r][1]>n&&(n=i[r][1]);var c=i.length,l=document.getElementById("radarMap"),d=document.getElementById("radarMapCanvas");null==d&&(d=document.createElement("canvas"),d.id="radarMapCanvas",l.appendChild(d));var p=.49*$(document).width(),u=402*p/370;d.style="position:relative;position: absolute;z-index: -1",d.width=p,d.height=u;var g=d.getContext("2d"),m=p,f=u,h=m/2,v=f/2,S=h-3,I=2*Math.PI/c;!function(e){e.save();for(var t=S/3,o=0;o<3;o++){e.beginPath();for(var i=t*(o+1),a=[],n=0;n<c;n++){var r=h+i*Math.cos(I*n-I/2),l=v+i*Math.sin(I*n-I/2);a.push([r,l])}for(var n=0;n<a.length;n++){e.beginPath(),e.moveTo(a[n][0],a[n][1]),e.lineTo(a[(n+1)%a.length][0],a[(n+1)%a.length][1]),e.closePath();var d=e.createLinearGradient(a[n][0],a[n][1],a[(n+1)%a.length][0],a[(n+1)%a.length][1]);d.addColorStop("0.2","rgba("+s[n].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+s[(n+1)%a.length].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.beginPath(),e.moveTo(a[a.length-1][0],a[a.length-1][1]),e.lineTo(a[0][0],a[0][1]),e.closePath();var d=e.createLinearGradient(a[a.length-1][0],a[a.length-1][1],a[0][0],a[0][1]);d.addColorStop("0.2","rgba("+s[a.length-1].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+s[0].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2),i=v+S*Math.sin(I*t-I/2);e.beginPath(),e.moveTo(h,v),e.lineTo(o,i);var a=e.createLinearGradient(o,i,h,v);a.addColorStop("0","rgba("+s[t].join(",")+",1)"),a.addColorStop("0.8","rgba("+s[t].join(",")+",0.2)"),e.strokeStyle=a,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save(),e.beginPath();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2)*i[t][1]*(100/n)/100,s=v+S*Math.sin(I*t-I/2)*i[t][1]*(100/n)/100;e.lineTo(o,s)}e.closePath(),e.lineWidth=.5,e.strokeStyle="rgba(167,241,224,1)",e.stroke(),e.fillStyle="rgba(255, 0, 0, 0.2)",e.fill(),e.restore()}(g)}).error(function(e){}),o.storeDetail(e.gameId).success(function(t){1==t.success&&(e.storeCreditWithLevel=t.data.storeCreditWithLevel,e.storeCreditWithLevel&&(e.storeCurrentLevelId=t.data.storeCreditWithLevel.order,e.starName=t.data.storeCreditWithLevel.name,e.levelArray=[],e.storeCurrentLevelId<=3?e.levelArray=[u.imgBaseURL+"img/StarLevel@2x.png"]:e.levelArray=[u.imgBaseURL+"img/Diamond@2x.png"]))}),d.update(),d.loop(!0),d.enableSlide(!1)}),e.foots=[{src:u.imgBaseURL+"img/touxiang@2x.png",name:"aaa",money:"1",time:10},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"bbb",money:"2",time:20},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"ccc",money:"3",time:30},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"ddd",money:"4",time:40},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"eee",money:"5",time:50}]}]),APP.service("MemberCompleteService",["$http","UrlService",function(e,t){this.myComplete=function(o){var s={
ownerId:o};return e.get(t.getUrl("MEMER_COMPETE"),s)},this.missionShare=function(o,s,i){var a={taskType:o,taskDestId:s,sharePlatform:i};return e.get(t.getUrl("MISSION_SHARE"),a)},this.storeDetail=function(o){var s=t.getUrl("SHUNGUANG_VIP");return e.get(s,o)}}]),APP.controller("CustomMadeController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,s,i,a,n){e.customMadeUrl=o.trustAsResourceUrl(t.customMadeUrl),e.close=function(){n.go("shop")}}]),APP.controller("goldRecordController",["$rootScope","$localstorage","$scope","$stateParams","$state","$ionicPopup","$timeout","$http","UrlService",function(e,t,o,s,i,a,n,r,c){function l(e){r.get(c.getUrl("CREDIT_DETAIL"),e).success(function(t){p=1,0==e.searchType?(o.name1=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore1=!1):o.hasmore1=!0):1==e.searchType?(o.name2=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore2=!1:o.hasmore2=!0):2==e.searchType&&(o.name3=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore3=!1:o.hasmore3=!0)}).error(function(e){})}o.hasmore1=!1,o.hasmore2=!1,o.hasmore3=!1,o.name1="",o.name2="",o.name3="",o.flag=!1,o.a=!1,o.b=!0;var d=0,p=1,u=1,g=1,m=1,f="",h={searchType:d,startIndex:p,pageSize:9};o.storeId=t.get("storeId",e.globalConstant.storeId),l(h),o.loadMore1=function(){var e=o.name1;u+=1;var t={searchType:d,startIndex:u,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){0==t.searchType&&(o.name1=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore1=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){o.$broadcast("scroll.infiniteScrollComplete")})},o.loadMore2=function(){var e=o.name2;g+=1;var t={searchType:d,startIndex:g,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){1==t.searchType&&(o.name2=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore2=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.loadMore3=function(){var e=o.name3;m+=1;var t={searchType:d,startIndex:m,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){2==t.searchType&&(o.name3=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore3=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.goBack=function(){o.$ionicGoBack()},o.show=function(){o.flag=!o.flag},o.showfalse=function(){o.flag=!1},o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={},o.$on("$ionicView.beforeEnter",function(){o.flag=!1}),o.showFlag1=function(){d=0,u=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={}},o.showFlag2=function(){d=1,g=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag2=!0,o.flag1=!1,o.flag3=!1,o.myObj2={background:"#2196F3",color:"#fff"},o.myObj1={},o.myObj3={}},o.showFlag3=function(){d=2,m=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag3=!0,o.flag1=!1,o.flag2=!1,o.myObj3={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj1={}}}]),APP.controller("myAppointmentController",["$ionicScrollDelegate","$interval","myAppointmentService","CalculateStrLength","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","HomePageService",function(e,t,o,s,t,i,a,n,r,c,l,d,p,u){function g(e,o){var s=o,i=t(function(){if(s)var o=a.data[e].purchaseEndTime-(new Date).getTime();else var o=a.data[e].purchaseStartTime-(new Date).getTime();if(o<0)if(s){a.data[e].hasOver=!0;for(var n=0,r=0;n<a.data.length&&a.data[n].hasOver;n++)r++;r==a.data.length&&(a.noData=!0),t.cancel(i)}else s=!0,a.data[e].hasBegan=!0,a.data[e].days=0,a.data[e].hours=0,a.data[e].minutes=0,a.data[e].seconds=0;else a.data[e].days=parseInt(o/864e5),a.data[e].hours=parseInt(o%864e5/36e5),a.data[e].minutes=parseInt(o%36e5/6e4),a.data[e].seconds=Math.floor(o%6e4/1e3)},1e3);a.intervalArr.push(i)}function m(e){for(var t=(new Date).getTime(),o=e.length,s=0;s<o;s++)e[s].hasOver=!1,e[s].purchaseStartTime>t?(e[s].hasBegan=!1,g(s,!1)):e[s].purchaseStartTime<(new Date).getTime()&&t<e[s].purchaseEndTime&&(e[s].hasBegan=!0,g(s,!0))}a.pageIndex=1,a.hasMore=!1,a.data=[],a.storeId=c.getUser().mid,a.flagNum=!1,a.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",a.goProductDetail=function(e){r.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:a.storeId})},a.init=function(){a.noData=!1,a.data=[],o.getMyAppointment(a.pageIndex).success(function(e){5==e.data.length?(a.hasMore=!0,a.data=a.data.concat(e.data),m(a.data)):e.data.length<5&&0!=e.data.length?(a.hasMore=!1,a.data=a.data.concat(e.data),m(a.data)):e.data&&0!=e.data.length||(a.noData=!0)}),u.getUnReadMsg().success(function(e){e.data>0?a.flagNum=!0:a.flagNum=!1})},a.loadMore=function(){a.pageIndex++,o.getMyAppointment(a.pageIndex).success(function(e){5==e.data.length?(a.hasMore=!0,m(e.data),a.data=a.data.concat(e.data)):e.data.length<5&&0!=e.data.length?(a.hasMore=!1,m(e.data),a.data=a.data.concat(e.data)):a.hasMore=!1})},a.$on("$ionicView.beforeLeave",function(e,o){for(var s=0,i=a.intervalArr.length;s<i;s++)t.cancel(a.intervalArr[s])}),a.$on("$ionicView.beforeEnter",function(t,o){e.scrollTop(),a.pageIndex=1,a.intervalArr=[],a.init()})}]),APP.service("myAppointmentService",["$http","UrlService",function(e,t){this.getMyAppointment=function(o){var s={pageIndex:o};return e.get(t.getNewUrl("MYAPPOINTMENT"),s)}}]),APP.controller("NewClassController",["$scope","$rootScope","$http","UrlService","PersonalCenterService",function(e,t,o,s,i){var a=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=a?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.goNewHand=function(){var e=s.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},e.goLearningHaier=function(){i.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else $state.go("login")})},e.softwareUpdate=function(){}}]),APP.controller("VipController",["CommonAddressService","ProductDetailService","$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","$http","CreditService","InAppBrowserService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S){function I(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}function w(){d.getapplyDuozhu().success(function(e){if(e.success){o.memberId=e.data.memberId,o.teamLevelId=e.data.teamLevelId,o.applyName=e.data.name,o.teamName=e.data.name,o.applyTeamName=e.data.name,o.applyStatus=e.data.status,e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2);var t={"舵主":"duozhu@2x.png","盟主":"mengzhu@2x.png"},i=t[o.teamName],a={"-3":{text:"未通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("未通过","您本月不能申请！")}},"-2":{text:"申请",icon:s.imgBaseURL+"img/apply"+i,handler:function(){function e(e){var t=/[\ud800-\udbff][\udc00-\udfff]/g;return e=e.replace(t,"")}var t=o.applyDialog();o.fnClosePopup=function(){t.close()},o.mailIsError=!1,o.reasonIsError=!1,o.checkEmail=function(e){var t=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,s=t.test(e);o.mailIsError=!s},o.checkReason=function(t){t=e(t),o.reasonIsError=!t,o.reasonIsError&&(o.data.input2="")},o.fnExchangeGoods=function(){if(o.checkEmail(o.data.input1),!o.mailIsError){if(o.checkReason(o.data.input2),o.reasonIsError)return void(o.data.input2="");d.applyDuozhu({email:o.data.input1,applyReason:o.data.input2,teamLevelId:o.teamLevelId}).success(function(e,o,s,i){1==e.success?e.data&&p.showAlert("盟主舵主权益","申请成功"):p.showAlert("盟主舵主权益",e.message),t.close(),w()})}},o.lookLeaderRights=function(){p.showAlert("盟主舵主权益",o.LeaderRights)}}},"-1":{text:"未通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("未通过","您本月的申请被拒绝，下月继续努力！")}},0:{text:"已申请",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("已申请","您本月的申请已经提交，请等待工作人员审批！")}},1:{text:"已通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("已通过","您已经是"+e.data.name+"了！")}},2:{text:"不可申请",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("盟主舵主权益",o.LeaderRights)}},3:{text:"盟主",icon:s.imgBaseURL+"img/meng@2x.png",handler:function(){p.showAlert("已通过","您已经是"+e.data.name+"了！")}}};o.applyText=a[""+e.data.status].text,o.applyIcon=a[""+e.data.status].icon,o.handler=a[""+e.data.status].handler}})}o.isShowMore=!1,o.isShowRule=!1,o.closeAll=function(){o.isShowMore=!1,o.isShowRule=!1},o.showMore=function(){o.isShowMore=!o.isShowMore},o.showRule=function(){o.isShowRule=!o.isShowRule},o.closeRule=function(){o.isShowRule=!1},o.applyDialog=function(){return l.show({cssclass:"leader-popup",template:"\n        <div class='apply-list popup-form'>\n          <div class = 'form-title' ng-show='teamName==\"盟主\"'>恭喜您获得申请盟主的资格！</div>\n          <div class = 'form-title' ng-show='teamName==\"舵主\"'>恭喜您获得申请舵主的资格！</div>\n          <div class='form-content'>\n           <div class='sub-title'>请填写申请理由，我们会尽快跟你联系</div>\n           <p class='input-name'>联系邮箱<span class='error' ng-show='mailIsError'>请填写正确邮箱</span></p>\n           <div class='input-area'><input type='text' placeholder='填写你的邮箱(必填)' ng-model='data.input1' ng-blur='checkEmail(data.input1)'></div>\n          </div>\n          <div class='form-content'>\n          <p class='input-name'>申请理由<span class='error' ng-show='reasonIsError'>请填写申请理由</span></p>\n           <div class='input-area'><textarea rows='3' ng-blur=\"checkReason(data.input2)\" cols='20' placeholder='填写你的申请理由(必填，不支持特殊字符、表情)' ng-model='data.input2'></textarea></div>\n          </div>\n          <div class='form-info'>\n            <span  ng-click='lookLeaderRights()'>点击查看更多舵主盟主权益</span>\n          </div>\n          <div class='form-button'>\n           <span class='left-btn' ng-click='fnClosePopup()' >再想想</span>\n           <span class='right-btn' ng-click='fnExchangeGoods()' >提交申请</span>\n          </div>\n        </div>\n      ",scope:o})},o.levelUp=function(e){l.alert({template:'<div style="font-size: 17px;color: #030303;letter-spacing: -0.41px;line-height: 26px;">'+e+"</div>",okText:"我知道啦"})},o.modal=void 0,o.gameId=i.gameId,o.levelMsg=i.msg,o.gameTitle,o.gameDesc,o.isShowForm=!1,o.startTime="",o.endTime="",o.hasBkgColor=!0;var y="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";o.isAdmin=i.isAdmin,o.shareStoreId;var T=.2*window.innerWidth;o.gridHeight={height:T+"px"},o.gridHeightMiddle={height:2*T+8+"px"};var C=window.innerHeight,b=C-373+"px";o.contentHeight={height:b},o.addressTitle="配送至",o.dataAdd=null,o.flag="CHANGEADDRESS_LOCATION_GAME",o.defaultValue=null,o.level=0;var A={};o.addressInfo={},o.game={},o.prizeList=[],o.startP=0,o.endP=11,o.curP=void 0,o.timer=void 0,o.isRuning=!1;var P=330;o.showShare=!1,o.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.topBtnCss4IOS={top:"12px"}),o.$on("$ionicView.beforeEnter",function(){o.isShowMore=!1,o.isShowRule=!1,o.xyzMemberId=m.getUser().mid,o.shareStoreId=i.shareStoreId,o.isAdmin=i.isAdmin,o.memberId=m.getUser().mid,S.$getByHandle("gradeScroll").scrollBy(0,0),o.dataAdd=null,o.defaultValue=null,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.watch=o.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),o.$on("$destroy",function(){o.addressModal.remove()}),o.init()}),o.init=function(){w(),o.prizeList=new Array(12),o.applyName="盟主",h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),i={gameId:e,withLevelPath:!0};-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},f.get(t,i).success(function(e){if(o.levelMsg&&o.levelUp(o.levelMsg),e.success){o.name=e.data.userCreditWithLevel.name,o.avatarImageFileId=m.getUser().avatarImageFileId?m.getUser().avatarImageFileId:e.data.avatarImageFileId,o.userCurrentLevelId=e.data.userCreditWithLevel.order,o.order=e.data.userCreditWithLevel.order,o.levelGrowArr=e.data.levels,o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,o.creditNum=e.data.userCreditWithLevel.totalCreditNum,o.userRank=e.data.userCreditWithLevel.userRank,o.congratulationMsg="有"+o.userRank+"个小伙伴超过了你",0==o.userRank&&(o.congratulationMsg="恭喜你，你已经是天下第一了，继续保持哦！"),o.storeCreditWithLevel=e.data.storeCreditWithLevel,o.storeCreditWithLevel&&(o.storeCurrentLevelId=e.data.storeCreditWithLevel.order,o.storeName=e.data.storeCreditWithLevel.name,o.levelArray=[],o.storeCurrentLevelId<=3?o.levelArray=[s.imgBaseURL+"img/StarLevel@2x.png"]:o.levelArray=[s.imgBaseURL+"img/Diamond@2x.png"]),$("canvas:not('#radarMapCanvas')").remove(),$(".cur"+o.order).radialIndicator({barColor:"#8FB8FF",barWidth:2,initValue:0,roundCorner:!0,percentage:!1,displayNumber:!1});$(".cur"+o.order).data("radialIndicator").animate(100),o.scrollMainToTop()}})}),d.storeDetailInfo({memberId:o.memberId}).success(function(e){1==e.success&&(o.storeVipName=e.data.storeName,o.teamLevelName=e.data.teamLevelName,o.storeId=e.data.memberId)}),o.showQQ=!1,o.showWeChat=!1,window.umeng&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.startP=0,o.curP=void 0,d.gameInfo({gameId:o.gameId}).success(function(e){e.success?(o.prizeList=e.data.gameImg,o.partNum=e.data.partNum,o.game=e.data.game,o.chouCount=e.data.playTimes,o.startTime=I(1e3*o.game.beginTime),o.endTime=I(1e3*o.game.endTime),g.fromTemplateUrl("templates/common/CommonGame.html",{scope:o,animation:"slide-in-left"}).then(function(e){o.modal=e}),o.game.backgroundPic||(o.hasBkgColor=!1)):alert(e.message)}).error(function(){p.showMsg("网络错误")}),d.notapplyDuozhu().success(function(e){1==e.success&&(o.LeaderRights=e.data.description)})},o.scrollMainToTop=function(){o.order<8||8==o.order?S.$getByHandle("gradeScroll").scrollTo(133*(o.order-1),0):S.$getByHandle("gradeScroll").scrollTo(931,0)};var x,L,D,N,_=0,O=Math.floor(3*Math.random())+2;o.clickChou=function(){if(!o.isRuning){d.luckDraw({gameId:o.gameId,timeStamp:(new Date).getTime()}).success(function(e){if(e.success&&-1!=e.result.prizeType)o.chouResult=e.result,o.endP=e.result.postion-1,o.start(),h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),s={gameId:e};f.get(t,s).success(function(e){e.success&&(o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum)})}),o.chouCount++;else if(e.success&&-1==e.result.prizeType)l.alert({template:e.result.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("抽奖次数")>-1)l.alert({template:e.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("GAME")>-1)l.alert({template:"对不起，奖品已被抽光"}),o.curP=void 0;else if(e.message&&e.message.indexOf("未登录")>-1)o.curP=void 0,a.go("login");else{if(o.curP=void 0,"-100"==e.errorCode)return;l.alert({template:e.message})}}).error(function(e){p.showToast("网络错误")}),o.curP=0;var e=12*O+o.endP;x=5,L=4==O?15:10,D=4==O?e-15:e-10,N=4==O?e-10:e-5}},o.starsList=[{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"}],o.starsListLimit=6,o.showPopup=function(){o.data={input1:"",input2:""},o.handler&&o.handler.call()},o.start=function(){o.endP<0||o.endP>11||(o.isRuning=!0,o.timer=n(function(){if(_++,_>=x?P=100:_>=L?P=60:_>=D?P=100:_>=N&&(P=500),_>12*O&&o.curP===o.endP)return _=0,o.isRuning=!1,void o.showForm();o.curP<12?o.curP++:o.curP=0,o.start()},P))},o.openPic=function(){o.modal.show()},o.closePic=function(){o.modal.hide()},o.share=function(){if(window.device&&window.device.hasNewShare){if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void p.showToast("请先登录,再分享");if(o.isShowForm)return;o.showShare=!o.showShare}else{if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void p.showToast("请先登录,再分享");if(o.isShowForm)return;if(window.umeng){var e=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}},o.goBack=function(){-1!=window.location.href.indexOf("sg_rn_app")&&0==u.viewHistory().histories.root.cursor&&window.postMessage("goback"),o.isAdmin&&1==o.isAdmin||o.isShowForm||("advertisement"==s.fromState?a.go("homePage"):o.$ionicGoBack())},o.showForm=function(){o.isShowForm=!0},o.hideForm=function(){o.isShowForm=!1},o.confirmGameInfo=function(){if(!o.chouResult.consignee)return void l.alert({title:"提示",template:"收件人必须填写！"});if(!o.globalConstant.mobileNumberRegExp.test(o.chouResult.mobile))return void l.alert({title:"提示",template:"请输入正确的手机号！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.address)return void l.alert({title:"提示",template:"地址必须填写！"});var e={gameId:o.chouResult.gameId,uuid:o.chouResult.uuid,prizeId:o.chouResult.gamePrizeId,consignee:o.chouResult.consignee,mobile:o.chouResult.mobile,address:o.chouResult.address,regionName:o.chouResult.regionName,isDefault:0,provinceId:o.chouResult.provinceId,cityId:o.chouResult.cityId,regionId:o.chouResult.regionId,streetId:o.chouResult.streetId};d.confirmGameInfo(e).success(function(e){e.success?(p.showToast("提交成功"),o.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},o.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},o.addressInit=function(e,s,i,a){if(o.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=a,s){o.dataAdd=JSON.parse(s),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",t.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1};var k=!1;o.goSelect=ionic.Utils.debounce(function(e,i){for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var i=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=i.text,o.defaultValue["value"+o.level]=i.value,o.level>-2){-1==o.level&&(o.selectProvince=i.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel);var r=-1*o.level;o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(i.value,r).success(function(e){if(1==r){i.value}o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){p.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){p.showToast("获取地址信息失败！")})}}else if(o.level>-4)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,-3==o.level?(o.selectArea=i.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top):o.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,r=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(i.value,r).success(function(e){if(o.dataAdd=e.data,o.addressTipFlag=!1,2==r){i.value}var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){p.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),S.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else{if(k)return;n(function(){k=!1},1500),s.$broadcast(o.flag,o.defaultValue),k=!0,o.closeAddressModal()}},300),s.$on("CHANGEADDRESS_LOCATION_GAME",function(e,t){o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.chouResult.provinceId=t["value-1"],o.chouResult.cityId=t["value-2"],o.chouResult.regionId=t["value-3"],o.chouResult.streetId=t["value-4"],o.chouResult.regionName=o.textOne+o.textTwo+o.textThree+o.textFour}),o.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){A=e.getAddressInfo();var i=A.regionName+"/"+A.streetName;t.addAddress(A.provinceId,A.cityId,A.areaId,i,A.streetId).success(function(){var e={"text-1":A.provinceName,"text-2":A.cityName,"text-3":A.regionName,"text-4":A.streetName,"value-1":A.provinceId,"value-2":A.cityId,"value-3":A.areaId,"value-4":A.streetId};s.$broadcast(o.flag,e),o.addressModal.hide()})}},g.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),o.closeAddressModal=function(){o.addressModal.hide()},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="给您推荐顺逛每日抽奖活动,不可错过哦!",s=y,i=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng?(0==e?window.umeng.shareToSina("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback),h.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback),h.qqShare()),5==e?o.copeText(i):h.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?v.open(r.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):a.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})}}]),APP.service("GameService",["$http","UrlService",function(e,t){this.gameInfo=function(o){var s=t.getGameUrl("GAME_INFO");return e.get(s,o)},this.luckDraw=function(o){var s=t.getGameUrl("LOTTERY");return e.get(s,o)},this.confirmGameInfo=function(o){var s=t.getGameUrl("GAME_HAVE_PRIZE"),i="gameId="+o.gameId+"&uuid="+o.uuid+"&prizeId="+o.prizeId+"&consignee="+o.consignee+"&mobile="+o.mobile+"&address="+o.address+"&regionName="+o.regionName+"&isDefault="+o.isDefault+"&provinceId="+o.provinceId+"&cityId="+o.cityId+"&regionId="+o.regionId+"&streetId="+o.streetId;return e({method:"POST",url:s,data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.storeDetailInfo=function(o){var s=t.getUrl("GET_STORE_DETAIL");return e.get(s,o)},this.getapplyDuozhu=function(o){var s=t.getUrl("GET_APPLY_MENGZHU");return e.get(s,o)},this.applyDuozhu=function(o){var s=t.getUrl("APPLY_MENGZHU");return e({method:"POST",url:s,params:o})},this.notapplyDuozhu=function(o){var s=t.getUrl("APPLY_MENGZHU_NOT");return e.get(s,o)}}]),APP.controller("newresCtrl",["$stateParams","$scope","flashService","$state","$ionicHistory","$interval","newresService","$ionicScrollDelegate","$rootScope","$localstorage","GoodsService","UserService","$ionicLoading","HomePageService",function($stateParams,$scope,flashService,$state,$ionicHistory,$interval,newresService,$ionicScrollDelegate,$rootScope,$localstorage,GoodsService,UserService,$ionicLoading,HomePageService){function Format(e){return e=e<10?"0"+e:e}function countDown(e,t,o){$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($state.reload(),$interval.cancel(timer[o]))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.showtime=0,$scope.pageIndex=1,$scope.newprodlist=[],$scope.hasmore=!0,$scope.isWd=!1,$scope.storeId=0,$scope.flag=!1,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png";var timer=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="",nowT=(new Date).getTime();$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){$scope.flag=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprodlist=e.data.acReserveList;for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var s=timerLength;s<remindArray.length;s++)countDown(countDownNowTime[remindArray[s]],countDownendTime[remindArray[s]],remindArray[s])})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.loadMore=function(){$scope.pageIndex++,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){if($scope.flag=!0,0==e.data.acReserveList.length)$scope.hasmore=!1,$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList),$scope.$broadcast("scroll.infiniteScrollComplete");else{if($scope.hasmore=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd)$scope.isWd=!0,$scope.storeId=UserService.getUser().mid;else{$scope.storeId=$localstorage.get("storeId",20219251),$scope.isWd=!1}$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList);for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var s=timerLength;s<remindArray.length;s++)countDown(countDownNowTime[remindArray[s]],countDownendTime[remindArray[s]],remindArray[s]);$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.$on("$ionicView.beforeEnter",function(){$scope.init()}),$scope.goBack=function(){for(var e=0;e<remindArray.length;e++)$interval.cancel(timer[remindArray[e]]);remindArray=[],$ionicHistory.goBack()}}]),APP.service("newresService",["$http","UrlService","flashService","$interval",function(e,t,o,s){this.getnewProd=function(o,s,i,a,n,r){var c={provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:o,from:r};return e.get(t.getNewUrl("NEW_SEND"),c)}}]),APP.controller("newsendCtrl",["$stateParams","$scope","GoodsService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService",function($stateParams,$scope,GoodsService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService){function add(e,t){var o=new Date,s=t,i=o.getTime(),a=$interval(function(){i+=1e3;var e=parseInt((s-i)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),r=e-24*t*60*60-60*n*60,c=parseInt(r/60),l=e-24*t*60*60-60*n*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(n)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(a))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,
$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var s={from:o};return e.get(t.getZCUrl("SUC_ZHONGCHOU"),s)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("presellCtrl",["$scope","flashService","$state","$ionicHistory","$interval","presellService","$ionicScrollDelegate","$rootScope","$localstorage","UserService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d){e.pageIndex=1,e.hasmore=!0,e.preselllist=[],e.storeId=0,e.flag=!1,e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.goBack=function(){s.goBack()},e.init=function(){e.storeId=c.get("storeId",r.globalConstant.storeId),e.loadMore=function(){a.getpres(e.pageIndex).success(function(t){0==t.data.length?(e.hasmore=!1,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasmore=!0,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"))}),e.pageIndex++},d.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.$on("$stateChangeSuccess",function(){e.loadMore()})}]),APP.service("presellService",["$http","UrlService","flashService","$interval",function(e,t,o,s){this.getpres=function(o){var s={pageIndex:o,pageSize:4};return e.get(t.getNewUrl("NEW_RES"),s)}}]),APP.controller("CarTrackController",["$scope","$stateParams","$sce",function(e,t,o){e.trackUrl=o.trustAsResourceUrl(t.trackUrl)}]),APP.controller("ConfirmReceiveController",["$scope","PopupService","$stateParams","ConfirmReceiveService","$ionicViewSwitcher","$state",function(e,t,o,s,i,a){function n(){s.getConfirmList(e.orderId).success(function(t){t.success&&(e.confirmCount=t.data.numberCount,e.confirmReceivelist=t.data.orderProductList)})}e.orderId="",e.confirmCount="",e.confirmReceivelist=[],e.confirmReceive=function(e){function o(o){o&&s.confirmReceive(e).success(function(e){e.success?n():t.showToast(e.message)})}t.showConfirm("",'"确认收货"将代表您已收到所购商品！',o,"确认")},e.goOrderManage=function(){i.nextDirection("forward"),a.go("orderManage")},e.$on("$ionicView.beforeEnter",function(t,s){e.orderId=o.orderId,n()})}]),APP.service("ConfirmReceiveService",["$http","UrlService",function(e,t){this.getConfirmList=function(o){var s={orderId:o};return e.get(t.getUrl("GET_CONFIRM_RECEIVE_LIST"),s)},this.confirmReceive=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CONFIRM_RECEIVE"),s)}}]),APP.controller("SendGoodsTimeController",["$ionicHistory","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","SendGoodsTimeService","PopupService","$timeout",function(e,t,o,s,i,a,n,r,c){t.htmlContent=o.content,t.title=o.title,t.data={time:[{text:"9:00-13:00"},{text:"13:00-18:00"},{text:"18:00-21:00"}]},t.zfb_checked=!0,t.huod_checked=!1,t.kjt_checked=!1,t.init=function(){t.htmlContent=o.content,t.title=o.title,t.dateTimes=[],t.datas={},n.getSendGoodsDates().success(function(e,o,s,i){t.storeInfo=e.data;for(var a=0;a<e.data.length;a++)t.datas={text:e.data[a]},t.dateTimes.push(t.datas)})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.chooseDate=function(){a.show({buttons:t.dateTimes,cancel:function(){},buttonClicked:function(e){return t.dateChoose=t.dateTimes[e].text,!0},cssClass:"limitScrollHeight"})},t.chooseTime=function(){a.show({buttons:t.data.time,cancel:function(){},buttonClicked:function(e){return t.timeChoose=t.data.time[e].text,!0}})},t.confirm=function(){if(!t.dateChoose)return void r.showToast("请填写配送时间");t.dateChoose=t.dateChoose.substr(0,10),t.timeChoose="",n.confirmSendGoodsDates(1,t.dateChoose,t.timeChoose).success(function(t,o,s,i){1==t.success&&e.goBack()})}}]),APP.service("SendGoodsTimeService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){return e({method:"POST",url:t.getUrl("PAY_WAY")})},this.confirmSendGoodsDates=function(o,s,i){var a={cd:o,day:s,time:i};return e({method:"POST",url:t.getUrl("SUBMIT_DELIVE_WAY"),params:a})}}]),APP.controller("AfterOrderSubmitController",["$scope","$stateParams","$rootScope","$ionicLoading","PaymentService","$ionicHistory","PopupService","InAppBrowserService","$state","EasyConnectService","$ionicPopup","AfterOrderSubmitService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.htmlContent=t.content,e.title=t.title,e.payment="",e.showPay=!0,e.isToStore=!1;var g="";e.paymentCode=t.paymentCode;var m,f,h;e.init=function(){e.htmlContent=t.content,e.title=t.title,e.messageData=t.messageData,e.data=JSON.parse(e.messageData),m=e.data.os,f=e.data.pyc,h=e.data.oa},e.payTest=function(e,t,o){return void c.go("paymentxyz",{orderSn:e,totalAmount:o})},e.orderRace=function(){window.location.href=u.getThirdUrl("race/")},e.goToStore=function(){c.go("myStore",{storeId:g,shareStoreId:g})},e.goBack=function(){a.goBack(-2)},e.orderRace=function(){window.location.href=u.getThirdUrl("race/")},e.$on("$ionicView.beforeEnter",function(){e.init();var t=a.viewHistory().histories.root.stack,o=t.length;t[o-3]&&"productDetail"==t[o-3].stateName?g=t[o-3].stateParams.shareStoreId:t[o-4]&&"productDetail"==t[o-4].stateName&&(g=t[o-4].stateParams.shareStoreId),g&&(e.isToStore=!0)})}]),APP.service("AfterOrderSubmitService",["$http","UrlService",function(e,t){this.getAliPayInfo=function(o,s,i){var a={tradeNo:o,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+o,price:s,notifyUrl:i};return e({method:"POST",url:t.getUrl("GET_ALIPAY_INFO"),params:a})}}]),APP.controller("BankCardChoseController",["bankCardPaymentListService","$scope","$stateParams","$state","$ionicHistory","PopupService","$ionicPopup","$http","UrlService","UserService",function(e,t,o,s,i,a,n,r,c,l,d){t.orderSn=o.orderSn,t.totalAmount=o.totalAmount,t.cardsArr=[],t.goCart=function(){s.go("orderManage")},t.toPay=function(e){var o={orderSn:t.orderSn,totalAmount:t.totalAmount,whereName:e};switch(e){case"ccb_credit":s.go("debitCardPayment",o);break;case"ccb_fenqi":s.go("ccbfenqi",o);break;case"ceb_credit":s.go("debitCardPayment",o);break;case"ceb_fenqi":s.go("ccbfenqi",o)}},t.goBack=function(){t.$ionicGoBack()},t.$on("$ionicView.beforeEnter",function(){e.getCcbCost("sg").success(function(e){e.success&&(t.cardsArr=e.data)})})}]),APP.service("bankCardPaymentListService",["$http","UrlService",function(e,t){this.getCcbCost=function(o){var s=t.getPayCenter("PAY_TYPE_LIST")+"?callback=JSON_CALLBACK&channel="+o+"&category=1";return e.jsonp(s)}}]),APP.controller("CcbPayController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,s,i,a,n){e.ccbUrl=o.trustAsResourceUrl(t.url),window.screen.width<=320?e.height="50%":e.height="80%";t.orderSn;e.goBack=function(){n.go("orderManage")}}]),APP.controller("CcbFenqiController",["$q","CcbFenqiService","$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","InAppBrowserService","UrlService","PaymentService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){function h(o){var s=e.defer();return t.payRequest(o).success(function(e){s.resolve(e)}),s.promise}function v(e){var t="";if("ceb_fenqi"==s.whereName)t=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var n="";e.data.ccbfenqi.INSTALLNUM&&(n="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),t=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+n+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}if(i.isIOS){var r=null;r=cordova.InAppBrowser.open(t,"_blank","location=no,shownativetitlebar=yes,titlebartitlestr="+o.title+"分期"),r.addEventListener("exit",function(e){a.go("orderManage")}),r.addEventListener("loadstart",function(e){-1!=e.url.indexOf("orderManage")&&(r.close(),a.go("orderManage"))})}else a.go("ccbPay",{url:t,orderSn:o.orderSn})}o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/CCB.png",o.title="建行信用卡",s.whereName.indexOf("ceb")>=0&&(o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/12CEB.png",o.title="光大信用卡"),o.whereName=s.whereName,o.$on("$ionicView.beforeEnter",function(){o.isAndroid=ionic.Platform.isAndroid(),o.isAndroid?o.androidOrIosStyle={right:"5px"}:o.androidOrIosStyle={left:"70px"},o.isShowDet=!1,o.isChooseFenqi=!1,o.orderSn=s.orderSn,t.getCcbCost(o.orderSn,"sg",s.whereName).success(function(e){o.payList=e.data.costInfo,o.totalFee=e.data.totalFee,o.benefitFee=e.data.benefitFee,o.payFee=e.data.payFee,o.cfgMark=e.data.cfgMark,o.feeInfo=null!=e.data.feeInfo&&e.data.feeInfo;for(var t=o.payList.length,s=0;s<t;s++)o.payList[s].fenqiNum=!1;o.payList[0].fenqiNum=!0,o.number=o.payList[0].number;for(var s=t-1;s>=0;s--)1==o.payList[s].isFree?o.payList[s].isFree=!0:o.payList[s].isFree=!1})}),o.showDetail=function(){o.isShowDet=!o.isShowDet},o.changeFenqiNum=function(e){o.isChooseFenqi=!0;for(var t=o.payList.length,s=0;s<t;s++)o.payList[s].number==e?(o.payList[s].fenqiNum=!0,o.number=e):o.payList[s].fenqiNum=!1},o.toPay=function(){if(!o.number)return void l.showToast("请选择一种分期方式");if(window.cordova){var e={orderSn:o.orderSn};m.orderPayCheck(e).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:s.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){13!=e.errorCode&&e.success?v(e):13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){e.success&&v(e)})):a.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}else{var t={orderSn:o.orderSn};m.orderPayCheck(t).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:s.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){if(13!=e.errorCode&&e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var s="";e.data.ccbfenqi.INSTALLNUM&&(s="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+s+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}else 13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){if(e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var s="";e.data.ccbfenqi.INSTALLNUM&&(s="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM);var o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+s+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}})):a.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}}}]),APP.service("CcbFenqiService",["$http","UrlService","UserService",function(e,t,o){this.getCcbCost=function(s,i,a){var n=t.getPayCenter("CCB_FENQI")+"?callback=JSON_CALLBACK&orderSn="+s+"&channel="+i+"&payType="+a+"&version=1&memberId="+o.getUser().mid;return e.jsonp(n)},this.payRequest=function(o,s){var i="";if(o.joinActivity)var i="&joinActivity=1";var a=t.getPayCenter("CCB_FENQI_W")+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+i;return e.jsonp(a)},this.payRequestWithGuangDaTest=function(o){var s="";if(o.joinActivity)var s="&joinActivity=1";var i=t.getGuangDaTestPay()+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+s;return e.jsonp(i)}}]),APP.controller("choiceOfGiftsController",["spacificationsService","$ionicModal","$scope","$stateParams","$rootScope","$state","$ionicPopup","$timeout","PopupService","LoginService","$http","$ionicHistory","$ionicScrollDelegate","$ionicLoading","UrlService","choiceOfGiftsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){o.clientSideList=[],o.isGoBack=!1,o.data=[],o.postArr=[],o.num=0,o.goBack=function(){o.num>0?o.isGoBack=!0:(o.isGoBack=!1,p.goBack())},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.init=function(){f.doInit().success(function(e){e.success&&null!=e.result?o.clientSideList=e.result:c.showToast("获取数据为空或者失败")})},o.changeType=function(e,t,s){if(1==t)c.showToast("您已选择了此商品");else{o.num++;for(var i=0;i<e.length;i++)e[i].isDefault="0";e[s].isDefault="1"}},o.goBackFill=function(){o.isGoBack=!1},o.clickOk=function(){o.isGoBack=!1,p.goBack()},o.showDetailInfo=function(t){u.$getByHandle("mainScroll").scrollTop(),o.StoreModal.show(),e.doInit(t).success(function(e,t,s,i){null==e.data?o.data=[]:o.data=e.data.productAttrs})},o.preservation=function(){o.postArr=[];for(var e=0;e<o.clientSideList.length;e++)for(var t=0;t<o.clientSideList[e].length;t++)1==o.clientSideList[e][t].isDefault&&o.postArr.push({g:o.clientSideList[e][t].group,s:o.clientSideList[e][t].spu});f.toSubmit(o.postArr).success(function(e){e.success&&e.result?(c.showToast(e.message),p.goBack()):c.showToast(e.message)})},t.fromTemplateUrl("templates/common/commonGifts.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.StoreModal=e}),o.closeStoreModal=function(){o.StoreModal.hide()};var h=window.innerHeight,v=h-370+"px";o.storeContentHeight={height:"auto"},o.contentHeight={height:v};var $=h-370+50+"px";o.storeMsgTop={top:$},o.$on("$ionicView.beforeEnter",function(e,t){o.isGoBack=!1,o.clientSideList=[],o.data=[],o.postArr=[],o.num=0,o.init()})}]),APP.service("choiceOfGiftsService",["$http","UrlService",function(e,t){this.doInit=function(){return e({method:"POST",url:t.getUrl("GET_GIFTS")})},this.toSubmit=function(o){var s={p:o},i=t.getUrl("PRESERVATION_GIFTS",s);return e({headers:{},method:"POST",url:i,data:s})}}]),APP.controller("debitCardPaymentController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){o.totalAmount,o.orderSn;t.whereName=o.whereName,t.goBack=function(){c.goBack()}}]),APP.controller("OrderConfirmController",["$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory","$ionicScrollDelegate","$ionicLoading",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(){e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.couponsPrice=0,e.couponAmount=0,e.allPrice=0,e.newPrice=0,e.orderData={},e.htmlContent=t.content,e.title=t.title,e.searchGoodsName.name=null,e.searchGoodsName.giftName=null,e.codFlag=!1,e.couponsDiscount=null,e.buttonDisabled=[!0,!0,!0],w=[]}function f(){if(!0!==e.disableSubmitBtn)if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))e.disableSubmitBtn=!0,e.isHasCode=!1,e.isFillIn=!0,i.toSubmit(e.isBooking,w).success(function(t,i,n,r){if(!0===t.success){e.disableSubmitBtn=!1,g.hide(),window.cordova&&o.gio.track("SubmitOrder",{paymentMethod:t.data.pyc,totalPrice:e.allPrice!=e.newPrice?e.newPrice:e.allPrice,productCount:e.proNumberTotal});var c=t;if(!0===c.success&&c.data&&c.data.os){var l=c.data,u=c.data.pyc;if(101==c.data.ps)return void s.go("orderManage");if(window.xneng){var m="",f=o.xnFromState,h=o.xnToState,v=o.xnFromParams,$=o.xnToParams,S=f.url.split("/:");if(S.length>0){for(var I=1;I<S.length;I++)m+="/"+v[S[I]];m=d.getHead().match(/(\S*)v3/)[1]+"www/index.html#/"+f.name+m}var w="",S=h.url.split("/:");if(S.length>0){for(var I=1;I<S.length;I++)w+="/"+$[S[I]];w=d.getHead().match(/(\S*)v3/)[1]+"www/index.html#/"+h.name+w}window.xneng.NTalkerOrderAction("提交订单",w,m,"",l.os,l.oa,function(e){},function(e){})}if(window.baifend){for(var y=[],T=[],C=[],I=0;I<e.orderConfirmMessage.ops.length;I++)y[I]=e.orderConfirmMessage.ops[I].sku,T[I]=e.orderConfirmMessage.ops[I].price,C[I]=e.orderConfirmMessage.ops[I].num;var b={uid:e.orderConfirmMessage.mid?e.orderConfirmMessage.mid+"":"",total:l.oa};o.itemId=y,o.baifendprice=T,o.proNumberTotal=C,window.baifend.onOrder(l.orderSn,y,T,C,l.orderAmount,b)}"online"==u?(e.orderConfirmMessage.tca>0&&(o.couponXyzType=!0),s.go("paymentxyz",{orderSn:t.data.os,totalAmount:t.data.oa})):s.go("afterOrderSubmit",{messageData:JSON.stringify(l),paymentCode:u})}else{var A=a.confirm({template:c.message?c.message:"创建订单失败",okText:"返回上一页",cancelText:"留在此页"});A.then(function(e){e&&p.goBack(-1)})}}else{e.disableSubmitBtn=!1,g.hide();var A=a.confirm({template:t.message,okText:"返回上一页",cancelText:"留在此页"});A.then(function(e){e&&p.goBack(-1)})}}).error(function(t){e.disableSubmitBtn=!1,g.hide()});else{a.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}}function h(t){if(e.regAddress){if(3==t||!e.orderConfirmMessage.coAmt){if(0!=t)for(var o=0;o<e.orderConfirmMessage.ops.length;o++)if(e.orderConfirmMessage.ops[o].ca)return void a.alert({template:T,okText:"知道了"});return 2==t||1!=e.giftSearchButton&&1!=e.orderConfirmMessage.useGiftCard||void a.alert({template:T,okText:"知道了"})}a.alert({template:T,okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}}function v(t){w=[],u.resize(),e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0;for(var o=t.length,s=0;s<o;s++){var i=null,a=null;i=$(I,t[s].quota),i>e.newPrice&&(i=e.newPrice),a=Math.floor($(i,t[s].proportion)),i=a/t[s].proportion,a>e.pointsList[s].count&&(a=e.pointsList[s].count,i=a/t[s].proportion),e.pointsList[s].pointDiscount=i,e.pointsList[s].canUsePoint=a,e.pointsChecked[s]=!1,S[s]=!1,e.pointsList[s].canUsePoint>0&&(e.buttonDisabled[s]=!1)}}function $(e,t){var o=0,s=e.toString(),i=t.toString();try{o+=s.split(".")[1].length}catch(e){}try{o+=i.split(".")[1].length}catch(e){}return Number(s.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,o)}e.o2oTypeMap={},e.htmlContent=t.content,e.title=t.title,e.tabNav="selection",e.couponsPrice=0,e.couponAmount=0,e.smallPrice=[],e.snewPrice=[],e.allPrice=0,e.newPrice=0,e.isBook=t.Book,e.attrValueNames=t.attrValueNames||"",e.skku=t.skku||"",e.disableSubmitBtn=!1,e.searchGoodsName={name:"",giftName:""},e.invoiceHead=void 0,e.zzsInvoice=void 0,e.searchButton=!1,e.giftSearchButton=!1,e.canUseGiftCard=void 0,e.item={isChecked:!1,isGiftChecked:!1},e.data={memberId:""},e.deliMap={"9:0000":"9:00-13:00",130000:"13:00-18:00",180000:"18:00-21:00"},e.pointsChecked=[!1,!1,!1];var S=[!1,!1,!1];e.couponsDiscount=null,e.seaShellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.pointsList=null;var I=null,w=[3,2,1];e.buttonDisabled=[!0,!0,!0],e.orderInitParams=JSON.parse(t.orderInitParams),e.selectedPayType=null,e.privilege="",e.giftList=[],e.isHasCode=!1,e.isFillIn=!1,e.isHxCode=!1,e.goBack=function(){p.goBack()},e.goWriteOff=function(){var t=document.getElementById("privilegeCode");""!=t.value?i.postPrivilegeCode(t.value).success(function(o){o.success&&o.result?(r.showToast("验证成功"),e.privilege=t.value,e.isHxCode=!0,i.updateOrder(e.orderInitParams).success(function(o){o.success?(r.showToast("验证成功"),null!=o.data.hb?(e.privilege=o.data.hb.c,e.giftList=o.data.hb.p):(e.privilege=t.value,e.giftList=[])):(r.showToast(o.message),e.giftList=[])})):(r.showToast(o.message),e.isHxCode=!1,e.privilege="",e.giftList=[])}):r.showToast("请填写正确的特权码")},e.init=function(o){e.o2oAttrId=t.o2oAttrId,m(),i[o?"updateOrder":"doInit"](e.orderInitParams).success(function(t,o,i,a){if(!t.success)return void s.go("homePage");null!=t.data.hb&&(e.giftList=t.data.hb.p,e.privilege=t.data.hb.c),e.orderConfirmMessage=t.data,e.pointsList=t.data.bl?t.data.bl:null,e.canUseGiftCard=e.orderConfirmMessage.canUseGiftCard,e.regAddress=e.orderConfirmMessage.addr,e.regInvoice=e.orderConfirmMessage.inv.iti,e.invoiceHead=e.orderConfirmMessage.inv.iti,e.o2oTypeMap=e.orderConfirmMessage.o2oTypeMap,e.zzsInvoice=e.orderConfirmMessage.inv.iti,e.isBooking=e.orderConfirmMessage.book?1:0,e.selectedPayType={code:e.orderConfirmMessage.pays[0].code,name:e.orderConfirmMessage.pays[0].name},e.proNumberTotal=0;for(var n=0,r=e.orderConfirmMessage.ops.length;n<r;n++)e.proNumberTotal+=e.orderConfirmMessage.ops[n].num;1==e.isBook&&(e.isBooking=1),e.paymentType=e.orderConfirmMessage.pays,e.paymentCode=e.paymentType[0].paymentCode,e.codFlag=!1,2==e.orderConfirmMessage.pays.length&&(e.codFlag=!0),e.couponsDiscount=e.orderConfirmMessage.tca,e.allPrice=e.orderConfirmMessage.pam,e.newPrice=e.orderConfirmMessage.oam,I=e.orderConfirmMessage.oam,e.orderConfirmMessage.bl&&v(e.orderConfirmMessage.bl)}).error(function(e,t,o,s){})},e.isOnlinePay=[!0,!1],e.choosePayType=function(t,o){e.selectedPayType.code!=o&&i.choosePayType({name:t,code:o}).success(function(s){1==s.success&&(e.isOnlinePay=[!1,!0],e.selectedPayType={name:t,code:o})})},e.$on("$ionicView.beforeEnter",function(t,o){e.isHasCode=!1,e.isFillIn=!1,"back"==o.direction?e.init(!0):(e.init(),e.privilege="",e.giftList=[],e.isHxCode=!1),e.isBuyerForOrder=c.getRole(),0==e.isBuyerForOrder?e.footerSubmit={position:"fixed",bottom:"0px"}:e.footerSubmit={position:"fixed",bottom:"49px"}}),e.$on("$ionicView.afterLeave",function(e,t){o.isInvoice=!1}),e.$watch("searchGoodsName.name",function(t,o){t?e.searchButton=!0:(e.searchButton=!1,e.item.isChecked=!1)}),e.$watch("searchGoodsName.giftName",function(t,o){t?e.giftSearchButton=!0:(e.giftSearchButton=!1,e.item.isGiftChecked=!1)}),e.toInvoice=function(t){s.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:0})},e.goBackFill=function(){e.isHasCode=!1,e.isFillIn=!0},e.toSubmit=function(t){9==e.orderConfirmMessage.ot?2==t?f():e.isFillIn||""!=e.privilege&&e.giftList!=[]?e.isFillIn?f():1==t&&f():e.isHasCode=!0:f()},e.toPayment=function(e){s.go("payment",{paymentCode:e})},e.tosendGoodsTime=function(){s.go("sendGoodsTime")},e.showPopup=function(e){var t=a.show({template:e});n(function(){t.close()},1e3)},e.useGiftCard=function(t){t&&i.useGiftCard(t).success(function(t,o,s,i){1==t.success?(e.item.isGiftChecked=!0,"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):(e.item.isGiftChecked=!0,e.init(!0))):r.showAlert("提示","验证优惠券失败","")})},e.cancleGiftCard=function(){a.confirm({title:"提示",template:"是否确认取消优惠?",okText:"确定",cancelText:"取消"}).then(function(t){t&&i.cancleGiftCard().success(function(t,o,s,i){1==t.result?(r.showAlert("提示","取消成功",""),e.init(!0)):e.showPopup("取消失败")})})},e.useCard=function(t,o,s,a){t&&i.useCard(t,o,s,a).success(function(t,o,s,i){1==t.success?"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):e.couponsForTransfer():r.showAlert("提示","验证优惠券失败","")})};var y;e.couponsForTransfer=function(){function t(){e.expiredSecond=e.expiredSecond-1,e.expiredSecond>0?(e.searchButton=!1,y=n(function(){t()},1e3)):(e.searchButton=!0,o.close())}e.expiredSecond=121,y&&n.cancel(y),t();var o=a.show({template:'<div class="row padding-0"><span class="col-30 text-align-c">验证码</span> <input class="col-60 border text-align-c" style="border-color: #32BEFF !important;height: 20px" type="number" ng-model="data.memberId" placeholder="请输入验证码"></div><div> 验证码将在<span class="color-text-red" ng-bind="expiredSecond"></span>秒后过期</div>',title:"请输入验证码",subTitle:"请输入验证码",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){e.data.memberId?i.cardCheck(e.data.memberId).success(function(t,s,i,a){1==t.success?(r.showAlert("提示","使用成功",""),e.init(!0),o.close()):r.showAlert("提示",t.message,"")}):r.showAlert("提示","请输入验证码",""),t.preventDefault()}}]})},e.goCard=function(){h(1)},e.goGiftCard=function(){h(2)},e.goUseCouponList=function(e){if(!e.couponId)if(1==e.type){if(!h(0))return}else if(2==e.type&&!h(3))return;s.go("useCouponsList",e)};var T="礼品券不可与优惠券/卡券同时使用，请核对要使用的优惠券";e.countPoint=function(t,o){if(0!=e.pointsList[t].canUsePoint){if(e.pointsChecked[t]=!e.pointsChecked[t],1==S[t]&&0==e.pointsChecked[t])return e.newPrice=e.newPrice+e.diamondDiscount+e.seashellDiscount+e.insuranceDiscount,v(e.orderConfirmMessage.bl),void(S[t]=e.pointsChecked[t]);if(0==S[t]&&1==e.pointsChecked[t]){var s,i;switch(s=$(I,e.pointsList[t].quota),s>e.newPrice&&(s=e.newPrice),i=Math.floor($(s,e.pointsList[t].proportion)),s=i/e.pointsList[t].proportion,i>e.pointsList[t].count&&(i=e.pointsList[t].count,s=i/e.pointsList[t].proportion),e.pointsList[t].pointDiscount=s,e.pointsList[t].canUsePoint=i,e.newPrice=e.newPrice-s,o){case"diamond":e.diamondDiscount=s;break;case"seashell":e.seashellDiscount=s;break;case"insurance":e.insuranceDiscount=s}w.push({benefitType:o,count:i,amt:s});for(var a=0;a<e.pointsList.length;a++)if(0==e.pointsChecked[a]&&a!=t){var n,r;n=$(I,e.pointsList[a].quota),n>e.newPrice&&(n=e.newPrice),r=Math.floor($(n,e.pointsList[a].proportion)),n=r/e.pointsList[a].proportion,0==r&&(e.buttonDisabled[a]=!0),r>e.pointsList[a].count&&(r=e.pointsList[a].count,n=r/e.pointsList[a].proportion),e.pointsList[a].pointDiscount=n,e.pointsList[a].canUsePoint=r}S[t]=e.pointsChecked[t]}u.resize()}},e.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},e.switchOff={background:"#fff","border-color":"#e6e6e6"}}]),APP.service("orderConfirmService",["$http","UrlService",function(e,t){this.doInit=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.updateOrder=function(){return e({method:"post",url:t.getUrl("UPDATE_ORDER")})},this.toSubmit=function(o,s){var i={remark:"",isBooking:o,benefitList:s};return e({method:"POST",url:t.getUrl("ORDER_SUBMIT"),data:i})},this.useCard=function(o,s,i,a){var n={cardCode:o,productId:s,number:i,storeCode:a};return e({method:"POST",url:t.getUrl("CARD_COUPONS_USED"),params:n})},this.cardCheck=function(o){var s={captcha:o};return e.get(t.getUrl("CARD_ CODE_CHECK"),s)},this.useGiftCard=function(o){var s={cardCode:o};return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_USED"),params:s})},this.cancleGiftCard=function(){return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_CANCLE")})},this.choosePayType=function(o){return e({method:"POST",url:t.getUrl("SUBMIT_PAY_WAY"),data:o})},this.postPrivilegeCode=function(o){var s={c:o};return e({method:"POST",url:t.getUrl("POST_PRIVILEGE_CODE"),params:s})}}]),APP.controller("OrderSearchController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){function S(e){e?n.deleteOrder(w).success(function(e){e.success?(t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()):(g.showToastShort(e.message),w="")}).error(function(e){g.showToastShort("删除失败！"),w=""}):w=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus="",t.isIos=!1;var I="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId;var w="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.orderStatus=o.orderStatus?o.orderStatus:"","0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1)},t.initSearch=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.availableToTop(),t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,t.orderStatus,0,5,t.search.keyWord,!0)},t.loadOrderList=function(e,o,s,i,a,c,l){n.getOrderList(o,s,i,a,c).success(function(o){o.success&&(e?l?t.searchOrderList=t.searchOrderList.concat(o.data.orders):t.orderList=t.orderList.concat(o.data.orders):l?(t.searchOrderList=o.data.orders,0==t.searchOrderList.length?t.noOrders=!0:t.noOrders=!1):t.orderList=o.data.orders,l?t.hasMoreDataSearch=o.data.orderProductSize:t.hasMoreData=o.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length),e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,
t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");I=e.result,window.alipay.pay({payInfo:I},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){i.go("paymentxyz",{orderSn:e})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),i.go("orderTracking",{orderSn:e})},t.goOrderDetails=function(e,o,s,a,n,r){t.memberId==n&&(r&&t.closeSearchModal(),s?i.go("refundDetail",{orderProductId:a,memberId:n}):i.go("orderDetail",{orderSn:e,cOrderSn:o}))},t.goAssess=function(e){i.go("assess",{orderId:e})},t.goLookAssess=function(e){i.go("lookAssess",{orderId:e})},t.orderCancel=function(e){n.cancelOrder(e,"mstore").success(function(e){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()})},t.availableToTop=function(){r.$getByHandle("searchOrderHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||(t.init(),t.noOrders=!1)}),a.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){t.searchModal.show(),t.searchOrderList=[],t.pageIndexSearch=0,t.hasMoreDataSearch=!1},t.closeSearchModal=function(){m.goBack()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,"",t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){w=e,g.showConfirm("","确认删除此订单？",S,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("assessed")})}]),APP.controller("payResultSuccessController",["$scope","$stateParams","CirclePageService","$localstorage","SeeMoreService","UrlService",function(e,t,o,s,i,a){e.$on("$ionicView.beforeEnter",function(){o.getCircleLink("","","3").success(function(t){t.success&&(e.circleUrl=t.data)})}),e.babyonerace=function(){window.location.href=a.getThirdUrl("race/")}}]),APP.controller("PaymentController",["$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService",function(e,t,o,s,i,a){e.htmlContent=t.content,e.title=t.title,e.payWay="alipaymobile",e.zfb_checked=!0,e.huod_checked=!1,e.kjt_checked=!1,e.alipayText=null,e.codText=null,e.kjtpayText=null,e.wxpay_checked=!1,e.wxpayText=null,e.paymentCode=t.paymentCode,e.payWayList=[],e.payWayMap={alipaymobile:"支付宝",cod:"货到付款",kjtpay:"快捷通",wxpay:"微信支付"},e.init=function(){e.htmlContent=t.content,e.title=t.title,e.paymentCode=t.paymentCode,a.getSendGoodsDates().success(function(t,o,s,i){e.payWayList=t.data.payWayList;for(var a=0;a<t.data.payWayList.length;a++)"alipaymobile"==t.data.payWayList[a].paymentCode?e.alipayText=t.data.payWayList[a].paymentName:"cod"==t.data.payWayList[a].paymentCode?e.codText=t.data.payWayList[a].paymentName:"kjtpay"==t.data.payWayList[a].paymentCode&&(e.kjtpayText=t.data.payWayList[a].paymentName)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.checkedpay=function(t){e.paymentCode=t},e.pushPayWay=function(){if(!e.paymentCode)return void alert("请选择一个支付方式");a.submitSendGoodsDates(e.paymentCode).success(function(t,o,s,i){1==t.success?e.$ionicGoBack():alert(t.message)})}}]),APP.service("PaymentService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){var o={toUrl:"1"};return e.get(t.getUrl("PAY_WAY"),o)},this.submitSendGoodsDates=function(o){var s={payWay:o};return e({method:"POST",url:t.getUrl("SUBMIT_PAY_WAY"),params:s})},this.wPay=function(o){return e.get(t.getUrl("WECHAT_PAY"),o)},this.unionPay=function(o){var s=t.getHead()+"h5/pay/commonCallback.html",i=t.getPayCenter("UNION_PAY")+"?orderSn="+o+"&type=H5&callbackUrl="+s+"&callback=JSON_CALLBACK";return e.jsonp(i)},this.kjtPay=function(o){return e.get(t.getUrl("PAY_KJT"),o)},this.orderPayCheck=function(o){return e.get(t.getUrl("ORDER_200PAYCHECK"),o)}}]),APP.controller("PaymentControllerxyz",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","UserService","WhiteShowsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.orderSn=o.orderSn,t.priceinit="500.00",t.alipaymobile=[],t.alipaymobiles=!1,t.kjtpay=[],t.kjtpays=!1,t.wxpay=[],t.wxpays=!1,t.canClick=!0,t.showIous=!0,t.canPayWhiticos=!1,t.icosImg=s.imgBaseURL+"img/baitiao-paylist.png",t.iousStatus=-1,t.htmlContent=o.content,t.title=o.title,t.payWay="alipaymobile",t.totalAmount=o.totalAmount,t.paymentCode="",t.payWayList=[],t.payment="",t.showPay=!0,t.isToStore=!1;var v="";t.isRed=!1,t.urlImg="http://m.ehaier.com/www/img/jh.png",t.canClick=!0,t.showCcb=!0;var $="",S={orderSn:t.orderSn};t.toPay=function(){var e={totalAmount:t.price,orderSn:t.orderSn};i.go("bankCardChose",e)},t.init=function(){g.get(m.getUrl("TO_ORDER_SUBMIT_SUCCESS"),S).success(function(e){t.price=e.data.orders.orderAmount,t.price>=600?(t.canPayWhiticos=!0,t.icosImg=s.imgBaseURL+"img/baitiao-paylist.png"):(t.canPayWhiticos=!1,t.icosImg=s.imgBaseURL+"img/baitiao-paylist-1.png");for(var o=e.data.paywayList,i=0;i<o.length;i++)"alipaymobile"==o[i].paymentCode?(t.alipaymobile=o[i],t.alipaymobiles=!0):"kjtpay"==o[i].paymentCode?(t.kjtpay=o[i],t.kjtpays=!0):"wxpay"==o[i].paymentCode&&(t.wxpay=o[i],t.wxpays=!0);!0!==e.data.isSupportLk?t.showCcb=!1:1==e.data.isSupportLk&&1==e.data.islk?(t.isRed=!0,t.urlImg="http://m.ehaier.com/www/img/ic-ccb.png",t.canClick=!0):1==e.data.isSupportLk&&!0!==e.data.islk&&(t.canClick=!1),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackOrder",{oid:t.orderSn,otp:t.price+""},[]])})},t.$on("$ionicView.beforeEnter",function(){t.init(),$=c.viewHistory().backView,s.paySuccess&&u.alert({template:"此订单已经支付",okText:"确定"}).then(function(e){t.goList()})}),t.goList=function(){$?"orderManage"==$.stateName||"orderSearch"==$.stateName?c.goBack(-1):"Retainage"==$.stateName?i.go("orderManage"):c.goBack(-2):i.go("orderManage")},t.toSpendBai=function(){var e={orderSn:o.orderSn};i.go("spendBaiInstallment",e)},t.goCart=function(){i.go("orderManage")};var I,w;t.payWayMap={alipaymobile:"支付宝",paymentName:"建行信用卡分期",kjtpay:"快捷通",wxpay:"微信支付"},t.iousPay=function(){h.queryIousStatus({userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){if(e.success){if(t.iousStatus=e.data.applyStatus,!t.canPayWhiticos)return;2==t.iousStatus||3==t.iousStatus?i.go("applyForWhite"):0==t.iousStatus?h.applyForOpen({resultUrl:"http://m.ehaier.com/www/index.html",userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):1==t.iousStatus&&n.orderPayCheck(S).success(function(e){-200==e.errorCode?l.showAlert("提示",e.message,function(){}):h.payApply({userId:f.getUser().ucId,token:f.getUser().accessToken,orderSn:o.orderSn,resultUrl:"http:www.baidu.com"}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)})})}})},t.checkedpay=function(e){t.paymentCode=e,I=o.orderSn,w=t.price,t.payTest(I,t.paymentCode,w)},t.payTest=function(s,a,r){if(!window.cordova){var c={orderSn:s};return void n.orderPayCheck(c).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else if("alipaymobile"==a)n.unionPay(o.orderSn).success(function(e){if(e.success&&e.data){var t=e.data.requestUrl+"?expireTime="+e.data.expireTime+"&instMid="+e.data.instMid+"&merOrderId="+e.data.merOrderId+"&mid="+e.data.mid+"&msgSrc="+e.data.msgSrc+"&msgType="+e.data.msgType+"&notifyUrl="+e.data.notifyUrl+"&orderDesc="+e.data.orderDesc+"&requestTimestamp="+e.data.requestTimestamp+"&returnUrl="+e.data.returnUrl+"&sign="+e.data.sign+"&tid="+e.data.tid+"&totalAmount="+e.data.totalAmount;window.location.href=t}else l.showToast(message)}).error(function(e){l.showToast("网络连接错误")});else if("wxpay"==a){var t=window.navigator.userAgent;if(!t||-1==t.indexOf("MicroMessenger"))return void l.showToast("请使用与定金相同的支付方式-微信支付，登录顺逛微店公众号付款。");if(t.substring(t.indexOf("MicroMessenger")+15,t.indexOf("MicroMessenger")+16)<5)return void l.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href=m.getHeadV2()+"h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+s+"&orderAmount="+r+".00"}else"kjtpay"==a&&p.getMessage().success(function(e,t,o,a){e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount?window.location.href=m.getHeadV2()+"h5/pay/kjtpay/request.html?orderSn="+s+"&kjtAcount="+e.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("bankCard")})}).error(function(){alert("网络失败")})})}if("alipaymobile"==a)if(window.alipay){var g=s,f=m.getHeadV2()+"h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?e.getAliPayInfo(g,r,f).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});v=e.result,window.alipay.pay({payInfo:v},function(e){t.showPay=!1,i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}).error(function(e){}):window.alipay.pay({tradeNo:g,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+g,price:r,notifyUrl:f},function(e){i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}else alert("支付宝 插件不存在");else if("wxpay"==a){window.wechatPay||alert("微信支付插件未加载 ");var h={orderSn:s};n.wPay(h).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){t.showPay=!1,i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}else alert("网络连接错误")}).error(function(e){alert(e)})}else"kjtpay"==a&&p.getMessage().success(function(e,t,o,a){if(e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount){var r={orderSn:s,kjtAmount:e.data.kjtAccount.memberKjtpayAccount};n.kjtPay(r).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.success){d.open(e.data).addEventListener("exit",function(e){i.go("orderManage")})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("bankCard")})}).error(function(){alert("网络失败")})}}]),APP.controller("spendBaiInstallmentController",["$scope","$state","$ionicHistory","spendBaiInstallmentService","$stateParams","UrlService","AfterOrderSubmitService","PopupService","PaymentService","$ionicLoading",function(e,t,o,s,i,a,n,r,c,l){e.isShowDet=!1,e.payList=[],e.totalFee=null,e.number=3,e.goBack=function(){e.$ionicGoBack()},e.showDetail=function(){e.isShowDet=!e.isShowDet},e.changeFenqiNum=function(t){e.number=t},e.toPay=function(){if(!e.number)return void r.showAlert("提示","请选择期数后付款",function(){});a.getHeadV2();c.orderPayCheck({orderSn:i.orderSn}).success(function(o){if(-200==o.errorCode)return void r.showAlert("提示",o.message,function(){});window.cordova?s.sendToPayApp(i.orderSn,e.number).success(function(e){if(e.success){var o=e.data.orderInfo;window.alipay.pay({payInfo:o},function(e){t.go("payResultSuccess")},function(e){t.go("payResultFailure")})}}):window.location.href=a.getZCUrl("HB_PAY_H5")+"?orderSn="+i.orderSn+"&number="+e.number})},e.$on("$ionicView.beforeEnter",function(){s.getHBCost(i.orderSn).success(function(t){t.success&&(e.payList=t.data.payList,e.totalFee=t.data.totalFee)}),e.number=3})}]),APP.service("spendBaiInstallmentService",["$http","UrlService",function(e,t){this.getHBCost=function(o){var s=t.getPayCenter("HB_COST")+"?callback=JSON_CALLBACK&orderSn="+o;return e.jsonp(s)},this.sendToPayApp=function(o,s){var i=t.getZCUrl("HB_PAY_APP")+"?orderSn="+o+"&number="+s;return e.get(i)}}]),APP.controller("CommodityListController",["$scope","$localstorage","$rootScope","UseCouponsService","$stateParams","$ionicScrollDelegate","PopupService",function(e,t,o,s,i,a,n){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.backGroundBlue={background:"url("+o.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+o.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.goBack=function(){e.$ionicGoBack()},e.productList=[],e.couponList=[];var r=i.couponId;e.hasmore=!1;var c=1;e.getShopData=function(){s.doInit(r,1,5).success(function(t){t.success?(t.coupon&&(e.couponList=t.coupon),t.productsList&&(e.productList=t.productsList),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)):n.showToast(t.message)})},e.loadMore=function(){c++,s.doInit(r,c,5).success(function(t,o,s,i){t.productsList&&(e.productList=e.productList.concat(t.productsList)),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)})},e.$on("$ionicView.beforeEnter",function(){e.hasmore=!1,c=1,e.getShopData()})}]),APP.service("UseCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i){var a={couponId:o,startIndex:s,pageSize:i};return e.get(t.getUrl("USE_COUPONS_LIST"),a)}}]),APP.controller("GoodsSearchController",["$ionicHistory","$scope","GoodsSearchService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService","HomePageService","$state","UrlService",function($ionicHistory,$scope,GoodsSearchService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService,HomePageService,$state,UrlService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}function historyOldUse(){if(jl=localStorage.getItem("historys")){var e=jl.split("$$"),t=unique(e);t.length>10?(t.length=10,$scope.history=t):$scope.history=t}else $scope.hShow=!1,$scope.hShowB=!0}function searchStartNew(){$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.wdCommonSearchNew("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}function searchStart(){window.cordova&&$rootScope.gio.evar.set({source:"Search",value:$scope.searchGoodsName.name}),$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}var Focus=document.querySelector("#focus");$scope.history=[],$scope.hShow=!0,$scope.hShowB=!0;var bv="",bvv="aicxyz",jl=localStorage.getItem("historys");$scope.hotWords="",$scope.lianXiWords="",$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.comprehensive=["img/comprehensive_black.png","img/comprehensive_white.png"],$scope.comprehensive_index=0,$scope.arrowState=["img/arrow_state_0.png","img/arrow_state_1.png","img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/filter_state_0.png","img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commissionDesc","commission"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.switch=!0,$scope.productIds="",$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.front=$stateParams.front,$scope.shareStoreId=$stateParams.shareStoreId,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="",searchType="0",provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="全部",$scope.brandList=[],$scope.filterParameterArr=["all","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.qs="";var u=navigator.userAgent;$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.settingsList="",-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.alWs=function(e){e?($scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.hShow=!1,$scope.lianXC=!0,$scope.searchData=null,$scope.xyzShData=null,GoodsSearchService.associationalWords(e).success(function(e){$scope.lianXiWords=e.data})):($ionicScrollDelegate.scrollTop(),$scope.searchData=null,$scope.xyzShData=null,$scope.hShow=!0,$scope.hShowB=!1,historyOldUse(),$scope.emptySearch=!1,$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.showTab=!1)},$scope.$on("$ionicView.enter",function(){"back"==bvv?($scope.showTab=!0,Focus.blur()):($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,setTimeout(function(){try{Focus.focus()}catch(e){}},200))}),$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.hotWordShow=!0,GoodsSearchService.hotWords().success(function(e){$scope.hotWords=e.data,$scope.hotWords||($scope.hotWordShow=!1)}),GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),bv=$ionicHistory.viewHistory().backView,bvv=t.direction,$scope.emptySearch=!1,$scope.isShowUp=!1,historyOldUse(),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,"back"==t.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{localStorage.getItem("historys")?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",searchType="0",$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.front=$stateParams.front,$stateParams.shareStoreId?memberId=$stateParams.shareStoreId:UserService.getUser().mid&&(memberId=UserService.getUser().mid),$scope.searchGoodsName={name:""}}}),$scope.sGoods=function(h){$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.filterParams="",$scope.lianXC=!1,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.searchGoodsName.name=h;var oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name;if(oldRecord){var Record=newRecord+"$$"+oldRecord;localStorage.setItem("historys",Record)}else localStorage.setItem("historys",newRecord);historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()})},$scope.searchGoods=function(){return $scope.searchData="",$scope.xyzShData="",$scope.filterParams="",$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.chooseIndex=0,$scope.lianXC=!1,$scope.isShowUp=!1,""!=$scope.searchGoodsName.name||$scope.gsPlaceholder?$scope.gsPlaceholder&&""==$scope.searchGoodsName.name?void $scope.sGoods($scope.gsPlaceholder):void(""!=$scope.searchGoodsName.name&&(oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name,oldRecord?(Record=newRecord+"$$"+oldRecord,localStorage.setItem("historys",Record)):localStorage.setItem("historys",newRecord),historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}))):void PopupService.showToast("请填写搜索内容")},$scope.todoSomething=function(e){13==e.keyCode&&($scope.searchGoods(),Focus.blur())},$scope.babyrace=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):window.location.href=UrlService.getThirdUrl("race/")})},$scope.changeState=function(e,t,o){1==t?GoodsSearchService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.searchData[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):GoodsSearchService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.searchData[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.loadMore=function(){0==$scope.front?GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!0,$scope.qs).success(function(e,t,o,s){0!=e.data.productList.length?($scope.searchData=$scope.searchData?$scope.searchData.concat(e.data?e.data.productList:[]):[],$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)}):1==$scope.front&&GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!0,$scope.qs).success(function(e,t,o,s){0!=e.data.productList.length?($scope.searchData=$scope.searchData?$scope.searchData.concat(e.data?e.data.productList:[]):[],$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)})},$scope.type={choose:[{text:"商品"},{text:"店名"},{text:"店铺码"}],typeId:["0","1","2"]};var placeholderList=["请填入名字或型号等关键字","请搜索店铺名称关键字","请搜索店铺码"];$scope.chooseType=function(e){$scope.isShowUp=!$scope.isShowUp,(e||0==e)&&($scope.searchGoodsName={name:""},$scope.hasmore=!1,$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.typeChoose=$scope.type.choose[e].text,searchType=$scope.type.typeId[e],$scope.gsPlaceholder=placeholderList[e])},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,
void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs=tabState[1][t]}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs=tabState[4][o]}GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,$scope.comprehensive_index=1,$scope.chooseIndex=0,$scope.showComprehensiveSub=!1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})},$ionicModal.fromTemplateUrl("templates/product/SearchFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t){var o=0,s=$scope.brandList.length;if("全部"==t.brandName){$scope.brandList[0].isActive=!0;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive=!1}else{t.isActive=!t.isActive;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive?o++:$scope.brandList[0].isActive=!1;if(0==o&&($scope.brandList[0].isActive=!0),o==s-1){$scope.brandList[0].isActive=!0;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive=!1}}if($scope.brandList[0].isActive)$scope.filterParameterArr[1]="all";else{for(var a="",i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive&&(a+=$scope.brandList[i].id+";");a=a.substring(0,a.length-1),$scope.filterParameterArr[1]=a}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.searchData=null,$scope.xyzShData=null,$scope.filterModal.hide(),$scope.lianXC=!1,searchStartNew(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){for(var e=0;e<$scope.brandList.length;e++)$scope.brandList[e].isActive=0==e;$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){$scope.filterModal.show(),GoodsService.getFilterData($scope.productIds).success(function(e){if(e.success){for(var t=e.data.brandList,o=0;o<t.length;o++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(t[o].id)>-1?o>0&&(t[o].isActive=!0):t[o].isActive=!1:t[o].isActive=0==o;$scope.brandList=t}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()})}]),APP.service("GoodsSearchService",["$http","UrlService",function(e,t){this.wdCommonSearchNew=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,qs:m,noLoading:g};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),f)},this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p,u){var g={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p,qs:u};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),g)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g,qs:m};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),f)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.hotWords=function(){var o={platform:3};return e.get(t.getUrl("HOT_WORDS"),o)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.associationalWords=function(o){var s={searchKey:o,platform:3};return e.get(t.getUrl("ASSOCIATIONAL_WORDS"),s)}}]),APP.controller("SelectionController",["GoodsSearchService","$http","$scope","GoodsService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService",function(GoodsSearchService,$http,$scope,GoodsService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService){function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),getProductList($scope.memberId,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,1,"saleDesc","all",!1)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,s,i,a,n,r,c,l,d){GoodsService.getSelectionProducts(e,t,o,s,i,a,n,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}$scope.rightC={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"11px",right:"8px"},$scope.rightCd={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"31px",right:"8px"},$scope.iosCss={width:"52px"};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.slideImage=[];var typeList=["faxian","all","bx","xyj","kt","cd","rsq","cfdq","bg","zncp","shjd","sjd","bbjg","jtbj","sykt","sgch","jkqc","sm","shfw"];$scope.data={},$scope.tabNav="selection",$scope.productList=[],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[[!0],[!0]],$scope.selectedIndex=0,$scope.isFind=!0,$scope.hasFindData=!1,$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.isFindTab=!0,$scope.filterParameterArr=["hasStock","all","0"],$scope.filterOtherPatam=[],$scope.filterArray="",$scope.filterPrice={min:"",max:""},$scope.toggleLeft=function(){$ionicSideMenuDelegate.toggleLeft()},$scope.brand=!0,$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePriceRange=function(){$scope.priceRange=!$scope.priceRange},$scope.changeOther=function(e){$ionicScrollDelegate.resize(),$scope.otherState[e]=!$scope.otherState[e]},$scope.StockStateArr=["all","hasStock"],$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.chooseBrand=function(e){$scope.isBrand=[!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.isBrand[e]=!0,$scope.filterParameterArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName},$scope.isPriceRange=[!0,!1,!1,!1,!1,!1,!1],$scope.choosePriceRange=function(e){switch($scope.isPriceRange=[!1,!1,!1,!1,!1,!1,!1],$scope.isPriceRange[e]=!0,$scope.filterParameterArr[2]=e,e){case 0:$scope.priceName="全部";break;case 1:$scope.priceName="0～1000";break;case 2:$scope.priceName="1001～2000";break;case 3:$scope.priceName="2001～3000";break;case 4:$scope.priceName="3001～4000";break;case 5:$scope.priceName="4001～5000";break;case 6:$scope.priceName="5000以上"}},$scope.chooseOtherItem=function(e,t,o){for(var s=0;s<o;s++)$scope.isCurrent[e][s]=s===t;$scope.filterOtherPatam[e]=$scope.otherList[e].lstAttributeOptions[t].id,$scope.otherName[e]=$scope.otherList[e].lstAttributeOptions[t].optionValue},$scope.filterEnsure=function(){if($scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,""==$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(""==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max&&""!=$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e=$scope.filterParameterArr.join("@"),t=$scope.filterOtherPatam.join(";");$scope.filterArray=e+"@"+t,tabState[2]=$scope.filterArray,$scope.chooseIndex=2,$scope.page=1,$scope.filterModal.hide(),$scope.productList=[],$scope.init()},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:"",max:""},$scope.otherState=[!1,!1];for(var e=$scope.otherList.length,t=0;t<e;t++)$scope.filterOtherPatam[t]=0,$scope.isCurrent[t]=[!0,!1];$ionicScrollDelegate.resize()},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.changeStateFind=function(e,t,o){1==t?GoodsService.changeChooseStateJia($scope.memberId,e,"1").success(function(e,t,s,i){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺上架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺上架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui($scope.memberId,e).success(function(e,t,s,i){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺下架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺下架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))})},$scope.changeStateFindNormal=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺上架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺下架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))})},$scope.showSlideImage=!0,$scope.changeState=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.productList[o].onShelf=!0)}):GoodsService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.productList[o].onShelf=!1)})},$scope.selectTab=function(e){GoodsService.changeSuccess(typeList[e]).success(function(t,o,s,i){1==t.success&&(GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?($scope.otherList=e.data.filterMap.lstAttributes,$scope.resetFilter()):($scope.otherList=[],$scope.resetFilter()))}),$scope.page=1,$scope.selectedIndex=e,0!=$scope.selectedIndex?($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.isFind=!1,$scope.isTab=!0,$scope.productList=[],$scope.requestParam="isHotDesc",$scope.init()):($scope.isFind=!0,$scope.isTab=!1,$scope.findInit()))})},$scope.toggleRight=function(){$ionicSideMenuDelegate.toggleRight()},$scope.chooseIndex=0,$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show(),GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?$scope.otherList=e.data.filterMap.lstAttributes:$scope.otherList=[])});else{if($scope.page=1,$scope.resetFilter(),0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-278+"px",top:"291px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"271px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"291px"}:$scope.comprehensiveSubHeight={height:"auto",top:"271px"});if(1==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=2==$scope.commission_index?1:2,$scope.requestParam=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.productList=[]}else if(3==e)$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.requestParam="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.productList=[];else if(4==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.requestParam=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.productList=[]}$scope.init()}},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.page=1,$scope.loadMore=function(){0==$scope.selectedIndex?$scope.$broadcast("scroll.infiniteScrollComplete"):($scope.page+=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!0))},$scope.loadMoreProducts=function(e,t,o,s,i,a,n,r,c,l,d,p){GoodsService.loadMoreProducts(e,t,o,s,i,a,n,r,c,l,d,p).success(function(e,t,o,s){if(null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=$scope.productList.concat(e.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var i=$scope.productList.length;$scope.hasmore=!(i===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})},$scope.findInit=function(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!1).success(function(e,t,o,s){$scope.data={},$scope.hasFindData=!0,$scope.data=e,$scope.$broadcast("scroll.infiniteScrollComplete")})},$scope.init=function(){$scope.hasmore=!1,$scope.page=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!1)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getSlideImage=function(){GoodsService.getSlideImage().success(function(e,t,o,s){$scope.slideImage=[{},{},{}],$scope.slideImage=e.data.bannersList,$scope.memberId=e.data.memberId,$scope.storeId=e.data.storeId,$ionicSlideBoxDelegate.$getByHandle("selection_slider").update()})},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$scope.getAddress=function(){GoodsService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$ionicModal.fromTemplateUrl("templates/product/SelectionFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success&&$scope.selectTab($scope.selectedIndex)})}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.requestParam="isHotDesc"),$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.init()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.showComprehensiveSub=!1,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),ShopService.getMessage().success(function(e){e.data.count>0?$scope.flagNum=!0:$scope.flagNum=!1}),"back"!=t.direction&&($scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.getSlideImage(),initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0))}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.controller("SpecificationsController",["$scope","spacificationsService","$stateParams","$ionicPopup","$rootScope",function(e,t,o,s,i){e.$on("$ionicView.beforeEnter",function(){e.flag=!1,e.tabNav="selection",e.productId=o.productId,t.doInit(e.productId).success(function(t,o,s,i){null==t.data?e.flag=!0:(e.flag=!1,e.data=t.data.productAttrs)})})}]),APP.service("spacificationsService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={productId:o};return e.get(t.getUrl("ORDERDETAIL_SPECIFICATIONS"),s)}}]),
APP.controller("applyForCardController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.toApplyForCard=function(e){var t=null;1==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11753&pro_code=FHTG107707SJ01HESG":2==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11754&pro_code=FHTG107707SJ01HESG":3==e&&(t="https://xyk.cebbank.com/cebalipay/apply/fz/card-app-status.htm"),window.cordova?3==e?window.emc.presentH5View(t,"查询联名卡进度"):window.emc.presentH5View(t,"联名卡申请"):window.location.href=t}}]),APP.controller("BranchTypeController",["HomePageService","$http","$scope","BranchTypeService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService","ProductDetailService",function(HomePageService,$http,$scope,BranchTypeService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService,ProductDetailService){function getThreeTwoCategory(e){$ionicSlideBoxDelegate.slide(0),BranchTypeService.GetLeftDataList(e).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],s=[],i=0;i<t.data.length;i++)t.data[i].parentId==e&&2==t.data[i].levels?(t.data[i].children=[],o.push(t.data[i])):1==t.data[i].levels&&s.push(t.data[i]);for(var i=0;i<t.data.length;i++)for(var a=0;a<o.length;a++)t.data[i].parentId==o[a].id&&o[a].children.push(t.data[i]);$scope.rightDataList=o,$scope.slideImage=s,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()})}function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),BranchTypeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,s,i,a,n,r,c,l,d){BranchTypeService.getSelectionProducts(e,t,o,s,i,a,n,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.flagNum=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.leftDataList="",$scope.rightDataList="",$scope.leftDataListIndex="0",$scope.ParentParentId="0",$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.iSDataLeftRight=!1,$scope.inntDataList=function(){$scope.tabNav="homePage",ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),BranchTypeService.GetLeftDataList($scope.ParentParentId).success(function(e){e.success&&e.data.length>0?($scope.leftDataList=e.data,getThreeTwoCategory(e.data[$scope.leftDataListIndex].id)):($scope.leftDataList="",$scope.rightDataList="",$scope.iSDataLeftRight=!0)})},BranchTypeService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),$scope.$watch("slideImage",function(){$ionicSlideBoxDelegate.update()}),$scope.learnRsq=function(){window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.showSlideImage=!0,$scope.slideImage=[],$scope.bannerClick=function(e){var t=e.bannerId,o=e.url,s=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.memberId});break;case 2:if(o){var a=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:a,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var n=o.split("=")[1];$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.isFindTab=!0,$scope.selectTab=function(e,t){$scope.leftDataListIndex=t,getThreeTwoCategory(e),$ionicScrollDelegate.$getByHandle("branchtype-right-scroll").scrollTop()},$scope.brenchToChild=function(e){$state.go("branchTypeDetail")};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue;$scope.data={},$scope.tabNav="branchType",$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;BranchTypeService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getAddress=function(){BranchTypeService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,BranchTypeService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success})}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.inntDataList(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start(),$scope.showComprehensiveSub=!1,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.isWdHost=$scope.isBuyer,$scope.dataAdd=null,$scope.defaultValue=null,initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)}),$scope.$on("$destroy",function(){$scope.filterModal&&$scope.filterModal.remove(),$scope.addressModal&&$scope.addressModal.remove()})}]),APP.service("BranchTypeService",["$http","UrlService",function(e,t){this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.GetLeftDataList=function(o){var s={parentId:o,timer:(new Date).getTime()};return e.get(t.getZCUrl("GETNAVIGATIONS"),s)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)}}]),APP.controller("BranchTypeDetailController",["HomePageService","$ionicHistory","$scope","BranchTypeDetailService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(HomePageService,$ionicHistory,$scope,BranchTypeDetailService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}if($scope.attributeId="",$scope.brandId="",$scope.productCateId="",$scope.productCateIdType="0",$scope.filterData="",$scope.filterParams="",$scope.qs="",$scope.switch=!0,$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.storeId="",BranchTypeDetailService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),-1!=$stateParams.productCateId.indexOf("brandId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.brandId=arr[0].split("=")[1],$scope.productCateIdType="1",$scope.filterData="hasStock@"+$scope.brandId+"@0",$scope.productCateId=arr[1].split("=")[1],$scope.qs="isHotDesc"}else if(-1!=$stateParams.productCateId.indexOf("&productCateId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.productCateId=arr[1].split("=")[1],$scope.attributeId=arr[0].split("=")[1],$scope.productCateIdType="2",$scope.filterData="hasStock@all@0@"+$scope.attributeId,$scope.qs="isHotDesc"}else $scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateId=$stateParams.productCateId.split("=")[1],$scope.productCateIdType="0",$scope.qs="isHotDesc";$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.pageIndex="1",$scope.pageSize="5",$scope.memberId=UserService.getUser().mid,$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.locationImgUrltransform90={transform:"rotate(90deg)"},$scope.changeColor={"font-size":"17px"},$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null};var u=navigator.userAgent;-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.$on("$ionicView.beforeEnter",function(e,v){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.userId=UserService.getUser().mid,"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,$scope.searchGoodsName={name:""},BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.streetId=obj[0].streetId,$scope.districtId=obj[0].areaId}$scope.pageIndex=1,$scope.ResGetList()})}if(0==$scope.isBuyer?$scope.storeId=$localstorage.get("storeId","20219251"):$scope.storeId=$scope.userId,$scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}$scope.hasmore=!0}),$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.contentDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),$scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){
if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})}}]),APP.service("BranchTypeDetailService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u){if(d)var g={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateId:l,memberId:d,filterData:p,qs:u,fromType:"1",noLoading:!0};else var g={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateId:l,filterData:p,qs:u,fromType:"1",noLoading:!0,memberId:""};return e.get(t.getUrl("COMMONLOADITEMNEW"),g)},this.getFilterData=function(o){var s={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))}}]),APP.controller("ElectricalMallController",["BannerThemeService","$ionicHistory","$interval","ElectricalMallService","$ionicSlideBoxDelegate","$ionicScrollDelegate","HomePageService","GoodsService","BranchTypeDetailService","$q","$ionicModal","CalculateStrLength","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","LoginService","$localstorage","$rootScope","$stateParams","$ionicPopup","PopupService",function(BannerThemeService,$ionicHistory,$interval,ElectricalMallService,$ionicSlideBoxDelegate,$ionicScrollDelegate,HomePageService,GoodsService,BranchTypeDetailService,$q,$ionicModal,CalculateStrLength,InAppBrowserService,CreditService,ShopService,$scope,$timeout,UserService,$state,LoginService,$localstorage,$rootScope,$stateParams,$ionicPopup,PopupService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}$scope.productCateId="2729",$scope.filterData="",$scope.qs="",$scope.switch=!0,$scope.isListNull=!1,$scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateIdType="0",$scope.qs="isHotDesc",$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.pageIndex="1",$scope.pageSize="5",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.flashHour="",$scope.flashText="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.memberId=UserService.getUser().mid,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.datatypeNameArr=[{productCateId:"2729",name:"空调"},{productCateId:"2725",name:"洗衣机"},{productCateId:"2723",name:"冰箱"},{productCateId:"2743",name:"彩电"},{productCateId:"2741",name:"热水器"},{productCateId:"2742",name:"厨房电器"},{productCateId:"2726",name:"冷柜"},{productCateId:"2973",name:"智能产品"},{productCateId:"2737",name:"生活家电"},{productCateId:"2774",name:"水家电"},{productCateId:"2736",name:"家庭医疗"},{productCateId:"2811",name:"家用中央空调"}],$scope.storeId=UserService.getUser().mid,$scope.countTime={},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.selectedIndex=0,$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($scope.page=2,0==e)return void($scope.showComprehensiveSub=!$scope.showComprehensiveSub);if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.selectTab=function(e){$scope.filterParams="isHotDesc",$scope.qs="isHotDesc",$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.pageIndex="1",$scope.selectedIndex=e,$scope.productCateId=$scope.datatypeNameArr[e].productCateId,$scope.resetFilter(),$scope.filterData="",BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$scope.contentDataList=[],$scope.hasmore=!1,ElectricalMallService.getTopMsg().success(function(e){$scope.bannerList=e.data.topBannerList,$scope.midActivtyList=e.data.midActivtyList,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,getFlashSales(),ElectricalMallService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId,1).success(function(e){$scope.floors=e.data.floors,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),$scope.page=1,$scope.getListInit()}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.backToTop=function(){$ionicScrollDelegate.scrollTo(0,$scope.scrollFixedTop,!0)},$scope.onScroll=function(){$scope.scrollTop=$ionicScrollDelegate.getScrollPosition().top,$scope.scrollFixedTop=$(".scrollFixed")[0].offsetTop,$scope.$apply(function(){$scope.showBackToTopImg=$scope.scrollTop>$scope.scrollFixedTop})},$scope.$on("$ionicView.enter",function(e,t){$(".backToTop").attr("totop",$(".scrollFixed")[0].offsetTop),$("go-top").attr("totop",$(".scrollFixed")[0].offsetTop),ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeEnter",function(e,v){if($scope.showBackToTopImg=!1,GetSwitchChecked(),$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});else{$scope.showFlashSale=!1;var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.areaId=obj[0].areaId}}),$scope.init(),$ionicScrollDelegate.scrollTop()}if($scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}}),$scope.$on("$ionicView.beforeLeave",function(e,t){$interval.cancel($scope.timer),$interval.cancel($scope.timer1)})}]),APP.service("ElectricalMallService",["$http","UrlService",function(e,t){this.getTopMsg=function(){return e.get(t.getNewUrl("ELECTRICALMALL_TOP"))},this.getMiddleMsg=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,street:a,position:n};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),r)}}]),APP.controller("familydetailController",["$scope","$stateParams","$sce",function(e,t,o){e.detailUrl=o.trustAsResourceUrl(t.detailUrl),e.title=t.title,e.goBack=function(){$("#iframecontainer").remove(),e.$ionicGoBack()}}]),APP.controller("familytryController",["$scope","$state",function(e,t){e.gotojianyue=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/",title:"简约风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/","_blank","location=yes")},e.gototianyuan=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/",title:"田园风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/","_blank","location=yes")},e.gotohunda=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/",title:"混搭风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/","_blank","location=yes")},e.gotocity=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/",title:"城市智慧生活"}):window.open("http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/","_blank","location=yes")}}]),APP.controller("furnishController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","furnishService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,furnishService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,furnishService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),furnishService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.EMSearchImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/EMSearch@3x.png",$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.AdornhomeCates[e].id),$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),furnishService.getAdornhomeCates().success(function(e){$scope.AdornhomeCates=e.data,getFurnishAllData($scope.AdornhomeCates[0].id)}),furnishService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),
$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq(0)").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("furnishService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("HomePageController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","HomePageService","ProductDetailService",function($ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,HomePageService,ProductDetailService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel(NowTer),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){e.data.list&&0!=e.data.list.length&&($scope.flashProductList=e.data.list,$scope.systemTime=e.data.systemTime,$scope.systemTime>=$scope.flashProductList[0].startTime&&(NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=$scope.flashProductList[0].endTime&&($interval.cancel(NowTer),getFlashSales())},1e3)),$scope.systemTime<$scope.flashProductList[0].startTime&&(NowTer=$interval(function(){$scope.systemTime+=1e3,$scope.systemTime>=$scope.flashProductList[0].startTime&&($interval.cancel(NowTer),getFlashSales())},1e3)))})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_icon")&&($scope.nowImgIcon=$localstorage.getObject("activity_icon")),"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0,NowTer;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.oldImgIcon={jydq:$rootScope.imgBaseURL+"img/homepageNew/jy.png",jjjz:$rootScope.imgBaseURL+"img/homepageNew/jz.png",bhcs:$rootScope.imgBaseURL+"img/homepageNew/bh.png",shfw:$rootScope.imgBaseURL+"img/homepageNew/sh.png",wddp:$rootScope.imgBaseURL+"img/homepageNew/kd.png",jrlc:$rootScope.imgBaseURL+"img/living.png",gd:$rootScope.imgBaseURL+"img/homepageNew/fl.png",xpzc:$rootScope.imgBaseURL+"img/homepageNew/more.png"},$scope.clickFlag=0,$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.activityColorOld={jydqFontColor:"#666666",jrlcFontColor:"#666666",wddpFontColor:"#666666",bhcsFontColor:"#666666",shfwFontColor:"#666666",jjjzFontColor:"#666666",xpzcFontColor:"#666666",gdFontColor:"#666666"},$scope.activityColor={},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):HomePageService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)locationFlag=!0,-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,locationFlag=!0;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.onScroll=function(){var e=$ionicScrollDelegate.getScrollPosition().top,t=Math.round(e/204*100)/100;$scope.$apply(function(){e<10?($scope.changeOpacity={"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0.30), rgba(255,255,255,0.00))"},$scope.changeColor={color:"#ffffff"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):e<100&&e>=10?($scope.changeOpacity={background:"rgba(255,255,255,"+t+")"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.changeColor={color:"#ffffff"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):($scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.changeColor={color:"#666666"},$scope.searchBg={background:"#e8e8e8",color:"#ffffff"},$scope.changeOpacity={background:"rgba(255,255,255,"+t+")"})})},$scope.init=function(){$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel(NowTer),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="homePage",HomePageService.getActivityIcon().success(function(e){e.data?($localstorage.setObject("activity_icon",e.data.iconImageConfig),$scope.nowImgIcon=e.data.iconImageConfig,e.data.iconFontConfig?($scope.activityColor={},$scope.activityColor=e.data.iconFontConfig):$scope.activityColor=$scope.activityColorOld):($localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld)}).error(function(){$localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld}),HomePageService.getActivityBg().success(function(e){e.data?($scope.homePageActivityBg=e.data,$localstorage.setObject("activity_bg",e.data),e.data.middleImagePart3?$(".sg_notice").removeClass("noActiveBorderTop"):$(".sg_notice").addClass("noActiveBorderTop"),$scope.homePageActivityBg1=$scope.homePageActivityBg.middleImagePart1,e.data.middleImagePart2?($scope.homePageActivityBg2=$scope.homePageActivityBg.middleImagePart2,$scope.homePageActivityBg2Img={background:"url('"+$scope.homePageActivityBg.middleImagePart2.pic+"') left top/100% no-repeat"}):$scope.homePageActivityBg2Img={background:"#ffffff"},$scope.homePageActivityBg3=$scope.homePageActivityBg.middleImagePart3):($(".sg_notice").addClass("noActiveBorderTop"),$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"})}).error(function(){$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"}}),GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),HomePageService.getTopMsg().success(function(e){$localstorage.setObject("homepage_topMsg",e),$scope.bannerList=e.data.topBannerList,$scope.good=e.data.good,$scope.askEvery=e.data.askEvery,$scope.mustBuy=e.data.mustBuy,$scope.wiki=e.data.wiki;var t=e.data.midCommList;$scope.midCommList=t?t.slice(0,2):null,$scope.midActivtyList=e.data.midActivtyList,$scope.midBannerList=e.data.midBannerList,$scope.crowdFunding=e.data.crowdFunding,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200),$scope.$broadcast("scroll.refreshComplete"),$scope.refreshing=!1}),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,HomePageService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.chooseTimer=function(e){$scope.clickFlag=e},$scope.race=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):window.location.href=UrlService.getThirdUrl("race/")})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var c=t+"&openType=h5";window.emc.presentH5View(c,"")}else window.emc.presentH5View(t,"");else if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var l=t+"&openType=h5";window.open(l,"_blank","location=yes")}else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isIosApp="android":$scope.isIosApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isIosApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.$on("$ionicView.enter",function(e,t){ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel(NowTer)}),$scope.settingsList="",$scope.refreshData=function(){$scope.refreshing=!0,GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&$interval.cancel(NowTer)}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()}),$scope.$on("$ionicView.beforeEnter",function(e,t){GetSwitchChecked(),setTimeout(function(){readCache()},0),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.init())})}]),APP.service("HomePageService",["$http","UrlService","MyStoreService","LoginService","$localstorage","UserService",function(e,t,o,s,i,a){this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))},this.isAuthoMid=function(e){o.login(e).success(function(e){a.setUser(e.data),i.set("sg_login_token_secret","Bearer"+e.data.sessionValue),memberId=a.getUser().mid,s.checkOpenStore(memberId).success(function(e){e.data?(s.setRole(1),i.set("storeId",memberId)):(s.setRole(0),i.set("storeId",20219251))})})}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.controller("ImageAndWordController",["$sce","$scope","imageAndWordService","$stateParams","$ionicPopup","$rootScope","$ionicScrollDelegate","$http","$interval",function(e,t,o,s,i,a,n,r,c){t.scrollToTop=function(){n.scrollTop([shouldAnimate=!0])},t.Mp42="",t.Png42="",t.flagMp4=!1,t.$on("$ionicView.beforeEnter",function(){t.productId=s.productId,t.tabNav="selection",t.flag=!1,o.doInit(t.productId).success(function(o,s,i,a){if(o.data.mp4FileId2){t.flagMp4=!0;var n=JSON.parse(o.data.mp4FileId2);t.Mp42=e.trustAsResourceUrl(n.video),t.Png42=n.img}else t.flagMp4=!1;if(o.success)if(null==o.data.detailImgs||0!=o.data.detailImgs.length){t.imagesUrl=e.trustAsHtml(o.data.detailImgs);var r=0,l=0,d=c(function(){if($("div#image-and-word").find("img").length)if(r=$("div#image-and-word").find("img").length,l==r)new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d);else{l=0;for(var e=0;e<r;e++)$("div#image-and-word").find("img")[e].width&&l++;l==r&&(new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d))}},200);t.flag=!1}else t.flag=!0;else t.flag=!0})}),a.$on("$stateChangeStart",function(e,t,o,s,i){if("imageAndWord"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()})}]),APP.service("imageAndWordService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCTDETAIL_PROMOS"),s)}}]),APP.controller("lifeServiceController",["$scope","$ionicHistory","HomePageService","$rootScope","$state","UrlService","PopupService",function(e,t,o,s,i,a,n){e.goToLivingCost=function(){},e.goToEMC=function(){e.isApp?o.isWdHost().success(function(e){if(s.isWdHost=e.data.isHost,-1==e.data.isHost)i.go("login");else{var t=UserService.getUser().accessToken;t?window.emc.presentEmcView(a.getEnviroment(),t,""):n.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")}}):n.showToast("请去顺逛App查看此服务")},e.goBack=function(){t.goBack()}}]),APP.controller("ProductDetailController",["GoodsService","CirclePageService","$localstorage","HomePageService","$interval","$scope","$sce","$stateParams","$rootScope","ProductDetailService","CommonAddressService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","PopupService","$cookies","LoginService","ShopService","$ionicHistory","CreditService","$ionicModal","$http","$ionicScrollDelegate","GetCouponsService","flashService","WhiteShowsService","CartService","$location","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b,A,P,x,L,D,N,_,O){function k(){for(var e=0;e<a.choosedActiveObj.length;e++){for(var t=[],o=0;o<a.choosedActiveObj.length;o++)if(e!=o)for(var s=0;s<a.choosedActiveObj[o].length;s++)1==a.choosedActiveObj[o][s].active&&t.push(a.choosedActiveObj[o][s].sgAttribute.id);for(var i=[],n=0;n<a.sgStoreAttribute.length;n++){for(var r=a.sgStoreAttribute[n].attrValueIds.split(","),c=0,l=0;l<r.length;l++)for(var d=0;d<t.length;d++)t[d]==r[l]&&c++;c==t.length&&(i=i.concat(r))}for(var p=[],u=0;u<i.length;u++){var g=!0;if(0==p.length)p.push(i[u]);else{for(var m=0;m<p.length;m++)p[m]==i[u]&&(g=!1);g&&p.push(i[u])}}for(name in a.StoreAttribute)for(var n=0;n<a.StoreAttribute[name].length;n++){var f=a.StoreAttribute[name];if(f[0].attrName==a.choosedActiveObj[e][0].attrName&&1!=f[n].active){for(var h=!0,v=0;v<p.length;v++)if(f[n].sgAttribute.id==p[v]){h=!1;break}f[n].active=h?2:0}}}}function E(){for(var e=[],t=0;t<a.sgStoreAttribute.length;t++){for(var o=a.sgStoreAttribute[t].attrValueIds.split(","),s=0,i=0;i<o.length;i++)for(var n=0;n<a.attrValueIds.length;n++)a.attrValueIds[n]==o[i]&&s++;s==a.attrValueIds.length&&(e=e.concat(o))}for(var r=[],c=0;c<e.length;c++){var l=!0;if(0==r.length)r.push(e[c]);else{for(var d=0;d<r.length;d++)r[d]==e[c]&&(l=!1);l&&r.push(e[c])}}
for(name in a.StoreAttribute)for(var t=0;t<a.StoreAttribute[name].length;t++){for(var p=a.StoreAttribute[name],u=!1,g=0;g<a.NoActiveObj.length;g++)p[t].attrName==a.NoActiveObj[g][0].attrName&&(u=!0);if(u){for(var m=!0,f=0;f<r.length;f++)if(p[t].sgAttribute.id==r[f]){m=!1;break}p[t].active=m?2:0}}}function U(){for(name in a.StoreAttribute){for(var e=!1,t=0;t<a.StoreAttribute[name].length;t++){var o=a.StoreAttribute[name];1==o[t].active&&(e=!0,a.StoreAttributeActiveList.push(o[t].sgAttribute.attrValueName),a.attrValueIds.push(o[t].sgAttribute.id),a.attrValueNames.join().indexOf(o[t].sgAttribute.attrValueName)<=-1&&a.attrValueNames.push(o[t].sgAttribute.attrValueName))}e&&a.choosedActiveObj.push(a.StoreAttribute[name])}var s=!0;for(name in a.StoreAttribute){for(var t=0;t<a.StoreAttribute[name].length;t++){var o=a.StoreAttribute[name];if(1==o[t].active){s=!1;break}s=!0}s&&a.NoActiveObj.push(a.StoreAttribute[name])}}function M(){for(var e=0;e<8;e++)a.divStrl[e]=12*e+1}function R(){for(var e=0;e<8;e++)a.divStrm[e]=12*e+1}function B(){for(var e=0;e<2;e++)a.divStrt[e]=90*e-8}function H(){var e=N.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&b({method:"POST",url:h.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){f.setUser(e.data),o.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}function F(){l.evalute(a.productId).success(function(e){a.positiveRate=e.data.positiveRate,a.totalNum=e.data.totalNum})}-1!=window.location.href.indexOf("fromCommunity")&&(c.fromCommunity=!0),a.hasProgram=0,a.noFresh=!1,a.remindSuccess=!1,a.hasMoreCoupons=!1;var G,V=1;a.expectTime="",a.commission=null,a.finMoreAct=!1,a.finalPrice="",a.actualPrice="",a.bigActivity=!1,a.getcoupons=!1;var j=0;a.IsShowAttribute="",a.StoreAttribute=null,a.StoreAttributePrice=0,a.StoreAttributNumber="有货",a.StoreAttributeActiveList=[],a.attrValueIds=[],a.attrValueIdsBefore=[],a.attrValueNames=[],a.NoActiveObj=[],a.skku=null,a.openSpecNumberType=null,a.isOpenBottom=!1,a.BottomCartNum="0",a.picAttr="",a.sgStoreAttribute=[],a.serviceProm=[],a.serId="",a.serviceDetail=[],a.AttrswiperImgs=[],a.isAllAttr=!1,a.isAllAttrpic=!1,a.isShowAttrLeftArrow=!1,a.tabNav="selection",a.isBuyer=I.getRole(),a.shareStoreId=r.shareStoreId,a.O2OStoreName="",a.o2oCode="",a.isFromBanner=!1;var z=y.viewHistory().backView;a.userId=f.getUser().mid,a.showShare=!1,a.moreShow=!1,a.isShowBigPic=!1,a.activeSlide=0,a.nowActiveSlide=0,a.isShowLeftArrow=!1,a.isShowService=!1,a.canGetVcode=!0,a.VCodeTips="获取验证码",a.VCodeStyle={color:"#2979FF"},a.Mp41="",a.Png41="",a.flagMp4=!1,a.a=1,a.b=1,a.isPackage=!1,a.message="",a.endT="",a.endTt="",a.endTh="",a.endTm="",a.endTs="",a.startT="",a.startTt="",a.startTh="",a.startTm="",a.startTs="";var W,q,J,Y;a.isShowCopyButton=!1,a.couponList=[],a.giftInfo="",a.stockNumber=null,a.o2oStoreId=null,a.whiteShowsState=1,a.whiteShowsCount=0,a.costInfo=[],a.isWhiteShows=!1,a.whiteShowsMsg="查看更多",a.whiteShowsTit="顺逛白条",a.stockType="",a.flagMP4IconStyle={display:"inline-block"},a.orderInitParams=null,a.iosContentCss={top:"64px"},a.otherContentCss={top:"44px"},a.hardLoading=function(){a.StoreMsgModal.show(),l.getHomeDecorationStoreMsg(a.o2oCode,a.productModel.cityId).success(function(e){e.success&&e.data?a.homeDecorationData=e.data:a.homeDecorationData=[]}).error(function(){a.homeDecorationData=[]})},a.hasProgarmClick=function(){m.go("houseSoluteDetail",{solutionId:a.productId})},a.showWhiteShows=function(){if(!f.getUser().accessToken)return void v.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");var e=null;e=a.productModel.isActivityProduct?a.finalPrice:a.actualPrice,L.cost({token:f.getUser().accessToken,payAmt:e,proGroup:a.productModel.product.department,sku:a.productModel.product.sku}).success(function(e){e.success&&(a.whiteShowsMsg=e.data.feeInfo,a.whiteShowsTit=e.data.feeInfo,a.whiteShowsState=e.data.applyStatus,a.costInfo=e.data.costInfo,1==a.whiteShowsState&&(a.whiteShowsCount=e.data.crdComAvailAmt),a.isWhiteShows=!0),100==e.errorCode&&m.go("login")})},a.hideWhiteShows=function(){a.isWhiteShows=!1},a.clickWhiteShows=function(){2==a.whiteShowsState||3==a.whiteShowsState?m.go("applyForWhite"):0==a.whiteShowsState&&L.applyForOpen({backUrl:window.location.href,userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){e.success&&L.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&m.go("login")})},a.OpenAndClose="modal-Spec-Closes",a.SpecNumberActive=function(e,t){a.StoreAttributeActiveList=[],a.attrValueIds=[],a.attrValueNames=[],a.NoActiveObj=[],a.choosedActiveObj=[];if(0==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=1}else if(1==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=0}else if(2==e.active)return;if(U(),k(),E(),a.attrValueIds.length>0)if(function(e){var t=0;for(var o in e)t++;return t}(a.StoreAttribute)==a.attrValueIds.length)for(var o=0;o<a.sgStoreAttribute.length;o++){for(var s=0,i=0;i<a.attrValueIds.length;i++)a.sgStoreAttribute[o].attrValueIds.indexOf(a.attrValueIds[i])>-1&&s++;s==a.attrValueIds.length&&(a.StoreAttributePrice=a.sgStoreAttribute[o].price,a.StoreAttributNumber="库存"+a.sgStoreAttribute[o].num,a.skku=a.sgStoreAttribute[o].skku,a.picAttr=a.sgStoreAttribute[o].pic,a.stockNumber=a.sgStoreAttribute[o].num)}else a.StoreAttributePrice=a.actualPrice,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.skku=null,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"";else a.StoreAttributePrice=a.actualPrice,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.skku=null,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"";0==a.NoActiveObj.length?a.isAllAttr=!0:a.isAllAttr=!1},a.openSpecNumber=function(e){a.IsShowAttribute&&0==a.NoActiveObj.length&&0!=a.StoreAttributeActiveList.length&&null!=a.skku&&e>1?2==e?(a.openSpecNumberType=2,a.addToCart()):3==e?(a.openSpecNumberType=3,a.buyNow()):4==e?(a.openSpecNumberType=4,a.buyNow()):5==e?(a.openSpecNumberType=5,a.buyNow(1)):6==e?(a.openSpecNumberType=6,a.toNotice()):7==e?(a.openSpecNumberType=7,a.startNotice()):8==e?(a.openSpecNumberType=8,a.nowOrder()):9==e&&(a.openSpecNumberType=9,a.buyNow()):a.IsShowAttribute?(a.isOpenBottom=1==e,1==e?a.openSpecNumberType=1:2==e?a.openSpecNumberType=2:3==e?a.openSpecNumberType=3:4==e?a.openSpecNumberType=4:5==e?a.openSpecNumberType=5:6==e?a.openSpecNumberType=6:7==e?a.openSpecNumberType=7:8==e?a.openSpecNumberType=8:9==e&&(a.openSpecNumberType=9),null==a.StoreAttribute&&l.getSgStoreAttribute(a.productId,a.o2oStoreId,a.productModel.product.sku).success(function(e){if(e.success){for(var t=e.data.sgAttribute,o=e.data.sgStoreAttribute,s=0;s<o.length;s++)a.AttrswiperImgs.push(o[s].pic);for(name in t){j++;for(var s=0;s<t[name].length;s++){t[name][s].active=0}}if(1==j)for(key in t)for(var s=0;s<t[key].length;s++)for(var i=t[key],n=0;n<o.length;n++)i[s].sgAttribute.id==o[n].attrValueIds&&0==o[n].num&&(i[s].active=2);a.StoreAttribute=t;for(var s=0;s<o.length;s++)o[s].num>0&&a.sgStoreAttribute.push(o[s]);U(),E()}}),a.OpenAndClose="modal-Spec-opens",U(),E()):2==e?a.addToCart():3==e?a.buyNow():4==e?a.buyNow():5==e?a.buyNow(1):6==e?a.toNotice():7==e?a.startNotice():8==e?a.nowOrder():9==e&&a.buyNow()},a.closeConfirmModel=function(){if(1!=a.openSpecNumberType)if(null!=a.skku&&0==a.NoActiveObj.length&&0!=a.StoreAttributeActiveList.length);else{for(var e="",t=0;t<a.NoActiveObj.length;t++)e.indexOf(a.NoActiveObj[t][0].attrName)<=-1&&(e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName);if(e)return void v.showToast("请选择"+e)}2==a.openSpecNumberType?a.addToCart():3==a.openSpecNumberType?a.buyNow():4==a.openSpecNumberType?a.buyNow():5==a.openSpecNumberType?a.buyNow(1):6==a.openSpecNumberType?a.toNotice():7==a.openSpecNumberType?a.startNotice():8==a.openSpecNumberType?a.nowOrder():9==a.openSpecNumberType&&a.buyNow(),a.closeSpecNumber()},a.closeSpecNumber=function(){a.OpenAndClose="modal-Spec-Closes"},a.getCartNumFn=function(e){l.getCartNum().success(function(t){t.success&&(a.BottomCartNum=t.data,1==e&&u(function(){v.showToast("加入购物车成功")},200))})};var K=window.innerHeight,Q=K-373+"px";a.storeContentHeight={height:"auto"},a.contentHeight={height:Q};var X=K-373+52+"px";a.storeMsgTop={top:X},a.addressTitle="配送至",a.dataAdd=null,a.flag="PRODUCT_DETAIL_LOCATION",a.defaultValue=null,a.level=0;var Z,ee,te={};a.divStrl=[],a.divStrm=[],a.divStrt=[],a.init=function(){H(),a.showQQ=!1,a.showWeChat=!1,a.isShowCopyButton=!1,a.positiveRate=0,a.totalNum=0,a.skku=null,a.user=f.getUser(),a.iscompleteLoad=!1,a.productId=r.productId,F(),window.cordova?o.get("storeId",c.globalConstant.storeId)==r.storeId?a.storeId=r.storeId:a.storeId=o.get("storeId",c.globalConstant.storeId):r.shareStoreId?(c.shareId=r.shareStoreId,a.storeId=c.shareId):a.storeId=c.shareId?c.shareId:r.storeId,a.o2oType=r.o2oType,a.fromType=r.fromType,0==a.noFresh&&(l.hasProgram(a.productId).success(function(e){e.success?a.hasProgram=e.data:v.showToast(e.message)}),l.loadData(a.productId,a.storeId,a.o2oType,a.fromUrl,a.fromType).success(function(e,o,s,r){function d(e){return e=e<10?"0"+e:e}if(a.iscompleteLoad=!0,a.productModel=e.data,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"",c.addressDefaultMsg={provinceId:a.productModel.provinceId,cityId:a.productModel.cityId,regionId:a.productModel.regionId,streetId:a.productModel.streetId,provinceName:a.productModel.provinceName,cityName:a.productModel.cityName,pcrName:a.productModel.pcrName},c.addressDefMsg=JSON.stringify(c.addressDefaultMsg),window.cordova&&c.gio.track("ProdView",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId}),u(function(){$(".detailEditor .editor").removeAttr("contenteditable"),$(".detailEditor .editor").addClass("copy")},30),a.copyText=a.productModel.product.productFullName+a.productModel.product.productTitle+h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.productModel.storeId+"/"+a.productModel.storeId+"?fs",e.data.mp4FileId1){var p=JSON.parse(e.data.mp4FileId1);a.flagMp4=!0,a.Mp41=n.trustAsResourceUrl(p.video),a.Png41=p.img,a.a=1,a.b=1}else a.a=0,a.b=1,a.flagMp4=!1;a.endT=a.productModel.activityEndTime-a.productModel.activityNowTime,W=i(function(){a.endTt=Math.floor(a.endT/86400),a.endTh=d(Math.floor((a.endT-86400*a.endTt)/3600)),a.endTm=d(Math.floor((a.endT-86400*a.endTt-3600*a.endTh)/60)),a.endTs=d(a.endT-86400*a.endTt-3600*a.endTh-60*a.endTm),-1==--a.endT&&(m.reload(),i.cancel(W),i.cancel(q))},1e3),a.startT=a.productModel.activityStartTime-a.productModel.activityNowTime,q=i(function(){a.startTt=Math.floor(a.startT/86400),a.startTh=d(Math.floor((a.startT-86400*a.startTt)/3600)),a.startTm=d(Math.floor((a.startT-86400*a.startTt-3600*a.startTh)/60)),a.startTs=d(a.startT-86400*a.startTt-3600*a.startTh-60*a.startTm),-1==--a.startT&&(m.reload(),i.cancel(q),i.cancel(W))},1e3),a.productCount=1,a.productModel.subProductImagesList||(a.productModel.subProductImagesList=[]),a.actualPrice=a.productModel.actualPrice,a.StoreAttributePrice=a.actualPrice,a.productModel.isActivityProduct?a.finalPrice=a.productModel.finalPrice:(a.productModel.finalPrice-a.productModel.actualPrice>0&&(a.finMoreAct=!0),a.finalPrice=a.productModel.finalPrice),1==a.productModel.product.onSale&&l.locationChange(a.productModel.product.sku,a.productModel.product.productId,a.productModel.regionId,1,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId).success(function(e,o,s,n){if(a.staticProm=e.data.l,a.hasStock=e.data.hasStock,a.isSupportCOD=e.data.isSupportCOD,a.expectTime=e.data.expectTime,a.commission=e.data.commission,a.commissionRate=e.data.commissionRate,a.finalPrice=e.data.finalPrice,a.actualPrice=e.data.actualPrice,a.StoreAttributePrice=a.actualPrice,a.finMoreAct=a.finalPrice-a.actualPrice>0,a.bigActivity=e.data.bigActivity,a.isB2C=e.data.isB2C,a.freeOrder=e.data.freeOrder,a.halfDay=e.data.halfDay,a.oneDay=e.data.oneDay,2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var r=0;r<a.serviceProm.length;r++)a.serId+=a.serviceProm[r].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[];if(a.isPackage=e.data.isPackage,a.couponList=e.data.sgStoreCouponVoList,a.giftInfo=e.data.giftInfo,a.stockNumber=e.data.stockNum,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.isFlashsales=e.data.isFlashsales,e.data.flashsalesEndTime?a.flashsalesEndTime=new Date(e.data.flashsalesEndTime.replace(/-/g,"/")).getTime():a.flashsalesEndTime=0,a.stockType=e.data.stockType,a.flashsalesEndTime<(new Date).getTime()&&(a.isFlashsales=!1),e.data.o2OStoreInfo&&e.data.o2OStoreInfo.o2OStoreName?(a.showO2OMsg=!0,a.O2OStoreName=e.data.o2OStoreInfo.o2OStoreName,a.avatarImageFileId=e.data.o2OStoreInfo.avatarImageFileId,a.o2oStoreId=e.data.o2OStoreInfo.o2oStoreId,a.O2Omobile=e.data.o2OStoreInfo.mobile,a.O2OStoreCode=e.data.o2OStoreInfo.storeCode,a.o2oCode=e.data.o2OStoreInfo.storeCode,a.O2Omobile?a.showPhoneCall=!0:a.showPhoneCall=!1,a.serviceGrade=e.data.o2OStoreInfo.serviceGrade,a.productGrade=e.data.o2OStoreInfo.productGrade,a.logisticalGrade=e.data.o2OStoreInfo.logisticalGrade):a.showO2OMsg=!1,a.o2oStoreId||(a.o2oStoreId=""),t.getCircleLink(a.productId,a.o2oStoreId,"2").success(function(e){e.success&&(a.topTeam=!0,a.teamUrl=e.data)}),l.getProductCouponsHas(a.productModel.product.sku,a.productModel.product.productId,1,a.actualPrice,a.productModel.storeId,a.o2oStoreId).success(function(e){e.success&&(a.couponListNew=e.data.couponList)}),null==a.o2oStoreId||"null"==a.o2oStoreId)var d="";else var d=a.o2oStoreId;if(l.getIsShowAttr(a.productId,d).success(function(e){e.result?a.IsShowAttribute=!0:a.IsShowAttribute=!1}),window.cordova&&c.gio.track("stockInfo",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock,ReceivingProvince:a.productModel.provinceName,ReceivingCity:a.productModel.cityName,ReceivingDistrict:a.productModel.regionName?a.productModel.regionName.substring(0,a.productModel.regionName.indexOf("/")):"",ReceivingStreet:a.productModel.regionName?a.productModel.regionName.substring(a.productModel.regionName.indexOf("/")+1):""}),"undefined"!=typeof gio&&(gio("track","getAddress",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock?"有货":"无货",ReceivingProvince:a.productModel.provinceName,ReceivingCity:a.productModel.cityName,ReceivingDistrict:a.productModel.regionName?a.productModel.regionName.substring(0,a.productModel.regionName.indexOf("/")):"",ReceivingStreet:a.productModel.regionName?a.productModel.regionName.substring(a.productModel.regionName.indexOf("/")+1):""}),gio("track","ProdView",{productId:a.productModel.product.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId})),window.baifend&&l.getProductCateName(a.productModel.product.productCatePath).success(function(e){var t={uid:a.userId?a.userId+"":"",del:!1,name:a.productModel.product.productFullName,seller_lnk:"/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.storeId+"/",cmp:a.productModel.product.productActivityInfo?a.productModel.product.productActivityInfo:"",typ:"shop",img:a.productModel.product.defaultImageUrl,memp:a.actualPrice,ratecnt:a.totalNum,cat:e.data,brd:a.productModel.product.brandName,stk:a.stockNumber+""};window.baifend.onAddItem(a.productModel.product.sku,t)}),1==a.isFlashsales){a.state=!0;var p=new Date,u=a.flashsalesEndTime,g=p.getTime();if(u<g)a.state=!1;else var f=i(function(){g+=1e3;var e=parseInt((u-g)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime1=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),e<=-1&&(a.state=!1,i.cancel(f),m.reload())},1e3)}a.originalPrice=e.data.originalPrice,a.isAcReserve=e.data.isAcReserve,a.acReserveType=e.data.acReserveType,a.acReserveId=e.data.acReserveId,e.data.acReserveEndTime?a.acReserveEndTime=new Date(e.data.acReserveEndTime.replace(/-/g,"/")).getTime():a.acReserveEndTime=0,a.state1=!0;var h=new Date,v=a.acReserveEndTime,$=h.getTime(),S=i(function(){$+=1e3;var e=parseInt((v-$)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),-1==e&&(G.close(),m.reload(),i.cancel(S),a.state1=!1)},1e3);1==a.isAcReserve&&(1==a.acReserveType&&(a.repur="预约",a.repurNum=e.data.acReserveNum),2==a.acReserveType&&(a.repur="抢购",a.repurNum=e.data.acPurchaseNum))}),g.update()}).error(function(e,t,o,s){v.showToast(e.message)}))},a.nus=function(){if(a.productCount<2)a.productCount=1;else if(!a.isAllAttr&&a.IsShowAttribute){for(var e="",t=0;t<a.NoActiveObj.length;t++)e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName;v.showToast("请选择"+e)}else a.productCount-=1,a.productCount<=a.stockNumber&&(a.hasStock=!0);if(2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var t=0;t<a.serviceProm.length;t++)a.serId+=a.serviceProm[t].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[]},a.plus=function(){if(a.IsShowAttribute)if(a.isAllAttr)a.productCount+=1,a.productCount>a.stockNumber&&(a.hasStock=!1);else{for(var e="",t=0;t<a.NoActiveObj.length;t++)e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName;v.showToast("请选择"+e)}else a.productCount+=1,a.productCount>a.stockNumber&&(a.hasStock=!1);if(2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var t=0;t<a.serviceProm.length;t++)a.serId+=a.serviceProm[t].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[]},a.makeACall=function(){p.confirm({template:a.O2Omobile,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+a.O2Omobile,"_system"):window.open("tel:"+a.O2Omobile))})},c.$on("$stateChangeStart",function(e,t,o,s,i){if("productDetail"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()}),a.slideHasChanged=function(e){for(var t=document.getElementsByTagName("video"),o=0;o<t.length;o++)t[o].pause()},a.seeBigPic=function(e){"attr"==e?(a.isShowAttrLeftArrow=!0,a.isAllAttrpic=!0,a.activeSlide=0,setTimeout(function(){for(var e=a.AttrswiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500)):(a.isShowBigPic=!0,a.isShowLeftArrow=!0,a.flagMp4?a.activeSlide=e:a.activeSlide=e-1,setTimeout(function(){for(var e=a.productModel.swiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500))},a.showBigPic=function(e){a.isShowBigPic=!1,a.isShowLeftArrow=!1},a.showBigPicAttr=function(){a.isShowAttrLeftArrow=!1,a.isAllAttrpic=!1},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},a.addressInit=function(t,o,s,i){if(a.addressTipFlag=!1,A.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=t?JSON.parse(t):{},a.level=i,o){a.dataAdd=JSON.parse(o),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel;for(var n=0;n<a.nowLevelIndex.length;n++)n>a.nowLevel&&(a.nowLevelIndex[n]=-1)}else a.finish=!1,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",e.getLocationList("",0).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel;for(var t=(JSON.stringify(a.defaultValue),JSON.stringify(a.dataAdd),0);t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){v.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var oe=!1;a.goSelect=ionic.Utils.debounce(function(t,o){for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=t;var o=arguments[1],t=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=o.text,a.defaultValue["value"+a.level]=o.value,a.level>-2)-1==a.level&&(a.selectProvince=o.text,a.provinceIndex=t,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=A.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel),ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,e.getLocationList(o.value,ah).success(function(e){1==ah&&(ee=o.value),a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(t,s,a.flag,a.level)}).error(function(e){v.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.citySel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",e.getLocationList(ee,1).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,-1),a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,A.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}).error(function(e){v.showToast("获取地址信息失败！")})};else if(a.level>-4)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,-3==a.level?(a.selectArea=o.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=A.$getByHandle("mainScroll").getScrollPosition().top):a.cityTop=A.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,l.getLocationList(o.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(Z=o.value);var t=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(t,s,a.flag,a.level)}).error(function(e){v.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",l.getLocationList(Z,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),A.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){v.showToast("获取地址信息失败！")})};else{if(oe)return;u(function(){oe=!1},1500),c.$broadcast(a.flag,a.defaultValue),oe=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=c.globalConstant.autoPosition){te=d.getAddressInfo();var e=te.regionName+"/"+te.streetName;l.addAddress(te.provinceId,te.cityId,te.areaId,e,te.streetId).success(function(){var e={"text-1":te.provinceName,"text-2":te.cityName,"text-3":te.regionName,"text-4":te.streetName,"value-1":te.provinceId,"value-2":te.cityId,"value-3":te.areaId,"value-4":te.streetId};c.$broadcast(a.flag,e),a.addressModal.hide()})}},C.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},C.fromTemplateUrl("templates/common/CommonStoreInfo.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.StoreMsgModal=e}),a.closeStoreModal=function(){a.StoreMsgModal.hide()};var se=c.$on("PRODUCT_DETAIL_LOCATION",function(e,o){a.noFresh=!0,a.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+"/"+o["text-4"],a.productModel.provinceId=o["value-1"],a.productModel.cityId=o["value-2"],a.productModel.regionId=o["value-3"],a.productModel.streetId=o["value-4"],c.addressStr=JSON.stringify(o),a.productModel.pcrName&&a.noFresh&&l.locationChange(a.productModel.product.sku,a.productModel.product.productId,a.productModel.regionId,a.productCount,o["value-1"],o["value-2"],a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId).success(function(e,s,n,r){if(a.staticProm=e.data.l,a.o2oCode=e.data.o2OStoreInfo.storeCode,a.hasStock=e.data.hasStock,a.isSupportCOD=e.data.isSupportCOD,a.expectTime=e.data.expectTime,a.commission=e.data.commission,a.commissionRate=e.data.commissionRate,a.finalPrice=e.data.finalPrice,a.actualPrice=e.data.actualPrice,a.StoreAttributePrice=a.actualPrice,a.noFresh=!1,a.iscompleteLoad=!0,a.finMoreAct=a.finalPrice-a.actualPrice>0,a.bigActivity=e.data.bigActivity,a.isB2C=e.data.isB2C,a.freeOrder=e.data.freeOrder,a.halfDay=e.data.halfDay,a.oneDay=e.data.oneDay,2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var d=0;d<a.serviceProm.length;d++)a.serId+=a.serviceProm[d].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[];if(a.isPackage=e.data.isPackage,a.couponList=e.data.sgStoreCouponVoList,a.giftInfo=e.data.giftInfo,a.stockNumber=e.data.stockNum,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.isFlashsales=e.data.isFlashsales,e.data.flashsalesEndTime?a.flashsalesEndTime=new Date(e.data.flashsalesEndTime.replace(/-/g,"/")).getTime():a.flashsalesEndTime=0,a.stockType=e.data.stockType,a.flashsalesEndTime<(new Date).getTime()&&(a.isFlashsales=!1),window.cordova&&c.gio.track("stockInfo",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock,ReceivingProvince:o["text-1"],ReceivingCity:o["text-2"],ReceivingDistrict:o["text-3"],ReceivingStreet:o["text-4"]}),"undefined"!=typeof gio&&gio("track","getAddress",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock?"有货":"无货",ReceivingProvince:o["text-1"],ReceivingCity:o["text-2"],ReceivingDistrict:o["text-3"],ReceivingStreet:o["text-4"]}),1==a.isFlashsales){a.state=!0;var p=new Date,u=a.flashsalesEndTime,g=p.getTime();if(u<g)a.state=!1;else var f=i(function(){g+=1e3;var e=parseInt((u-g)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime1=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),e<=-1&&(a.state=!1,i.cancel(f),m.reload())},1e3)}a.originalPrice=e.data.originalPrice,a.isAcReserve=e.data.isAcReserve,a.acReserveType=e.data.acReserveType,a.acReserveId=e.data.acReserveId,e.data.acReserveEndTime?a.acReserveEndTime=new Date(e.data.acReserveEndTime.replace(/-/g,"/")).getTime():a.acReserveEndTime=0,a.state1=!0;var h=new Date,v=a.acReserveEndTime,$=h.getTime(),S=i(function(){$+=1e3;var e=parseInt((v-$)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),-1==e&&(G.close(),m.reload(),a.state=!1,i.cancel(S))},1e3);1==a.isAcReserve&&(1==a.acReserveType&&(a.repur="预约",a.repurNum=e.data.acReserveNum),2==a.acReserveType&&(a.repur="抢购",a.repurNum=e.data.acPurchaseNum)),e.data.o2OStoreInfo&&e.data.o2OStoreInfo.o2OStoreName?(a.showO2OMsg=!0,a.O2OStoreName=e.data.o2OStoreInfo.o2OStoreName,a.avatarImageFileId=e.data.o2OStoreInfo.avatarImageFileId,a.o2oStoreId=e.data.o2OStoreInfo.o2oStoreId,a.O2Omobile=e.data.o2OStoreInfo.mobile,a.O2Omobile?a.showPhoneCall=!0:a.showPhoneCall=!1,a.serviceGrade=e.data.o2OStoreInfo.serviceGrade,a.productGrade=e.data.o2OStoreInfo.productGrade,a.logisticalGrade=e.data.o2OStoreInfo.logisticalGrade):a.showO2OMsg=!1,t.getCircleLink(a.productId,a.o2oStoreId,"2").success(function(e){e.success&&(a.topTeam=!0,a.teamUrl=e.data)}),l.getProductCouponsHas(a.productModel.product.sku,a.productModel.product.productId,1,a.actualPrice,a.productModel.storeId,a.o2oStoreId||"").success(function(e){e.success&&(a.couponListNew=e.data.couponList)}),l.getIsShowAttr(a.productId,a.o2oStoreId||"").success(function(e){e.result?a.IsShowAttribute=!0:a.IsShowAttribute=!1})})});a.$on("$destroy",function(){se(),se=null}),a.openMore=function(){a.moreShow=!a.moreShow},a.closeCoupons=function(){a.getcoupons=!1,V=1},a.logConpous=function(){l.getShopCoupons(a.productModel.product.productId,a.productModel.product.brandId,a.productModel.product.productCateId,a.productModel.actualPrice,V,5,a.o2oStoreId).success(function(e,t,o,s){e.success?1==V?(V++,a.shopCoupons=e.data,A.$getByHandle("mainScroll").scrollTop(),a.shopCoupons.length<e.totalCount?(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!0):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)):(V++,a.shopCoupons=a.shopCoupons.concat(e.data),a.shopCoupons.length<e.totalCount?(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!0):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)})},a.openCoupons=function(){a.logConpous(),a.getcoupons=!0},a.getNewCoupons=function(e){s.isWdHost().success(function(t){c.isWdHost=t.data.isHost,-1==c.isWdHost?m.go("login"):P.doGetNewCoupons(e).success(function(e){e.success?(c.couponXyzType=!0,A.scrollTop(),V=1,a.logConpous()):(a.remindSuccess=!0,a.message=e.message,setTimeout(function(){a.$apply(function(){a.remindSuccess=!1})},1500))})})},a.goMessageCenter=function(){a.moreShow=!1,m.go("messageCenter")},a.goBack=function(){if("advertisement"==c.fromState)m.go("homePage");else if(0==y.viewHistory().histories.root.cursor&&c.fromCommunity){var e=window.history.length;window.history.go(-(e-c.firstLocationPage+1))}else a.goBackFlag&&(a.goBackFlag=!1,y.goBack())},a.showCopyButton=function(){window.cordova&&(a.isShowCopyButton=!0)},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(){a.showBackBtn=c.fromCommunity||!c.fromCommunity&&0!=y.viewHistory().histories.root.cursor,a.isShowBigPic=!1,a.remindSuccess=!1,a.isWhiteShows=!1,V=1,a.getcoupons=!1,conjs=document.getElementsByClassName("container"),M(),R(),B(),a.goBackFlag=!0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&A.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),a.isIos=!!ionic.Platform.isIOS(),c.isApp=!!window.cordova||void 0,a.shareStoreId=r.shareStoreId,a.userId=f.getUser().mid,a.isBuyer=I.getRole(),a.init(),a.addressInit(a.dataAdd,a.defaultValue,"PRODUCT_DETAIL_LOCATION",0),y.viewHistory().backView&&(z=y.viewHistory().backView,"bannerTheme"!=z.stateName&&"bannerDaily"!=z.stateName||(a.isFromBanner=!0)),a.$on("$destroy",function(){a.addressModal.remove()}),c.addressStr=void 0,J=window.navigator.userAgent.toLowerCase(),Y="micromessenger"==J.match(/MicroMessenger/i),a.getCartNumFn(0)}),a.$on("$ionicView.afterLeave",function(){i.cancel(W),i.cancel(q)}),a.changeState=function(e){
"orderDetail"==z.stateName&&0==a.isBuyer||(1==e?l.changeChooseStateJia(a.productModel.product.productId,"1").success(function(e,t,o,s){a.productModel.onShelf=!a.productModel.onShelf}):l.changeChooseStateDui(a.productModel.product.productId).success(function(e,t,o,s){a.productModel.onShelf=!a.productModel.onShelf}))},a.addToCart=function(){l.checkStockForPay(a.IsShowAttribute?a.skku:"",a.productModel.product.productId,a.productModel.regionId,a.productCount,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId,a.stockType,a.o2oStoreId,a.productModel.storeId).success(function(e,t,o,s){if(!e.data.hasStock)return a.showPopup("库存不足！"),!1;l.addToCart(a.productModel.product.sku,a.productModel.product.productId,a.productCount,"",a.productModel.product.productId,a.skku,a.attrValueNames,a.o2oStoreId,a.productModel.streetId).success(function(e,t,o,s){1==e.success?(window.cordova&&c.gio.track("ScAdd",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId,skku:a.skku,attrValueNames:a.attrValueNames}),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr3","addcart","1"]),a.getCartNumFn(1),a.IsShowAttribute&&(a.productCount=1)):v.showToast("加入购物车失败")})})},a.buyNow=function(e){a.IsShowAttribute?a.orderInitParams={proList:[{proId:a.productModel.product.productId,num:a.productCount,sku:a.skku,name:a.attrValueNames.join()}],street:a.productModel.streetId}:a.orderInitParams={proList:[{proId:a.productModel.product.productId,num:a.productCount}],street:a.productModel.streetId},s.isWdHost().success(function(t){c.isWdHost=t.data.isHost,-1==c.isWdHost?m.go("login"):l.checkStockForPay(a.skku,a.productModel.product.productId,a.productModel.regionId,a.productCount,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId,a.stockType,a.o2oStoreId,a.productModel.storeId).success(function(t,o,s,i){if(!t.data.hasStock&&"1"!=e)return l.loadData(a.productId,a.storeId,a.o2oType,a.fromUrl,a.fromType).success(function(e){if(e.data.product.bookable){p.show({template:'<div style="color: black;text-align: center;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>库存不足，是否去预订?</span></div>',scope:a,buttons:[{text:"否"},{text:"<b>是</b>",type:"button-positive",onTap:function(e){l.buyNow(a.orderInitParams).success(function(e,t,o,s){if(e.success&&e.data){var i=new Date;i.setDate(i.getDate()+1),m.go("orderConfirm",{orderInitParams:JSON.stringify(a.orderInitParams)})}else a.showPopup("操作失败")}).error(function(e,t,o,s){a.showPopup("操作失败！")})}}]})}else a.showPopup("库存不足！")}),!1;l.buyNow(a.orderInitParams).success(function(t,o,s,i){if(t.success&&t.data){window.cordova&&c.gio.track("BuyNow",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId});var n=new Date;n.setDate(n.getDate()+1),"1"===e?S.put("is_book","1",{expires:n,path:"/"}):S.put("is_book","",{expires:n,path:"/"}),m.go("orderConfirm",{orderInitParams:JSON.stringify(a.orderInitParams)})}else"1001"==t.code&&t.success,a.showPopup(t.message)}).error(function(e,t,o,s){a.showPopup("操作失败！")})})})},a.toNotice=function(){p.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>商品名称：</span><span ng-bind="productModel.product.productFullName"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.checkNotice(a.productId,a.user.mobile,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId).success(function(e){if(e.success)if(0===e.result)l.arriveNotice(a.productId,a.user.mobile,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId,a.productModel.product.sku,a.productModel.product.productFullName,a.productModel.provinceName,a.productModel.cityName,a.productModel.regionName,a.o2oStoreId).success(function(e){if(e.success){v.showAlert("","您的资料已经提交，到货后我们会第一时间通知您！")}});else{v.showAlert("","该手机号在该地区已经申请到货通知，不能重复申请！")}})}}]})},a.startNotice=function(){p.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.startNotice(a.productId,a.user.mobile).success(function(e){v.showToast("提交成功！")})}}]})},a.tianJiaShouCang=function(){s.isWdHost().success(function(e){c.isWdHost=e.data.isHost,-1==c.isWdHost?m.go("login"):l.addShouCang(a.productId,a.productModel.product.productName,a.productModel.product.defaultImageUrl,a.productModel.product.sku,a.productModel.pcrName).success(function(e){a.showPopup("收藏成功"),a.productModel.isCollected=!a.productModel.isCollected})})},a.quXiaoShouCang=function(){l.cancelShouCang(a.productId).success(function(e){a.showPopup("取消成功"),a.productModel.isCollected=!a.productModel.isCollected})},a.showPopup=function(e){var t=p.show({template:e});u(function(){t.close()},1e3)},a.customerServe=function(){if(f.isUserLogin())if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&u(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else a.kfTocken=o.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+a.productId+"&storeId="+a.storeId+"&flag="+a.kfTocken);else m.go("login")},a.share=function(){if(!f.getUser().mid)return void m.go("login");if(a.moreShow=!1,window.device&&window.device.hasNewShare){if(!a.productModel)return void a.showPopup("网络连接失败，请稍后分享");a.showShare=!a.showShare}else if(window.umeng){if(!a.productModel)return void a.showPopup("网络连接失败，请稍后分享");var e=a.productModel.product.productFullName,t=a.productModel.product.productTitle||a.productModel.product.productFullName,o=a.productModel.product.defaultImageUrl,s=h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.productModel.storeId+"/"+a.productModel.storeId+"?fs";window.umeng.share(e,t,o,s,0)}},a.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),v.showToastShort("复制成功"),a.isShowCopyButton=!1):v.showToast("请下载APP执行此操作")},a.hideblackCover=function(){a.showShare=!1},a.shareToPlatform=function(e){if(!f.getUser().mid)return void m.go("login");var t=a.productModel.product.productFullName,o=a.productModel.product.productTitle||a.productModel.product.productFullName,s=a.productModel.product.defaultImageUrl,i=h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.userId+"/"+a.userId+"?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,T.shareSuccessCallback),T.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,T.shareSuccessCallback),T.qqShare()),5==e?a.copeText(i):T.successShare()):alert("umeng undefined 只能在app分享"),a.showShare=!1},a.closeRule=function(){a.isShowService=!1},a.openRule=function(){a.isShowService=!0,l.getServicePromise(a.serId).success(function(e){e.success&&(a.serviceDetail=e.data)})},a.open3d=function(){var e=a.productModel.product.vrUrl;window.cordova?c.isIOS?window.emc.presentH5View(e,"3D体验"):m.go("c",{vrUrl:a.productModel.product.vrUrl}):window.open(e)},a.nowOrder=function(){s.isWdHost().success(function(e){c.isWdHost=e.data.isHost,-1==c.isWdHost?m.go("login"):l.checkRes(a.acReserveId,a.productId).success(function(e){if(0==e.success)v.showToast(e.message);else var t=p.show({template:'<div style="text-align: center;color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;">预约信息确认</div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div><div style="text-align: left;color: black;font-size: 12px"><span>验证码：</span><input type="text" ng-model="user.message" style="display: inline;width: 35%;border: solid 1px #ddd;"/><span style="margin-left:8px;padding:4px;background:#d6d7d9" ng-click="getSms()" ng-style="VCodeStyle">{{VCodeTips}}</span></div><div style="text-align: left;color: #666666;font-size: 12px"><p>温馨提示:</p><p>1.我们会向此手机号发送抢购信息通知,请认真填写;</p><p>2.提交后信息不可修改</p><p>3.预约成功不代表购买成功</p></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){return e.preventDefault(),a.globalConstant.mobileNumberRegExp.test(a.user.mobile)?void 0==a.user.message||""==a.user.message?void v.showToast("请输入验证码!"):void l.checkRes(a.acReserveId,a.productId).success(function(e){0==e.success&&v.showToast(e.message),1==e.success&&1==e.data?l.sendRes(a.acReserveId,a.productId,a.user.mobile,a.user.message,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId).success(function(e){0==e.success&&v.showToast(e.message),1==e.success&&1==e.data?(v.showToast('<div style="position:relative;"><img src="img/u93.png"/><span class="myduigou">√</span></div><p>商品预约成功</p><p>可在<b>个人中心-我的预约</b>中查看预约商品</p>'),t.close()):1==e.success&&0==e.data&&v.showToast("预约人数太多,稍后重试")}):1==e.success&&0==e.data&&v.showToast("预约人数太多,稍后重试"),a.user.message=""}):void v.showToast("请输入正确的手机号码！")}}]})})})},a.getSms=function(){if(a.canGetVcode){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.sendSms(a.user.mobile).success(function(e){if(0==e.success)v.showToast(e.message);else{a.canGetVcode=!a.canGetVcode;var t=60;a.timersms=i(function(){t-1<0?(a.VCodeTips="获取验证码",a.VCodeStyle={color:"#2979FF"},i.cancel(a.timersms),a.canGetVcode=!0):(a.VCodeStyle={color:"#666666"},t--,a.VCodeTips="重发 "+t+"s")},1e3)}})}}}]),APP.service("ProductDetailService",["$http","UrlService",function(e,t){this.hasProgram=function(o){var s={channel:1,productId:o};return e.get(t.getNewUrl("HASPROGRAM"),s)},this.locationChange=function(o,s,i,a,n,r,c,l,d){var p={sku:o,prodId:s,regionId:i,number:a,provinceId:n,cityId:r,pcrName:c,memberId:l,streetId:d};return e.get(t.getUrl("LOCATION_CHANGE"),p)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.loadData=function(o,s){var i={storeId:s};return e.get(t.getUrl("PRODUCTDETAIL_LODEDATA")+o+".json",i)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.addToCart=function(o,s,i,a,n,r,c,l,d){if(0==c.length)var c="",r="";var p={sku:o,productId:s,number:i,o2oStoreName:a,o2omap:n,skku:r,attrValueNames:c,o2oAttrId:l,streetId:d};return e.get(t.getUrl("ADDCART_INIT"),p)},this.buyNow=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.addShouCang=function(o,s,i,a,n){var r="productId="+o+"&productName="+s+"&imageUrl="+i+"&sku="+a+"&PCGName="+n;return e({method:"POST",url:t.getUrl("COLLECTION_INIT"),data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.cancelShouCang=function(o){var s="productId="+o;return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.checkNotice=function(o,s,i,a,n,r){var c={productId:o,mobile:s,provinceId:i,cityId:a,areaId:n,streetId:r};return e.get(t.getUrl("CHECK_NOTICE"),c)},this.startNotice=function(o,s){var i={productId:o,mobile:s};return e.get(t.getUrl("START_NOTICE"),i)},this.arriveNotice=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={productId:o,mobile:s,provinceId:i,cityId:a,areaId:n,streetId:r,sku:c,productName:l,provinceName:d,cityName:p,areaName:u,o2oStoreId:g};return e.get(t.getUrl("ARRIVE_NOTICE"),m)},this.getO2OName=function(o,s,i,a,n){var r={sku:o,provinceId:s,cityId:i,regionId:a,streetId:n};return e.get(t.getUrl("GET_O2O_NAME"),r)},this.getMergeImage=function(o,s){var i={productId:o,storeId:s};return e.get(t.getUrl("GET_MERGE_IMAGE"),i)},this.sendSms=function(o){var s={mobile:o};return e.get(t.getNewUrl("GET_SMSS"),s)},this.getShopCoupons=function(o,s,i,a,n,r,c){var l={productId:o,brandId:s,cateId:i,price:a,startIndex:n,pageSize:r,o2oStoreId:c};return e.get(t.getUrl("NEW_SHOP_COUPONS_LIST"),l)},this.getProductCouponsHas=function(o,s,i,a,n,r){var c={sku:o,prodId:s,number:i,finalPrice:a,memberId:n,o2oStoreId:r};return e.get(t.getNewUrl("PRODUCT_COUPONS_HAS"),c)},this.sendRes=function(o,s,i,a,n,r,c,l){var d={acReserveId:o,productId:s,mobile:i,mobileCode:a,provinceId:n,cityId:r,districtId:c,streetId:l};return e.get(t.getNewUrl("SUB_PRESS"),d)},this.checkRes=function(o,s){var i={acReserveId:o,productId:s};return e.get(t.getNewUrl("CHECK_RES"),i)},this.evalute=function(o){return e.get(t.getUrl("EVALUATE_INFO")+o+".json")},this.checkStockForPay=function(o,s,i,a,n,r,c,l,d,p,u,g){if("WA"==p)var m={stockType:p,productId:s,number:a,memberId:l,streetId:d,regionId:i};else if("O2O"==p)var m={stockType:p,productId:s,number:a,memberId:l,streetId:d,o2oStoreId:u,storeCode:g};else var m={stockType:p,productId:s,number:a,memberId:l,streetId:d};return o&&(m=$.extend(m,{sku:o})),e.get(t.getUrl("PAY_CHECK_STOCK"),m)},this.getSgStoreAttribute=function(o,s,i){var a={productId:o,storeId:s,sku:i};return e.get(t.getUrl("GET_GETSGSTOREATTRIBUTE"),a)},this.getDetailAttribute=function(o,s,i,a){var n={productId:o,storeId:s,attrValueIds:i,attrIds:a};return e.get(t.getUrl("GET_GETDETAILATTRIBUTE"),n)},this.getIsShowAttr=function(o,s){var i={productId:o,storeId:s};return e.get(t.getUrl("GET_ISSHOWATTR"),i)},this.getCartNum=function(){return e.get(t.getUrl("GET_CARTNUM"))},this.getHomeDecorationStoreMsg=function(o,s){var i={s:o,c:s};return e.get(t.getUrl("GET_STORE_MSG"),i)},this.getServicePromise=function(o){var s={sid:o};return e.get(t.getUrl("GET_SERVICE_PRO"),s)}}]),APP.controller("productEffectController",["$scope","$stateParams","$sce",function(e,t,o){e.vrUrl=o.trustAsResourceUrl(t.vrUrl)}]),APP.controller("ProductRatedController",["$scope","$stateParams","$rootScope","ProductRatedService","$ionicPopup","$timeout","$ionicScrollDelegate","$state","UserService","UrlService",function(e,t,o,s,i,a,n,r,c,l){function d(t){s.loadData(e.productId,e.pageIndex,e.pageSize,e.assessLevel,t).success(function(t,o,s,i){if(null!=t.data&&0!=t.data.length||1!=e.pageIndex){e.isHasData=!0,e.assessList=e.assessList.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"),e.hasMore=5==t.data.length;for(var a=0;a<e.assessList.length;a++)if(null!=e.assessList[a].experienceTime){var n=e.assessList[a].experienceTime,r=e.assessList[a].createTime,c=(n-r)/1e3,l=parseInt(c/86400);e.assessList[a].dayTime=l>0?l:0}else e.assessList[a].dayTime=0}else e.isHasData=!1})}e.allComment=!0,e.goodComment=!1,e.neutralComment=!1,e.negativeComment=!1,e.havePicComment=!1,e.productId=t.productId,e.assessLevel="all",e.hasPic="",e.pageSize=5,e.pageIndex=1,e.assessList=[],e.assessListDay=[],e.isHasData=!0,e.hasMore=!1,e.productRatedSub={top:"43px"},e.productRatedContent={top:"128px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.productRatedSub={top:"63px"},e.productRatedContent={top:"148px"}),e.isCheckStyle={color:"#fff",background:"#fd4f00"},e.noCheckStyle={color:"#000",background:"#fdebeb"},e.initData=function(){s.getData(e.productId).success(function(t,o,s,i){e.assessData=t.data}),s.getTabData(e.productId).success(function(t,o,s,i){e.markData=t.data}),e.pageIndex=1,e.assessList=[],d(!1)},e.loadMore=function(){e.pageIndex=e.pageIndex+1,d(!0)},e.goBack=function(){e.$ionicGoBack()},e.clickCommentType=function(t){n.scrollTop(),e.allComment="all"==t,e.goodComment="praise"==t,e.neutralComment="neutral"==t,e.negativeComment="poor"==t,e.havePicComment="image"==t,e.assessLevel=t,e.hasPic="",e.pageIndex=1,e.assessList=[],d(!1)},e.showLarge=function(t){e.showBigImage=!0,e.largeImg=t},e.closeImg=function(){e.showBigImage=!1},e.$on("$ionicView.beforeEnter",function(){n.scrollTop(),e.isHasData=!0,e.initData()})}]),APP.service("ProductRatedService",["$http","UrlService",function(e,t){this.getData=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCT_RATED_TOASSESS_LIST"),s)},this.getTabData=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCT_ASSESS_MARK"),s)},this.loadData=function(o,s,i,a,n){var r={productId:o,pageIndex:s,pageSize:i,commentType:a,noLoading:n};return e.get(t.getUrl("PRODUCT_RATED_ASSESS_LIST"),r)}}]),APP.controller("SeeMoreController",["UrlService","$sce","HomePageService","PopupService","$ionicPopup","UrlService","$q","$rootScope","CommonAddressService","AreaService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","SeeMoreService","GoodsService","$localstorage","RegisterService",function(e,t,o,s,i,e,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){var e=a.defer();return ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(t){n.globalConstant.lat=t.latitude,n.globalConstant.lon=t.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),n.globalConstant.positionStatus=!0},function(e){"12"==e.errorCode&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),n.globalConstant.positionStatus=!1}):c.init().then(function(t){n.globalConstant.lat=t.coords.latitude,n.globalConstant.lon=t.coords.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),n.globalConstant.positionStatus=!0},function(e){"1"==e.code&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),n.globalConstant.positionStatus=!1}),e.promise}u.toHomeking=function(){h.homeking().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"好慷在家"):window.location.href=t}else f.go("login")})},u.goToManageMoney=function(){1==n.isWdHost?f.go("financialMoney",{whereId:"seeMore"}):0==n.isWdHost?S.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):s.showToast("服务端错误")}).error(function(){alert("网络错误")}):f.go("login")},u.goToEmc=function(){u.isApp?o.isWdHost().success(function(t){n.isWdHost=t.data.isHost,-1==t.data.isHost?f.go("login"):o.token_get().success(function(t){var o=t.data;o?window.emc.presentEmcView(e.getEnviroment(),o,""):s.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):s.showToast("请去顺逛App查看此服务")},u.openCC=function(t,i){switch(t){case 1:o.isWdHost().success(function(t){n.isWdHost=t.data.isHost,-1==t.data.isHost?f.go("login"):I().then(function(t){var o=e.getCPUrl("SZD_URL"),s=o+"?token="+m.getUser().token+"&alt="+n.globalConstant.lat+"&lng="+n.globalConstant.lon+"&cityCode="+t;window.cordova?window.emc.presentH5View(s,"水之道"):window.open(s,"_blank","location=yes")})});break;case 2:window.cordova?window.emc.presentH5View(i,"游戏头条"):window.open(i,"_blank","location=yes");break;case 3:o.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else{var t="http://m.ehaier.com/v3/mstore/sg/diy/login/request.html?flag="+$.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=t);window.emc.presentH5View(t,"海尔交互定制平台")}});break;case 4:o.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else if(window.cordova){var t=m.getUser().accessToken;window.emc.presentWashView(n.userAccount,n.password,t)}else s.showToast("请去顺逛App查看此服务")});break;case 5:;window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes");break;case 6:var a="http://uhome.haier.net:8470/acbizCms/aircircle/indexAirCircle.do";window.cordova?window.emc.presentH5View(a,"好空气"):window.open(a,"_blank","location=yes");break;case 7:var r="http://linkcook.cn/quanquan/ulist.html";window.cordova?window.emc.presentH5View(r,"馨小厨"):window.open(r,"_blank","location=yes");break;case 8:var c="http://jiuzhidao.com/wap/";window.cordova?window.emc.presentH5View(c,"酒知道"):window.open(c,"_blank","location=yes");break;case 9:var l="http://b2b.haier.com/mobiles/index.html";window.cordova?window.emc.presentH5View(l,"海尔企业购"):window.open(l,"_blank","location=yes");break;case 10:var d="http://www.saywash.com/saywash/WashCallWx/page/index.html";window.cordova?window.emc.presentH5View(d,"社区洗"):window.open(d,"_blank","location=yes")}},u.$on("$ionicView.beforeEnter",function(){window.cordova?u.isApp=!0:u.isApp=!1}),u.goToApplyForCard=function(){o.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):f.go("applyForCard")})}}]),APP.service("SeeMoreService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.homeking=function(){return e.get(t.getNewUrl("GET_homeking"))}}]),APP.controller("superMarketController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.EMSearchImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/EMSearch@3x.png",$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.superMarket_xScroll div").eq(0).width(),s=$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq(0)").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").css({width:o,left:s})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),APP.controller("OrderConfirmSeckillController",["$scope","SeckillService","$stateParams","$rootScope","$state","OrderConfirmSeckillService","$ionicPopup","$timeout","PopupService","CacheService","SeckillDetailService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p){e.htmlContent=o.content,e.title=o.title,e.tabNav="selection",e.searchGoodsName={name:""},e.seckillId,e.numbers,e.productIds,e.invoiceHead=void 0,e.zzsInvoice=void 0,e.isEnd=!1,e.unSale,e.init=function(){if(e.isEnd=!1,t.getServerTime().then(function(t){var s=t.data.data,i=o.beginTime,a=o.endTime,n=p(function(){(s+=1)<i||s>=i&&s<=a||s==i||s>a&&(e.isEnd=!0,p.cancel(n))},1e3)}),e.orderData={},e.htmlContent=o.content,e.title=o.title,e.seckillId=o.seckillId,e.numbers=o.numbers,e.productIds=o.productIds,e.orderConfirmMessage=l.get("seckillOrderInfo"),!e.orderConfirmMessage)throw new Error("订单生成失败,fatal---error");e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle},e.$on("$ionicView.beforeEnter",function(t,o){if("back"==o.direction){var s={isFromInvoices:1};d.seckillBuy(s).success(function(t){1==t.success&&null!=t.data?(e.orderConfirmMessage=t.data,e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle):e.showPopup("订单查询失败 ")}).error(function(e){alert("网络错误")})}else e.init()}),e.toInvoice=function(t){i.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:1})},e.toSubmit=function(){if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))a.toSubmit(e.seckillId).success(function(t,o,s,a){if(1==t.success){var n=JSON.stringify(t.data.order);i.go("afterOrderSubmit",{messageData:n})}else 0==t.success&&e.showPopup(t.message)}).error(function(){alert("网络失败")});else{n.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{n.alert({template:"收货地址必须填写！",okText:"知道了"})}},e.toPayment=function(){i.go("payment")},e.tosendGoodsTime=function(){i.go("sendGoodsTime")},e.showPopup=function(e){var t=n.show({template:e});r(function(){t.close()},1e3)}}]),APP.service("OrderConfirmSeckillService",["$http","UrlService",function(e,t){this.toSubmit=function(o){var s={remark:"",seckillId:o};return e({
method:"POST",url:t.getUrl("SECKILL_CONFIRM_ORDER_INFO"),params:s})}}]),APP.controller("SeckillDetailController",["$scope","$stateParams","$rootScope","ProductDetailService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","SeckillDetailService","CacheService","CommonAddressService","SeckillService","$interval","countdownService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){e.noFresh=!1,e.tabNav="selection",e.isButton=!0,e.countDownMsg="",e.seckillList=[],e.isEnd=!1,e.productId=t.productId,e.message,e.beginTime=t.beginTime,e.endTime=t.endTime,e.unSale,e.init=function(){e.isEnd=!1,g.getServerTime().then(function(t){var o=t.data.data,s=e.beginTime,i=e.endTime,a="",n=m(function(){o+=1,o<s?(a=f.getTime(f.getTimeDif(1e3*s,1e3*o)),e.countDownMsg="距开始"+a):o>=s&&o<=i||o==s?e.countDownMsg="秒杀":o>i&&(e.isEnd=!0,e.countDownMsg="秒杀活动已结束",m.cancel(n))},1e3)}),e.user=c.getUser(),e.iscompleteLoad=!1,e.storeId=t.storeId,e.o2oType=t.o2oType,e.status=t.status,e.fromType=t.fromType,e.front=t.front,e.sku=t.sku,e.seckillId=t.seckillId,e.hasStock=!0,e.memberId="",e.seckillPrice=t.seckillPrice,e.actualPrice,e.pcPrice,e.O2OStoreName,e.hasStock,e.productCount=1,e.swiperImgs=[],e.user&&e.user.mid&&(e.memberId=e.user.mid);var o=u.getAddressInfo(),s={sku:e.sku,prodId:e.productId,regionId:o.areaId,number:1,provinceId:o.provinceId,cityId:o.cityId,pcrName:o.provinceName+" "+o.cityName+" "+o.regionName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId},i={productId:e.productId,storeId:e.storeId,fromUrl:"seckillList",seckillId:e.seckillId,ts:new Date-0};d.seckillDetail(i).success(function(t){0==t.success?e.unSale=!0:(e.productModel=t.data.product,e.productModel.pcrName=t.data.pcrName,e.iscompleteLoad=!0,e.swiperImgs=t.data.swiperImgs,e.actualPrice=t.data.actualPrice,e.pcPrice=t.data.finalPrice,e.O2OStoreName=t.data.O2OStoreName,d.checkStock(s).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1}))}).error(function(e){alert("网络错误")})},o.$on("SECKILL_LOCATION_"+e.productId,function(t,o){if(e.noFresh=!0,e.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+" "+o["text-4"],e.productModel.pcrName){var s={sku:e.sku,prodId:e.productId,regionId:o["value-3"],number:1,provinceId:o["value-1"],streetId:o["value-4"],cityId:o["value-2"],pcrName:e.productModel.pcrName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId};d.checkStock(s).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1})}}),e.goBack=function(){1==e.front?r.go("myStore"):e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()}),e.changeState=function(t){1==t?s.changeChooseStateJia(e.productModel.product.sku,"1").success(function(t,o,s,i){e.productModel.product.onShelf=!e.productModel.product.onShelf}):s.changeChooseStateDui(e.productModel.product.sku).success(function(t,o,s,i){e.productModel.product.onShelf=!e.productModel.product.onShelf})},e.changeArea=function(){r.go("commonLocation",{flag:"SECKILL_LOCATION_"+e.productId})},e.seckillBuy=function(){var t={productIds:e.productId,numbers:1,seckillId:e.seckillId,COOKIE_DOMAIN:"mk",DOMAIN_URL:"http://172.24.1.22",POM_STATIC_DOMAIN_NAME:"http://172.24.1.22/mstatic"};d.seckillBuy(t).success(function(o){1==o.success&&null!=o.data?(p.set("seckillOrderInfo",o.data),r.go("orderConfirmSeckill",{seckillId:t.seckillId,numbers:t.numbers,productIds:t.productIds,beginTime:e.beginTime,endTime:e.endTime})):0==o.success?(e.unSale=!0,e.init()):e.showPopup("立即购买失败")}).error(function(e){alert("网络错误")})},e.tianJiaShouCang=function(){s.addShouCang(e.productId,e.productModel.product.productName,e.productModel.product.defaultImageUrl,e.productModel.product.sku,e.productModel.pcrName).success(function(t){e.showPopup("收藏成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.quXiaoShouCang=function(){s.cancelShouCang(e.productId).success(function(t){e.showPopup("取消成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.showPopup=function(e){var t=i.show({template:e});a(function(){t.close()},1e3)},e.customerServe=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_blank","location=yes"):(e.indexOf("iPhone"),window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"))},e.share=function(){if(!c.getUser().mid)return void h.showToast("请先登录,再分享");if(window.umeng){var t=l.getShareLinkHeader()+"seckillDetail/"+e.productId+"/"+e.o2oType+"/"+e.fromType+"/"+e.storeId+"/"+e.front+"/"+e.seckillPrice+"/"+e.seckillId+"/"+e.sku+"/"+e.status+"/"+e.beginTime+"/"+e.endTime+"/"+c.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀商品,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}}]),APP.service("SeckillDetailService",["$http","UrlService",function(e,t){this.checkStock=function(o){var s=t.getUrl("CHECK_STOCK");return e.get(s,o)},this.seckillDetail=function(o){if(!o.productId)return void alert("无productId error");var s=t.getUrl("SECKILLDETAIL")+o.productId+".html";return e.get(s,o)},this.seckillBuy=function(o){var s=t.getUrl("SECKILLBUY");return e.get(s,o)}}]),APP.controller("SeckillListController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","SeckillService","$localstorage","UserService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d){function p(e){var t=new Date(e),o=(t.getFullYear(),t.getMonth()+1);o=o<10?"0"+o:o;var s=t.getDate();s=s<10?"0"+s:s;var i=t.getHours();i=i<10?"0"+i:i;var a=t.getMinutes();a=a<10?"0"+a:a;var n=t.getSeconds();return n=n<10?"0"+n:n,o+"月"+s+"日"+i+":"+a+":"+n}e.storeId,e.seckillStatus=0,e.seckillList=[],e.timer=void 0,e.curTime,e.timeDiff,e.isNull;e.init=function(){e.isNull=!1,e.seckillList=[];var o=c.get("storeId",t.globalConstant.storeId);e.storeId=o,r.getServerTime().error(function(){alert("网络失败")}).then(function(t){var o=t.data.data;e.serverMs=1e3*o;new Date(e.serverMs);return r.getSeckillList()}).then(function(t){function o(e,t){return e-t}if(!t)return e.ponitList=[],void alert("网络失败");e.seckillList=t.data.data,0==e.seckillList.size&&(e.isNull=!0),e.ponitList=[],angular.forEach(e.seckillList,function(t,o){t.beginStr=p(1e3*t.beginTime),t.endStr=p(1e3*t.endTime),t.status=void 0,e.serverMs<1e3*t.beginTime?(t.status=1,e.ponitList.push(1e3*t.beginTime-e.serverMs)):e.serverMs>=1e3*t.beginTime&&e.serverMs<=1e3*t.endTime?(e.ponitList.push(1e3*t.endTime-e.serverMs),t.status=2):e.serverMs>1e3*t.endTime&&(t.status=3),angular.forEach(t.sgSeckillItemFormList,function(e,o){e.beginTime=t.beginTime,e.endTime=t.endTime})}),e.ponitList.sort(o),e.ponitList[0]&&(e.timer=i(function(){e.init()},e.ponitList[0]>36e5?36e5:e.ponitList[0]))},function(t){alert("网络失败"),e.isNull=!0})},e.toDetail=function(e,t){s.go("seckillDetail",{productId:e.productId,o2oType:0,fromType:4,storeId:o.storeId,front:0,sku:e.sku,seckillPrice:e.seckillPrice,seckillId:e.seckillId,status:t,beginTime:e.beginTime,endTime:e.endTime})},e.$on("$ionicView.beforeEnter",function(t,o){e.init()}),e.$on("$ionicView.beforeLeave",function(t,o){i.cancel(e.timer)}),e.doRefresh=function(){i(function(){e.init(),e.$broadcast("scroll.refreshComplete")},1e3)},e.share=function(){if(!l.getUser().mid)return void d.showToast("请先登录,再分享");if(window.umeng){var e=a.getShareLinkHeader()+"seckillList/"+l.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}}]),APP.service("SeckillService",["$http","UrlService",function(e,t){this.getSeckillList=function(){var o=t.getUrl("SECKILL_LIST");return e.post(o)},this.getSeckillDetail=function(e){t.getUrl("SECKILL_LIST",e)},this.getServerTime=function(o){var s=t.getUrl("SECKILL_SERVICE_TIME",o);return e.get(s)}}]),APP.directive("countdown",["$timeout","countdownService",function(e,t){return{restrict:"E",template:"<i>{{time.dd}}</i> <span>天</span> <i>{{time.hh}}</i>{{type}}<i>{{time.mm}}</i>{{type}}<i>{{time.ss}}</i>",link:function(o,s,i){function a(s){if(n>0&&s>0){var d=new Date-0+r,s=c-d;o.time=t.changeMs2Time(s),l=e(function(){a(s)},1e3)}else i.callback?(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o[i.callback](i.callbackparam)):(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o.callback())}o.type=i.type||":";var n,r,c,l=void 0;Math.random();if(!i.endtime)return!1;i.endtime&&i.curtime&&(c=t.formatTime2Ms(i.endtime),i.curtime?(n=t.getTimeDif(i.endtime,i.curtime),r=i.curtime-new Date-0,a(1)):t.getCurrTime().then(function(e){i.curtime=e.data,n=t.getTimeDif(i.endtime,i.curtime),r=i.curtime-new Date-0,a(1)}))},controller:["$scope",function(e){e.callback=function(){},e.$on("$destroy",function(){})}]}}]),APP.factory("countdownService",["$http",function(e){return{getTimeDif:function(e,t){return this.formatTime2Ms(e)-this.formatTime2Ms(t||new Date)},formatTime2Ms:function(e){return e?Date.parse(e.toString().replace(/-/g,"/"))||e:0},changeMs2Time:function(e){if(!e||parseInt(e)<0)return{dd:"00",hh:"00",mm:"00",ss:"00"};var t=parseInt(e/864e5),o=t<10?"0"+t:t;e=parseInt(e%864e5);var s=parseInt(e/36e5),i=s<10?"0"+s:s;e-=36e5*s;var a=parseInt(e/6e4),n=a<10?"0"+a:a;e-=6e4*a;var r=parseInt(e/1e3);return{dd:o,hh:i,mm:n,ss:r<10?"0"+r:r}},getTime:function(e,t){var o=this.changeMs2Time(e);return t=t||":",":"==t?o.dd+"天"+o.hh+":"+o.mm+":"+o.ss:o.dd+"天"+o.hh+"时"+o.mm+"分"+o.ss+"秒"},getCurrTime:function(){return e.post("/currTime")}}}]),APP.controller("AllCircleController",["HomePageService","$scope","$rootScope","$state","$ionicScrollDelegate","$ionicPopup","PopupService","AllCircleService","$ionicSlideBoxDelegate","$timeout","UserService","$ionicModal",function(e,t,o,s,i,a,n,r,c,l,d,p){t.isDisplay=!1,t.moreTag=!1,t.hasmore=!0,o.toFilterCode="",t.scrollMainTop=function(){i.$getByHandle("allMainScroll").scrollTop([!0])},t.searchTag={searchKey:"",tagSearch:"",pageIndex:1,pageSize:10},t.tagsName=[],t.circleList="",t.search=function(e){},t.goBack=function(){t.$ionicGoBack()},t.inPersonalPage=function(e){s.go("personalHomepageHe",{othersId:e})},t.goShop=function(){s.go("myStore",{storeId:t.userId,shareStoreId:""})},t.toFilterTagSearch=function(){o.toFilterCode=1,s.go("qSearchBiao")},t.isClick=function(){t.isDisplay=!t.isDisplay},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&i.scrollTop(),i.resize()},t.jumpMsgCenter=function(){s.go("ClassifyMessageCenter")},t.getCircleLists=function(){t.pageNum=1;var e={pageIndex:t.pageNum,pageSize:10,tagIds:""};r.filterCircle(e).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList}).error(function(){})},t.tagsFilter=function(e,o,s){if(t.moreTag=!1,t.pageNum=1,t.searchId=e,1==s)t.tagsName[o].isChecked=!1,t.init(),i.$getByHandle("allMainScroll").scrollTop();else{angular.forEach(t.tagsName,function(e){e.isChecked=!1}),t.tagsName[o].isChecked=!0;var a={pageIndex:1,pageSize:5,tagIds:e};r.filterCircle(a).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList,i.$getByHandle("allMainScroll").scrollTop()}).error(function(){})}},t.toCirclePage=function(e){s.go("circlePage",{circleId:e})},t.toApplyCircle=function(e){t.showNum=e,r.existApplyingCircle().success(function(e){e.success?(s.go("applyCircle"),delete o.reviewCircleId):t.applyCircleModal.show()}).error(function(){})},t.getTags=function(){var e={topicId:"",noLoading:!0};r.getTags(e).success(function(e){t.tagsName=e.data.list})},t.joinCircle=function(i){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)s.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:i.id}),o.gio.track("active",{circleID:i.id})),t.itemTopicName=i.topicName;var a={ids:i.id,noLoading:!0};r.joinTopic(a).success(function(e){1==e.success?(i.isJoin=1,1==e.success?(t.inCircle=!0,l(function(){t.inCircle=!1},1e3)):n.showToast(e.message)):-2e3==e.errorCode&&(n.showToast(e.message),o.loginIsAccord2=!0)})}})},t.loadMore=function(){t.pageNum+=1;var e={tagIds:t.searchId?t.searchId:"",pageIndex:t.pageNum,pageSize:5};r.getTopicList(e).success(function(e){e.data.list.topicList&&0!=e.data.list.topicList.length?l(function(){t.totalCount=e.totalCount,t.circleList=t.circleList.concat(e.data.list.topicList),t.$broadcast("scroll.infiniteScrollComplete");var o=t.circleList.length;t.hasmore=!(o==e.totalCount),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.hideApplyCircleModal=function(){t.applyCircleModal.hide()},t.getTitleList=function(){r.getTopicTitleList().success(function(e){if(e.success){t.titleList=e.data.list,t.itemTopicList(t.titleList[0].id,0);for(var o=0;o<t.titleList.length;o++)t.titleList[o].className=""}})},t.itemTopicList=function(e,o){var s={categoryId:e};r.getTopicSecondList(s).success(function(e){if(e.success){for(var s=0;s<t.titleList.length;s++)t.titleList[s].className="";t.titleList[o].className="bac",t.secondList=e.data.list}})},t.init=function(){t.titleList=[],t.secondList=[],t.userId=d.getUser().mid,p.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.applyCircleModal=e}),t.pageNum=0,t.getTitleList(),t.getCircleLists(),t.getTags(),t.searchId="",t.moreTag=!1,t.isDisplay=!1,t.hasmore=!0,t.circleList=[],i.$getByHandle("allMainScroll").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||($("ion-header-bar").show(),t.init())})}]),APP.service("AllCircleService",["$http","UrlService",function(e,t){this.getUserMessageCount=function(){return e.post(t.getUrl("GETUSERMESSAGECOUNT"))},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.getTopicTitleList=function(){return e.get(t.getUrl("CIRCLE_GET_CIRCLE_LIST"))},this.getTopicSecondList=function(o){return e.get(t.getUrl("CIRCLE_GET_SECONDLIST"),o)},this.getTopicList=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.filterCircle=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.existApplyingCircle=function(o){return e({method:"POST",url:t.getUrl("EXIST_APPLY_TOPIC"),data:o})}}]),APP.controller("AllMembersController",["$scope","$state","$stateParams","AllMembersService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,s,i,a,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.noDisplay=function(){e.isDisplay=!1},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.goBack=function(){t.go("circlePage",{circleId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(o){e.isDisplay=!1,t.go("personalHomepageHe",{othersId:o})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.isClick=function(){e.isDisplay?e.isDisplay=!1:e.isDisplay=!0},e.toSetAdmin=function(){"true"==e.isHost||"true"==e.superAdmin?t.go("CircleSetAdmin",{topicId:e.topicId}):(e.isDisplay=!1,a.showToast("您不是圈主，不能进行此操作"))},e.toManageUser=function(){"true"==e.isAdmin||"true"==e.isHost||"true"==e.superAdmin?t.go("manageUser",{topicId:e.topicId}):(e.isDisplay=!1,a.showToast("您不是圈主或管理员，不能进行此操作"))},e.init=function(){e.isDisplay=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.hasmore=!1;var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},s.getuserlist(t).success(function(t){e.isAdmin=t.data.ifAdmin,e.isHost=t.data.ifHost,e.superAdmin=t.data.isManager,e.mainuserlist=t.data.list1,e.mainuser2list=t.data.list2,e.userNum=t.totalCount,e.userlist=t.data.list,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.mainuserlist=t.data.list1,e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list),e.$broadcast("scroll.infiniteScrollComplete");var o=e.userlist.length;e.hasmore=!(o===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("AllMembersService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)}}]),APP.factory("anchorScroll",function(){function e(e,o,s){var i=$(window).height();e=$(e),s=s>0?s:i/10,$("html, body").animate({scrollTop:o?e.offset().top-s:e.offset().top+e.outerHeight()+s-i},{duration:200,easing:"linear",complete:function(){t(e)||e[0].scrollIntoView(!!o)}})}function t(e){function t(e){return e>n&&e<r}e=$(e);var o=$(window),s=o.height(),i=e.offset().top,a=e.outerHeight(),n=o.scrollTop(),r=n+s;return!!t(i+(a>s?s:a)/2)||a>s&&t(i+a-s/2)}return{toView:e,inView:t}}),APP.controller("ApplyCircleController",["$scope","$rootScope","$state","ApplyCircleService","PopupService","$ionicActionSheet","$timeout","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$ionicModal","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,c){e.userPicUrl="",e.bigPicUrl="",t.storeId=[],t.nameStringToObj=[],t.addedTags=[],e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:2,topicId:""},e.init=function(){1==t.showApplyTag?e.showApplyBtn=!1:e.showApplyBtn=!0,d.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyCircleModal=t}),1==t.ifInit?(e.tagsName=t.allNames,t.ifInit=2):(e.topicId="",e.auditRefuseStatus="",t.allNames="",t.addedTags=[],t.nameStringToObj=[],t.frequentTags="",e.tagsName="",t.reviewCircleId&&(e.reviewApplyCircle(),e.getTags()),e.auditOpinion="",c.resize())},e.goBack=function(){e.$ionicGoBack(),t.showApplyTag="",delete t.reviewCircleId},e.warnDelete=function(o){e.isDisplay=!1;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除草稿吗？</div>',title:"删除草稿",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.deleteDraftCircle()}},{text:"放弃"}]});n(function(){},3e3)},e.hideApplyCircleModal=function(){e.applyCircleModal.hide()},e.openStatus=function(t){e.auditOpinion[t].open_status=!e.auditOpinion[t].open_status},e.jumpSelect=function(){o.go("selectTags")},e.deleteDraftCircle=function(){var o={id:t.reviewCircleId};s.delectDraft(o).success(function(o){o.success&&(delete t.reviewCircleId,e.$ionicGoBack())})},e.imgPush=function(t){a.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function i(t){e.userPicUrl=t,n(function(){e.existPhoto=!0},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.userPicUrl,encodeURI(s.uploadImage()),o,i,a)}function a(){}function c(t){e.userPicUrl=t,e.existPhoto=!0,n(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.userPicUrl,encodeURI(s.uploadImage()),o,i,a)}return 0==t?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(c,a,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.imgBigPush=function(t){a.show({buttons:[{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function i(t){e.applyData.topicBgImg="",e.bigPicUrl=t,e.existPhoto=!0,n(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicBgImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.bigPicUrl,encodeURI(s.uploadImage()),o,i,a)}if(0==t)return navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:640,targetHeight:180}),!0}})},e.deleteTags=function(e){t.addedTags.splice(e,1)},e.deleteFrequentTags=function(e,o){for(var s=0;s<t.frequentTags.length;s++)t.frequentTags[s].name==o&&(t.frequentTags[s].isChecked=!1);t.storeNames.splice(e,1),t.storeId.splice(e,1),t.nameStringToObj.splice(e,1)},e.commitData=function(){var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};s.judgeWords(o).success(function(a){if("没有敏感词"==a.message){var r=e.applyData;r.tagIds=t.storeId.toString(),e.pushTags=[];for(var c=0;c<t.addedTags.length;c++)e.pushTags.push(t.addedTags[c].name);r.tagNames=e.pushTags.toString(),3==e.darftStatus?(r.auditStatus=2,s.storageDraft(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})):t.reviewCircleId?s.refuseStorage(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){}):s.applyCircleInfo(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})}else i.showToast("存在敏感词"+a.data)}).error(function(){})},e.applyTopicNotice=function(){l.show({template:"<p>确认提交圈子申请吗？</p>",title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>提交</span>",type:"",onTap:function(){e.commitData()}}]});n(function(){},3e3)},e.applyTopic=function(o){e.userPicUrl?""==e.applyData.topicImg?i.showToast("图片正在上传，请稍后再试"):e.bigPicUrl&&""==e.applyData.topicBgImg?i.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?i.showToast("申请理由不能少于20字"):t.nameStringToObj.length+t.addedTags.length<3?i.showToast("选择标签不能少于三个"):e.applyTopicNotice():i.showToast("请输入圈子申请理由"):i.showToast("请输入圈子介绍"):i.showToast("请输入圈子名称"):i.showToast("亲，你没有设置背景图哦"):i.showToast("亲，你没有设置头像哦"):e.bigPicUrl&&""==e.applyData.topicBgImg?i.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?i.showToast("申请理由不能少于20字"):e.applyTopicNotice():i.showToast("请输入圈子申请理由"):i.showToast("请输入圈子介绍"):i.showToast("请输入圈子名称"):i.showToast("亲，你没有设置背景图哦"):i.showToast("亲，你没有设置头像哦")},e.$on("$ionicView.beforeEnter",function(o,s){"back"===s.direction?e.init():(e.init(),e.userPicUrl="",e.bigPicUrl="",e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:e.topicId?3:2,topicId:t.reviewCircleId?t.reviewCircleId:""})}),e.reviewApplyCircle=function(){var o={topicId:t.reviewCircleId};s.reviewEditApply(o).success(function(t){e.darftStatus=t.data.list.auditStatus,e.topicId=t.data.list.id,e.auditRefuseStatus=t.data.list.auditStatus,e.applyData.topicImg=t.data.list.topicImg,e.applyData.topicBgImg=t.data.list.topicBgImg,e.bigPicUrl=t.data.list.topicBgImg,e.userPicUrl=t.data.list.topicImg,e.applyData.topicName=t.data.list.topicName,e.applyData.topicDescription=t.data.list.topicDescription,e.applyData.topicReason=t.data.list.entryReason,e.auditOpinion=t.data.list.auditHistory,c.resize()}).error(function(){})},e.getTags=function(){var o={id:t.reviewCircleId};s.getTags(o).success(function(o){e.tags=o.data.list;for(var s=0;s<e.tags.length;s++)if(e.tags[s].approval){var i={name:e.tags[s].name};t.addedTags.push(i)}else{var a={name:e.tags[s].name};t.nameStringToObj.push(a)}})},e.storageDraft=function(){if(!(e.applyData.topicImg||e.applyData.topicBgImg||e.applyData.topicName||e.applyData.topicDescription||e.applyData.topicReason||e.applyData.topicReason))return void i.showToast("亲，请至少填一项哦");var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};e.applyData.auditStatus=3,s.judgeWords(o).success(function(o){if("没有敏感词"==o.message){var a=e.applyData;a.tagIds=t.storeId.toString(),e.pushTags=[];for(var r=0;r<t.addedTags.length;r++)e.pushTags.push(t.addedTags[r].name);a.tagNames=e.pushTags.toString(),e.topicId&&3==e.auditRefuseStatus?s.storageDraft(a).success(function(t){0==t.success?i.showToast(t.message):(e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):1==e.auditRefuseStatus?s.refuseStorage(a).success(function(t){0==t.success?i.showToast(t.message):(e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):s.applyCircleInfo(a).success(function(o){0==o.success?i.showToast(o.message):(t.reviewCircleId=o.data,e.auditRefuseStatus=3,e.topicId=o.data,e.applyData.topicId=o.data,e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){})}else i.showToast("存在敏感词"+o.data)}).error(function(){})}}]),APP.service("ApplyCircleService",["$http","UrlService",function(e,t){this.applyCircleInfo=function(o){return e({method:"POST",url:t.getUrl("APPLY_TOPIC"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})},this.reviewEditApply=function(o){return e({method:"POST",url:t.getUrl("REVIEW_APPLY_TOPIC"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.storageDraft=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_DRAFT"),data:o})},this.delectDraft=function(o){return e({method:"POST",url:t.getUrl("DELETE_APPLY_TOPIC_DRAFT"),data:o})},this.refuseStorage=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_REFUSE"),data:o})}}]),APP.controller("CircleGroupDiscussController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService","$q","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId=tlz55&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},S,I)}function $(e){alert("得到图片失败")}function S(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.groupMsg="图片文件",o.data.imageUrl=s,o.data.fileType=".jpg",o.data.groupMsgUserId=e.csId,o.data.timeStamp=new Date-0,o.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss");var i={c:"sendGroupMsg",groupId:e.groupId,msg:s,msgType:1,token:e.token};r.sendMsg(i).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(o.data)}else l.showToast("发送消息失败--发送音频后")},function(e){})}function I(e){alert("上传失败")}function w(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function y(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.circleId,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode},e.toShareListPage=function(e){i.go("shareListPage",{sl:e})};var T=c.getUser();e.groupId,e.chatId=e.groupId,e.row=0,e.token=c.getUser().sessionValue,e.isClick=function(t){t?e.isDisplay=!e.isDisplay:i.go("discussionGroup",{groupId:e.groupId,circleId:e.circleId})},e.toMemberList=function(){i.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.isSchool=!0,e.sgdMode=2,e.toggleMode=function(t){e.sgdMode=t},e.init=function(){},e.noMoreHistory=!1,e.getMsgByMun=function(){if(!e.noMoreHistory){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};r.getMsgByMun(t).success(function(t){if(t)if(t.rows&&angular.isArray(t.rows)){for(var o=0;o<t.rows.length;o++)r.filtMsg(t.rows[o]);e.messages=t.rows.concat(e.messages),t.rows.length<1e3&&(e.noMoreHistory=!0)}else consoel.warn("sg--getMsgByMun-- response  not array !! ");else l.showToast("获得 讨论组 历史聊天记录 失败")}).finally(function(){e.$broadcast("scroll.refreshComplete")})}},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=f.defer(),o=0==e.messages.length?1:0,s={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token,row:e.row,isSelf:o};return r.getMsg(s).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++)o.data.msgs[s].groupMsg&&(r.filtMsg(o.data.msgs[s]),e.messages.push(o.data.msgs[s]));e.row=o.data.row,t.resolve(1)}else t.reject(1)},function(e){alert(e)}),t.promise},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};e.CustumerParam.msg||l.showToast("发送的消息不能为空"),r.sendMsg(t).then(function(o){if(o){if(o.data&&103==o.data.rt)return void l.showToast("您已经被禁言，请联系管理员");var s={groupMsg:t.msg,groupMsgUserId:e.csId,groupMsgUserName:T.nickName,sendTimes:(new Date).pattern("yyyy-MM-dd hh:mm:ss")};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=""}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.getImg=function(e){p.getPicture(e,v,$)},e.play=function(){var e=document.getElementById("audioInCD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){
p.startCapture("sourceInCD","audioInCD")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),p.stopCapture("sourceInCD","audioInCD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},C,b)};var C=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,s.data.groupMsg="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.groupMsgUserId=e.csId,s.data.timeStamp=new Date-0,s.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss"),e.deleteRecord();var i={c:"sendGroupMsg",groupId:e.groupId,msg:o,msgType:1,token:e.token};r.sendMsg(i).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(s.data)}else l.showToast("发送消息失败--发送音频后");e.loopGetMsg()},function(e){})},b=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");e.isPlaying||a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:A})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.chooseOne=function(e){e.isSelected=!e.isSelected},e.shareToGroup=function(){var t=[];angular.forEach(e.messages,function(e,o){e.isSelected&&t.push(e)});var o="讨论组名称$share"+JSON.stringify(t);i.go("groupsToShare",{shareList:o})},e.deleteGroupMsg=function(){},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o;var a=c.getUser();e.csId=a.mid,e.init(),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",w),window.addEventListener("native.keyboardhide",y),p.addAudioEventOnWindow(),e.groupId=s.groupId,e.circleId=s.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),"back"==i.direction?e.loopGetMsg():(e.messages=[],e.groupId=61,e.loopGetMsg())});var A=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(t,o){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",w),window.removeEventListener("native.keyboardhide",y),e.killTimer()}),e.goBack=function(){e.isPlaying||e.$ionicGoBack()}}]),APP.service("CircleGroupDiscussService",["$http","UrlService","$sce",function(e,t,o){function s(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+i[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+i[t]+'.png" />')}this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.getAllMsg=function(t){return e({method:"POST",url:"http://123.56.3.136:8181/api/invoke",params:t})},this.getMsgByMun=function(t){return e({method:"POST",url:"http:///123.56.3.136:8180/Service/chatGroup/queryPageGroupMsg",params:t})},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.sendTimes&&(e.timeStamp=new Date(e.sendTimes)-0),e.groupMsg&&e.groupMsg.indexOf("$share")>-1){var t=e.groupMsg.indexOf("$share"),o=e.groupMsg.substring(0,t),i=e.groupMsg.substring(t+6),a=/\\/g;i=i.replace(a,"");var n=JSON.parse(i),r=0;angular.isArray(n)&&(r=n.length);e.shareMsgsList=n,e.fileType="share",e.shareMsgsLength=r,e.from=o}else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.groupMsg;else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.groupMsg;else if(e.groupMsg.indexOf("[")>-1&&e.groupMsg.indexOf("]")>-1)for(var c=1;c<16;c++)e.groupMsg=s(e.groupMsg,c)};var i=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];new Date,new Date("2014-8-4 10:21:12")}]),APP.directive("resizeFootBarcd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-cd"),a=e.$getByHandle("cdScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]);var sm={groupMsg:'飞机飞啊飞哇$share[{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav\\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:22\\",\\"isSelected\\":true},{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav\\",\\"groupMsgUserId\\":1383068791,\\"groupMsgUserName\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:23\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 \\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:24\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"aaf啊积极饿哇 啊发\\",\\"groupMsgUserId\\":1234,\\"groupMsgUser\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:25\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png\\",\\"groupMsgUserId\\":1234,\\"groupMsgUserName\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:26\\",\\"isSelected\\":true}]'};Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},o={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+o[this.getDay()+""]));for(var s in t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e};var historyMsg={total:0,core:"10000",rows:[{groupId:61,companyId:138306984,groupMsg:"test1111",sendTimes:"2017-02-28 14:49:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:50:15",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:51:58",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 15:00:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test2223",sendTimes:"2017-02-28 16:27:12",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:29:49",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:30:05",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"}],footer:[]};APP.controller("CirclePageController",["HomePageService","$http","$localstorage","$location","$scope","$rootScope","$state","$stateParams","CirclePageService","$ionicScrollDelegate","NoteDetailsService","UrlService","PopupService","$ionicModal","ionicDatePicker2","ionicTimePicker","$timeout","UserService","$ionicPopup","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I){function w(){var e=s.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&t({method:"POST",url:p.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){v.setUser(e.data),o.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}function y(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}i.isDisplay=!1,i.showList=!1,i.moreTag=!1,i.hasmore=!0,i.showTopBtn=!1,i.circleIDIF=!1,i.contentNum={contentNum:""},i.topicId,i.topData,i.listData=[],i.circleId,i.tagsName,i.showShare=!1,i.topicid="",i.allowPub=!0,i.topicSummary,i.signSuccess=!1,i.init=function(){662!=i.circleId&&665!=i.circleId||(i.circleIDIF=!0,662==i.circleId?c.getCircleLink("","","1").success(function(e){e.success&&(i.circleUrl=e.data)}):665==i.circleId&&c.getCircleLink("","","3").success(function(e){e.success&&(i.circleUrl=e.data)})),a.mediaurl="",a.mediaImg="",i.userId=v.getUser().mid,i.phoneHeight=document.documentElement.clientHeight/2,i.showQQ=!1,i.isDisplay=!1,i.showList=!1,i.showWeChat=!1,i.showShare=!1,i.timeWidget={hour:"",minute:""},i.timeWidget2={hour:"",minute:""},window.cordova?i.ifInApp=!1:i.ifInApp=!0,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){i.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){i.showWeChat=0!=e})),i.$broadcast("scroll.refreshComplete"),i.moreTag=!1,i.ifDownload=!0,i.pageIndex=1,i.hasmore=!0,i.listData=[],i.getTags(),i.getListMsg(),i.getTopicSummary(),i.getCircleMembers(),l.$getByHandle("mainScroll").scrollTop(),i.stateIfOpen={},i.applyDiscussionData={topicId:"",entryReason:"",startDate:"",startHour:"",startMin:"",endDate:"",endHour:"",endMin:""},i.personType={isAdmin:!1},window.cordova?i.openFromBrowser=!0:i.openFromBrowser=!1},i.NumberCheck=function(e){/^\d*$/.test(e)||(isNaN(parseInt(e))?i.contentNum.contentNum=0:i.contentNum.contentNum=parseInt(e))},i.goBack=function(){i.circleIDIF?window.open(i.circleUrl+"&openType=h5"):i.$ionicGoBack()},i.isClick=function(){i.isDisplay=!i.isDisplay},i.goshare=function(){if(!v.getUser().mid)return void n.go("login");i.showShare=!i.showShare},i.isClick=function(){i.isDisplay=!i.isDisplay},i.showCameraList=function(){if(window.cordova&&(a.gio.track("createTopic",{circleID:i.circleId}),a.gio.track("active",{circleID:i.circleId})),i.topicSummary.isJoin){var e={topicId:i.circleId};c.circleSpeak(e).success(function(e){e.success?0==e.data.isGap&&(i.showList=!i.showList):-2e3==e.errorCode?(u.showToast(e.message),a.loginIsAccord2=!0):u.showToast("您已被禁言，不能发话题")})}else{S.show({template:"<p>亲，先加入我们再秀话题吧。</p>",title:"退出圈子",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>加入</span>",type:"",onTap:function(){i.joinCircle()}},{text:"再想想"}]});h(function(){},3e3)}},i.jumpPublishCircle=function(){n.go("publishCircle")},i.goShop=function(){n.go("myStore",{storeId:i.userId,shareStoreId:""})},i.closeDownload=function(){i.ifDownload=!1},i.jumpMsg=function(){n.go("ClassifyMessageCenter")},i.inPersonalPage=function(e){n.go("personalHomepageHe",{othersId:e})},i.toNoteDetails=function(e,t,o){i.noteIndex=o,n.go("noteDetails",{noteId:e,isShortStory:t})},i.hideList=function(){i.showList=!1},i.scrollToTop=function(){l.$getByHandle("mainScroll").scrollTop(!0),i.showTopBtn=!1},i.getScrollHeight=function(){i.scrollHeight=Math.abs(document.getElementById(i.topicSummary.topicName).getBoundingClientRect().top),i.scrollHeight>3*i.phoneHeight?i.showTopBtn=!0:i.showTopBtn=!1},i.jumpPhoto=function(e){i.showList=!1,3!=e?n.go("publishCircle",{identifierCode:"",topicId:i.circleId,topicStyle:e}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(t){n.go("publishCircle",{identifierCode:"",topicId:i.circleId,topicStyle:e});var o=JSON.parse(t),s=o.videoFile,r=o.imageFile,c=s.replace("\\",""),l=r.replace("\\","");a.mediaurla=c,a.mediaImga=l},function(e){})},i.getTags=function(){var e={id:i.circleId,flag:0};c.getTags(e).success(function(e){i.tagsName=e.data.list})},i.tagsNameList=function(e,t){i.tagsIndex=e,i.tagId=t,i.listData=[],i.pageIndex=1,i.hasmore=!0,i.getListMsg()},i.joinCircle=function(){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else{window.cordova&&(a.gio.track("follow",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var t={ids:i.circleId};c.joinTopic(t).success(function(e){1==e.success?(i.inCircle=!0,h(function(){i.inCircle=!1},1e3),i.topicSummary.isJoin=!0,i.getCircleMembers(),i.getTopicSummary()):u.showToast(e.message)})}}),window.cordova&&(a.gio.track("follow",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var t={ids:i.circleId};c.joinTopic(t).success(function(e){1==e.success?(i.inCircle=!0,h(function(){i.inCircle=!1},1e3),i.topicSummary.isJoin=!0,i.getCircleMembers(),i.getTopicSummary()):-2e3==e.errorCode&&(u.showToast(e.message),a.loginIsAccord2=!0)})},i.signIn=function(){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else if(i.topicSummary.isJoin){var t={topicId:i.circleId,userId:i.userId,signType:2};c.circleSignIn(t).success(function(e){if(e.success){i.signInfoData=e.data;var t=S.show({template:"<div class='sign-box' flex='main:center'>\n                              <div ng-click=\"closeSign()\" class='sign-close' flex='main:right'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                              <div class='sign-bg'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_background.png\" style='width:100%;' alt=\"\" /></div>\n                              <div class='sign-content'>\n                                <div class='sign-title' flex='main:center cross:center'>\n                                  <div class='sign-icon' flex='cross:center'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                                  <div class='title-text'>签到排名<span>{{signInfoData.rank}}</span></div>\n                                </div>\n                                <p ng-if='signInfoData.golds>0'>获得<span class='sign-num'>{{signInfoData.golds}}</span>金币</p>\n                                <p ng-if='signInfoData.signRules'>连续签到<span class='sign-num'>{{signInfoData.signRules.continuitySign}}</span>天即可获取<span class='sign-num'>{{signInfoData.signRules.golds}}</span>金币</p>\n                              </div>\n                              <div class='sign-foot' ng-click='goSignInChart(circleId)'>签到排行榜</div>\n                            </div>",cssClass:"signPopup",scope:i});i.closeSign=function(){t.close(),i.getTopicSummary()},i.goSignInChart=function(e){t.close(),n.go("signInChart",{topicId:e})}}else u.showToast(e.message)})}else u.showToast("请先加入圈子")})},i.signDate=function(e,t,o){n.go("signDate",{userId:e,topicId:t,monthFlag:o})},i.jumpAllMembers=function(e){n.go("allMembers",{topicId:e})},i.isMoreTag=function(){i.moreTag=!i.moreTag,0==i.moreTag&&l.scrollTop(),l.resize()},i.getCircleMembers=function(){var e={topicId:i.circleId};c.circleMembers(e).success(function(e){e.success&&(i.members=e.data.list,i.membersHead=e.data.list1[0])})},i.getTopicSummary=function(){var e={topicId:i.circleId};c.getCircleInfo(e).success(function(e){i.topicSummary=e.data.list[0],c.topicName=i.topicSummary.topicName,0==i.topicSummary.allowPubStory?i.allowPub=!1:1==i.topicSummary.allowPubStory&&(i.allowPub=!0),i.topicid=e.data.list.id,i.minNum=i.topicSummary.capacity;var t=i.topicSummary.dateNow.split("-"),o=Number(t[0]),s=Number(t[1]),a=Number(t[2]);i.signSucDate={signYear:o,signMonth:s,signDay:a},c.signSuccessDate=i.signSucDate})},i.extendContent=function(){if(i.contentNum.contentNum<=i.minNum)i.biggerThanFive=!0,h(function(){i.biggerThanFive=!1},3e3);else if(i.contentNum.contentNum>2e3)i.biggerThanTwoThousand=!0,h(function(){i.biggerThanTwoThousand=!1},3e3);else{var e={topicId:i.circleId,entryCapacity:i.contentNum.contentNum};c.extendContent(e).success(function(e){e.success?(i.hideBigerModal(),i.contentNum.contentNum="",a.applyBottomNotice=!0,i.isDisplay=!1,h(function(){a.applyBottomNotice=!1},3e3)):u.showToast(e.message)})}},i.noticeDownload=function(){a.downAppUrl||u.showToast("不支持该手机")},i.applyDiscussion=function(){var e=i.applyDiscussionData;e.topicId=i.circleId,c.applyDiscuss(e).success(function(e){1==e.success?(u.showToast(e.message),i.hideModal(),i.applyDiscussionData.endHour="",i.applyDiscussionData.endMin="",i.applyDiscussionData.startHour="",i.applyDiscussionData.startMin=""):u.showToast(e.message)}).error(function(){})},i.stateDiscussion=function(){var e={topicId:i.circleId};c.discussionState(e).success(function(e){1==e.success?(i.stateIfOpen=e.data,i.stateIfOpen.isAdmin=!0):u.showToast("获取讨论组 服务器异常")}).error(function(){u.showToast("获取讨论组 相关信息失败")})},i.toChat=function(){var e=i.circleId,t=i.stateIfOpen.groupId;if(!e||!t)return void u.showToast("缺少讨论组参数，错误");n.go("circleGroupDiscuss",{circleId:e,groupId:t})},i.loadMoreMsg=function(){i.pageIndex+=1;var e=y("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:i.pageIndex,pageSize:5,topicId:i.circleId,tagId:i.tagId,noLoading:!0,userCode:o?i.weChatOpenId:e};c.getCircleList(s).success(function(e){if(e.data.list&&0!=e.data.list.length){i.listData=i.listData.concat(e.data.list),i.$broadcast("scroll.infiniteScrollComplete");var t=i.listData.length;i.hasmore=!(t===e.data.storeItemsCounts)}else i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1,u.showToast("没有更多消息了")}).error(function(){i.$broadcast("scroll.infiniteScrollComplete")})},i.loadTopicStory=function(){c.getTopStory(topData).success(function(e){})},i.showModal=function(){g.fromTemplateUrl("templates/quanzi/selectModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.selectModal=e,i.selectModal.show()})},i.hideModal=function(){i.selectModal.hide()},i.showBigerModal=function(){g.fromTemplateUrl("templates/quanzi/biggerModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.biggerModal=e,i.biggerModal.show()}),i.isDisplay=!1},i.hideBigerModal=function(){i.biggerModal.hide()},i.getListMsg=function(){var e=y("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i);i.listMsg={pageIndex:1,pageSize:5,topicId:i.circleId,tagId:i.tagId,userCode:o?i.weChatOpenId:e},c.getCircleList(i.listMsg).success(function(e){i.listData=e.data.list,i.whichPersonType(),i.stateDiscussion()}).error(function(){})},i.whichPersonType=function(){var e={topicId:i.circleId,noLoading:!0};d.getPersonType(e).success(function(e){1==e.success&&(i.personType={isAdmin:e.data.isAdmin})})},i.topicPraise=function(e,t){window.cordova&&(a.gio.track("like",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var o=y("loginId"),s=window.navigator.userAgent.toLowerCase(),n="micromessenger"==s.match(/MicroMessenger/i),l={id:e,noLoading:!0,userCode:n?i.weChatOpenId:o};c.pushPraise(l).success(function(e){1==e.success?1==i.listData[t].praiseFlag?(i.listData[t].praiseNumber=i.listData[t].praiseNumber-1,i.listData[t].praiseFlag=!i.listData[t].praiseFlag):(i.listData[t].praiseNumber=i.listData[t].praiseNumber+1,i.listData[t].praiseFlag=!i.listData[t].praiseFlag):h(function(){u.showToast(e.message)},200)})},i.topicFavorite=function(t,o){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else{var s={id:t};c.topicFavorite(s).success(function(e){1==e.success?1==i.listData[o].collectionFlag?(i.listData[o].collectionNumber=i.listData[o].collectionNumber-1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):(i.listData[o].collectionNumber=i.listData[o].collectionNumber+1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):h(function(){u.showToast(e.message)},200)})}});var s={id:t};c.topicFavorite(s).success(function(e){1==e.success?1==i.listData[o].collectionFlag?(i.listData[o].collectionNumber=i.listData[o].collectionNumber-1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):(i.listData[o].collectionNumber=i.listData[o].collectionNumber+1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):-2e3==e.errorCode&&(u.showToast(e.message),a.loginIsAccord2=!0)})},i.shareToStore=function(){var e={flag:0,topicId:i.circleId};d.shareStore(e).success(function(e){e.success})},i.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),h(function(){u.showToastShort("复制成功")},200)):u.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){-1!=s.absUrl().indexOf("token")&&(window.location.hash=s.path());var t="邀请您关注"+i.topicSummary.topicName+"圈子",o="欢迎关注"+i.topicSummary.topicName+"圈子，与"+i.topicSummary.topicName+"微店主同城交流互动。",a="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=p.getShareLinkHeader()+"circlePage/"+i.circleId;i.circleId;window.umeng?0==e?window.umeng.shareToSina(t,o,a,n,0,null,I.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,a,n,0,null,I.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,a,n,0,null,I.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,a,n,0,null,I.shareSuccessCallback),I.qqShare()):4==e?(window.umeng.shareToQzone(t,o,a,n,0,null,I.shareSuccessCallback),I.qqShare()):5==e?i.copeText(n):I.successShare():alert("umeng undefined 只能在app分享"),i.showShare=!1,i.shareToStore()},i.dateOne="开始时间",i.dateTwo="结束时间",i.a=1,i.b=1,i.firstDatePicker=function(){var e={callback:function(e){i.dateOne=e,i.applyDiscussionData.startDate=e,i.a=2},to:new Date(i.dateTwo)};m.openDatePicker(e)},i.secondDatePicker=function(){var e={callback:function(e){i.dateTwo=e,i.applyDiscussionData.endDate=e,i.b=2},from:new Date(i.dateOne)};m.openDatePicker(e)},i.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};f.openTimePicker(e)},i.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};f.openTimePicker(e)},i.exitTopicNotice=function(){S.show({template:"<p>亲，忍心离开我们圈子了吗？</p>",title:"退出圈子",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>退出</span>",type:"",onTap:function(){i.exitTopic()}},{text:"再想想"}]});h(function(){},3e3)},i.exitTopic=function(){var e={topicId:i.circleId};c.exitTopic(e).success(function(e){e.success?(i.isDisplay=!1,i.isDisplay=!1,i.outawayCircle=!0,i.showList=!1,h(function(){i.outawayCircle=!1},1e3),i.topicSummary.isJoin=!1,i.getCircleMembers(),i.getTopicSummary()):(i.isDisplay=!1,u.showToast(e.message))}).error(function(){u.showToast(response.message)})},i.wechatOpenId=function(){d.getWeChatOpenId().success(function(e){e.success&&(e.data?(i.weChatOpenId=e.data,d.weChatOpenId=e.data,i.init()):i.wechatUrlOpenId())})},i.wechatUrlOpenId=function(){var e=s.absUrl();d.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},i.$on("$ionicView.beforeEnter",function(t,o){i.circleId=r.circleId,i.tagId=null,w(),window.location.hash=s.path(),i.tagsIndex=0,a.ifDeleteNoteList&&(i.listData.splice(i.noteIndex,1),a.ifDeleteNoteList=!1),"back"==o.direction?i.getTopicSummary():(window.cordova&&a.gio.track("circleEntry",{circleID:i.circleId}),$("ion-header-bar").show()),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?e.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==a.isWdHost?i.wechatOpenId():i.init()}):"back"==o.direction||i.init()}),i.$on("$stateChangeSuccess",function(e,t,o,s,n){a.fromState=s.name,a.toState=t.name,"publishCircle"==a.fromState&&i.init()})}]),APP.service("CirclePageService",["$http","UrlService",function(e,t){this.getCircleLink=function(o,s,i){var a={productId:o,storeId:s,type:i};return e.get(t.getTopUrl("IF_CIRCLEPAGE"),a)},this.getCircleInfo=function(o){return e({method:"POST",url:t.getUrl("TOPIC_INFO"),data:o})},this.topicName="",this.shareinfor=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.circleMembers=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCODE"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.getTopStory=function(o){return e({method:"POST",url:t.getUrl("TOP_STORY"),data:o})},this.circleSpeak=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SPEAK"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.extendContent=function(o){return e({method:"POST",url:t.getUrl("ENLARGE_CONTENT"),data:o})},this.applyDiscuss=function(o){return e({method:"POST",url:t.getUrl("ENTRYFORUM"),data:o})},this.discussionState=function(o){return e({method:"POST",url:t.getUrl("DISCUSSION_STATE"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.getCircleList=function(o){return e({method:"POST",url:t.getUrl("LIST"),data:o})},this.exitTopic=function(o){return e({method:"POST",url:t.getUrl("EXIT_TOPIC"),data:o})},this.circleSignIn=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGNIN"),data:o})},this.signSuccessDate=""}]),APP.controller("CircleSetAdminController",["$scope","$state","$stateParams","CircleSetAdminService","$ionicScrollDelegate","PopupService",function(e,t,o,s,i,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.addAdmin=function(o){t.go("selectAdmin",{topicId:e.topicId})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.decAdmin=function(t){var o={topicId:e.topicId,userCode:t,indentityStatus:0};s.setAdmin(o).success(function(t){t.success&&e.getCircleUser()}).error(function(){})},e.getCircleUser=function(){var t={topicId:e.topicId};s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2}).error(function(){})},e.init=function(){e.pageIndex=1,e.input={isinput:""},e.getCircleUser()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("CircleSetAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("CIRCLE_CIRCLEPERSON"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,o,s){function i(){var e=t.html();o.stripBr&&"<br>"===e&&(e=""),s.$setViewValue(e)}s&&(s.$render=function(){t.html(s.$viewValue||"")},t.on("blur keyup change",function(){e.$apply(i)}))}}}),APP.controller("ClassNoteDetailsController",["$scope","$rootScope","$ionicModal","$state","$stateParams","$ionicLoading","$http","PlatformService","ClassNoteDetailsService","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","TopicdetailsService","$timeout","$ionicActionSheet","PopupService","$timeout","UrlService","NoteDetailsService","UserService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,g,h,v,S,I){e.isDisplay=!1,e.inputShow=!0,e.praiseNum={},e.commentId="",e.circleId,e.circleDetail,e.commentList,e.commentWords={words:""},e.pinglunis=!1,e.topicheight=0,e.comment={text:"",rows:1},e.noteDetail={reply:"说点什么"},e.$watch("noteDetail.reply",function(e,t,o){}),e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,e.isImage=!1,e.showBigImg=!1,e.imgString="",e.isPublishImage=!1,e.imgA=[],e.showBigBac=!1,e.goBack=function(){e.$ionicGoBack(),t.nextPageBefore="classNoteDetails"},e.goshare=function(){if(!S.getUser().mid)return void s.go("login");e.showShare=!e.showShare,e.isDisplay=!1},e.goToScore=function(t){if($(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),"linklink"==t.target.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("all-to"==t.target.className)if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("atopic"==t.target.className){if(t.target.attributes["data-a"]){var o=t.target.attributes["data-a"].value;e.tolink(o)}else if(t.target.attributes.dataa){var o=t.target.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.className){if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.attributes.dataa){var o=t.target.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.parentNode.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.parentNode.attributes.dataa){var o=t.target.parentNode.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}},e.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},
e.goShop=function(){s.go("myStore",{storeId:e.userId,shareStoreId:""})},e.noticeDownload=function(){t.downAppUrl||f.showToast("不支持该手机")},e.jumpMsg=function(){s.go("ClassifyMessageCenter")},e.inPersonalPage=function(e){0!=e&&s.go("personalHomepageHe",{othersId:e})},e.isClick=function(){e.isDisplay=!e.isDisplay},e.downLoadPhoto=function(o){e.photoUrl=o,t.isIOS?m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(o,function(e){f.showToast("保存成功")},function(e){f.showToast("保存失败")})}}):m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW");var o=new FileTransfer,s=encodeURI(e.photoUrl);return o.download(s,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存成功")},function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}})},e.productConnect=function(){var t={productId:e.circleDetail.productId,userCode:e.circleDetail.userCode};v.connectProduct(t).success(function(t){e.products=t.data.list})},e.toProductDetail=function(e){s.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},e.editTopic=function(){s.go("publishEdit",{topicId:e.circleId})},e.showCommentView=function(t){e.commentId=t;l.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:e,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){e.insertComments()}}]});g(function(){},3e3)},e.isInputShow=function(){e.inputShow=!e.inputShow},e.pinglunshow=function(){var t=d.$getByHandle("pinglun"),o=t.getScrollPosition(),s=o.top,i=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-i,g(function(){e.pinglunis=s>e.topicheight},200)},e.nocommontId=function(){e.commontId&&(e.commontId="",e.toSomeone="",e.commentWords.words="",e.iconImageData=[])},e.focuss=function(){e.isPublishImage=!0,e.showBac=!0,e.iconImageData.length>0&&(e.isImage=!0)},e.deleteImg=function(t){e.iconImageData.splice(t,1)},e.showLarge=function(t){e.showBigBac=!0,e.showBigImg=!0,e.Url=t},e.closeBigImg=function(){e.showBigImg=!1,e.showBigBac=!1},e.closeImg=function(){e.isImage=!1,e.isPublishImage=!1,e.showBac=!1},e.imgPush=function(t){if(e.isImage=!0,e.iconImageData.length>=9)return void f.showToast("最多添加9张");m.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};g(function(){e.iconImageData.push(o),e.existPhoto=!0},200)}function s(){}if(0==t)return navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var i=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s)}e.$apply()},function(e){},{maximumImagesCount:i,width:800,quality:50}),!0}}})},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis,e.shuxiaoxi=!e.shuxiaoxi},e.favorite=function(){var t={id:e.circleId,noLoading:!0};c.pushPraise(t).success(function(e){})},e.follow=function(o){if(0==o){var s={id:e.circleDetail.userCode,isFollow:1};c.followNote(s).success(function(o){1==o.success?e.circleDetail.isFolled=1:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}else if(1==o){var s={id:e.circleDetail.userCode,isFollow:0};c.followNote(s).success(function(o){1==o.success?e.circleDetail.isFolled=0:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}},e.getA=function(){g(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},1e3)},e.getCircleDetails=function(){var t={id:e.circleId};c.getCircleDetails(t).success(function(t){e.circleDetail=t.data,e.circleDetail.productId&&e.productConnect()}),e.getA()},e.getComment=function(){var t={pageIndex:1,pageSize:1e4,id:e.circleId};c.getComments(t).success(function(t){e.commentNumbers=t.totalCount,e.commentList=t.data.list,e.imgString="",e.imgA=[];for(var o=0;o<e.commentList.length;o++)e.commentList[o].commentImgs&&(e.imgString=e.commentList[o].commentImgs,e.imgA=e.imgString.split(","),e.commentList[o].imgaa=e.imgA);d.resize()})},e.getFocus=function(t,o){event.stopPropagation(),e.commentWords.words="",e.iconImageData=[],e.isPublishImage=!0,e.showBac=!0,e.commontId=t,e.toSomeone="回复给："+o,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.leaveFocus=function(){e.commontId="",e.toSomeone=""},e.insertComments=function(){var t=0;if(e.commentWords.words){var o={keywords:e.commentWords.words};p.judgeWords(o).success(function(o){"没有敏感词"==o.message?0==e.iconImageData.length?e.publishTopic():angular.forEach(e.iconImageData,function(o,s){var i=function(o){a.hide(),t++;var i=JSON.parse(o.response),n=i.urls;e.imgUrlList[s]=n,t==e.iconImageData.length&&e.publishTopic()},n=function(e){a.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(v.uploadImage()),i,n,r)}):(f.showToast("存在敏感词",o.data),e.commentWords.words="")})}else f.showToast("内容不能为空")},e.publishTopic=function(t){if(e.commontId){var t={comment:e.commentWords.words,commentTo:e.commontId,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}else{var t={comment:e.commentWords.words,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}},e.insertCommentOK=function(t){c.insertComment(t).success(function(t){e.getComment(),1==t.success?(f.showToast("回复成功"),e.commentWords.words="",e.commontId="",e.toSomeone="",e.iconImageData=[],e.imgUrlList=[],e.isImage=!1,e.isPublishImage=!1,e.showBac=!1):(g(function(){f.showToast(t.message)},200),e.commentWords.words="")}).error(function(t){f.showToast("网络异常"),e.commentWords.words=""})},e.topicPraise=function(t){var o={id:t,noLoading:!0};c.pushPraise(o).success(function(t){1==t.success?(e.isPraise=!e.isPraise,e.getStoryPraiseNum(),f.showToast("点赞成功")):f.showToast(t.message)})},e.topicFavorite=function(o){var s={id:o,noLoading:!0};c.topicFavorite(s).success(function(o){1==o.success?(e.isFavorite=!e.isFavorite,e.getStoryPraiseNum(),f.showToast("收藏成功")):-2e3==o.errorCode?(f.showToast(o.message),t.loginIsAccord2=!0):f.showToast(o.message)})},e.commentPraise=function(t,o){var s={commentId:t.id};c.commentPraise(s).success(function(s){1==s.success&&(t.commentPraiseNumberFlag=!t.commentPraiseNumberFlag,e.commentPraiseNum(t,o))})},e.getStoryPraiseNum=function(){var t={id:e.circleId};c.getStoryPraise(t).success(function(t){e.praiseNum=t.data})},e.commentPraiseNum=function(t,o){var s={commentId:t.id};c.commentPraiseNum(s).success(function(t){e.commentList[o].commentPraiseNumber=t.totalCount})},e.deleteStory=function(){var t={storyId:e.circleDetail.id};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("话题删除成功"),s.go("circlePage",{circleId:e.circleDetail.topicId}))})},e.warnDeleteComments=function(o){e.isDisplay=!1,e.deleteId=o;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){e.deleteComment()}}]});g(function(){},3e3)},e.deleteComment=function(){var t={id:e.deleteId};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("删除成功"),e.getComment())})},e.shareToStore=function(){var t={flag:2,storyId:e.circleDetail.id};v.shareStore(t).success(function(e){e.success})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){f.showToastShort("复制成功")},200)):f.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.circleDetail.storyName+"-顺逛微社区",s=e.circleDetail.storyContentText.substr(0,30),i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=h.getShareLinkHeader()+"classNoteDetails/"+e.circleId;window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,I.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,I.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,I.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,I.shareSuccessCallback),I.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,I.shareSuccessCallback),I.qqShare()),5==t?e.copeText(a):I.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1,e.shareToStore()},e.closeDownload=function(){e.ifDownload=!1},e.init=function(){e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,o.fromTemplateUrl("templates/quanzi/biggerPictureModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.biggerPictureModal=t}),e.userId=S.getUser().mid,window.cordova?e.ifInApp=!1:e.ifInApp=!0,e.toSomeone="",e.showQQ=!1,e.ifDownload=!0,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.commentWords={words:""},e.showShare=!1,e.isFavorite=!0,e.isPraise=!0,e.isDisplay=!1,e.circleId=i.noteId,e.ifShort=i.isShortStory,e.personType={isAdmin:!1,isCreateStory:!1},e.getCircleDetails(),e.getComment(),e.getStoryPraiseNum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ClassNoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("GETSTORYINFO"),data:o})},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("CLASS_DELETE_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOLLECTION"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("GETSTORYCOMMENT"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("SUBMITCOMMENT"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GETSTORYPRAISEANDUNREAD"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISENUM"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})}}]),APP.controller("ClassesDetailsController",["$scope","$rootScope","$state","$stateParams","ClassesDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r){e.isClick=0,e.input={input:""},e.classInfo={courseCategory:"",courseName:"",courseStartTime:"",teacher:"",teacherIntroduce:"",forumStartTime:"",forumEndTime:"",courseDescription:"",timeOrder:""},e.membersJoin={courseId:2,createTime:"2017-01-17 11:24:00.0",id:3,type:"2",userCode:"",userImg:"",userName:""},e.teacherList={userName:2,teacherIntroduce:"2017-01-17 11:24:00.0",userImg:3,children:"2",courseName:"",courseId:""},e.messageBoardList={questionId:"",questionContent:"",questionTime:"",questionUserName:"",questionUserCode:"",questionUserImg:"",firstAnswerId:"",firstAnswerContent:"",firstAnswerTime:"",firstAnswerUserName:"",firstAnswerUserCode:"",firstAnswerUserImg:"",firstAnswerIsTeacher:"",answersTotal:"",totalCount:""},e.classesList={},e.topicList={},e.shareList={},e.init=function(){e.ifShowInput=!0,e.getClassInfo(),e.getClassesList(),e.getMessageBoardList(),e.getClassTopicList(),e.studentShare()},e.click0=function(){e.isClick=0},e.click1=function(){e.isClick=1},e.click2=function(){e.isClick=2},e.goBack=function(){e.$ionicGoBack()},e.getClassInfo=function(){var t={courseId:2};i.getClassInfo(t).success(function(t){e.classInfo=t.data.list[0],e.classJoinMember(),e.getTeacherList()})},e.classJoinMember=function(){var t={courseId:2};i.classJoinMember(t).success(function(t){e.membersJoin=t.data.list})},e.getTeacherList=function(){var t={courseId:2};i.getTeacherList(t).success(function(t){e.teacherList=t.data.list})},e.getClassesList=function(){var t={courseId:2};i.getClassesList(t).success(function(t){e.classesList=t.data.list})},e.getClassTopicList=function(){var t={courseId:2};i.getClassTopicList(t).success(function(t){e.topicList=t.data.list})},e.studentShare=function(){var t={courseId:1};i.studentShare(t).success(function(t){e.shareList=t.data.list,r.$getByHandle("mainScroll").resize()})},e.getMessageBoardList=function(){var t={courseId:1,pageSize:5,pageIndex:1};i.getMessageBoardList(t).success(function(t){e.messageBoardList=t.data.list})},e.toQuestionDetail=function(e){o.go("questionDetails",{wordsId:e})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showInput=function(){e.ifShowInput=!e.ifShowInput},e.commitAnswer=function(){var t={wordsContent:e.input.input,courseId:"",parentId:""};i.askQuestion(t).success(function(e){}).error(function(){})}}]),APP.service("ClassesDetailsService",["$http","UrlService",function(e,t){this.getClassInfo=function(o){return e({method:"POST",url:t.getUrl("COURSE_INFO"),data:o})},this.classJoinMember=function(o){return e({method:"POST",url:t.getUrl("COURSE_ALL_MEMBER"),data:o})},this.getTeacherList=function(o){return e({method:"POST",url:t.getUrl("COURSE_TEACH_LIST"),data:o})},this.getClassesList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_LIST"),data:o})},this.getClassTopicList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_TOPIC_LIST"),data:o})},this.studentShare=function(o){return e({method:"POST",url:t.getUrl("STUDENT_SHARE"),data:o})},this.getMessageBoardList=function(o){return e({method:"POST",url:t.getUrl("MESSAGE_BOARD_LIST"),data:o})},this.askQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})}}]),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$q","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(t){e.tempUrl=t;var o=r.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,$)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.imageUrl=s,o.data.fileType=".jpg",o.data.companyId=void 0,o.data.message="图片文件",o.data.companyId=void 0,e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})}function $(e){alert("上传失败")}function S(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function I(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.productObjs=[],e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.isShowRecord=!1,e.tempUrl,e.isOffLine=!1,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.userInCC.mid,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["mid","image"],values:[1111222,333]};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?l.showToast("客服暂时不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.isPlaying||e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=g.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++)r.filtMsg(o.data.msgs[s]),o.data.msgs[s].message&&e.messages.push(o.data.msgs[s]);t.resolve(1)}else t.resolve(1)},function(e){alert(e),t.resolve(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};if(!t.msg)return void l.showToast("发送消息不能为空");r.sendMsg(t).then(function(o){if(o){var s={message:t.msg,companyId:void 0};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(t){var s={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:t,desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(s).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var s={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(s).then(function(e){if(e);o.goBack()},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.transferTo=1,e.transferChat=function(){var t={cmd:"transferChat",c:e.csId,v:e.uuID,chatId:e.chatId,transNum:1,aId:e.transferTo};r.transferChat(t).then(function(t){t&&t.data?"success"==t.data.result?(e.chatId=t.data.chat1,e.csId=e.transferTo):alert("transfer chat  server response error ！！！"):alert("transfer chat  net error ！！！")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(e){p.getPicture(e,f,h)},e.play=function(){var e=document.getElementById("audioInCC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){p.startCapture("sourceInCC","audioInCC")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),p.stopCapture("sourceInCC","audioInCC",e.transfer)},e.transfer=function(){var t=r.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,s.data.message="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(s.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};r.addEvent(i).then(function(t){t?a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败"),e.loopGetMsg()})},y=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("content");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.sendLink=function(t){var o=JSON.stringify(t),s="$prodLink"+o,i={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:s};if(!i.msg)return void l.showToast("发送消息不能为空");r.sendMsg(i).then(function(t){if(t){var o={message:i.msg,companyId:void 0};r.filtMsg(o),e.messages.push(o),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.isPlaying=!1,"back"==s.direction||(e.productObjs=[],e.init()),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",S),window.addEventListener("native.keyboardhide",I),p.addAudioEventOnWindow()});var T=void 0;e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",S),window.removeEventListener("native.keyboardhide",I)}),e.$on("play-sound-ended",function(t,o){for(var s=0;s<e.messages.length;s++)e.messages[s].imageUrl===o.id.src&&s<e.messages.length-1&&".wav"===e.messages[s+1].fileType&&e.$broadcast("play-sound-next",{id:e.messages[s+1].imageUrl})}),e.goBack=function(){e.isPlaying||e.isOffLine||(e.actSheet=d.show({buttons:[{text:"<b>非常满意</b> "},{text:"<b>比较满意</b> "},{text:"<b>一般</b> "},{text:"<b>不满意</b> "}],titleText:"评价客服",cancelText:"取消",cancel:function(){},buttonClicked:function(t){return e.opinion(t),!0}}))}}]),APP.service("CustomerConversationService",["$http","UrlService","$sce",function(e,t,o){function s(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+a[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+a[t]+'.png" />')}var i="http://123.56.3.136:8182";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke/",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.getUUID=function(){return e.get(i+"/getVistorId.dll")},this.opinion=function(t){return e.get(i+"/msg.dll",t)},this.endChat=function(t){return e.get(i+"/msg.dll",t)},this.transferChat=function(t){return e.get(i+"/msg.dll",t)},this.addEvent=function(t){return e.get(i+"/msg.dll",t)},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.message&&e.message.indexOf("$prodLink")>-1)e.message="已经发送了 商品链接";else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("[")>-1&&e.message.indexOf("]")>-1)for(var t=1;t<16;t++)e.message=s(e.message,t)};var a=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.getUploadUrl=function(){return i+"/receive3.jsp"}}]),APP.directive("resizeFootBar",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content"),a=e.$getByHandle("ccScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("GroupSettingController",["$scope","GroupSettingService","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","UserService","PopupService","CircleGroupDiscussService","$ionicModal","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.isShowName=!0,e.confirmData={groupName:"",groupMax:"0"};var g={userGag:0,userId:"test",userState:"0",userName:"我是路飞",userImg:"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png"},m={userGag:1,userId:"test",userState:"1",userName:"我不是是路飞",userImg:"https://git.oschina.net/uploads/80/436680_xu6767.png"};e.groupId;var f=c.getUser();e.token=f.sessionValue,e.groupUsers=[g,m,g,m,g,m,g,m,g,m,g,m],e.groupDesp={},e.groupSetting={yes:!1,userId:void 0};var h=window.innerWidth;e.jinyanHover={top:"5px",left:.1*h-21-1.5+"px"},e.groupInfo,e.query=function(){var o={groupId:e.groupId,token:e.token};t.query(o).success(function(t){t&&t.userInfo&&(e.groupUsers=t.userInfo)},function(e){alert("查询群组成员失败")})},e.init=function(){e.query(),e.queryGroup()},e.delGroupUser=function(o){var s={userId:o.userId,groupId:e.groupId};t.deleteGroupUser(s).then(function(t){t&&(l.showToast("删除用户成功"),e.query())},function(e){alert("net error--- delGroup  failed")})},e.getAllMsg=function(){var t={c:"getGroupMsg",groupId:e.groupId,token:e.token};d.getAllMsg(t).then(function(t){t&&t.data?e.historyMsgs=t.data.rows:l.showToast("获得讨论组列表失败")},function(e){alert("net error--- delGroup  failed")})},e.getMsgByMun=function(){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};d.getMsgByMun(t).then(function(e){if(e);},function(e){alert("net error--- delGroup  failed")})},p.fromTemplateUrl("templates/quanzi/groupName.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.groupName=t}),e.openName=function(){e.isShowName=!0,e.groupName.show()},e.closeName=function(){e.groupName.hide()},e.openMaxRecord=function(){e.isShowName=!1,e.groupName.show()},e.queryGroup=function(){var o={companyId:f.mid,groupId:e.groupId,token:e.token};t.queryGroup(o).then(function(t){t.data&&t.data.rows&&(e.groupInfo=t.data.rows[0],e.groupDesp=JSON.parse(e.groupInfo.desp))},function(e){alert("net error--- delGroup  failed")})},e.upDateGroup=function(){var o;if(e.confirmData.groupName){var s=JSON.parse(e.groupDesp);o={id:e.groupId,desp:"{}",token:s,groupName:e.confirmData.groupName}}if(e.confirmData.groupMax){if(!angular.isNumber(e.confirmData.groupMax))return void l.showToast("请输入一个秒数");e.groupDesp.timeSet=e.confirmData.groupMax;var s=JSON.parse(e.groupDesp);o={id:e.groupId,desp:s,token:e.token,groupName:e.confirmData.groupName}}if(!o)return void l.showToast("输入不能为空");t.updateGroup(o).then(function(t){t&&(l.showToast("更改讨论组信息成功"),e.queryGroup())},function(e){alert("net error--- addGroupUser  failed")})},e.queryGroupByMemberId=function(){var o={userId:f.mid,token:e.token};t.queryGroupByMemberId(o).then(function(e){},function(e){alert("net error--- addGroupUser  failed")})},e.addGroupUser=function(){e.groupSetting.userId||l.showToast("请输入合法的用户Id");var o={userId:e.groupSetting.userId,groupId:e.groupId};t.updateGroupUser(o).then(function(t){t&&(l.showToast("添加成员成功"),e.query())},function(e){alert("net error--- addGroupUser  failed")})},e.gagGroupUser=function(o){var s;if("null"===o.userGag||"0"===o.userGag)s=1;else{if("1"!=o.userGag)return;s=0}var i={userId:o.userId,userGagType:s,groupId:e.groupId};t.gagGroupUser(i).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.gagAll=function(){var o={groupGagType:e.groupSetting.yes?1:0,groupId:e.groupId};t.getGroupGag(o).then(function(t){t&&(l.showToast("gagAll"),e.query())},function(e){alert("net error--- gagAll  failed")})},e.$on("$ionicView.beforeEnter",function(){e.groupId=u.groupId,e.circleId=u.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),e.init()}),e.tabSelected=!0,e.switchTab=function(){e.tabSelected=!e.tabSelected},e.createGroup=function(){t.createGroup("admin","讨论组名字","讨论组介绍信息").success(function(t){e.groupId=t.groupId})},e.deleteGroup=function(){t.deleteGroup(e.groupId).success(function(e){})},e.toGroupEditMember=function(){a.go("groupEditMember",{groupId:e.groupId})},e.toGroupAddMember=function(){a.go("groupAddMember",{groupId:e.groupId,circleId:e.circleId})}}]),APP.service("GroupSettingService",["$http",function(e){var t="http://123.56.3.136:8180/Service/chatGroup";this.register=function(t){return e.get("http://123.56.3.136:8180/Service/Company/addApi",t)};this.query=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/queryGroupUser",params:t})},this.queryGroup=function(o){return e({method:"POST",url:t+"/queryGroup",params:o})},this.queryGroupByMemberId=function(o){return e({method:"POST",url:t+"/queryChatGroupUserId",params:o})},this.updateGroup=function(o){return e({method:"POST",url:t+"/updateChatGroupDesp",params:o})},this.filtGroup=function(e){};this.deleteGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/deleteGroupUser",params:t})};this.gagGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/getGroupUserGag",params:t})};this.updateGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/updateGroupUser",params:t})};this.getGroupGag=function(t){return e({method:"POST",url:"http://172.16.63.96:8080/console/Service/chatGroup/getGroupGag",params:t})};this.createGroup=function(t,o,s){return e({method:"POST",url:url,params:"http://172.16.63.98:8080/console/Service/chatGroup/getCreateGroupChat"})},this.deleteGroup=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/console/Service/chatGroup/getCloseGroupChat",params:{id:t}})}}]),APP.controller("GroupAddMemberController",["$scope","$stateParams","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","CirclePageService","$q",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.input={keywords:""},e.iconShow=!0,e.members=[],e.groupId=t.groupId;var g=l.getUser();e.token=g.sessionValue,e.circleId=408,e.members=[],e.membersHead=[],e.membersCommon=[],e.membersAdded=[],e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{
for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.getCircleMembers=function(){var t=u.defer(),o={topicId:e.circleId};return p.circleMembers(o).success(function(o){o.success?(e.membersCommon=o.data.list,e.membersHead=o.data.list1,t.resolve(1)):(d.showToast("获取圈子成员失败"),t.reject(1))}),t.promise},e.query=function(){var t={groupId:e.groupId,token:e.token};c.query(t).success(function(t){if(t&&t.userInfo){e.membersAdded=t.userInfo;for(var o=0;o<e.membersHead.length;o++){for(var s=!1,i=e.membersHead[o].memberId,a=0;a<e.membersAdded.length;a++)if(i==e.membersAdded[a].userId){s=!0;break}if(!s){var n={};n.idCate=0,n.imageFile=e.membersHead[o].img,n.nickName=e.membersHead[o].userName,n.userId=e.membersHead[o].memberId,n.userGag="0",n.userState=1,e.members.push(n)}}for(var r=0;r<e.membersCommon.length;r++){for(var c=!1,i=e.membersCommon[r].id,l=0;l<e.membersAdded.length;l++)if(i==e.membersAdded[l].userId){c=!0;break}if(!c){var n={};n.idCate=0,n.imageFile=e.membersCommon[r].userImg,n.nickName=e.membersCommon[r].userName,n.userId=e.membersCommon[r].id,n.userGag="0",n.userState=1,e.members.push(n)}}}},function(e){alert("查询群组成员失败")})},e.$on("$ionicView.beforeEnter",function(){e.members=[],e.groupId=t.groupId,e.circleId=t.circleId,e.getCircleMembers().then(function(){e.query()})}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){for(var t=[],o=0;o<e.members.length;o++)e.members[o].isSelected&&t.push(e.members[o]);for(var s=function(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=s(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=s(e[o]);return t}return e},i=s(t),a=0;a<i.length;a++)delete i[a].$$hashKey,delete i[a].isSelected;var n=JSON.stringify(i),r={groupMembers:n,groupId:e.groupId,token:e.token};c.updateGroupUser(r).then(function(t){t&&(d.showToast("添加成员成功"),e.getCircleMembers().then(function(){e.query()}))},function(e){alert("net error--- add group Members ---failed")})}}]),APP.service("GroupAddMemberService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("GroupEditMemberController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.input={keywords:""},e.iconShow=!0;var m=c.getUser();e.token=m.sessionValue,e.groupId=g.groupId,e.query=function(){var t={groupId:e.groupId,token:e.token};e.members=[],r.query(t).success(function(t){t&&t.userInfo&&(e.members=t.userInfo)},function(e){alert("查询群组成员失败")})},e.members=[],e.init=function(){var t=c.getUser();e.token=t.sessionValue,e.query()},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.gagOrNo=function(t){for(var o="",s=0;s<e.members.length;s++)e.members[s].isSelected&&(o=o+e.members[s].userId+",");o=o.substr(0,o.length-1);var i=t,a={userId:o,userGagType:i,groupId:e.groupId,token:e.token};r.gagGroupUser(a).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.$on("$ionicView.beforeEnter",function(){e.groupId=g.groupId,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("GroupsToShareController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupAddMemberService","UserService","PopupService","$ionicActionSheet","MediaService","GroupSettingService","CircleGroupDiscussService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.input={keywords:""},e.iconShow=!0,e.members=[],e.shareListStr=void 0,e.isAllSelected=!1,e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t};var m=c.getUser();e.groupId=55,e.token=m.sessionValue,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(e){},e.init=function(){var t=c.getUser();e.token=t.sessionValue;var o={userId:t.mid,token:e.token};u.queryGroupByMemberId(o).then(function(t){if(t&&t.data){for(var o=0;o<t.data.rows.length;o++)try{t.data.rows[o].despObj=JSON.parse(t.data.rows[o].desp)}catch(e){t.data.rows[o].despObj={}}e.members=t.data.rows}else l.showToast("获得讨论组列表失败")})},e.$on("$ionicView.beforeEnter",function(){e.shareListStr=s.shareList,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){var t={groupMembers:'[{"userId":"138307014","idCate":"0","nickName":"cao138307014","imageFile":"www.baidu.com"},{"userId":"138990945","idCate":"0","nickName":"15648756478","imageFile":"www.baidu.com"}]',groupId:e.groupId,token:e.token};r.addMembers(t).then(function(e){e&&l.showToast("添加成员成功")},function(e){alert("net error--- add group Members ---failed")})},e.sendToGroups=function(){for(var t="",o=0;o<e.members.length;o++)e.members[o].isSelected&&(t=t+e.members[o].groupId+",");if(!t)return void alert("no chooesed");t=t.substr(0,t.length-1);var s={c:"sendGroupMsg",groupId:t,msg:e.shareListStr,msgType:1,token:e.token};g.sendMsg(s).then(function(e){e||l.showToast("发送消息失败--发送音频后")},function(e){})}}]),APP.service("GroupsToShareService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("MessageDetailsController",["$scope","$state","$stateParams","SelectTagsService",function(e,t,o,s){}]),APP.service("MessageDetailsService",["$http","UrlService",function(e,t){}]),APP.controller("MyCirclePagesController",["$scope","$rootScope","$state","MyCirclePagesService",function(e,t,o,s){e.myTopics="",e.myCreatTopics="",e.input={keywords:""},e.iconShow=!0,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.input={keywords:""},e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo()},e.search=function(t){e.getMyCreatTopicInfo(t.target.value),e.getMyJoinedCircleInfo(t.target.value),window.cordova&&cordova.plugins.Keyboard.close()},e.viewTopic=function(e){o.go("circlePage",{circleId:e})},e.reviewApplyCircle=function(e){t.reviewCircleId=e,o.go("applyCircle")},e.clickIn=function(e,s){0==s?o.go("circlePage",{circleId:e}):2==s?(t.showApplyTag=1,t.reviewCircleId=e,o.go("applyCircle")):(t.reviewCircleId=e,o.go("applyCircle"))},e.getMyCreatTopicInfo=function(t){var o={keywords:t};s.getMyCreatTopics(o).then(function(t){e.myCreatTopics=t.data.data.list},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};s.getMyJoinedTopics(o).then(function(t){e.myTopics=t.data.data.list},function(e){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyCirclePagesService",["$http","UrlService",function(e,t){this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("MYCREATE_TOPIC"),data:o})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("MYJOINED_TOPIC"),data:o})}}]),APP.controller("MyLessonesController",["$scope","$state","MyCirclePagesService",function(e,t,o){e.goBack=function(){e.$ionicGoBack()},e.init=function(){},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyLessonesService",["$http","UrlService",function(e,t){this.getMyTopics=function(o){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:o})}}]),APP.directive("comImageBox",["$rootScope","$ionicActionSheet","PopupService","CreditService","$timeout",function(e,t,o,s,i){return{restrict:"E",template:'<div class="LightBox" style="display:none;" ><div class="ImgViewer" on-tap="hideBigImage($event)"><img src="{{Url}}"></div></div>',transclude:!1,templateNamespace:"html",scope:!1,link:{pre:function(t,o,s,a){function n(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;L=t[0].clientX,D=t[0].clientY,b=T,A=C,N=0,_=0}function r(e){var t=e.originalEvent?e.originalEvent.touches:e.touches,s=T-p*S/2+g/2,i=g-(s+p*S),a=C-u*S/2+m/2,n=m-(a+u*S);""===f&&(1===t.length?f="swipe":2===t.length&&(f="pinch",w=S,v=l(t),P=t[0].clientX-parseInt((t[0].clientX-t[1].clientX)/2,10)-o.find("img")[0].offsetLeft-b,x=t[0].clientY-parseInt((t[0].clientY-t[1].clientY)/2,10)-o.find("img")[0].offsetTop-A)),"swipe"===f?(e.preventDefault(),N=t[0].clientX-L,_=t[0].clientY-D,T=b+N,C=A+_,d(),s>0&&i>0&&(T=0,d()),a>0&&n>0&&(C=0,d())):"pinch"===f&&(e.preventDefault(),h=l(t),I=h/v,S=I*w,T=P*(1-I)+b+N,C=x*(1-I)+A+_,d(),T=0,C=0,d())}function c(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;if(!(""===f||t.length>0)){S<1?(S=1,T=0,C=0):S>y&&(S=y,I=S/w,T=P*(1-I)+b+N,C=x*(1-I)+A+_);var o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S);o>0&&s<0?(T=p*S/2-g/2,d()):o<0&&s>0&&(T=g/2-p*S/2,d()),i<0&&a>0?(C=m/2-u*S/2,d()):i>0&&a<0&&(C=u*S/2-m/2,d()),o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S),i>0&&a>0&&(C=0,d()),o>0&&s>0&&(T=0,d()),o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S),d(.1),f=""}}function l(e){var t=Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2));return parseInt(t,10)}function d(e){var t=e?"all cubic-bezier(0,0,.5,1) "+e+"s":"",s=[S,0,0,S,T,C],i="matrix("+s.join(",")+")";o.find("img").css({"-webkit-transition":t,transition:t,"-webkit-transform":i+" translate3d(0,0,0)",transform:i})}var p,u,g,m,f="",h=0,v=0,S=(!!window.cordova&&ionic.Platform.platform().indexOf("ios"),1),I=1,w=1,y=parseInt(s.maxScale,10);(isNaN(y)||y<=1)&&(y=20);var T=0,C=0,b=0,A=0,P=0,x=0,L=0,D=0,N=0,_=0;g=$(".LightBox").width(),m=$(".LightBox").height(),t.Url="",t.bigImage=!1,t.noreload=!1,t.showBigImage=function(s,i){"VIDEO"!=s.target.tagName&&void 0!=s.target.currentSrc&&(s.stopPropagation(),t.Url=s.target.currentSrc,e.picBigUrl=t.Url,t.bigImage=!0,$(".LightBox").show(150,function(){$("ion-header-bar").hide(),$(".Main .tab-nav").hide(),$(".LightBox .ImgViewer img").each(function(){$(this).css({width:"90%"}),p=$(this).width(),u=$(this).height(),$(this).css({marginLeft:p/2*-1,marginTop:u/2*-1})})}),o.find("img").on("touchstart",n),o.find("img").on("touchmove",r),o.find("img").on("touchend",c))},t.hideBigImage=function(){t.bigImage=!1,t.noreload=!0,i(function(){t.noreload=!1},500),$("ion-header-bar").show(),$(".Main .tab-nav").show(),$(".LightBox").hide(200),f="",h=0,v=0,S=1,I=1,w=1,y=parseInt(s.maxScale,10),(isNaN(y)||y<=1)&&(y=20),T=0,C=0,b=0,A=0,P=0,x=0,L=0,D=0,N=0,_=0,d()}},post:function(e,t,o,s){}}}}]),APP.directive("myfocus",["$timeout","$parse",function(e,t){return{link:function(o,s,i){var a=t(i.myfocus);o.$watch(a,function(t){!0===t?e(function(){s[0].focus()}):!1===t&&e(function(){s[0].blur()})})}}}]),APP.filter("trusted",["$sce",function(e){return function(t){return"string"==typeof t?e.trustAsHtml(t):t}}]),APP.controller("NoteDetailsController",["ionicDatePicker","$localstorage","CirclePageService","HomePageService","$scope","$ionicHistory","$rootScope","$compile","$state","$ionicModal","$stateParams","$http","NoteDetailsService","$ionicLoading","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","$timeout","$ionicActionSheet","PopupService","UrlService","UserService","CreditService","PlatformService","$location",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b){function A(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function P(){var e=b.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&p({method:"POST",url:w.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){y.setUser(e.data),t.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}self.touchStart=function(e){if(self.startCoordinates=getPointerCoordinates(e),!ionic.tap.ignoreScrollStart(e)){if(ionic.tap.containsOrIsTextInput(e.target))return void(self.__hasStarted=!1);self.__isSelectable=!0,self.__enableScrollY=!0,self.__hasStarted=!0,self.doTouchStart(e.touches,e.timeStamp)}},i.isDisplay=!1,i.inputShow=!0,i.praiseNum={},i.commentId="",i.circleId,i.circleDetail,i.commentList,i.products="",i.iconImageData=[],i.imgUrlList=[],i.isImage=!1,i.showBigImg=!1,i.showBac=!1,i.imgString="",i.isPublishImage=!1,i.imgA=[],i.showBigBac=!1,i.shanList="",i.commentIndex=1,i.commentWords={words:""},i.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],i.pinglunis=!1,i.topicheight=0,i.comment={text:"",rows:1},i.noteDetail={reply:"说点什么"},i.$watch("noteDetail.reply",function(e,t,o){}),i.goBack=function(){662==i.circleDetail.topicId?c.go("circlePage",{circleId:662}):665==i.circleDetail.topicId?c.go("circlePage",{circleId:665}):(i.$ionicGoBack(),n.nextPageBefore="noteDetails")},i.goshare=function(){if(!y.getUser().mid)return void c.go("login");i.showShare=!i.showShare,i.isDisplay=!1,u.getShop().success(function(e){e.success&&e.data?i.shareUserId=i.userId:i.shareUserId=null})},i.inCirclePage=function(e){c.go("circlePage",{circleId:e})},i.inPersonalPage=function(e){0!=e&&(e==y.getUser().mid?c.go("personalHomepageMe"):c.go("personalHomepageHe",{othersId:e}))},i.goShop=function(){c.go("myStore",{storeId:i.userId,shareStoreId:""})},i.jumpMsg=function(){c.go("ClassifyMessageCenter")},i.isClick=function(){i.isDisplay=!i.isDisplay},i.downLoadPhoto=function(e){i.photoUrl=n.picBigUrl,n.isApp&&(n.isIOS?S.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){n.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(n.picBigUrl,function(e){I.showToast("保存成功")},function(e){I.showToast("保存失败")})}}):S.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){n.$broadcast("LOADING:SHOW");var e=new FileTransfer,t=encodeURI(i.photoUrl);return e.download(t,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){n.$broadcast("LOADING:HIDE"),I.showToast("保存成功")},function(e){n.$broadcast("LOADING:HIDE"),I.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}}))},i.bigvideo=function(e){n.globalConstant.showvideo=!0,v(function(){$(".video-src1").attr("src",i.video)},100)},i.hideVideo=function(e){e.target.previousElementSibling.pause(),n.globalConstant.showvideo=!1},i.playing=function(e){e.target.style.display="none",e.target.nextElementSibling.play(),i.targetv=e.target.nextElementSibling,i.targetv.addEventListener("ended",function(){e.target.style.display="block"})},i.editTopic=function(){1==i.circleDetail.isReward?1==i.circleDetail.rewardStatus?I.showToast("该悬赏贴已关闭，不能修改"):i.commentList.length>0?I.showToast("该悬赏贴已有评论，不能修改"):c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:2}):i.video?c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:3}):c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:1})},i.showCommentView=function(e){i.commentId=e;m.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:i,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){i.isOne&&(i.isOne=!1,i.insertComments())}}]});v(function(){},3e3)},i.isInputShow=function(){i.inputShow=!i.inputShow},i.pinglunshow=function(){var e=f.$getByHandle("pinglun"),t=e.getScrollPosition(),o=t.top,s=window.innerHeight-118;i.topicheight=document.getElementById("topicxiang").clientHeight-s,v(function(){i.pinglunis=o>i.topicheight},200)},i.addImage=function(){S.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function s(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},i.xiaoxishow=function(){i.xxshow=0!=i.count.count,i.isshow=!i.isshow,i.xiaoxis=!i.xiaoxis,i.shuxiaoxi=!i.shuxiaoxi},i.favorite=function(){var e={id:i.circleId};u.pushPraise(e).success(function(e){})},i.getCircleDetails=function(){var e={id:i.circleId};u.getCircleDetails(e).success(function(e){i.circleDetail=e.data,662!=i.circleDetail.topicId&&665!=i.circleDetail.topicId||(i.circleIDIF=!0,662==i.circleDetail.topicId?o.getCircleLink("","","1").success(function(e){e.success&&(i.circleUrl=e.data)}):665==i.circleDetail.topicId&&o.getCircleLink("","","3").success(function(e){e.success&&(i.circleUrl=e.data)})),i.circleDetail.mediaInfo&&(i.video=i.circleDetail.mediaInfo[0].url,v(function(){$(".video-src").attr("src",i.video),$(".video-src").attr("poster",i.circleDetail.mainImg)},200)),i.circleDetail.rewardEndTime&&(i.circleDetail.rewardEndTime=i.circleDetail.rewardEndTime.substring(0,10)),i.circleDetail.rewardComment&&(i.circleDetail.rewardComment[0].imgaa=i.circleDetail.rewardComment[0].commentImgs.split(",")),1==i.circleDetail.dataTypeNew&&i.circleDetail.storyImgs&&(i.storyCommityImgs=i.circleDetail.storyImgs.split(",")),i.imgArr=[];for(var t=1;t<=i.circleDetail.mainImgArray.length;t++)i.imgArr.push(t);i.whichPersonType(),1==i.ifShort&&i.circleDetail.productId&&i.productConnect(),i.getA()})},i.follow=function(e){if(0==e){var t={id:i.circleDetail.userCode,isFollow:1};u.followNote(t).success(function(e){1==e.success?(i.circleDetail.isFolled=1,i.alreadyFollow=!0,v(function(){i.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(I.showToast(e.message),n.loginIsAccord2=!0)})}else if(1==e){var t={id:i.circleDetail.userCode,isFollow:0};u.followNote(t).success(function(e){1==e.success?i.circleDetail.isFolled=0:-2e3==e.errorCode&&(I.showToast(e.message),n.loginIsAccord2=!0)})}},i.getComment=function(){i.commentIndex=1;var e=A("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:1,pageSize:10,id:i.circleId,userCode:o?i.weChatOpenId:e};u.getComments(s).success(function(e){i.commentNumbers=e.totalCount,i.commentList=e.data.list,i.commentNumbers>10&&(i.hasmore=!0),i.imgString="",i.imgA=[];for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1,i.commentList[t].commentImgs&&(i.imgString=i.commentList[t].commentImgs,i.imgA=i.imgString.split(","),i.commentList[t].imgaa=i.imgA);f.resize()})},i.loadMore=function(){i.commentIndex=i.commentIndex+1;var e=A("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:i.commentIndex,pageSize:10,id:i.circleId,userCode:o?i.weChatOpenId:e};u.getComments(s).success(function(e){i.commentNumbers=e.totalCount,i.commentList=i.commentList.concat(e.data.list),i.commentNumbers>i.commentList.length?i.$broadcast("scroll.infiniteScrollComplete"):(i.hasmore=!1,I.showToast("没有更多评论了")),i.imgString="",i.imgA=[];for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1,i.commentList[t].commentImgs&&(i.imgString=i.commentList[t].commentImgs,i.imgA=i.imgString.split(","),i.commentList[t].imgaa=i.imgA)})},i.getFocus=function(e,t,o){event.stopPropagation();for(var s=0;s<i.commentList.length;s++)i.commentList[s].ischecked=!1;i.commentWords.words="",i.iconImageData=[],i.isPublishImage=!0,i.showBac=!0,i.commontId=e,i.toSomeone="回复给："+t,setTimeout(function(){document.getElementById("inputId").focus()},200)},i.focuss=function(){s.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==n.isWdHost&&c.go("login")})},i.deleteImg=function(e){i.iconImageData.splice(e,1)},i.showLarge=function(e){i.showBigBac=!0,i.showBigImg=!0,i.Url=e},i.closeBigImg=function(){i.showBigImg=!1,i.showBigBac=!1},i.closeImg=function(){i.images=!1,i.isImage=!1,i.isPublishImage=!1,i.showBac=!1},i.imgPush=function(e){if(i.isImage=!0,i.iconImageData.length>=9)return void I.showToast("最多添加9张");S.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){var t={imgUrl:e};v(function(){i.iconImageData.push(t),i.existPhoto=!0},200)}function o(){}if(0==e)return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==e){var s=9-i.iconImageData.length;return window.imagePicker.getPictures(function(e){for(var t=0;t<e.length;t++){var o={imgUrl:e[t]};i.iconImageData.push(o)}i.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},i.insertCom=function(e){s.isWdHost().success(function(t){if(n.isWdHost=t.data.isHost,-1==n.isWdHost)c.go("login");else if(window.cordova&&(n.gio.track("comment",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId})),"IMG"==e.target.nodeName)if(i.commontId){var o={commentId:i.commontId,commentImgs:e.target.src,id:i.circleId};i.insertCommentOK(o)}else{var o={commentImgs:e.target.src,id:i.circleId};i.insertCommentOK(o)}})},i.insertComments=function(){s.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==n.isWdHost)c.go("login");else{window.cordova&&(n.gio.track("comment",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId}));var t=0;if(i.commentWords.words){var o={keywords:i.commentWords.words};h.judgeWords(o).success(function(e){"没有敏感词"==e.message?0==i.iconImageData.length?(i.iconImageData=[],i.imgUrlList=[],i.publishTopic()):angular.forEach(i.iconImageData,function(e,o){var s=function(e){g.hide(),t++;var s=JSON.parse(e.response),a=s.urls;i.imgUrlList[o]=a,t==i.iconImageData.length&&i.publishTopic()},a=function(e){g.hide()},n={},r=new FileTransfer;r.upload(e.imgUrl,encodeURI(u.uploadImage()),s,a,n)}):(I.showToast("存在敏感词",e.data),i.commentWords.words="")})}else I.showToast("内容不能为空")}})},i.nocommontId=function(){i.isDisplay=!1;for(var e=0;e<i.commentList.length;e++)i.commentList[e].ischecked=!1;i.commontId&&(i.commontId="",i.toSomeone="",i.commentWords.words="",i.iconImageData=[])},i.publishTopic=function(e){if(i.commontId){var e={comment:i.commentWords.words,commentId:i.commontId,commentImgs:i.imgUrlList.toString(),id:i.circleId};i.insertCommentOK(e)}else{var e={comment:i.commentWords.words,commentImgs:i.imgUrlList.toString(),id:i.circleId};i.insertCommentOK(e)}},i.insertCommentOK=function(e){u.insertComment(e).success(function(e){i.getComment(),1==e.success?(I.showToast("回复成功"),i.commentWords.words="",i.commontId="",i.toSomeone="",i.iconImageData=[],i.imgUrlList=[],i.isImage=!1,i.isPublishImage=!1,i.showBac=!1,i.images=!1,i.haierImg=!1,i.shunguangImg=!1):(v(function(){I.showToast(e.message)},200),i.commentWords.words="")}).error(function(e){I.showToast("网络异常"),i.commentWords.words=""})},i.topicPraise=function(e){window.cordova&&(n.gio.track("like",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId}));var t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s=A("loginId"),a={id:e,noLoading:!0,userCode:o?i.weChatOpenId:s};u.pushPraise(a).success(function(e){1==e.success?(i.isPraise=!i.isPraise,i.getStoryPraiseNum()):I.showToast(e.message)})},i.topicFavorite=function(e){var t={id:e,noLoading:!0};u.topicFavorite(t).success(function(e){1==e.success?(i.isFavorite=!i.isFavorite,i.getStoryPraiseNum()):-2e3==e.errorCode?(I.showToast(e.message),n.loginIsAccord2=!0):I.showToast(e.message)})},i.goToScore=function(e){if("IMG"==e.target.tagName&&(i.noreload||i.showBigImage(e)),$(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),$(".noteContent a").removeAttr("href"),"linklink dot-block"==e.target.className)if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else{var t=e.target.outerText;i.tolink(t)}else if("all-to"==e.target.className)if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;i.tolink(t)}else{var t=e.target.outerText;i.tolink(t)}else if("atopic"==e.target.className){if(e.target.attributes["data-a"]){var t=e.target.attributes["data-a"].value;i.tolink(t)}else if(e.target.attributes.dataa){var t=e.target.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.className){if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.attributes.dataa){var t=e.target.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.className){if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.className)if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}},i.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==C.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==C.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.getA=function(){v(function(){$(".detailEditor .editor a").html(function(e,t){if(!this.attributes["data-a"])return t;if(this.attributes["data-a"].value){this.setAttribute("href",this.attributes["data-a"].value);var o=this.attributes["data-a"].value;return'<div class="all-to"><img class="imgimg" src="'+i.imgBaseURL+'/img/link.png"/><span class="linklink dot-block">'+o+"</span></div>"}})},20),v(function(){$(".detailEditor .editor div").removeAttr("contenteditable"),$(".detailEditor .editor div").addClass("copy")},30),v(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},100),v(function(){$(".detailEditor .editor .imgHeight").css({height:"auto",width:"auto","background-image":"none"}),$(".detailEditor .editor .imgHeight img").css({width:"100%",display:"block"}),$(".detailEditor .editor .imgHeight span").css({display:"none"}),$(".detailEditor .editor span").css("font-size","12px")},60)},i.topicShan=function(e){i.images=!1,i.haierImg=!1,i.shunguangImg=!1,1==i.circleDetail.isReward?I.showToast("该话题是悬赏话题，不能被打赏"):(i.showShan=!0,i.goldNum(),e?i.shanCommentId=e:(i.shanCommentId="",i.shanTopicId=i.circleId))},i.selectImg=function(){i.images=!0,i.haierImg=!0,i.shunguangImg=!1,i.yearImg=!1},i.selectHaier=function(){i.haierImg=!0,i.shunguangImg=!1,i.yearImg=!1},i.selectshun=function(){i.haierImg=!1,i.shunguangImg=!0,i.yearImg=!1},i.selectYear=function(){i.haierImg=!1,i.shunguangImg=!1,i.yearImg=!0},i.deleteShan=function(){i.reward.num="";for(var e=0;e<i.shanNum.length;e++)i.shanNum[e].isChecked=!1;i.shanGoldNum="",i.showShan=!1},i.clickMore=function(e){if(i.isDisplay=!1,i.commentList[e].ischecked)for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;else{for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;i.commentList[e].ischecked=!0}},i.toRewardList=function(){c.go("topicRewardList",{tipId:i.circleId})},i.selectGod=function(e){if(i.reward.num="",i.shanNum[e].isChecked){for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.shanGoldNum=""}else{for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.shanNum[e].isChecked=!0,i.shanGoldNum=i.shanNum[e].num}},i.otherGoldNum=function(){for(var e=0;e<i.shanNum.length;e++)i.shanNum[e].isChecked=!1;i.shanGoldNum=i.reward.num},i.noticeDownload=function(){n.downAppUrl||I.showToast("不支持该手机")},i.commentPraise=function(e,t){var o=window.navigator.userAgent.toLowerCase(),s="micromessenger"==o.match(/MicroMessenger/i),a=A("loginId"),n={commentId:e.id,noLoading:!0,userCode:s?i.weChatOpenId:a};u.commentPraise(n).success(function(o){if(1==o.success){if(i.circleDetail.rewardComment){if(e.id==i.circleDetail.rewardComment[0].id){i.circleDetail.rewardComment[0].commentPraiseNumberFlag=!i.circleDetail.rewardComment[0].commentPraiseNumberFlag
;for(var s=0;s<i.commentList.length;s++)e.id==i.commentList[s].id&&(i.commentList[s].commentPraiseNumberFlag=!i.commentList[s].commentPraiseNumberFlag)}}else for(var s=0;s<i.commentList.length;s++)e.id==i.commentList[s].id&&(i.commentList[s].commentPraiseNumberFlag=!i.commentList[s].commentPraiseNumberFlag);i.getCommentPraiseNum(e,t)}else I.showToast(o.message)})},i.getStoryPraiseNum=function(){var e=window.navigator.userAgent.toLowerCase(),t="micromessenger"==e.match(/MicroMessenger/i),o=A("loginId"),s={id:i.circleId,noLoading:!0,userCode:t?i.weChatOpenId:o};u.getStoryPraise(s).success(function(e){i.praiseNum=e.data})},i.getCommentPraiseNum=function(e,t){var o=window.navigator.userAgent.toLowerCase(),s="micromessenger"==o.match(/MicroMessenger/i),a=A("loginId"),n={commentId:e.id,noLoading:!0,userCode:s?i.weChatOpenId:a};u.commentPraiseNum(n).success(function(t){if(i.circleDetail.rewardComment){if(e.id==i.circleDetail.rewardComment[0].id){i.circleDetail.rewardComment[0].commentPraiseNumber=t.totalCount;for(var o=0;o<i.commentList.length;o++)e.id==i.commentList[o].id&&(i.commentList[o].commentPraiseNumber=t.totalCount)}}else for(var o=0;o<i.commentList.length;o++)e.id==i.commentList[o].id&&(i.commentList[o].commentPraiseNumber=t.totalCount)})},i.startTime=function(){if("APP"==C.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){v(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear(),a=new Date(e);a.setDate(e.getDate()+7);var n=a.getMonth()+1;n<10&&(n="0"+n),o<10&&(o="0"+o),t<10&&(t="0"+t);var r=s+"-"+o+"-"+t;i.start=r,i.end=a.getFullYear()+"-"+n+"-"+a.getDate()},200)})}else{var o={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e);i.startOk=new Date(e);var o=new Date(e);i.endOk=o,o.setDate(t.getDate()+7);var s=new Date(e).getMonth()+1,a=new Date(e).getDate();s<10&&(s="0"+s),a<10&&(a="0"+a);var n=new Date(e).getFullYear()+"-"+s+"-"+a;i.start=n,i.end=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()}};e.openDatePicker(o)}},i.endTime=function(){if("APP"==C.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){v(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t);var a=s+"-"+o+"-"+t;i.end=a},200)})}else{var o={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:i.startOk,to:i.endOk,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);var s=new Date(e).getFullYear()+"-"+t+"-"+o;i.end=s}};e.openDatePicker(o)}},i.selectStartEnd=function(){i.topStyle=1,i.startend="img/ic_select.png",i.day="img/ic_check.png"},i.selectDay=function(){i.topStyle=0,i.day="img/ic_select.png",i.startend="img/ic_check.png"},i.deleteTop=function(){i.showTop=!1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"},i.deleteJing=function(){i.showJing=!1,i.topStyle=3,i.topicJing=!0,i.isFirstJing=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"},i.selectTop=function(){i.showTop=!0},i.selectJing=function(){i.showJing=!0},i.topicTopOK=function(){i.personType.isSuperManager&&(i.topicTop?i.topicTop=!1:i.topicTop=!0)},i.topicJingOK=function(){i.personType.isSuperManager&&(i.topicJing?i.topicJing=!1:i.topicJing=!0)},i.firstTop=function(){i.isFirstTop?i.isFirstTop=!1:i.isFirstTop=!0},i.firstJing=function(){i.isFirstJing?i.isFirstJing=!1:i.isFirstJing=!0},i.topPosts=function(){if(i.isFirstTop||i.topicTop)if(0==i.topStyle||1==i.topStyle){if(1==i.topStyle){if(i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:3};i.okTop(e)}else if(i.isFirstTop&&!i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:2};i.okTop(e)}else if(!i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:1};i.okTop(e)}}else if(0==i.topStyle)if(i.topTopic.day){var t=parseInt(i.topTopic.day);if(t>0)if(t<30){if(i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:3};i.okTop(e)}else if(i.isFirstTop&&!i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:2};i.okTop(e)}else if(!i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:1};i.okTop(e)}}else I.showToast("置顶天数不能超过30天，请重新输入");else I.showToast("置顶天数需大于0天，请重新输入")}else I.showToast("请输入置顶天数")}else I.showToast("请选择置顶时间");else I.showToast("请选择置顶位置")},i.okTop=function(e){u.topStory(e).success(function(e){e.success?(I.showToast("置顶成功"),i.circleDetail.isTopicTop=!0,i.showTop=!1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"):I.showToast(e.message)})},i.JingPosts=function(){if(i.isFirstJing||i.topicJing)if(0==i.topStyle||1==i.topStyle){if(1==i.topStyle){if(i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:3};i.okJing(e)}else if(i.isFirstJing&&!i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:2};i.okJing(e)}else if(!i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:1};i.okJing(e)}}else if(0==i.topStyle)if(i.topTopic.day){var t=parseInt(i.topTopic.day);if(t>0)if(t<30){if(i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:3};i.okJing(e)}else if(i.isFirstJing&&!i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:2};i.okJing(e)}else if(!i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:1};i.okJing(e)}}else I.showToast("设置精华天数不能超过30天，请重新输入");else I.showToast("置顶天数需大于0天，请重新输入")}else I.showToast("请输入天数")}else I.showToast("请选择精华时间");else I.showToast("请选择精华位置")},i.okJing=function(e){u.JingStory(e).success(function(t){t.success?(I.showToast("设置精华成功"),i.circleDetail.isChoice=e.topicChoice,i.showJing=!1,i.topStyle=3,i.topicJing=!0,i.isFirstJing=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"):I.showToast(t.message)})},i.cancelTop=function(){var e={storyId:i.circleId};u.cancelTop(e).success(function(e){e.success?(i.circleDetail.isTopicTop=!1,i.circleDetail.isTop=!1,I.showToast(e.message)):I.showToast(e.message)})},i.cancelJing=function(){var e={storyId:i.circleId};u.cancelJing(e).success(function(e){e.success?(i.circleDetail.isChoice=0,I.showToast(e.message)):I.showToast(e.message)})},i.deleteStory=function(){var e={storyId:i.circleDetail.id};u.deleteTopic(e).success(function(e){1==e.success?(I.showToast("话题删除成功"),n.ifDeleteNoteList=!0,c.go("circlePage",{circleId:i.circleDetail.topicId})):I.showToast(e.message)})},i.warnDelete=function(e){if(i.isDisplay=!1,i.commentId=e,1==i.circleDetail.isReward&&0==i.circleDetail.rewardStatus){m.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>该话题是悬赏话题，删除金币不退回，确认删除吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){i.deleteStory()}},{text:"放弃"}]})}else{m.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除话题吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){i.deleteStory()}},{text:"放弃"}]})}v(function(){},3e3)},i.warnDeleteComments=function(e){i.isDisplay=!1,i.deleteId=e;m.show({template:'<img src="{{imgBaseURL}}img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:i,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){i.deleteComment()}}]});v(function(){},3e3)},i.deleteComment=function(e){var t={id:i.deleteId};u.deleteStory(t).success(function(e){1==e.success?(I.showToast("删除成功"),i.getComment()):I.showToast(e.message)})},i.productConnect=function(){var e={productId:i.circleDetail.productId,userCode:i.userShareId?i.userShareId:i.circleDetail.userCode};u.connectProduct(e).success(function(e){e.success&&(i.products=e.data.list)})},i.toProductDetail=function(e){c.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},i.whichPersonType=function(){var e={storyId:i.circleDetail.id,topicId:i.circleDetail.topicId};u.getPersonType(e).success(function(e){1==e.success&&(i.personType={isAdmin:e.data.isAdmin,isCreateStory:e.data.isCreateStory,isSuperManager:e.data.isSuperManager,isCircleManager:e.data.isCircleManager})})},i.shareToStore=function(){var e={flag:1,storyId:i.circleDetail.id};u.shareStore(e).success(function(e){e.success})},i.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),v(function(){I.showToastShort("复制成功")},200)):I.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){-1!=b.absUrl().indexOf("token")&&b.search("token","null");var t=i.circleDetail.storyName?i.circleDetail.storyName+"-顺逛微社区":i.circleDetail.userName+"的话题-顺逛微社区",o=i.circleDetail.storyContentText.substr(0,30)||"马上进入，参与话题讨论吧...",s=i.circleDetail.mainImgArray[0]?i.circleDetail.mainImgArray[0]:"http://www.ehaier.com/mstatic/wd/v2/img/sg.png";if(i.shareUserId)var a=w.getShareLinkHeader()+"noteDetails/"+i.circleId+"/"+i.ifShort+"/"+i.shareUserId;else var a=w.getShareLinkHeader()+"noteDetails/"+i.circleId+"/"+i.ifShort+"/";if(window.umeng){var n={topicId:i.circleId},r=function(e){T.shareSuccessCallback(e,n)};0==e?window.umeng.shareToSina(t,o,s,a,0,null,r):1==e?window.umeng.shareToWechatSession(t,o,s,a,0,null,r):2==e?window.umeng.shareToWechatTimeline(t,o,s,a,0,null,r):3==e?(window.umeng.shareToQQ(t,o,s,a,0,null,r),T.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,a,0,null,r),T.qqShare()),5==e?i.copeText(a):T.successShare()}else alert("umeng undefined 只能在app分享");i.showShare=!1,i.shareToStore()},i.closeDownload=function(){i.ifDownload=!1},i.goldNum=function(){u.getGold().success(function(e){e.success?e.data>9999?i.canShanGold=9999:e.data<0?i.canShanGold=0:i.canShanGold=e.data:-2e3==e.errorCode?(I.showToast(e.message),i.showShan=!1,n.loginIsAccord2=!0):i.showShan=!1})},i.getShanList=function(){var e={tipId:parseInt(i.circleId),pageIndex:1,pageSize:10,type:1};u.getList(e).success(function(e){i.shanList=e.data})},i.shanTopic=function(){i.shanCommentId=i.shanCommentId+"",i.shanGoldNum?i.shanOK():i.reward.num?(i.shanGoldNum=parseInt(i.reward.num),i.shanOK()):I.showToast("请选择打赏金币")},i.shanOK=function(){if(i.shanGoldNum<=9999)if(i.shanGoldNum<=i.canShanGold)if(i.shanCommentId.length>0){var e={commentId:i.shanCommentId,amount:i.shanGoldNum};u.shanComment(e).success(function(e){if(e.success){i.showShan=!1,I.showToast("打赏成功"),v(function(){i.getShanList()},1e3);for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;for(var o=0;o<i.shanNum.length;o++)i.shanNum[o].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanCommentId=""}else I.showToast(e.message)})}else{var t={storyId:parseInt(i.shanTopicId),amount:i.shanGoldNum};u.shanTopic(t).success(function(e){if(e.success){i.showShan=!1,I.showToast("打赏成功"),v(function(){i.getShanList()},1e3);for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanTopicId=""}else{i.showShan=!1;for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanTopicId="",I.showToast(e.message)}})}else I.showToast("您的金币数不足，请修改打赏金额");else I.showToast("最多可打赏9999金币，请修改打赏金额")},i.gotoothers=function(e){c.go("personalHomepageHe",{othersId:e.userId})},i.cangComment=function(e){var t={id:e.id,isDisplay:e.isDisplay};u.cangComment(t).success(function(e){e.success?(I.showToast(e.message),v(function(){i.getComment()},1e3)):I.showToast(e.message)})},i.cangTopic=function(){var e={storyId:i.circleId};u.cangTopic(e).success(function(e){e.success?i.getCircleDetails():I.showToast(e.message)})},i.delCangTopic=function(){var e={storyId:i.circleId};u.delCangTopic(e).success(function(e){e.success?i.getCircleDetails():I.showToast(e.message)})},i.topicAgree=function(e){m.show({template:"<div>您是否确认采纳该回复？</div>",title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:i,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){var o={storyId:i.circleId,commentId:e};u.topicAgree(o).success(function(e){e.success?(I.showToast("已经被采纳"),i.getCircleDetails(),i.getStoryPraiseNum(),i.getComment()):I.showToast(e.message)})}}]})},i.init=function(){i.images=!1,i.haierImg=!1,i.shunguangImg=!1,n.globalConstant.showvideo=!1,i.commentIndex=1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.topicJing=!0,i.isFirstJing=!1,i.showJing=!1,i.topTopic={day:5},i.startend="img/ic_check.png",i.day="img/ic_check.png";var e=new Date,t=parseInt(e.getMonth())+1,o=new Date(e);o.setDate(e.getDate()+7);var s=parseInt(o.getMonth())+1;i.start=e.getFullYear()+"-"+t+"-"+e.getDate(),i.end=o.getFullYear()+"-"+s+"-"+o.getDate(),i.shareUserId=null,i.userShareId=d.shareStoreId,i.circleId=d.noteId,i.circleIDIF=!1,i.shanList="",n.ifDeleteNoteList=!1,i.reward={num:""},i.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],i.getShanList(),i.userId=y.getUser().mid,window.cordova?i.ifInApp=!1:i.ifInApp=!0,i.ifDownload=!0,i.toSomeone="",i.showQQ=!1,i.showWeChat=!1,i.showShare=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){i.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){i.showWeChat=0!=e})),i.commentWords={words:""},i.showShare=!1,i.isFavorite=!0,i.isPraise=!0,i.isDisplay=!1,i.ifShort=d.isShortStory,i.personType={isAdmin:!1,isCreateStory:!1},i.getCircleDetails(),i.getStoryPraiseNum(),i.getComment(),l.fromTemplateUrl("templates/quanzi/TopDaysModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.selectModal=e})},i.wechatOpenId=function(){u.getWeChatOpenId().success(function(e){e.success&&(e.data?(i.weChatOpenId=e.data,u.weChatOpenId=e.data,i.init()):i.wechatUrlOpenId())})},i.wechatUrlOpenId=function(){var e=b.absUrl();u.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},i.$on("$ionicView.beforeEnter",function(){P(),window.location.hash=b.path(),i.isIOS=!!ionic.Platform.isIOS(),n.$on("$stateChangeStart",function(e,t,o,s,i){if("noteDetails"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()}),ionic.Platform.isAndroid()&&(i.hideBigImage(),$(".LightBox").hide(0)),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?s.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==n.isWdHost?i.wechatOpenId():i.init()}):i.init()}),i.$on("$ionicView.beforeLeave",function(){$("ion-header-bar").show(),$(".Main .tab-nav").show()}),i.gotoCompare=function(){},i.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)},i.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)}}]),APP.service("NoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.deleteTopic=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETE_COMMON_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("TOPIC_PRAISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("COMMON_COMMENT"),data:o})},this.topStory=function(o){return e.get(t.getUrl("CIRCLE_TOP_TOPIC"),o)},this.JingStory=function(o){return e.get(t.getUrl("CIRCLE_JING_TOPIC"),o)},this.cancelJing=function(o){return e.get(t.getUrl("CIRCLE_JING_CANCLE"),o)},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("INSERT_COMMON_COMMENT"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GET_STORY_PRAISE"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("COMMENT_STORY_PRAISE"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})},this.cancelTop=function(o){return e.get(t.getUrl("CANCEL_TOP"),o)},this.cangComment=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_CANG_COMMENT"),data:o})},this.cangTopic=function(o){return e.get(t.getUrl("CIRCLE_CANG_TOPIC"),o)},this.delCangTopic=function(o){return e.get(t.getUrl("CIECLE_DEL_CANG_TOPIC"),o)},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getGold=function(){return e.get(t.getUrl("CIRCLE_GET_GOLD"))},this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)},this.getShop=function(o){return e.get(t.getUrl("CIRCLE_SELECT_SHOP"))},this.topicAgree=function(o){return e.get(t.getUrl("CIRCLE_AGREE"),o)},this.shanTopic=function(o){return e.get(t.getUrl("CIRCLE_SHAN_TOPIC"),o)},this.shanComment=function(o){return e.get(t.getUrl("CIRCLE_SHAN_COMMENT"),o)},this.getWeChatOpenId=function(){return e({method:"POST",url:t.getUrl("GET_WECHAT_OPENID")})},this.getWeChatUrlOpenId=function(o){var s={url:o};return e.post(t.getUrl("GET_WECHAT_URL")+"?url="+encodeURIComponent(s.url))},this.weChatOpenId=""}]),APP.controller("PublishCircleController",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicLoading","$ionicActionSheet","PublishCircleService","ApplyCircleService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.identifyCode="",e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.goSelectGoods=function(){o.go("selectGoods")},e.judgeWords=function(){var t={keywords:e.publishInfo.storyContent};c.judgeWords(t).success(function(e){"没有敏感词"==e.message||d.showToast(e.message)})},e.$watch("publishInfo.storyContent",function(){p.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&d.showToast("话题内容不得超过500字")}),e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.publishClick=function(s){if(s.mainImg=e.imgUrlList.toString(),e.publishInfo.topicId=e.topicId,0!=e.publishInfo.storyContent.length||e.iconImageData.length)if(e.publishInfo.storyContent.length>500)d.showToast("话题内容不得超过500字");else if(e.iconImageData.length!=e.imgUrlList.length)d.showToast("图片正在上传，请稍后再试");else{var i={keywords:e.publishInfo.storyContent};c.judgeWords(i).success(function(i){"没有敏感词"==i.message?r.publish(s).success(function(s){1==s.success?(d.showToast("发布成功"),t.publishSuccess=!0,l(function(){t.publishSuccess=!1},1e3),e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("circlePage",{circleId:e.topicId})):d.showToast(s.message)}).error(function(){}):d.showToast("存在敏感词",i.data)})}else e.publishNotice=!0,l(function(){e.publishNotice=!1},1e3)},e.imgUrlList=[],e.addPicture=function(){function t(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},i=function(e){a.hide()},n={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),s,i,n)}function o(){}return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0},e.photoAlbum=function(){var t=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s);var i=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){a.hide()},c={};(new FileTransfer).upload(s.imgUrl,encodeURI(r.uploadImage()),i,n,c)}e.$apply()},function(e){},{maximumImagesCount:t,width:800,quality:50}),!0},e.imgPush=function(t){if(e.iconImageData.length>=9)return void d.showToast("最多添加9张");n.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},i=function(e){a.hide()},n={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),s,i,n)}function s(){}if(0==t)return navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var i=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s);var i=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){a.hide()},c={};(new FileTransfer).upload(s.imgUrl,encodeURI(r.uploadImage()),i,n,c)}e.$apply()},function(e){},{maximumImagesCount:i,width:800,quality:50}),!0}}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.wordsNum=500,e.showBigImage=!1,e.iconImageData=[],e.publishInfo.storyContent="",e.topicId=s.topicId,e.identifyCode=s.identifierCode,1==e.identifyCode?e.addPicture():2==e.identifyCode&&e.photoAlbum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishCircleService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("SUBMIT_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.controller("PublishEditController",["$scope","$rootScope","$state","$stateParams","PublishEditService","PopupService","$timeout","$ionicActionSheet","$ionicLoading","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.identifyCode="",e.publishInfo={id:s.topicId,mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.$watch("publishInfo.storyContent",function(){l.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&a.showToast("话题内容不得超过500字")}),e.getNoteDetail=function(){e.iconImageData=[],e.imgUrlList=[];var t={id:s.topicId};i.getDetails(t).success(function(t){e.detailData=t.data,e.publishInfo.storyContent=e.detailData.storyContent;for(var o=0;o<e.detailData.mainImgArray.length;o++){var s={imgUrl:e.detailData.mainImgArray[o]};e.imgUrlList.push(e.detailData.mainImgArray[o]),e.iconImageData.push(s)}})},e.publishClick=function(r){var c={keywords:e.publishInfo.storyContent};i.judgeWords(c).success(function(c){"没有敏感词"==c.message?(e.publishInfo.mainImg=e.imgUrlList.toString(),0!=e.publishInfo.storyContent.length||e.publishInfo.mainImg?e.iconImageData.length!=e.imgUrlList.length?a.showToast("图片正在上传，请稍后再试"):i.publish(r).success(function(i){1==i.success?(a.showToast("发布成功"),t.editSuccess=!0,n(function(){t.editSuccess=!1},1e3),e.publishInfo={id:s.topicId,mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("noteDetails",{noteId:e.circleId,isShortStory:e.ifShort})):a.showToast(i.message)}).error(function(){}):(e.publishNotice=!0,n(function(){e.publishNotice=!1},1e3))):a.showToast("存在敏感词",c.data)}).error(function(){})},e.imgUrlList=[],e.imgPush=function(t){if(e.iconImageData.length>=9)return void a.showToast("最多添加9张");r.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};n(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){c.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(i.uploadImage()),s,a,r)}function s(){}function a(){}function r(t){var o={imgUrl:t};e.iconImageData.push(o),e.existPhoto=!0,n(function(){for(var t=0;t<e.iconImageData.length;t++);},200);var s=function(t){c.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(i.uploadImage()),s,a,r)}return 0==t?(navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(r,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.showBigImage=!1,e.circleId=s.noteId,e.ifShort=s.isShortStory,e.getNoteDetail()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishEditService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("UPDATE_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})}}]),APP.controller("QuestionDetailsController",["$scope","$rootScope","$state","$stateParams","QuestionDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r){e.getListDate={wordsId:"",pageSize:"",pageIndex:""},e.answerDate={wordsContent:"",courseId:"",parentId:""},e.init=function(){e.wordId=s.wordsId,e.getQuestionList()},e.getQuestionList=function(){var t={wordsId:e.wordId,pageSize:10,pageIndex:1};i.getQuestionDetail(t).success(function(e){}).error(function(){})},e.commitAnswer=function(){e.answerDate={wordsContent:"",courseId:"",parentId:""},i.answerQuestion(e.answerDate).success(function(e){}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QuestionDetailsService",["$http","UrlService",function(e,t){this.answerQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})},this.getQuestionDetail=function(o){return e({method:"POST",url:t.getUrl("GET_QUESTION_DETAILS"),data:o})}}]),APP.controller("SchoolGroupDiscussController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,$)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);t.data.message=t.response.imageUrl,t.data.fileType=".jpg",t.data.companyId=void 0,e.$apply(function(){e.messages.push(t.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};m.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})}function $(e){alert("上传失败")}function S(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function I(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:void 0},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode};c.getUser();e.groupId=55,e.token="21CB91E8209EA98369F5E504449497D7",e.sgdMode=0,e.toggleMode=function(t){e.sgdMode=t},e.miniTaolun=[{msg:33333},{msg:"erfjwqefjwiqawijofejwjfwe"},{msg:"大事发生反饥饿叫啊喂哦 i 发尾峰"},{msg:"一张图片"}],e.isClick=function(){e.isDisplay=!e.isDisplay},e.toMemberList=function(){i.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||m.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["exp_colum6","sss"],values:[1111222,333]};m.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId)}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token};r.getMsg(t).then(function(t){if(t&&t.data&&t.data.msgs&&0!=t.data.msgs.length)for(var o=0;o<t.data.msgs.length;o++)m.filtMsg(t.data.msgs[o]),t.data.msgs[o].message&&e.messages.push(t.data.msgs[o])},function(e){alert(e)})},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};r.sendMsg(t).then(function(o){if(o){var s={message:t.msg,companyId:void 0};m.filtMsg(s),e.messages.push(s)}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};m.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(){d.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){p.getPicture(e,f,h)}})},e.play=function(){var e=document.getElementById("audioInSD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,
e.loopRecord(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){p.startCapture("sourceInSD","audioInSD")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){p.stopCapture("sourceInSD","audioInSD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,o=o.replace(/8181/,"8082"),s.data.message="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(s.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};m.addEvent(i).then(function(t){t?a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败")})},y=function(e){alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){e.CustumerParam.msg=e.CustumerParam.msg+"["+t+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.messages=[{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{message:"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 ",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:2}];var i={message:"aaf啊积极饿哇  啊发[1]",companyId:1234,userName:"我zou是路飞啊啊啊",idCate:0};m.filtMsg(i),e.messages.push(i),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",S),window.addEventListener("native.keyboardhide",I),p.addAudioEventOnWindow()});var T=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",S),window.removeEventListener("native.keyboardhide",I)}),e.goBack=function(){e.$ionicGoBack()}}]),APP.directive("resizeFootBarsd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-sd"),a=e.$getByHandle("cdScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("SelectGoodsController",["$scope",function(e){e.init=function(){},e.$on("$ionicView.beforeEnter",function(){})}]),APP.service("SelectGoodsService",["$http","UrlService",function(e,t){}]),APP.controller("SelectTagsController",["$scope","$rootScope","$state","$stateParams","SelectTagsService","PopupService","$timeout","$ionicScrollDelegate","$interval",function(e,t,o,s,i,a,n,r,c){t.frequentTags="",t.storeId=[],t.storeNames=[],t.nameStringToObj=[],t.addedTags=t.addedTags,e.namedTags="",e.isShow=!1,e.init=function(){e.phoneHeight=document.documentElement.clientHeight/2,e.getScrollHeight=function(){e.scrollHeight=document.getElementById("aaa").scrollTop},e.timer=c(function(){e.scrollHeight=document.getElementById("aaa").scrollTop,e.scrollHeight>e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},100),e.isShow=!1,t.nameStringToObj=[],t.frequentTags.length||(e.getFrequentlyTags(),t.storeId=[],t.storeNames=[],t.nameStringToObj=[])},e.goBack=function(){c.cancel(e.timer);for(var s=0;s<t.storeNames.length;s++){var i={name:t.storeNames[s]};t.nameStringToObj.push(i)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.getFrequentlyTags=function(){var e={id:t.reviewCircleId?t.reviewCircleId:""};i.getTags(e).success(function(e){if(t.frequentTags=e.data.list,e.data.list1){for(var o=0;o<e.data.list1.length;o++)t.storeId.push(e.data.list1[o].id);for(var s=0;s<e.data.list2.length;s++)t.storeNames.push(e.data.list2[s].name)}})},e.backApply=function(){c.cancel(e.timer);for(var s=0;s<t.storeNames.length;s++){var i={name:t.storeNames[s]};t.nameStringToObj.push(i)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.showInput=function(){e.isShow=!0,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.scrollToTop=function(){r.$getByHandle("mainScroll").scrollTop(),e.showTopBtn=!1},e.submitNamedTags=function(){var o={tagName:e.namedTags};if(o.tagName){for(var s=1,r=0;r<t.addedTags.length;r++){if(t.addedTags[r].name==o.tagName){a.showToast(response.message),s=0;break}s=1}1==s&&i.confirmTag(o).success(function(o){if(1==o.data)if(t.addedTags.length<5){var s={name:e.namedTags};t.addedTags.push(s),e.namedTags="",n(function(){e.isShow=!1},200)}else a.showToast("最多添加5个自定义标签");else a.showToast(o.message)})}else a.showToast("标签名不能为空");e.deleteTags=function(e){t.addedTags.splice(e,1)}},e.ifClicked=function(e,o,s,i){if(1==s)for(var n=0;n<=t.storeId.length;n++)t.storeId[n]==o&&(t.storeId.splice(n,1),t.storeNames.splice(n,1),t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked);else t.storeId.length<10?(t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked,t.storeId.push(o),t.storeNames.push(i)):a.showToast("最多选择10个")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SelectTagsService",["$http","UrlService",function(e,t){this.getFrequentTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.confirmTag=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGNAME"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})}}]),APP.controller("ServiceConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","ServiceConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","CustomerConversationService","$ionicPopup","$stateParams","MediaService","FileUploadService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){function S(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.cId;$.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},w,y)}function I(e){alert("得到图片失败")}function w(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);o.data.message="图片文件";var s=o.data.imageUrl,i={imageUrl:s,fileType:".jpg",msg:"图片文件"};e.$apply(function(){e.messages.push(i)}),r.sendMsg(e.chatId,e.receiverId,"m",s,e.token).then(function(e){e&&e.data&&0==e.data.rt||alert("发送信息失败")})}function y(e){alert("上传失败")}function T(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function C(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.second=9,e.CustumerParam={msg:""},e.messages=[],e.token=c.getUser().sessionValue,e.cId=void 0,e.csTimer=void 0,e.receiverId="",e.chatId=void 0,e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.cId=h.to,e.receiverId=h.from,e.chatId=h.chatId,e.cId&&e.receiverId&&e.chatId&&(e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId))},e.goBack=function(){e.isPlaying||e.$ionicGoBack()},e.loginCs=function(){var t={c:"li",u:"admin",p:"123456"};e.chatId=void 0,r.login(t).then(function(t){t?(e.token=t.data.token,e.cId=t.data.ci,a(function(){e.loopGetMsg()},500)):alert("login error！！！")})},e.logoutCs=function(){},e.getLocalData=function(){a(function(){r.loadMessages(kefuData)},1200)},e.getMsg=function(){var t=d.defer();return r.getMsg(e.token).then(function(o){o&&o.data&&o.data.msgs&&0!=o.data.msgs.length?(angular.forEach(o.data.msgs,function(e,t){r.filtMsg(e),"close"==e.ty||e.ty}),r.loadMessages(o.data.msgs),e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId),t.resolve(1)):0==!o.data.msgs.length?t.resolve(1):t.reject(1)}),t.promise},e.sendMsg=function(){var t=e.CustumerParam.msg;return e.chatId&&e.receiverId?t?void r.sendMsg(e.chatId,e.receiverId,"m",t,e.token).then(function(o){if(o&&o.data&&0==o.data.rt){var s={msg:t,ty:"message"};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=""}else alert("发送信息失败")}):void l.showToast("发送消息不能为空"):void alert("no chatId or receiverId ---sendMsg failed!")},e.getImg=function(e){v.getPicture(e,S,I)},e.startRecord=function(){v.startCapture("sourceInSC","audioInSC")},e.deleteRecord=function(){v.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),v.stopCapture("sourceInSC","audioInSC",e.transfer)},e.play=function(){var e=document.getElementById("audioInSC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.cId,o=v.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),$.upload(o,t,void 0,void 0,void 0,{},b,A)};var b=function(t){var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.message="音频文件",o.data.msg=o.data.imageUrl;var i={imageUrl:s,fileType:".wav",msg:"音频文件"};e.deleteRecord(),e.$apply(function(){e.messages.push(i)}),r.sendMsg(e.chatId,e.receiverId,"m",s,e.token).then(function(t){t&&t.data&&0==t.data.rt||alert("发送信息失败"),e.loopGetMsg()})},A=function(t){e.loopGetMsg(),alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("contentS").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("contentS");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,s){e.init(),e.footerStyle={bottom:"0px"},t.chatScope=o,a(function(){e.loopGetMsg()},3e3),window.addEventListener("native.keyboardshow",T),window.addEventListener("native.keyboardhide",C),v.addAudioEventOnWindow()}),e.$on("$ionicView.afterEnter",function(t,o){e.$broadcast("$ionicParentView.afterEnter",{who:t})}),e.$on("$ionicView.beforeLeave",function(){v.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",T),window.removeEventListener("native.keyboardhide",C),e.killTimer()})}]),APP.service("ServiceConversationService",["$http","UrlService",function(e,t){function o(e,t){r.entrySet[e]=t,r.count++}function s(e){return r.entrySet[e]}function i(e){for(var t in r.entrySet)if(t===e)return!0;return!1}function a(e){i(e)&&(delete r.entrySet[e],r.count--)}function n(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var r={count:0,entrySet:{}};this.isEmptyMap=function(){return 0===r.count},this.put=o,this.get=s,this.containsKey=i,this.remove=a,this.loadMessages=function(e){if(e&&angular.isArray(e))for(var t,a,n,r=0;r<e.length;r++)t=e[r],a=t.ci+"$"+t.fr+"$"+t.to,i(a)?(n=s(a),angular.isArray(n)&&n.push(t)):o(a,[t])},r.all=[],this.getAll=function(){for(var e in r.entrySet)r.all=r.all.concat(r.entrySet[e]);return r.all},this.getEntrySet=function(){return r.entrySet};var c="http://123.56.3.136:8181/api/invoke";this.login=function(t){return e({method:"POST",url:c,params:t})},this.kefulogin=function(t){return e({method:"POST",url:c,params:{c:"li",u:t}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e({method:"POST",url:c,params:{c:"re",token:t,noLoading:!0}})},this.filtMsg=function(e){"EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0);if(e.msg&&e.msg.indexOf("$prodLink")>-1){e.fileType="prodLink";var t=e.msg.substring(9),o=JSON.parse(t);e.prodObj=o}else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("[")>-1&&e.msg.indexOf("]")>-1)for(var s=1;s<16;s++)e.msg=n(e.msg,s)};var l=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.sendMsg=function(t,o,s,i,a){return e({method:"POST",url:c,params:{c:"sd",ci:t,to:o,ty:s,msg:i,token:a}})}}]),APP.directive("resizeFootBars",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-s"),a=e.$getByHandle("scScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("ShareListPageController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService",function(e,t,o,s,i,a,n,r,c,l,d,p){e.input={keywords:""},e.iconShow=!0,e.members=[],e.originData=void 0,e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.originData=s.sl,e.members=e.originData.shareMsgsList}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("TestDetailsController",["$scope","$rootScope","$state","$stateParams","TestDetailsService","PopupService","$timeout","$ionicModal",function(e,t,o,s,i,a,n,r){e.examQuestionList={},e.selectedOptions=[],e.summitOptions=[],e.testResult="",e.init=function(){r.fromTemplateUrl("templates/quanzi/CommitTestPaperModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.commitPaperModal=t}),e.showTestDetails(),e.getTestResult()},e.showTestDetails=function(){var t={courseId:1};i.getTestList(t).success(function(t){e.index=0,e.examQuestionList=t.data.list})},e.getTestResult=function(){var t={courseId:1};i.getTestResult(t).success(function(t){e.testResult=t.data.list})},e.jumpQuestionDetail=function(t){e.index=t-1},e.beforeQuestion=function(){e.index-=1},e.nextQuestion=function(){e.index+=1,e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,respondentsAnswer:e.summitCourseId?e.summitOptions:""};i.getTestList(t).success(function(t){e.selectedOptions=[];for(var o=e.examQuestionList[e.index].respondentsAnswer.split(","),s=0;s<o.length;s++)e.selectedOptions.push(o[s])})},e.submitPaper=function(){e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,submitPaperFlag:1,respondentsAnswer:e.summitCourseId?e.summitOptions:""};i.getTestList(t).success(function(t){e.selectedOptions=[]}).error(function(e){a.showToast(e.message)})},e.selectAnswer=function(t,o){if(e.examId=e.examQuestionList[t].id,e.summitCourseId=e.examQuestionList[t].courseId,"单选"==e.examQuestionList[t].subjectType){for(var s=0;s<e.examQuestionList[t].optionsList.length;s++)e.examQuestionList[t].optionsList[s].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}else if("多选"==e.examQuestionList[t].subjectType)if(1==e.examQuestionList[t].optionsList[o].isSelect)for(var s=0;s<e.selectedOptions.length;s++)e.selectedOptions[s]==e.examQuestionList[t].optionsList[o].optionsName&&(e.examQuestionList[t].optionsList[o].isSelect=!1,e.selectedOptions.splice(s,1),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString());else e.examQuestionList[t].optionsList[o].isSelect=!e.examQuestionList[t].optionsList[o].isSelect,e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString();else if("判断"==e.examQuestionList[t].subjectType){for(var s=0;s<e.examQuestionList[t].optionsList.length;s++)e.examQuestionList[t].optionsList[s].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}},e.showCommitPaper=function(){e.commitPaperModal.show()},e.hideCommitPaper=function(){e.commitPaperModal.hide()},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestDetailsService",["$http","UrlService",function(e,t){this.getTestList=function(o){return e({method:"POST",url:t.getUrl("TEST_LIST"),data:o})},this.getTestResult=function(o){return e({method:"POST",url:t.getUrl("TEST_CONSULT"),data:o})}}]),APP.controller("TestPageController",["$scope","$rootScope","$state","$stateParams","TestPageService","PopupService","$timeout",function(e,t,o,s,i,a,n){e.essentialInfo={},e.init=function(){e.getEssentialInfo()},e.toTestDetails=function(){o.go("testDetails")},e.getEssentialInfo=function(){var t={courseId:1};i.getEssentialInfo(t).success(function(t){e.essentialInfo=t.data.list})},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestPageService",["$http","UrlService",function(e,t){this.getEssentialInfo=function(o){return e({method:"POST",url:t.getUrl("TEST_ESSENTIAL_INFORMATION"),data:o})}}]),APP.controller("TopicController",["$scope","$rootScope","$ionicHistory","$state","TopicService","$localstorage",function(e,t,o,s,i,a){t.xiaoxis=!1,e.shuxiaoxi=!1,e.count=0,t.msgCount="",e.init=function(){e.tabNav="qhot",i.getxiaoxi().success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.onTabSelected=function(){t.xiaoxis=!1},e.open=function(){var e="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+a.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=e);window.emc.presentH5View(e,"创意社区")}}]),APP.service("TopicService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("TopicdetailsController",["$scope","$rootScope","$ionicHistory","TopicdetailsService","$http","$ionicSlideBoxDelegate","$stateParams","$sce","$ionicScrollDelegate","$timeout",function(e,t,o,s,i,a,n,r,c,l){e.tielist="",e.pinglunlist="",e.isshow=!1,e.xxshow=!1,e.huatiid="",e.xiaoxis=!1,e.userlist="",e.topicheight=0,e.pinglunis=!1,e.count="",e.dianzans="",t.showRightTop=!1,e.goBack=function(){e.$ionicGoBack()},e.pinglunshow=function(){var t=c.$getByHandle("pinglun"),o=t.getScrollPosition(),s=o.top,i=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-i,l(function(){e.pinglunis=s>e.topicheight},200)},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis},e.addImage=function(){$ionicActionSheet.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function s(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},e.gotoxiaoxi=function(){$state.go("qzMessageCenter"),e.isshow=!1,e.xxshow=!1},e.dianzan=function(){var t={id:e.huatiid};s.dianzan(t).success(function(t,o,s,i){e.dianzans=t.success})},e.init=function(){e.huatiid=n.huatiid;var o={pageIndex:1,pageSize:5,id:0};s.getpinglun(o).success(function(t,o,s,i){return e.pinglunlist=t.data.list,t});var i={id:e.huatiid};s.gettieData(i).success(function(t,o,s,i){return e.tielist=t.data,t}).error(function(){}),s.getdianzan(i).success(function(t,o,s,i){e.count=t.data}).error(function(){}),s.getxiaoxi(i).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init(),e.huatiid=n.huatiid})}]),APP.service("TopicdetailsService",["$http","UrlService",function(e,t){this.gettieData=function(o){return e.post(t.getUrl("GETSTORYINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getdianzan=function(o){return e.post(t.getUrl("GETSTORYPRAISEANDUNREAD"),o)},this.dianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.getpinglun=function(o){return e.post(t.getUrl("GETSTORYCOMMENT"),o)}}]),APP.directive("audioPanel",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/AudioPanel.html",scope:!0,link:function(e,t,o){}}}),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","$ionicPopup",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){try{e&&e.data&&(w?(S+=e.data.length,$=$.concat(e.data)):(S=e.data.length,$=e.data,w=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function h(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=1,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.isShowRecord=!1,e.CustumerParam={msg:"说点什么"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.userInCC=c.getUser(),r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t=d.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++){if(o.data.msgs[s].message&&o.data.msgs[s].message.indexOf("http")>-1&&o.data.msgs[s].message.indexOf(".jpg")>-1)o.data.msgs[s].fileType=".jpg",o.data.msgs[s].imageUrl=o.data.msgs[s].message;else if(o.data.msgs[s].message&&o.data.msgs[s].message.indexOf("http")>-1&&o.data.msgs[s].message.indexOf(".wav")>-1){o.data.msgs[s].fileType=".wav";var i=o.data.msgs[s].message;o.data.msgs[s].imageUrl=g.trustAsResourceUrl(i)}e.messages.push(o.data.msgs[s])}t.resolve(1)}else t.reject(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};r.sendMsg(t).then(function(o){e.messages.push({message:t.msg})},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(){var t={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:"2",desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(t).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var o={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(o).then(function(e){if(e);},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.sendPic=function(){p.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){function o(t){alert("getPicSuccess"),e.avatarImage=t;var o=function(t){u.hide(),l.showToast("上传成功");var o=JSON.parse(t.response);e.avatarImage=o.data.imageUrl,o.data.message="拍照图片",e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},s=function(e){u.hide(),l.showToast("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var a={};a.userName="18560683520",i.params=a,(new FileTransfer).upload(t,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,s,i)}function s(e){alert(e)}function i(t){e.avatarImage=t;var o=function(t){l.showToast("上传成功"),u.hide();var o=JSON.parse(t.response);o.data.message="相册图片",e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},s=function(e){l.showToast("上传失败"),u.hide()},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var a={};a.userName="18560683520",i.params=a,(new FileTransfer).upload(e.avatarImage,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,s,i)}function a(e){}return 0==t?navigator.camera.getPicture(o,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==t&&navigator.camera.getPicture(i,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})};var v={},$=[],S=0;window.URL=window.URL||window.webkitURL;var I="",w=!0;e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1};var y=function(){try{window.audioinput&&!audioinput.isCapturing()&&(v={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(v));m.alert({title:"开始录音",template:"录音已经开始，按下确定结束"}).then(function(e){T()})}catch(e){alert("startCapture exception: "+e)}};e.startRecord=y;var T=function(){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),S=0;var e=new WavAudioEncoder(v.sampleRate,v.channels);e.encode([$]);var t=e.finish("audio/wav");window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory,function(e){e.getFile("xuftest123.wav",{create:!0},function(e){e.createWriter(function(o){o.write(t),setTimeout(function(){I=e.toURL(),document.getElementById("source").src=I,document.getElementById("audio").load()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};e.endRecord=T;var C=function(){window.resolveLocalFileSystemURL(I,function(e){e.remove(function(){alert("delete success"),w=!1,document.getElementById("source").src="",document.getElementById("audio").load()},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};e.deleteRecord=C;var b=function(){alert("start transfer");var t=function(t){alert("上传成功");var o=JSON.parse(t.response);o.data.message="音频文件",o.data.imageUrl=g.trustAsResourceUrl(o.data.imageUrl),e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},o=function(e){alert("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName="aaa";var i={};i.userName="18560683520",s.params=i;var a=new FileTransfer,n="http://123.56.3.136:8088/live/receive.jsp?fileType=.wav&chatId="+e.chatId+"&cId=1";a.upload(I,encodeURI(n),t,o,s)};e.transfer=b,e.$on("$ionicView.beforeEnter",function(){e.init(),window.addEventListener("audioinput",f,!1),window.addEventListener("audioinputerror",h,!1),e.messages=[]}),e.$on("$ionicView.afterEnter",function(){}),e.$on("$ionicView.beforeLeave",function(){window.removeEventListener("audioinput",f),window.removeEventListener("audioinputerror",h),e.killTimer()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("CustomerConversationService",["$http","UrlService",function(e,t){var o="http://123.56.3.136:8088";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8088/live//msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.getUUID=function(){
return e.get(o+"/live/getVistorId.dll")},this.opinion=function(t){return e.get(o+"/live/msg.dll",t)},this.endChat=function(t){return e.get(o+"/live/msg.dll",t)},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)},this.upload=function(){},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)}}]);var fangkeData=[{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:null,event:!0,exts:{},fromUserId:"admin",message:"admin",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"EVENT_ACCEPT",viewUserId:"admin"},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"hhah",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014076122.jpg",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014105480.wav",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null}];APP.controller("examCtrl",["$scope","$state","examService","NoteDetailsService",function(e,t,o,s){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.optionLetter=["A.","B.","C.","D."],e.answer=["a","b","c","d"],e.showWhich=[],e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.init=function(){e.isDisplay=!1,e.Qs=o.getQs(),e.showWhich[0]=!0,s.getxiaoxi().success(function(t,o,s,i){e.messageNum=t.data.count,e.ifRed=parseInt(t.data.count)}).error(function(e,t,o,s){alert("网络失败！")})},e.chooseWhich=function(t){e.showWhich=[],e.showWhich[t]=!0},e.$on("myIndex",function(t,o){e.$broadcast("yourIndex",o)}),e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("examService",[function(){var e=[{family:"一",questions:[{description:"题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目二题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目三题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目四题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目五题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目六题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目七题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]}]},{family:"二",questions:[{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"三",questions:[{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"四",questions:[{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]}];this.getQs=function(){return e}}]),APP.directive("eachRepeat",function(){return{link:function(e,t,o){e.$emit("myIndex",e.$index+1)}}}),APP.directive("receiveIndex",function(){return{link:function(e,t,o){e.$on("yourIndex",function(e,t){})}}}),APP.controller("heIssueController",["$http","$scope","$location","$anchorScroll","$cacheFactory","heIssueService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","personalHomepageHeService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T){function C(e,o,s,i){a.getMyIssue(e,o,s,i).success(function(e){1==e.success&&(t.issueData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function b(e,o,s,i){a.getMyComment(e,o,s,i).success(function(e){1==e.success&&(t.commentData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.commentList=t.commentList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function A(e,o,s){a.getMyStory(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function P(e,o,s){a.getDaShang(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.DaShangData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.DaShangList=t.DaShangList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function x(e,o,s){a.getCollection(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.CollectionList=t.CollectionList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function L(e){a.getMyJoinedTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function D(e){a.getMyCreatTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function N(e,o,s){a.getUserPraise(e,o,s).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.UserPraiseList=t.UserPraiseList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}t.titles=[{title:"TA的发布"},{title:"TA的评论"},{title:"TA的原创"}],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){t.$ionicGoBack()},t.hasmore=!1,t.init=function(e,o,s){t.cuurentUserId=o,t.pageIndex=1,t.pageSize=5,t.pageSize10=10,"original"==e?A(t.pageIndex,t.pageSize,t.cuurentUserId):"issue"==e?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"comment"==e?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"dashang"==e?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==e?x(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==e?1==s?D(t.cuurentUserId):0==s&&L(t.cuurentUserId):"zan"==e&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.loadMore=function(){"comment"==n.title?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"issue"==n.title?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"original"==n.title?A(t.pageIndex,t.pageSize,t.cuurentUserId):"dashang"==n.title?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==n.title?x(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==n.title?0==t.chooseQuanIndex?D(t.cuurentUserId):1==t.chooseQuanIndex&&L(t.cuurentUserId):"zan"==n.title&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.$on("$ionicView.beforeEnter",function(e,o){if("back"!=o.direction){switch(h.scrollTop(),t.chooseIndex=0,t.issueList=[],t.issueType=0,t.chooseComIndex=0,t.chooseQuanIndex=0,t.quanziTitle="加入",t.chooseResuIndex=0,t.commentList=[],t.commentType=0,t.MyStoryList=[],t.DaShangList=[],t.CollectionList=[],t.myTopicList=[],t.UserPraiseList=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=n.memberId,"his"==n.who?t.titleStart="TA":"mine"==n.who&&(t.titleStart="我"),n.title){case"issue":t.titleEnd="的发布";break;case"comment":t.titleEnd="的评论";break;case"original":t.titleEnd="的原创";break;case"dashang":t.titleEnd="的打赏";break;case"quanzi":t.titleEnd="的圈子";break;case"zan":t.titleEnd="的赞";break;case"shoucang":t.titleEnd="的收藏";break;default:t.titleEnd="的发布"}t.init(n.title,n.id,0)}}),t.chooseTab=function(e){h.scrollTop(),t.page=2,0==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):1==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):2==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):3==e&&(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType))},t.chooseComTab=function(e){h.scrollTop(),0==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType)):1==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType)):2==e&&(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType))},t.chooseQuanTab=function(e){0==e?(t.myTopicList=[],t.chooseQuanIndex=0,t.quanziTitle="加入",t.init("quanzi",n.id,0)):1==e&&(t.myTopicList=[],t.chooseQuanIndex=1,t.quanziTitle="创建",t.init("quanzi",n.id,1))},t.toNoteDetails=function(e,t){c.go("noteDetails",{noteId:e,isShortStory:t})},t.CommentDetails=function(e){2==e.flag?c.go("classNoteDetails",{noteId:e.storyId}):c.go("noteDetails",{noteId:e.storyId,isShortStory:e.isShortStory})},t.viewStory=function(e){2!==e.flag?c.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):c.go("classNoteDetails",{noteId:e.id})},t.topicPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:n.circleId}),f.gio.track("active",{circleID:n.circleId}));var s={id:e,noLoading:!0};a.pushPraise(s).success(function(e){1==e.success?1==t.MyStoryList[o].praiseFlag?(t.MyStoryList[o].praiseNumber=t.MyStoryList[o].praiseNumber-1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):(t.MyStoryList[o].praiseNumber=parseInt(t.MyStoryList[o].praiseNumber)+1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.CollectionPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:n.circleId}),f.gio.track("active",{circleID:n.circleId}));var s={id:e.id,noLoading:!0};1==e.flag&&a.pushPraise(s).success(function(e){1==e.success?1==t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)}),2==e.flag&&a.SchoolPraise(s).success(function(e){1==e.success?0!=t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.dealStory=function(e,o){var s;s=2!==e.flag?o:1==o?3:4;var i=e.storyTopicId?e.storyTopicId:e.id;T.dealStory(i,s).then(function(o){if(1==o.data.success){var a;switch(s){case 1:a=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?a-1:a+1,e.praiseFlag=!e.praiseFlag;break;case 2:a=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?a-1:a+1,e.collectionFlag=!e.collectionFlag;for(var n=0;n<t.CollectionList.length;n++)i==t.CollectionList[n].id&&t.CollectionList.splice(n,1);break;case 3:a=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?a-1:a+1,e.praiseFlag=!e.praiseFlag;break;case 4:for(a=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?a-1:a+1,e.collectionFlag=!e.collectionFlag,n=0;n<t.CollectionList.length;n++)i==t.CollectionList[n].id&&t.CollectionList.splice(n,1)}}},function(){w.showToast("网络错误！")})},t.viewTopic=function(e){c.go("circlePage",{circleId:e})},t.gotoqSearch=function(){c.go("qSearch")}}]),APP.service("heIssueService",["$http","UrlService",function(e,t){this.getMyIssue=function(o,s,i,a){return e({method:"post",url:t.getUrl("GET_USER_ISSUE_LIST"),data:{pageIndex:o,pageSize:s,userId:i,storyType:a}})},this.getMyStory=function(o,s,i){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyComment=function(o,s,i,a){return e({method:"post",url:t.getUrl("GET_MY_COMMENT_LIST"),data:{pageIndex:o,pageSize:s,userId:i,commentType:a}})},this.myCommentId="",this.getDaShang=function(o,s,i){return e({method:"post",url:t.getUrl("GET_UCTIP_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getCollection=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_JOINTOPIC_LIST"),data:{userCode:o}})},this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_CREATETOPIC_LIST"),data:{userCode:o}})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.SchoolPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.getUserPraise=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_PRAISE_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.filter("commentArrImg",function(){return function(e){return e.split(",")}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".padding_zero {\n  padding: 0;\n}\n\n.ionic_datepicker_popup .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_popup .padding_top_zero {\n  padding-top: 0;\n}\n.ionic_datepicker_popup .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_popup .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_popup .calendar_grid {\n  height: 215px;\n}\n.ionic_datepicker_popup .today {\n  border: 1px solid #009688;\n  border-radius: 50%;\n}\n.ionic_datepicker_popup .selected_date {\n  background-color: #009688;\n  border-radius: 50%;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_popup .popup-head {\n  background-color: #009688;\n  display: none;\n}\n.ionic_datepicker_popup .popup-head .popup-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-head .popup-sub-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body {\n  background-color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body .selected_date_full {\n  background-color: #019688;\n  margin: -10px -10px 0 -10px;\n  height: 45px;\n  text-align: center;\n  font-weight: bold;\n  color: #fff;\n  line-height: 45px;\n  font-size: 18px;\n}\n.ionic_datepicker_popup .popup-body .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_popup .popup-body .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_popup .popup-body .month_select, .ionic_datepicker_popup .popup-body .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select .input-label, .ionic_datepicker_popup .popup-body .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select select, .ionic_datepicker_popup .popup-body .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select:after, .ionic_datepicker_popup .popup-body .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-body .show_nav {\n  padding: 10px 0 0 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section {\n  padding: 5px 0;\n  text-align: left;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section {\n  padding: 5px 0;\n  text-align: right;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 45px;\n}\n.ionic_datepicker_popup .popup-buttons button {\n  background-color: #009688;\n  border-radius: 0;\n  margin-right: 1px;\n  color: #ffffff;\n}\n\n.ionic_datepicker_modal .header, .ionic_datepicker_modal .footer {\n  background-color: #009688;\n}\n.ionic_datepicker_modal .header .title, .ionic_datepicker_modal .header .button, .ionic_datepicker_modal .footer .title, .ionic_datepicker_modal .footer .button {\n  color: #ffffff;\n}\n.ionic_datepicker_modal .footer .button-block {\n  margin: 0;\n}\n.ionic_datepicker_modal .today {\n  border: 1px solid #009688;\n}\n.ionic_datepicker_modal .selected_date {\n  background-color: #009688;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_modal .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_modal .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_modal .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_modal .month_select, .ionic_datepicker_modal .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_modal .month_select .input-label, .ionic_datepicker_modal .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_modal .month_select select, .ionic_datepicker_modal .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0 10px;\n}\n.ionic_datepicker_modal .month_select:after, .ionic_datepicker_modal .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_modal .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_modal .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_modal .date_col {\n  height: 50px;\n  line-height: 50px;\n}\n.ionic_datepicker_modal .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_modal .font_22px {\n  font-size: 22px;\n}\n.platform-android .ionic_datepicker_modal .bar .title.title-left {\n  text-align: center;\n}\n.platform-android .ionic_datepicker_modal select {\n  left: 25%;\n}\n.platform-ios .ionic_datepicker_modal select {\n  left: 5%;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-modal.html",'<ion-modal-view class="ionic_datepicker_modal">\n  <ion-header-bar class="header">\n    <h1 class="title">{{selctedDateEpoch | date : mainObj.dateFormat}}</h1>\n  </ion-header-bar>\n  <ion-content class="ionic_datepicker_modal_content">\n    <div class="">\n      <div class="row text-center">\n        <div class="col col-10 left_arrow">\n          <button class="button-clear font_22px" ng-click="prevMonth()"\n                  ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n            <i class="icon ion-chevron-left"></i>\n          </button>\n        </div>\n        <div class="col col-80 text-center">\n          <div class="row select_section">\n            <div class="col-50 padding_right_5px">\n              <label class="item item-input item-select month_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n                  <option ng-repeat="month in monthsList" ng-selected="month == currentMonthSelected" value="{{month}}">\n                    {{month}}\n                  </option>\n                </select>\n              </label>\n            </div>\n            <div class="col-50 padding_left_5px">\n              <label class="item item-input item-select year_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class="col col-10 right_arrow">\n          <button class=" button-clear font_22px" ng-click="nextMonth()"\n                  ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n            <i class="icon ion-chevron-right"></i>\n          </button>\n        </div>\n      </div>\n      <div class="calendar_grid">\n        <div class="row padding-top weeks_row">\n          <div class="col text-center font_bold"\n               ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n        </div>\n        <div>\n          <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n            <div class="col padding_zero date_col" ng-repeat="col in cols track by $index"\n                 ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || (dayList[row + $index].disabled))}"\n                 ng-click="dateSelected(dayList[row + $index])">\n              <div class="date_cell">\n                {{dayList[row + col].date}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n  <ion-footer-bar class="footer">\n    <div class="row padding_zero">\n      <button class="button button-clear button-block button_set" ng-if="!mainObj.closeOnSelect"\n              ng-click="setIonicDatePickerDate()">{{mainObj.setLabel}}\n      </button>\n      <button class="button button-clear button-block button_today"  ng-if="mainObj.showTodayButton"\n              ng-click="setIonicDatePickerTodayDate()">{{mainObj.todayLabel}}\n      </button>\n      <button class="button button-clear button-block button_close"\n              ng-click="closeIonicDatePickerModal()">{{mainObj.closeLabel}}\n      </button>\n    </div>\n  </ion-footer-bar>\n</ion-modal-view>\n')}]),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-popup.html",'<div class="selected_date_full">{{selctedDateEpoch | date : mainObj.dateFormat}}</div>\n<div class="date_selection">\n  <div class="row show_nav">\n    <div class="col-10 prev_btn_section">\n      <button class="button-clear" ng-click="prevMonth()"\n              ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n        <i class="icon ion-chevron-left"></i>\n      </button>\n    </div>\n    <div class="col-80 text-center">\n      <div class="row select_section">\n        <div class="col-50 padding_right_5px">\n          <label class="item item-input item-select month_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n              <option ng-repeat="month in monthsList" ng-selected="month==currentMonthSelected" value="{{month}}">\n                {{month}}\n              </option>\n            </select>\n          </label>\n        </div>\n        <div class="col-50 padding_left_5px">\n          <label class="item item-input item-select year_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n          </label>\n        </div>\n      </div>\n    </div>\n    <div class="col-10 next_btn_section">\n      <button class="button-clear" ng-click="nextMonth()"\n              ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n        <i class="icon ion-chevron-right"></i>\n      </button>\n    </div>\n  </div>\n  <div class="calendar_grid">\n    <div class="row weeks_row">\n      <div class="col text-center font_bold"\n           ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n    </div>\n    <div>\n      <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n        <div class="col no_padding date_col" ng-repeat="col in cols track by $index"\n             ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || dayList[row + $index].disabled)}"\n             ng-click="dateSelected(dayList[row + $index])">\n          <div class="date_cell">\n            {{dayList[row + col].date}}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),APP.provider("ionicDatePicker2",function(){var e={inputDate:new Date,from:new Date(2012,8,1),to:new Date(2018,8,1),setLabel:"确定",todayLabel:"今天",closeLabel:"关闭",mondayFirst:!0,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],templateType:"popup",dateFormat:"yyyy-MM-dd",showTodayButton:!1,closeOnSelect:!1,disableWeekdays:[]};this.configDatePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup","$ionicModal","IonicDatepickerService2",function(t,o,s,i){function a(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function n(e){e.disabledDates&&0!==e.disabledDates.length?(u.disabledDates=[],angular.forEach(e.disabledDates,function(e,t){e=a(new Date(e)),u.disabledDates.push(e.getTime())})):u.disabledDates=[]}function r(e){e=a(e),u.currentDate=angular.copy(e);var t=new Date(e.getFullYear(),e.getMonth(),1).getDate(),o=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();u.monthsList=[],u.mainObj.monthsList&&12===u.mainObj.monthsList.length?u.monthsList=u.mainObj.monthsList:u.monthsList=i.monthsList,u.yearsList=i.getYearsList(u.mainObj.from,u.mainObj.to),u.dayList=[];var s,n;u.firstDayEpoch=a(new Date(e.getFullYear(),e.getMonth(),t)).getTime(),u.lastDayEpoch=a(new Date(e.getFullYear(),e.getMonth(),o)).getTime();for(var r=t;r<=o;r++)s=new Date(e.getFullYear(),e.getMonth(),r),n=s.getTime()<u.fromDate||s.getTime()>u.toDate||u.mainObj.disableWeekdays.indexOf(s.getDay())>=0,u.dayList.push({date:s.getDate(),month:s.getMonth(),year:s.getFullYear(),day:s.getDay(),epoch:s.getTime(),disabled:n});var c=u.dayList[0].day-u.mainObj.mondayFirst;c=c<0?6:c;for(var l=0;l<c;l++)u.dayList.unshift({});u.rows=[0,7,14,21,28,35],u.cols=[0,1,2,3,4,5,6],u.currentMonth=u.mainObj.monthsList[e.getMonth()],u.currentYear=e.getFullYear(),u.currentMonthSelected=angular.copy(u.currentMonth),u.currentYearSelected=angular.copy(u.currentYear),u.numColumns=7}function c(e){u.mainObj=angular.copy(e),
u.selctedDateEpoch=a(u.mainObj.inputDate).getTime(),u.mainObj.weeksList&&7===u.mainObj.weeksList.length?u.weeksList=u.mainObj.weeksList:u.weeksList=["S","M","T","W","T","F","S"],u.mainObj.mondayFirst&&u.weeksList.push(u.mainObj.weeksList.shift()),u.disableWeekdays=u.mainObj.disableWeekdays,r(u.mainObj.inputDate),n(u.mainObj)}function l(){u.modal.show()}function d(){u.modal.hide()}var p={},u=t.$new();return u.today=a(new Date).getTime(),u.disabledDates=[],u.prevMonth=function(){1===u.currentDate.getMonth()&&u.currentDate.setFullYear(u.currentDate.getFullYear()),u.currentDate.setMonth(u.currentDate.getMonth()-1),u.currentMonth=u.mainObj.monthsList[u.currentDate.getMonth()],u.currentYear=u.currentDate.getFullYear(),r(u.currentDate)},u.nextMonth=function(){11===u.currentDate.getMonth()&&u.currentDate.setFullYear(u.currentDate.getFullYear()),u.currentDate.setDate(1),u.currentDate.setMonth(u.currentDate.getMonth()+1),u.currentMonth=u.mainObj.monthsList[u.currentDate.getMonth()],u.currentYear=u.currentDate.getFullYear(),r(u.currentDate)},u.dateSelected=function(e){e&&0!==Object.keys(e).length&&(u.selctedDateEpoch=e.epoch,u.mainObj.closeOnSelect&&(u.mainObj.callback(u.selctedDateEpoch),"popup"==u.mainObj.templateType.toLowerCase()?u.popup.close():d()))},u.setIonicDatePickerTodayDate=function(){var e=new Date;r(new Date),u.selctedDateEpoch=a(e).getTime(),u.mainObj.closeOnSelect&&(u.mainObj.callback(u.selctedDateEpoch),d())},u.setIonicDatePickerDate=function(){u.mainObj.callback(u.selctedDateEpoch),d()},u.monthChanged=function(e){var t=u.monthsList.indexOf(e);u.currentDate.setMonth(t),r(u.currentDate)},u.yearChanged=function(e){u.currentDate.setFullYear(e),r(u.currentDate)},s.fromTemplateUrl("ionic-datepicker-modal.html",{scope:u,animation:"slide-in-up"}).then(function(e){u.modal=e}),u.$on("$destroy",function(){u.modal.remove()}),u.closeIonicDatePickerModal=function(){d()},p.openDatePicker=function(t){var s=[];delete u.fromDate,delete u.toDate,u.mainObj=angular.extend({},e,t),u.mainObj.from&&(u.fromDate=a(new Date(u.mainObj.from)).getTime()),u.mainObj.to&&(u.toDate=a(new Date(u.mainObj.to)).getTime()),t.disableWeekdays&&e.disableWeekdays&&(u.mainObj.disableWeekdays=t.disableWeekdays.concat(e.disableWeekdays)),c(u.mainObj),u.mainObj.closeOnSelect||(s=[{text:u.mainObj.setLabel,type:"button_set",onTap:function(e){u.mainObj.callback(u.selctedDateEpoch)}}]),u.mainObj.showTodayButton&&s.push({text:u.mainObj.todayLabel,type:"button_today",onTap:function(e){var t=new Date;r(new Date),u.selctedDateEpoch=a(t).getTime(),u.mainObj.closeOnSelect||e.preventDefault()}}),s.push({text:u.mainObj.closeLabel,type:"button_close",onTap:function(e){}}),"popup"==u.mainObj.templateType.toLowerCase()?(u.currentYear=(new Date).getFullYear(),u.popup=o.show({templateUrl:"ionic-datepicker-popup.html",scope:u,cssClass:"ionic_datepicker_popup",buttons:s})):l()},p}]}),APP.service("IonicDatepickerService2",function(){this.monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"],this.getYearsList=function(e,t){var o=[],s=1900,i=2100;s=e?new Date(e).getFullYear():s,i=t?new Date(t).getFullYear():i;for(var a=s;a<=i;a++)o.push(a);return o}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".ionic_timepicker_popup .font_28px {\n  font-size: 28px;\n}\n.ionic_timepicker_popup .margin_zero {\n  margin: 0;\n}\n.ionic_timepicker_popup .padding_zero {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup {\n  background-color: #ffffff;\n}\n.ionic_timepicker_popup .popup-head {\n  display: none;\n}\n.ionic_timepicker_popup .popup-body {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 44px;\n  height: 44px;\n}\n.ionic_timepicker_popup .popup-buttons .button:not(:last-child) {\n  margin-right: 1px;\n}\n.ionic_timepicker_popup .padding_left_15px {\n  padding-left: 15px;\n}\n.ionic_timepicker_popup .heading {\n  height: 44px;\n  background-color: #009688;\n  color: #ffffff;\n  text-align: center;\n  line-height: 44px;\n  font-size: 18px;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_colon {\n  padding-top: 45px;\n  text-align: center;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_arrows {\n  width: 100%;\n}\n.ionic_timepicker_popup .time_picker_box_text {\n  height: 40px;\n  text-align: center;\n  border: 1px solid #dddddd;\n  font-size: 16px;\n  line-height: 38px;\n}\n.ionic_timepicker_popup .overflowShow {\n  white-space: normal !important;\n}\n.ionic_timepicker_popup .button_set, .ionic_timepicker_popup .button_close {\n  background-color: #009688;\n  color: #ffffff;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-timepicker.html",'<div><div class=heading>{{time.hours}} : {{time.minutes}} <span ng-show="time.format == 12">{{time.meridian}}</span></div><div class=row ng-class="{\'padding_left_15px\':time.format == 12}"><div class="col col-25" ng-class="{\'col-offset-20 col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseHours()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.hours class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseHours()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon">:</label><div class="col col-25" ng-class="{\'col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseMinutes()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.minutes class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseMinutes()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon" ng-if="time.format == 12">:</label><div class="col col-25" ng-if="time.format == 12"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.meridian class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-down"></i></button></div></div></div>')}]),APP.provider("ionicTimePicker",function(){var e={setLabel:"确定",closeLabel:"关闭",inputTime:60*(new Date).getHours()*60+60*(new Date).getMinutes(),format:24,step:1};this.configTimePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup",function(t,o){function s(e,t){a.time.hours=Math.floor(e/3600);var o=e%3600;12==t&&(a.time.hours>12?(a.time.hours-=12,a.time.meridian="PM"):a.time.meridian="AM"),a.time.minutes=o/60,a.time.hours=a.time.hours.toFixed(0),a.time.minutes=a.time.minutes.toFixed(0),1==a.time.hours.toString().length&&(a.time.hours="0"+a.time.hours),1==a.time.minutes.toString().length&&(a.time.minutes="0"+a.time.minutes),a.time.format=a.mainObj.format}var i={},a=t.$new();return a.today=function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}(new Date).getTime(),a.time={},a.increaseHours=function(){a.time.hours=Number(a.time.hours),12==a.mainObj.format&&(12!=a.time.hours?a.time.hours+=1:a.time.hours=1),24==a.mainObj.format&&(a.time.hours=(a.time.hours+1)%24),a.time.hours=a.time.hours<10?"0"+a.time.hours:a.time.hours},a.decreaseHours=function(){a.time.hours=Number(a.time.hours),12==a.mainObj.format&&(a.time.hours>1?a.time.hours-=1:a.time.hours=12),24==a.mainObj.format&&(a.time.hours=(a.time.hours+23)%24),a.time.hours=a.time.hours<10?"0"+a.time.hours:a.time.hours},a.increaseMinutes=function(){a.time.minutes=Number(a.time.minutes),a.time.minutes=(a.time.minutes+a.mainObj.step)%60,a.time.minutes=a.time.minutes<10?"0"+a.time.minutes:a.time.minutes},a.decreaseMinutes=function(){a.time.minutes=Number(a.time.minutes),a.time.minutes=(a.time.minutes+(60-a.mainObj.step))%60,a.time.minutes=a.time.minutes<10?"0"+a.time.minutes:a.time.minutes},a.changeMeridian=function(){a.time.meridian="AM"===a.time.meridian?"PM":"AM"},i.openTimePicker=function(t){var i=[];a.mainObj=angular.extend({},e,t),s(a.mainObj.inputTime,a.mainObj.format),i.push({text:a.mainObj.setLabel,type:"button_set",onTap:function(e){var t=0;12==a.time.format?(a.time.hours=Number(a.time.hours),"PM"==a.time.meridian&&12!=a.time.hours?a.time.hours+=12:"AM"==a.time.meridian&&12==a.time.hours&&(a.time.hours-=12),t=60*a.time.hours*60+60*a.time.minutes):t=60*a.time.hours*60+60*a.time.minutes,a.mainObj.callback(t)}}),i.push({text:a.mainObj.closeLabel,type:"button_close"}),a.popup=o.show({templateUrl:"ionic-timepicker.html",scope:a,cssClass:"ionic_timepicker_popup",buttons:i})},i}]}),APP.controller("manageUserController",["$scope","$state","$stateParams","manageUserService","$ionicScrollDelegate","PopupService","anchorScroll","$ionicPopup",function(e,t,o,s,i,a,n,r){e.mainuserlist="",e.userlist="",e.topicId="",e.aList=[],e.isShut=[],e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.selectUser=function(t){for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].id==t.id&&("img/ic_select.png"==e.mainuser2list[o].ischeck?e.mainuser2list[o].ischeck="img/ic_check.png":e.mainuser2list[o].ischeck="img/ic_select.png");for(var s=0;s<e.userlist.length;s++)t.id==e.userlist[s].id&&("img/ic_select.png"==e.userlist[s].ischeck?(e.userlist[s].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[s].ischeck="img/ic_select.png",e.userCode=t.userCode))},e.allDo=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}else if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}},e.noSpeak=function(){for(var t=0;t<e.userlist.length;t++)"img/ic_select.png"==e.userlist[t].ischeck&&(e.isShut.push(e.userlist[t].isgag),e.manageList.push(e.userlist[t].userCode));if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var o=0;o<e.mainuser2list.length;o++)"img/ic_select.png"==e.mainuser2list[o].ischeck&&(e.isShut.push(e.mainuser2list[o].isgag),e.manageList.push(e.mainuser2list[o].userCode));if(e.manageList.length>0){for(var s=e.manageList.join(","),i={topicId:e.topicId,userCode:s,isGag:1},n=0;n<e.isShut.length;n++)1==e.isShut[n]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(i)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else e.yesno&&!e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,a.showToast("已选对象为禁言者，无需禁言")):e.ok(i)}else a.showToast("您还没有选择任何成员")},e.release=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&(e.isShut.push(e.mainuser2list[t].isgag),e.manageList.push(e.mainuser2list[t].userCode));for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&(e.isShut.push(e.userlist[o].isgag),e.manageList.push(e.userlist[o].userCode));if(e.manageList.length>0){for(var s=e.manageList.join(","),i={topicId:e.topicId,userCode:s,isGag:0},n=0;n<e.isShut.length;n++)1==e.isShut[n]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部解除禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(i)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else!e.yesno&&e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,a.showToast("已选对象为非禁言者，无需解除")):e.ok(i)}else a.showToast("您还没有选择任何成员")},e.ok=function(t){s.manageUser(t).success(function(t){e.allcheck="img/ic_check.png",e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,e.getallList()}).error(function(){})},e.yes=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&e.manageList.push(e.mainuser2list[t].userCode);for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&e.manageList.push(e.userlist[o].userCode);if(e.manageList.length>0){var i=e.manageList.join(","),n={topicId:e.topicId,userCodeS:i,isAll:0};s.delectUser(n).success(function(t){t.success?(e.getallList(),a.showToast("删除成功")):a.showToast(t.message)}).error(function(){})}else a.showToast("您还没有选择任何成员")},e.search=function(t){var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");for(var r=0;r<e.mainuser2list.length;r++)e.mainuser2list[r].ischeck="img/ic_check.png";for(var n=0;n<e.userlist.length;n++)e.userlist[n].ischeck="img/ic_check.png";i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.getallList=function(){var t={topicId:e.topicId,pageSize:20,pageIndex:1};s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].ischeck="img/ic_check.png";for(var s=0;s<e.userlist.length;s++)e.userlist[s].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var s=e.userlist.length;e.hasmore=!(s===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.hasmore=!1,e.yesno=!1,e.noyes=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.isShut=[],e.allcheck="img/ic_check.png",e.userCode="",e.manageList=[],e.pageIndex=1,e.input={isinput:""},e.getallList()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("manageUserService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.manageUser=function(o){return e.post(t.getUrl("CIRCLE_MANAGE_USER"),o)},this.delectUser=function(o){return e.post(t.getUrl("CIRCLE_DELECT_USER"),o)}}]),APP.controller("moreInterestingCtrl",["$scope","$state","$timeout","PopupService","myFansService",function(e,t,o,s,i){e.myInterested={pageIndex:0,pageSize:8,interestedList:[],hasMore:!0,api:function(e,t){return i.getMyInterested(e,t)}},e.init=function(){e.myInterested.hasMore=!0,e.myInterested.pageIndex=0,e.myInterested.interestedList=[],e.loadData(e.myInterested,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(t,i){void 0==i&&(i=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(s){o(function(){1==s.success&&(t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.interestedList=t.interestedList.concat(s.data.list),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络错误！")})},e.followI=function(t,a){var n=a?1:0;i.follow(t.memberId,n).success(function(s){if(1==s.success)for(var i=0;i<e.myInterested.interestedList.length;i++)t.memberId==e.myInterested.interestedList[i].memberId&&(e.myInterested.interestedList.splice(i,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3))}).error(function(){s.showToast("网络错误！")})},e.viewHim=function(e){t.go("personalHomepageHe",{othersId:e})}}]),APP.controller("myFansCtrl",["$scope","$timeout","$state","PopupService","myFansService",function(e,t,o,s,i){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFansData={pageIndex:0,pageSize:6,myFans:[],hasMore:!0,api:function(e,t){return i.getMyFans(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFansData.pageIndex=0,e.myFansData.myFans=[],e.myFansData.hasMore=!0,i.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){s.showToast("网络错误！")}),e.loadData(e.myFansData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(o,i){void 0==i&&(i=1e3),o.pageIndex=o.pageIndex+1,o.api(o.pageIndex,o.pageSize).success(function(s){t(function(){1==s.success&&(o.hasMore=o.pageIndex*o.pageSize<s.totalCount,o.myFans=o.myFans.concat(s.data.list),e.nothing=!o.myFans.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络错误！")})},e.followI=function(o,a){var n=a?1:0;i.follow(o.memberId,n).success(function(s){if(1==s.success){for(var i=0;i<e.interested.length;i++)o.memberId==e.interested[i].memberId&&e.interested.splice(i,1);a&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}}).error(function(){s.showToast("网络错误！")})},e.followF=function(o,a){var n=a?1:0,r=o.followId?o.followId:o.memberId;i.follow(r,n).success(function(o){o.success,a&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}).error(function(){s.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){o.go("moreInteresting")},e.jumpMsg=function(){o.go("messageCenter")},e.viewHim=function(e){e.followId?o.go("personalHomepageHe",{othersId:e.followId}):o.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFansService",["$http","UrlService",function(e,t){this.getMyFans=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("MY_FANS"),data:i})},this.getMyInterested=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("INTERESTED"),data:i})},this.follow=function(o,s){var i={id:o,isFollow:s};return e({method:"post",url:t.getUrl("FOLLOW"),data:i})}}]),APP.controller("myFollowCtrl",["$scope","$rootScope","$timeout","$state","PopupService","myFollowService","myFansService",function(e,t,o,s,i,a,n){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFollowsData={pageIndex:0,pageSize:6,myFollows:[],hasMore:!0,api:function(e,t){return a.getMyFollows(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFollowsData.pageIndex=0,e.myFollowsData.myFollows=[],e.myFollowsData.hasMore=!0,n.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){i.showToast("网络错误！")}),e.loadFollowData(e.myFollowsData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadFollowData=function(t,s){void 0==s&&(s=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(i){o(function(){1==i.success&&(t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.myFollows=t.myFollows.concat(i.data.list),e.nothing=!t.myFollows.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络失败！")})},e.followI=function(t,s){var a=s?1:0;n.follow(t.memberId,a).success(function(s){if(1==s.success){for(var i=0;i<e.interested.length;i++)t.memberId==e.interested[i].memberId&&(e.interested.splice(i,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3));e.nothing=!1,t.isFollow=!t.isFollow,t.followId=t.memberId,e.myFollowsData.myFollows.push(t)}}).error(function(){i.showToast("网络失败！")})},e.followF=function(t,o){var s=o?1:0,a=t.followId?t.followId:t.memberId;n.follow(a,s).success(function(t){if(1==t.success)for(var o=0;o<e.myFollowsData.myFollows.length;o++)a==e.myFollowsData.myFollows[o].followId&&(e.myFollowsData.myFollows.splice(o,1),e.myFollowsData.myFollows.length||(e.nothing=!0))}).error(function(){i.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){s.go("moreInteresting")},e.jumpMsg=function(){s.go("messageCenter")},e.viewHim=function(e){e.followId?s.go("personalHomepageHe",{othersId:e.followId}):s.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFollowService",["$http","UrlService",function(e,t){this.getMyFollows=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("MY_FOLLOWS"),data:i})}}]),APP.controller("mySettingsCtrl",["$scope","$state","$ionicPopup","mySettingsService","personalHomepageMeService","NoteDetailsService",function(e,t,o,s,i,a){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.myInfo={},e.data={},e.userId="",e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.creditDetails=function(){t.go("shop")},e.viewCredit=function(){t.go("quanziRecommend")},e.init=function(){e.userId="1",e.isDisplay=!1,i.getUserData("2",e.userId).success(function(t,o,s,i){1==t.success&&(e.myInfo=t.data)}).error(function(e,t,o,s){alert("网络失败！")})},e.apply=function(){window.alert("接口还没出来，你申请也没用，略略略……")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("mySettingsService",function(){}),APP.controller("personalHomepageHeCtrl",["HomePageService","heIssueService","$scope","$http","$rootScope","NoteDetailsService","$state","$timeout","$interval","$stateParams","$window","$location","$ionicScrollDelegate","UserService","PopupService","personalHomepageHeService","personalHomepageMeService","myFansService","communityRecommendService","UrlService","CreditService",function(HomePageService,heIssueService,$scope,$http,$rootScope,NoteDetailsService,$state,$timeout,$interval,$stateParams,$window,$location,$ionicScrollDelegate,UserService,PopupService,personalHomepageHeService,personalHomepageMeService,myFansService,communityRecommendService,UrlService,CreditService){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.contentHeight={height:"296px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.contentHeight={height:"280px"}),$scope.gotoPriLetter=function(){$state.go("privateLetter",{userCode:$scope.othersId})},$scope.user=void 0,$scope.messageNum=void 0,$scope.ifRed=void 0,$scope.isDisplay=void 0,$scope.othersId="",$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.shopList=[],$scope.shareType=void 0,$scope.byShareLink=void 0,$scope.provinceId="",$scope.cityId="",$scope.regionId="",$scope.streetId="",$scope.showShare=!1,$scope.hisStory={nums:-1,pageIndex:0,pageSize:6,storyList:[],hasMore:!0,api:function(e,t,o){return personalHomepageMeService.getMyStory(e,t,o)}},$scope.hisShare={nums:-1,pageIndex:0,pageSize:6,shareList:[],hasMore:!0,api:function(e,t,o){return personalHomepageHeService.hisShare(e,t,o)}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.init=function(tab){switch(personalHomepageHeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId}),$scope.user=UserService.getUser(),$scope.othersId=$stateParams.othersId,$scope.isDisplay=!1,$scope.byShareLink=!$rootScope.isApp,$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,$scope.tabNav="personalHomePageHe",$scope.hisLists=[{title:"dashang",icon:$rootScope.imgBaseURL+"img/homepage/dashang@2x.png",text:"TA的打赏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:$rootScope.imgBaseURL+"img/homepage/zan@2x.png",text:"TA的赞",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:$rootScope.imgBaseURL+"img/homepage/Shape@2x.png",text:"TA的收藏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"}],tab){case 0:$scope.getShopList();break;case 1:$scope.getHisStory();break;case 2:$scope.getHisShare()}personalHomepageHeService.hisShare(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisShare.nums=e.data.totalCount)}),personalHomepageMeService.getMyStory(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisStory.nums=e.data.totalCount)})},$scope.$on("$ionicView.beforeEnter",function(e,t){"forward"==t.direction||"exit"==t.direction||"none"==t.direction?$scope.init(0):"back"==t.direction&&($scope.isDisplay=!1,$scope.downRefresh($scope.selectedIndex))}),$scope.downRefresh=function(e){switch(e){case 0:$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.getShopList();break;case 1:$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisStory();break;case 2:$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisShare()}$scope.$broadcast("scroll.refreshComplete")},$scope.getShopList=function(){$scope.selectedIndex=0,$scope.hisInfo||(personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){if(1==e.success){if($scope.hisInfo=e.data,e.data.storeGride)if($scope.levelArray=[],e.data.storeGride<=3)for(var t=0;t<e.data.storeGride;t++)$scope.levelArray.push("img/StarLevel@2x.png");else for(var t=0;t<e.data.storeGride-3;t++)$scope.levelArray.push("img/DiamondLevel@2x.png");$scope.hisInfo.isStore&&$scope.shop}}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}))},$scope.loadGoods=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisGoods.goodsList=[]),e.api($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.data.storeItemsCounts,e.hasMore=e.pageIndex*e.pageSize<o.data.storeItemsCounts,e.goodsList=e.goodsList.concat(o.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisStory=function(){$scope.selectedIndex=1,$scope.hisStory.storyList||$scope.loadHisStory($scope.hisStory,0)},$scope.loadHisStory=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisStory.storyList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.storyList=e.storyList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisShare=function(){$scope.selectedIndex=2,$scope.hisShare.shareList||$scope.loadShare($scope.hisShare,0)},$scope.loadShare=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisShare.shareList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.shareList=e.shareList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.downloadSg=function(){var e=$rootScope.isIOS?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":"http://app.qq.com/#id=detail&appid=1104761357";$window.location.assign(e)},$scope.hideDownload=function(){$scope.byShareLink=!1},$scope.show=function(){$scope.isDisplay=!$scope.isDisplay},$scope.disappear=function(){$scope.isDisplay=!1},$scope.dealStory=function(e,t){var o=e.storyTopicId?e.storyTopicId:e.id;personalHomepageHeService.dealStory(o,t).then(function(o){if(1==o.data.success){var s;switch(t){case 1:s=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?s-1:s+1,e.praiseFlag=!e.praiseFlag;break;case 2:s=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?s-1:s+1,e.collectionFlag=!e.collectionFlag;break;case 3:s=parseInt(e.praiseNumber1),e.praiseNumber1=e.praiseFlag1?s-1:s+1,e.praiseFlag1=!e.praiseFlag1;break;case 4:s=parseInt(e.collectionNumber1),e.collectionNumber1=e.collectionFlag1?s-1:s+1,e.collectionFlag1=!e.collectionFlag1}}else PopupService.showToast(o.data.message)},function(){PopupService.showToast("网络错误！")})},$scope.follow=function(e){HomePageService.isWdHost().success(function(t){if($rootScope.isWdHost=t.data.isHost,-1==$rootScope.isWdHost)$state.go("login");else if(0==e){var o={id:$stateParams.othersId,isFollow:1};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.isFollow=1,$scope.hisInfo.praise+=1,$scope.alreadyFollow=!0,$timeout(function(){$scope.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}else if(1==e){var o={id:$stateParams.othersId,isFollow:0};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.praise-=1,$scope.hisInfo.isFollow=0):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}})},$scope.ToIssue=function(e,t,o){"issue"==e&&heIssueService.getMyIssue(1,5,o,0).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"comment"==e&&heIssueService.getMyComment(1,5,o,0).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"quanzi"==e&&heIssueService.getMyJoinedTopics(o).success(function(s){
-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"dashang"==e&&heIssueService.getDaShang(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"zan"==e&&heIssueService.getUserPraise(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"shoucang"==e&&heIssueService.getCollection(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})})},$scope.joinTopic=function(e){var t=e.storyTopicId;communityRecommendService.joinTopic(t).then(function(t){1==t.data.success?e.topicFocusFlag=!0:-2e3==t.errorCode&&(PopupService.showToast(t.data.message),$rootScope.loginIsAccord2=!0)},function(){PopupService.showToast("网络错误")})},$scope.addToCart=function(e){var t={productId:e,number:1,o2oStoreName:"",o2omap:e+","};personalHomepageHeService.toCart(t).then(function(e){1==e.data.success?PopupService.showToast("加入购物车成功"):PopupService.showToast(e.data.message)},function(e){PopupService.showToast(e)})},$scope.viewHim=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.toProductDetails=function(e){$state.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId})},$scope.viewShop=function(){window.cordova&&$rootScope.gio.evar.set({source:"Community",value:$scope.shop?$scope.shop.storeId:$stateParams.othersId}),$state.go("myStore",{storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId,shareStoreId:""})},$scope.jumpMsg=function(){$state.go("messageCenter")},$scope.viewStory=function(e){var t=e.storyTopicId?e.storyTopicId:e.id;2!==e.flag?$state.go("noteDetails",{noteId:t,isShortStory:e.isShortStory}):$state.go("classNoteDetails",{noteId:t})},$scope.viewTopic=function(e){$state.go("circlePage",{circleId:e})},$scope.share=function(e){if(window.umeng){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.shareType=e}else alert("只能在app分享,请下载app！")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e,t){var o,s,i,a;t?$scope.shop&&(o=($scope.shop.storeName?$scope.shop.storeName:"他")+"的顺逛小店",s="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=UrlService.getShareLinkHeader()+"myStore/"+$scope.shop.storeId+"/"+$scope.shop.storeId+"/"):(o=($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的空间",s="欢迎关注"+($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=UrlService.getShareLinkHeader()+"personalHomePageHe/"+$scope.hisInfo.memberId),window.umeng?0==e?window.umeng.shareToSina(o,s,i,a,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,CreditService.shareSuccessCallback):3==e?window.umeng.shareToQQ(o,s,i,a,0,null,CreditService.shareSuccessCallback):4==e?window.umeng.shareToQzone(o,s,i,a,0,null,CreditService.shareSuccessCallback):5==e&&$scope.copeText(a):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("personalHomepageHeService",["$http","UrlService",function(e,t){this.hisShare=function(o,s,i){var a={pageIndex:o,pageSize:s,userCode:i};return e({method:"post",url:t.getUrl("HIS_SHARE"),data:a})},this.toCart=function(o){var s={productId:o.productId,number:o.number,o2oStoreName:o.o2oStoreName,o2omap:o.o2omap};return e({method:"get",url:t.getUrl("SHOP_ADD_CART"),params:s})},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.dealStory=function(o,s){var i,a={id:o,noLoading:!0};switch(s){case 1:i="COMMENT_PRAISE";break;case 2:i="COLLECTION_TOPIC";break;case 3:i="SCHOOLPRAISESTORY";break;case 4:i="SCHOOLCOLLECTION"}return e({method:"post",url:t.getUrl(i),data:a})}}]),APP.controller("personalHomepageMeCtrl",["$scope","heIssueService","myFollowService","myFansService","$rootScope","$state","$timeout","$interval","$ionicScrollDelegate","PopupService","UserService","personalHomepageMeService","UrlService","personalHomepageHeService","$ionicModal","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.contentHeight={height:"296px"}):(e.paddingtopClass={"margin-top":"0px"},e.contentHeight={height:"280px"}),e.goBackTo=function(){e.$ionicGoBack()},e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.userId="",e.user=void 0,e.userData={},e.data=[],e.story=void 0,e.selectedIndex=void 0,e.notApply=void 0,e.teachedList="",e.joinedList="",e.showShare=!1,e.myTopics=void 0,e.noTopic=!1,e.myStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return p.getMyStory(e,t)}},e.myCollectionStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return p.getMyCollection(e,t)}},e.init=function(t){e.tabNav="personalHomepageMe",e.hisLists=[{title:"dashang",icon:i.imgBaseURL+"img/homepage/dashang@2x.png",text:"我的打赏",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:i.imgBaseURL+"img/homepage/zan@2x.png",text:"我的赞",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:i.imgBaseURL+"img/homepage/Shape@2x.png",text:"我的收藏",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"}],m.fromTemplateUrl("templates/quanzi/ApplyTeacherModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyTeacherModal=t}),e.myTopics=void 0,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.notApply=!0,e.isDisplay=!1,e.data=[],e.selectedIndex=void 0,e.user=d.getUser(),e.userId=d.getUser().mid,p.getUserData1("2",e.userId).success(function(t){if(e.userData1=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(i.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(i.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),p.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),p.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),p.getMyCollection(1,0).then(function(t){1==t.data.success&&(e.myCollectionStory.nums=t.data.totalCount)}),e.$broadcast("scroll.refreshComplete")},e.showApplyModal=function(){p.startApply().success(function(t){t.success?0==t.data.applyStatus?e.data.isApply=!0:1==t.data.applyStatus?(e.message=t.message,e.applyStatus=1,e.applyTeacherModal.show()):(e.introduce=t.data.introduce,e.message=t.message,e.applyStatus=2,e.applyTeacherModal.show()):e.data.isApply=!1},function(e){})},e.hideApplyModal=function(){delete e.applyStatus,e.applyTeacherModal.hide()},e.jumpMyCircle=function(){a.go("myCirclePages")},e.applyStatus3=function(){e.hideApplyModal(),n(function(){e.applyStatus=3,e.applyTeacherModal.show()},500)},e.editApply=function(){e.hideApplyModal(),e.data.isApply=!0},e.getTeachedList=function(){var t={pageSize:10,pageIndex:1};p.teachedLessones(t).success(function(t){e.teachedList=t.data.list}).error(function(){})},e.getJoinededList=function(){var t={pageSize:10,pageIndex:1};p.joinedLessones(t).success(function(t){e.joinedList=t.data.list,e.classesCount=t.data}).error(function(){})},e.selectTab=function(t){switch(e.selectedIndex=t,t){case 0:e.myCollectionStory.storyList||e.loadData(e.myCollectionStory,0),n(function(){e.story=e.myCollectionStory},0);break;case 1:e.myStory.storyList||e.loadData(e.myStory,0),e.story=e.myStory;break;case 2:e.myTopics||p.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}n(function(){c.resize()},200)},e.loadData=function(t,o){null!=o&&void 0!=o||(o=1e3),t.pageIndex=t.pageIndex+1,1==t.pageIndex&&(t.storyList=[]),t.api(t.pageIndex,t.pageSize).success(function(s){n(function(){1==s.success&&(t.nums=s.totalCount,t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.storyList=t.storyList.concat(s.data.list),e.$broadcast("scroll.infiniteScrollComplete"))},o)}).error(function(){alert("网络失败！")})},e.$on("$ionicView.beforeEnter",function(t,o){"forward"==o.direction||"exit"==o.direction||"none"==o.direction?e.init(1):"back"==o.direction&&(e.isDisplay=!1,e.downRefresh(e.selectedIndex))}),e.downRefresh=function(t){switch(p.getUserData1("2",e.userId).success(function(t){if(e.userData=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(i.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(i.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),p.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),p.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),t){case 0:e.selectedIndex=0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.loadData(e.myCollectionStory,0);break;case 1:e.selectedIndex=1,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.loadData(e.myStory,0);break;case 2:e.selectedIndex=2,e.myTopics=void 0,p.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}e.$broadcast("scroll.refreshComplete")},e.noFind=function(){e.userData.img="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/user.jpg"},e.apply=function(t){var o={introduce:t,status:2==e.applyStatus?1:0};if(t)p.apply(o).then(function(t){1==t.data.success?(e.notApply=!1,l.showToast("申请已提交，等待审核……"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){});else if(3==e.applyStatus){var o={introduce:t,status:2};p.apply(o).then(function(t){1==t.data.success?(e.hideApplyModal(),e.introduce="",e.notApply=!1,l.showToast("申请已放弃"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){})}else l.showToast("申请描述不能为空，请填写……")},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.dealStory=function(t,o){var s;s=2!==t.flag?o:1==o?3:4;var i=t.storyTopicId?t.storyTopicId:t.id;g.dealStory(i,s).then(function(o){if(1==o.data.success){var a;switch(s){case 1:a=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?a-1:a+1,t.praiseFlag=!t.praiseFlag;break;case 2:if(a=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?a-1:a+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(var n=0;n<e.myCollectionStory.storyList.length;n++)i==e.myCollectionStory.storyList[n].id&&(e.myCollectionStory.storyList.splice(n,1),e.myCollectionStory.nums--);break;case 3:a=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?a-1:a+1,t.praiseFlag=!t.praiseFlag;break;case 4:if(a=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?a-1:a+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(n=0;n<e.myCollectionStory.storyList.length;n++)i==e.myCollectionStory.storyList[n].id&&(e.myCollectionStory.storyList.splice(n,1),e.myCollectionStory.nums--)}}},function(){l.showToast("网络错误！")})},e.ToMyIssue=function(e,o,s){"issue"==e&&t.getMyIssue(1,5,s,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"comment"==e&&t.getMyComment(1,5,s,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"quanzi"==e&&t.getMyJoinedTopics(s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"dashang"==e&&t.getDaShang(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"zan"==e&&t.getUserPraise(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"shoucang"==e&&t.getCollection(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})})},e.settings=function(){a.go("mySettings")},e.fans=function(){s.getMyFans(1,6).success(function(e){1==e.success?a.go("myFans"):-2e3==e.errorCode&&(l.showToast(e.message),i.loginIsAccord2=!0)})},e.follows=function(){o.getMyFollows(1,6).success(function(e){1==e.success?a.go("myFollow"):-2e3==e.errorCode&&(l.showToast(e.message),i.loginIsAccord2=!0)})},e.jumpMsg=function(){a.go("messageCenter")},e.viewTopic=function(e){a.go("circlePage",{circleId:e})},e.viewMyTopic=function(){i.xinxianshow=!1,i.myquanshow=!0,i.buttonshowl=!1,i.buttonshowr=!0,a.go("topic.qmine")},e.viewStory=function(e){2!==e.flag?a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):a.go("classNoteDetails",{noteId:e.id})},e.viewShop=function(){a.go("myStore",{storeId:e.userData.memberId,shareStoreId:""})},e.viewHim=function(e){1==e.flag&&a.go("personalHomepageHe",{othersId:e.userCode})},e.share=function(){if(!d.getUser().mid)return void a.go("login");window.umeng?e.showShare=!e.showShare:alert("只能在app分享,请下载app！")},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=(e.userData.userName?e.userData.userName:"他")+"的空间",s="欢迎关注"+(e.userData.userName?e.userData.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=u.getShareLinkHeader()+"personalHomePageHe/"+e.userData.memberId;window.umeng?0==t?window.umeng.shareToSina(o,s,i,a,0,null,f.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,f.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,f.shareSuccessCallback):3==t?window.umeng.shareToQQ(o,s,i,a,0,null,f.shareSuccessCallback):4==t?window.umeng.shareToQzone(o,s,i,a,0,null,f.shareSuccessCallback):5==t&&e.copeText(a):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("personalHomepageMeService",["$http","UrlService",function(e,t){this.getUserData1=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_ONE"),data:i})},this.getUserData2=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_TWO"),data:i})},this.getUserData3=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_THREE"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyStory=function(o,s,i){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyCollection=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.startApply=function(){return e({method:"post",url:t.getUrl("START_APPLY_LECTURER"),data:{}})},this.apply=function(o){return e({method:"post",url:t.getUrl("APPLY_LECTURER"),data:o})},this.teachedLessones=function(o){return e({method:"post",url:t.getUrl("TEACHED_COURSE"),data:o})},this.joinedLessones=function(o){return e({method:"post",url:t.getUrl("JOINED_COURSE"),data:o})}}]),APP.controller("QdatabaseController",["$scope","$rootScope","$ionicHistory","QdatabaseService","$http","$ionicSlideBoxDelegate","$timeout","$state",function(e,t,o,s,i,a,n,r){e.quanlist="",e.isshow=!1,e.topshow=!1,e.xxshow=!1,e.sshow=!1,t.xiaoxis=!1,e.shuxiaoxi=!1,e.userlist="",e.count=0,e.ziliaolist="",t.msgCount="",e.totalCount=0,e.nogengduo="没有更多数据",e.storyName={name:""},e.storyType="",t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.goBack=function(){e.$ionicGoBack()},e.soushow=function(){e.sshow=!e.sshow},e.gotoxiaoxi=function(){r.go("qzMessageCenter"),t.xiaoxis=!1},e.toMsgCenter=function(){r.go("qzMessageCenter")},e.gototiezi=function(e){r.go("topicdetails",{noteId:e.id,isShortStory:e.isShortStory})},e.inputclass=function(t){e.storyType=t.id,e.init()},e.inputname=function(t){e.storyType="",e.init(),e.sshow=!1},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,storyName:e.storyName.name,storyType:e.storyType};n(function(){s.getziliaolist(t).success(function(t,o,s,i){return e.ziliaolist=t.data.list,e.totalCount=t.totalCount,t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},200),e.isjiazai=e.pageSize*e.pageIndex,e.hasMore=e.isjiazai>e.totalCount},e.loadData=function(){n(function(){var t=e.isjiazai<=e.totalCount;if(e.isjiazai=e.pageIndex*e.pageSize,e.pageIndex=e.pageIndex+1,t){var o={pageSize:e.pageSize,pageIndex:e.pageIndex};return s.getziliaolist(o).success(function(t,o,s,i){return e.ziliaolist=e.ziliaolist.concat(t.data.list),e.totalCount=t.totalCount,t}).error(function(){}),e.hasMore=t,e.$broadcast("scroll.refreshComplete"),void e.$broadcast("scroll.infiniteScrollComplete")}e.nogengduo="没有更多数据",e.hasMore=t,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){s.gettopic().success(function(t,o,s,i){return e.quanlist=t.data,t}),s.getxiaoxi().success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.dataList=[],e.hasMore=!0,e.pageSize=5,e.pageIndex=1,e.isjiazai=0,e.totalCount="",e.initdata()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QdatabaseService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.gettopic=function(){return e.get("./data/fenlei.json")},this.getziliaolist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)}}]),APP.controller("qSearchController",["$scope","$rootScope","$ionicHistory","qSearchService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.biaoqian="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",e.$ionicGoBack()},e.goqSearchThree=function(){window.cordova&&cordova.plugins.Keyboard.close(),n.go("qSearchThree",{keywords:e.input.isinput})},e.search=function(e){n.go("qSearchThree",{keywords:e.target.value})},e.BgoqSearchTwo=function(e){n.go("qSearchThree",{keywords:e.name})},e.init=function(){e.input.isinput="";var t={isHot:0};s.getbiaoqian(t).success(function(t,o,s,i){return r(function(){e.biaoqian=t.data.list,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),setTimeout(function(){document.getElementById("qSearch").focus()},200),l.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.init(),e.showmore=!0})}]),APP.service("qSearchService",["$http","UrlService",function(e,t){this.getbiaoqian=function(o){return e.post(t.getUrl("TOPIC_TAGS"),o)}}]),APP.controller("qSearchBiaoController",["HomePageService","$scope","$rootScope","$ionicHistory","qSearchBiaoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u){t.topiclist="",t.pageIndex="",t.pageSize=10,t.keywords="",t.ismore="",t.totalCount="",t.hasMore="",t.ismoreshow="",t.showmore="",t.input={isinput:t.isinput},t.goBack=function(){1==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("allCircle")):2==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("qSearch")):r.go("qSearchThree",{keywords:t.input.isinput})},t.goqSearchTwo=function(){r.go("qSearchTwo",{keywords:t.input.isinput})},t.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},t.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),t.input.isinput=e.target.value,t.init()},t.joinCircle=function(s){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)r.go("login");else{t.itemTopicName=s.topicName;var a={ids:s.id};i.joinTopic(a).success(function(e){1==e.success?(s.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):p.showToast(e.message)}).error(function(){p.showToast("加入失败")})}}),t.itemTopicName=s.topicName;var a={ids:s.id};i.joinTopic(a).success(function(e){1==e.success?(s.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):-2e3==e.errorCode&&(p.showToast(e.message),o.loginIsAccord2=!0)}).error(function(){p.showToast("加入失败")})},t.loadData=function(){c(function(){if(t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.pageIndex=t.pageIndex+1,!t.hasMore)return p.showToast("没有更多数据"),t.hasMore;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};i.gettopic(e).success(function(e,o,s,i){return c(function(){t.topiclist=t.topiclist.concat(e.data.list),t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){p.showToast("没有更多数据")}),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3)},t.init=function(){t.keywords=t.input.isinput,t.pageIndex=1,t.pageSize=10;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};i.gettopic(e).success(function(e,o,s,i){return c(function(){t.topiclist=e.data.list,t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){}),u.scrollTop()},t.$on("$ionicView.beforeEnter",function(){t.showmore=!1,t.input={isinput:d.keywords},t.keywords=t.input.isinput,t.init(),t.showmore=!0})}]),APP.service("qSearchBiaoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchThreeController",["$scope","$rootScope","$ionicHistory","qSearchThreeService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.userlist="",e.topiclist="",e.huatilist="",e.pageIndex="",e.pageSize=3,e.showmore="",e.usershow="",e.topicshow="",e.tiezishow="",e.input={isinput:""},e.keywords=e.input.isinput,e.goBack=function(){e.input.isinput="",n.go("qSearch")},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.memberId})},e.storygotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userCode})},e.gototiezi=function(e){n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoquanezi=function(e){n.go("circlePage",{circleId:e.id})},e.goqSearchBiao=function(){e.keywords=e.input.isinput,n.go("qSearchBiao",{keywords:e.keywords})},e.BgoqSearchUser=function(){e.keywords=e.input.isinput,n.go("qSearchUser",{keywords:e.keywords})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.BgoqSearchTie=function(){e.keywords=e.input.isinput,n.go("qSearchTie",{keywords:e.keywords})},e.joinCircle=function(o){e.itemTopicName=o.topicName;var i={ids:o.id};s.joinTopic(i).success(function(s){1==s.success?(o.isJoin=1,e.init(),e.inCircle=!0,r(function(){e.inCircle=!1},1e3)):-2e3==s.errorCode&&(d.showToast(s.message),t.loginIsAccord2=!0)}).error(function(){d.showToast("加入失败")})},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=3;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return e.userlist=t.data.list,e.usershow=t.totalCount>3,t}).error(function(){});var o={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gettopic(o).success(function(t,o,s,i){return e.topiclist=t.data.list,e.topicshow=t.totalCount>3,t}).error(function(){});var i={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(i).success(function(t,o,s,i){return e.huatilist=t.data.list,e.tiezishow=t.totalCount>3,t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchThreeService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchTieController",["$scope","$rootScope","$ionicHistory","qSearchTieService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.huatilist="",e.pageIndex="",e.pageSize=10,e.keywords="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){n.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){n.go("qSearchTwo",{keywords:e.input.isinput})},e.gototiezi=function(e){n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(t).success(function(t,o,s,i){return r(function(){e.huatilist=e.huatilist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(t).success(function(t,o,s,i){return r(function(){e.huatilist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchTieService",["$http","UrlService",function(e,t){this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)}}]),APP.controller("qSearchTwoController",["$scope","$rootScope","$ionicHistory","qSearchTwoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.topiclist="",e.ismore="",e.topicListCount="",e.pageIndex="",e.pageSize=10,e.tagIds="",t.toFilterCode=2,e.ismoreshow="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",n.go("qSearch")},e.goqSearchBiao=function(){n.go("qSearchBiao",{keywords:e.input.isinput})},e.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),n.go("qSearchBiao",{keywords:e.target.value})},e.gotobiao=function(){t.toFilterCode=2,n.go("qSearchBiao",{keywords:e.input.isinput})},e.gotoquanezi=function(e){n.go("circlePage",{circleId:e.id})},e.joinCircle=function(t){e.itemTopicName=t.topicName;var o={ids:t.id};s.joinTopic(o).success(function(o){1==o.success?(t.isJoin=1,e.inCircle=!0,r(function(){e.inCircle=!1},1e3),e.init()):d.showToast(o.message)}).error(function(){d.showToast("加入失败")})},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,tagIds:e.tagIds};s.gettopic(t).success(function(t,o,s,i){return r(function(){e.topiclist=e.topiclist.concat(t.data.list.topicList),e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){t.toFilterCode=2,e.pageIndex=1,e.pageSize=10;var o={pageIndex:e.pageIndex,pageSize:e.pageSize,tagIds:e.tagIds};s.gettopic(o).success(function(t,o,s,i){return r(function(){e.topiclist=t.data.list.topicList,e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.ismore=t.data.list.createDate1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.tagIds=l.tagIds,e.input={isinput:l.tagname},e.init(),e.showmore=!0})}]),APP.service("qSearchTwoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETLISTBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchUserController",["$scope","$rootScope","$ionicHistory","qSearchUserService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.userlist="",e.pageIndex="",e.pageSize=10,e.biaoqian="",e.ismore="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){n.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){n.go("qSearchTwo",{keywords:e.input.isinput})},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.memberId})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return r(function(){e.userlist=e.userlist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.userlist<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){
e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return r(function(){e.userlist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchUserService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)}}]),APP.controller("QhotController",["$scope","$rootScope","PlatformService","HomePageService","CLASSIFYMESSAGECRNTERService","$ionicHistory","QhotService","ShopService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}e.flagNum=!1,e.tielist="",e.quanlist="",e.bannerlist="",e.selectedIndex="",t.xiaoxis=!1,e.dataList=[],e.nogengduo="",e.userdata="",e.topshow=!1,e.hasMore=!0,e.ismore=!0,e.totalCount="",e.datafist="",e.message="",e.showList=!1;var h=null;t.showRightTop=!1,t.msgCount="",e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){d.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoxiaoxi=function(){d.go("ClassifyMessageCenter")},e.gotomyzhu=function(){d.go("personalHomepageMe")},e.gotoothers=function(e){d.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){d.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){d.go("allCircle")},e.scrollToTop=function(){m.$getByHandle("qhotHandle").scrollTop(!0),e.showTopBtn=!1},e.getScrollHeight=function(){e.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),e.scrollHeight>3*e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},e.hotgo=function(){var e=m.$getByHandle("pinglun"),t=e.getScrollPosition().left,o=document.getElementById("hotdiv").offsetWidth;t>4.3*o&&d.go("allCircle")},e.gotoqSearch=function(){d.go("qSearch")},e.dianzan=function(o,s){window.cordova&&(t.gio.track("like",{circleID:e.tielist[s].topicId}),t.gio.track("active",{circleID:e.tielist[s].topicId}));var i=f("loginId"),a={id:o,noLoading:!0,userCode:i};n.postdianzan(a).success(function(t){1==t.success?1==e.tielist[s].praiseFlag?(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber-1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber+1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):p(function(){g.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?n.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):g.showToast(t.message),t}).error(function(){}):n.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=f("loginId"),o=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0,userCode:t}:{pageSize:e.pageSize,pageIndex:e.pageIndex,userCode:t};p(function(){n.getstorylist(o).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){e.pageIndex+=1;var t=f("loginId"),o={pageSize:5,pageIndex:e.pageIndex,noLoading:!0,userCode:t};n.getstorylist(o).success(function(t){t.data.list&&0!=t.data.list.length?h=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.infiniteScrollComplete");var o=e.tielist.length;e.hasmore=!(o==t.totalCount),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.jumpBannerUrl=function(e,t){if(0==e){var s=t.split("/");"noteDetails"==s[1]?d.go("noteDetails",{noteId:s[2],isShortStory:s[3]}):"circlePage"==s[1]?d.go("circlePage",{circleId:s[2]}):d.go("personalHomepageMe")}else if(1==e)if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var i=t+"&openType=h5";"APP"==o.getPlatform()?cordova.InAppBrowser.open(i,"_system","location=yes"):window.open(i)}else{var a=navigator.userAgent;a.indexOf("Android")>-1||a.indexOf("Linux")>-1?"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t):(a.indexOf("iPhone"),"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t))}},e.showCameraList=function(){e.showList=!e.showList},e.hideList=function(){e.showList=!1},e.isClick=function(){e.isDisplay=!e.isDisplay},e.jumpPhoto=function(o){s.isWdHost().success(function(s){t.isWdHost=s.data.isHost,-1==t.isWdHost?d.go("login"):(e.showList=!1,3!=o?d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(s){var i=JSON.parse(s),a=i.videoFile,n=i.imageFile,r=a.replace("\\",""),c=n.replace("\\","");t.mediaurla=r,t.mediaImga=c,d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o})},function(e){}))})},e.init=function(){e.showList=!1,e.isDisplay=!1,e.phoneHeight=document.documentElement.clientHeight/2;var o=e.quanlist?{pageIndex:1,pageSize:15,noLoading:!0}:{pageIndex:1,pageSize:15};n.gettopic(o).success(function(t,o,s,i){return e.quanlist=t.data.list,t}).error(function(){});var s=e.quanlist?{bannerType:0,noLoading:!0}:{bannerType:0};n.getlunbo(s).success(function(t,o,s,i){return e.bannerlist=t.data.list,l.$getByHandle("qhot_slider").update(),t}).error(function(){});var i={noLoading:!!e.quanlist||""};n.getxiaoxi(i).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.hasMore=!0,e.initdata(),r.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(o,s){window.cordova&&t.gio.track("communityEntry"),"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),p(function(){n.getusertopic().success(function(t,o,s,i){e.datafist=t.data,e.datafist&&d.go("quanziRecommend")}).error(function(){})},1e3),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(h)})}]),APP.service("QhotService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETHOTSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getxiaoxi=function(o){return e.get(t.getUrl("UNRED_MESSAGE"),o)},this.getlunbo=function(o){return e.post(t.getUrl("GETBANNERLIST"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETHOTTOPICLIST"),o)},this.getusertopic=function(o){return e.post(t.getUrl("ADDUSER"),o)},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("QmineController",["$scope","$rootScope","$ionicHistory","QmineService","$http","$ionicSlideBoxDelegate","CLASSIFYMESSAGECRNTERService","$state","$timeout","PopupService","MyCirclePagesService",function(e,t,o,s,i,a,n,r,c,l,d){e.tielist="",e.flagNum=!1,e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";var p=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.xxshow=function(){t.xinxianshow=!0,t.myquanshow=!1,t.buttonshowl=!0,t.buttonshowr=!1},e.wdshow=function(){t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0},e.gototiezi=function(e){r.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotomyzhu=function(){r.go("personalHomepageMe")},e.gotoxiaoxi=function(){r.go("ClassifyMessageCenter")},e.gotoothers=function(e){r.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){r.go("allCircle")},e.gotoqSearch=function(){r.go("qSearch")},e.joinCircle=function(o){window.cordova&&(t.gio.track("follow",{circleID:o.id}),t.gio.track("active",{circleID:o.id})),e.itemTopicName=o.topicName;var i={ids:o.id,noLoading:!0};s.joinTopic(i).success(function(t){1==t.success?(o.isJoin=1,o.topicFocusFlag=1,e.init(),e.inCircle=!0,c(function(){e.inCircle=!1},1e3)):l.showToast(t.message)}).error(function(){l.showToast("加入失败")})},e.dianzan=function(o,i){window.cordova&&(t.gio.track("like",{circleID:e.tielist[i].topicId}),t.gio.track("active",{circleID:e.tielist[i].topicId}));var a={id:o,noLoading:!0};s.postdianzan(a).success(function(t){1==t.success?1==e.tielist[i].praiseFlag?(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber-1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber+1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):c(function(){l.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?s.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):l.showToast(t.message),t}).error(function(){}):s.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};c(function(){s.gettielist(t).success(function(t,o,s,i){if(t.success)return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){c(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return l.showToast("没有更多数据"),e.nogengduo="没有更多数据",e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};s.gettielist(t).success(function(t,o,s,i){return p=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.getMyCreatTopicInfo=function(t){var o={keywords:t};d.getMyCreatTopics(o).then(function(t){t.data.success&&(e.myCreatTopics=t.data.data.list)},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};d.getMyJoinedTopics(o).then(function(t){t.data.success&&(e.myTopics=t.data.data.list)},function(e){})},e.clickIn=function(e,o){0==o?r.go("circlePage",{circleId:e}):2==o?(t.showApplyTag=1,t.reviewCircleId=e,r.go("applyCircle")):(t.reviewCircleId=e,r.go("applyCircle"))},e.viewTopic=function(e){r.go("circlePage",{circleId:e})},e.init=function(){e.myCreatTopics=[],e.myTopics=[],e.tielist="",e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";t.showRightTop=!1,e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo(),e.selectedIndex=void 0;var o=e.quanlist?{ids:"",noLoading:!0}:{ids:""};s.gettopic(o).success(function(t,o,s,i){if(t.success)return e.quanlist=t.data.list,t}).error(function(){});var i={pageIndex:1,pageSize:3};s.gettuitopic(i).success(function(t,o,s,i){if(t.success)return e.tuiquanlist=t.data.list,t}).error(function(){});var a=e.quanlist?{noLoading:!0}:"";s.getxiaoxi(a).success(function(t,o,s,i){t.data&&0!=t.data?e.flagNum=!0:e.flagNum=!1}).error(function(){}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(){"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),t.showRightTop=!1,t.xiaoxis=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(p)})}]),APP.service("QmineService",["$http","UrlService",function(e,t){this.gettielist=function(o){return e.post(t.getUrl("GETMYFOLLOWINGSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETMYTOPICLIST"),o)},this.gettuitopic=function(o){return e.post(t.getUrl("RECOMMEND_LIST"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("communityRecommendCtrl",["$scope","$rootScope","$timeout","$state","PopupService","communityRecommendService",function(e,t,o,s,i,a){e.idArray=[],e.ids=[],e.topics=[],e.matrixes=[],e.init=function(){e.$broadcast("scroll.refreshComplete"),a.getCommunities().success(function(o){if(1==o.success){if(e.topics=o.data.list,e.topics.length>12)for(var s=0;s<Math.ceil(e.topics.length/12);s++)e.matrixes[s]=e.topics.slice(12*s,12*s+12);for(var a=0;a<e.topics.length;a++)1==e.topics[a].recommend&&(e.ids.push(e.topics[a].id),e.idArray.push(e.topics[a].id))}else-2e3==o.errorCode&&(i.showToast(o.message),t.loginIsAccord2=!0)}).error(function(){i.showToast("网络错误！")})},e.selectAll=function(t){if(e.ids.length!=e.topics.length){e.ids=[];for(var o=0;o<e.topics.length;o++)e.topics[o].isJoin||(e.topics[o].isJoin=!0),e.ids.push(e.topics[o].id)}else{for(o=0;o<e.topics.length;o++)e.topics[o].isJoin&&(e.topics[o].isJoin=!1);e.ids=[],e.ids=e.ids.concat(e.idArray)}},e.joinOrApply=function(t){if(0==t.recommend||null==t.recommend)if(t.isJoin=!t.isJoin,t.isJoin)e.ids.push(t.id);else for(var o=0;o<e.ids.length;o++)e.ids[o]==t.id&&e.ids.splice(o,1)},e.done=function(){e.ids.length?a.joinTopic(e.ids).then(function(t){1==t.data.success?(e.ids=[],s.go("topic.qhot")):i.showToast(t.data.message)},function(){}):s.go("topic.qhot")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("communityRecommendService",["$http","UrlService",function(e,t){this.joinTopic=function(o){var s={ids:o.toString()};return e({method:"post",url:t.getUrl("JOIN_TOPIC"),data:s})},this.getCommunities=function(){return e({method:"post",url:t.getUrl("LAUNGCH_RECOMMEND_LIST")})}}]),APP.controller("QwschoolController",["$scope","$rootScope","$ionicHistory","QwschoolService","$http","$state","CLASSIFYMESSAGECRNTERService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.tielist="",e.flagNum=!1,e.quanlist="",e.classlist="",e.ziliaolist="",e.buttonshowl=!1,e.buttonshowr=!0,t.xiaoxis=!1,e.isjiazai=0,e.nogengduo="",e.userdata="",e.selectedIndex=void 0,e.hasMore=!0,e.ismore=!0,e.message="",e.catelist="",e.selectCheck="";var d=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){a.go("classNoteDetails",{noteId:e.id})},e.gotomyzhu=function(){a.go("personalHomepageMe")},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userCode})},e.gotoqSearch=function(){a.go("qSearch")},e.gotoxiaoxi=function(){a.go("messageCenter")},e.gotoziliao=function(){a.go("qdatabase")},e.dianzan=function(t,o){var i={id:t,noLoading:!0};s.postdianzan(i).success(function(t){1==t.success?1==e.tielist[o].praiseFlag?(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber-1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber+1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):r(function(){c.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?s.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):c.showToast(t.message),t}).error(function(){}):s.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.selectlist=function(t){if(e.selectCheck==t)e.selectCheck="",e.storyid="",e.initdata();else{e.pageIndex=1,e.selectCheck=t,e.storyid=parseInt(t);var o={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};r(function(){s.getstorylist(o).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)}},e.initdata=function(){e.storyid="",e.selectCheck="",e.pageSize=5,e.pageIndex=1;var t=e.userdata?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};r(function(){s.getstorylist(t).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.tielist<5?e.hasMore=!1:(e.hasMore=!0,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")),t}).error(function(){})},300)},e.loadData=function(){if(e.pageIndex=e.pageIndex+1,e.storyid)var t={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};else var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};s.getstorylist(t).success(function(t,o,s,i){return d=setTimeout(function(){t.data.list.length<5?(e.hasMore=!1,c.showToast("没有更多数据"),e.nogengduo="没有更多数据"):e.hasMore=!0,e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){})},e.init=function(){e.selectedIndex=void 0;var o={noLoading:!0};s.business().success(function(t){e.catelist=t.data.list}),s.getxiaoxi(o).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount,o.data&&0!=o.data?e.flagNum=!0:e.flagNum=!1}).error(function(){});var i={id:1,type:1,noLoading:!0};s.getuserdata(i).success(function(t,o,s,i){return e.userdata=t.data,t}).error(function(){});var a={noLoading:!0};s.getclass(a).success(function(t,o,s,i){return e.classlist=t.data.list,t}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(o,s){"classNoteDetails"==t.nextPageBefore?t.nextPageBefore="":($("ion-header-bar").show(),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(d)})}]),APP.service("QwschoolService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getclass=function(o){return e.post(t.getUrl("GETCOURSEINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.postdianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.postshoucang=function(o){return e.post(t.getUrl("SCHOOLCOLLECTION"),o)},this.business=function(o){return e.post(t.getUrl("GET_BUSINESS"),o)}}]),APP.controller("qzMessageCenterController",["$scope","$state","qzMessageCenterService",function(e,t,o){e.hasmore=!1,e.selectedIndex=0,e.id="",e.platformData,e.smallClassData,e.otherData,e.param={pageSize:5,id:e.id,page:e.page,noLoading:!0},e.goBack=function(){e.$ionicGoBack()},e.goDetails=function(){t.go("messageDetails")},e.getPlatformData=function(){o.getPlatformMsg().success(function(t){e.platformData=t.data})},e.getSmallClassData=function(){o.getSmallClassMsg().success(function(t){e.smallClassData=t.data})},e.getOtherData=function(){o.getOtherMsg().success(function(t){e.otherData=t.data})},e.page=1,e.loadMore=function(){e.page+=1,e.loadMoreMsg(e.param)},e.loadMoreMsg=function(t){o.loadMoreProducts(t).success(function(t,o,s,i){if(null!=t.data.msgList&&void 0!=t.data.msgList&&0!=t.data.msgList.length){e.msgList=e.msgList.concat(t.data.msgList),e.$broadcast("scroll.infiniteScrollComplete");var a=e.msgList.length;e.hasmore=!(a===t.data.storeItemsCounts)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,e.msgList=[]})},e.init=function(){e.getPlatformData(),e.getSmallClassData(),e.getOtherData()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("qzMessageCenterService",["$http","UrlService",function(e,t){this.getPlatformMsg=function(){return e.get(t.getUrl("PLATFORM_INFO"),params)},this.getSmallClassMsg=function(){return e.get("data/smallClassMessage.json")},this.getOtherMsg=function(){return e.get("data/otherMessage.json")},this.loadMoreMessage=function(o){return params={pageSize:o.pageSize,id:o.id,page:o.page,noLoading:o.noLoading},e.get(t.getUrl(),params)}}]),APP.controller("relatedProductController",["$ionicHistory","$http","$scope","relatedProductsService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService",function($ionicHistory,$http,$scope,relatedProductsService,$stateParams,$state,$cookieStore,$ionicPopup,$timeout,LoginService,$rootScope,$ionicModal,$localstorage,PopupService){$scope.provinceId=0,$scope.cityId=0,$scope.regionId=0,$scope.streetId=0,$scope.productList=[],$scope.imgimg=[],$rootScope.image=[],$scope.isAreadyShop=!1,$scope.prolist=[],$scope.searchGoodsName="",$scope.gsPlaceholder="搜索商品",$scope.isShop=!0,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.page=1,$scope.loadMore=function(){$scope.page+=1,0==$scope.selectedIndex?$scope.searchOK?$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,2):$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5):1==$scope.selectedIndex?($scope.areadyPage+=1,$scope.areadyShop($scope.areadyPage,5)):3==$scope.selectedIndex&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,1)},$scope.onTabSelected=function(e){$scope.selectedIndex=e,$scope.page=1,$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.searchOK=!1,0==e?($scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)):1==e?($scope.shop0=!1,$scope.shop1=!0,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.areadyPage=0,$scope.productList=[],$scope.areadyShop($scope.areadyPage,5)):2==e?($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!0,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.holdPro()):3==e&&($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!0,$scope.isShop=!1,$scope.search=!0,$scope.productList=[])},$scope.loadMoreProducts=function(e,t,o,s,i,a){relatedProductsService.loadMoreProducts(e,t,o,s,i,a).success(function(e){if(null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.storeItemsCounts);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.areadyShop=function(e,t){relatedProductsService.areadyShop(e,t).success(function(e){if(null!=e.productList&&void 0!=e.productList&&0!=e.productList.length){$scope.productList=$scope.productList.concat(e.productList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.productTotal);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.holdPro=function(){relatedProductsService.holdPro().success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchHold=function(){if($scope.productList=[],""==$scope.searchName.searchHold&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchHold&&$scope.searchGoodsHold($scope.searchName.searchHold)},$scope.searchGoodsHold=function(e){relatedProductsService.searchHoldPro(e).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.todoSomething=function(e,t){13==e.keyCode&&($scope.searchProduct(t),Focus.blur())},$scope.searchProduct=function(e){if($scope.searchOK=!0,$scope.page=1,$scope.productList=[],1==e){if(""==$scope.searchName.searchAll&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchAll&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}else if(2==e){if(""==$scope.searchName.searchShop&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchShop&&$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}},$scope.searchGoods=function(e,t,o,s,i,a,n,r){relatedProductsService.searchGoods(e,t,o,s,i,a,n,r).success(function(e){if($scope.isShop=!0,null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!(e.productsList<5);for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.productOK=function(){$ionicHistory.goBack(),$rootScope.nextPageBefore="relatedProduct"},$scope.selectOrderAddress=function(e){if($rootScope.productId.length<5)if(-1!=$rootScope.image[e.productId].indexOf("check"))$rootScope.productId.push(e),$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_select.png",$scope.isChooseOrder=!0;else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else if(5==$rootScope.productId.length)if(-1!=$rootScope.image[e.productId].indexOf("check"))PopupService.showToast("最多能选择5个");else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else PopupService.showToast("最多能选择5个");$scope.imgimg=$rootScope.image},$scope.init=function(){$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.selectedIndex=0,$scope.hasmore=!1,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.productList=[],relatedProductsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.initPro()})},$scope.initPro=function(){$scope.page=1,$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.isIOS=!!ionic.Platform.isIOS(),$scope.init()}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.service("relatedProductsService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,s,i,a,n,r){var c={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n,pageSize:r};return e.get(t.getUrl("GET_RELATEDSHOP"),c)},this.areadyShop=function(o,s){var i={start:o,offset:5};return e.get(t.getUrl("GET_AREADYSHOP"),i)},this.holdPro=function(){return e.get(t.getUrl("GET_HOLDPRO"))},this.searchHoldPro=function(o){var s={keyword:o};return e.get(t.getUrl("SEARCH_HOLDPRO"),s)},this.searchGoods=function(o,s,i,a,n,r,c,l){var d={keyword:o,pageIndex:s,pageSize:i,provinceId:a,cityId:n,districtId:r,streetId:c,fromType:l};return e.get(t.getUrl("SEARCH_GOODS_CIRCLE"),d)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getFilterData=function(){return e.get(t.getUrl("GET_FILTER_DATA"))}}]),APP.controller("selectAdminController",["$scope","$state","$stateParams","selectAdminService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,s,i,a,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=[],e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.goBack=function(){t.go("CircleSetAdmin",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.selectUser=function(t){for(var o=0;o<e.userlist.length;o++)t.id==e.userlist[o].id?"img/ic_select.png"==e.userlist[o].ischeck?(e.userlist[o].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[o].ischeck="img/ic_select.png",e.userCode=t.userCode):e.userlist[o].ischeck="img/ic_check.png"},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var n=0;n<e.userlist.length;n++)e.userlist[n].ischeck="img/ic_check.png";i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.yes=function(){if(e.userCode.length>0){var o={topicId:e.topicId,userCode:e.userCode,indentityStatus:1};s.setAdmin(o).success(function(o){o.success?t.go("CircleSetAdmin",{topicId:e.topicId
}):a.showToast(o.message)}).error(function(){})}else a.showToast("请选择管理员")},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var s=e.userlist.length;e.hasmore=!(s===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.userCode="";var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list;for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("selectAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("sharedMsgsList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/SharedMsgsList.html",scope:!0,link:function(e,t,o){}}}),APP.controller("signDateController",["CirclePageService","signDateService","PopupService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){function h(e,t){var o=t;s.month=t,s.fullDay=new Date(e,o,0).getDate(),s.startWeek=new Date(e,o-1,1).getDay(),s.lastMonthDay=new Date(e,o-1,0).getDate(),s.nextMonthDay=new Date(e,o+1,0).getDate(),s.total=(s.fullDay+s.startWeek)%7==0?s.fullDay+s.startWeek:s.fullDay+s.startWeek+(7-(s.fullDay+s.startWeek)%7),s.fullPrevMonth=[],s.fullNextMonth=[],s.fullCurrentMonth=[];for(var i=0;i<s.lastMonthDay;i++)s.fullPrevMonth[i]=i+1;for(var i=0;i<s.nextMonthDay;i++)s.fullNextMonth[i]=i+1;for(var i=0;i<s.signList.length;i++)s.fullCurrentMonth[i]=i+1;s.prevLast=s.fullPrevMonth.splice(s.lastMonthDay-s.startWeek,s.startWeek),s.nextFrist=s.fullNextMonth.splice(0,7-(s.fullDay+s.startWeek)%7),s.currentDays=s.prevLast.concat(s.signList).concat(s.nextFrist)}function v(e,o,i,a,n){t.getSignDate(e,o,i,a,n).success(function(e){if(e.success){s.isMoreSign=e.data.replenishSignGolds;var t=e.data.list,o=t[0].signDate.split("-");s.signList=e.data.list,s.getYear=Number(o[0]),s.getMonth=Number(o[1]),s.signCount=e.data.signCount,s.replenishSignGolds=e.data.replenishSignGolds,s.signRules=e.data.signRules,h(s.getYear,s.getMonth)}})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?s.paddingtopClass={"padding-top":"30px"}:s.paddingtopClass={"padding-top":"14px"},s.goBack=function(){s.$ionicGoBack()},s.$on("$ionicView.beforeEnter",function(e,t){"back"!=t.direction&&(s.month=(new Date).getMonth(),s.year=(new Date).getFullYear(),s.init())}),s.init=function(){s.isMoreSign="",s.signSucDate=e.signSuccessDate,s.topicName=e.topicName,s.defaultDate=s.signSucDate.signYear+"-"+s.signSucDate.signMonth+"-"+s.signSucDate.signDay,s.userId=i.userId,s.topicId=i.topicId,s.monthFlag=Number(i.monthFlag),v(s.userId,s.topicId,s.monthFlag,s.signSucDate.signYear,s.signSucDate.signMonth)},s.replenishSign=function(){s.replenishPopup=g.show({template:"<div class='rep-box'>\n                    <div class='rep-close' ng-click='closeReplenishPopup()'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                    <div class='rep-head'>选择补签日期</div>\n                    <div class='rep-content'>\n                      <div class='con-date' ng-click='selectDate()'>\n                        \n                        <div class='input'>{{defaultDate}}</div>\n                        <i><img ng-src=\"{{imgBaseURL}}img/signIn/date_icon.png\" alt=\"\" /></i>\n                      </div>\n                      <div class='con-info'>补签将消耗您<span style=\"font-size:22px;\">{{replenishSignGolds}}</span>个金币</div>\n                    </div>\n                    <div class='rep-foot' ng-click='replenishSuccess(defaultDate,2,topicId,userId)'>确认补签</div>\n                  </div>",cssClass:"replenishPopup",scope:s}),s.closeReplenishPopup=function(){s.replenishPopup.close()}},s.replenishSuccess=function(e,i,a,n){var r=e.split("-")[0],c=e.split("-")[1];r==s.signSucDate.signYear&&c==s.signSucDate.signMonth?(t.getReplenishSign(e,i,a,n).success(function(e){e.success?(s.signInfoData=e.data,s.replenishPopup.close(),s.replenishSucPopup=g.show({template:"<div class='suc-box'>\n                          <div class='suc-close' ng-click='closeReplenishSucPopup()'><img src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"\" /></div>\n                          <div class='suc-bg'><img src=\"{{imgBaseURL}}img/signIn/buqian_bg.png\" alt=\"\" /></div>\n                          <div class='suc-content'>\n                            <div class='suc-title' flex='main:center cross:center'>\n                              <div class='suc-icon' flex='cross:center'><img src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                              <div class='title-text'>签到排名<span style=\"font-size:16px;\">{{signInfoData.rank}}</span></div>\n                            </div>\n                               </div>\n                          <div class='suc-foot' ng-click='closeReplenishSucPopup()'>知道啦</div>\n                        </div>",cssClass:"replenishSucPopup",scope:s})):o.showToast(e.message)}),s.closeReplenishSucPopup=function(){s.replenishSucPopup.close(),s.init()}):o.showToast("对不起，只能补签当月")},s.selectDate=function(){if("APP"==p.getPlatform()){var e=s.signSucDate.signYear,t=s.signSucDate.signMonth,o=s.signSucDate.signDay,i={date:new Date(e,t-1,o),mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(i,function(e){c(function(){var t=e.getDate(),o=e.getMonth()+1,i=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t),s.defaultDate=i+"-"+o+"-"+t},200)})}else{var t=s.signSucDate.signMonth,e=s.signSucDate.signYear,a={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(e,t-1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);new Date(e).getFullYear();s.defaultDate=new Date(e).getFullYear()+"-"+t+"-"+o}};u.openDatePicker(a)}},s.signChart=function(e){n.go("signInChart",{topicId:e})},s.weeks=["日","一","二","三","四","五","六"],s.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==p.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==p.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},s.signDateActive=function(e,t,o){0!=t&&(1==t?n.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:o.fromType,storeId:o.storeId}):2==t||3==t&&s.tolink(e))},s.prevMonth=function(){s.getMonth-1==0?(s.getYear-=1,s.getMonth=12):s.getMonth-=1,s.monthFlag+=1,v(s.userId,s.topicId,s.monthFlag,s.getYear,s.getMonth)},s.nextMonth=function(){s.getMonth+1==13?(s.getYear+=1,s.getMonth=1):s.getMonth+=1,s.monthFlag-=1,v(s.userId,s.topicId,s.monthFlag,s.getYear,s.getMonth)}}]),APP.service("signDateService",["$http","UrlService",function(e,t){this.getSignDate=function(o,s,i,a,n){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_DATE"),data:{userId:o,topicId:s,monthFlag:i,year:a,month:n}})},this.getReplenishSign=function(o,s,i,a){return e({method:"POST",url:t.getUrl("CIRCLE_REPLENISH_SIGN"),data:{replenishSignDate:o,signType:s,topicId:i,userId:a}})},this.getUserData=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.controller("signInChartController",["$scope","$rootScope","$state","$stateParams","$ionicScrollDelegate","signInChartService","UserService","personalHomepageMeService",function(e,t,o,s,i,a,n,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"30px"}:e.paddingtopClass={"padding-top":"14px"},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.topicId=s.topicId,e.signType=2,e.myCircleRankType=1,e.allCircleRankType=2,e.myCommunityRankType=3,e.allCommunityRankType=4,e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId)},e.getCircleChartFun=function(t,o,s){var i={rankType:t,signType:o,topicId:s};a.CurrentCircleChart(i).success(function(t){t.success&&(1==i.rankType||3==i.rankType?(e.userSignCount=t.data.rank[0].signCount,e.userRank=t.data.rank[0].rank):2!=i.rankType&&4!=i.rankType||(e.rankList=t.data.rank))})},e.$on("$ionicView.beforeEnter",function(t,o){"back"!=o.direction&&(i.scrollTop(),e.tabIndex=0,e.signListTitle="圈子",e.init())}),e.chooseTab=function(t){e.tabIndex=t,0==t?(e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId),e.signListTitle="圈子"):(e.getCircleChartFun(e.myCommunityRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCommunityRankType,e.signType,e.topicId),e.signListTitle="社区")}}]),APP.service("signInChartService",["$http","UrlService",function(e,t){this.CurrentCircleChart=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_CHART"),data:o})},this.getUserData=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.controller("topicRewardListController",["$ionicHistory","$http","$scope","topicRewardListService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService","NoteDetailsService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){o.tipId="",o.page=1,o.getList=function(){var e={tipId:parseInt(o.tipId),pageIndex:1,pageSize:5,sort:1,type:1};s.getList(e).success(function(e){o.shantotal=e.data,o.shanList=e.data.ucTips,e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)})},o.loadMore=function(){o.page=o.page+1;var e={tipId:parseInt(o.tipId),pageIndex:o.page,pageSize:5,sort:1,type:1};s.getList(e).success(function(e){o.shanList=o.shanList.concat(e.data.ucTips),o.$broadcast("scroll.infiniteScrollComplete"),e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1,g.showToast("没有更多了"))})},o.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userId})},o.follow=function(e,t){if(e.isFollow){var s={id:e.userId,isFollow:0};m.followNote(s).success(function(e){if(1==e.success)for(var s=0;s<o.shanList.length;s++)o.shanList[s].userId==o.shanList[t].userId&&(o.shanList[s].isFollow=!1);else g.showToast(e.message)})}else{var s={id:e.userId,isFollow:1};m.followNote(s).success(function(e){if(1==e.success)for(var s=0;s<o.shanList.length;s++)o.shanList[s].userId==o.shanList[t].userId&&(o.shanList[s].isFollow=!0);else g.showToast(e.message)})}},o.scrollToTop=function(){f.$getByHandle("rewardHandle").scrollTop(!0),o.showTopBtn=!1},o.getScrollHeight=function(){o.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),o.scrollHeight>2*o.phoneHeight?o.showTopBtn=!0:o.showTopBtn=!1},o.init=function(){o.phoneHeight=document.documentElement.clientHeight/2,o.hasmore=!1,o.page=1,o.tipId=i.tipId,o.getList()},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(e,t){o.init()})}]),APP.service("topicRewardListService",["$http","UrlService",function(e,t){this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)}}]),APP.controller("dataAnalysisController",["$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","dataAnalysisService",function(e,t,o,s,i,a){function n(){e.byStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function r(){e.byStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyleActive={color:"#666","border-bottom":"0 solid #2979FF"}}function c(){e.cityByStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityLgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function l(){u=[{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""}],g=[]}function d(){var e=document.getElementById("container"),t=echarts.init(e);f=t;var o=null;(o={graphic:{type:"text",left:"center",top:"center",z:99,zLevel:100,style:{text:v,x:100,y:100,width:30,height:30}},legend:{selectedMode:!1,x:"center",y:"bottom",data:g,itemHeight:9,itemWidth:9},clickable:!1,series:[{name:"半径模式",type:"pie",radius:[15,75],center:["50%","50%"],roseType:"area",x:"50%",max:40,sort:"ascending",clickable:!1,label:{normal:{formatter:"{d}%",textStyle:{fontWeight:"normal",fontSize:12}}},itemStyle:{normal:{color:function(e){return["#FB497C","#FFBB41","#6FE621","#4FCCFF","#4D7BF3","#b7009b","#32af01","#c10037"][e.dataIndex]}}},data:u}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}function p(){var e=document.getElementById("activeContenter"),t=echarts.init(e);h=t;var o=null;(o={title:{subtext:"单位：次"},calculable:!0,xAxis:[{type:"category",axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#dedede"}},data:[{value:"分享\n店铺",textStyle:{fontSize:"12",color:"#37394C"}},{value:"分享\n商品",textStyle:{fontSize:"12",color:"#37394C"}},{value:"任务\n完成",textStyle:{fontSize:"12",color:"#37394C"}},{value:"社区\n互动",textStyle:{fontSize:"12",color:"#37394C"}},{value:"评价\n次数",textStyle:{fontSize:"12",color:"#37394C"}},{value:"登录\n次数",textStyle:{fontSize:"12",color:"#37394C"}}]}],yAxis:[{axisLabel:{textStyle:{fontSize:"12",color:"#37394C"}},type:"value",splitNumber:2,axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"完成了",type:"bar",itemStyle:{normal:{color:function(e){return["#67AAF9"][0]}}},barWidth:"7",data:m}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.PercentageCal=function(e,t){return num=parseFloat(e),total=parseFloat(t),isNaN(num)||isNaN(total)?"-":total<=0?"0%":Math.round(num/total*1e4)/100+"%"};var u,g,m,f,h,v="本月",$="";e.isHasData=!1,e.init=function(){a.doInit($).success(function(t){t.success&&(e.dataUpdate=t.data,t.data&&(e.dataUpdateAddTime=1e3*parseInt(t.data.addTime)))})},e.disbuBL=function(t){a.distributionBL(t,$).success(function(t){if(t.success){if(t.data.length<=0)return void(e.isHasData=!0);e.isHasData=!1;for(var o=0;o<t.data.length;o++)u[o].value=t.data[o].mySaleNum,u[o].name=t.data[o].cateName,g[o]=t.data[o].cateName,o==t.data.length-1&&(u.length=t.data.length,d());0==t.data.length&&d()}})},e.actyBL=function(t){a.activityBL(t,$).success(function(t){t.success&&(e.dataActivity=t.data,m[0]=t.data.STORE_SHARE,m[1]=t.data.PRODUCT_SHARE,m[2]=t.data.TASK,m[3]=t.data.COMMUNITY,m[4]=t.data.ASSESS,m[5]=t.data.LOGIN,p())})},e.salesCity=function(t){a.salesCity(t,$).success(function(t){t.success&&(t.data.length>0?e.dataRegional=t.data:e.dataRegional=null)})},e.chooseCityDate=function(t){"BY"==t?(e.salesCity(!0),c()):(e.salesCity(!1),e.cityLgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityByStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseDate=function(t){l(),f&&f.dispose(),"BY"==t?(v="本月",e.disbuBL("true"),n()):(v="累计",e.disbuBL("false"),e.lgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseActive=function(t){h&&h.dispose(),m=[],"BY"==t?(e.actyBL(!0),r()):(e.actyBL(!1),e.lgStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyleActive={color:"#666","border-bottom":"0 solid #2979FF"})},e.$on("$ionicView.beforeEnter",function(){e.containerPic=!0,e.activeContenterPic=!0,e.isHasData=!1,v="本月",$="",$=i.memberId,n(),r(),c(),l(),m=[],s.scrollTop(),e.dataUpdate=null,e.dataUpdateAddTime=null,e.dataActivity="",e.dataRegional=null,e.init(),e.disbuBL(!0),e.actyBL(!0),e.salesCity(!0)}),e.$on("$ionicView.beforeLeave",function(){f&&f.dispose(),h&&h.dispose(),e.containerPic=!1,e.activeContenterPic=!1})}]),APP.service("dataAnalysisService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={memberId:o};return e.get(t.getUrl("DATA_ANALYSIS_UPDATE"),s)},this.distributionBL=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_DISTRIBUTION"),i)},this.activityBL=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_ACTIVITY"),i)},this.salesCity=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_SALES"),i)}}]),APP.controller("ApplyRefundController",["$scope","$ionicActionSheet","ApplyRefundService","PopupService","$timeout","$stateParams","$ionicHistory","$timeout","$rootScope",function(e,t,o,s,i,a,n,i,r){e.cOrderSnDetail=a.cOrderSn,e.refundData=[],e.description=8,e.typeActual=0,e.applyRefund={reason:""},e.init=function(){e.applyRefundType="请选择退款原因",o.applyRefund(e.cOrderSnDetail).success(function(t){t.success&&(e.refundData=t.data,e.typeActual=t.data.orderType,1==e.typeActual?e.repairType="退货退款":e.repairType="退货不退款")})},e.openSelect=function(){var o=t.show({buttons:[{text:"七天无理由"},{text:"大小尺寸"},{text:"颜色款式"},{text:"质量问题"},{text:"配送问题"},{text:"库存问题"},{text:"地址问题"},{text:"其他"}],titleText:"请选择退款原因",buttonClicked:function(t){switch(t){case 0:e.applyRefundType="七天无理由";break;case 1:e.applyRefundType="大小尺寸";break;case 2:e.applyRefundType="颜色款式";break;case 3:e.applyRefundType="质量问题";break;case 4:e.applyRefundType="配送问题";break;case 5:e.applyRefundType="库存问题";break;case 6:e.applyRefundType="地址问题";break;case 7:e.applyRefundType="其他"}return o(),e.description=t,!0}});i(function(){o()},1e4)},e.submitRefund=function(){8==e.description?s.showToast("请选择退款原因"):o.setApplyRefund(e.cOrderSnDetail,e.typeActual,e.applyRefund.reason,e.applyRefundType).success(function(e){"S"==e.data.state?(r.$broadcast("ORDER_RETURN_BACK"),s.showToast("提交成功！"),i(function(){n.goBack()},2e3)):e.data.message?(s.showToast(e.data.message),i(function(){n.goBack()},2e3)):s.showToast("提交失败！")})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ApplyRefundService",["$http","UrlService",function(e,t){this.setApplyRefund=function(o,s,i,a){var n={cOrderSn:o,typeActual:s,description:i,reason:a};return e.get(t.getUrl("SUBMIT_APPLY_REFUND"),n)},this.applyRefund=function(o){var s={cOrderSn:o};return e.get(t.getUrl("APPLY_REFUND"),s)}}]),APP.controller("AssessController",["$scope","AssessService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope",function(e,t,o,s,i,a,n,r,c,l){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.assessData=[],e.parameter=[],e.isAssessed=!1,e.cOrderSnData=[],e.value=[],e.click=[],e.fileIds=[],e.click[0]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.iconImageData=[],e.iconImageData[0]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""},e.value[0]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.init=function(o,s){e.show=!1,t.getAssess(o,s).success(function(t,o,s,i){if(t.success){e.isAssessed=!t.data.products||0==t.data.products.length,e.assessDataLength=t.data.products.length,e.assessData=t.data.products;for(var a=0;a<e.assessDataLength;a++)e.cOrderSnData.push({cOrderSn:t.data.products[a].cOrderSn}),e.click[a]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.value[a]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.iconImageData[a]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""};e.addTime=t.data.addTime,e.ckCode=t.data.ckCode,e.consignee=t.data.consignee,e.memberId=t.data.memberId,e.memberName=t.data.memberName,e.mobile=t.data.mobile}else e.isAssessed=!0}).error(function(){e.isAssessed=!0})},e.assessType=function(t,o){0==t?(e.click[o].isClickGood=!e.click[o].isClickGood,e.click[o].isClickMiddle=!1,e.click[o].isClickBad=!1):1==t?(e.click[o].isClickMiddle=!e.click[o].isClickMiddle,e.click[o].isClickGood=!1,e.click[o].isClickBad=!1):2==t&&(e.click[o].isClickBad=!e.click[o].isClickBad,e.click[o].isClickMiddle=!1,e.click[o].isClickGood=!1),angular.forEach(e.click,function(t,o,s){t.isClickGood?e.value[o].evalution=1:t.isClickMiddle?e.value[o].evalution=2:t.isClickBad&&(e.value[o].evalution=3)})},e.setParams=function(){e.parameter=[];for(var t=0;t<e.assessDataLength;t++)e.parameter.push({addTime:e.addTime,assString:e.value[t].comment,cOrderSn:e.cOrderSnData[t].cOrderSn,ckCode:e.ckCode,consignee:e.consignee,evalution:e.value[t].evalution,memberId:e.memberId,memberName:e.memberName,mobile:e.mobile,productScore:e.value[t].value1,serviceScore:e.value[t].value3,shippingScore:e.value[t].value2,fileUrl1:e.iconImageData[t].imgUrl1,fileUrl2:e.iconImageData[t].imgUrl2,fileUrl3:e.iconImageData[t].imgUrl3,fileUrl4:e.iconImageData[t].imgUrl4,fileUrl5:e.iconImageData[t].imgUrl5})},e.submitAssess=function(){for(var o=0;o<e.assessDataLength;o++){if(!/^.{5,300}$/.test(e.value[o].comment))return void(1==e.assessDataLength?n.showToast("请输入5～300字的评价！"):n.showToast("请于第"+(o+1)+"件商品输入5～300字的评价！"));if(0==e.value[o].evalution)return void(1==e.assessDataLength?n.showToast("请选择评价！"):n.showToast("请于第"+(o+1)+"件商品选择评价！"));if(0==e.value[o].value1)return void(1==e.assessDataLength?n.showToast("请选择商品评分！"):n.showToast("请于第"+(o+1)+"件商品选择商品评分！"));if(0==e.value[o].value2)return void(1==e.assessDataLength?n.showToast("请选择物流评分！"):n.showToast("请于第"+(o+1)+"件商品选择物流评分！"));if(0==e.value[o].value3)return void(1==e.assessDataLength?n.showToast("请选择服务评分！"):n.showToast("请于第"+(o+1)+"件商品选择服务评分！"))}for(var i="",a=0;a<e.assessDataLength;a++)i+=e.value[a].comment;t.checkAssessText(i).success(function(o){o?(n.showToast("成功"),e.setParams(),t.submitAssessInfo(e.parameter,e.fileIds).success(function(e){e.success?(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),c.goBack()},1e3)):e.message?n.showToast(e.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.uploadImg=function(o){if("APP"==i.getPlatform()){var r={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},c=function(i){function r(i){e.iconImage=i,s(function(){e.iconImage=i},200);var r=function(t){a.hide(),n.showToast("上传成功");for(var s=JSON.parse(t.response),i=s.fileIds,r=0;r<i.length;r++)e.fileIds.push(i[r]);var c=s.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:n.showToast("最多只能输入5张照片！")},c=function(e){a.hide(),n.showToast("上传失败")},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var p={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};a.show(p)}function c(e){}function l(i){e.iconImage=i,s(function(){e.iconImage=i},200);var r=function(t){a.hide(),n.showToast("上传成功");for(var s=JSON.parse(t.response),i=s.fileIds,r=0;r<i.length;r++)e.fileIds.push(i[r]);var c=s.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:n.showToast("最多只能输入5张照片！")},c=function(e){n.showToast("上传失败"),a.hide()},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var p={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};a.show(p)}function d(e){}1==i?navigator.camera.getPicture(r,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}):2==i&&navigator.camera.getPicture(l,d,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0})};window.plugins.actionsheet.show(r,c)}else n.showToast("请下载客户端实现上传图片功能")},e.$on("$ionicView.beforeEnter",function(){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.init(e.orderId,e.cOrderSn)}),e.showLarge=function(t){e.show=!0,e.largeImg=t},e.closeImg=function(){e.show=!1},e.deleteImg=function(){e.show=!1;for(var t=0,o=0;o<e.assessDataLength;o++){if(e.largeImg==e.iconImageData[o].imgUrl1){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl2){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl3){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl4){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl5){t=o;break}}e.largeImg==e.iconImageData[t].imgUrl1?(e.iconImageData[t].imgUrl1=e.iconImageData[t].imgUrl2,e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl2?(e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl3?(e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl4?(e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl5&&(e.iconImageData[t].imgUrl5="")},e.goBack=function(){for(var t=!1,o=0;o<e.assessDataLength;o++)if(""!=e.iconImageData[o].imgUrl1||0!=e.value[o].value1||0!=e.value[o].value2||0!=e.value[o].value3||""!=e.value[o].comment||0!=e.value[o].evalution){var t=!0;break}if(t){n.showConfirm("","您的评价未完成，您确定离开吗？",function(e){e&&c.goBack()})}else c.goBack()}}]),APP.service("AssessService",["$http","UrlService",function(e,t){this.getAssess=function(o,s){var i={orderId:o,cOrderSn:s};return e.get(t.getUrl("GET_ASSESS"),i)},this.checkAssessText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),s)},this.submitAssessInfo=function(o,s){s=s.join();var i={assessList:JSON.stringify(o),fileIds:s};return e({method:"POST",url:t.getUrl("SUBMIT_ASSESS"),params:i})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.directive("commentBar",[function(){return{restrict:"E",template:'<div class="col padding-top-bottom-0"><img class="padding-left-10" width="20%" ng-click="comment(0)" ng-src="{{commentValue>=1?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(1)" ng-src="{{commentValue>=2?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(2)" ng-src="{{commentValue>=3?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(3)" ng-src="{{commentValue>=4?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(4)" ng-src="{{commentValue>=5?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"></div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("BannerDailyController",["$scope","BannerDailyService","$stateParams","$rootScope","$http","$state","UserService","CommonAddressService","GoodsService","$ionicHistory","PopupService","UrlService","$localstorage","$ionicLoading","BannerThemeService","CreditService","$ionicScrollDelegate","$ionicModal","$timeout",function($scope,BannerDailyService,$stateParams,$rootScope,$http,$state,UserService,CommonAddressService,GoodsService,$ionicHistory,PopupService,UrlService,$localstorage,$ionicLoading,BannerThemeService,CreditService,$ionicScrollDelegate,$ionicModal,$timeout){function getBannerDailyProducts(e,t,o,s,i,a,n,r){BannerDailyService.getBannerDaily(e,t,o,s,i,a,n,r).success(function(e){$scope.activityProductList=[],$scope.activityProductList=e.productsList,$ionicLoading.hide()})}function getShareInfo(e,t){BannerThemeService.getBannerTheme(e,t).success(function(e){shareInfo=e.data})}$scope.shareStoreId=$stateParams.shareStoreId;var bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,provinceId="",cityId="",areaId="",streetId="";$scope.storeId="",$scope.layout=$stateParams.layout,$scope.layout="layout-colum2",$scope.activityProductList=[],$scope.districtName="";var sharePic="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",shareInfo={},screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="DAILY_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.showShare=!1,$scope.dayliTitleStyle={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.dayliTitleStyle={top:"18px"}),$rootScope.isApp?$scope.BannerTopopType={right:"50px"}:$scope.BannerTopopType={right:"10px"},$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,GoodsService.getAddress().success(function(response){if(void 0!=response.data&&response.data&&0!=response.data.length){var addressInfo=eval(response.data),regionIndex=addressInfo[0].regionName.indexOf("/");$scope.districtName=addressInfo[0].regionName.substr(0,regionIndex),getBannerDailyProducts(memberId,addressInfo[0].provinceId,addressInfo[0].cityId,addressInfo[0].areaId,addressInfo[0].streetId,addressInfo.regionName,bannerId,platformType)}else{var defaultAddressInfo=CommonAddressService.getAddressInfo();$scope.districtName=defaultAddressInfo.regionName,
getBannerDailyProducts(memberId,defaultAddressInfo.provinceId,defaultAddressInfo.cityId,defaultAddressInfo.areaId,defaultAddressInfo.streetId,defaultAddressInfo.regionName,bannerId,platformType)}}).error(function(e){var t=CommonAddressService.getAddressInfo();$scope.districtName=t.regionName,getBannerDailyProducts(memberId,t.provinceId,t.cityId,t.areaId,t.streetId,t.regionName,bannerId,platformType)}),getShareInfo(bannerId,platformType)},$rootScope.$on("DAILY_LOCATION",function(e,t){$scope.districtName=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.districtName+"/"+$scope.streetName;provinceId=t["value-1"],cityId=t["value-2"],areaId=t["value-3"],streetId=t["value-4"],GoodsService.addAddress(provinceId,cityId,areaId,o,streetId).success(function(e,t,o,s){e.success&&getBannerDailyProducts(memberId,provinceId,cityId,areaId,streetId,$scope.districtName,bannerId)})}),$scope.goBack=function(){$ionicHistory.goBack()},$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.dataAdd=null,$scope.defaultValue=null,$scope.goBackFlag=!0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"DAILY_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})}),$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"COUPONSLIST",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"COUPONSLIST",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):($scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.share=function(){if(window.device&&window.device.hasNewShare){if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");$scope.showShare=!$scope.showShare}else{if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");if(window.umeng){var e=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid;window.umeng.share(shareInfo.title,shareInfo.content,shareInfo.imgUrl,e,0)}}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid,o=shareInfo.title,s=shareInfo.imgUrl,i=shareInfo.content;window.umeng?(0==e?window.umeng.shareToSina(o,i,s,t,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,t,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,t,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(t),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1}}]),APP.service("BannerDailyService",["$http","UrlService",function(e,t){this.getBannerDaily=function(o,s,i,a,n,r,c,l){var d={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,provinceName:void 0,cityName:void 0,districtName:r,bannerId:c,platformType:l};return e.get(t.getUrl("GET_BANNER_DAILY"),d)}}]),APP.controller("BannerThemeController",["$scope","BannerThemeService","$stateParams","$state","$ionicHistory","$localstorage","UserService","PopupService","UrlService","CreditService","InAppBrowserService","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(o,s){t.getBannerTheme(o,s).success(function(t){e.activityImageList=t.data.productList,h=t.data})}var g=o.bannerId,m=a.get("storeId","20219251"),f=o.platformType;e.activityImageList=[];e.shareStoreId=o.shareStoreId;var h={};e.showShare=!1,e.leftArrow={},e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},window.cordova&&ionic.Platform.isIOS,e.leftShare={top:"16px",position:"absolute",right:"8px","z-index":"10",width:"32px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.leftArrow={top:"14px"}),e.goDetail=function(t){var o=e.activityImageList[t];if(o.productId)s.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:"",storeId:m,shareStoreId:e.shareStoreId});else if(o.activityUrl)if(-1!=o.activityUrl.indexOf("VRshop")){var i=null,a=c.getHead().replace("v3","www"),n=a+"index.html#/VrPage/";i=d.open(n),i.addEventListener("loadstart",function(e){-1!=e.url.indexOf("backToApp")&&i.close()})}else if(-1!=o.activityUrl.indexOf("coupon/toList"))s.go("getCouponsList",{shareStoreId:e.shareStoreId});else if(-1!=o.activityUrl.indexOf("m.ehaier.com/www/index.html")){var r=o.activityUrl.slice(o.activityUrl.indexOf("#/"));window.location.hash=r}else window.cordova?p.isIOS?cordova.InAppBrowser.open(o.activityUrl,"_system","location=yes"):cordova.InAppBrowser.open(o.activityUrl,"_blank","location=yes"):window.open(o.activityUrl,"_blank","location=yes")},e.goBack=function(){i.backView()?i.goBack():s.go("homePage")},e.init=function(){e.showQQ=!1,e.showWeChat=!1,g=o.bannerId,f=o.platformType,u(g,f)},e.$on("$ionicView.beforeEnter",function(t,s){o.shareStoreId&&(p.shareId=o.shareStoreId),m=o.shareStoreId?o.shareStoreId:a.get("storeId","20219251"),e.shareStoreId=o.shareStoreId,"back"==s.direction||e.init()}),e.share=function(){if(window.device&&window.device.hasNewShare){if(!n.getUser().mid)return void r.showToast("请先登录,再分享");e.showShare=!e.showShare}else{if(!n.getUser().mid)return void r.showToast("请先登录,再分享");if(window.umeng){var t=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+n.getUser().mid;window.umeng.share(h.title,h.content,h.imgUrl,t,0)}}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),r.showToastShort("复制成功")):r.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+n.getUser().mid,s=h.title,i=h.imgUrl,a=h.content;window.umeng?(0==t?window.umeng.shareToSina(s,a,i,o,0,null,l.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(s,a,i,o,0,null,l.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(s,a,i,o,0,null,l.shareSuccessCallback):3==t?(window.umeng.shareToQQ(s,a,i,o,0,null,l.shareSuccessCallback),l.qqShare()):4==t?(window.umeng.shareToQzone(s,a,i,o,0,null,l.shareSuccessCallback),l.qqShare()):5==t&&e.copeText(o),l.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("BannerThemeService",["$http","UrlService",function(e,t){this.getBannerTheme=function(o,s){if(s)var i={bannerId:o,isHost:"1",backUrl:"",platformType:s};else i={bannerId:o,isHost:"1",backUrl:""};return e.get(t.getUrl("GET_BANNER_THEME"),i)}}]),APP.controller("ChooseShopTemplateController",["$rootScope","$scope","$ionicModal","ChooseShopTemplateService","UserService",function(e,t,o,s,i){t.titleTemplateArray=[],t.listTemplateArray=[],t.titleId="",t.listId="",t.previewImgIndex="",t.storeId=i.getUser().mid,t.init=function(){t.storeId=i.getUser().mid,t.getTemplate(t.storeId)},t.getTemplate=function(e){s.getShopTemplates(e).success(function(e,o,s,i){t.titleTemplateArray=e.data.titleTemplate,t.listTemplateArray=e.data.listTemplate,angular.forEach(t.titleTemplateArray,function(e){1==e.selected&&(t.titleId=e.tit)}),angular.forEach(t.listTemplateArray,function(e){1==e.selected&&(t.listId=e.layout)})}).error(function(e){})},t.setTemplate=function(e){s.setShopTemplate(e).success(function(e,o,s,i){t.getTemplate(t.storeId)})},t.chooseTitleTemplate=function(e){t.titleId=t.titleTemplateArray[e].tit;var o=t.titleId+"-"+t.listId;t.setTemplate(o)},t.chooseListTemplate=function(e){t.listId=t.listTemplateArray[e].layout;var o=t.titleId+"-"+t.listId;t.titleId,t.listId;t.setTemplate(o)},o.fromTemplateUrl("my-preview-modal.html",{scope:t,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){t.modal=e}),t.preview=function(){switch(t.listId+t.titleId){case"layout-dftit-df":t.previewImgIndex="01";break;case"layout-dftit-bp":t.previewImgIndex="02";break;case"layout-dftit-colum2":t.previewImgIndex="03";break;case"layout-bptit-df":t.previewImgIndex="04";break;case"layout-bptit-bp":t.previewImgIndex="05";break;case"layout-bptit-colum2":t.previewImgIndex="06";break;case"layout-colum2tit-df":t.previewImgIndex="07";break;case"layout-colum2tit-bp":t.previewImgIndex="08";break;case"layout-colum2tit-colum2":t.previewImgIndex="09"}t.modal.show()},t.closeModal=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.$on("$ionicView.beforeEnter",function(){t.init()})}]),APP.service("ChooseShopTemplateService",["$http","UrlService",function(e,t){this.getShopTemplates=function(o){var s={storeId:o,noLoading:!0};return e.get(t.getUrl("GET_SHOP_TEMPLATES"),s)},this.setShopTemplate=function(o){var s={templateId:o,noLoading:!0};return e({method:"POST",url:t.getUrl("SET_SHOP_TEMPLATES"),params:s})}}]),APP.service("ConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o,s,i){var a={relationshipType:o,pageIndex:s,pageSize:i};return e.get(t.getUrl("CONNECTION_INDEX"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.service("ConnectionDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("ConnectionSearchController",["$scope","ConnectionSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,s,i,a,n){function r(e,o){for(var s in e)e[s].storeName=t.limitStrLength(e[s].storeName,o)}e.backToLastView=function(){e.$ionicGoBack()};var c=document.querySelector("#focus");e.gotoPartnerDetail=function(e,t){1==t?a.go("partnerDetail",{ownerId:e}):a.go("connectionDetail",{ownerId:e})},e.searchConnection=function(){if(""==e.searchValue)return void i.showToast("请填写搜索内容");t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){e.searchResults=t.data.partners,r(e.searchResults,e.storeNameListLength),0==e.searchResults.length?e.noSearchResults=!0:e.noSearchResults=!1})},e.loadMore=function(){e.pageIndex++,t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){t.success&&(t.data.partners.length<e.pageNum?(e.hasMore=!1,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasMore=!0,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")))})},e.$on("$ionicView.enter",function(){"back"==e.direction?c.blur():(e.searchValue="",e.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),e.$on("$ionicView.beforeEnter",function(t,o){e.direction=o.direction,e.searchType=n.searchType,e.storeNameListLength=Math.floor((window.innerWidth-82)/17*2-1),e.pageIndex=0,e.pageNum=10,e.hasMore=!0,1==e.searchType?e.placeHolder="请输入合伙人信息":e.placeHolder="请输入人脉信息"})}]),APP.service("ConnectionSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,s,i,a){var n={relationshipType:o,keyword:s,pageIndex:i,pageSize:a};return e.get(t.getUrl("CONNECTION_INDEX"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("CustomPageCtrl",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","CustomPageService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicLoading",function($stateParams,$scope,$rootScope,UrlService,CreditService,UserService,$state,CustomPageService,$timeout,$localstorage,$ionicSlideBoxDelegate,GetCouponsService,PopupService,BannerThemeService,GoodsService,$ionicLoading){$scope.customPageId=$stateParams.customPageId?$stateParams.customPageId:"",$scope.showShare=!1,$scope.shareimg="",$scope.storeId=0,$scope.hashtitle="",$scope.sharedesp="",$scope.moduleList=[],$scope.skuMap={},$scope.couponMap={},$scope.index=[],$scope.showjuanyz=!1,$scope.juanlist=[],$scope.juankeling={},$scope.juanqiangwan={},$scope.streetId=12036596,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,window.cordova||-1!=window.location.hash.indexOf("sg_rn_app")?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),GoodsService.getAddress().success(function(response){if(response.success&&response.data){var addressMessage=eval(response.data)[0];void 0!=addressMessage.streetId&&($scope.streetId=addressMessage.streetId)}CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(e){if(1==e.success){$scope.hashtitle=e.data.name,$scope.moduleList=e.data.modualList,$scope.skuMap=e.data.skuMap,$scope.couponMap=e.data.couponMap,$scope.sharedesp=e.data.description;for(var t in $scope.moduleList)if("SWITCH"==$scope.moduleList[t].modualType){$scope.shareimg=$scope.moduleList[t].imageList[0].imageUrl;break}for(var o=0;o<$scope.moduleList.length;o++)$scope.moduleList[o].tabList&&($scope.index[o]=0);for(var s in e.data.couponMap)e.data.couponMap[s].totalGetNum>=e.data.couponMap[s].totalLimitNum?($scope.juankeling[s]=!0,$scope.juanqiangwan[s]=!0):(e.data.couponMap[s].getNum<e.data.couponMap[s].personLimitNum&&($scope.juankeling[s]=!0,$scope.juanqiangwan[s]=!1),e.data.couponMap[s].getNum>=e.data.couponMap[s].personLimitNum&&($scope.juankeling[s]=!1,$scope.juanqiangwan[s]=!1));$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}else PopupService.showToast(e.message)})})},$rootScope.$on("CACHE_SUCCESS",function(e,t){var o={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(o),$scope.init()}),$scope.changestyle=function(e,t){$scope.index[t]=e},$scope.getjuan=function(e,t){1!=$scope.juanqiangwan[e]&&0!=$scope.juankeling[e]&&(UserService.getUser().mid?GetCouponsService.doGetNewCoupons(e).success(function(t){t.success?CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(o){var s=o.data.couponMap[e].getNum,i=o.data.couponMap[e].personLimitNum;if(o.data.couponMap[e].totalGetNum>=o.data.couponMap[e].totalLimitNum)return $scope.juankeling[e]=!0,void($scope.juanqiangwan[e]=!0);s<i&&($scope.juankeling[e]=!0,$scope.juanqiangwan[e]=!1),s>=i&&($scope.juankeling[e]=!1,$scope.juanqiangwan[e]=!1),PopupService.showToast(t.message)}):PopupService.showToast(t.message)}):PopupService.showToast("领卷需要登录哦"))},$scope.goshare=function(){var e=$scope.hashtitle,t=$scope.sharedesp,o=$scope.shareimg,s=UrlService.getShareLinkHeader()+"CustomPage/"+$scope.customPageId;window.postMessage("custPageShare|"+e+"|"+t+"|"+o+"|"+s)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.hashtitle,o=$scope.sharedesp,s=$scope.shareimg,i=UrlService.getShareLinkHeader()+"CustomPage";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction||$scope.init()})}]),APP.service("CustomPageService",["$http","UrlService",function(e,t){this.getdata=function(o,s){if(""==o)var i={streetId:s};else var i={customPageId:o,streetId:s};return e.get(t.getNewUrl("CUSTOMPAGE_MODEL"),i)}}]),APP.controller("CustomerServiceController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","CustomerServiceService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){n.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),s(function(){t.availableToTop(),t.pageIndex=0,t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,""),t.loadOrderAmount(t.orderFlag)},1e3)}function w(e){e?n.deleteOrder(C).success(function(e){e.success?t.init():(g.showToastShort(e.message),C="")}).error(function(e){g.showToastShort("删除失败！"),C=""}):C=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=5,t.isIos=!1,t.BDO=!1;var y,T="";t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderAmountData=[],t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var C="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.loadOrderAmount(0),t.loadOrderList(!1,0,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),t.pageIndex=0},t.batchDeleteOrder=function(){i.go("batchDeleteOrder")},t.loadOrderList=function(e,o,s,i,a,c,l,d){n.getOrderList(o,s,i,a,c,d).success(function(i){if(i.success){if("closed"==s?(y=i.data.canDeleteAll,i.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(y=!1,t.BDO=!1),t.emptySearch=!1,i.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(i.data.orders);else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=t.orderList.concat(i.data.orders);else if(l)t.searchOrderList=i.data.orders;else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=i.data.orders;l?t.hasMoreDataSearch=i.data.orderProductSize:t.hasMoreData=i.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadOrderAmount=function(e){n.getOrderAmount(e).success(function(e){e.success&&(t.orderAmountData=e.data)})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"",!0)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");T=e.result,window.alipay.pay({payInfo:T},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};p.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):i.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),i.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){i.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,s,a,n,r){r&&t.closeSearchModal(),i.go("orderDetail",{orderSn:e,cOrderSn:o})},t.goAssess=function(e,t,o){o?i.go("assess",{orderId:e,cOrderSn:t}):i.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?i.go("lookAssess",{orderId:e,cOrderSn:t}):i.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",I,"确定")},t.confirmReceive=function(e,o,s){function a(e){e&&S.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',a,"确认"):i.go("confirmReceive",{orderId:s})},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.raiseStatusOne={background:"red",color:"#ffffff"},t.raiseStatusTwo={background:"red",color:"#ffffff"},t.raiseStatusThree={background:"red",color:"#ffffff"},t.raiseStatusFour={background:"red",color:"#ffffff"},t.orderFlag=0,t.BDO=!!y,"back"==o.direction||t.init()}),t.deleteOrder=function(e){C=e,g.showConfirm("","确认删除此订单？",w,"删除")},d.$on("AFTER_COMMIT",function(e){t.loadOrderAmount(0)})}]),APP.service("CustomerServiceService",["$http","UrlService",function(e,t){
this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,pageIndex:i,pageSize:a,keyword:n};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(o){var s={chooseOrder:o};return e.get(t.getNewUrl("ORDER_AMOUNT"),s)},this.cancelOrder=function(o,s){var i={orderId:o,cancelFlag:s};return e.get(t.getUrl("CANCEL_ORDER"),i)},this.payOrder=function(o){var s={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),s)},this.deleteOrder=function(o){var s={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),s)}}]),APP.filter("cut",function(){return function(e,t,o,s){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var i=e.lastIndexOf("");-1!=i&&(e=e.substr(0,i))}return e+(s||"…")}}),APP.controller("FeedbackController",["$scope","$ionicActionSheet","FeedbackService","PopupService","$timeout",function(e,t,o,s,i){e.userInfo={type:6,content:"",contact:""},e.init=function(){e.feedbackType="请选择"},e.openSelect=function(){var o=t.show({buttons:[{text:"功能意见"},{text:"界面意见"},{text:"您的新需求"},{text:"操作意见"},{text:"流量问题"},{text:"其他"}],titleText:"请选择",buttonClicked:function(t){switch(t){case 0:e.feedbackType="功能意见";break;case 1:e.feedbackType="界面意见";break;case 2:e.feedbackType="您的新需求";break;case 3:e.feedbackType="操作意见";break;case 4:e.feedbackType="流量问题";break;case 5:e.feedbackType="其他"}return o(),e.userInfo.type=t,!0}});i(function(){o()},1e4)},e.submitFeedback=function(){6==e.userInfo.type?s.showToast("请选择反馈类型！"):0==e.userInfo.content.length?s.showToast("请输入反馈内容！"):e.globalConstant.mobileNumberRegExp.test(e.userInfo.contact)?o.setFeedback(e.userInfo.type,e.userInfo.content,e.userInfo.contact).success(function(e,t,o,i){e.success?s.showToast("提交成功"):s.showToast(e.message)}):s.showToast("请输入正确的联系方式！")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("FeedbackService",["$http","UrlService",function(e,t){this.setFeedback=function(o,s,i){var a={type:o,content:s,contact:i};return e.get(t.getUrl("FEEDBACK"),a)}}]),APP.controller("GoodsManageController",["$scope","GoodsManageService","$ionicModal","UserService","GoodsService",function(e,t,o,s,i){e.flag=[],e.isShowOnFooter=!1,e.isShowOffFooter=!1,e.moreOrCheck=!1,e.goodsList=[],e.onSaleAmount,e.offSaleAmount,e.searchGoodsList=[];var a,n=[],r=!1,c=!0,l=1,d=1;e.keywords={keyword:""},e.init=function(){e.loadData(a,l,20,242,3466),t.getGoodsList(a,0,20,242,3466).success(function(t,o,s,i){t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0})},e.loadData=function(o,s,i,a,n){t.getGoodsList(o,s,i,a,n).success(function(t,o,i,a){for(var n=0,r=t.productsList.length;n<r;n++)t.productsList[n].isSelected=!1;e.goodsList=t.productsList,1==s?t.productsList&&t.productsList.length>0?e.onSaleAmount=t.productsList.length:e.onSaleAmount=0:0==s&&(t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0)})},e.searchGoods=function(){d=1,t.searchGoods(d,5,a,e.keywords.keyword,20,242,3466).success(function(t,o,s,i){e.searchGoodsList=t.productsList})},e.searchMore=function(){d+=1,t.searchGoods(d,5,a,e.keywords.keyword,20,242,3466).success(function(t,o,s,i){e.searchGoodsList=e.searchGoodsList.concat(t.productsList)})},e.onSale=function(){if(!c){c=!0,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("onSale").style.color="#32BEFF";document.getElementById("offSale").style.color="black",l=1,e.loadData(a,l,20,242,3466)}},e.offSale=function(){if(c){c=!1,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("offSale").style.color="#32BEFF";document.getElementById("onSale").style.color="black",l=0,e.loadData(a,l,20,242,3466)}},e.showBtn=function(e){if(c){var t=document.getElementsByClassName("sm-bottom-btn-on");angular.forEach(t,function(t,o){t.style.display=o==e?"inline-block":"none"})}else{var o=document.getElementsByClassName("sm-bottom-btn-off");angular.forEach(o,function(t,o){t.style.display=o==e?"inline-block":"none"})}},e.batchOperate=function(){for(var t=document.getElementsByClassName("sm-bottom-btn-on"),o=document.getElementsByClassName("sm-bottom-btn-off"),s=0,i=e.goodsList.length;s<i;s++)t[s].style.display="none",o[s].style.display="none";c?e.isShowOnFooter=!e.isShowOnFooter:e.isShowOffFooter=!e.isShowOffFooter,e.moreOrCheck=!e.moreOrCheck},e.deleteGoods=function(t){e.goodsList[t].sku;e.flag[t]=!e.flag[t],c?e.onSaleAmount=e.onSaleAmount-1:e.offSaleAmount=e.offSaleAmount-1,e.goodsList.splice(t,1)},e.soldOut=function(o){var s=e.goodsList[o].sku;t.updateGoods(a,s,1).success(function(e){}),e.flag[o]=!e.flag[o],e.onSaleAmount=e.onSaleAmount-1,e.offSaleAmount=e.offSaleAmount+1,e.goodsList.splice(o,1)},e.putAway=function(o){var s=e.goodsList[o].sku;t.updateGoods(a,s,0).success(function(e){}),e.flag[o]=!e.flag[o],e.offSaleAmount=e.offSaleAmount-1,e.onSaleAmount=e.onSaleAmount+1,e.goodsList.splice(o,1)},e.putAwayBatch=function(){var o=n.join("@");t.updateGoodsBatch(o,0).success(function(e,t,o,s){}),e.loadData(a,0,20,242,3466),n=[]},e.soldOutBatch=function(){var o=n.join("@");t.updateGoodsBatch(o,1).success(function(e,t,o,s){}),e.loadData(a,1,20,242,3466),n=[]},e.deleteGoodsBatch=function(){n.join("@");c?e.loadData(a,1,20,242,3466):e.loadData(a,0,20,242,3466),n=[]},e.selectGoods=function(t){if(0==e.goodsList[t].isSelected)e.goodsList[t].isSelected=!0,n.push(e.goodsList[t].sku);else if(e.goodsList[t].isSelected=!1,n&&n.length>=0){var o=n.indexOf(e.goodsList[t].sku);n.splice(o,1)}r=n.length==e.goodsList.length},e.selectAll=function(){r?(angular.forEach(e.goodsList,function(e){e.isSelected=!1}),r=!1):(angular.forEach(e.goodsList,function(e){e.isSelected=!0}),r=!0)},o.fromTemplateUrl("templates/shop/GoodsSearch.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.searchModal=t}),e.openSearchModal=function(){e.searchModal.show()},e.closeSearchModal=function(){e.searchModal.hide()},e.$on("$destroy",function(){e.searchModal.remove()}),e.removeProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,i.changeChooseStateDui(o).success(function(e,t,o,s){})},e.addProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,i.changeChooseStateJia(o,"1").success(function(e,t,o,s){})},e.$on("$ionicView.beforeEnter",function(){a=s.getUser().mid,e.init()})}]),APP.service("GoodsManageService",["$http","UrlService",function(e,t){this.getGoodsList=function(o,s,i,a,n){var r={memberId:o,onShelf:s,provinceId:i,cityId:a,districtId:n};return e.get(t.getUrl("GOODS_LIST"),r)},this.deleteGoods=function(o,s){var i={memberId:o,sku:s};return e.get(t.getUrl("DELETE_GOODS"),i)},this.updateGoods=function(o,s,i){var a={memberId:o,sku:s,onShelf:i};return e.get(t.getUrl("UPDATE_GOODS"),a)},this.searchGoods=function(o,s,i,a,n,r,c){var l={pageIndex:o,pageSize:s,memberId:i,keyword:a,provinceId:n,cityId:r,districtId:c};return e.get(t.getUrl("SEARCH_GOODS"),l)},this.updateGoodsBatch=function(o,s){var i={skuStr:o,onShelf:s};return e.post(t.getUrl("UPDATE_GOODS_BATCH"),i)},this.deleteGoodsBatch=function(o){var s={skuStr:o};return e.post(t.getUrl("DELETE_GOODS_BATCH"),s)}}]),APP.controller("HelpDetailController",["$scope","$stateParams","HelpDetailService","$ionicModal","$timeout","$sce","UrlService","PlatformService",function(e,t,o,s,i,a,n,r){e.helpId=t.helpId,e.title=t.content,e.isIos=!1,e.htmlContent=t.content,e.trustSrc=function(e){return a.trustAsResourceUrl(e)},e.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?e.isIos=!0:e.isIos=!1,e.htmlContent=n.getHead()+"mstore/sg/helpDetail.html?id="+t.helpId,e.trustSrc=function(e){return a.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.service("HelpDetailService",["$http","UrlService",function(e,t){this.getHelpDetail=function(o){var s={id:o};return e.get(t.getUrl("HELP_DETAIL"),s)}}]),APP.controller("LookAssessController",["$scope","LookAssessService","$stateParams","$ionicLoading","$timeout","PlatformService","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.show=!1,e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.goBack=function(){r.goBack()},e.closeImg=function(){e.show=!1},e.showLarge=function(t){e.show=!0,e.largeImg=t},e.init=function(o){t.getLookAssess(o).success(function(t,o,s,i){t.success?(e.assessList=t.data.comment,e.stateList=t.data,e.timeIsOrNo=(e.timeNow-e.assessList.createTime)/1e3/60/60/24<90):n.showToast(t.memessage)})},e.$on("$ionicView.beforeEnter",function(){e.cOrderSn=o.cOrderSn,e.init(e.cOrderSn),e.timeNow=Date.parse(new Date)})}]),APP.service("LookAssessService",["$http","UrlService",function(e,t){this.getLookAssess=function(o){var s={cOrderSn:o};return e.get(t.getUrl("LOOK_ASSESS_INGO"),s)}}]),APP.controller("ManageMoneyController",["$scope","ManageMoneyService","$ionicModal","$state","InAppBrowserService","$stateParams","UrlService","PopupService","$rootScope",function(e,t,o,s,i,a,n,r,c){function l(){t.checkKjtLogin().success(function(o){if(o.data.isLogin)f=o.data.token,e.promotionList=[],d(o.data.token),e.getPromoteReward(o.data.token,1,g),p(o.data.token);else{var a=I+"index.html#/manageMoney/"+$+"?page="+S,r=escape(a),c=n.getCPUrl("KQT_URL")+"?page=authorizeMain&partner_id="+m+"&return_url="+r;if(window.cordova){var l="",u="page="+I+"index.html#/homePage/",v="page="+I+"index.html#/shopRevenue";h=i.open(c),h.addEventListener("exit",function(){-1!=l.indexOf("auth_code")||-1!=l.indexOf(v)||-1!=l.indexOf(u)||e.$ionicGoBack()}),h.addEventListener("loadstart",function(o){if(l=unescape(o.url),-1!=o.url.indexOf("auth_code")){var i=o.url.indexOf("auth_code")+10,a=o.url.toString().substr(i,32);h.close(),t.getKjtToken(a).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),p(t.data.token)})}else-1!=l.indexOf(v)&&-1==l.indexOf("&return_url=")?s.go("shopRevenue"):-1!=l.indexOf(u)&&-1==l.indexOf("&return_url=")&&s.go("homePage")})}else window.location.href=c}})}function d(o){t.getHryActivityInfo(o).success(function(t){t.success&&(e.activityInfo=t.data.promotionActivityList,e.activityRule=t.data.description)})}function p(o){t.getRefCode(o).success(function(t){t.success&&(e.promoCode=t.data.promoCode,e.qrCodeUrl=t.data.qrCodeUrl)})}var u=1,g=5,m=n.getCPUrl("KQT_ID"),f="",h=null;e.activityInfo=[],e.activityRule="";var v=null,$=a.frontState,S="",I=n.getHead().replace("v3","www");e.showAgreement=!1,e.hasMoreData=!1,e.promoCode="",e.qrCodeUrl="",e.promotionList=[],e.init=function(){if(u=1,-1!=v.indexOf("auth_code")){var o=v.indexOf("auth_code")+10,s=v.toString().substr(o,32);t.getKjtToken(s).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),p(t.data.token)})}else l()},e.getPromoteReward=function(o,s,i){t.getPromoteReward(o,s,i).success(function(t){if(t.success){e.promotionList=e.promotionList.concat(t.data.promotionList);var o=e.promotionList.length;e.hasMoreData=o!=t.totalCount}else e.hasMoreData=!1})},e.getMoreData=function(){u++,e.getPromoteReward(f,u,g)},e.shareToPlatform=function(t){var o="好友力邀您来海融易，海融易为您准备了一份688大礼，快来领取吧！",s="http://m.ehaier.com/www/img/icon_inside_qrcode.png",i=e.qrCodeUrl;window.umeng?1==t?window.umeng.shareToWechatSession("快来领688元红包！",o,s,i,0,null,function(){e.sharemodal.hide()}):window.umeng.shareToWechatTimeline("快来领688元红包！",o,s,i,0,null,function(){e.sharemodal.hide()}):r.showAlert("只能在app分享","抱歉，只能在app分享")},e.skipToTTJ=function(){var e=I+"index.html#/manageMoney/"+$,t=escape(e),o=n.getCPUrl("TTQ_URL")+"?token="+f+"&loginUrl="+t+"&returnUrl="+t;if(window.cordova){var s=null;s=i.open(o),s.addEventListener("loadstart",function(e){-1!=e.url.indexOf("index.html#/manageMoney")&&s.close()})}else window.location.href=o},e.goBack=function(){"shopRevenue"==$?s.go("shopRevenue"):s.go("financialMoney",{whereId:"manageMoney"})},o.fromTemplateUrl("mm-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),o.fromTemplateUrl("mm-share-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.sharemodal=t}),e.openQRModal=function(){e.qrCodemodal.show();var t=new AraleQRCode({text:e.qrCodeUrl,size:106,image:c.imgBaseURL+"img/icon_inside_qrcode.png",imageSize:30}),o=document.getElementById("createdQrCode");0!=o.childNodes.length&&o.removeChild(o.childNodes[0]),o.appendChild(t),o.childNodes[0].style.position="relative"},e.closeQRModal=function(){e.qrCodemodal.hide()},e.openShareModal=function(){e.sharemodal.show()},e.closeShareModal=function(){e.sharemodal.hide()},e.openAgreement=function(){e.sharemodal.hide(),setTimeout(function(){e.showAgreement=!0},300)},e.closeAgreement=function(){e.showAgreement=!1},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.sharemodal.remove()}),e.$on("$ionicView.beforeEnter",function(t,o){v=window.location.href,$=a.frontState,I=n.getHead().replace("v3","www"),S="shopRevenue"==$?I+"index.html#/shopRevenue":I+"index.html#/homePage/",e.init()})}]),APP.service("ManageMoneyService",["$http","UrlService",function(e,t){this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))},this.getKjtToken=function(o){var s={authCode:o};return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:s})},this.getHryActivityInfo=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("GET_HAIRONGYI_ACTIVITYIFNO"),params:s})},this.getPromoteReward=function(o,s,i){var a={token:o,pageNo:s,pageSize:i};return e({method:"POST",url:t.getUrl("GET_PROMOTE_REWARD"),params:a})},this.getRefCode=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("GET_REF_CODE"),params:s})}}]),APP.controller("MicroSchoolController",["$scope","MicroSchoolService","HomePageService",function(e,t,o){e.microSchoolInfo=[],e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.init=function(){e.tabChange(0,8),o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.tabChange=function(t,o){for(var s=document.getElementsByClassName("sg-ws-button"),i=0,a=s.length;i<a;i++)i==t?(s[i].style.color="#32BEFF",s[i].style.borderBottom="2px solid #32BEFF"):(s[i].style.color="black",s[i].style.borderBottom="none");e.loadData(o)},e.loadData=function(o){t.getMicroSchoolInfo(o).success(function(t,o,s,i){e.microSchoolInfo=t.data}).error(function(e){})},e.$on("$ionicView.beforeEnter",function(t,s){if("back"==s.direction)return void o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1});e.init()})}]),APP.service("MicroSchoolService",["$http","UrlService",function(e,t){this.getMicroSchoolInfo=function(o){var s={childId:o};return e.get(t.getUrl("MICRO_SCHOOL"),s)},this.getMicroSchoolDetail=function(o,s){var i={childId:o,id:s};return e.get(t.getUrl(""),i)}}]),APP.controller("MicroSchoolDetailController",["$scope","$stateParams","$sce","MicroSchoolService",function(e,t,o,s){e.childId=t.childId,e.id=t.id,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.loadData(e.childId,e.id)},e.loadData=function(e,t){s.getMicroSchoolDetail(e,t).success(function(e,t,o,s){})},e.$on("$ionicView.beforeEnter",function(){e.title=t.title,e.childId=t.childId,e.id=t.id,e.init()})}]),APP.controller("MyStoreController",["$localstorage","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyStoreService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","SetShopCoverService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","ShopService","$http","GetStatisticInfoService","HomePageService",function($localstorage,$scope,$stateParams,$rootScope,$ionicHistory,$state,$ionicSideMenuDelegate,UserService,MyStoreService,$ionicSlideBoxDelegate,$ionicModal,ChooseShopTemplateService,PopupService,GoodsService,CommonAddressService,$timeout,$ionicScrollDelegate,UrlService,SetShopCoverService,BannerThemeService,SeckillService,countdownService,$interval,$ionicLoading,LoginService,CreditService,ShopService,$http,GetStatisticInfoService,HomePageService){function loadProducts(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){MyStoreService.getProductsList(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f).success(function(e){if($scope.allProducts=e.totalCount,e.data&&null!=e.data.productList&&void 0!=e.data.productList&&0!=e.data.productList.length){if(1==c?($scope.productsList=e.data.productList,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.productsList=$scope.productsList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})),$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide(),$scope.productsList){var t=$scope.productsList.length;$scope.hasMoreData=!(e.totalCount===t)}}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasMoreData=!1,$scope.allProducts=0,$scope.productsList=[],$scope.contentDataListxyz=[]})}function restParams(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?(provinceId=e.provinceId,cityId=e.cityId,districtId=e.areaId,streetId=e.streetId,$scope.address=e.regionName):(provinceId=16,cityId=17,districtId=2450,streetId=12036596,$scope.address="崂山区")}$scope.lType="templates/common/ListTemplate1.html",$scope.tType="templates/common/TitleTemplate1.html",$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.filterCategory=[!0,!1,!1],$scope.myStoreInfo={},$scope.slideImage=[],$scope.avatarImage="",$scope.address="",$scope.categorySelected=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[!0,!1],$scope.brandSelected=[!0,!1],$scope.priceSelected=[!0,!1];var firstParamsArr=["all","all","0"],secondParamsArr=[],paramIndex=0;$scope.allProducts=0,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1,$scope.coverImage=$rootScope.imgBaseURL+"img/bg_shop_4.png",$scope.countDownMsg="",$scope.screenWidth=window.innerWidth,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$scope.storeTitleName="",$scope.stockName="显示全部货",$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"];var token="";$scope.brand=!0,$scope.iSPrice=!0,$scope.productCateIdType="0",$scope.productCateId="",$scope.switch=!0,$scope.StockStateArr=["all","hasStock"],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$scope.leftArrow={},$scope.mystoreTitle={},$scope.addressDiv={},$scope.addressLabel={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.leftArrow={top:"14px"},$scope.mystoreTitle={top:"18px"},$scope.addressDiv={top:"16px"},$scope.addressLabel={top:0}),$scope.messageImgFlag=!0,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="配送至",$scope.dataAdd=null,$scope.flag="STORE_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity,pageIndex=1,pageSize=5,filterData="",qs="saleDesc",fromType="2",flag="",memberId="",productCateId=0,provinceId=16,cityId=173,districtId=2450,streetId=12036596,provinceName="",cityName="",sortColumn="saleDesc";$scope.stockState=!1,$scope.showShare=!1,$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.productsList=[],$scope.contentDataListxyz=[],restParams(),MyStoreService.getStoreInfo($scope.storeId,$scope.shareStoreId).success(function(e){switch(e.data.titleLayout){case"tit-df":$scope.tType="templates/common/TitleTemplate1.html";break;case"tit-bp":$scope.tType="templates/common/TitleTemplate2.html";break;case"tit-colum2":$scope.tType="templates/common/TitleTemplate3.html"}switch(e.data.listLayout){case"layout-df":$scope.lType="templates/common/ListTemplate1.html";break;case"layout-bp":$scope.lType="templates/common/ListTemplate2.html";break;case"layout-colum2":$scope.lType="templates/common/ListTemplate3.html"}$scope.coverImage=e.data.coverUrl,$scope.myStoreInfo=e.data,$scope.slideImage=e.data.banner,$scope.avatarImage=e.data.avatarImageFileId,$scope.storeTitleName=$scope.myStoreInfo.storeName+$scope.myStoreInfo.storeTypeName,$ionicSlideBoxDelegate.$getByHandle("my_store_slider").update(),$ionicSlideBoxDelegate.loop(!0)}),ShopService.getLevelInfo(function(e){e.success(function(e){if(e.success&&($scope.avatarImageFileId=e.data.avatarImageFileId,$scope.userCurrentLevelId=e.data.userCreditWithLevel.order,$scope.userName=e.data.userCreditWithLevel.name,$scope.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel))if($scope.levelArray=[],e.data.storeCreditWithLevel.order<=3){$scope.imgCount=e.data.storeCreditWithLevel.order;for(var t=0;t<e.data.storeCreditWithLevel.order;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/StarLevel@2x.png")}else for(var t=0;t<e.data.storeCreditWithLevel.order-3;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/Diamond@2x.png")})},$scope.storeId),$timeout(function(){MyStoreService.getPositionFromCookie().success(function(response,status,headers,config){if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,$scope.address=addressInfo[0].regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)}else getCurrentPosition(),$timeout(function(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},500)})},500),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.getSeckillInfo=function(){SeckillService.getServerTime().success(function(e){var t=e.data,o=$scope.myStoreInfo.seckill.beginTime,s=$scope.myStoreInfo.seckill.endTime,i="",a=$interval(function(){t+=1,t<o?(i=countdownService.getTime(countdownService.getTimeDif(1e3*o,1e3*t)),$scope.countDownMsg="距离开始时间还有"+i):t>=o&&t<=s?(i=countdownService.getTime(countdownService.getTimeDif(1e3*s,1e3*t)),$scope.countDownMsg="距离结束时间还有"+i):t>s&&($scope.countDownMsg="秒杀活动已结束",$interval.cancel(a))},1e3)})},$scope.loadMore=function(){pageIndex+=1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,$scope.filterParams,fromType,flag,!0,qs)},$scope.saleNum=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="#32BEFF",e.color="white",t.backgroundColor="white",t.color="#888",o.backgroundColor="white",o.color="#888",qs="saleDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},$scope.popularity=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="#32BEFF",t.color="white",o.backgroundColor="white",o.color="#888",qs="isHotDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},$scope.productsFilter=function(){var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="white",t.color="#888",o.backgroundColor="#32BEFF",o.color="white",$scope.filterModal.show(),$scope.switch&&GoodsService.getFilterData().success(function(e){if(e.success){for(var t=e.data.brandList,o=0;o<t.length;o++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(t[o].id)>-1?o>0&&(t[o].isActive=!0):t[o].isActive=!1:t[o].isActive=0==o;$scope.brandList=t}})},$scope.changeDown=function(e){e.down=!e.down},$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t){firstParamsArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName;for(var o=0,s=$scope.brandList.length;o<s;o++)$scope.brandSelected[o]=o===e;var i=0,a=$scope.brandList.length;if("全部"==t.brandName){$scope.brandList[0].isActive=!0;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive=!1}else{t.isActive=!t.isActive;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive?i++:$scope.brandList[0].isActive=!1;if(0==i&&($scope.brandList[0].isActive=!0),i==a-1){$scope.brandList[0].isActive=!0;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive=!1}}if($scope.brandList[0].isActive)$scope.filterParameterArr[1]="all";else{for(var n="",o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive&&(n+=$scope.brandList[o].id+";");n=n.substring(0,n.length-1),$scope.filterParameterArr[1]=n}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}$scope.filterParams=$scope.filterParameterArr.join("@"),restParams(),loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,$scope.filterParams,fromType,flag,!1,qs),$scope.filterModal.hide()},$scope.resetFilter=function(){for(var e=0;e<$scope.brandList.length;e++)$scope.brandList[e].isActive=0==e;$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$ionicScrollDelegate.resize()},$scope.category=function(){$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.changeCategory=function(e,t){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],productCateId=t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs);for(var o=0,s=$scope.categorySelected.length;o<s;o++)$scope.categorySelected[o]=o===e;$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,shareStoreId:$stateParams.shareStoreId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,shareStoreId:$stateParams.shareStoreId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$ionicModal.fromTemplateUrl("my-qrcode-modal.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){$scope.qrCodemodal=e}),$ionicModal.fromTemplateUrl("templates/product/SearchFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.openQrcode=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.qrCodemodal.show()},$scope.backToStore=function(){$scope.filterModal.hide()},$scope.closeModal=function(){$scope.qrCodemodal.hide(),$scope.filterModal.hide()},$scope.$on("$destroy",function(){$scope.qrCodemodal.remove(),$scope.filterModal.remove()}),$scope.saveQrCode=function(){var e="";e=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"DCIM/Camera/myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var t=encodeURI($scope.myStoreInfo.qrcode),o={};(new FileTransfer).download(t,e,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();PopupService.showAlert("","图片已经保存至"+t)}else PopupService.showToast("保存成功")},function(e){PopupService.showToast("保存失败！")},!0,o)},$scope.share=function(){if(!UserService.getUser().mid)return void $state.go("login");if(window.device&&window.device.hasNewShare)$scope.showShare=!$scope.showShare;else{var e=$scope.myStoreInfo.storeName,t=$scope.avatarImage,o=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.storeId+"/?fs";window.umeng?window.umeng.share(e,"我的顺逛店铺，精选好货，快来逛逛吧~",t,o,0):alert("只能在app分享,请下载app！")}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.myStoreInfo.storeName,o="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",s=$scope.avatarImage,i=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.userId+"/?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),
CreditService.qqShare()):4==e?(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(i),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.goMessageCenter=function(){$state.go("messageCenter")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.goBuyerCenter=function(){$scope.shareStoreId?$state.go("buyerCenter",{shareStoreId:$scope.shareStoreId}):$state.go("buyerCenter")},$scope.toProductDetail=function(e,t,o,s,i,a,n,r){window.cordova&&$rootScope.gio.track("prodClickInStore",{productId:e,o2oType:t,productFirstName:a,productSecondName:n,storeId:s,storeName:$scope.storeTitleName,hasStock:r}),$state.go("productDetail",{productId:e,o2oType:t,fromType:o,storeId:s,shareStoreId:i})},$scope.goBack=function(){$ionicHistory.backView()&&$scope.$ionicGoBack()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"1px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"STORE_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,MyStoreService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",MyStoreService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;MyStoreService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e),$scope.closeAddressModal()})}},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("STORE_LOCATION",function(e,t){$scope.address=t["text-3"],provinceId=t["value-1"],cityId=t["value-2"],districtId=t["value-3"],provinceName=t["text-1"],streetId=t["value-4"],cityName=t["text-2"];var o=t["text-3"]+"/"+t["text-4"];GoodsService.addAddress(provinceId,cityId,districtId,o,streetId).success(function(e,t,o,s){$scope.init()})}),$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId,provinceName=t.provinceName,cityName=t.cityName,$scope.address=t.regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.dataAdd=null,$scope.defaultValue=null,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,token=$stateParams.token,token&&MyStoreService.login(token).success(function(e){if(!e.success||null==e.data.mid)return void $state.go("login");UserService.setUser(e.data),e.data.sessionValue?$localstorage.set("sg_login_token_secret","Bearer"+e.data.sessionValue):$localstorage.set("sg_login_token_secret","Bearer"+GetStatisticInfoService.generateUUID())}),$scope.buttonShow=!1,memberId=$stateParams.storeId,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$ionicScrollDelegate.scrollTop(),$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})})}]),APP.service("MyStoreService",["$http","UrlService",function(e,t){this.getActivityProductsList=function(o,s,i,a,n,r,c){var l={storeId:o,isWdHost:s,productCateId:i,provinceId:a,cityId:n,districtId:r,sortColumn:c};return e.get(t.getUrl("ACTIVITY_PRODUCTS_LIST"),l)},this.getCommonProductsList=function(o,s,i,a,n,r,c,l){var d={storeId:o,isHost:s,productCateId:i,provinceId:a,cityId:n,districtId:r,pageIndex:c,sortColumn:l,noLoading:!0};return e.get(t.getUrl("PRODUCTS_LIST"),d)},this.getPositionFromCookie=function(){var o={};return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"),o)},this.getProductsList=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,provinceName:r,cityName:c,districtName:l,pageIndex:d,pageSize:p,productCateId:u,filterData:g,fromType:m,flag:f,noLoading:h,qs:v};return e.get(t.getUrl("COMMONLOADITEMNEW"),$)},this.getMyStoreInfo=function(o,s,i,a,n){var r={COOKIE_DOMAIN:o,DOMAIN_URL:s,POM_STATIC_DOMAIN_NAME:i,link:a,storeId:n,fromType:2};return e.get(t.getUrl("MY_STORE"),r)},this.getStoreInfo=function(o,s){if(s)var i={storeId:o,shareStoreId:s};else var i={storeId:o};return e.get(t.getUrl("MY_STORE_NEW"),i)},this.getMyStoreInfoNew=function(o){var s={memberId:o};return e.get(t.getUrl("SHUNGUANG_VIP"),s)},this.getFilterList=function(o){var s={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.login=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("OTHER_LOGIN"),params:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("HelpController",["$scope","$state","HelpService","InAppBrowserService","UrlService",function(e,t,o,s,i){e.helpData=[],e.loadData=function(){o.getHelpList().success(function(t){e.helpData=t.data.second})},e.goHelpDetail=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,o).addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(){e.loadData()})}]),APP.service("HelpService",["$http","UrlService",function(e,t){this.getHelpList=function(){return e.get(t.getUrl("SHUNGUANG_HELP"))}}]),APP.controller("OrderDetailController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u){o.orderSnDetail=a.orderSn,o.cOrderSnDetail=a.cOrderSn,o.userOrder="",o.orderDetailList=[];var g=r.getUser();o.loginMemberId=g.mid,o.uname=g.userName,o.userlevel=0,o.shareStoreId="";var m=a.cOrderId;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.init=function(){u.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})},o.goPayment=function(e,t){s.go("paymentxyz",{orderSn:e,totalAmount:t})},o.loadData=function(e,t){i.getOrderDetail(e,t).success(function(e){e.success&&(o.userOrder=e.data.loginMemberId==e.data.memberId,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier)})},o.goOrderTrack=function(e){s.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void n.showToast("退款受理中，请稍后刷新查看状态！");i.checkRefund(e).success(function(t){t.success?t.data&&t.data.isPackage?n.showConfirm("",t.data.packageMessage,function(t){t&&s.go("applyRefund",{cOrderSn:e})}):s.go("applyRefund",{cOrderSn:e}):n.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?s.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):s.go("productDetail",{productId:o.orderDetailList.productId,o2oType:o.orderDetailList.o2oType,storeId:o.orderDetailList.ckCode})},o.asse=function(e,t,o){s.go("publicationEvaluation",{cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),s=null;s=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,s.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(p.nextDirection("forward"),s.go("orderManage")):n.showToast(e.message)})}n.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.ml20={"margin-left":50},o.ml0={"margin-left":0},o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,m=a.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.cOrderSnDetail,m),o.init()}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.service("OrderDetailService",["$http","UrlService",function(e,t){this.getOrderDetail=function(o,s){var i={cOrderSn:o,cOrderId:s};return e.get(t.getUrl("ORDER_DETAIL"),i)},this.checkRefund=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CHECK_REFUND"),s)},this.customService=function(){return t.getUrl("CUSTOMER_SERVE")}}]),APP.controller("OrderManageController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){function w(e){e&&(n.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),s(function(){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,"")},1e3))}function y(e){e?n.deleteOrder(b).success(function(e){e.success?t.init():(g.showToastShort(e.message),b="")}).error(function(e){g.showToastShort("删除失败！"),b=""}):b=""}t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=0,t.isIos=!1,t.BDO=!1;var T,C="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var b="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType=o.orderType?o.orderType:"全部订单",t.orderFlag=o.orderFlag?o.orderFlag:0,t.orderStatus=o.orderStatus?o.orderStatus:0,t.availableToTop(),t.loadOrderList(!1,t.orderFlag,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),I.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.batchDeleteOrder=function(){i.go("batchDeleteOrder")},t.loadOrderList=function(e,o,s,i,a,c,l,d){n.getOrderList(o,s,i,a,c,d).success(function(i){if(i.success){if("closed"==s?(T=i.data.canDeleteAll,i.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(T=!1,t.BDO=!1),t.emptySearch=!1,i.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(i.data.orders);else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=t.orderList.concat(i.data.orders);else if(l)t.searchOrderList=i.data.orders;else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=i.data.orders;l?t.hasMoreDataSearch=i.data.orderProductSize:t.hasMoreData=i.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");C=e.result,window.alipay.pay({payInfo:C},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};p.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):i.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.searchModal.hide(),i.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){i.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,s,a,n,r){r&&t.closeSearchModal(),i.go("orderDetail",{orderSn:e,cOrderSn:o,cOrderId:a})},t.goAssess=function(e,t,o){o?i.go("assess",{orderId:e,cOrderSn:t}):i.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?i.go("lookAssess",{orderId:e,cOrderSn:t}):i.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",w,"确定")},t.confirmReceive=function(e,o,s){function a(e){e&&S.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',a,"确认"):i.go("confirmReceive",{orderId:s})},t.goBack=function(){if(t.orderFlag=0,t.orderStatus="",t.search.keyWord="",t.pageIndex=0,t.hasMoreData=!1,t.orderList=[],!m.backView())return i.go("homePage"),void m.clearCache();if("batchDeleteOrder"==m.viewHistory().backView.stateName)m.goBack(-2);else{if("afterOrderSubmit"==m.viewHistory().backView.stateName)return void m.goBack(-3);if("ccbPay"==m.viewHistory().backView.stateName||"paymentxyz"==m.viewHistory().backView.stateName||"ccbfenqi"==m.viewHistory().backView.stateName||"orderConfirm"==m.viewHistory().backView.stateName)return i.go("personnalCenter"),void m.clearCache();if("payResultSuccess"==m.viewHistory().backView.stateName||"payResultFailure"==m.viewHistory().backView.stateName||"confirmReceive"==m.viewHistory().backView.stateName)return i.go("personnalCenter"),void m.clearCache()}m.backView()&&m.backView().url.indexOf("login")>0?m.goBack(-2):m.goBack()},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.BDO=!!T,"back"==o.direction?I.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1}):t.init()}),a.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){i.go("orderSearch")},t.closeSearchModal=function(){t.searchModal.hide(),t.availableToTop()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndex=0,t.loadOrderList(!1,0,"",t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){b=e,g.showConfirm("","确认删除此订单？",y,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("4")})}]),APP.service("OrderManageService",["$http","UrlService",function(e,t){this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,pageIndex:i,pageSize:a,keyword:n};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(){return e.get(t.getNewUrl("ORDER_AMOUNT"))},this.cancelOrder=function(o,s){var i={orderId:o,cancelFlag:s};return e.get(t.getUrl("CANCEL_ORDER"),i)},this.payOrder=function(o){var s={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),s)},this.deleteOrder=function(o){var s={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),s)}}]),APP.filter("cut",function(){return function(e,t,o,s){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var i=e.lastIndexOf("");-1!=i&&(e=e.substr(0,i))}return e+(s||"…")}}),APP.controller("OrderTrackingController",["$localstorage","$scope","OrderTrackingService","$stateParams","PopupService","$timeout","UrlService","$state",function(e,t,o,s,i,a,n,r){t.customerServe=function(){if(window.cordova){var o=ionic.Platform.isAndroid(),s=null;s=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&a(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else t.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+t.kfTocken);return},t.orderSn=s.orderSn,t.orderTrackingData=[],t.Tracks=[],t.loadData=function(e){o.getOrderTracking(e).success(function(e){e.success?(t.Tracks=e.data.orderWorkFlowsViewA[0].orderWorkFlowList,t.orderTrackingData=e.data.orderWorkFlowsViewA):e.message?i.showToast(e.message):i.showToast("获取物流信息失败！")})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},t.showTrajectory=function(e,t){var o="http://wx.rrskx.com/rrswx/view/order/orderDetail.jsp?orderId=";0==n.getEnviroment()&&(o="http://wx.rrskx.com/rrswx-test/view/order/orderDetail.jsp?orderId="),e?o=o+"JSG"+t:o+=t,window.emc?window.emc.presentH5View(o,"车辆轨迹"):window.location.href=o},t.$on("$ionicView.beforeEnter",function(){t.loadData(t.orderSn)})}]),APP.service("OrderTrackingService",["$http","UrlService",function(e,t){this.getOrderTracking=function(o){var s={orderSn:o};return e.get(t.getUrl("ORDER_TRACKING"),s)},this.getCDKToken=function(){return e.get(t.getUrl("GET_CDK_TOKEN"))}}]),APP.service("PartnerDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getPartnerMessage=function(o,s){var i={ownerId:o,relationshipType:s};return e.get(t.getUrl("PARTNER_DETAIL"),i)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("RefundDetailController",["$localstorage","$http","RefundDetailService","$scope","$stateParams","PopupService","$timeout",function(e,t,o,s,i,a,n){s.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),o=null;o=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&n(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else s.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+s.kfTocken);return},s.orderProductId=i.orderProductId,s.memberId=i.memberId,s.orderTrackingData=[],s.orderTD="",s.loadData=function(e,t){o.getRefundDetail(e,t).success(function(e){e.success?(s.orderTrackingData=e.data.orderWorkFlowList,s.orderTD=e.data):e.message?a.showToast(e.message):a.showToast("获取物流信息失败！")})},s.$on("$ionicView.beforeEnter",function(){s.loadData(s.orderProductId,s.memberId)})}]),APP.service("RefundDetailService",["$http","UrlService",function(e,t){this.getRefundDetail=function(o,s){var i={orderProductId:o,memberId:s};return e.get(t.getUrl("REFUND_DETAIL"),i)}}]),APP.controller("RevenueDetailController",["$scope","$stateParams","RevenueDetailService","$rootScope","$ionicPopup","PlatformService","ionicDatePicker","$timeout",function(e,t,o,s,i,a,n,r){function c(e){var e=e.getFullYear()+"年"+(e.getMonth()+1>9?e.getMonth()+1:"0"+(e.getMonth()+1))+"月"+(e.getDate()>9?e.getDate():"0"+e.getDate())+"日";return e}function l(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,s=e.getDate(),i=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);1==o?(t=e.getFullYear()-1,o=12):o-=1,(t%4==0&&t%100!=0||t%400==0)&&(i[2]=29),i[o]<s&&(s=i[o]),s<10&&(s="0"+s),o<10&&(o="0"+o);var a=t+"年"+o+"月"+s+"日";return a}e.nulldata=!1,e.type=t.code,e.title=t.title,e.revenueList=[],e.total="",e.reward={},e.rewardO={},e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardXY=!1,e.startTime="",e.endTime="",e.rewardStart="",e.rewardEnd="",e.earningType=t.earningType;var d=0;e.init=function(){e.earningType=t.earningType,d=0,e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardYC=!1,e.isRewardXY=!1,4==e.type?(e.rewardStart=l(),e.rewardEnd=c(new Date)):(e.rewardStart="",e.rewardEnd=""),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)},e.loadData=function(t,s,i,a,n,r,c){
o.getRevenueList(t,s,i,a,n,r,c).success(function(t,o,i,a){e.nulldata=!1,t.success?(e.total=t.data.total,t.data.reward&&(e.reward=t.data.reward),t.data.rewardO&&(e.rewardO=t.data.rewardO),1!=s&&"0"==e.total&&""==t.data.rewardO.expectBrokerage&&""==t.data.rewardO.expectMonth&&""==t.data.rewardO.expectOpen&&""==t.data.rewardO.expectOpenCommend&&""==t.data.rewardO.expectRecommend&&""==t.data.rewardO.expectLeader&&""==t.data.rewardO.expectDzLeader&&""==t.data.rewardO.expectXyAmount&&""==t.data.rewardO.expectThreeLevel&&(e.nulldata=!0),t.data.rewardA&&(e.isRewardA=!0),t.data.rewardB&&0!=t.data.rewardB.length&&(e.isRewardB=!0),t.data.rewardC&&0!=t.data.rewardC.length&&(e.isRewardC=!0),t.data.rewardY&&0!=t.data.rewardY.length&&(e.isRewardY=!0),t.data.rewardZ&&0!=t.data.rewardZ.length&&(e.isRewardZ=!0),t.data.rewardTZ&&0!=t.data.rewardTZ.length&&(e.isRewardTZ=!0),t.data.rewardD&&0!=t.data.rewardD.length&&(e.isRewardD=!0),t.data.rewardXY&&0!=t.data.rewardXY.length&&(e.isRewardXY=!0)):e.revenueList=[],e.$broadcast("scroll.infiniteScrollComplete")})},e.chooseTime=function(){e.startTime=e.rewardStart,e.endTime=e.rewardEnd;var t=i.show({cssClass:"xvv-popupTime",template:'<div class="xvv-Time"><div>选择时间</div><div ng-click="lookDateModel(1)"><p>开始</p><p>{{startTime}}</p></div><div><img src="http://cdn09.ehaier.com/shunguang/H5/www/img/goOrder@2x.png"/></div><div ng-click="lookDateModel(2)"><p>结束</p><p>{{endTime}}</p></div></div>',scope:e,buttons:[{text:"取消"},{text:"确定",type:"button-positive",onTap:function(o){o.preventDefault(),e.rewardStart=e.startTime,e.rewardEnd=e.endTime,t.close(),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)}}]})},e.lookDateModel=function(t){if("APP"==a.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),r(function(){1==t&&(e.startTime=a+"年"+i+"月"+s+"日"),2==t&&(e.endTime=a+"年"+i+"月"+s+"日")},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i),1==t&&(e.startTime=new Date(o).getFullYear()+"年"+s+"月"+i+"日"),2==t&&(e.endTime=new Date(o).getFullYear()+"年"+s+"月"+i+"日")}};n.openDatePicker(s)}},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()})}]),APP.service("RevenueDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n,r,c){var l={earningType:o,type:s,rewardType:i,page:a,pageSize:n,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]),APP.controller("SecondManageController",["$scope","SecondManageService","UserService","UrlService","PopupService","CreditService",function(e,t,o,s,i,a){e.search={keyWords:""},e.pageIndex=0,e.pageSize=10,e.hasMoreData=!1,e.secondMemberDate=[],e.secondMemberList=[],e.rank=2,e.showShare=!1,e.init=function(){e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t}));o.getUser();e.rank=2,e.getCode(),e.loadData(!1,"",0,e.pageSize,e.rank)},e.getSecAndThi=function(t){e.rank=t,e.search.keyWords="",e.loadData(!1,e.search.keyWords,0,e.pageSize,e.rank)},e.getCode=function(){t.doGetCode().success(function(t){e.mid=t.data.promotionCode})},e.loadData=function(o,s,i,a,n){t.getSecAndThi(s,i,a,n).success(function(t){t.success&&(e.secondMemberDate=t.data,o?e.secondMemberList=e.secondMemberList.concat(t.data.memberInfo):(e.pageIndex=0,e.secondMemberList=t.data.memberInfo),e.hasMoreData=t.data.memberExist,(t.data.memberInfo&&t.data.memberInfo.length<10||!t.data.memberInfo)&&(e.hasMoreData=!1),e.isHaveDate=t.data.memberExist),o&&e.$broadcast("scroll.infiniteScrollComplete")})},e.loadMore=function(){e.pageIndex++,e.loadData(!0,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.searchSecondMember=function(){e.pageIndex=0,e.loadData(!1,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=o.getUser().avatarImageFileId,i=s.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?window.umeng.share("成为我的合伙人，一起赚丰厚佣金！","有梦就有店，高收入0投资，挣钱真简单～",t,i,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var i="成为我的合伙人，一起赚丰厚佣金！",n="有梦就有店，高收入0投资，挣钱真简单～",r=o.getUser().avatarImageFileId,c=s.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?(0==t?window.umeng.shareToSina(i,n,r,c,0,null,a.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(i,n,r,c,0,null,a.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(i,n,r,c,0,null,a.shareSuccessCallback):3==t?(window.umeng.shareToQQ(i,n,r,c,0,null,a.shareSuccessCallback),a.qqShare()):4==t?(window.umeng.shareToQzone(i,n,r,c,0,null,a.shareSuccessCallback),a.qqShare()):5==t&&e.copeText(c),a.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SecondManageService",["$http","UrlService",function(e,t){this.getSecAndThi=function(o,s,i,a){var n={keyword:o,pageIndex:s,pageSize:i};return 2==a?e.get(t.getUrl("SECOND_MANAGE"),n):e.get(t.getUrl("THIRD_MANAGE"),n)},this.doGetCode=function(){return e.get(t.getUrl("GETTUIGUANGMA"))}}]),APP.controller("SetShopCoverController",["$scope","SetShopCoverService","UserService","$ionicPopup",function(e,t,o,s){e.shopCoverList=[],e.storeId=o.getUser().mid,e.init=function(){e.getCover(e.storeId)},e.getCover=function(o){t.getShopCover(o).success(function(t,o,s,i){e.shopCoverList=t.data.shopCover})},e.chooseCover=function(o){var i=e.shopCoverList[o].coverUrl;t.setShopCover(i).success(function(t,o,i,a){e.getCover(e.storeId);var n=s.show({template:"修改店铺模板成功"});setTimeout(function(){n.close()},1e3)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.service("SetShopCoverService",["$http","UrlService",function(e,t){this.getShopCover=function(o){var s={storeId:o};return e.get(t.getUrl("GET_SHOP_COVER"),s)},this.setShopCover=function(o){var s={url:o};return e({method:"POST",url:t.getUrl("SET_SHOP_COVER"),params:s})}}]),APP.controller("ShopController",["$ionicViewSwitcher","$scope","UserService","ShopService","$ionicSlideBoxDelegate","$ionicScrollDelegate","MyStoreService","UrlService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","PopupService","MESSAGECENTERService","$rootScope","$state","BannerThemeService","$localstorage","VersionService","InAppBrowserService","$stateParams","$interval","$sce","CreditService","IMService","ManageMoneyService","LoginService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,P){t.flagNum=!1,t.tabNav="shop",t.storeInfo={},t.avatarImage="",t.slideImage=[],t.shareInfo={},t.user=o.getUser(),t.storeId="",t.btnList=[{url:"shopRevenue",icon:m.imgBaseURL+"img/btn_shop_revenue.png",name:"营收"},{url:"getCouponsList",icon:m.imgBaseURL+"img/btn_shop_coupon.png",name:"优惠券"},{url:"manageMoney",icon:"img/btn_shop_licai.png",name:"投资"},{url:"orderManage",icon:m.imgBaseURL+"img/btn_order_manager.png",name:"订单"},{url:"microSchool",icon:m.imgBaseURL+"img/btn_small_school.png",name:"微学堂"},{url:"teamSupervise",icon:m.imgBaseURL+"img/btn_two_management.png",name:"合伙人"},{url:"storeTeamOwner",icon:m.imgBaseURL+"img/btn_statistics.png",name:"统计"},{url:"vip",icon:m.imgBaseURL+"img/btn_storefront_renovation.png",name:"会员中心"}],t.showShare=!1;var x="",L="";t.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.topBtnCss4IOS={top:"12px"}),t.goMemberCenter=function(){T.getGameId(function(e){f.go("vip",{gameId:e})})},t.init=function(){s.getStoreInfo().success(function(e,o,s,i){t.storeInfo=e.data,t.storeId=t.storeInfo.ownerId,v.set("storeId",t.storeInfo.ownerId)}),s.getLevelInfoBefore().success(function(e){t.slideImage=e.data.banner,i.$getByHandle("shop_slider").update(),i.$getByHandle("shop_slider").loop(!0)}),s.getLevelInfo(function(e){e.success(function(e){if(t.avatarImageFileId=e.data.avatarImageFileId,t.userCurrentLevelId=e.data.userCreditWithLevel.order,t.userName=e.data.userCreditWithLevel.name,t.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel)if(t.levelArray=[],e.data.storeCreditWithLevel.order<=3){t.imgCount=e.data.storeCreditWithLevel.order;for(var o=0;o<e.data.storeCreditWithLevel.order;o++)t.levelArray.push(m.imgBaseURL+"img/Star-Grade@2x.png")}else for(var o=0;o<e.data.storeCreditWithLevel.order-3;o++)t.levelArray.push(m.imgBaseURL+"img/Diamond-Grade@2x.png")})},x),s.getMessage().success(function(e){t.msg=e.data.list[0].content,e.data.count>0?t.flagNum=!0:t.flagNum=!1}),$.checkVersion()},t.slideImageClick=function(e){"1"==t.slideImage[e].type?"主题活动"==t.slideImage[e].activityType?f.go("bannerTheme",{bannerId:t.slideImage[e].bannerId,platformType:t.slideImage[e].platformType}):"日常活动"==t.slideImage[e].activityType&&h.getBannerTheme(t.slideImage[e].bannerId,t.slideImage[e].platformType).success(function(o){f.go("bannerDaily",{bannerId:t.slideImage[e].bannerId,layout:o.data.layout,platformType:t.slideImage[e].platformType})}):"6"==t.slideImage[e].type&&f.go("crowdFunding")},t.share=function(){if(window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else{var e=t.storeInfo.storeName+"的顺逛小店",o=t.storeInfo.avatarImageFileId,s=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?window.umeng.share(e,"买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",o,s,0):alert("只能在app分享,请下载app！")}},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.storeInfo.storeName+"的顺逛小店",s="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",i=t.storeInfo.avatarImageFileId,a=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?(0==e?window.umeng.shareToSina(o,s,i,a,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):4==e?(window.umeng.shareToQzone(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):5==e&&t.copeText(a),T.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(e){function s(e){t.avatarImage=e,p(function(){t.avatarImage=e},200);var s=function(e){d.hide(),u.showToast("上传成功");var s=JSON.parse(e.response);t.avatarImage=s.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},i=function(e){d.hide(),u.showToast("上传失败")},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),s,i,a);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function i(e){}function a(e){t.avatarImage=e,p(function(){t.avatarImage=e},200);var s=function(e){u.showToast("上传成功"),d.hide();var s=JSON.parse(e.response);t.avatarImage=s.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},i=function(e){u.showToast("上传失败"),d.hide()},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),s,i,a);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function n(e){}1==e?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(a,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,s),p(function(){window.plugins.actionsheet.hide()},5e3)}else c.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},t.enter=function(o){if(-1!=o.indexOf("http"))if(window.cordova)if(m.isIOS)if(window.device.hasNewBrowser){var s=null;s=S.open(o),s.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else if(window.device.hasNewBrowser){var s=null;s=S.open(o),s.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else window.open(o,"_blank","location=yes");else-1!=o.indexOf("vip")?t.goMemberCenter():(f.go(o),e.nextDirection("forwoard"))},t.goNewHand=function(){-1!=navigator.userAgent.indexOf("iPhone")?S.open(r.getHead()+"mstore/sg/helpDetail.html?id=613","新手必读").addEventListener("exit",function(e){}):f.go("helpDetail",{helpId:"613",content:"新手必读"})},t.setSwitchFun=function(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return m.isCommission=o[i].list[0].checked,m.cashSwitch=o[i].list[1].checked,m.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0;var a={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(a),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var n=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(n)),m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0}},t.$on("$ionicView.beforeEnter",function(e,s){if(t.isApp=!!window.cordova||void 0,L=I.token)n.login(L).success(function(e){if(!e.success||null==e.data.mid)return void f.go("login");o.setUser(e.data),v.set("sg_login_token_secret","Bearer"+e.data.sessionValue),x=o.getUser().mid,A.checkOpenStore(x).success(function(e){e.data?(t.isBuyer="1",A.setRole(t.isBuyer),v.set("storeId",x)):(t.isBuyer="0",A.setRole(t.isBuyer),v.set("storeId",20219251))}),t.avatarImage=o.getUser().avatarImageFileId,a.scrollTop(),t.setSwitchFun(x),t.init()}).error(function(){f.go("login")});else{if(x=o.getUser().mid,t.avatarImage=o.getUser().avatarImageFileId,!o.getUser().mid)return void f.go("login");a.scrollTop(),t.setSwitchFun(x),t.init()}})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){this.getStoreInfo=function(){var o={noLoading:!0};return e({method:"POST",url:t.getUrl("GET_STORE_INFO"),params:o})},this.getLevelInfo=function(s,i){o.getGameId(function(o){s(e.get(t.getUrl("SHUNGUANG_VIP")+"?gameId="+o+"&memberId="+i))})},this.getLevelInfoBefore=function(){return e.get(t.getUrl("MY_STORE"))},this.getMessage=function(){return e.get(t.getUrl("MESSAGECENTER_INIT"))}}]),APP.controller("ShopRenovateController",["$scope","SetShopCoverService","UserService",function(e,t,o){e.shopCoverUrl="",e.storeId=o.getUser().mid,e.init=function(){t.getShopCover(e.storeId).success(function(t){for(var o=0,s=t.data.shopCover.length;o<s;o++)1==t.data.shopCover[o].selected&&(e.shopCoverUrl=t.data.shopCover[o].coverUrl)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.controller("ShopRevenueController",["$scope","$state","$ionicHistory","ShopRevenueService","PopupService","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n){function r(){s.isHasBindBankNum().success(function(e){e.success&&(p=e.data)})}function c(e){s.getAccountState(e).success(function(e){e.success&&(d=e.data)})}function l(){s.getTotalCommission().success(function(t){t.data.isLogin?e.totalCommission=t.data.totalReward:e.totalCommission=""}).error(function(e){})}e.styleFlag=!0,e.myInComeOut={},e.myTrendOut={},e.earningType="";var d=0;e.totalCommission="";var p="";e.init=function(){e.myInComeOut=[],e.myTrendOut=[],e.styleFlag=!0,e.earningType="B",e.loadData(7,e.earningType),r(),c(e.earningType),l()},e.loadData=function(t,o){s.getRevenueInfo(t,o).success(function(t,o,s,i){e.myInComeOut=t.data.myInComeOut,e.myTrendOut=t.data.myTrendOut;for(var a=echarts.init(document.getElementById("shopRevenueChart")),n=e.myTrendOut.dates,r=0;r<e.myTrendOut.dates.length;r++)n=n.replace("'","");var c={grid:{show:!0,left:"10%",top:"5%",right:"5%",bottom:"15%",padding:20,backgroundColor:new echarts.graphic.LinearGradient(0,0,1,1,[{offset:0,color:"#1188D7"},{offset:1,color:"#3CA9F1"}])},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"line",lineStyle:{color:"rgba(255,255,255,0.2)",width:2}}},xAxis:{type:"category",boundaryGap:!1,data:n.split(","),axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede",width:1}},axisTick:{lineStyle:{color:"#dedede",width:1}}},yAxis:[{type:"value",backgroundColor:"#1188D7",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbol:"circle",showSymbol:!1,symbolSize:6,smooth:!0,areaStyle:{normal:{color:"rgba(255,255,255,0.10)"}},itemStyle:{normal:{borderWidth:2,borderColor:"#ffffff",color:"#1188D7",lineStyle:{color:"#ffffff",width:2}}},data:e.myTrendOut.values.split(",")}]};a.setOption(c)})};var u=!0;e.changeProductType=function(t,o){u&&(e.styleFlag=o,u=!1,e.earningType=t,e.loadData(7,e.earningType),setTimeout(function(){u=!0},500))},e.goHelpDetail=function(){-1!=navigator.userAgent.indexOf("iPhone")?a.open(n.getHead()+"mstore/sg/helpDetail.html?id=15","营收结算规则").addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:15,content:"营收结算规则"})},e.withdraw=function(){1==d||3==d||4==d||parseInt(p)>0?e.myInComeOut?t.go("mentionCenter",{canAmount:e.myInComeOut.canAmount}):t.go("mentionCenter",{canAmount:0}):t.go("bankCard")},e.goBack=function(){if(!o.backView()||"mentionCenter"==o.viewHistory().backView.stateName)return void t.go("homePage");o.backView()&&o.backView().url.indexOf("login")>0?o.goBack(-2):o.goBack()},e.closePopup=function(){e.loginIsAuthentication=!1},e.$on("$ionicView.beforeEnter",function(){e.loginIsAuthentication=!1,e.loginIsAuthenticationClose=!0,p="",e.init()})}]),APP.service("ShopRevenueService",["$http","UrlService",function(e,t){this.getRevenueInfo=function(o,s){var i={range:o,earningType:s};return e.get(t.getUrl("REVENUE_INFO"),i)},this.getAccountState=function(o){var s={earningType:o};return e.get(t.getUrl("GET_ACCOUNT_STATE"),s)},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))},this.activation=function(){return e.get(t.getUrl("KBIND_ACTIVATION"))},this.isHasBindBankNum=function(){return e.get(t.getUrl("BANK_HASBINGNUM_NEW"))},this.realName=function(){return e.get(t.getUrl("KBIND_REALNAME"))},this.getTotalCommission=function(){var o={startDate:"",endDate:""};return e({method:"POST",url:t.getUrl("GET_TOTAL_COMMISSION"),params:o})}}]),APP.service("SpreadConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMessage=function(o,s,i){var a={partnerId:o,pageIndex:s,pageSize:i};return e.get(t.getUrl("SPREAD_CONNECTION"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("StatisticsController",["$ionicHistory","$q","$scope","$ionicHistory","$state","StatisticsService","$ionicScrollDelegate",function(e,t,o,e,s,i,a){function n(e,t){for(var o in e)e[o].storeName=i.limitStrLength(e[o].storeName,t)}function r(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=r(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=r(e[o]);return t}return e}function c(e){var o=t.defer();return o.resolve(r(e)),o.promise}o.backToLastView=function(){s.go("personnalCenter"),e.clearCache()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},o.switchType=function(e){o.typeState[e]||(o.typeState=[!1,!1],o.typeState[e]=!0,o.isPersonalStat=!o.isPersonalStat)},o.scrollToTop=function(){a.scrollTop({shouldAnimate:!0}),o.isShowScrollToTopButton=!1},o.watchScrollPosition=function(){a.getScrollPosition().top>10&&(o.isShowScrollToTopButton=!0)},o.switchConnectionType=function(e){0==o.connectionType[e]&&(o.connectionType=[!1,!1],o.connectionType[e]=!0,o.optionArr=[!0,!1],0==e&&o.hasPartner&&(c(o.partnerData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})),1==e&&o.hasConnection&&(c(o.connectionData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.connectionData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})))},o.switchOption=function(e){0==o.optionArr[e]&&(o.optionArr=[!1,!1],o.optionArr[e]=!0,o.isShowOption=!o.isShowOption)},o.closeOption=function(){o.isShowOption=!o.isShowOption},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e},o.timeTransform=function(e){var t=new Date;return t.setTime(e),t.Format("yyyy-MM-dd hh:mm:ss")},o.init=function(){i.getReportMessage().success(function(e){o.allData=e.data,0!=e.data.subLevelReportList.length?(o.hasSubLevel=!0,e.data.subLevelReportList[0]&&!$.isEmptyObject(e.data.subLevelReportList[0])?(o.hasPartner=!0,o.partnerData=e.data.subLevelReportList[0],e.data.subLevelReportList[1]&&!$.isEmptyObject(e.data.subLevelReportList[1])?(o.hasConnection=!0,o.connectionData=e.data.subLevelReportList[1],c(o.partnerData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})):(o.hasConnection=!1,c(o.partnerData.brokerageReportList).then(function(e){o.nowMonthContent=e,n(o.nowMonthContent,o.nowStoreNameLength)}),c(o.partnerData.brokerageReportList).then(function(e){o.totalContent=e,n(o.totalContent,o.totalStoreNameLength)}))):(o.hasPartner=!1,o.hasConnection=!1)):(o.hasSubLevel=!1,o.hasPartner=!1,o.hasConnection=!1)}),i.getReportMessagePlus().success(function(e){o.newBrokerageAmount=e.data.newBrokerageAmount,o.totalBrokerageAmount=e.data.totalBrokerageAmount})},o.$on("$ionicView.beforeEnter",function(){o.isPersonalStat=!1,o.typeState=[!0,!1],o.connectionType=[!0,!1],o.optionArr=[!0,!1],o.isShowOption=!1,o.isShowScrollToTopButton=!1,o.nowStoreNameLength=Math.floor(.21*(window.innerWidth-24)/13*4-3),o.totalStoreNameLength=Math.floor(.38*(window.innerWidth-24)/13*2-1),o.init()})}]),APP.service("StatisticsService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getReportMessage=function(){return e.get(t.getUrl("REPORT_DETAIL"))},this.getReportMessagePlus=function(){return e.get(t.getUrl("REPORT_DETAIL_PLUS"))},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("VRController",["$rootScope","$scope","UrlService","$sce","$ionicHistory","$stateParams",function(e,t,o,s,i,a){t.iframeUrl=s.trustAsResourceUrl(e.imgBaseURL+"VRshop/index.html");var n=a.isH5;t.goBack=function(){n?i.goBack():window.location.href="backToApp"}}]),APP.controller("WithdrawCashController",["$scope","$stateParams","WithdrawCashService","PopupService","$timeout","$ionicHistory","$state","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c){e.canAmount="",e.account="",e.canGetCash=!1,e.loadFinish=!1,e.init=function(){e.canGetCash=!1,t.canAmount?e.canAmount=t.canAmount:e.canAmount=0,e.canAmount>0&&(e.canGetCash=!0),e.loadFinish=!1,o.getMessage().success(function(t,o,i,a){t.success?t.data.kjtAccount&&(e.loadFinish=!0,e.account=t.data.kjtAccount.memberKjtpayAccount):(s.showToast(t.message),e.loadFinish=!1)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.getCashNow=function(){o.getCash(e.account).success(function(e,t,o,i){e.success?n.go("withdrawSuccess",{content:e.data.result}):s.showToast(e.message)})},e.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?r.open(c.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})}}]),APP.service("WithdrawCashService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.getCash=function(o){var s={kjtAccount:o};return e.get(t.getUrl("GETCASH_INIT"),s)}}]),APP.controller("WithdrawSuccessController",["$scope","$stateParams","$ionicHistory",function(e,t,o){e.content=t.content,e.goBack=function(){o.goBack(-2)}}]),APP.controller("batchDeleteOrderController",["$ionicHistory","$ionicPopup","$scope","PopupService","OrderManageService","BatchOrderService","$ionicScrollDelegate","$state","$ionicViewSwitcher","$rootScope",function(e,t,o,s,i,a,n,r,c,l){o.hasMoreData=!1,o.closeOrderData=[];var d=0;o.goBack=function(){c.nextDirection("enter"),r.go("orderManage")},o.loadData=function(){d=0,i.getOrderList(1,"closed",0,5,"").success(function(e){if(e.success){n.scrollTop(),o.isSelectAllOrder=!1,o.closeOrderData=e.data.orders,o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.image=[];for(var t=0;t<o.closeOrderData.length;t++)o.image[t]="img/ic_check.png"}})},o.loadMore=function(){d++,i.getOrderList(1,"closed",d,5,"").success(function(e){if(e.success){for(var t=o.closeOrderData.length;t<e.data.orders.length+o.closeOrderData.length;t++)o.image[t]="img/ic_check.png",o.isSelectAllOrder=!1;o.closeOrderData=o.closeOrderData.concat(e.data.orders),o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.$broadcast("scroll.infiniteScrollComplete")}})},o.selectOrderAddress=function(e){o.chooseOrderNum=0,-1!=o.image[e].indexOf("check")?(o.image[e]="img/ic_select.png",o.chooseOrderNum++,o.isChooseOrder=!0):(o.image[e]="img/ic_check.png",o.chooseOrderNum--),o.chooseOrderNum==o.image.length?o.isSelectAllOrder=!0:o.isSelectAllOrder=!1},o.selectAllOrder=function(){if(o.isSelectAllOrder){for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_check.png";o.chooseOrderNum=0,o.isSelectAllOrder=!1}else{for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_select.png";o.isSelectAllOrder=!0,o.chooseOrderNum=o.image.length}},o.batchDelete=function(){o.isChooseOrder=!1;for(var e=0;e<o.image.length;e++)-1!=o.image[e].indexOf("select")&&(o.isChooseOrder=!0);if(!o.isChooseOrder)return void s.showToast("请选择要删除的订单");t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){if(e){for(var t="",s=[],i=0,n=o.image.length;i<n;i++)-1!=o.image[i].indexOf("select")&&s.push(o.closeOrderData[i].orderId);t=s.join(",");var l={orderIds:t};a.batchDelete(l).success(function(e){if(e.success){if(o.isSelectAllOrder&&!o.hasMoreData)return c.nextDirection("enter"),void r.go("orderManage");o.loadData()}})}})},o.$on("$ionicView.beforeEnter",function(){n.scrollTop(),d=0,o.image=[],o.chooseOrderNum=0,o.isChooseOrder=!1,o.isSelectAllOrder=!1,window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?o.isIosAndInApp=!0:o.isIosAndInApp=!1,window.cordova?o.isApp=!0:o.isApp=!1,o.isIosAndInApp&&(o.iosStyleOne={padding:"64px 0 90px 0"},o.iosStyleTwo={top:"20px"}),o.isApp?o.bottomDivHeight={height:"40px"}:o.bottomDivHeight={height:"120px"},o.loadData()})}]),APP.service("BatchOrderService",["$http","UrlService",function(e,t){this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ORDER"),o)}}]),APP.controller("chaseEvaluateController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","chaseEvaluateService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(o){var s=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):n.showToast(o.message)},i=function(e){alert(e)},a=new FileUploadOptions,r=new Date,c=r.getTime();a.fileKey="imageFile",a.fileName=p.getUser.userName+c,a.headers={TokenAuthorization:g.get("sg_login_token_secret")},a.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),s,i,a)}function f(e){}var h=[],v=!0;e.goBack=function(){c.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?n.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(t){t?v&&(v=!1,u.submitEvaluateNew(e.wdOrderSn,e.commentObj.commentTt,h.join(",")).success(function(t){v=!0,t.success?t.data&&(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?n.showToast(t.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.$on("$ionicView.beforeEnter",function(){v=!0,e.wdOrderSn=o.cOrderSn,e.isMyOrder=1==o.isMeorder,e.commentObj={commentTt:""},e.imageCount=0,e.imageList=[],h=[]})}]),APP.service("chaseEvaluateService",["$http","UrlService",function(e,t){this.submitEvaluateNew=function(o,s,i){var a={cOrderSn:o,experienceContent:s,fileIds:i};return e({method:"POST",url:t.getUrl("ADD_ASSESS_SUBMIT"),params:a})}}]),APP.controller("criticalSuccessController",["$scope","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","UrlService","CreditService","criticalSuccessService",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e){var t,o,s,i,a,n,r,c="",l=0;for(e=_utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),o=e.charCodeAt(l++),s=e.charCodeAt(l++),i=t>>2,a=(3&t)<<4|o>>4,n=(15&o)<<2|s>>6,r=63&s,isNaN(o)?n=r=64:isNaN(s)&&(r=64),c=c+_keyStr.charAt(i)+_keyStr.charAt(a)+_keyStr.charAt(n)+_keyStr.charAt(r);return c},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var s=e.charCodeAt(o);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),
t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}}var g=new u;e.thisTitleName="评价成功",e.goBack=function(){"lookAssess"==r.viewHistory().backView.stateName?r.goBack(-1):r.goBack(-2)},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"});var m;e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),a.showToastShort("复制成功")):a.showToast("请下载APP执行此操作")},e.shareToPlatform=function(t){m=encodeURIComponent(g.encode(e.wdOrderSn));var o=e.isCriticalShop.productName,s=e.isCriticalShop.productImg,i=l.getShareLinkHeader()+"useExperience/"+m;window.umeng?(0==t?window.umeng.shareToWechatSession("邀请评价",o,s,i,0,null,d.shareSuccessCallback):1==t&&window.umeng.shareToQQ("邀请评价",o,s,i,0,null,d.shareSuccessCallback),2==t?e.copeText(i):d.successShare()):alert("只能在app分享")},e.criticalInit=function(){p.criticalNo(e.wdOrderSn).success(function(t){t.success?(e.noCriticalOrderList=t.data.waitComments,e.isCriticalShop=t.data.productInfo,e.isMeOrder=t.data.isMyOrder,e.isStore=t.data.isStoreMember):a.showToastShort(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.thisTitleName="评价成功","lookAssess"==r.viewHistory().backView.stateName&&(e.thisTitleName="邀请评价"),e.wdOrderSn=t.cOrderSn,e.shareList=[{img:c.imgBaseURL+"img/mm-wechat.png",text:"微信"},{img:c.imgBaseURL+"img/qq.png",text:"QQ"},{img:c.imgBaseURL+"img/btn_link.png",text:"复制链接"}],e.criticalInit()})}]),APP.service("criticalSuccessService",["$http","UrlService",function(e,t){this.criticalNo=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CRITICALSUC"),s)}}]),APP.controller("evaluationSuccessController",["$scope",function(e){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.$on("$ionicView.beforeEnter",function(){})}]),APP.controller("FinancialMoneyController",["InAppBrowserService","$rootScope","$scope","$state","FinancialMoneyService","UrlService","$stateParams",function(e,t,o,s,i,a,n){var r=a.getHead().replace("v3/","www/index.html");o.ssAuth=null,t.financialMoneyWhereId="","manageMoney"!=n.whereId&&(t.financialMoneyWhereId=n.whereId),o.loginUrl=r+"#/financialMoney/"+t.financialMoneyWhereId,o.returnUrl=r+"#/"+t.financialMoneyWhereId;o.$on("$ionicView.beforeEnter",function(){var e=window.location.href.indexOf("page=");if(-1!=e&&-1==window.location.href.indexOf("auth_code")){var t=unescape(window.location.href).substring(e+5);return void(window.location.href=t)}o.init()}),o.init=function(){function e(){i.checkKjtLogin().success(function(e){if(e.data.isLogin)o.ssAuth=e.data.token,angular.element("#hairongyi").submit();else{var s=r+"#/"+t.financialMoneyWhereId,i=r+"#/financialMoney/"+t.financialMoneyWhereId+"?page="+s,a=escape(i),n="https://zmgs.kjtpay.com/mgs/common/page.htm?page=authorizeMain&partner_id=200000055141&return_url="+a;window.location.href=n}})}var s=unescape(window.location.href);if(-1!=s.indexOf("auth_code")){var a=s.indexOf("auth_code")+10,n=s.toString().substr(a,32);i.getToken({authCode:n}).success(function(t){o.ssAuth=t.data.token,e()})}else e()}}]),APP.service("FinancialMoneyService",["$http","UrlService","UserService",function(e,t,o){this.getToken=function(o){return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:o})},this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))}}]),APP.controller("publicationEvaluationController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(o){var s=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):n.showToast(o.message)},i=function(e){alert(e)},a=new FileUploadOptions,r=new Date,c=r.getTime();a.fileKey="imageFile",a.fileName=p.getUser.userName+c,a.headers={TokenAuthorization:u.get("sg_login_token_secret")},a.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),s,i,a)}function m(e){}var f=[],h=[],v=!0;e.goBack=function(){c.goBack()},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}f=[],e.impressionArr.forEach(function(t){f.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.evaluateMethod=function(t){e.evaluateList=t},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?n.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(o){o?v&&(v=!1,t.submitEvaluationNew(e.wdOrderSn,e.commentObj.commentTt,e.evaluateList,e.valueAll.value1,e.valueAll.value3,e.valueAll.value2,h.join(","),f.join(","),e.isMeOrder,e.isStore).success(function(t){v=!0,t.success?t.data&&(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?n.showToast(t.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.init=function(){t.evaluationInit(e.wdOrderSn).success(function(t){t.success?(e.isMeOrder=1==t.data.isMyOrder,e.isStore=0==t.data.isStoreMember,e.isMeOrder||e.isStore?e.placeholderText="您可以写下您的购物体验，供其他小伙伴参考哦！":e.placeholderText="您写下购物体验后，收货人会自动收到邀评短信，可进行详细的图文评价！",e.impressionStr=t.data.impression,e.productPic=t.data.productInfo.productImg):n.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f=[],v=!0,e.isMeOrder=!1,e.placeholderText="您写下购物体验后，收货人会自动收到邀评短信，可进行详细的图文评价！",e.wdOrderSn=o.cOrderSn,e.productPic="",e.commentObj={commentTt:""},e.valueAll={value1:"5",value2:"5",value3:"5"},e.impressionArr=[],e.impressionStr=[],e.evaluateList=5,e.imageCount=0,e.imageList=[],h=[],e.canCommit=!1,e.init()})}]),APP.service("publicationEvaluationService",["$http","UrlService",function(e,t){this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG_NEW")},this.checkAssessText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),s)},this.evaluationInit=function(o){var s={cOrderSn:o};return e.get(t.getUrl("EVALUCTION_NEW"),s)},this.submitEvaluationNew=function(o,s,i,a,n,r,c,l,d,p){if(d||p)var u={cOrderSn:o,commentContent:s,star:i,productStar:a,serviceStar:n,shippingStar:r,fileIds:c,impressions:l};else u={cOrderSn:o,commentContent:s,star:i};return e({method:"POST",url:t.getUrl("SUBMIT_EVALUCTION_NEW"),params:u})}}]),APP.directive("commentBarNew",[function(){return{restrict:"E",template:'<div>\n        <img ng-click = "comment(0)" ng-src=\'{{commentValue>=1?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(1)" ng-src=\'{{commentValue>=2?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(2)" ng-src=\'{{commentValue>=3?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(3)" ng-src=\'{{commentValue>=4?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(4)" ng-src=\'{{commentValue>=5?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n      </div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("useExperienceController",["$scope","$stateParams","$timeout","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$localstorage","$interval","useExperienceService","publicationEvaluationService","$ionicPopup",function(e,t,o,s,i,a,n,r,c,l,d,p,u){window.onerror=function(e,t,o,s,i){setTimeout(function(){})},document.querySelector("#file").addEventListener("change",function(){var t=this;lrz(t.files[0],{width:800}).then(function(t){e.$apply(function(){e.imageCount>=5?i.showToast("最多上传5张图片"):(e.imageList.push(t.base64),g.push(t.base64.replace("base64,","base64-")),e.imageCount++)})})});var g,m=[],f=!0;e.imageCount=0,e.imageList=[],e.isCanComment=!0,e.VCodeTips="获取验证码",e.canGetVcode=!0,e.userInfo={mobile:"",captcha:"",verificationCode:""},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.removeImage=function(t){u.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){o&&(e.imageList.splice(t,1),g.splice(t,1),e.imageCount--)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?i.showToast("请输入2～500字的评价！"):0==e.userInfo.mobile.length?i.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?0==e.userInfo.verificationCode.length?i.showToast("请输入短信验证码"):p.checkAssessText(e.commentObj.commentTt).success(function(t){t?f&&(f=!1,d.submitBuyerComment(e.wdOrderSn,e.userInfo.mobile,e.userInfo.verificationCode,e.commentObj.commentTt,g,m.join(","),e.valueAll.value1,e.valueAll.value3,e.valueAll.value2).success(function(e){f=!0,e.success?e.data&&(i.showToastShort("商品评价成功！"),o(function(){r.$broadcast("AFTER_COMMIT"),a.go("evaluationSuccess")},1e3)):e.message?i.showToast(e.message):i.showToast("提交失败！")})):i.showToast("您的评论里面包含敏感词！")}):i.showToast("请输入正确的手机号格式")},e.setImgCaptchaForPhone=function(){e.identifyCodeImg=d.getImgCaptchaNew()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},e.getVCode=function(){e.canGetVcode&&(e.userInfo.mobile.length<=0?i.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?e.userInfo.captcha.length<=0?i.showToast("请输入图形验证码"):d.fastLoginCaptchaNew(e.wdOrderSn,e.userInfo.mobile,e.userInfo.captcha).success(function(t){if(t.data){e.canGetVcode=!e.canGetVcode;var o=60;e.timer=l(function(){o-1<0?(e.VCodeTips="获取验证码",l.cancel(e.timer),e.canGetVcode=!0):(o--,e.VCodeTips=o+"s后可重发 ")},1e3)}else i.showToast(t.message)}):i.showToast("请输入正确的手机号格式"))},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}m=[],e.impressionArr.forEach(function(t){m.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.useExperienceInit=function(t){d.userCommentPage(t).success(function(t){t.success?(e.productObj=t.data.productInfo,e.impressionStr=t.data.impression,e.isCanComment=t.data.status):i.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){g=[],f=!0,l.cancel(e.timer),e.productObj=[],e.impressionStr=[],l.cancel(e.timer),e.wdOrderSn=t.cOrderSn,e.useExperienceInit(e.wdOrderSn),e.setImgCaptchaForPhone(),m=[],e.commentObj={commentTt:""},e.valueAll={value1:5,value2:5,value3:5},e.impressionArr=[],e.impressionStr=[],e.canCommit=!1}),e.$on("$ionicView.beforeLeave",function(){l.cancel(e.timer)})}]),APP.service("useExperienceService",["$http","UrlService",function(e,t){this.getImgCaptchaNew=function(){return t.getUrl("GET_IMG_CAPTCHA_NEW")},this.fastLoginCaptchaNew=function(o,s,i){var a={cOrderSn:o,mobile:s,imgCaptcha:i};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA_COMMENT"),params:a})},this.userCommentPage=function(o){var s={cOrderSn:o};return e.get(t.getUrl("USER_COMMENT_PAGE"),s)},this.submitBuyerComment=function(o,s,i,a,n,r,c,l,d){var p={cOrderSn:o,mobile:s,mobileCode:i,userCommentContent:a,imageFile:n,impressions:r,productStar:c,serviceStar:l,shippingStar:d};return e({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:t.getUrl("SUBMIT_BUYER_COMMENT"),transformRequest:function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:p})}}]),APP.controller("teamMessageController",["$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","teamMessageService","UserService","UrlService","PopupService","CreditService","$state",function(e,t,o,s,i,a,n,r,c,l){s.isBasics=!1,s.userId=e.memberId,s.selectedIndex=0,s.orderFlag=3,s.orderStatus=0,s.pageIndex=0,s.pageSize=10,s.typeTeam=e.type,s.goBack=function(){t.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingtopClasscontent={top:"276px"}):(s.androidClass={"line-height":"44px"},s.paddingtopClasscontent={top:"260px"}),s.switchCheck=function(e){o.scrollTop(),s.isBasics=0!=e,1==e&&(s.selectedIndex=0,s.orderInit(s.selectedIndex)),1==s.checkArr[e]||(s.hasMore=!0,s.pageIndex=0,s.checkArr=[!1,!1],s.checkArr[e]=!s.checkArr[e],s.relationshipType=0==e?1:2,s.init())},s.backToLastView=function(){l.go("teamSupervise"),t.clearCache()},s.gotoPartnerDetail=function(e,t){1==t?l.go("partnerDetail",{ownerId:e}):l.go("connectionDetail",{ownerId:e})},s.gotoSpreadConnection=function(e){l.go("spreadConnection",{partnerId:e})},s.init=function(){i.getConnectionMsg(s.userId).success(function(e){e.success&&(s.productList=e.data,s.firstOrderTime=s.productList.firstOrderTime)})},s.orderInit=function(e){i.getOrderList(s.orderFlag,e,s.userId,s.pageIndex,s.pageSize).success(function(e){e.success&&(s.orders=e.data.orders,s.hasMore=e.data.orders.length<e.data.countResult)})},s.orderByList=function(e){s.selectedIndex=e,s.pageIndex=0,o.scrollTop(),s.orderInit(s.selectedIndex)},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.loadMore=function(){s.pageIndex++,i.getOrderList(s.orderFlag,s.selectedIndex,s.userId,s.pageIndex,s.pageSize).success(function(e){e.success&&(e.data.orders.length<e.data.countResult?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMore=!0,s.orders=s.orders.concat(e.data.orders)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMore=!1))})},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void o.scrollTop();o.scrollTop(),s.relationshipType=1,s.checkArr=[!0,!1],s.hasMore=!0,s.init(s.userID),s.orderFlag=3,s.orderStatus=0,s.pageIndex=0,s.pageSize=10})}]),APP.service("teamMessageService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o){var s={memberId:o};return e.get(t.getUrl("TEAM_USERINFO"),s)},this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,queryMemberId:i,pageIndex:a,pageSize:n,noLoading:!0};return e.get(t.getUrl("ORDER_LIST"),r)}}]),APP.controller("teamSuperviseController",["$ionicPopup","$state","UserService","$scope","CLASSIFYMESSAGECRNTERService","$localstorage","$rootScope","teamSuperviseService","$stateParams","$ionicScrollDelegate","UrlService","CreditService","PopupService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){s.productList=[],s.childrenList=[],s.rowsList=[],s.isFindTab=!0,s.selectedIndex=0,s.isUserShow=!1,s.isTeamInfo=!1,s.isUser=!1,s.page=1,s.cascade=!1,s.isTeam=!0,s.sortIndex=0,s.sortInd=0,s.sortNum=2,s.pageSize=10,s.userpageSize=10,s.orderOrTeams=!1,s.sortsIndex=1,s.messageImgFlag=!0,s.flagNum=!1,s.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png",s.arrowState=[n.imgBaseURL+"img/sortT.png",n.imgBaseURL+"img/sortF.png"],s.Math=window.Math;var m=["startTime","isAuthenticated","teamLevelOrder","isActive"],f=["shopKeepers","purchasedNum","recentBuyingTime"];s.memberId=o.getUser().mid,s.substring=window.substring,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingContentClass={top:"0px"}):(s.paddingtopClass={"padding-top":"0"},s.paddingContentClass={top:"0px"}),s.init=function(){g.getUnReadMsg().success(function(e){e.data>0?s.flagNum=!0:s.flagNum=!1})},s.share=function(){if(window.device&&window.device.hasNewShare)s.showShare=!s.showShare;else{var e=o.getUser().avatarImageFileId,t=d.getShareLinkHeader()+"register/0/"+s.productList.owner.promotionCode;window.umeng?window.umeng.share("顺逛店主邀请你一起瓜分5亿佣金","海尔社群交互平台，零成本创业APP，一起来赚钱吧",e,t,0):alert("只能在app分享,请下载app！")}},s.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastWithTime("复制成功",2e3)):u.showToast("请下载APP执行此操作")},s.hideblackCover=function(){s.showShare=!1},s.shareToPlatform=function(e){var t="我正在使用顺逛APP，推荐给你哦",i="时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",a=o.getUser().avatarImageFileId,n=d.getShareLinkHeader()+"register/0/"+s.productList.owner.promotionCode;window.umeng?(0==e?window.umeng.shareToSina(t,i,a,n,0,null,p.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,i,a,n,0,null,p.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,i,a,n,0,null,p.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,i,a,n,0,null,p.shareSuccessCallback),p.qqShare()):4==e&&(window.umeng.shareToQzone(t,i,a,n,0,null,p.shareSuccessCallback),p.qqShare()),5==e?s.copyText(n):p.successShare()):alert("umeng undefined 只能在app分享"),s.showShare=!1},s.lookreferee=function(){var t=e.show({template:'<div style="color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;margin-top:-12px">推荐人信息</div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">我的推荐人 : <b>{{myheader.realName}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">ID : <b>{{myheader.memberId}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:-5px;position:relative;">手机号 : <b>{{myheader.mobile}}</b>&nbsp;&nbsp;<img ng-src="{{imgBaseURL}}img/headerphone.png" width="20" heihgt="20" style="position:absolute;top:-2px;" ng-click="cellphone()"/></div>',scope:s,buttons:[{text:"<b>确定</b>",type:"button-positive",onTap:function(e){e.preventDefault(),t.close()}}]})},s.cellphone=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+s.myheader.mobile,"_system"):window.open("tel:"+s.myheader.mobile)},s.userM=function(){r.userData(s.memberId,s.page,s.pageSize,f[2],s.orderIndex).success(function(e){e.success&&(s.usersNumber=e.data.total)})},s.goMemberCenter=function(){p.getGameId(function(e){t.go("vip",{gameId:e})})},s.commontFun=function(e){l.scrollTop(),0==s.selectedIndex?(s.orderOrTeams=!1,s.info=0):1==s.selectedIndex&&(s.orderOrTeams=!0,s.info=1),r.doInit(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[e],s.orderIndex,s.active,s.store).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.usercomFun=function(e){r.userData(s.memberId,s.page,s.userpageSize,f[e],s.orderIndex).success(function(e){e.success&&(s.rowsList=e.data.rows,s.hasmore=s.rowsList.length<e.data.total)})},s.teamClickFun=function(e){l.scrollTop(),s.sortInd=e,s.page=1,0==s.sortsIndex?(s.sortsIndex=1,s.orderIndex="desc",s.commontFun(s.sortInd,s.orderIndex)):1==s.sortsIndex&&(s.sortsIndex=0,s.orderIndex="asc",s.commontFun(s.sortInd,s.orderIndex))},s.teamTrueAttestation=function(e){l.scrollTop(),s.sortInd=e,s.isAuthenticated=2,s.orderIndex="desc",s.page=1,s.childrenList=[],s.commontFun(s.sortInd)},s.teamLevel=function(e){s.childrenList=[],s.sortInd=e,s.orderIndex="desc",s.page=1,s.commontFun(s.sortInd)},s.teamActive=function(e){s.sortInd=e,s.isActiveNum=2,s.isAuthenticated=2,s.orderIndex="desc",s.page=1,s.childrenList=[],s.commontFun(s.sortInd)},s.userClickFun=function(e){s.sortNum=e,s.orderIndex="desc",s.page=1,s.usercomFun(s.sortNum)},s.userNumber=function(e){s.sortNum=e,s.orderIndex="desc",s.page=1,s.usercomFun(s.sortNum)},s.userTime=function(e){s.sortNum=e,s.page=1,0==s.sortsIndex?(s.sortsIndex=1,s.orderIndex="desc",s.usercomFun(s.sortNum,s.orderIndex)):1==s.sortsIndex&&(s.sortsIndex=0,s.orderIndex="asc",s.usercomFun(s.sortNum,s.orderIndex))},s.goBack=function(){s.$ionicGoBack()},s.getShopData=function(){r.doInit(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[s.sortIndex],s.orderIndex).success(function(e){e.success&&(e.data.parent?(s.hasparent=!0,s.myheader=e.data.parent):s.hasparent=!1,s.productList=e.data,s.childrenList=e.data.children,s.unauthenticatedNum=Math.floor(e.data.total-e.data.authenticatedNum),s.unactiveNum=Math.floor(e.data.total-e.data.unActiveNum),s.hasmore=s.childrenList.length<e.data.total)})},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.Reps=function(e){if(e)return e.substring(0,1)},s.teamTab=function(e){s.selectedIndex=e,s.sortInd=0,s.page=1,s.orderIndex="desc",s.childrenList=[],s.rowsList=[],l.scrollTop(),0==s.selectedIndex?(s.sortsIndex=1,s.orderIndex="desc",s.isTeam=!0,s.isTeamInfo=!1,s.isUserShow=!1,s.isUser=!1,s.isAuthenticated=2,s.isActiveNum=2,s.commontFun(s.sortInd,s.orderIndex)):1==s.selectedIndex?(s.isTeam=!0,s.isUserShow=!1,s.isTeamInfo=!1,s.isUser=!1,s.sortsIndex=1,s.orderIndex="desc",s.isAuthenticated=2,s.isActiveNum=2,s.commontFun(s.sortInd,s.orderIndex)):2==s.selectedIndex&&(s.isTeam=!1,s.isTeamInfo=!0,s.isUserShow=!0,s.isUser=!0,s.sortNum=2,s.orderIndex="desc",s.sortsIndex=1,s.usercomFun(s.sortNum,s.orderIndex))},s.storeFun=function(e){r.newStore(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[1],s.orderIndex,e).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.storeMoreFn=function(e,t){r.storeMore(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex,t).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.Authenticated=function(e){s.isAuthenticated=e,0==e?(s.page=1,s.store=!1,s.storeFun(s.store)):1==e&&(s.page=1,s.store=!0,s.storeFun(s.store))},s.activeFun=function(e){r.newActive(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[3],s.orderIndex,e).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.activeMoreFn=function(e,t){r.activeMore(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex,t).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.isActive=function(e){l.scrollTop(),s.isActiveNum=e,0==e?(s.page=1,s.active=!1,s.activeFun(s.active)):1==e&&(s.page=1,s.active=!0,s.activeFun(s.active))},s.userLoadMore=function(e){r.userData(s.memberId,e,s.userpageSize,f[s.sortNum],s.orderIndex).success(function(e){e.success&&(s.rowsList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.rowsList=s.rowsList.concat(e.data.rows)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.teamLoadMore=function(e){r.doInit(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.loadMore=function(){0==s.sortInd&&(0==s.selectedIndex||1==s.selectedIndex)||2==s.sortNum&&2==s.selectedIndex?0==s.sortsIndex?s.orderIndex="asc":1==s.sortsIndex&&(s.orderIndex="desc"):s.orderIndex="desc",0==s.selectedIndex&&(0==s.sortInd||2==s.sortInd)||1==s.selectedIndex&&(0==s.sortInd||2==s.sortInd)?(s.page++,s.teamLoadMore(s.page)):(0!=s.selectedIndex||1!=s.sortInd&&3!=s.sortInd)&&(1!=s.selectedIndex||1!=s.sortInd&&3!=s.sortInd)||(0==s.isActiveNum?(s.active=!1,s.page++,s.activeMoreFn(s.page,s.active)):1==s.isActiveNum?(s.active=!0,s.page++,s.activeMoreFn(s.page,s.active)):0==s.isAuthenticated?(s.store=!1,s.page++,s.storeMoreFn(s.page,s.store)):1==s.isAuthenticated?(s.store=!0,s.page++,s.storeMoreFn(s.page,s.store)):(s.page++,s.teamLoadMore(s.page))),2==s.selectedIndex&&(s.page++,s.userLoadMore(s.page))},s.commonFn=function(){l.scrollTop(),s.rowsList=[],s.productList=[],s.childrenList=[],s.selectedIndex=0,s.sortInd=0,s.sortNum=2,s.page=1,s.memberId=o.getUser().mid,s.store=!0,s.active=!0,s.isTeam=!0,s.isUser=!1,s.isUserShow=!1,s.isTeamInfo=!1,s.orderIndex="desc",s.hasmore=!0,s.sortIndex=0,s.getShopData()},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void g.getUnReadMsg().success(function(e){e.data>0?s.flagNum=!0:s.flagNum=!1});s.commonFn(),s.userM(),s.init()})}]),APP.service("teamSuperviseService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l){var d={withParent:!0,memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r};return e.get(t.getUrl("TEAM_SUPERVISE"),d)},this.storeMore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.activeMore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newStore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newActive=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.userData=function(o,s,i,a,n){var r={memberId:o,pageNumber:s,pageSize:i,sort:a,order:n};return e.get(t.getUrl("TEAM_USERS"),r)}}]),APP.controller("userMessageController",["$state","$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","userMessageService","$rootScope",function(e,t,o,s,i,a,n){i.userId=t.memberId,i.name=t.name,i.mobile=t.mobile,i.isTeamNum=t.isTeamNum,i.page=1,i.pageSize=20,i.sortsIndex=2,i.arrowState=[n.imgBaseURL+"img/sortT.png",n.imgBaseURL+"img/sortF.png",n.imgBaseURL+"img/sort2.png"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingtopClasscontent={top:"246px"},i.teamInfos={top:"46%"}):(i.paddingtopClass={"padding-top":"0"},i.paddingtopClasscontent={top:"220px"},i.teamInfos={top:"36%"}),i.init=function(){a.getConnectionMsg(i.mobile,i.page,i.pageSize).success(function(e){e.success&&(i.productList=e.data,i.userList=e.data.rows,i.hasmore=i.userList.length<e.data.total)})},i.priceRange=function(e){var t=Math.floor(e/1e3);return t>=20?1e3*t+"~":1e3*t+"~"+(1e3*t+1e3)},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.goBack=function(){i.$ionicGoBack()},i.goBackMsg=function(){e.go("teamMessage",{memberId:i.userId})},i.userLoadMore=function(e){a.getConnectionMsg(i.userId,e,i.pageSize).success(function(e){e.success&&(i.userList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.userList=i.userList.concat(e.data.rows)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.loadMore=function(){i.page++,i.userLoadMore(i.page)},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void s.scrollTop();s.scrollTop(),i.page=1,i.pageSize=20,i.hasMore=!0,i.init(i.userId,i.page,i.pageSize)})}]),APP.service("userMessageService",["$http","UrlService",function(e,t){this.getConnectionMsg=function(o,s,i){var a={mobile:o,pageNumber:s,pageSize:i,noLoading:!0};return e.get(t.getUrl("TEAM_MESSAGE"),a)}}]),APP.controller("userSearchController",["$rootScope","$scope","userSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,s,i,a,n,r){t.memberId=s.getUser().mid,t.page=1,t.pageSize=20,t.pageNum=10,t.searchValue="",t.selectedIndex=r.selectedIndex,t.Reps=function(e){if(e)return e.substring(0,1)},t.backToLastView=function(){t.$ionicGoBack()};var c=document.querySelector("#focus");t.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},t.commonFun=function(e){o.teamSearch(t.memberId,t.searchValue,e,t.page,t.pageNum).success(function(e){e.success&&(t.searchResults=e.data.children,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.searchConnection=function(){if(""==t.searchValue)return void a.showToast("请填写搜索内容");0==t.selectedIndex&&(t.cascade=!1,t.commonFun(t.cascade)),1==t.selectedIndex&&(t.cascade=!0,t.commonFun(t.cascade)),2==t.selectedIndex&&o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults=e.data.rows,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.loadMore=function(){t.page++,o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults.length<e.data.total?(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!0,t.searchResults=t.searchResults.concat(e.data.rows)):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!1))})},t.$on("$ionicView.enter",function(){"back"==t.direction?c.blur():(t.searchValue="",t.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),t.$on("$ionicView.beforeEnter",function(e,o){t.direction=o.direction,t.page=1,t.pageSize=20,t.pageNum=10,t.hasMore=!0,t.placeHolder="请输入用户名称"})}]),APP.service("userSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,s,i,a){var n={memberId:o,pageNumber:s,pageSize:i,userName:a,noLoading:!0};return e.get(t.getUrl("TEAM_USERS"),n)},this.teamSearch=function(o,s,i,a,n){var r={memberId:o,keyword:s,cascade:i,pageNumber:a,pageSize:n,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),r)}}]),APP.controller("newUserLoginController",["$stateParams","$location","$timeout","HomePageService","newUserLoginService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){r.isBuyer="1",
r.isFocusShow=!0,r.identifyCodeImg="",r.showCaptcha=!1,r.showCaptchaForPhone=!0,r.eyeIndex=0,r.loginIndex=0,r.canGetVcode=!0,r.VCodeTips="获取验证码",r.eyeArr=[n.imgBaseURL+"img/eye_close@2x.png",n.imgBaseURL+"img/eye_open@2x.png"],r.pwdArr=["password","text"],r.loginTypeArr=["短信验证码登录","账号密码登录"],r.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var T=0;r.show=!1;ionic.Platform.isAndroid()||ionic.Platform.isIOS();r.leftArrow={},r.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(r.leftArrow={"margin-top":"36px"},r.rightButton={top:"36px"});r.xyzloginName=p.getUser().loginName,r.userInfo={userName:r.xyzloginName,mobile:p.getUser().mobile,password:"",captcha:"",verificationCode:""},r.VCodeStyle={color:"#2979FF"},r.getVCode=function(){r.canGetVcode&&(r.userInfo.mobile&&0!=r.userInfo.mobile.length?r.globalConstant.mobileNumberRegExp.test(r.userInfo.mobile)?0==r.userInfo.captcha.length?m.showToast("请输入图形验证码"):i.fastLoginCaptcha(r.userInfo.mobile,r.userInfo.captcha).success(function(e){if(e.data)if(-1==e.data&&0==r.userInfo.captcha.length)r.setImgCaptchaForPhone(),r.showCaptchaForPhone=!0,m.showToast("请输入图形验证码");else{r.canGetVcode=!r.canGetVcode;var t=60;r.timer=a(function(){t-1<0?(r.VCodeTips="获取验证码",r.VCodeStyle={color:"#2979FF"},a.cancel(r.timer),r.canGetVcode=!0):(r.VCodeStyle={color:"#666666"},t--,r.VCodeTips="重发 "+t+"s")},1e3)}else m.showToast(e.message)}):m.showToast("请输入正确的手机号格式"):m.showToast("请输入手机号"))},r.toggleEye=function(){r.eyeIndex=(r.eyeIndex+1)%2},r.setImgCaptcha=function(){r.identifyCodeImg=l.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},r.setImgCaptchaForPhone=function(){r.identifyCodeImg=h.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},r.canClickLoginOrNot=function(){0!=r.userInfo.mobile.length&&0!=r.userInfo.verificationCode.length?r.canClickLogin=!0:r.canClickLogin=!1},r.concactID=function(){r.loginIndex=1},r.mobileLogin=function(){r.loginIndex=0},r.toRegister=function(){frontView&&"guidePage"!=r.frontView?d.go("register",{hasHistory:1}):d.go("register",{hasHistory:0})},r.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&r.loginSG()},r.loginSG=function(){var e=t.absUrl();0==r.loginIndex?e.indexOf("code")<0?m.showToast("请重新打开页面，获取授权"):0==r.userInfo.mobile.length?m.showToast("请输入手机号"):r.globalConstant.mobileNumberRegExp.test(r.userInfo.mobile)?0==r.userInfo.captcha.length?m.showToast("请输入图形验证码"):0==r.userInfo.verificationCode.length?m.showToast("请输入短信验证码"):r.userInfo.verificationCode.length>0&&r.userInfo.verificationCode.length<6||r.userInfo.verificationCode.length>6?m.showToast("短信验证码长度必须是6位"):r.userData.unionid?i.fastLogin("1","7",r.userData.unionid,"",r.userInfo.mobile,r.userInfo.verificationCode,r.userInfo.captcha).success(function(e){if(e.success){r.userdataDetail=e.data;e.data.mid;n.loginMemberId=e.data.mid,p.setUser(e.data),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),r.frontView?"newUserLogin"==r.frontView||"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront","")):d.go("relactOK",{nickname:r.userdataDetail.nickname,mobile:r.userInfo.mobile,email:""})}else m.showToast(e.message)}):m.showToast("请重新打开页面，获取授权"):m.showToast("请输入正确的手机号格式"):e.indexOf("code")<0?m.showToast("请重新打开页面，获取授权"):0==r.userInfo.userName.length?m.showToast("请输入用户名"):0==r.userInfo.password.length?m.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):r.userData.unionid?i.fastLogin("2","7",r.userData.unionid,r.userInfo.password,r.userInfo.userName,"","").success(function(e){if(e.success){r.userdataDetail=e.data;e.data.mid;n.loginMemberId=e.data.mid,p.setUser(e.data),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),r.frontView?"newUserLogin"==r.frontView||"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront","")):d.go("relactOK",{nickname:r.userdataDetail.nickname,mobile:r.userInfo.userName,email:""})}else m.showToast(e.message)}):m.showToast("请重新打开页面，获取授权")},r.isHideFooter=function(){r.isFocusShow=!1},r.isShowFooter=function(){r.isFocusShow=!0},r.thirdLogin=function(e){if(T=0,!window.umeng)return void alert("umeng 插件 未加载");umengLogin(e)},r.goBack=function(){f.goBack()},r.$on("$ionicView.beforeEnter",function(){var e={title:"",url:""};window.history.pushState(e,"","#/login/newUserLogin"),r.backYes=!1,o(function(){r.backYes=!0},1500),r.urlbase=t.absUrl(),s.isWdHost().success(function(e){n.isWdHost=e.data.isHost}),window.onpopstate=function(){r.backYes&&-1==n.isWdHost&&window.history.go(-3)};var a=c.get("backfront");r.urlbase.indexOf("code")>0?(r.codeString=r.urlbase.substring(r.urlbase.indexOf("code"),r.urlbase.indexOf("&")),r.getCode=r.codeString.substring(5),i.findStatus(r.getCode).success(function(e){if(e.success)if(e.data.unionid){if(r.userData=e.data,1==r.userData.isBinded)if(a){var t=JSON.parse(a);r.frontView=t.stateName,r.params=t.stateParams;e.data.memberViewA.mid;n.loginMemberId=e.data.memberViewA.mid,p.setUser(e.data.memberViewA),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.memberViewA.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.memberViewA.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront",""))}else d.go("relactOK",{nickname:r.userData.nickname,mobile:r.userData.mobile,email:r.userData.email});else if(r.loginIndex=0,a){var t=JSON.parse(a);r.frontView=t.stateName,r.params=t.stateParams}}else m.showToast("请重新打开页面，获取授权");else m.showToast("请重新打开页面，获取授权")}).error(function(){m.showToast("请重新打开页面，获取授权")})):(r.url=encodeURIComponent($.getThirdUrl("www/#/login/newUserLogin")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+r.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"),r.showCaptcha=!1,r.showCaptchaForPhone=!1,r.setImgCaptchaForPhone(),l.checkLogin().success(function(e,t,o,s){r.setImgCaptcha(),r.setImgCaptchaForPhone()})})}]),APP.service("newUserLoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,s,i){var a={userName:o,password:encodeURIComponent(s),captcha:i,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),a)},this.loginUserInfo=function(o,s){var i={userName:o,password:s,noLoading:!0};return e.get(t.getUrl("LOGIN"),i)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var s={memberId:o};else s={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),s)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.findStatus=function(o){var s={code:o};return e.get(t.getUrl("FIND_STATUS"),s)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,s){var i={mobile:o,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:i,headers:{Authorization:"open the gate"}})},this.fastLogin=function(o,s,i,a,n,r,c){var l={type:o,loginType:7,unionid:i,password:a,mobile:n,captcha:r,imgCaptcha:c};return e({method:"POST",url:t.getUrl("NEW_USER_CONTACT"),params:l})}}]),APP.controller("relactOKController",["$stateParams","$timeout","relactOKService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PopupService","$ionicHistory","$http","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){a.leftArrow={},a.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(a.leftArrow={"margin-top":"36px"},a.rightButton={top:"36px"}),a.init=function(){},a.$on("$ionicView.beforeEnter",function(){a.nickname=e.nikename,a.mobile=e.mobile,a.email=e.email,a.mobile.length>1?a.user=a.mobile:a.user=a.email})}]),APP.service("relactOKService",["$http","UrlService","$localstorage",function(e,t,o){}]),APP.controller("AddAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","ADDADDRESSService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage=i.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var m=window.innerHeight,f=m-373+"px";o.contentHeight={height:f};var h=m-250+"px";o.contentHeightStreet={height:h},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={};var v={};o.init=function(){if(o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn){var e=l.viewHistory().backView;e&&"address"==e.stateName?e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&o.addressMsgInit():(o.addressRegionName="所在地区",o.defaultImage=i.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s")}else o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.defaultOrchange&&o.hasChangeCommon();o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.hasChangeCommon=function(){o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree+" "+o.streetMsg,o.address.provinceId=o.hasChangeArr["value-1"],o.address.cityId=o.hasChangeArr["value-2"],o.address.areaId=o.hasChangeArr["value-3"],a.getLocationList(o.hasChangeArr["value-3"],o.hasChangeArr["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.addressMsgInit=function(){o.textColor="color-text-l",o.streetTextColor="color-text-l",void 0==i.addressStr?(o.defaultOrchange=!0,o.isChangeOrDefault=1,o.productChangeAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsg=JSON.parse(i.addressDefMsg),o.addressNum=o.adsMsg.pcrName.indexOf("/"),o.adsDefMsgInfo=o.adsMsg.pcrName,o.addressStreet=o.adsDefMsgInfo.substring(o.addressNum+1),o.addressRegName=o.adsMsg.pcrName.substring(o.addressNum,-1),o.addressRegionName=o.addressRegName,o.productDefaultAddress={provinceId:o.adsMsg.provinceId,cityId:o.adsMsg.cityId,areaId:o.adsMsg.regionId,streetId:o.adsMsg.streetId,regionName:o.addressRegName+" "+o.addressStreet,streetText:o.addressRegName},a.getLocationList(o.adsMsg.regionId,o.adsMsg.provinceId).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})):(o.defaultOrchange=!0,o.isChangeOrDefault=2,o.productDefaultAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsgChange=JSON.parse(i.addressStr),o.productChangeAddress={provinceId:o.adsMsgChange["value-1"],cityId:o.adsMsgChange["value-2"],areaId:o.adsMsgChange["value-3"],streetId:o.adsMsgChange["value-4"],regionName:o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"]+" "+o.adsMsgChange["text-4"]},o.addressStreet=o.adsMsgChange["text-4"],o.addressRegionName=o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"],a.getLocationList(o.adsMsgChange["value-3"],o.adsMsgChange["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")}))},o.$on("$ionicView.beforeEnter",function(){o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.commonGoBack=function(){t.confirm({template:"您当前信息未保存，是否保存信息？",cancelText:"离开",okText:"留在此页面"}).then(function(e){e||(o.panGoOn=!1,o.addressRegionName="所在地区",o.$ionicGoBack())})},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"");var t=l.viewHistory().backView;t&&"address"==t.stateName&&t.stateParams&&t.stateParams&&"YES"==t.stateParams.comeFromOrder&&(e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address?o.commonGoBack():l.goBack()}),e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&"所在地区"!=o.addressRegionName&&"街道"!=o.addressStreet?o.commonGoBack():l.goBack()}},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.setDefault=function(){0==o.defaultHide?(o.address.isDefault="0",o.defaultHide=!0):(o.address.isDefault="1",o.defaultHide=!1)},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,s,i){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=i,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,a.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var $=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<o.nowLevelIndex.length;s++)s>o.nowLevel&&(o.nowLevelIndex[s]=-1);o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",a.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.level=o.levelArea,a.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,a.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if($)return;c(function(){$=!1},1500),i.$broadcast(o.flag,o.defaultValue),$=!0,o.closeAddressModal()}},300),o.getPosition=function(){if("定位中···"!=i.globalConstant.autoPosition){v=n.getAddressInfo();var e=v.regionName+"/"+v.streetName;a.addAddress(v.provinceId,v.cityId,v.areaId,e,v.streetId).success(function(){var e={"text-1":v.provinceName,"text-2":v.cityName,"text-3":v.regionName,"text-4":v.streetName,"value-1":v.provinceId,"value-2":v.cityId,"value-3":v.areaId,"value-4":v.streetId};a.getLocationList(v.areaId,3).success(function(e){o.dataAddStreet=e.data;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.positionAddress={provinceId:v.provinceId,cityId:v.cityId,areaId:v.areaId,streetId:0,pca:v.provinceName+" "+v.cityName+" "+v.regionName,regionName:""},o.isPosition=!0,i.$broadcast(o.flag,e),o.streetTextColor="color-text-s",o.addressModal.hide()})}},p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),p.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.fromOrder;var e=l.viewHistory().backView;e&&"address"==e.stateName&&e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&(o.fromOrder=!0),o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.fromOrder?o.isPosition?o.positionCommonFun():o.defaultOrchange&&1==o.isChangeOrDefault?(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.regionName):3==o.isChangeOrDefault?(o.newAddAddress(),!o.regionTrue&&o.isDef&&(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.streetText+" "+o.addressStreet)):o.defaultOrchange&&2==o.isChangeOrDefault?(o.address.provinceId=o.productChangeAddress.provinceId,o.address.cityId=o.productChangeAddress.cityId,o.address.areaId=o.productChangeAddress.areaId,o.address.streetId=o.productChangeAddress.streetId,o.address.regionName=o.productChangeAddress.regionName):4==o.isChangeOrDefault&&o.newAddAddress():o.isPosition?o.positionCommonFun():o.newAddAddress(),a.doInit(o.address).success(function(e,t,s,a){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",i.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},i.addressStr=void 0,o.isChangeOrDefault=0,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,o.fromOrder?o.$ionicGoBack(-2):o.$ionicGoBack()):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):o.globalConstant.mobileNumberRegExp.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+" "+o.addressStreet+" "+o.address.address,e.getLocation(o.allAddress,function(s,i){if("complete"==s&&i.geocodes.length){var a=i.geocodes[0].location.lat,n=i.geocodes[0].location.lng,r=[n,a];e.getAddress(r,function(e,s){if("complete"===e&&"OK"===s.info){o.township=s.regeocode.addressComponent.township,o.addressStreet=o.township;for(var i=[],a=[],i=o.dataAddStreet,n=0;n<i.length;n++)if(a.push(i[n].text),-1!=a.indexOf(o.township)){var r=a.indexOf(o.township);o.isNotDistinguish=!0,o.addChangeAddress.streetId=i[r].value,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=i[r].value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet}else o.isNotDistinguish=!1;if(o.isNotDistinguish){t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},i.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("ADDADDRESSService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={co:o.consignee,pi:o.provinceId,ci:o.cityId,ri:o.areaId,si:o.streetId,rn:o.regionName,mo:o.mobile,ar:o.address,de:o.isDefault,zc:"",ph:""};return e({method:"POST",url:t.getUrl("ADDADDRESS_INIT"),data:s})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("AddPrizeAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","AddressPrizeService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var f=window.innerHeight,h=f-373+"px";o.contentHeight={height:h};var v=f-250+"px";o.contentHeightStreet={height:v},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={},o.init=function(){o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn?(o.addressRegionName="所在地区",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s"):(o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree),o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.$on("$ionicView.beforeEnter",function(){o.gameId=s.gameId,o.uuid=s.uuid,o.prizeId=s.prizeId,o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"")},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,s,i){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=i,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,a.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),
0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var $=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<o.nowLevelIndex.length;s++)s>o.nowLevel&&(o.nowLevelIndex[s]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",a.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,a.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,a.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if($)return;c(function(){$=!1},1500),i.$broadcast(o.flag,o.defaultValue),$=!0,o.closeAddressModal()}},300),p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),p.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.isPosition?o.positionCommonFun():o.newAddAddress(),a.doInit(o.address,o.gameId,o.uuid,o.prizeId).success(function(e,t,s,a){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",i.addressStr=void 0,o.isChangeOrDefault=0,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,r.showToast("添加成功"),setTimeout(function(){o.$ionicGoBack()},1e3)):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+o.address.address,e.getLocation(o.allAddress,function(s,i){if("complete"==s&&i.geocodes.length){var a=i.geocodes[0].location.lat,n=i.geocodes[0].location.lng,r=[n,a];e.getAddress(r,function(e,s){if("complete"===e&&"OK"===s.info){var i=s.regeocode.addressComponent;o.textThree==i.district?m.getAddressId(i.province,i.city,i.district,i.township,i.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){o.township=i.township,o.addressStreet=o.township,o.addChangeAddress.streetId=e.data.streetId,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=e.data.streetId,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet;t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}).error(function(e){o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}):o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},i.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("AddressPrizeService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a){var n={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,regionId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,gameId:s,uuid:i,prizeId:a};return e({method:"POST",url:t.getGameUrl("GAME_HAVE_PRIZE"),params:n})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)}}]),APP.controller("AddressController",["$ionicHistory","$ionicPopup","ChangeAddressService","$scope","AddressService","$state","$stateParams","$timeout","PopupService","$rootScope","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d){s.image=[],s.keywords={keyword:""},s.addressMap=[],s.myData=[],s.updateResult=!0,s.updateContent="",s.goBack=function(){e.goBack()},s.init=function(){i.getAddressList(void 0).success(function(e,t,o,i){if(e.success){s.myData=e.data,0==s.myData.length?s.iosStyleOne={backgroundColor:"#fff"}:s.iosStyleOne={};for(var a=0,n=[],r=!1,c=0;c<e.data.length;c++)if("1"==e.data[c].de){a=c,r=!0;break}n[0]=e.data[a];for(var l=0;l<a;l++)n[l+1]=e.data[l];for(var d=a+1;d<e.data.length;d++)n[d]=e.data[d];s.addressMap=n;for(var p=0;p<s.addressMap.length;p++)s.image[p]="img/ic_check.png";r&&(s.image[0]="img/ic_select.png")}})},s.setDefault=function(e){var t=s.addressMap[e];o.setDefaultAddr(t.id).success(function(e,t,o,i){1==e.success?s.init():s.showResult("修改失败")})},s.searchDataList=function(){if(0==s.keywords.keyword.length)return void c.showToast("请输入要搜索的关键字");i.getAddressList(s.keywords.keyword).success(function(e,t,o,i){if(e.success){s.myData=e.data,0==s.myData.length?s.iosStyleOne={backgroundColor:"#fff"}:s.iosStyleOne={};for(var a=0,n=[],r=!1,c=0;c<e.data.length;c++)if("1"==e.data[c].de){a=c,r=!0;break}n[0]=e.data[a];for(var l=0;l<a;l++)n[l+1]=e.data[l];for(var d=a+1;d<e.data.length;d++)n[d]=e.data[d];s.addressMap=n;for(var p=0;p<s.addressMap.length;p++)s.image[p]="img/ic_check.png";r&&(s.image[0]="img/ic_select.png")}})},s.cleanSearchData=function(){s.keywords.keyword="",s.init()},s.$on("$ionicView.beforeEnter",function(){d.scrollTop(),s.keywords.keyword="",window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?s.isIosAndInApp=!0:s.isIosAndInApp=!1,window.cordova?s.isApp=!0:s.isApp=!1,s.isApp?s.bottomDivHeight={height:"40px"}:s.bottomDivHeight={height:"120px"},s.init()}),s.goToChange=function(e){var t=JSON.stringify(s.addressMap[e]);a.go("changeAddress",{addressData:t})},s.goToDelete=function(e){t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(t){if(t){var o=s.addressMap[e].id;i.deleteAddr(o).success(function(e,t,o,i){e.success?(c.showToast("删除成功"),setTimeout(function(){s.init()},1e3)):c.showToast("删除失败")})}})},s.goToConfirm=function(e){"YES"==n.comeFromOrder&&i.chooseLocation(e.id).success(function(e,t,o,i){1==e.success?s.$ionicGoBack():c.showToast("更改收货物地址失败,请重新选择")})}}]),APP.service("AddressService",["$http","UrlService",function(e,t){this.getAddressList=function(o){var s={k:o};return e({method:"POST",url:t.getUrl("ADDRESS_INIT"),params:s})},this.deleteAddr=function(o){return e({method:"POST",url:t.getUrl("DETELEADDR_INIT"),params:{m:o}})},this.chooseLocation=function(o){var s={address:o};return e({method:"POST",url:t.getUrl("CHOOSE_ADDR"),params:s})}}]),APP.controller("BatchDeleteAddressController",["BatchAddressService","$ionicHistory","$ionicPopup","$scope","PopupService","$rootScope",function(e,t,o,s,i,a){s.goBack=function(){t.goBack()},s.init=function(){s.image=[],s.chooseAddressNum=0,e.getAddressList().success(function(e,t,o,i){if(e.success){s.addressArray=e.data;for(var a=0,n=s.addressArray.length;a<n;a++)s.image[a]="img/ic_check.png"}})},s.selectDeleteAddress=function(e){-1!=s.image[e].indexOf("check")?(s.image[e]="img/ic_select.png",s.chooseAddressNum++):(s.image[e]="img/ic_check.png",s.chooseAddressNum--),s.chooseAddressNum==s.image.length?s.isSelectAllAddress=!0:s.isSelectAllAddress=!1},s.selectAllAddress=function(){if(s.isSelectAllAddress){for(var e=0,t=s.addressArray.length;e<t;e++)s.image[e]="img/ic_check.png";s.chooseAddressNum=0,s.isSelectAllAddress=!1}else{for(var e=0,t=s.addressArray.length;e<t;e++)s.image[e]="img/ic_select.png";s.isSelectAllAddress=!0,s.chooseAddressNum=s.image.length}},s.batchDelete=function(){if(0==s.chooseAddressNum)return void i.showToast("请选择要删除的地址");o.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){if(o){for(var i="",a=[],n=0,r=s.image.length;n<r;n++)-1!=s.image[n].indexOf("select")&&a.push(s.addressArray[n].id);i=a.join(",");var c={m:i};e.batchDelete(c).success(function(e){if(e.success){if(s.isSelectAllAddress)return void t.goBack();s.init()}})}})},s.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?s.isIosAndInApp=!0:s.isIosAndInApp=!1,window.cordova?s.isApp=!0:s.isApp=!1,s.isIosAndInApp&&(s.iosStyleOne={padding:"64px 0 90px 0"},s.iosStyleTwo={top:"20px"}),s.isApp?s.bottomDivHeight={height:"40px"}:s.bottomDivHeight={height:"120px"},s.chooseAddressNum=0,s.isSelectAllAddress=!1,s.init()})}]),APP.service("BatchAddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e({method:"POST",url:t.getUrl("ADDRESS_INIT")})},this.batchDelete=function(o){return e({method:"POST",url:t.getUrl("BATCH_DELETE_ADDRESS"),params:o})}}]),APP.controller("ChangeAddressController",["$scope","$stateParams","$rootScope","ChangeAddressService","CommonAddressService","GoodsService","PopupService","$timeout","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d){var p=JSON.parse(t.addressData);e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.address={acceptor:p.co,mobile:p.mo,detailAds:p.ar,regionName:p.rn,addrId:p.id,provinceId:p.pi,cityId:p.ci,areaId:p.ri,streetId:p.si},e.panGoOn=!1,e.updateResult=!0,e.updateContent="";var u=window.innerHeight,g=u-373+"px";e.contentHeight={height:g},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION",e.defaultValue=null,e.level=0;var m,f,h={};e.panGoOn=!1,e.updateResult=!0,e.updateContent="",e.init=function(){var o=JSON.parse(t.addressData);0==e.panGoOn?e.address={acceptor:o.co,mobile:o.mo,detailAds:o.ar,regionName:o.rn,addrId:o.id,provinceId:o.pi,cityId:o.ci,areaId:o.ri,streetId:o.si}:e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree+" "+e.textFour,e.panGoOn=!1},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&d.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.init(),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.setDefault=function(){s.setDefaultAddr(e.address.addrId).success(function(t,o,s,i){1==t.success?e.$ionicGoBack():e.showResult("修改失败")})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,d.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var r=0;r<e.nowLevelIndex.length;r++)r>e.nowLevel&&(e.nowLevelIndex[r]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",a.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){n.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var v=!1;e.goSelect=ionic.Utils.debounce(function(t,s){for(var i=0;i<e.nowLevelIndex.length;i++)i>e.nowLevel&&(e.nowLevelIndex[i]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=t;var s=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=d.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){1==ah&&(f=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){n.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(f,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,d.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){n.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=d.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=d.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(m=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){n.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(m,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),d.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){n.showToast("获取地址信息失败！")})};else{if(v)return;r(function(){v=!1},1500),o.$broadcast(e.flag,e.defaultValue),v=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=o.globalConstant.autoPosition){h=i.getAddressInfo();var t=h.regionName+"/"+h.streetName;s.addAddress(h.provinceId,h.cityId,h.areaId,t,h.streetId).success(function(){var t={"text-1":h.provinceName,"text-2":h.cityName,"text-3":h.regionName,"text-4":h.streetName,"value-1":h.provinceId,"value-2":h.cityId,"value-3":h.areaId,"value-4":h.streetId};o.$broadcast(e.flag,t),e.addressModal.hide()})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.doChange=function(){return""==e.address.acceptor?void n.showToast("收货人不能为空"):e.address.acceptor.length>10||e.address.acceptor.length<2?void n.showToast("收货人为2-10个字符"):""==e.address.mobile?void n.showToast("手机号码不能为空"):e.globalConstant.mobileNumberRegExp.exec(e.address.mobile)?"所在区域"==e.address.regionName?void n.showToast("请选择所在区域"):/^.[^&<>]{2,29}$/.exec(e.address.detailAds)?void s.changeAddr(e.address).success(function(t,o,s,i){t.success?e.$ionicGoBack():e.showResult("修改失败")}):void n.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void n.showToast("手机号码不正确")},o.$on("CHANGEADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.address.provinceId=o["value-1"],e.address.cityId=o["value-2"],e.address.areaId=o["value-3"],e.address.streetId=o["value-4"],e.init()}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,r(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeAddressService",["$http","UrlService",function(e,t){this.changeAddr=function(o){var s={id:o.addrId,co:o.acceptor,mo:o.mobile,rn:o.regionName,pi:o.provinceId,ci:o.cityId,ri:o.areaId,si:o.streetId,ar:o.detailAds,zc:"",ph:""};return e({method:"POST",url:t.getUrl("CHANGEADDR_INIT"),data:s})},this.setDefaultAddr=function(o){var s={m:o};return e({method:"POST",url:t.getUrl("SETDEFAULT_INIT"),params:s})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("BankCardController",["$localstorage","$scope","HomePageService","$ionicHistory","InAppBrowserService","UrlService","$state","bankCardService","$ionicScrollDelegate","EasyConnectService",function(e,t,o,s,i,a,n,r,c,l){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){null==s.viewHistory().backView?n.go("personnalCenter"):"shopRevenue"==s.viewHistory().backView.stateName||"paymentxyz"==s.viewHistory().backView.stateName?s.goBack():n.go("personnalCenter")},t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.clickBind=function(){if(!window.device)return void window.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.bind().success(function(o,s,n,r){if(window.device&&window.device.hasNewBrowser){var c=ionic.Platform.isAndroid();if(c){var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}else{var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}else{var c=ionic.Platform.isAndroid();if(c){var d=cordova.InAppBrowser.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");d.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){d.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),d.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&d.close()}),d.addEventListener("exit",function(e){t.init()})}else{var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}})},t.init=function(){o.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?t.iso2o=!0:t.iso2o=!1}),r.doInit().success(function(e){e.success&&(0==e.data.isBindKJT?t.isBindKjt=!0:t.isBindKjt=!1,0==e.data.isBindYHK?t.isBindBank=!0:t.isBindBank=!1,t.hasBindKJT=e.data.isBindKJT,t.hasBindYHK=e.data.isBindYHK,t.backGroundOrImg=e.data.BankCardList,t.backGroundOrKjt=e.data.kjtAccount)})},t.$on("$ionicView.beforeEnter",function(){c.scrollTop(),t.backGroundOrKjt="",t.backGroundOrImg="",t.isBindKjt=!1,t.isBindBank=!1,t.init()})}]),APP.service("bankCardService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("HAS_BANK_LIST_NEW"))}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("bankCardDetailController",["$localstorage","$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","bankCardDetialService","$state","UrlService","EasyConnectService","InAppBrowserService","PopupService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p,u){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){r.go("bankCard")};var g="";t.nameKjt="",t.isKJT=!1,t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.VCodeTips="获取验证码",t.canGetVcode=!0,t.userInfo={verificationCode:""},t.getVCode=function(){t.canGetVcode&&n.fastLoginCaptchaNew(g).success(function(e){if(e.success){p.showToast("您正在操作解绑银行卡，短信验证码已经发送到您绑定银行卡时的预留银行手机号"+t.bankCardDetailList.phoneNo+"中，请查收并进行验证。"),t.canGetVcode=!t.canGetVcode;var o=60;t.timer=u(function(){o-1<0?(t.VCodeTips="获取验证码",u.cancel(t.timer),t.canGetVcode=!0):(o--,t.VCodeTips=o+"s后可重发 ")},1e3)}else p.showToast(e.message)})},t.unBindBank=function(){if(t.userInfo.verificationCode.length<=0)p.showToast("请输入短信验证码");else{s.confirm({template:"确认解除绑定该银行卡?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){e&&n.deleteBank(g,t.userInfo.verificationCode).success(function(e){e.success?(p.showToast("您的银行卡已经解绑成功！"),setTimeout(function(){r.go("bankCard")},2e3)):p.showToast(e.message)})})}},t.clickUnBind=function(){if(!window.device)return void window.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.unBlind().success(function(t,o,s,i){var a=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(a){var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=ionic.Platform.isAndroid();if(a){var l=cordova.InAppBrowser.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");l.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&$timeout(function(){l.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),l.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&l.close()}),l.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}}})},t.init=function(){n.doInit(g).success(function(e){e.success&&(t.bankCardDetailList=e.data)})},t.$on("$ionicView.beforeEnter",function(){i.scrollTop(),g="",t.nameKjt="",t.bankCardDetailList,g=a.cardNoShow,t.nameKjt=a.nameKjt,""!=t.nameKjt?(t.isKJT=!0,t.bankCardDetailList=g):(t.isKJT=!1,t.init())})}]),APP.service("bankCardDetialService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={cardNo:o};return e.get(t.getUrl("BANK_LIST_DETAIL_NEW"),s)},this.deleteBank=function(o,s){var i={cardNo:o,captcha:s};return e.get(t.getUrl("BANK_DELETE_NEW"),i)},this.fastLoginCaptchaNew=function(o){var s={cardNo:o};return e.get(t.getUrl("BANK_DELETE_CAPTCHA"),s)}}]),APP.controller("bankSupportController",["$scope","$ionicHistory","$ionicPopup",function(e,t,o){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",
code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}]}]),APP.controller("chooseTheBankController",["$scope","$ionicHistory","$ionicPopup","$state","$rootScope",function(e,t,o,s,i){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.differentStyleHas=-1,e.differentStyle={background:"#eee"},e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}],e.chooseBank=function(o,s,a){e.differentStyleHas=o,i.$broadcast("haveChooseBank",o,s,a),t.goBack()}}]),APP.controller("mentionCenterController",["$rootScope","$ionicPopup","$localstorage","$scope","HomePageService","$ionicHistory","bankCardService","mentionCenterService","$stateParams","$state","ShopRevenueService","EasyConnectService","UrlService","InAppBrowserService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){d.getAccountState(e).success(function(e){e.success&&(accountState=e.data)})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"margin-top":"16px"},s.paddingtopClasscontent={top:"60px"}):(s.paddingtopClass={"margin-top":"0px"},s.paddingtopClasscontent={top:"44px"}),s.matchValue=0,s.account="",s.goBack=function(){null==a.viewHistory().backView?l.go("personnalCenter"):a.goBack()},s.backGroundOrPic={"03020000":{img:"1CITIC"},"01030000":{img:"2ABC"},"01020000":{img:"3ICBC"},"01050000":{img:"4CCB"},"03080000":{img:"5CMB"},"03180000":{img:"6SZPAB"},"01040000":{img:"7BOC"},"03090000":{img:"8CIB"},"03100000":{img:"9SPDB"},"03050000":{img:"10CMBC"},"03040000":{img:"11HXB"},"03030000":{img:"12CEB"},"01000000":{img:"13PSBC"},"03010000":{img:"14COMM"},"04031000":{img:"15BCCB"},"03060000":{img:"16GDB"},"03110000":{img:"17EGBANK"},"04233310":{img:"18HCCB"},"04083320":{img:"19NBCB"},88888888:{img:"20KJT"}},s.clickBank=function(e){s.matchValue=e},s.getCashNow=function(){r.getCash(s.backGroundOrKjt.memberKjtpayAccount,"KJT").success(function(e,o,s,i){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var a=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});a.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},s.withdraw=function(){if(2==accountState){var e="提现需要绑定快捷通，请点击确定去绑定快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.bind().success(function(e,t,i,a){if(window.device&&window.device.hasNewBrowser){var n=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){s.init()})}else{if(ionic.Platform.isAndroid()){var r=cordova.InAppBrowser.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");r.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){r.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),r.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&r.close()}),r.addEventListener("exit",function(e){s.init()})}else{var n=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){s.init()})}}})}})}else if(3==accountState)s.getCashNow();else if(4==accountState){var e="提现需要实名认证快捷通，请点击确定去认证快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.realName().success(function(e,t,i,a){g.open(u.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){s.init()})})}})}else if(1==accountState){var e="提现需要激活快捷通，请点击确定去激活快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.activation().success(function(e,t,i,a){g.open(u.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){s.init()})})}})}},s.clickBind=function(){if(!window.device)return void window.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");p.bind().success(function(e,t,i,a){if(window.device&&window.device.hasNewBrowser){var n=ionic.Platform.isAndroid();if(n){var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}else{var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}}else{var n=ionic.Platform.isAndroid();if(n){var c=cordova.InAppBrowser.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");c.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){c.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),c.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&c.close()}),c.addEventListener("exit",function(e){s.init()})}else{var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}}})},s.mentionCenterBankNow=function(){r.getCash(s.backGroundOrImg.cardNoShow,"YHK").success(function(e,o,s,i){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var a=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});a.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},s.init=function(){f(s.earningType),i.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?s.iso2o=!0:s.iso2o=!1}),n.doInit().success(function(e){e.success&&(s.hasBindKJT=e.data.isBindKJT,s.hasBindYHK=e.data.isBindYHK,s.backGroundOrImg=e.data.BankCardList,s.backGroundOrKjt=e.data.kjtAccount,s.hasBindYHK&&s.moneyHundred&&(s.matchValue=1))})},s.$on("$ionicView.beforeEnter",function(){s.earningType="B",s.account="",s.backGroundOrImg="",s.backGroundOrKjt="",s.canGetMount="",s.canGetMount=c.canAmount,e.canGetMount=c.canAmount,parseInt(s.canGetMount)>0?s.moneyNoone=!0:s.moneyNoone=!1,parseInt(s.canGetMount)>=1e3?s.moneyHundred=!0:s.moneyHundred=!1,s.hasBindKJT=!1,s.hasBindYHK=!1,s.init()})}]),APP.service("mentionCenterService",["$http","UrlService",function(e,t){this.getCash=function(o,s){var i={kjtAccount:o,paymentType:s};return e.get(t.getUrl("GETCASH_INIT"),i)}}]),APP.controller("historyTaskController",["$scope","$stateParams","ShareService",function(e,t,o){function s(e){for(var t in e)return!1;return!0}e.history="",e.isHistory=!1,e.loadData=function(){o.myHistoryShare().success(function(t){e.history=t.data,s(e.history)&&(e.isHistory=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.isHistory=!1}),e.$on("$ionicView.enter",function(){e.loadData()})}]),APP.controller("MissionDetailController",["$q","$scope","UrlService","MissionDetailService","PopupService","$rootScope","$stateParams","CreditService","UserService",function(e,t,o,s,i,a,n,r,c){function l(t){var o=e.defer();return s.getQrCodeUrl(t).success(function(e){o.resolve(e.data)}),o.promise}function d(e,i,n){var r=t.missionContent.taskDestWithStatusVOs[0].id,l=c.getUser().mid,d=t.name,p=t.editableContent||t.editContent,u=(t.checkImg,t.imgArr&&t.imgArr.length>0?t.imgArr[0]:null);if(window.umeng){if(window.cordova&&cordova.plugins.clipboard.copy(p),-1==e&&window.umeng.iosPlatformShared(d,p,u,[u],0,n,function(){}),4==t.taskType){var g=t.configData.linkUrl;null==u&&(u="http://www.ehaier.com/mstatic/wd/v2/img/icons/ic_default_avatar.png"),0==e?window.umeng.shareToSina(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,p,u,g,0,null,function(){s.missionShare(t.taskType,"QQ").success(function(){t.init()})}):4==e&&window.umeng.shareToQzone(d,p,u,g,0,null,function(){s.missionShare(t.taskType,"QQ空间").success(function(){t.init()})})}else if(3==t.taskType){var m=t.configData.productTitle||t.configData.productName,f=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+l+"/"+l;0==e?window.umeng.shareToSina(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"QQ").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"QQ空间").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})})}else 0==e?window.umeng.shareToSina(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"QQ").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(d,p,u,null,2);t.showShare=!1}else alert("umeng undefined 只能在app分享")}t.hasQQ=!1,t.isIOS=ionic.Platform.isIOS(),t.UserTaskStatus=null,t.needTake="",t.hideblackCover=function(){t.showShare=!1},t.savaEditContent=function(e){t.editableContent=e},t.goBack=function(){t.$ionicGoBack()},t.output=function(e){},t.copyLinkUrl=function(){window.cordova?(cordova.plugins.clipboard.copy(t.linkUrl),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},t.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastWithTime("复制成功",2e3)):i.showToast("请下载APP执行此操作")},t.share=function(){if(window.umeng){if(window.cordova&&(cordova.plugins.clipboard.copy(t.editContent),a.hasShowPasteHint||(i.showToastWithTime("请直接粘贴分享文字内容",2e3),a.hasShowPasteHint=!0)),window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else if(window.umeng){if(!t.missionContent)return void t.showPopup("网络连接失败，请稍后分享");var e=t.name,s=t.editContent,n=(t.checkImg,t.imgArr[0]),r=o.getShareLinkHeader()+"missionDetail/"+t.taskId;window.cordova&&cordova.plugins.clipboard.copy(s),window.umeng.share(e,s,n,r,2)}}else i.showAlert("只能在app分享","抱歉，只能在app分享")},t.shareToPlatform=function(e,s){var i=null,a="",n=c.getUser().mid;1==t.configData.qrcodeType||void 0==t.configData.qrcodeType?(i=t.missionContent.resultMap.qrCode,d(e,s,i)):2==t.configData.qrcodeType?(a=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+n+"/"+n,l(escape(a)).then(function(t){i=t,d(e,s,i)})):3==t.configData.qrcodeType?(a=o.getShareLinkHeader()+"register/0/"+t.missionContent.resultMap.promotionCode,l(escape(a)).then(function(t){i=t,d(e,s,i)})):0==t.configData.qrcodeType?d(e,s,null):d(e,s)},t.init=function(){s.getMissionDetail(t.taskId).success(function(e){e.success&&(t.UserTaskStatus=e.data.taskInfoWithStatusVO.userTaskStatus,t.needTake=e.data.taskInfoWithStatusVO.needTake,t.missionContent=e.data,t.xyzTaskDestId=t.missionContent.taskDestWithStatusVOs[0].id,t.name=t.missionContent.taskInfoWithStatusVO.name,t.taskType=t.missionContent.taskInfoWithStatusVO.taskType,t.isFinished=t.missionContent.taskInfoWithStatusVO.isFinished,t.configDataStr=t.missionContent.taskInfoWithStatusVO.configData,t.configData=JSON.parse(t.configDataStr),t.missionTitleArr=["","早安","晚安","分享商品","分享链接","士兵突击","图片分享","晒战绩"],t.missionTitle=t.missionTitleArr[t.taskType],t.time=new Date,t.editContent=t.missionContent.taskInfoWithStatusVO.content,t.taskAwards=t.missionContent.taskInfoWithStatusVO.taskAwards[0],0==t.taskAwards.awardType?t.taskAwardsContent=t.taskAwards.awardNum+"金币":1==t.taskAwards.awardType&&(t.taskAwardsContent=t.taskAwards.awardNum+"积分"),t.configData.imageUrls&&(t.imgArr=t.configData.imageUrls),t.configData.productName&&(t.productName=t.configData.productName),t.configData.linkUrl&&(t.linkUrl=t.configData.linkUrl))}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.taskId=n.taskId,t.checkImgIndex=[],t.checkImh=[],t.init()})}]),APP.service("MissionDetailService",["$http","UrlService","IMService",function(e,t,o){this.getMissionDetail=function(o){var s={taskId:o};return e.get(t.getUrl("MISSION_DETAIL"),s)},this.missionShare=function(s,i,a){var n={taskType:s,taskDestId:i,sharePlatform:a};return o.validateWebSocket(),e.get(t.getUrl("MISSION_SHARE"),n)},this.getQrCodeUrl=function(o){var s={requestUrl:o};return e.get(t.getUrl("GET_QRCODE"),s)}}]),APP.controller("taskShareController",["$scope","$state","ShareService","$rootScope","PopupService","$ionicHistory","UserService",function(e,t,o,s,i,a,n){function r(e){for(var t=[],o=[],s=e.length,i=s-1;i>=0;i--)5==e[i].taskType?o.push(e[i]):e[i].isFinished?t.push(e[i]):t.unshift(e[i]);return o.concat(t)}e.colorStyle1={color:"#030303"},e.colorStyle2={color:"blue"},e.share="";e.loadData=function(){o.myShare(0,100).success(function(t){e.share=r(t.data.rows)}).error(function(){})},e.goBack=function(){e.$ionicGoBack()},e.goShare=function(o,s,i){7==i?t.go("competition",{taskDestId:"",taskType:i,memberId:e.xyzMemberId}):t.go("missionDetail",{taskId:s})},e.shake=function(){alert("lover")},e.$on("$ionicView.enter",function(t,o){"back"==o.direction&&s.shareSucBack?(s.shareSucBack=!1,s.freshMission=!0,s.missionLists=function(){e.loadData()}):e.loadData()}),e.$on("$ionicView.beforeEnter",function(){e.xyzMemberId=n.getUser().mid})}]),APP.service("ShareService",["$http","UrlService",function(e,t){this.myShare=function(o,s){var i={startIndex:o,pageSize:s};return e.get(t.getUrl("SHAER_TASK"),i)},this.myHistoryShare=function(){return e.get(t.getUrl("SHAER_HISTORY_TASK"))}}]),APP.controller("PartnerController",["$ionicHistory","$scope","$state","PartnerService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){function $(e,o,i,a,n,r,c){s.partnerTeamSearch({memberId:e,cascade:o,pageNumber:i,pageSize:a,sort:n,order:r,noLoading:c}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.pageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}function S(e,o,i,a,n,r,c,l){s.anthenSearch({memberId:e,cascade:o,isAuthenticated:i,pageNumber:a,pageSize:n,sort:r,order:c,noLoading:l}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.authenticatedNum=e.data.authenticatedNum,t.UnAuthenticatedNum=e.data.unAuthenticatedNum,t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.authpageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}t.goBack=function(){t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.arrowState=[u.imgBaseURL+"img/Group@2x.png",u.imgBaseURL+"img/Group1@2x.png",u.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["asc","desc"],"asc","asc"],t.title="partner"==d.title?"合伙人":"团队",t.authenIndex=0,t.hasmore=!1,t.front=d.front,t.shareStoreId=d.shareStoreId,t.isBuyer=m.getRole(),t.userId=r.getUser().mid;t.pagesort="startTime",t.order="asc",t.memberId=d.memberId,t.cascade="partner"!=d.title,t.isAuthenticated=!0,t.init=function(){t.pageNumber=1,t.pageSize=10,$(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!1)},t.authInit=function(){t.authpageNumber=1,t.pageSize=10,S(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!1)},t.$on("$ionicView.beforeEnter",function(e,o){f.scrollTop(),t.chooseIndex=0,t.partnerChildren=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=d.memberId,t.init()}),t.loadMore=function(){1==t.chooseIndex?S(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!0):$(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!0)},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e))if(f.scrollTop(),t.page=2,0==e){t.chooseIndex=e;t.openStoreTime_index;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.partnerChildren=[],t.pagesort="startTime",t.order=1==t.openStoreTime_index?"asc":"desc",t.init()}else 1==e?(t.authenIndex=0,t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.partnerChildren=[],t.order=0==t.openStoreTime_index?"asc":"desc",t.pagesort="isAuthenticated",t.isAuthenticated=!0,t.authInit()):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.partnerChildren=[],t.filterParams="saleDesc",t.order=0==t.openStoreTime_index?"desc":"asc",t.pagesort="teamLevelOrder",t.init())},t.chooseAnthen=function(e){0==e?(t.isAuthenticated=!0,t.pagesort="isAuthenticated",t.authenIndex=0,t.partnerChildren=[],t.authInit()):1==e&&(t.isAuthenticated=!1,t.pagesort="isAuthenticated",t.authenIndex=1,t.partnerChildren=[],t.authInit())}}]),APP.service("PartnerService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p){var u={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p};return e.get(t.getUrl("SEARCHGOODS_INIT"),u)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)},this.partnerTeamSearch=function(o){var s=t.getUrl("GET_PARTNER_TEAM");return e.get(s,o)},this.anthenSearch=function(o){var s=t.getUrl("GET_PARTNER_TEAM");return e.get(s,o)}}]),APP.controller("VisiBroHisController",["$http","$scope","$cacheFactory","VisiBroHisService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","storeTeamOwnerService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){t.chooseIndex=0,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.init=function(){t.memberId=l.getUser().mid,t.userId=27483685,t.userId=i.userId,t.daysType=i.daysType,t.hasmore=!1,s.getVisitorBrowHis(t.userId,t.daysType).success(function(e){1==e.success&&(t.productList=e.data),e.data.productsList}).error(function(e){})},t.goBack=function(){t.$ionicGoBack()},t.showPopup=function(e){var t=d.show({template:e});p(function(){t.close()},1e3)},t.$on("$ionicView.beforeLeave",function(e,o){t.watch()}),t.$on("$ionicView.beforeEnter",function(e,o){t.userInfo=I.visitorInfo,t.init(),t.showComprehensiveSub=!1,t.nowLevel=0,t.nowLevelIndex=[-1,-1,-1,-1],t.finish=!1,t.watch=t.$watch("finish",function(e,o){e&&m.$getByHandle("mainScroll").scrollTo(0,t.provinceTop)}),t.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIos1=!0:t.isIos1=!1,t.storeId=v.get("storeId",g.globalConstant.storeId),t.memberId=l.getUser().mid,t.buttonShow=!1,t.page=1,t.hasmore=!1})}]),APP.service("VisiBroHisService",["$http","UrlService",function(e,t){this.getVisitorBrowHis=function(o,s){var i={userId:o,daysType:s};return e.get(t.getUrl("GET_VISI_BROW_HIS"),i)}}]),APP.controller("AccountMessageController",["$scope","AccountMessageService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(t){var o=t[0];if(window.FileReader){var s=new FileReader;s.readAsDataURL(o),s.onloadend=function(t){e.$apply(e.iconImage=t.target.result)}}}e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.sexMap=["保密","男","女"],e.accountMessage="",e.accountName="",e.accountEmail="",e.accountSexValue="0",e.accountSex=e.sexMap[e.accountSexValue],e.accountBirthday="",e.accountNumber="",e.iconImage=o.imgBaseURL+"img/ic_login_user.png",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=n.getUser(),e.sexMap=["保密","男","女"],void 0!=e.user.avatarImageFileId&&(e.iconImage=e.user.avatarImageFileId),e.accountMessage=e.user.userName,e.accountName=e.user.nickName,e.accountSexValue=e.user.gender,e.accountSex=e.sexMap[e.accountSexValue],e.accountEmail=e.user.email,e.accountBirthday=e.user.birthday,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,n.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){s.go("guidePage")},e.changeIcon=function(){if("APP"==c.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(o){function s(o){e.iconImage=o,a(function(){e.iconImage=o},200);var s=function(t){r.hide(),e.showResult("上传成功");var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,n.setUser(e.user)},i=function(t){r.hide(),e.showResult("上传失败")},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),s,i,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function i(e){}function c(o){e.iconImage=o,a(function(){e.iconImage=o},200);var s=function(t){e.showResult("上传成功"),r.hide();var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,n.setUser(e.user)},i=function(t){e.showResult("上传失败"),r.hide()},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),s,i,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function l(e){}1==o?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(c,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,s),a(function(){window.plugins.actionsheet.hide()},5e3)}else{d.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},e.$watch("userInfo.picTempFile",function(){e.userInfo&&e.userInfo.picTempFile&&e.userInfo.picTempFile.length>0&&g(e.userInfo.picTempFile)},!1),e.unload=function(){void 0==e.user.sessionValue?(n.clearUser(),p.setRole(void 0),e.goGuidePage(),window.localStorage.setItem("isLogin",n.isUserLogin()),u.set("storeId","")):t.unloadAccount(e.accountToken,e.accountSessionId,e.accountHeaderKey).success(function(t,o,s,i){if(t.success){n.clearUser(),e.goGuidePage(),p.setRole(void 0);var a="Bearer"+t.data;window.localStorage.setItem("sg_login_token_secret",a),window.localStorage.setItem("isLogin",n.isUserLogin()),u.set("storeId","")}})},e.goToDelete=function(){d.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.unload()})},e.selectDate=function(){if("APP"==c.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){a(function(){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),t.changeMessage(e.accountMessage,a+"-"+i+"-"+s,e.accountSexValue,e.accountName).success(function(t,o,r,c){t.success?(e.accountBirthday=a+"-"+i+"-"+s,e.user.birthday=a+"-"+i+"-"+s,n.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i);var a=new Date(o).getFullYear()+"-"+s+"-"+i;t.changeMessage(e.accountMessage,a,e.accountSexValue,e.accountName).success(function(t,o,s,i){t.success?(e.accountBirthday=a,e.user.birthday=a,n.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})}};l.openDatePicker(s)}},o.$on("SELECT_SEX",function(t,o){e.accountSexValue=o,e.accountSex=e.sexMap[e.accountSexValue],e.user.gender=o,n.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_NAME",function(t,o){e.accountName=o,e.user.nickName=o,n.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,n.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){e.$ionicGoBack()},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("AccountMessageService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,s,i){var a=o,n="Bearer "+i+" "+a,r={Authorization:n},c={sessionId:s};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("ChangeEmailController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeEmailService",function(e,t,o,s,i,a,n){e.email={value:t.email},e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName,e.updateResult=!0,e.updateContent="",e.init=function(){e.email={value:t.email},e.gender=t.gender|JSON.parse(window.localStorage.USER_CACHE_KEY).gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){var t=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;return e.email.value?t.exec(e.email.value)?void n.changeEmail(e.userName,e.birthday,e.gender,e.nickName,e.email.value).success(function(t,s,i,n){t.success?(o.$broadcast("CHANGE_EMAIL",e.email.value),a.go("accsafe")):t.message?e.showResult(t.message):e.showResult("未知异常")}):void s.showToast("电子邮箱输入不规范"):void s.showToast("您输入的邮箱不能为空")},e.goBack=function(){a.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeEmailService",["$http","UrlService",function(e,t){this.changeEmail=function(o,s,i,a,n){var r={userName:o,birthday:s,gender:i,nickName:a,email:n};return e({method:"POST",url:t.getUrl("UPDATE_EMAIL"),params:r})}}]),APP.controller("ChangeNameController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeNameService",function(e,t,o,s,i,a,n){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){if(!e.name.value)return void s.showToast("您输入的昵称不能为空");n.changeMessage(e.userName,e.birthday,e.gender,e.name.value).success(function(t,s,i,n){t.success?(o.$broadcast("CHANGE_NAME",e.name.value),a.go("accsetting")):t.message?e.showResult(t.message):e.showResult("未知异常")})},e.goBack=function(){
a.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeNameService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("ChangePasswordController",["$scope","ChangePassWordService","PopupService","$timeout","$state","UserService",function(e,t,o,s,i,a){e.user="",e.password={oldWord:"",newWord:"",makeSureWord:""},e.accountMessage="",e.accountToken="",e.updateContent="",e.updateResult=!0,e.init=function(){e.user=a.getUser(),e.accountMessage=e.user.userName,e.accountToken=e.user.token,e.password={oldWord:"",newWord:"",makeSureWord:""}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goLoginPage=function(){i.go("login")},e.doChange=function(){var i=e.globalConstant.passwordRegExp;return e.password.oldWord?e.password.newWord?i.test(e.password.newWord)?e.password.makeSureWord?e.password.makeSureWord!=e.password.newWord?void o.showToast("两次输入的新密码不相同"):void t.doInit(e.accountToken,e.accountMessage,e.password.oldWord,e.password.newWord).success(function(t,o,i,n){t.success?(e.showResult("修改成功"),a.clearUser(),s(function(){e.goLoginPage()},1e3)):e.showResult(t.message)}):void o.showToast("确认密码不能为空"):void o.showToast("新密码不符合规则"):void o.showToast("新密码不能为空"):void o.showToast("原密码不能为空")},e.goBack=function(){i.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangePassWordService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a){var n=o,r={token:n,userName:s,oldPassword:encodeURIComponent(i),password:encodeURIComponent(a)};return e({method:"POST",url:t.getUrl("UPDATEPASSWORD_INIT"),params:r})}}]),APP.controller("SelectSexController",["$scope","$stateParams","$rootScope","$state","SelectSexService","$timeout",function(e,t,o,s,i,a){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doSelect=function(t){e.sex.value=t,i.changeMessage(e.userName,e.birthday,e.sex.value,e.nickName).success(function(s,i,a,n){s.success?(o.$broadcast("SELECT_SEX",t),e.$ionicGoBack()):s.message?e.showResult(s.message):e.showResult("未知异常")})},e.goBack=function(){s.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("SelectSexService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("BuyerCenterController",["$scope","AccountMessageService","$state","UserService","LoginService","PopupService","$stateParams","RegisterService","$rootScope",function(e,t,o,s,i,a,n,r,c){e.isBuyer=i.getRole(),e.shareStoreId=n.shareStoreId,e.init=function(t){var o=s.getUser();o.avatarImageFileId?e.avatarImageFileId=o.avatarImageFileId:e.avatarImageFileId=c.imgBaseURL+"img/ic_person.png",e.mid=o.mid,e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.applyShop=function(){0==e.isBuyer?(r.wdApply().success(function(e){e.success?e.data?o.go("shopApply"):o.go("registerForStore"):a.showToast("服务端错误")}).error(function(){alert("网络错误")}),o.go("shopApply")):e.shareStoreId?o.go("myStore",{storeId:e.mid,shareStoreId:e.shareStoreId}):o.go("myStore",{storeId:e.mid})},e.logOut=function(){void 0==e.sessionId?(s.clearUser(),i.setRole(void 0),o.go("guidePage")):t.unloadAccount(e.token,e.sessionId,e.header).success(function(e,t,a,n){if(e.success){s.clearUser(),i.setRole(void 0),o.go("guidePage");var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r)}})},e.goBack=function(){o.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.isBuyer=i.getRole(),e.init(0)})}]),APP.controller("BindAccountController",["$scope","EasyConnectBindAccountService",function(e,t){e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,s,i){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("EasyConnectBindAccountService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTACCOUNT_INIT"))}}]),APP.controller("BindResultController",["$scope","EasyConnectBindResultService","$rootScope",function(e,t,o){e.iconImage=o.imgBaseURL+"img/ic_person.png",e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,s,i){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("EasyConnectBindResultService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTRESULT_INIT"))}}]),APP.controller("EasyConnectController",["$localstorage","$scope","EasyConnectService","PopupService","$timeout","$state","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r){t.bindData=[],t.account="",t.mobile="",t.updateResult=!0,t.updateContent="",t.init=function(){o.getMessage().success(function(e,o,i,a){e.success?(t.bindData=e.data.kjtAccount,e.data.kjtAccount&&e.data.kjtAccount.status&&"0"==e.data.kjtAccount.status&&(t.account=e.data.kjtAccount.memberRealName,t.mobile=e.data.kjtAccount.memberKjtpayAccount)):e.message?s.showToast(e.message):s.showToast("登录失败！")})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goToAccount=function(){a.go("bindAccount")},t.clickBind=function(){if(!window.device)return void window.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.bind().success(function(o,s,a,c){if(window.device&&window.device.hasNewBrowser){var l=ionic.Platform.isAndroid();if(l){var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}else{var l=ionic.Platform.isAndroid();if(l){var p=cordova.InAppBrowser.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");p.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&i(function(){p.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),p.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&p.close()}),p.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.clickUnBind=function(){if(!window.device)return void window.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.unBlind().success(function(o,s,a,c){var l=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(l){var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var l=ionic.Platform.isAndroid();if(l){var p=cordova.InAppBrowser.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");p.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&i(function(){p.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),p.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&p.close()}),p.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,i(function(){t.updateResult=!0},1e3)},t.goBack=function(){a.go("mine")}}]);APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("EasyConnectIframeController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.controller("ClassifyMessageCenterController",["$localstorage","$timeout","$scope","$rootScope","CLASSIFYMESSAGECRNTERService","$state","UserService","InAppBrowserService","UrlService","$http","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.goBack=function(){o.$ionicGoBack()},o.init=function(){i.getMseeageClassify().success(function(e){null==e.data.orderMesagesList?o.orderMessage="":o.orderMessage=e.data.orderMesagesList.content,o.orderNum=e.data.orderNum,null==e.data.platformMesagesList?o.platformMessage="":o.platformMessage=e.data.platformMesagesList.content,o.platformNum=e.data.platformNum,null==e.data.memberMesagesList?o.memberMessage="":o.memberMessage=e.data.memberMesagesList.content,o.memberNum=e.data.memberNum,null==e.data.communityMesagesList?o.communityMessage="":o.communityMessage=e.data.communityMesagesList.content,o.communityNum=e.data.communityNum,o.orderNum>99?o.orderNumClose="99+":o.orderNumClose=o.orderNum,o.platformNum>99?o.platformNumClose="99+":o.platformNumClose=o.platformNum,o.memberNum>99?o.memberNumClose="99+":o.memberNumClose=o.memberNum,o.communityNum>99?o.communityNumClose="99+":o.communityNumClose=o.communityNum})},o.$on("$ionicView.beforeEnter",function(){o.init()}),o.goMessageList=function(e){o.messageType=e,a.go("messageCenter",{messageType:o.messageType})},o.customerServe=function(){if(window.cordova){var s=ionic.Platform.isAndroid(),i=null;i=s?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&t(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+o.kfTocken);return}}]),APP.service("CLASSIFYMESSAGECRNTERService",["$http","UrlService","$rootScope",function(e,t,o){this.getMseeageClassify=function(){var o={messageType:0};return e.get(t.getUrl("MESSAGE_CLASSIFY"),o)},this.getMseeageClassifyNew=function(o){var s={messageType:o};return e.get(t.getUrl("MESSAGE_CLASSIFY"),s)}}]),APP.controller("DetailMessageCenterController",["$scope","$stateParams",function(e,t){e.htmlContent=t.content,e.title=t.title,e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("MessageCenterController",["$ionicScrollDelegate","$timeout","$scope","$rootScope","$stateParams","MESSAGECENTERService","$state","UserService","InAppBrowserService","UrlService","$http",function(e,t,o,s,i,a,n,r,c,l,d){o.messageMap=[],o.breakLine=[],o.mesType=i.messageType,o.messageList="",o.hasmore=!1,o.page=1,o.size=10;var p,u=1,g="";o.goBack=function(){o.$ionicGoBack()},o.init=function(){p=r.getUser(),e.scrollTop(),a.getMessageList(o.mesType,o.page,o.size).success(function(e){1==o.mesType?(o.messageList=e.data.orderMesagesList,o.count=e.data.orderCount):2==o.mesType?(o.messageList=e.data.memberMesagesList,o.count=e.data.memberCount):3==o.mesType?(o.messageList=e.data.platformMesagesList,o.count=e.data.platformCount):4==o.mesType&&(o.messageList=e.data.communityMesagesList,o.count=e.data.communityCount),g=Math.ceil(o.count/o.size),o.hasmore=!(o.page>=g)})},o.loadMore=function(){var e=o.messageList;u+=1;var t={messageType:o.mesType,page:u,size:o.size};d.get(l.getUrl("MESSAGE_CLASSIFY"),t).success(function(t){1==o.mesType?(o.messageList=e.concat(t.data.orderMesagesList),o.count=t.data.orderCount):2==o.mesType?(o.messageList=e.concat(t.data.memberMesagesList),o.count=t.data.memberCount):3==o.mesType?(o.messageList=e.concat(t.data.platformMesagesList),o.count=t.data.platformCount):4==o.mesType&&(o.messageList=e.concat(t.data.communityMesagesList),o.count=t.data.communityCount),o.hasmore=!(o.count<o.messageList.length),o.$broadcast("scroll.infiniteScrollComplete")})},o.goDetail=function(e){var t={id:e.id};a.checkRead(t).success(function(e){a.unreadMessage()});var s=navigator.userAgent;if(1==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(2==e.type)n.go("shopRevenue");else if(3==e.type||51==e.type)n.go("orderDetail",{orderSn:"",cOrderSn:"",cOrderId:e.relationId});else if(4==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(5==e.type)n.go("orderManage",{orderStatus:4});else if(7==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(601==e.type)e.relationId?n.go("noteDetails",{noteId:e.relationId,isShortStory:1}):n.go("goldRecord");else if(602==e.type)n.go("noteDetails",{noteId:e.relationId,isShortStory:0});else if(603==e.type)e.relationId?n.go("classNoteDetails",{noteId:e.relationId}):n.go("goldRecord");else if(604==e.type)n.go("myFans");else if(0==e.type){var p=r.getUser().mid;n.go("goldRecord")}else if(-3==e.type)n.go("productRated",{productId:e.relationId});else if(-4==e.type){var u=l.getUrl("ORDER_INFO"),g=$.param({orderId:e.relationId});d({method:"POST",url:u,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.success){var t=e.data.data.ordersn;n.go("orderTracking",{orderSn:t})}},function(e){})}else if(-5==e.type){var p=r.getUser().userId;n.go("refundDetail",{orderProductId:e.relationId,memberId:p})}else-6==e.type?n.go("orderManage"):-12==e.type||-11==e.type?n.go("myCouponsList"):-13==e.type||-15==e.type||-21==e.type?n.go("shopRevenue"):-14==e.type?n.go("walletDiamonds"):o.init()},o.readAll=function(){if(!r.getUser().mid)return void alert("用户id不存在");var t={};a.readAllMessage(t).success(function(t){a.unreadMessage(),e.scrollTop(),u=1,o.init()}).error(function(){alert("全部已读操作失败")})},o.$on("$ionicView.beforeEnter",function(t,s){"back"!=s.direction&&(u=1,o.init(),e.scrollTop())})}]),APP.service("MESSAGECENTERService",["$http","UrlService","$rootScope",function(e,t,o){this.msgCenter=function(o){return e.get(t.getUrl("MSG_CENTER"),o)},this.unreadMessage=function(){return e.get(t.getUrl("UNRED_MESSAGE")).success(function(e){o.unreadMessage=e.data})},this.readAllMessage=function(o){return e.get(t.getUrl("READALL"),o)},this.checkRead=function(o){return e.get(t.getUrl("CHECKREAD"),o)},this.getMessageList=function(o,s,i){var a={messageType:o,page:s,size:i};return e.get(t.getUrl("MESSAGE_CLASSIFY"),a)}}]),APP.controller("MyStoreManageController",["$scope","MyStoreManageService","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","MyStoreService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],e.levelStr="",e.userName="",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.init=function(){f.scrollTop(),e.storeId=window.localStorage.storeId,e.showQQ=!1,e.showWeChat=!1,t.mstore().success(function(t){t.success&&(e.userName=t.data,e.levelStr=e.levelArr[t.data.level],e.myStoreInfo={storeName:e.userName.storeName,qrcode:e.userName.qrCode})}),b.getMyStoreInfo("m","http://m.ehaier.com","http://www.ehaier.com/mstatic","http://m.ehaier.com/v2/mstore/sg/entrance.html",e.storeId).success(function(t){e.myStoreInfo=t.data,e.shareInfo=t.data.share,e.avatarImage=t.data.avatarImageFileId})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showShare=!1,e.myStoreInfo="",e.shareInfo={},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=t);var o=e.avatarImage,s=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?window.umeng.share(t,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",o,s,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=o);var s="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",i=e.avatarImage,a=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,T.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,T.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,T.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()),5==t?e.copeText(a):T.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),l.fromTemplateUrl("templates/shop/FilterShop.html",{scope:e,animation:"slide-in-left",backdropClickToClose:!1}).then(function(t){e.filterModal=t}),e.openQrcode=function(){e.qrCodemodal.show()},e.backToStore=function(){e.filterModal.hide()},e.closeModal=function(){e.qrCodemodal.hide()},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.filterModal.remove()}),l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),e.saveQrCode=function(){if("undefined"!=typeof cordova){var t="";t=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var o=encodeURI(e.myStoreInfo.qrcode),s={};(new FileTransfer).download(o,t,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();p.showAlert("","图片已经保存至"+t)}else p.showToast("保存成功")},function(e){p.showToast("保存失败！")},!0,s)}}}]),APP.service("MyStoreManageService",["$http","UrlService",function(e,t){this.mstore=function(){return e.get(t.getUrl("MYSTORE"),{})}}]),APP.controller("MyIdCardAuthenController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyIdCardAuthenService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){var t={realName:e.IdCard.realName,identityNo:e.IdCard.identityNo};r.nameAuth(t).success(function(o){o.data?(e.ToMessage=o.message,i.go("myPhoneBind",t,{reload:!0})):e.ToMessage=o.message})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.isSubMint=!1,e.ToMessage="";var A=/(^\d{18}$)|(^\d{17}(\d|X|x)$)/;e.IdCardKeyup=function(){A.test(e.IdCard.identityNo)?e.isSubMint=!0:e.isSubMint=!1},e.goToPhoneBind=function(){if(e.isIdCardAuthen){if(!e.data.identity.realName)return p.showToast("请输入姓名!"),!1;var t={realName:e.data.identity.realName,identityNo:e.IdCard.identityNo};r.realNameCheck(t).success(function(e){e.data?i.go("myPhoneBind",t,{reload:!0}):p.showToast(e.message)})}else{if(!e.IdCard.realName)return p.showToast("请输入姓名!"),!1;b()}},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?(e.data=t.data,t.data.isAuth?(e.isAuth="1",e.isIdCardAuthen=!0):(e.isAuth="0",e.isIdCardAuthen=!1)):(e.isAuth="-1",e.isIdCardAuthen="",p.showToast("获取用户是否认证异常!"))})},e.$on("$ionicView.beforeEnter",function(t,o){f.scrollTop(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.ToMessage="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.FnisAuth()})}]),APP.service("MyIdCardAuthenService",["$http","UrlService",function(e,t){this.realNameAuth=function(o){return e({method:"POST",url:t.getUrl("REALNAMEAUTH"),params:o})},this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.realNameCheck=function(o){return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:o})},this.nameAuth=function(o){return e.get(t.getUrl("GET_NAMEAUTH"),o)}}]),APP.controller("MyPhoneBindController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.mobile="",e.realName="",e.identityNo="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.phone={phone:""},e.goToPhoneBindSuccess=function(){if(!e.realName)return void p.showToast("非法参数姓名！");if(!e.identityNo)return void p.showToast("非法参数证件号");if(!e.globalConstant.mobileNumberRegExp.test(e.phone.phone))return void p.showToast("非法参数手机号");var t={realName:e.realName,identityNo:e.identityNo,mobile:e.phone.phone};r.PhoneAuth(t).success(function(t){t.data?i.go("myPhoneBindNewCode",{mobile:e.phone.phone,realName:e.realName,identityNo:e.identityNo},{reload:!0}):p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.phone.phone="",f.scrollTop(),t.realName&&t.identityNo&&(e.realName=t.realName,e.identityNo=t.identityNo)})}]),APP.service("MyPhoneBindService",["$http","UrlService",function(e,t){this.PhoneAuth=function(o){return e.get(t.getUrl("GET_PHONEAUTH"),o)}}]),APP.controller("MyPhoneBindNewCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,e.realName=t.realName,e.identityNo=t.identityNo,e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):p.showToast(t.message)})},e.goToIdCard=function(){var t={mobileNum:e.Phone,captcha:e.code.captcha,oldMobileNo:e.oldMobileNo,realName:e.realName,identityNo:e.identityNo};r.changeMobile(t).success(function(t){t.success?i.go("myPhoneBindSuccess",{phone:e.Phone},{reload:!0}):p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2"),e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):p.showToast(t.message)})})}]),APP.controller("MyPhoneBindSuccessController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindSuccessService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.phone="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/myPhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.unload=function(){n.clearUser(),y.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),b.set("storeId",""),i.go("login")},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.phone=t.phone})}]),APP.service("MyPhoneBindSuccessService",["$http","UrlService",function(e,t){}]),APP.controller("MyPhoneCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.opacity=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,e.isAuth="-1",e.userData="",e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.opacity=!0,e.CodePhoneState=2,b()):p.showToast(t.message)})},e.goToIdCard=function(){r.checkMobile(e.code).success(function(t){if(t.success)if(1==e.isAuth){var o={realName:e.userData.identity.realName,identityNo:e.userData.identity.identityNo};i.go("myPhoneBind",o,{reload:!0})}else 0==e.isAuth?i.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):(p.showToast("获取用户是否认证异常!"),e.FnisAuth());else p.showToast(t.message)})},e.MobileIsUnavailable=function(){1==e.isAuth?i.go("myIdCardAuthen",{isAuth:!0},{reload:!0}):0==e.isAuth?i.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):e.FnisAuth()},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?t.data.isAuth?e.isAuth="1":e.isAuth="0":e.isAuth="-1",e.userData=t.data})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.opacity=!1,e.FnisAuth(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2",e.opacity=!0),e.code={captcha:"",mobileNum:e.Phone}})}]),APP.service("MyPhoneCodeService",["$http","UrlService",function(e,t){this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.captchaMobile=function(o){var s={mobileNum:o};return e.get(t.getUrl("CAPTCHAMOBILE"),s)},this.checkMobile=function(o){return e.get(t.getUrl("CHECKMOBILE"),o)},this.changeMobile=function(o){return e({method:"POST",url:t.getUrl("CHANGEMOBILE"),params:o})}}]),
APP.controller("MyPhoneManageController",["$ionicPopup","HomePageService","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneManageService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,v){o.$on("$ionicView.beforeEnter",function(){o.isUser=!1,o.isUsers=function(){t.isWdHost().success(function(t){o.isWdHost=t.data.isHost,null==t.data.o2o||1==t.data.o2o?e.show({template:"尊贵的VIP商户，请前往商户中心修改手机号。",buttons:[{text:"好的，我知道了！",onTap:function(){o.$ionicGoBack()}}]}):1==o.isWdHost?n.go("myPhoneCode"):0==o.isWdHost&&(o.isUser=!0)})},o.goUpgrade=function(){n.go("newAuthenticationHome"),o.isUser=!1},o.closePopup=function(){o.isUser=!1},v.scrollTop(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.isIosApp=!0:o.isIosApp=!1,o.GoBackImgUrl=i.imgBaseURL+"img/addressBack@2x.png",o.ResultImgUrl=i.imgBaseURL+"img/PhoneManage@2x.png",o.storeId=window.localStorage.storeId,o.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),o.Phone=o.USER_CACHE_KEY.mobile})}]),APP.service("MyPhoneManageService",["$http","UrlService",function(e,t){}]),APP.controller("ShopAddressController",["$scope","$stateParams","$rootScope","ShopAddressServicee","PopupService","$timeout",function(e,t,o,s,i,a){e.provinceId="",e.cityId="",e.regionId="",e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.textALL="",e.panGoOn=!1,e.address={value:t.default},e.detailAddress={value:t.defaultDetail},e.updateResult=!0,e.updateContent="";var n=t.hrCode,r=t.memberType;e.init=function(){n=t.hrCode;t.memberType;0==e.panGoOn&&(e.address={value:t.default},e.provinceId=t.provinceId,e.cityId=t.cityId,e.regionId=t.regionId),e.detailAddress={value:t.defaultDetail},e.panGoOn=!1},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.address.value&&e.detailAddress.value?e.detailAddress.value.length>50||e.detailAddress.value.length<2?void i.showToast("你输入的地址字符长度应在2-50之间"):void s.doInit(e.address.value,e.detailAddress.value,e.provinceId,e.cityId,e.regionId,n,r).success(function(t,s,i,a){1==t.success?(o.$broadcast("SHOP_ADDRESS",e.address.value),o.$broadcast("SHOP_DETAILADDRESS",e.detailAddress.value),e.$ionicGoBack()):e.showResult("修改失败")}):void i.showToast("您输入的地址不能为空")},o.$on("SHOPADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.provinceId=o["value-1"],e.cityId=o["value-2"],e.regionId=o["value-3"],e.textALL=e.textOne+e.textTwo+e.textThree+e.textFour,e.address={value:e.textALL}}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopAddressServicee",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c){var l={};if("人人服务（服务兵创业）"==c)var l={provinceId:i,cityId:a,regionId:n,regionName:o,address:s,hrCode:r,memberType:10};else var l={provinceId:i,cityId:a,regionId:n,regionName:o,address:s};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:l})}}]),APP.controller("ShopLegendController",["$scope","$stateParams","ShopLegendService","$rootScope","PopupService",function(e,t,o,s,i){e.selectText=t.default;var a=t.provinceId,n=t.cityId,r=t.regionId;e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.goToLegend=!1,e.isHaierCloud=!1,e.init=function(){e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.showAlert=!1,e.showAlertCheck=!1,"海尔云店"!=e.selectText&&(e.isHaierCloud=!1)},e.doChange=function(){e.showAlert=!1,e.showAlertCheck=!1;var t=/^(?!HR|hr|Hr|hr).*$/;if("人人服务（服务兵创业）"==e.selectText&&(e.valueUnion=10,t.exec(e.hrCode.value)||e.hrCode.value.length>20||e.hrCode.value.length<8))return void(e.showAlert=!0);e.hrCodeOld==e.hrCode.value?o.doInit(e.valueUnion,a,n,r,e.hrCode.value).success(function(t,o,a,n){1==t.success?(s.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?i.showToast(t.message):i.showToast("未知异常")}):o.check(e.hrCode.value).success(function(t,c,l,d){t?o.doInit(e.valueUnion,a,n,r,e.hrCode.value).success(function(t,o,a,n){1==t.success?(s.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?i.showToast(t.message):i.showToast("未知异常")}):e.showAlertCheck=!0})},s.$on("SHOP_SELECT_UNION",function(t,o){e.goToLegend=!0,e.textUnion=o.text,e.valueUnion=o.value,e.selectText=e.textUnion,"海尔云店"==e.selectText&&(e.isHaierCloud=!0)}),e.$on("$ionicView.beforeEnter",function(o,s){"forward"==s.direction&&(e.selectText=t.default),e.init()})}]),APP.service("ShopLegendService",["$http","UrlService",function(e,t){this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.doInit=function(o,s,i,a,n){var r={memberType:o,provinceId:s,cityId:i,regionId:a,hrCode:n};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:r})}}]),APP.controller("ShopMessageController",["$scope","ShopMessageService","$rootScope","PopupService",function(e,t,o,s){e.shopMessageID="",e.shopMessageName="",e.shopMessageAddress="",e.shopMessageDetailAddress="",e.shopMessageLegend="",e.provinceId="",e.cityId="",e.regionId="",e.isHaierCloud="",e.hrCode="",e.init=function(){e.isHaierCloud=!1,t.getShopMessage().success(function(t,o,i,a){t.success?(e.shopMessageID=t.data.storeInfo.memberId,e.shopMessageName=t.data.storeInfo.storeName,e.shopMessageAddress=t.data.storeInfo.regionName,e.shopMessageDetailAddress=t.data.storeInfo.address,e.shopMessageLegend=t.data.storeInfo.memberName,e.provinceId=t.data.storeInfo.provinceId,e.cityId=t.data.storeInfo.cityId,e.regionId=t.data.storeInfo.regionId,e.hrCode=t.data.storeInfo.hrCode,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!0)):s.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),o.$on("SHOP_NAME",function(t,o){e.shopMessageName=o}),o.$on("SHOP_LEGEND",function(t,o){e.shopMessageLegend=o,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!1)}),o.$on("SHOP_ADDRESS",function(t,o){e.shopMessageAddress=o}),o.$on("SHOP_DETAILADDRESS",function(t,o){e.shopMessageDetailAddress=o})}]),APP.service("ShopMessageService",["$http","UrlService",function(e,t){this.getShopMessage=function(){return e.get(t.getUrl("SHOPINFO_INIT"))}}]),APP.controller("ShopNameController",["$scope","$stateParams","$rootScope","ShopNameService","PopupService","$timeout",function(e,t,o,s,i,a){e.name={value:t.default},e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.default}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.name.value?/[\ud800-\udbff][\udc00-\udfff]/g.test(e.name.value)?void i.showToast("亲，不可以使用表情喔!"):void s.checkName(e.name.value).success(function(t,o,a,n){t.data?s.changeName(e.name.value).success(function(t,o,s,i){t.success&&e.$ionicGoBack()}):i.showToast("您的名称中含有敏感词,请重新输入")}):void i.showToast("您输入的店铺名称不能为空")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopNameService",["$http","UrlService",function(e,t){this.checkName=function(o){var s={checkword:o};return e.get(t.getUrl("CHECKSHOPNAME_INIT"),s)},this.changeName=function(o){var s={wdName:o};return e.get(t.getUrl("CHANGESHOPNAME_INIT"),s)}}]),APP.controller("storeTeamOwnerController",["$http","$scope","$cacheFactory","storeTeamOwnerService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","HomePageService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){function T(e,o){s.storeInfo({visitType:e,daysType:o}).success(function(e){1==e.success&&(t.storeVisitInfo=e.data.storeVisitInfo,t.commonVisitList=e.data.commonVisitList)})}function C(e){var t=[];for(var o in e)t.push([e[o],o]);t.reverse();for(var s=t.length,e=[],o=0;o<s;o++)e.push({date:t[o][1],act:t[o][0]});return e}t.navtabs=[{title:"店铺数据"},{title:"团队数据"},{title:"个人数据"}],t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.setStorage=function(e,o,i,a,r,c){t.userinfo={img:e,name:o,time:i,where:a},s.visitorInfo=t.userinfo,s.getVisitorBrowHis(r,c).success(function(e){if(e.success){if(t.visiProductList=e.data,0==t.visiProductList.length)return!1;n.go("VisitorBrowHistory",{userId:r,daysType:c})}})},t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,t.partnerTitle="partner",t.teamTitle="team",t.switchType=function(e){t.typeState[e]||(t.typeState=[!1,!1,!1],t.typeState[e]=!0),0==e?(t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,T(t.visitType,t.daysType)):1==e?(t.storeActived=!1,t.teamActived=!0,t.ownerActived=!1,s.teamInfo().success(function(e){1==e.success&&(t.teamDetail=e.data)})):2==e&&(t.storeActived=!1,t.teamActived=!1,t.ownerActived=!0,s.ownerInfo().success(function(e){if(1==e.success){t.ownerDetail=e.data,t.ownerMonthReport=e.data.storeMemberMonthReport,t.ownerteamLevel=e.data.teamLevel,t.items=e.data.map;var o=C(e.data.map);t.lists=o}}),s.ownerCommi().success(function(e){1==e.success&&(t.predictCommi=e.data.newBrokerageAmount,t.totalCommi=e.data.totalBrokerageAmount)})),m.scrollTop()},t.dayType=function(e){t.dayState[e]||(t.dayState=[!1,!1],t.dayState[e]=!0),0==e?(t.rankText="7天访客排行榜",t.daysType="WEEK",T(t.visitType,t.daysType)):1==e&&(t.rankText="30天访客排行榜",t.daysType="MONTH",T(t.visitType,t.daysType))},t.$on("$ionicView.beforeEnter",function(e,o){if("back"==o.direction)return void w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1});t.userMemberId=JSON.parse(localStorage.getItem("USER_CACHE_KEY")).mid||"",t.typeState=[!0,!1,!1],t.dayState=[!0,!1],t.rankText="7天访客排行榜",t.daysType="WEEK",t.visitType="STORE",t.init()}),t.days=[{text:"最近7天"},{text:"最近30天"}],t.items={},t.openHis=function(){var e=d.show({template:"\n          <div class='his-box' scrollbar-y=\"false\">\n            <h3>历史团队活跃度</h3>\n            <h5>最近12个月</h5>\n            <div class='his-nav' flex='main:justify cross:center'>\n              <div>年/月</div>\n              <div>活跃度</div>\n            </div>\n            <div class='his-list'>\n              <div class='his-item' ng-repeat='list in lists' flex='main:justify cross:center'>\n                <div class='his-month'>{{list.date}}</div>\n                <div class='his-act'>{{list.act}}%</div>\n              </div>\n            </div>\n            <div class='his-close'>\n              <div class=\"close-img\" ng-click='closeHis()'>\n                <img ng-src=\"{{imgBaseURL}}img/hisClose@2x.png\" alt=\"关闭\" />\n              </div>\n              <span class='close-bor'></span>\n            </div>\n          </div>\n        ",scope:t});t.closeHis=function(){e.close()}},t.goBack=function(){t.$ionicGoBack()};l.getUser();t.init=function(){T(t.visitType,t.daysType),t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.PercentageCal=function(e,t){var o=parseFloat(e),s=parseFloat(t);return s>o?isNaN(o)||isNaN(s)?"-":s<=0?"0%":Math.round(o/s*1e4)/100+"%":"100%"}}]),APP.service("storeTeamOwnerService",["$http","UrlService",function(e,t){this.storeInfo=function(o){var s=t.getUrl("GET_STORE_DATA");return e.get(s,o)},this.teamInfo=function(o){var s=t.getUrl("GET_TEAM_DATA");return e.get(s,o)},this.ownerInfo=function(o){var s=t.getUrl("GET_OWNER_DATA");return e.get(s,o)},this.ownerCommi=function(o){var s=t.getUrl("REPORT_DETAIL_PLUS");return e.get(s,o)},this.visitorInfo="",this.getVisitorBrowHis=function(o,s){var i={userId:o,daysType:s};return e.get(t.getUrl("GET_VISI_BROW_HIS"),i)}}]),APP.controller("teamProductMsgController",["storeTeamOwnerService","$http","$scope","teamProductMsgService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){var e=document.getElementById("shopRevenueChart"),t=echarts.init(e);T=t;var s=null;(s={title:{text:A,left:"30%",top:"2%",textStyle:{fontWeight:"normal",fontSize:14,color:"#172434",letterSpacing:0,lineHeight:14}},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"none"}},xAxis:{type:"category",boundaryGap:!1,data:o.statisticDays,axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}},yAxis:[{type:"value",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbolSize:8,areaStyle:{normal:{color:"#cee9f6"}},lineStyle:{color:"#37bfff"},itemStyle:{normal:{color:"#37bfff"}},data:o.data}]})&&"object"==typeof s&&(t.setOption(s,!0),t.setOption(s))}function w(e,t){return 1==e?void(b=t.storeUv):2==e?void(b=t.storePv):3==e?void(b=t.productUv):4==e?void(b=t.productPv):5==e?void(b=t.shareUv):6==e?void(b=t.sharePv):void 0}function y(e,t,s,i){for(var a=0;a<e.length;a++)o.statisticDays.push(e[a].statisticDays),1==s?o.data.push(e[a].storeUv):2==s?o.data.push(e[a].storePv):3==s?o.data.push(e[a].productUv):4==s?o.data.push(e[a].productPv):5==s?o.data.push(e[a].shareUv):6==s&&o.data.push(e[a].sharePv);"WEEK"==t?(w(s,i),C=7,A="最近"+C+"天: "+b+o.titleText):(w(s,i),C=30,A="最近"+C+"天: "+b+o.titleText)}o.data=[],o.statisticDays=[];var T="",C="",b="",A="";o.titleList=["访客数","浏览次数","商品访客数","商品浏览量","分享访问人数","分享访问次数"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.commonFun=function(e,t){s.storeInfo(e,t).success(function(e){e.success&&(o.commonVisitList=e.data.commonVisitList,o.daysType=7==e.data.commonVisitDetail.statisticDays?"WEEK":"MONTH",o.commonVisitDetail=e.data.commonVisitDetail,o.myInComeOut=e.data.commonVisitTendencyList,o.storeVisitInfo=e.data.storeVisitInfo,1==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):2==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):3==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):4==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):5==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):6==o.num&&(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()))})},o.init=function(){1!=o.num&&2!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?3!=o.num&&4!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?5!=o.num&&6!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days||(o.share="SHARE",o.commonFun(o.share,o.days)):(o.product="PRODUCT",o.commonFun(o.product,o.days)):(o.store="STORE",o.commonFun(o.store,o.days)),1==o.num||3==o.num||5==o.num?(o.personNum=!0,o.titleText="人"):2!=o.num&&4!=o.num&&6!=o.num||(o.titleText="次")},o.setStorage=function(t,s,i,a,r,c,l){if(3!=t&&4!=t)return!1;o.userinfo={img:s,name:i,time:a,where:r},e.visitorInfo=o.userinfo,e.getVisitorBrowHis(c,l).success(function(e){if(e.success){if(o.visiProductList=e.data,0==o.visiProductList.length)return!1;n.go("VisitorBrowHistory",{userId:c,daysType:l})}})},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){C="",b="",A="",o.num=i.num,o.days=i.type,o.data=[],o.statisticDays=[],o.fsfsafa=!0,o.init()}),o.$on("$ionicView.beforeLeave",function(){T&&T.dispose(),o.fsfsafa=!1})}]),APP.service("teamProductMsgService",["$http","UrlService",function(e,t){this.storeInfo=function(o,s){var i={visitType:o,daysType:s};return e.get(t.getUrl("STORE_PRODUCT"),i)}}]),APP.controller("TeamController",["$ionicHistory","$scope","TeamService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.history=[],t.hShow=!0,t.hShowB=!0;localStorage.getItem("historys");t.arrowState=[p.imgBaseURL+"img/Group@2x.png",p.imgBaseURL+"img/Group1@2x.png",p.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["openTime","openTimeDesc"],"authDesc","leaderDesc"],t.isShowUp=!1,t.isIos=!1,t.screenWidth=window.screen.width,t.front=l.front,t.shareStoreId=l.shareStoreId,t.isBuyer=g.getRole(),t.userId=n.getUser().mid;var v="",$="0";t.brand=!1,t.brandName="全部",t.brandList=[],t.filterParameterArr=["hasStock","all","0"],t.StockStateArr=["all","hasStock"],t.filterParams="",-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.screenWidth<375?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:t.screenWidth<414?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},t.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},t.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),t.clearLocal=function(){localStorage.removeItem("historys"),t.hShow=!1,t.hShowB=!0},t.$on("$ionicView.beforeEnter",function(e,o){m.scrollTop(),t.isBuyer=g.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.topStyle={top:"64px"}:t.topStyle={top:"44px"},t.showTab=!1,t.filterParams="",t.lianXC=!1,t.storeId=d.get("storeId",p.globalConstant.storeId),t.isBuyer=g.getRole(),t.userId=n.getUser().mid,"back"==o.direction?(t.hShow=!1,t.hotWordShow=!1,t.hShowB=!1):(localStorage.getItem("historys")?(t.hShow=!0,t.hShowB=!1):(t.hShow=!1,t.hShowB=!0),t.tabNav="selection",t.hasmore=!1,t.typeChoose="商品",$="0",t.gsPlaceholder="请搜索名字、型号等关键字",t.searchData=null,t.page=2,t.front=l.front,v=l.shareStoreId?l.shareStoreId:n.getUser().mid,t.searchGoodsName={name:""})}),t.loadMore=function(){0==t.front?o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,2,t.filterParams,!0).success(function(e,o,s,i){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}):1==t.front&&o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1,t.filterParams,!0).success(function(e,o,s,i){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)})},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e)){if(m.scrollTop(),t.page=2,0==e){t.chooseIndex=e;var s=1==t.openStoreTime_index?0:1;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.filterParams=tabState[1][s],t.searchData=[]}else 1==e?(t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.searchData=[]):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.filterParams="saleDesc",t.searchData=[]);o.myStoreSearch("1","5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,s,i){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})}},t.closeComprehensiveSub=function(){t.showComprehensiveSub=!t.showComprehensiveSub},t.selectComprehensiveSub=function(e,s){s.stopPropagation(),0==e&&(t.filterParams="isHotDesc"),t.lianXC=!1,t.selectComprehensiveSubIndex=e,t.showComprehensiveSub=!t.showComprehensiveSub,t.chooseIndex=0,t.productList=[],t.comprehensive_index=1,t.commission_index=0,t.price_index=0,t.filter_index=0,o.myStoreSearch("1","5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,s,i){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0,t.comprehensive_index=1,t.chooseIndex=0,t.showComprehensiveSub=!1):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})},t.chooseStockState=function(e){t.filterParameterArr[0]=t.StockStateArr[e]},t.$on("$destroy",function(){t.filterModal.remove()})}]),APP.service("TeamService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p){var u={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p};return e.get(t.getUrl("SEARCHGOODS_INIT"),u)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)}}]),APP.controller("ApplyForWhiteController",["$scope","InAppBrowserService","UrlService","$rootScope","InAppBrowserService","ManageMoneyService","WhiteShowsService","UserService",function(e,t,o,s,t,i,a,n){e.toHelp=function(e,s){-1!=navigator.userAgent.indexOf("iPhone")?t.open(o.getHead()+"mstore/sg/helpDetail.html?id="+e,s):$state.go("helpDetail",{helpId:e,content:s})},e.goBack=function(){e.$ionicGoBack()},e.applyToWihte=function(){a.applyForOpen({backUrl:window.location.href,userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(e){e.success&&a.openApplyWhiteShows(e.data.redirectUrl,"http://m.ehaier.com/#/applyForWhite")})}}]),APP.service("WhiteShowsService",["InAppBrowserService","UrlService","$http",function(e,t,o){this.applyForOpen=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_APPLY"),params:e})},this.queryAvaliAmt=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_QUERY_AVALIAMT"),params:e})},this.payApply=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_PAY"),params:e})},this.queryIousStatus=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_QUERY_STATUS"),params:e})},this.cost=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_COST"),params:e})},this.openApplyWhiteShows=function(e,t){window.cordova?window.emc.presentH5View(e,"顺逛白条"):window.location.href=e}}]),APP.controller("MyWalletController",["$scope","$state","MyWalletService","InAppBrowserService","UrlService","UserService","WhiteShowsService",function(e,t,o,s,i,a,n){function r(){o.getWallet().success(function(t){t.success&&(e.walletInfo=t.data)}).error(function(e){alert("网速较慢，请稍候再试")}),n.queryIousStatus({userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(t){t.success&&(e.whiteShowsState=t.data.applyStatus,1==e.whiteShowsState&&n.queryAvaliAmt({token:a.getUser().accessToken}).success(function(t){t.success&&(e.crdComAmt=t.data.crdComAmt,e.crdComAvailAmt=t.data.crdComAvailAmt)}).error(function(e){alert("网速较慢，请稍候再试")}))}).error(function(e){alert("网速较慢，请稍候再试")})}e.walletInfo=[],e.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,o):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(e,t){r()}),e.toApplyForWhite=function(e){2!=e?n.applyForOpen({backUrl:window.location.href,userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(e){e.success&&n.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):t.go("applyForWhite")}}]),APP.service("MyWalletService",["$http","UrlService",function(e,t){this.getWallet=function(){return e.get(t.getUrl("GET_WALLET"))}}]),APP.controller("walletDiamCtrl",["$scope","$state","$ionicHistory","$interval","walletDiamService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,s,i,a,n,r,c,l,d){e.index=null,e.diamgetlist=[],e.pagenum1=1,e.hasmore=!1,e.usableDiamond="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){a.scrollTop(),d.getWallet().success(function(t){e.usableDiamond=t.data.usableDiamond}).error(function(){}),e.pagenum1=1,e.hasmore=!0,i.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.diamgetlist=t.data.paymentList})},e.changelist=function(t){e.diamgetlist=[],a.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,i.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.diamgetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,i.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.diamgetlist=e.diamgetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.diamgetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletDiamService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,s,i){var a={memberId:o,benefitType:"diamond",transType:i,pageNo:s,pageSize:10},n={memberId:o,benefitType:"diamond",pageNo:s,pageSize:10};return null==i?e.get(t.getUrl("GET_WALLETDETAIL"),n):e.get(t.getUrl("GET_WALLETDETAIL"),a)}}]),APP.controller("walletIntCtrl",["$scope","$state","$ionicHistory","$interval","walletIntService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,s,i,a,n,r,c,l,d){e.index=null,e.integetlist=[],e.pagenum1=1,e.hasmore=!1,e.seashellPoint="",e.seashellPointAmt="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){a.scrollTop(),d.getWallet().success(function(t){e.seashellPoint=t.data.seashellPoint,e.seashellPointAmt=t.data.seashellPointAmt}).error(function(){}),e.pagenum1=1,e.hasmore=!0,i.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.integetlist=t.data.paymentList})},e.changelist=function(t){e.integetlist=[],a.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,i.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.integetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,i.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.integetlist=e.integetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.integetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletIntService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,s,i){var a={memberId:o,benefitType:"seashell",transType:i,pageNo:s,pageSize:10},n={memberId:o,benefitType:"seashell",pageNo:s,pageSize:10};return null==i?e.get(t.getUrl("GET_WALLETDETAIL"),n):e.get(t.getUrl("GET_WALLETDETAIL"),a)}}]),APP.controller("designDetailController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","designDetailService","$ionicSlideBoxDelegate","PopupService","GoodsService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p){t.shareimg="",t.showShare=!1,t.title="",t.sharedesp="",t.soluteId=e.soluteId,t.hasmore=!0,t.pageIndex=1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.init=function(){t.showQQ=!1,t.showWeChat=!1,t.showShare=!1,t.designerData={},t.pageIndex=1,t.listdata=[],window.cordova?t.isApp=!0:t.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),r.getPageDate(t.soluteId).success(function(e){t.designerData=e.data,t.shareimg=t.designerData.avatar,t.title=t.designerData.name,t.sharedesp=t.designerData.introduction}),t.loadmore=function(){r.gettopicDate(t.pageIndex,4,t.soluteId).success(function(e){0==e.data.length?(t.hasmore=!1,t.listdata=t.listdata.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.listdata=t.listdata.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.goshare=function(){if(!a.getUser().mid)return void n.go("login");t.showShare=!t.showShare},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.title,a=t.sharedesp,n=t.shareimg?t.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=s.getShareLinkHeader()+"designDetail/"+t.soluteId;window.umeng?(0==e?window.umeng.shareToSina(o,a,n,r,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,a,n,r,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,a,n,r,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()),5==e?t.copeText(r):i.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.goback=function(){p.goBack()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("designDetailService",["$http","UrlService",function(e,t){this.getPageDate=function(o){var s={id:o};return e.get(t.getNewUrl("DESIGN_DETAIL"),s)},this.gettopicDate=function(o,s,i){var a={pageIndex:o,pageSize:s,id:i};return e.get(t.getNewUrl("DESIGN_SOLULIST"),a)}}]),APP.controller("exStoreDetailController",["$ionicActionSheet","$scope","$rootScope","UrlService","CreditService","exStoreDetailService","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","BannerThemeService","GoodsService","CommonAddressService","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){t.pageData={},t.name="体验店",t.nearbyId=g.nearbyId,1==o.globalConstant.positionStatus?t.cityId=u.getAddressInfo().cityId+"":t.cityId=173,t.init=function(){t.pageData={},t.name="体验店",a.getstore(t.nearbyId,o.globalConstant.lat,o.globalConstant.lon).success(function(e){t.pageData=e.data,t.name=t.pageData.name,r.update(),r.$getByHandle("exStoreDetail_slide").loop(!0)})},t.callphone=function(){if(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova)return void window.open("tel:"+t.pageData.mobile,"_system");c.confirm({cssClass:"extorecall",template:t.pageData.mobile,cancelText:"取消",okText:"呼叫"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+t.pageData.mobile,"_system"):window.open("tel:"+t.pageData.mobile))})},t.openmap=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.show({buttons:[{text:"高德地图"},{text:"百度地图"},{text:"Apple 地图"}],cancelText:"取消",buttonClicked:function(e){switch(e){case 0:window.emc.presentH5View(encodeURI("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0"),"高德地图");break;case 1:window.emc.presentH5View(encodeURI("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店"),"百度地图");break;case 2:window.location.href=encodeURI("http://maps.apple.com/?q="+t.pageData.name+"&sll="+t.pageData.longitude+","+t.pageData.latitude+"&z=10&t=s")}}}):e.show({buttons:[{text:"高德地图"},{text:"百度地图"}],cancelText:"取消",buttonClicked:function(e){switch(e){case 0:
window.cordova?window.emc.presentH5View("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0","高德地图"):window.open("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0","_blank","location=yes");break;case 1:window.cordova?window.emc.presentH5View("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店","百度地图"):window.open("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店","_blank")}}})},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()})}]),APP.service("exStoreDetailService",["$http","UrlService",function(e,t){this.getstore=function(o,s,i){var a={nearbyId:o,latitude:s,longitude:i};return e.get(t.getNewUrl("TEST_STORE_DETAIL"),a)}}]),APP.controller("exportDetailController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","exportDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){t.exportId=e.exportId,t.pageIndex=1,t.pageSize=4,t.hasmore=!0,t.init=function(){t.pageData={},t.ajanli=[],t.pageIndex=1,t.pageSize=4,r.getPageDate(t.exportId,1,t.pageSize).success(function(e){t.pageData=e.data}),t.loadmore=function(){r.getPageDate(t.exportId,t.pageIndex,t.pageSize).success(function(e){0==e.data.details.length?(t.hasmore=!1,t.ajanli=t.ajanli.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.ajanli=t.ajanli.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("exportDetailService",["$http","UrlService",function(e,t){this.getPageDate=function(o,s,i){var a={channel:1,id:o,pageIndex:s,pageSize:i};return e.get(t.getNewUrl("EXPORT_DETAIL"),a)}}]),APP.controller("fullHouseSolutionController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","fullHouseSolutionService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){t.shareimg=o.smartNav?o.smartNav:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",t.showShare=!1,t.sharedesp="",t.soluteId=e.soluteId,t.hasmore=!0,t.pageIndex=1,t.title="",t.init=function(){t.showQQ=!1,t.showWeChat=!1,t.showShare=!1,t.exportDate=[],t.recommend=[],t.housetopic=[],t.housetopictitle="",t.title="",t.videotag&&t.videotag.pause(),t.pageIndex=1,window.cordova?t.isApp=!0:t.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),r.getPageDate(t.soluteId).success(function(e){t.banners=e.data.banners,t.exportDate=e.data.expert.experts,t.recommend=e.data.recommend.recommends,t.title=e.data.name,t.sharedesp=e.data.name,d.update(),d.$getByHandle("fullHouseSolution_slide").loop(!0)}),t.loadmore=function(){r.gettopicDate(t.pageIndex,6,t.soluteId).success(function(e){t.housetopictitle=e.data.title,0==e.data.storys.length?(t.hasmore=!1,t.housetopic=t.housetopic.concat(e.data.storys),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.housetopic=t.housetopic.concat(e.data.storys),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.playing=function(e){t.clickimg=!0,e.target.style.display="none",t.imgtag=e.target,t.videotag=e.target.nextElementSibling,e.target.nextElementSibling.play(),t.targetv=e.target.nextElementSibling,t.targetv.addEventListener("ended",function(){e.target.style.display="block"})},t.divclick=function(){t.clickimg?t.clickimg=!1:t.videotag&&(t.videotag.pause(),t.imgtag.style.display="block")},t.onScroll=function(){var e=f.getScrollPosition().top;t.$apply(function(){e>=150&&t.imgtag&&"none"==t.imgtag.style.display&&(t.videotag.pause(),t.imgtag.style.display="block")})},t.goshare=function(){if(!a.getUser().mid)return void n.go("login");t.showShare=!t.showShare},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.sharedesp,a=t.sharedesp,n=t.shareimg?t.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=s.getShareLinkHeader()+"fullHouseSolution/"+t.soluteId;window.umeng?(0==e?window.umeng.shareToSina(o,a,n,r,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,a,n,r,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,a,n,r,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()),5==e?t.copeText(r):i.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$ionicView.beforeLeave",function(){t.videotag&&t.videotag.pause()}),t.$on("$ionicView.enter",function(e,o){ionic.on("scroll",t.onScroll,t.$$childHead.scrollCtrl.element)}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("fullHouseSolutionService",["$http","UrlService",function(e,t){this.getPageDate=function(o){var s={id:o};return e.get(t.getNewUrl("FULL_SOLUTION"),s)},this.gettopicDate=function(o,s,i){var a={group:2,itemsId:1,pageIndex:o,pageSize:s,programsId:i};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),a)}}]),APP.controller("homeDesignsthController",["$ionicActionSheet","$scope","$rootScope","UrlService","CreditService","homeDesignsthService","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","BannerThemeService","GoodsService","CommonAddressService","$ionicModal",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){t.filtertag=[],t.all=[],t.anliproIds="",t.pageIndex=1,t.pageSize=3,t.dataList=[],t.hasmore=!0,t.init=function(){t.pageIndex=1,t.pageSize=3,t.dataList=[],t.hasmore=!0,t.anliproIds="",a.getfiltertag().success(function(e){t.filtertag=e.data;for(var o=0;o<t.filtertag.length;o++)t.all[o]=!0}),t.loadmore=function(){a.getdata(t.anliproIds,t.pageIndex,t.pageSize).success(function(e){0==e.data.length?(t.hasmore=!1,t.dataList=t.dataList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.dataList=t.dataList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.openFilterModal=function(){t.filterModal.show()},t.choosetype=function(e,o,s){for(var i=0;i<o.labels.length;i++)o.labels[i].chooseFlag=!1;e.chooseFlag=!0,t.all[s]=!1},t.chooseAll=function(e,o){t.all[e]=!0;for(var s=0;s<o.labels.length;s++)o.labels[s].chooseFlag=!1},t.resetFilter=function(){for(var e=0;e<t.filtertag.length;e++){t.all[e]=!0;for(var o=0;o<t.filtertag[e].labels.length;o++)t.filtertag[e].labels[o].chooseFlag=!1}},t.filterEnsure=function(){t.anliproIds="",t.pageIndex=1,t.dataList=[];for(var e=0;e<t.filtertag.length;e++)for(var o=0;o<t.filtertag[e].labels.length;o++)1==t.filtertag[e].labels[o].chooseFlag&&(t.anliproIds+=t.filtertag[e].labels[o].id+",");t.anliproIds&&(t.anliproIds=t.anliproIds.slice(0,t.anliproIds.length-1)),a.getdata(t.anliproIds,t.pageIndex,t.pageSize).success(function(e){t.dataList=e.data}),t.filterModal.hide()},g.fromTemplateUrl("templates/product/homedesModal.html",{scope:t,animation:"slide-in-left",backdropClickToClose:!0}).then(function(e){t.filterModal=e}),t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$destroy",function(){t.filterModal.remove()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("homeDesignsthService",["$http","UrlService",function(e,t){this.getfiltertag=function(){return e.get(t.getNewUrl("FILTER_TAG"))},this.getdata=function(o,s,i){var a={ids:o,pageIndex:s,pageSize:i};return e.get(t.getNewUrl("FILTER_PRODUCTLIST"),a)}}]),APP.controller("homeDetailController",["CreditService","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","homeDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","GoodsService","$ionicModal","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){var w;s.solutionId=o.solutionId,s.usermes={name:"",mobl:""},s.bacicInfo={},s.designerId=0,s.pid=0,s.cid=0,s.aid=0,s.shareimg="",s.showShare=!1,s.sharedesp="",s.init=function(){s.showQQ=!1,s.showWeChat=!1,s.showShare=!1,window.cordova?s.isApp=!0:s.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){s.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){s.showWeChat=0!=e})),s.$broadcast("scroll.refreshComplete"),s.storeId=p.get("storeId",i.globalConstant.storeId),l.bacicInfo(s.solutionId).success(function(e){s.bacicInfo=e.data,s.shareimg=e.data.imageUrl,s.sharedesp=e.data.name,s.designerId=e.data.designerId})},s.predesgin=function(){w=g.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:s})},s.colsepop=function(){w.close()},s.yuyue=function(){if(0==s.usermes.name.length)m.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test(s.usermes.name))m.showToast("姓名不能包含非法字符");else if(0==s.usermes.mobl.length)m.showToast("请输入手机号");else if(s.globalConstant.mobileNumberRegExp.test(s.usermes.mobl)){switch(s.pid){case 2:s.cityname="北京市";break;case 3:s.cityname="天津市";break;case 10:s.cityname="上海市";break;case 23:s.cityname="重庆市"}l.yuyue(s.cid,s.designerId,2,s.usermes.mobl,s.usermes.name,s.pid,s.aid,s.cityname).success(function(e){e.data&&e.success?(m.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),w.close()):m.showToast(e.message)}).error(function(e){m.showToast("网络错误，检查网络后再试")})}else m.showToast("请输入正确的手机号格式")},s.goshare=function(){if(!n.getUser().mid)return void r.go("login");s.showShare=!s.showShare},s.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),m.showToastShort("复制成功")):m.showToast("请下载APP执行此操作")},s.hideblackCover=function(){s.showShare=!1},s.shareToPlatform=function(t){var o=s.sharedesp,i=s.sharedesp,n=s.shareimg?s.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=a.getShareLinkHeader()+"homeDetail/"+s.solutionId;window.umeng?(0==t?window.umeng.shareToSina(o,i,n,r,0,null,e.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,n,r,0,null,e.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,n,r,0,null,e.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,n,r,0,null,e.shareSuccessCallback),e.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,n,r,0,null,e.shareSuccessCallback),e.qqShare()),5==t?s.copeText(r):e.successShare()):alert("umeng undefined 只能在app分享"),s.showShare=!1};var y=window.innerHeight,T=y-373+"px";s.contentHeight={height:T},s.addressTitle="选择地区",s.dataAdd=null,s.flag="PRODUCT_DETAIL_LOCATION",s.defaultValue=null,s.level=0;var C={};s.addressTop=function(){s.addressTipFlag=!1,s.provinceTop=0,s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.addressModal.show(),s.dataAdd=null,s.defaultValue=null,s.selectProvince="",s.selectCity="",s.selectArea="",w.close(),s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},s.addressInit=function(e,t,o,i){if(s.addressTipFlag=!1,v.$getByHandle("mainScroll").scrollTop(),s.addressTitle="选择地区",s.defaultValue=e?JSON.parse(e):{},s.level=i,t){s.dataAdd=JSON.parse(t),s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var a=0;a<s.nowLevelIndex.length;a++)a>s.nowLevel&&(s.nowLevelIndex[a]=-1)}else s.finish=!1,s.dataAdd="",c.get("data/region.json").success(function(e){s.dataAdd=e.data,s.finish=!0,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var t=0;t<s.nowLevelIndex.length;t++)t>s.nowLevel&&(s.nowLevelIndex[t]=-1)}).error(function(e){m.showToast("获取地址信息失败！")})},s.bottomBorder={"border-bottom":"2px solid red"},s.provinceFlag=!1,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.provinceSel=function(){s.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),s.selectCity="",s.selectArea="",s.provinceFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!1,s.areaDis=!1};var b=!1;s.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<s.nowLevelIndex.length;o++)o>s.nowLevel&&(s.nowLevelIndex[o]=-1);s.dataAdd="",s.nowLevelIndex[s.nowLevel]=e;var t=arguments[1],e=arguments[0];if(s.level=s.level-1,s.defaultValue["text"+s.level]=t.text,s.defaultValue["value"+s.level]=t.value,s.level>-2)c.get("data/region.json").success(function(o){-1==s.level?(s.selectProvince=t.text,s.provinceIndex=e,s.dataAdd=o.data[e].children,s.provinceFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.provinceTop=v.$getByHandle("mainScroll").getScrollPosition().top,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel,s.citySel=function(){s.dataAdd="",s.addressInit(i,a,s.flag,-1),s.dataAdd=o.data[e].children,s.selectArea="",s.cityFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,v.$getByHandle("mainScroll").scrollTo(0,s.cityTop)}):s.dataAdd=s.dataAdd[e].children;var i=JSON.stringify(s.defaultValue),a=JSON.stringify(s.dataAdd);s.addressInit(i,a,s.flag,s.level)}).error(function(e){m.showToast("获取地址信息失败！")});else if(s.level>-4)s.selectCity=s.defaultValue["text-2"],s.provinceFlag=!1,s.cityFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,-3==s.level?(s.selectArea=t.text,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0,s.areaTop=v.$getByHandle("mainScroll").getScrollPosition().top):s.cityTop=v.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*s.level,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,$.getLocationList(t.value,ah).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(s.defaultValue),i=JSON.stringify(s.dataAdd);s.addressInit(o,i,s.flag,s.level)}).error(function(e){m.showToast("获取地址信息失败！")}),s.levelArea=s.level,s.levelArea=s.levelArea+1,s.areaSel=function(){s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,s.dataAdd="",s.level=s.levelArea,$.getLocationList(areaValue,2).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1;var t=JSON.stringify(s.defaultValue),o=JSON.stringify(s.dataAdd);s.addressInit(t,o,s.flag,s.level),v.$getByHandle("mainScroll").scrollTo(0,s.areaTop),s.areaFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0}).error(function(e){m.showToast("获取地址信息失败！")})};else{if(b)return;d(function(){b=!1},1500),i.$broadcast(s.flag,s.defaultValue),b=!0,s.closeAddressModal()}},300),s.getPosition=function(){"定位中···"!=i.globalConstant.autoPosition&&(C=S.getAddressInfo(),s.getarr=C.provinceName+C.cityName+C.regionName+C.streetName,s.pid=C.provinceId,s.cid=C.cityId,s.aid=C.areaId,s.cityname=C.cityName,s.addressModal.hide(),s.predesgin())},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:s,animation:"slide-in-up",backdropClickToClose:!1}).then(function(e){s.addressModal=e}),s.closeAddressModal=function(){s.addressModal.hide(),s.defaultValue["text-1"]&&s.defaultValue["text-2"]&&s.defaultValue["text-3"]&&s.defaultValue["text-4"]&&(s.getarr=s.defaultValue["text-1"]+s.defaultValue["text-2"]+s.defaultValue["text-3"]+s.defaultValue["text-4"],s.pid=s.defaultValue["value-1"],s.cid=s.defaultValue["value-2"],s.aid=s.defaultValue["value-3"],s.cityname=s.defaultValue["text-2"]),s.predesgin()},s.$on("$ionicView.beforeEnter",function(e,t){s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceTop=0,s.cityTop=0,s.areaTop=0,s.defaultValue=null,s.dataAdd=null;var o=S.getAddressInfo();s.streetId=o.streetId,s.getarr=o.provinceName+o.cityName+o.regionName+o.streetName,s.pid=o.provinceId,s.cid=o.cityId,s.aid=o.areaId,s.cityname=o.cityName,s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0),s.init()})}]),APP.service("homeDetailService",["$http","UrlService",function(e,t){this.bacicInfo=function(o){var s={id:o};return e.get(t.getNewUrl("HOME_DETAIL"),s)},this.yuyue=function(o,s,i,a,n,r,c,l){var d={channel:1,cityId:o,cityName:l,designerId:s,itemsId:i,mobile:a,name:n,provinceId:r,regionId:c};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:d})}}]),APP.controller("homeMakeController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,homeMakeService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),homeMakeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),homeMakeService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0),void 0===$scope.swpcfurnish1?$timeout(function(){},100):$scope.swpcfurnish1.update()}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last) a").css("color","#000000"),$("div.furnish_xScroll div:eq(0) a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s}),$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if($timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("homeMakeService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("homeMakeActListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeActListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.bottomIF=!1,u.init=function(){u.pageindex=1,r.isWdHost().success(function(e){u.isWdHost=e.data.isHost}),l.getlists(u.pageindex,5).success(function(e){e.data.length<5?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1),u.lists=e.data})},u.loadMore=function(){u.pageindex++,l.getlists(u.pageindex,5).success(function(e){u.lists=u.lists.concat(e.data),0==e.data.length?(u.hasmore=!1,u.bottomIF=!0,u.$broadcast("scroll.infiniteScrollComplete")):(u.hasmore=!0,u.bottomIF=!1,u.$broadcast("scroll.infiniteScrollComplete"))})},u.goBack=ionic.Utils.debounce(function(){e.goBack()},300),u.$on("$ionicView.beforeLeave",function(e,t){}),u.$on("$ionicView.enter",function(e,t){s.scrollTop()}),u.settingsList="",u.$on("$ionicView.beforeEnter",function(e,t){u.storeId=f.getUser().mid,u.init()})}]),APP.service("homeMakeActListService",["$http","UrlService",function(e,t){this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getlists=function(o,s){var i={pageIndex:o,pageSize:s};return e.get(t.getNewUrl("ACT_LIST"),i)}}]),APP.controller("homeMakeListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.toNoteDetails=function(e,t,o){m.go("noteDetails",{noteId:e})},u.init=function(){u.pageIndex=1,r.isWdHost().success(function(e){u.isWdHost=e.data.isHost}),0==u.index?l.getTopic(u.index,1,u.pageIndex,6).success(function(e){u.list=e.data.storys,e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)}):l.getTopic(u.index,2,u.pageIndex,6).success(function(e){u.list=e.data.storys,e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)})},u.loadMore=function(){u.pageIndex++,u.index,l.getTopic(u.index,2,u.pageIndex,6).success(function(e){u.list=u.list.concat(e.data.storys),e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)})},u.goBack=ionic.Utils.debounce(function(){e.goBack()},300),u.$on("$ionicView.beforeLeave",function(e,t){}),u.$on("$ionicView.enter",function(e,t){s.scrollTop()}),u.settingsList="",u.$on("$ionicView.beforeEnter",function(e,t){u.index=g.index,u.hasmore=!1,u.bottomIF=!1,u.storeId=f.getUser().mid,u.init()})}]),APP.service("homeMakeListService",["$http","UrlService",function(e,t){this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)}}]),APP.controller("homeSameController",["$localstorage","$scope","$rootScope","homeSameService","$ionicHistory","$state",function($localstorage,$scope,$rootScope,homeSameService,$ionicHistory,$state,TopicService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}$scope.locationImgUrl="img/location@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.$on("$ionicView.enter",function(e,t){}),$scope.chooseType=function(e,t){-1!=e&&($scope.ifIndex=e,$("ion-nav-view ion-view").attr("nav-view","cached"),$("div.furnish_xScroll div a").css("color","#000000"),$("div.furnish_xScroll div:eq("+e+") a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.onScroll=function(){var e=$ionicScrollDelegate.getScrollPosition().top,t=Math.round(e/204*100)/100;$scope.$apply(function(){e<10?($scope.changeOpacity={"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0.30), rgba(255,255,255,0.00))"},$scope.changeColor={color:"#ffffff"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.locationImgUrl="img/location@2x.png",$scope.messageImgUrl="img/messageLogo@2x.png"):e<100&&e>=10?($scope.changeOpacity={background:"rgba(255,255,255,"+t+")"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.changeColor={color:"#ffffff"},$scope.locationImgUrl="img/location@2x.png",$scope.messageImgUrl="img/messageLogo@2x.png"):($scope.locationImgUrl="img/location_gray@2x.png",$scope.messageImgUrl="img/message_gray@2x.png",$scope.changeColor={color:"#666666"},$scope.searchBg={background:"#e8e8e8",color:"#ffffff"},$scope.changeOpacity={background:"rgba(255,255,255,"+t+")"})})},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.init=function(){},$scope.$on("$ionicView.beforeEnter",function(){$scope.home="homeSame-smartAppliance",$scope.init()}),$scope.onTabSelected=function(){$rootScope.xiaoxis=!1}}]),APP.service("homeSameService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("houseSolutionDetailController",["$stateParams","$scope","$rootScope","UrlService","UserService","$state","houseSolutionDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u){t.allsoluteId=e.solutionId,t.pageIndex=1,t.pageSize=6,t.name="",t.imgUrl=[],t.hasmore=!0,t.frompage=0,t.init=function(){t.frompage=0,u.backView()&&"productDetail"==u.backView().stateName&&(t.frompage=1),t.pageIndex=1,t.pageSize=6,t.listdata=[],n.getPageListDate(t.frompage,t.allsoluteId,t.pageIndex,t.pageSize).success(function(e){e.data.name&&(t.name=e.data.name),e.data.imageUrl&&(t.imgUrl=e.data.imageUrl)}),t.loadmore=function(){n.getPageListDate(t.frompage,t.allsoluteId,t.pageIndex,t.pageSize).success(function(e){0==e.data.details.length?(t.hasmore=!1,t.listdata=t.listdata.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.listdata=t.listdata.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.goBack=function(){u.goBack()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("houseSolutionDetailService",["$http","UrlService",function(e,t){this.getPageListDate=function(o,s,i,a){if(1==o){var n={channel:1,productId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("HOUSE_FROM_PRODETAIL"),n)}var n={channel:1,id:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("HOUSE_LISTDETAIL"),n)}}]),
APP.controller("itSoluteDetailController",["$q","CreditService","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","itSoluteDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","GoodsService","$ionicModal","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService","PersonalCenterService",function($q,CreditService,$cookies,$stateParams,$scope,$rootScope,UrlService,UserService,$state,$http,itSoluteDetailService,$timeout,$localstorage,$ionicSlideBoxDelegate,$ionicPopup,PopupService,GoodsService,$ionicModal,$ionicScrollDelegate,ProductDetailService,CommonAddressService,CartService,PersonalCenterService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}var confirmPopup;$scope.solutionId=$stateParams.solutionId,$scope.soluDetail={},$scope.productIds="",$scope.productList=[],$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,$scope.detailList=[],$scope.obj={},$scope.num=-1,$scope.arr=[],$scope.productListMore=[],$scope.all={isAllChecked:!0},$scope.usermes={name:"",mobl:""},$scope.orderInitParams=null,$scope.pid=0,$scope.cid=0,$scope.aid=0,$scope.shareimg=$rootScope.smartNav?$rootScope.smartNav:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",$scope.showShare=!1,$scope.sharedesp="",$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,$scope.exportDate=[],$scope.recommend=[],$scope.housetopic=[],$scope.housetopictitle="",window.cordova?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),$stateParams.shareId?$scope.storeId=$stateParams.shareId:$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,itSoluteDetailService.soluteDetail($scope.solutionId).success(function(e){$scope.soluDetail=e.data,$scope.sharedesp=e.data.name,$scope.productIds=e.data.productsIds,$scope.obj=e.data.groupProducts;for(var t in $scope.obj)$scope.arr.push($scope.obj[t][0].productId),$scope.detailList.push($scope.obj[t]);itSoluteDetailService.productList($scope.productIds,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productList=e.data;for(var t=0;t<$scope.productList.length;t++)$scope.productTotalprice+=$scope.productList[t].price,$scope.selectcommsion+=$scope.productList[t].commission,$scope.productList[t].checked=!0,$scope.productList[t].isMore=!1,$scope.detailList[t].length>1&&($scope.productList[t].isMore=!0);$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice,$scope.all.isAllChecked=!0})})},$scope.choiceMore=function(e,t){$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.num=e,$scope.StoreMsgModal.show();for(var o="",s=[],i=0;i<$scope.detailList[e].length;i++)s.push($scope.detailList[e][i].productId);o=s.join(","),itSoluteDetailService.productList(o,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productListMore=e.data;for(var o=0;o<$scope.productListMore.length;o++)t==$scope.productListMore[o].id&&($scope.productListMore[o].checked=!0);$scope.selectnumber=$scope.productList.length})},$ionicModal.fromTemplateUrl("templates/common/CommonMoreChoice.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.StoreMsgModal=e}),$scope.closeStoreModal=function(){$scope.StoreMsgModal.hide()},$scope.select=function(e){$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var t=0;t<$scope.productList.length;t++){if(1!=$scope.productList[t].checked){$scope.all.isAllChecked=!1;break}$scope.all.isAllChecked=!0}for(var o=0;o<$scope.productList.length;o++)1==$scope.productList[o].checked&&($scope.selectprice+=$scope.productList[o].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[o].commission)},$scope.choiceSelect=function(e){for(var t="",o=0;o<$scope.productListMore.length;o++)$scope.productListMore[o].checked=!1,e.id==$scope.productListMore[o].id&&($scope.productListMore[o].checked=!0),1==$scope.productListMore[o].checked&&(t=$scope.productListMore[o]);$scope.productList[$scope.num]=t,$scope.productList[$scope.num].isMore=!0,$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var s=0;s<$scope.productList.length;s++)1==$scope.productList[s].checked&&($scope.selectprice+=$scope.productList[s].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[s].commission);$scope.productTotalprice=$scope.selectprice,$scope.StoreMsgModal.hide()},$scope.selectall=function(){if($scope.all.isAllChecked){$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!0,$scope.selectcommsion+=$scope.productList[e].commission}else{$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!1}},$scope.placeorder=function(){if(!UserService.getUser().mid)return void $state.go("login");for(var e=[],t=0;t<$scope.productList.length;t++)$scope.productList[t].checked&&e.push({proId:$scope.productList[t].id,num:1});$scope.orderInitParams={proList:e,street:$scope.streetId},CartService.settlement($scope.orderInitParams).success(function(e,t,o,s){if(0==e.success)PopupService.showToast(e.message);else if(1==e.success&&null!=e.data){var i=new Date;i.setDate(i.getDate()+1),$cookies.put("is_book","",{expires:i,path:"/"}),$state.go("orderConfirm",{orderInitParams:JSON.stringify($scope.orderInitParams)})}else PopupService.showToast("结算失败")})},$scope.predesgin=function(){confirmPopup=$ionicPopup.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:$scope})},$scope.colsepop=function(){confirmPopup.close()},$scope.yuyue=function(){if(0==$scope.usermes.name.length)PopupService.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test($scope.usermes.name))PopupService.showToast("姓名不能包含非法字符");else if(0==$scope.usermes.mobl.length)PopupService.showToast("请输入手机号");else if($scope.globalConstant.mobileNumberRegExp.test($scope.usermes.mobl)){switch($scope.pid){case 2:$scope.cityname="北京市";break;case 3:$scope.cityname="天津市";break;case 10:$scope.cityname="上海市";break;case 23:$scope.cityname="重庆市"}itSoluteDetailService.yuyue($scope.cid,$scope.solutionId,1,$scope.usermes.mobl,$scope.usermes.name,$scope.pid,$scope.aid,$scope.cityname).success(function(e){e.data?(PopupService.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),confirmPopup.close()):PopupService.showToast(e.message)}).error(function(e){PopupService.showToast("网络错误，检查网络后再试")})}else PopupService.showToast("请输入正确的手机号格式")},$scope.goshare=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.sharedesp,o=$scope.soluDetail.introduction,s=$scope.shareimg?$scope.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",i=UrlService.getShareLinkHeader()+"itSoluteDetail/"+$scope.solutionId;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1};var screenHeight=window.innerHeight,topHeight=373,topDis=87,contentHeight=screenHeight-topHeight+"px",hig=screenHeight-313+"px",topDisHeight=topDis+"px";$scope.contentHeight={height:contentHeight},$scope.hig={height:hig},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="PRODUCT_DETAIL_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={};$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,ProductDetailService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,ProductDetailService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){"定位中···"!=$rootScope.globalConstant.autoPosition&&(addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName,$scope.addressModal.hide(),$scope.predesgin())},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!1}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.predesgin()},$scope.goProductDetail=function(){$scope.StoreMsgModal.hide()},$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction);else{$scope.detailList=[],$scope.obj={},$scope.num=-1,$scope.arr=[],$scope.productListMore=[],$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.defaultValue=null,$scope.dataAdd=null,$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;var o=CommonAddressService.getAddressInfo();$scope.getarr=o.provinceName+o.cityName+o.regionName+o.streetName,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.cityname=o.cityName,$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0),$scope.init()}})}]),APP.service("itSoluteDetailService",["$http","UrlService",function(e,t){this.soluteDetail=function(o){var s={id:o};return e.get(t.getNewUrl("ITSOLU_DETAIL"),s)},this.productList=function(o,s,i,a,n,r){var c={productsIds:o,streetId:s,storeId:i,cityId:a,provinceId:n,regionId:r};return e.get(t.getNewUrl("ITSOLU_PRODUCTLIST"),c)},this.yuyue=function(o,s,i,a,n,r,c,l){var d={channel:1,cityId:o,cityName:l,detailsId:Number(s),itemsId:i,mobile:a,name:n,provinceId:r,regionId:c};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:d})}}]),APP.controller("lifeController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","lifeService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,lifeService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(){getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId})}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),getFurnishAllData(),lifeService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0)}),lifeService.gethomeMessage().success(function(e){}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.enter",function(e,t){"back"!=$scope.direction&&$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("lifeService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))},this.gethomeMessage=function(){return e.get(t.getNewUrl("LIFE_SERVICES"))}}]),APP.controller("newHomeController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeService","ProductDetailService","newHomeMakeService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeService,ProductDetailService,newHomeMakeService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}$rootScope.scrollNum="";var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.isAdress=!1,$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId}
;$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.gotoFullhouseSolution=function(e){$state.go("fullHouseSolution",{soluteId:e})},$scope.loadMore=function(){$scope.pageindex1++,newHomeMakeService.getTopic(1,1,$scope.pageindex1,6).success(function(e){$scope.smartLife.storys=$scope.smartLife.storys.concat(e.data.storys),e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)})},$scope.init=function(){function e(e){$scope.lons=e.position.getLng(),$scope.lat=e.position.getLat(),$scope.cityIds=CommonAddressService.getAddressInfo().cityId+"",newHomeService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)})}function t(e){$scope.cityIds=173,newHomeService.getRecently($scope.cityIds,1,36.108883,120.457091,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)})}newHomeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.programtitle=e.data.program.title,$scope.recommend=e.data.recommend.recommends,$scope.recommendtitle=e.data.recommend.title,$scope.recommendId=e.data.recommend.id,$scope.scenes=e.data.scenes,$timeout(function(){new Swiper(".swiper-container",{pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return 0==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[0].name+"</i></span>":1==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[1].name+"</i></span>":2==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[2].name+"</i></span>":3==e?'<span class="'+t+' loopNav lastNav"><i>'+$scope.scenes[3].name+"</i></span>":void 0}}}).update()},100)}),newHomeMakeService.getTopic(0,1,1,2).success(function(e){$scope.videoFeel=e.data}),$scope.pageindex1=1,newHomeMakeService.getTopic(1,1,$scope.pageindex1,6).success(function(e){$scope.smartLife=e.data,e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)})}),new AMap.Map("").plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation;o.getCurrentPosition(),AMap.event.addListener(o,"complete",e),AMap.event.addListener(o,"error",t)})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.active=function(){$scope.isActive=!1;nomess=void 0},$scope.noMessage=function(){$scope.isNoMessage=!1},$scope.goHD=function(e,t){"1"==e?""==t.storeId?$state.go("productDetail",{fromType:t.fromType,fromUrl:t.fromUrl,o2oType:t.o2oType,productId:t.productId,storeId:$scope.storeId}):$state.go("productDetail",{fromType:t.fromType,fromUrl:t.fromUrl,o2oType:t.o2oType,productId:t.productId,storeId:t.storeId}):"2"==e?t.id?$state.go("couponsDetail",{cId:t.id,userID:$scope.storeId,type:2}):$state.go("getCouponsList"):"3"==e?$state.go("game",{gameId:t.gameId}):"4"==e?"日常活动"==t.activityType?BannerThemeService.getBannerTheme(t.bannerId).success(function(e){$state.go("bannerDaily",{bannerId:t.bannerId,layout:e.data.layout})}):"主题活动"==t.activityType&&$state.go("bannerTheme",{bannerId:t.bannerId}):"5"==e&&$state.go("customizehd",{url:t.url})},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHome"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$scope.toNoteDetails=function(e,t,o){$state.go("noteDetails",{noteId:e})},$scope.meitu=function(e){$state.go("homeMakeList",{index:e})};var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!1,$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1},1e3):(setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)},this.getRecently=function(o,s,i,a,n){var r={cityId:o,itemsId:s,latitude:i,longitude:a,type:n};return e.get(t.getNewUrl("RECENTLY_WORK"),r)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeLifeController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeLifeService","ProductDetailService","HomePageService","WhiteShowsService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeLifeService,ProductDetailService,HomePageService,WhiteShowsService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeLifeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,newHomeLifeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),newHomeLifeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeLifeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeLifeService.getLifeDetail($scope.streetId,$scope.areaId,$scope.provinceId,$scope.cityId).success(function(e){for(var t=0;t<e.data.length;t++)0==e.data[t].id?$scope.relaxList=e.data[t].products:1==e.data[t].id&&($scope.onlyList=e.data[t].products)}),newHomeLifeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeLife"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goBranchType=function(){$state.go("branchTypeDetail",{productCateId:"productCateId=3315"})},$scope.goToApplyForCard=function(){newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):$state.go("applyForCard")})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isWhatApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isWhatApp="android":$scope.isWhatApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isWhatApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.toApplyForWhite=function(){if(!UserService.getUser().accessToken)return void PopupService.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&$state.go("login")})),100==e.errorCode&&$state.go("login")})},$scope.goToEmc=function(){
$scope.isApp?HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):HomePageService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()});var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeLifeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:6})},this.getTopic=function(){return e.get(t.getNewUrl("NEW_HOME_TOPIC"))},this.getLifeDetail=function(o,s,i,a){var n={streetId:o,regionId:s,provinceId:i,cityId:a};return e.get(t.getNewUrl("LIFE_SERVICES"),n)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeMakeController",["$ionicPlatform","$ionicPopup","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeMakeService","ProductDetailService","WhiteShowsService",function($ionicPlatform,$ionicPopup,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeMakeService,ProductDetailService,WhiteShowsService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeMakeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName;var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1;$scope.usermes={name:"",mobl:""};var locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeMakeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.isOrder&&$scope.predesgin()},$scope.toApplyForWhite=function(){if(!UserService.getUser().accessToken)return void PopupService.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&$state.go("login")})),100==e.errorCode&&$state.go("login")})},$scope.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&$timeout(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else $scope.kfTocken=$localstorage.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$scope.kfTocken);return},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.isOrder&&confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.predesgin=function(){$scope.isOrder=!0,confirmPopup=$ionicPopup.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:$scope})},$scope.colsepop=function(){confirmPopup.close()},$scope.yuyue=function(){if(0==$scope.usermes.name.length)PopupService.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test($scope.usermes.name))PopupService.showToast("姓名不能包含非法字符");else if(0==$scope.usermes.mobl.length)PopupService.showToast("请输入手机号");else if($scope.globalConstant.mobileNumberRegExp.test($scope.usermes.mobl)){switch($scope.pid){case 2:$scope.cityname="北京市";break;case 3:$scope.cityname="天津市";break;case 10:$scope.cityname="上海市";break;case 23:$scope.cityname="重庆市"}newHomeMakeService.yuyue($scope.cid,$scope.cityname,"","",2,$scope.usermes.mobl,$scope.usermes.name,$scope.pid,$scope.aid).success(function(e){e.data&&e.success?(PopupService.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),confirmPopup.close()):PopupService.showToast(e.message)}).error(function(e){PopupService.showToast("网络错误，检查网络后再试")})}else PopupService.showToast("请输入正确的手机号格式")},$scope.loadMore=function(){$scope.pageIndex1++,newHomeMakeService.getTopic(5,2,$scope.pageIndex1,6).success(function(e){$scope.feelLike=$scope.feelLike.concat(e.data.storys),e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)})},$scope.init=function(){$scope.isOrder=!1,newHomeMakeService.getSmartHome().success(function(e){$scope.recommend=e.data.recommend.recommends}),newHomeMakeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.pageIndex1=1,newHomeMakeService.getTopic(5,2,$scope.pageIndex1,6).success(function(e){$scope.feelLike=e.data.storys,e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeMakeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeMakeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales()})},$scope.gotoactList=function(){$state.go("homeMakeActList")},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeMake"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()}),$scope.meitu=function(e){$state.go("homeMakeList",{index:e})};var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!1,$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeMakeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("HOME_MAKE"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:2})},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)},this.yuyue=function(o,s,i,a,n,r,c,l,d){var p={channel:1,cityId:o,cityName:s,designerId:i,detailsId:a,itemsId:n,mobile:r,name:c,provinceId:l,regionId:d};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:p})},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},
this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeOrderController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeLifeService","ProductDetailService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeLifeService,ProductDetailService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeLifeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.urls="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+$localstorage.get("sg_login_token_secret").substring(6),$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeLifeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$(".orderContent").html('<iframe style="width:100%;height:100%;" src='+$scope.urls+"></iframe>"),newHomeLifeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),newHomeLifeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeLifeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeLifeService.getLifeDetail($scope.streetId,$scope.areaId,$scope.provinceId,$scope.cityId).success(function(e){for(var t=0;t<e.data.length;t++)0==e.data[t].id?$scope.relaxList=e.data[t].products:1==e.data[t].id&&($scope.onlyList=e.data[t].products)}),newHomeLifeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeOrder"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()});var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.urls="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+$localstorage.get("sg_login_token_secret").substring(6),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeLifeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:6})},this.getTopic=function(){return e.get(t.getNewUrl("NEW_HOME_TOPIC"))},this.getLifeDetail=function(o,s,i,a){var n={streetId:o,regionId:s,provinceId:i,cityId:a};return e.get(t.getNewUrl("LIFE_SERVICES"),n)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newTestingStoreController",["$ionicPlatform","$ionicPopup","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeMakeService","ProductDetailService","WhiteShowsService","newTestingStoreService",function($ionicPlatform,$ionicPopup,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeMakeService,ProductDetailService,WhiteShowsService,newTestingStoreService){function getAddress(){addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName;var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.banner=[],$scope.types=[],$scope.nearByList=[];var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.isOrder&&$scope.predesgin()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.isOrder&&confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,
$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){function e(e){$scope.lons=e.position.getLng(),$scope.lat=e.position.getLat(),$scope.cityIds=CommonAddressService.getAddressInfo().cityId+"",newTestingStoreService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)}),newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data)):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data)))})}function t(e){$scope.lons=120.45709,$scope.lat=36.108883,$scope.cityIds=173,newTestingStoreService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)}),newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data)):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data)))})}$scope.defaultValue=null,$scope.dataAdd=null,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeMakeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId}),newTestingStoreService.getbanner().success(function(e){$scope.banner=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("test_slide_box").loop(!0)}),newTestingStoreService.getNearbyType().success(function(e){$scope.types=e.data}),new AMap.Map("").plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation;o.getCurrentPosition(),AMap.event.addListener(o,"complete",e),AMap.event.addListener(o,"error",t)}),$scope.loadmore=function(){$scope.pageIndex++,newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data),$scope.$broadcast("scroll.infiniteScrollComplete")):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data),$scope.$broadcast("scroll.infiniteScrollComplete")))})}},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.settingsList="";var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!0,$scope.pageIndex=1,$scope.nearByList=[],$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction||(GetSwitchChecked(),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newTestingStoreService",["$http","UrlService",function(e,t){this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:7})},this.getNearbyType=function(){return e.get(t.getNewUrl("NEARBY_TYPES"))},this.getRecently=function(o,s,i,a,n){var r={cityId:o,itemsId:s,latitude:i,longitude:a,type:n};return e.get(t.getNewUrl("RECENTLY_WORK"),r)},this.getNearbyList=function(o,s,i,a,n,r,c){var l={cityId:o,itemsId:s,latitude:i,longitude:a,pageIndex:n,pageSize:r,type:c};return e.get(t.getNewUrl("NEARBY_LIST"),l)}}]),APP.controller("newHomesendCtrl",["$stateParams","$scope","$ionicModal","$q","newHomeService","ProductDetailService","GoodsSearchService","ShopService","$http","CalculateStrLength","GoodsService","CLASSIFYMESSAGECRNTERService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService","CommonAddressService",function($stateParams,$scope,$ionicModal,$q,newHomeService,ProductDetailService,GoodsSearchService,ShopService,$http,CalculateStrLength,GoodsService,CLASSIFYMESSAGECRNTERService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService,CommonAddressService){function add(e,t){var o=new Date,s=t,i=o.getTime(),a=$interval(function(){i+=1e3;var e=parseInt((s-i)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),r=e-24*t*60*60-60*n*60,c=parseInt(r/60),l=e-24*t*60*60-60*n*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(n)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(a))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="";var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))}),$scope.defaultValue=null,$scope.dataAdd=null,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress()}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var s={from:o};return e.get(t.getZCUrl("SUC_ZHONGCHOU"),s)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("smartApplianceController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","smartApplianceService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,smartApplianceService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),smartApplianceService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),smartApplianceService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0),void 0===$scope.swpcfurnish1?$timeout(function(){new Swiper(".swiper-container",{pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return 0==e?'<span class="'+t+' loopNav"><i>智慧客厅</i></span>':1==e?'<span class="'+t+' loopNav"><i>智慧厨房</i></span>':2==e?'<span class="'+t+' loopNav"><i>智慧浴室</i></span>':3==e?'<span class="'+t+' loopNav lastNav"><i>智慧卧室</i></span>':void 0}}})},100):$scope.swpcfurnish1.update()}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last) a").css("color","#000000"),$("div.furnish_xScroll div:eq(0) a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s}),$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if($timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("smartApplianceService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("NewsuperMarketController",["ProductDetailService","newHomeService","GoodsSearchService","$localstorage","$ionicModal","$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(ProductDetailService,newHomeService,GoodsSearchService,$localstorage,$ionicModal,$ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),
superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css({color:"#000000","border-left":"0px solid #eee","border-right":"0px solid #eee","border-bottom":"1px solid #EEEEEE"}),$("div.superMarket_xScroll div:eq("+e+")").css({color:"#FF6026","border-left":"1px solid #eee","border-right":"1px solid #eee","border-bottom":"0px solid #eee"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseTypes=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$scope.navImg=[$rootScope.imgBaseURL+"img/supermarket/super1.png",$rootScope.imgBaseURL+"img/supermarket/super2.png",$rootScope.imgBaseURL+"img/supermarket/super3.png",$rootScope.imgBaseURL+"img/supermarket/super4.png",$rootScope.imgBaseURL+"img/supermarket/super5.png",$rootScope.imgBaseURL+"img/supermarket/super6.png",$rootScope.imgBaseURL+"img/supermarket/super7.png",$rootScope.imgBaseURL+"img/supermarket/super8.png",$rootScope.imgBaseURL+"img/supermarket/super9.png",$rootScope.imgBaseURL+"img/supermarket/super10.png",$rootScope.imgBaseURL+"img/supermarket/super11.png",$rootScope.imgBaseURL+"img/supermarket/super12.png",$rootScope.imgBaseURL+"img/supermarket/super13.png",$rootScope.imgBaseURL+"img/supermarket/super14.png",$rootScope.imgBaseURL+"img/supermarket/super15.png"],$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)})})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();$("div.superMarket_xScroll div").eq(0).width(),$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css({color:"#000000","border-left":"0px solid #eee","border-right":"0px solid #eee","border-bottom":"1px solid #EEEEEE"}),$("div.superMarket_xScroll div:eq(0)").css({color:"#FF6026","border-left":"1px solid #eee","border-right":"1px solid #eee","border-bottom":"0px solid #eee"}),$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),APP.controller("testingStoreListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","HomePageService","CalculateStrLength","homeMakeActListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","newTestingStoreService","CommonAddressService","testingStoreListService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"105px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"89px"}),p.storetype=function(e){s.scrollTop(),p.nearbyType=e,p.pageIndex=1,p.nolist=!1,S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,p.lat,p.lons,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)})},p.init=function(){p.pageIndex=1,v.getNearbyType().success(function(e){p.types=e.data}),p.lons=h.globalConstant.lon,p.lat=h.globalConstant.lat,h.globalConstant.positionStatus?(p.cityIds=$.getAddressInfo().cityId+"",S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,p.lat,p.lons,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)})):(p.cityIds=173,S.getNearbyList(p.cityIds,1,36.108883,120.45709,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,36.108883,120.457091,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)}))},p.loadmore=function(){p.pageIndex++,S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){p.lists=p.lists.concat(e.data),0==e.data.length?(p.hasmore=!1,p.$broadcast("scroll.infiniteScrollComplete")):(p.hasmore=!0,p.$broadcast("scroll.infiniteScrollComplete"))})},p.goBack=ionic.Utils.debounce(function(){e.goBack()},300),p.$on("$ionicView.beforeLeave",function(e,t){}),p.settingsList="",p.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction||(p.types=[],p.nolist=!1,p.nearbyType=u.nearbyType,p.storeId=m.getUser().mid,p.init())})}]),APP.service("testingStoreListService",["$http","UrlService",function(e,t){this.getRecently=function(o,s,i,a,n,r){var c={cityId:o,itemsId:s,latitude:i,longitude:a,type:n,nearbyType:r};return e.get(t.getNewUrl("RECENTLY_WORK"),c)},this.getNearbyList=function(o,s,i,a,n,r,c,l){var d={cityId:o,itemsId:s,latitude:i,longitude:a,pageIndex:n,pageSize:r,type:c,nearbyType:l};return e.get(t.getNewUrl("NEARBY_LIST"),d)}}]),APP.controller("zhcjController",["$q","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","zhcjService","$timeout","$localstorage","PopupService","GoodsService","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService","$ionicHistory","PersonalCenterService",function($q,$cookies,$stateParams,$scope,$rootScope,UrlService,UserService,$state,$http,zhcjService,$timeout,$localstorage,PopupService,GoodsService,$ionicScrollDelegate,ProductDetailService,CommonAddressService,CartService,$ionicHistory,PersonalCenterService){function getdatas(e){zhcjService.soluteproduct(e).success(function(e){$scope.tablabels=e.data.labels,$scope.productIds=e.data.productsIds,zhcjService.productList($scope.productIds,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productList=e.data;for(var t=0;t<$scope.productList.length;t++)$scope.productTotalprice+=$scope.productList[t].price,$scope.selectcommsion+=$scope.productList[t].commission,$scope.productList[t].checked=!0;$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice,$scope.all.isAllChecked=!0})})}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.streetId=addressMessage.streetId,deferred.resolve(addressMessage);else{var obj={provinceId:"16",cityId:"173",areaId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}var confirmPopup;$scope.solutionId=$stateParams.solutionId,$scope.soluDetail={},$scope.productIds="",$scope.productList=[],$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,$scope.index=0,$scope.showfiltermodel=!1,$scope.showzhezhao=!1,$scope.showcjjsmodel=!1,$scope.showprodetailmodel=!1,$scope.prointion={},$scope.printstyle={},$scope.all={isAllChecked:!0},$scope.orderInitParams=null,$scope.pid=0,$scope.cid=0,$scope.aid=0,$scope.goback=function(){$state.go("newHome")},$scope.openFilterModal=function(){if($scope.showfiltermodel=!0,$scope.showzhezhao=!0,-1!=ionic.Platform.platform().indexOf("ios")){$scope.prostyle={overflow:"hidden"};var e,t=0;$("#zijihuadong_"+$scope.solutionId).on("touchmove",function(o){var s=o.changedTouches[0].pageX;e>s&&(t>=0||(t+=10,$("#wohuadong_"+$scope.solutionId).css("top",t+"px"))),e<s&&(-t>=$("#wohuadong_"+$scope.solutionId).width()-$("#zijihuadong_"+$scope.solutionId).width()||(t-=10,$("#wohuadong_"+$scope.solutionId).css("top",t+"px"))),e=o.changedTouches[0].pageX})}else $scope.prostyle={overflow:"auto"}},$scope.openjieshaoModal=function(){$scope.showzhezhao=!0,$scope.showcjjsmodel=!0},$scope.openpromodel=function(e){$scope.showzhezhao=!0,$scope.showprodetailmodel=!0;for(var t=0;t<$scope.productList.length;t++)$scope.productList[t].id==e&&($scope.prointion=$scope.productList[t])},$scope.closezhezhao=function(){$scope.showzhezhao=!1,1==$scope.showfiltermodel&&($scope.showfiltermodel=!1),1==$scope.showcjjsmodel&&($scope.showcjjsmodel=!1),1==$scope.showprodetailmodel&&($scope.showprodetailmodel=!1)},$scope.init=function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;$scope.clientHeight=e,$scope.clientWidth=t,$scope.printstyle={height:e+"px",width:t+"px",top:(t-e)/2+"px",left:0-(t-e)/2+"px",transform:"rotate(90deg)","transform-origin":"50% 50%"};var o="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(o,function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;e>t?($scope.clientHeight=t,$scope.clientWidth=e,$scope.printstyle={height:t+"px",width:e+"px",top:0,left:0,transform:"none","transform-origin":"50% 50%"}):($scope.clientHeight=e,$scope.clientWidth=t,$scope.printstyle={height:e+"px",width:t+"px",top:(t-e)/2+"px",left:0-(t-e)/2+"px",transform:"rotate(90deg)","transform-origin":"50% 50%"})},!1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,$scope.index=0,$scope.showfiltermodel=!1,$scope.showzhezhao=!1,$scope.showcjjsmodel=!1,$scope.showprodetailmodel=!1,$scope.zhimgUrl="",$scope.zhintroduction="",zhcjService.soluteDetail($scope.solutionId).success(function(e){e.success&&e.data&&($scope.soluDetail=e.data[0].spaces,$scope.zhimgUrl=$scope.soluDetail[0].imageUrl,$scope.zhintroduction=$scope.soluDetail[0].introduction,getdatas($scope.soluDetail[0].id))})},$scope.chooseTab=function(e,t){$scope.index=e,$scope.zhimgUrl=t.imageUrl,$scope.zhintroduction=t.introduction,$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getdatas(t.id)},$scope.select=function(e){$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var t=0;t<$scope.productList.length;t++){if(1!=$scope.productList[t].checked){$scope.all.isAllChecked=!1;break}$scope.all.isAllChecked=!0}for(var o=0;o<$scope.productList.length;o++)1==$scope.productList[o].checked&&($scope.selectprice+=$scope.productList[o].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[o].commission)},$scope.selectall=function(){if($scope.all.isAllChecked){$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!0,$scope.selectcommsion+=$scope.productList[e].commission}else{$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!1}},$scope.placeorder=function(){if(!UserService.getUser().mid)return void $state.go("login");for(var e=[],t=0;t<$scope.productList.length;t++)$scope.productList[t].checked&&e.push({proId:$scope.productList[t].id,num:1});$scope.orderInitParams={proList:e,street:$scope.streetId},CartService.settlement($scope.orderInitParams).success(function(e,t,o,s){if(0==e.success)PopupService.showToast(e.message);else if(1==e.success&&null!=e.data){var i=new Date;i.setDate(i.getDate()+1),$cookies.put("is_book","",{expires:i,path:"/"}),$state.go("orderConfirm",{orderInitParams:JSON.stringify($scope.orderInitParams)})}else PopupService.showToast("结算失败")})},$scope.goBack=function(){$state.go("newHome")},$scope.$on("$ionicView.beforeEnter",function(e,t){if(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&window.emc.configDeviceDriection("1"),"back"==t.direction){"login"==$ionicHistory.viewHistory().forwardView.stateName&&($scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.init())}else $scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&window.emc.configDeviceDriection("2")})}]),APP.service("zhcjService",["$http","UrlService",function(e,t){this.soluteDetail=function(o){var s={channel:1,scenesId:o};return e.get(t.getNewUrl("SMART_SCENES"),s)},this.soluteproduct=function(o){var s={spaceId:o};return e.get(t.getNewUrl("SMART_SPACE"),s)},this.productList=function(o,s,i,a,n,r){var c={productsIds:o,streetId:s,memberId:i,cityId:a,provinceId:n,regionId:r};return e.get(t.getNewUrl("ITSOLU_PRODUCTLIST"),c)}}]),APP.controller("monthRewardController",["$scope","$stateParams","HelpDetailService","UrlService","PlatformService","monthRewardService",function(e,t,o,s,i,a){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.monthList=[];e.init=function(){a.getRevenueList(e.earningType,e.type,"Y",0,10).success(function(t){e.monthList=t.data.rewardY})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("monthRewardService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n){var r={earningType:o,type:s,rewardType:i,page:a,pageSize:n};return e.get(t.getUrl("REVENUE_LIST"),r)}}]),APP.controller("otherRewardController",["$scope","$stateParams","UrlService","PlatformService","monthRewardService",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.total=0,e.otherList=[];e.init=function(){i.getRevenueList(e.earningType,e.type,"OTHER",0,10).success(function(t){e.total=t.data.rewardO.expectOtherAmount,e.otherList=t.data.rewardOther})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("someRewardController",["$scope","$stateParams","UrlService","$ionicPopup","monthRewardService",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardType=t.rewardType,e.someList=[],e.someDetail={};var a,n;e.init=function(){n="reward"+e.rewardType,i.getRevenueList(e.earningType,e.type,e.rewardType,0,10).success(function(t){t.data[n]instanceof Array?e.someList=t.data[n]:(e.someList=[],e.someList.push(t.data[n]))})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.lookReward=function(t){e.someDetail=t,a=s.show({cssClass:"xvv-popupSome",template:'<div class="xvv-some"><div>抵扣金额</div><p class="radiubox"><i></i><span></span><span></span></p><div class="xvv-overflow"><div class="xvv-det" ng-repeat="item in someDetail.sgDeductionDetails"><div><p>此单抵扣<span>{{item.deductibleAmount|currency:"&yen"}}</span></p><p>抵扣单号<span>{{item.reverseNetSn}}</span></p><p>抵扣类型<span>{{item.deductibleType}}<span></p></div></div></div><div ng-click="closesome()">确定</div></div>',scope:e})},e.closesome=function(){a.close()},e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("yongjinDetailController",["$scope","$stateParams","UrlService","yongjinDetailService","$ionicPopup",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardStart=t.start,e.rewardEnd=t.end,e.hasMoreData=!1,e.tanKdetail={};var a,n,r=0;e.loadData=function(t,o,i,a,n,r,c){s.getRevenueList(t,o,i,a,n,r,c).success(function(t){t.data.list?(e.revenueList=0==a?t.data.list:e.revenueList.concat(t.data.list),e.hasMoreData=t.data.list.length==n,e.$broadcast("scroll.infiniteScrollComplete")):e.hasMoreData=!1})},e.loadMore=function(){r+=1,e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.lookDetail=function(t){e.tanKdetail=t,1==e.type?a=i.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><p>类型</p><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p></div><div><p>{{tanKdetail.rewardTypeStr}}</p><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div ng-click="closeDetail()">确定</div></div>',scope:e}):n=i.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin2"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><div style="width:3.68rem;"><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">抵扣金额</p></div><div><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">{{tanKdetail.deductionAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div class="xvv-yongjinother" ng-repeat="i in tanKdetail.sgDeductionDetails"><div style="color:#7A87A3"><p>抵扣单号<span>{{i.reverseNetSn}}</span></p><p>抵扣类型<span>{{i.deductibleType}}</span></p><p>此单抵扣<span>{{i.deductibleAmount|currency:"&yen"}}</span></p></div></div></div><div ng-click="closeDetail()">确定</div></div>',scope:e})},e.closeDetail=function(){1==e.type?a.close():n.close()},e.init=function(){e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("yongjinDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n,r,c){var l={earningType:o,type:s,rewardType:i,page:a,pageSize:n,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]);=======
templateUrl:"templates/quanzi/TestPage.html",controller:"TestPageController"}).state("testDetails",{url:"/testDetails",templateUrl:"templates/quanzi/TestDetails.html",controller:"TestDetailsController"}).state("questionDetails",{url:"/questionDetails/:wordsId",templateUrl:"templates/quanzi/QuestionDetails.html",controller:"QuestionDetailsController"}).state("topic.qhot",{url:"/qhot",views:{"topic-qhot":{templateUrl:"templates/quanzi/qhot.html",controller:"QhotController"}}}).state("topic.qmine",{url:"/qmine",views:{"topic-qmine":{templateUrl:"templates/quanzi/qmine.html",controller:"QmineController"}},requiredLogin:!0}).state("topic.qwschool",{url:"/qwschool",views:{"topic-qwschool":{templateUrl:"templates/quanzi/qwschool.html",controller:"QwschoolController"}}}).state("heIssue",{url:"/heIssue/:title/:who/:id",templateUrl:"templates/quanzi/heIssue.html",controller:"heIssueController",requiredLogin:!0}).state("qdatabase",{url:"/qdatabase",templateUrl:"templates/quanzi/qdatabase.html",controller:"QdatabaseController"}).state("topicdetails",{url:"/topicdetails",templateUrl:"templates/quanzi/Topicdetails.html",controller:"TopicdetailsController",params:{huatiid:null}}).state("qSearch",{url:"/qSearch",templateUrl:"templates/quanzi/qSearch.html",controller:"qSearchController"}).state("qSearchTwo",{url:"/qSearchTwo",templateUrl:"templates/quanzi/qSearchTwo.html",controller:"qSearchTwoController",params:{tagIds:null,tagname:null}}).state("qSearchThree",{url:"/qSearchThree",templateUrl:"templates/quanzi/qSearchThree.html",controller:"qSearchThreeController",params:{keywords:null}}).state("qSearchBiao",{url:"/qSearchBiao",templateUrl:"templates/quanzi/qSearchBiao.html",controller:"qSearchBiaoController",params:{keywords:null}}).state("qSearchTie",{url:"/qSearchTie",templateUrl:"templates/quanzi/qSearchTie.html",controller:"qSearchTieController",params:{keywords:null}}).state("qSearchUser",{url:"/qSearchUser",templateUrl:"templates/quanzi/qSearchUser.html",controller:"qSearchUserController",params:{keywords:null}}).state("personalHomepageMe",{url:"/personalHomepageMe",templateUrl:"templates/quanzi/personalHomepageMe.html",controller:"personalHomepageMeCtrl",requiredLogin:!0}).state("personalHomepageHe",{url:"/personalHomePageHe/:othersId",templateUrl:"templates/quanzi/personalHomePageHe.html",controller:"personalHomepageHeCtrl"}).state("myFollow",{url:"/personalHomepageMe/myFollow",templateUrl:"templates/quanzi/myFollow.html",controller:"myFollowCtrl"}).state("myFans",{url:"/personalHomepageMe/myFans",templateUrl:"templates/quanzi/myFans.html",controller:"myFansCtrl"}).state("moreInteresting",{url:"/personalHomepageMe/moreInteresting",templateUrl:"templates/quanzi/moreInteresting.html",controller:"moreInterestingCtrl"}).state("mySettings",{url:"/personalHomepageMe/mySettings",templateUrl:"templates/quanzi/mySettings.html",controller:"mySettingsCtrl"}).state("quanziRecommend",{url:"/quanziRecommend",templateUrl:"templates/quanzi/quanziRecommend.html",controller:"communityRecommendCtrl"}).state("exam",{url:"/exam",templateUrl:"templates/quanzi/exam.html",controller:"examCtrl"}).state("customerConversation",{url:"/customerConversation",templateUrl:"templates/quanzi/CustomerConversation.html",controller:"CustomerConversationController",params:{products:void 0}}).state("serviceConversation",{url:"/serviceConversation/:chatId/:from/:to",templateUrl:"templates/quanzi/ServiceConversation.html",controller:"ServiceConversationController"}).state("groupSetting",{url:"/groupSetting/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("discussionGroup",{url:"/discussionGroup/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("bankCard",{url:"/bankCard",templateUrl:"templates/mine/Bank/bankCard.html",controller:"BankCardController"}).state("bankCardDetail",{url:"/bankCardDetail/:cardNoShow/:nameKjt",templateUrl:"templates/mine/Bank/bankCardDetail.html",controller:"bankCardDetailController"}).state("chooseTheBank",{url:"/chooseTheBank",templateUrl:"templates/mine/Bank/chooseTheBank.html",controller:"chooseTheBankController"}).state("bankSupport",{url:"/bankSupport",templateUrl:"templates/mine/Bank/bankSupport.html",controller:"bankSupportController"}).state("mentionCenter",{url:"/mentionCenter/:canAmount",templateUrl:"templates/mine/Bank/mentionCenter.html",controller:"mentionCenterController",requiredLogin:!0}).state("dataAnalysis",{url:"/dataAnalysis/:memberId",templateUrl:"templates/statistics/dataAnalysis.html",controller:"dataAnalysisController"}).state("VisitorBrowHistory",{url:"/VisitorBrowHistory/:userId/:daysType",templateUrl:"templates/mine/VisitorBroHistory/VisitorBrowHistory.html",controller:"VisiBroHisController"}).state("Partner",{url:"/Partner/:title/:memberId",templateUrl:"templates/mine/Partner/Partner.html",controller:"PartnerController"}).state("team",{url:"/team",templateUrl:"templates/mine/teamData/team.html",controller:"TeamController"}).state("storeTeamOwner",{url:"/storeTeamOwner",templateUrl:"templates/mine/storeTeamOwner/storeTeamOwner.html",controller:"storeTeamOwnerController"}).state("teamProductMsg",{url:"/teamProductMsg/:num/:type",templateUrl:"templates/mine/storeTeamOwner/teamProductMsg.html",controller:"teamProductMsgController"}).state("schoolGroupDiscuss",{url:"/schoolGroupDiscuss",templateUrl:"templates/quanzi/SchoolGroupDiscuss.html",controller:"SchoolGroupDiscussController"}).state("circleGroupDiscuss",{url:"/circleGroupDiscuss/:groupId/:circleId",templateUrl:"templates/quanzi/CircleGroupDiscuss.html",controller:"CircleGroupDiscussController"}).state("groupAddMember",{url:"/groupAddMember/:groupId/:circleId",templateUrl:"templates/quanzi/GroupAddMember.html",controller:"GroupAddMemberController"}).state("groupEditMember",{url:"/groupEditMember/:groupId",templateUrl:"templates/quanzi/GroupEditMember.html",controller:"GroupEditMemberController"}).state("groupsToShare",{url:"/groupsToShare",templateUrl:"templates/quanzi/GroupsToShare.html",controller:"GroupsToShareController",params:{shareList:void 0}}).state("shareListPage",{url:"/shareListPage",templateUrl:"templates/quanzi/ShareListPage.html",controller:"ShareListPageController",params:{sl:void 0}}).state("feedbackPlus",{url:"/feedbackPlus",templateUrl:"templates/mine/FeedbackPlus.html",controller:"FeedbackPlusController"}).state("newSend",{url:"/newSend",templateUrl:"templates/newsend/newSend.html",controller:"newsendCtrl",cache:!1}).state("flashsale",{url:"/flashsale/:type",templateUrl:"templates/flashsale/flashsale.html",controller:"flashsaleCtrl",cache:!1}).state("newres",{url:"/newres/:type",templateUrl:"templates/newres/newres.html",controller:"newresCtrl",cache:!1}).state("myAppointment",{url:"/myAppointment",templateUrl:"templates/mine/myAppointment.html",controller:"myAppointmentController"}).state("presell",{url:"/presell",templateUrl:"templates/presell/presell.html",controller:"presellCtrl",cache:!1}).state("accsetting",{url:"/accsetting",templateUrl:"templates/mine/accsetting.html",controller:"accsettingCtrl"}).state("accsafe",{url:"/accsafe",templateUrl:"templates/mine/accsafe.html",controller:"accsafeCtrl"}).state("relatedProduct",{url:"/relatedProduct",templateUrl:"templates/quanzi/relatedProduct.html",controller:"relatedProductController"}).state("topicRewardList",{url:"/topicRewardList/:tipId",templateUrl:"templates/quanzi/topicRewardList.html",controller:"topicRewardListController"}).state("CircleSetAdmin",{url:"/CircleSetAdmin/:topicId",templateUrl:"templates/quanzi/CircleSetAdmin.html",controller:"CircleSetAdminController"}).state("selectAdmin",{url:"/selectAdmin/:topicId",templateUrl:"templates/quanzi/selectAdmin.html",controller:"selectAdminController",cache:!1}).state("manageUser",{url:"/manageUser/:topicId",templateUrl:"templates/quanzi/manageUser.html",controller:"manageUserController",cache:!1}).state("financialMoney",{url:"/financialMoney/:whereId",templateUrl:"templates/shop/financialMoney.html",controller:"FinancialMoneyController"}).state("applyForWhite",{url:"/applyForWhite",templateUrl:"templates/mine/wallet/ApplyForWhite.html",controller:"ApplyForWhiteController"}).state("bankCardChose",{url:"/bankCardChose/:orderSn/:totalAmount",templateUrl:"templates/order/bankCardPaymentList.html",controller:"BankCardChoseController"}).state("debitCardPayment",{url:"/debitCardPayment/:orderSn/:totalAmount/:whereName",templateUrl:"templates/order/debitCardPayment.html",controller:"debitCardPaymentController"}).state("applyForCard",{url:"/applyForCard",templateUrl:"templates/product/applyForCard.html",controller:"applyForCardController"}).state("spendBaiInstallment",{url:"/spendBaiInstallment/:orderSn",templateUrl:"templates/order/spendBaiInstallment.html",controller:"spendBaiInstallmentController"}).state("fullHouseSolution",{url:"/fullHouseSolution/:soluteId",templateUrl:"templates/product/newVision/fullHouseSolution.html",controller:"fullHouseSolutionController"}).state("houseSoluteDetail",{url:"/houseSoluteDetail/:solutionId",templateUrl:"templates/product/newVision/houseSoluteDetail.html",controller:"houseSolutionDetailController"}).state("exportDetail",{url:"/exportDetail/:exportId",templateUrl:"templates/product/newVision/exportDetail.html",controller:"exportDetailController"}).state("exStoreDetail",{url:"/exStoreDetail/:nearbyId",templateUrl:"templates/product/newVision/exStoreDetail.html",controller:"exStoreDetailController"}).state("itSoluteDetail",{url:"/itSoluteDetail/:solutionId/:shareId",templateUrl:"templates/product/newVision/itSoluteDetail.html",controller:"itSoluteDetailController"}).state("homeDetail",{url:"/homeDetail/:solutionId",templateUrl:"templates/product/newVision/homeDetail.html",controller:"homeDetailController"}).state("homeDesignsth",{url:"/homeDesignsth",templateUrl:"templates/product/newVision/homeDesignsth.html",controller:"homeDesignsthController"}).state("designDetail",{url:"/designDetail/:soluteId",templateUrl:"templates/product/newVision/designDetail.html",controller:"designDetailController"}).state("zhihuichangjing",{url:"/zhihuichangjing/:solutionId",templateUrl:"templates/product/newVision/zhihuichangjing.html",controller:"zhcjController"}).state("newHome",{url:"/newHome",templateUrl:"templates/product/newVision/newHome.html",controller:"newHomeController"}).state("newHomeMake",{url:"/newHomeMake",templateUrl:"templates/product/newVision/newHomeMake.html",controller:"newHomeMakeController"}).state("newTestingStore",{url:"/newTestingStore",templateUrl:"templates/product/newVision/newTestingStore.html",controller:"newTestingStoreController"}).state("newHomeLife",{url:"/newHomeLife",templateUrl:"templates/product/newVision/newHomeLife.html",controller:"newHomeLifeController"}).state("newHomeOrder",{url:"/newHomeOrder",templateUrl:"templates/product/newVision/newHomeOrder.html",controller:"newHomeOrderController"}).state("homeMakeList",{url:"/homeMakeList/:index",templateUrl:"templates/product/newVision/homeMakeList.html",controller:"homeMakeListController"}).state("homeMakeActList",{url:"/homeMakeActList",templateUrl:"templates/product/newVision/homeMakeActList.html",controller:"homeMakeActListController"}).state("testingStoreList",{url:"/testingStoreList/:nearbyType",templateUrl:"templates/product/newVision/testingStoreList.html",controller:"testingStoreListController"}).state("newHomeSend",{url:"/newHomeSend",templateUrl:"templates/product/newVision/newSend.html",controller:"newHomesendCtrl"}).state("newsuperMarket",{url:"/NewsuperMarket",templateUrl:"templates/product/newVision/superMarket.html",controller:"NewsuperMarketController"}),JSON.parse(window.localStorage.getItem("USER_CACHE_KEY"))?t.otherwise("/newHome"):t.otherwise("/guidePage/:")};route.$inject=["$stateProvider","$urlRouterProvider"],APP.run(["GoodsService","AccountMessageService","trueAuthenticationService","HomePageService","$ionicPlatform","$rootScope","UserService","$state","CacheService","$ionicHistory","$timeout","$ionicLoading","PopupService","$location","$ionicPopup","AreaService","CommonAddressService","LoginService","AdvertisementService","$localstorage","$http","UrlService","CreditService","IMService","ShareService","$interval","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b,A,P){function x(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function L(){var e=y.getUrl("JINBI_JILU");w.get(e).success(function(e){e.success})}function D(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return a.isCommission=o[i].list[0].checked,a.cashSwitch=o[i].list[1].checked,a.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0}}function N(){a.missionLists&&(a.missionLists(),a.missionLists=null)}function _(e){a.goldRainSwitch?a.isRaining||(a.isRaining=!0,goldFall(function(){a.isRaining=!1}),processLightMessage(e)):processLightMessage(e)}function O(e){e.levelOrder&&e.levelName&&u.levelUp(e.levelName,e.levelOrder,e.needCreditNum)}function k(){m.confirm({title:"<strong>退出应用</strong>",template:"确定要退出应用吗?",okText:"退出",okType:"button-assertive",cancelText:"取消"}).then(function(e){e&&ionic.Platform.exitApp()})}if(window.runRnCode=function(){$("[ng-click='goBack()']").not("[hasClick]").on("click",function(){0==l.viewHistory().histories.root.cursor&&window.postMessage("goback")}).attr("hasClick","1")},-1!=window.location.href.indexOf("sg_rn_app")){var E=window.location.href.indexOf("sg_rn_app"),U=window.location.href.slice(E+9),M=unescape(U),R=U.slice(U.indexOf("regionName")+17),B=R.slice(0,R.length-9),H=JSON.parse(M);window.RNmsg=H,a.RNmsg=window.RNmsg,n.setUser(window.RNmsg.userMsg),I.set("sg_login_token_secret",window.RNmsg.userMsg.userToken),e.addAddress(window.RNmsg.addressInfo.provinceId,window.RNmsg.addressInfo.cityId,window.RNmsg.addressInfo.areaId,decodeURIComponent(B),window.RNmsg.addressInfo.streetId).success(function(e,t,o,s){})}a.firstLocationPage=window.history.length,a.countTime=10,a.tooCrowdToastFlag=!1;var F;window.closeTooCrowdToast=function(){"确定"==$(".popup-body .countToast").html()&&(a.countTime=10,a.tooCrowdToastFlag=!1,F.close())},a.$on("tooCrowd",function(e,t){if(!a.tooCrowdToastFlag){a.tooCrowdToastFlag=!0;var o=A(function(){a.countTime-1<=0?($(".popup-body .countToast").html("确定"),A.cancel(o)):(a.countTime--,$(".popup-body .countToast").html(a.countTime+"s"))},1e3);F=m.show({template:'<div style="color: black;text-align: left;font-size: 12px;text-align:center;padding-bottom:20px;">'+t+'<div class="countToast" style="position: absolute;bottom: 0;left: 0;width: 100%;height: 34px;line-height:34px;border-top: 1px solid #3333" onClick="closeTooCrowdToast();">10s</div></div>',buttons:[]});var s=A(function(){a.tooCrowdToastFlag?"确定"!=$(".popup-body .countToast").html()?$(".popup-body .countToast").css("color","#666666"):$(".popup-body .countToast").css("color","#32BEFF"):A.cancel(s)},200)}}),a.couponXyzType=!1;var G=unescape(window.location.href),V=null;-1!=G.indexOf("circlePage/662")&&(V=G.substr(G.indexOf("&token=")+7)),V&&I.set("sg_login_token_secret","Bearer"+V),w.get(y.getUrl("TOKEN_LOGIN_GET")).success(function(e){e.data?I.set("sg_login_token_secret","Bearer"+e.data):I.set("sg_login_token_secret","Bearer"+P.generateUUID())}).error(function(e){I.set("sg_login_token_secret","Bearer"+P.generateUUID())}),a.globalConstant={},a.globalConstant.lon=120.457091,a.globalConstant.lat=36.108883,a.globalConstant.autoPosition="定位中···",a.globalConstant.positionStatus=!0,a.globalConstant.storeId="20219251",a.globalConstant.versionIOS="4.2.5",a.globalConstant.versionANDROID="4.2.5",a.globalConstant.androidDownLoadUrl="http://www.baidu.com",a.globalConstant.iosDownLoadUrl="http://www.baidu.com",a.globalConstant.mobileNumberRegExp=/^1([3578][0-9]|4[01356789]|66|9[89])\d{8}$/,a.globalConstant.passwordRegExp=/^((?=.*?\d)(?=.*?[A-Za-z])|(?=.*?\d)(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~])|(?=.*?[A-Za-z])(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]))[\dA-Za-z\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]{6,20}$/,a.imgBaseURL="//cdn09.ehaier.com/shunguang/H5/www/",a.tabsImg={background:"",wdHover:a.imgBaseURL+"img/newvision/Mine.png",fl:a.imgBaseURL+"img/newvision/guang@2x.png",flHover:a.imgBaseURL+"img/newvision/guang x@2x.png",sgHover:a.imgBaseURL+"img/newvision/home.png",gwcHover:a.imgBaseURL+"img/newvision/car.png",sq:a.imgBaseURL+"img/newvision/sqs.png",sqHover:a.imgBaseURL+"img/newvision/sq.png",wd:a.imgBaseURL+"img/newvision/Mines.png",sg:a.imgBaseURL+"img/newvision/homes.png",gwc:a.imgBaseURL+"img/newvision/cars.png"},a.tabsTextColor={wdHoverFontColor:"#2577e3",flFontColor:"gray",flHoverFontColor:"#2577e3",sgHoverFontColor:"#2577e3",gwcHoverFontColor:"#2577e3",sqFontColor:"gray",sqHoverFontColor:"#2577e3",wdFontColor:"gray",sgFontColor:"gray",gwcFontColor:"gray"};var j=y.getNewUrl("ACTIVITY_ICON_TABS_NEW");w.get(j,{iconType:2}).success(function(e){e.success&&null!==e.data&&(null!==e.data.iconImageConfig&&(a.tabsImg=e.data.iconImageConfig),null!==e.data.iconFontConfig&&(a.tabsTextColor=e.data.iconFontConfig))}),a.appIsPaused=!1,a.invoiceType=2;var z;x("loginId");x("loginId")?z=x("loginId"):(z=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}(),function(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}("loginId",z)),a.loginIsAccord=!1,a.loginIsAuthentication=!1,a.goUpgrade=function(){a.loginIsAccord=!1,r.go("newAuthenticationHome")},a.goAuthentication=function(){n.isUserLogin()?(a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("trueAuthenticationList")):r.go("login")},a.goMechanismDescription=function(){a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("MechanismDescription")},a.closePopup=function(){a.loginIsAccord=!1,a.loginIsAuthentication=!1,a.loginIsAccord2=!1},a.signOut=function(){if(n.isUserLogin()){a.userCount="",a.password="";void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}else r.go("login")},a.goChangePhoneNum=function(){n.isUserLogin()?(a.isCloseBtn?a.loginIsAuthentication=!0:a.loginIsAuthentication=!1,r.go("myPhoneManage")):r.go("login")},i.on("resume",function(){a.appIsPaused=!1,C.validateWebSocket(),n.getUser().mid&&L()}),i.on("pause",function(){a.appIsPaused=!0});var W=p.show,q=p.hide;a.curOrder=0,a.totalOrder=0,p.show=function(e){a.loadingStart=(new Date).getTime(),W(e),e.duration&&d(function(){a.loadingStart=0,a.curMsg=null},e.duration)},p.hide=function(){q(),a.loadingStart=0,a.curMsg=null},window.closeLevelUpPop=function(){p.hide(),a.isLevelUp=!1,processLightMessageQueue()},window.closeGoodCoupon=function(e){e.parentNode.parentNode.remove()},window.gomyCouponsList=function(e){e.parentNode.parentNode.parentNode.remove(),r.go("myCouponsList")},D(n.getUser().mid),a.$on("sessionTimeout",function(){n.clearUser(),r.go("login")});var J=null,Y=null,K=!1;a.registOrderSuccessCallback=function(e,t,o){K=!1,Y=e,t&&d(function(){!1===K&&o&&o(e,!0,null)},t),J=o},window.processMessage=function(e){if("advertisement"==a.toState||"shopApplySuccess"==a.toState||"trueAuthentication"==a.toState)return void Q.unshift(e);var t=e.messageType,o=e.extendData;"ORDER_COMMIT_RESULT"===t?J&&(K=!0,J(Y,!1,e)):(a.isLevelUp=a.isLevelUp||o.popupMessage&&null!=o.popupMessage,null==o||$.isEmptyObject(o)||(a.freshMission&&(N(),a.freshMission=!1),"1"==o.goldRain&&_(e.msg),"1"==o.openStoreReward&&u.showGoodCoupon(o.amount),null!=o.voiceMessage&&a.cashSwitch&&Z._playAudio(),o.popupMessage&&O(o),o.lightMessage&&processLightMessage(e.msg),o.dynamicMessage&&("productDetail"!=a.toState&&"homePage"!=a.toState||($(".mess-tip").html(e.msg),$(".mess-tip").css("display","block"),setTimeout(function(){$(".mess-tip").css("display","none")},3e3)))))},window.processMessageQueue=function(){for(D(n.getUser().mid);;){var e=Q.pop();if(!e)break;processMessage(e)}},window.processLightMessage=function(e){a.isLevelUp?X.unshift(e):u.goldIncrease(e)};var Q=[],X=[];a.$on("$stateChangeSuccess",function(e,i,c,l,p){if(a.fromState=l.name,a.toState=i.name,a.xnFromState=l,a.xnToState=i,a.xnFromParams=p,a.xnToParams=c,P.GetUserInfo(i.name,l.name,c),"advertisement"!=a.fromState&&"shopApplySuccess"!=a.fromState||processMessageQueue(),n.getUser().mid&&(gio_userId=n.getUser().mid,gio_userRole="1"==v.getRole()?1:0,window.gio&&(gio("setUserId",gio_userId),gio("people.set",{userRole:gio_userRole+""}))),("RegisterForStoreLogin"==a.fromState||"registerForStore"==a.fromState)&&"login"==a.toState){a.userCount="",a.password="";void 0==n.getUser().sessionValue?(n.clearUser(),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}if(!("login"!=a.fromState&&"RegisterForStoreLogin"!=a.fromState&&"register"!=a.fromState||"homePage"!=a.toState&&"personnalCenter"!=a.toState&&"cart"!=a.toState&&"productDetail"!=a.toState&&"messageCenter"!=a.toState&&"topic"!=a.toState&&"circlePage"!=a.toState&&"noteDetails"!=a.toState&&"allcircle"!=a.toState&&"personalHomePageHe "!=a.toState&&"newres"!=a.toState&&"crowd_funding_details"!=a.toState&&"getCouponsList"!=a.toState)){var g,f;g=I.get("OLDTIMEONE"),f=I.get("loginMemberId"),a.nowTime=(new Date).getDate(),v.checkOpenStore(a.loginMemberId).success(function(e,i,c,l){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){w.get(y.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(a.isBuyer=1,v.setRole(a.isBuyer),a.loginIsAccord=!1,a.loginIsAuthentication=!1,s.isWdHost().success(function(e){e.success?(a.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o?a.myPopups=m.show({template:a.o2oMessage,buttons:[{text:"退出",onTap:function(){a.userCount="",a.password="",void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}}]}):null==e.data.o2o?a.loginIsAuthentication=!1:o.doInit().success(function(e){e.success&&(e.data.isAuth?(a.loginIsAccord=!1,a.loginIsAuthentication=!1,n.isUserLogin()&&d(function(){u.showToast("登录成功，请继续您的旅程...")},800)):(a.isCloseBtn=e.data.forceAuthFlag,a.isCloseBtn?a.loginIsAuthentication=!0:g==a.nowTime&&a.loginMemberId==f?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(I.set("OLDTIMEONE",a.nowTime),I.set("loginMemberId",a.loginMemberId),n.isUserLogin()&&(a.loginIsAccord=!1,a.loginIsAuthentication=!0))))}))):u.showToast("获取数据信息失败！")})):(a.isBuyer=0,v.setRole(a.isBuyer),g==a.nowTime&&a.loginMemberId==f?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(I.set("OLDTIMEONE",a.nowTime),I.set("loginMemberId",a.loginMemberId),n.isUserLogin()&&(a.loginIsAuthentication=!1,window.cordova&&(a.loginIsAccord=!0),a.loginIsAccord=!1)))}).error(function(e){u.showToast("网络连接失败！")})}});var Z=new Cash;!function(){var e=function(e,t){return processMessage(e),!0};a.token=null,C.initWebSocket(e)}(),a.$on("REQUIRE_LOGIN",function(){c.get("REQUIRE_LOGIN_SHOW")||(c.set("REQUIRE_LOGIN_SHOW",!0),u.showConfirm("提示","尚未登录，是否去登录？",function(e){e?r.go("login"):n.clearUser(),c.set("REQUIRE_LOGIN_SHOW",!1)},"去登录"))});var ee=0;if(a.$on("LOADING:SHOW",function(){if(ee++,!a.isLoadShowing){var e={template:'<div style="width:35px;height:35px;background:#666666;border-radius:5px;"><img src="{{imgBaseURL}}img/ic_refresh_02.gif" style="width: 35px;height:35px;"/></div>',duration:7e3};p.show(e)}a.isLoadShowing=!0}),a.$on("LOADING:HIDE",function(){--ee<=0&&(a.isLoadShowing=!1,p.hide())}),s.isWdHost().success(function(e){a.isWdHost=e.data.isHost}),S.getAdImage().success(function(e){if(e.data[0]&&e.data[0].image){I.get("bannerId")!=e.data[0].bannerId&&(I.set("openCount",0),I.set("hasAD","noAD"));var t=e.data[0].image;I.set("hasAD",t),I.set("bannerId",e.data[0].bannerId)}else I.set("hasAD","noAD")}).error(function(e){I.set("hasAD","noAD")}),window._czc&&_czc.push(["_setAccount","1259430011"]),a.$on("$stateChangeSuccess",function(e,t,o,s,i){var a=g.$$absUrl.substring(location.origin.length);window._czc&&_czc.push(["_trackPageview",a]),window.doGetData&&doGetData()}),window.sgOnNotificationReceived=function(e){},n.isUserLogin()){var te=n.getUser().mid;v.checkOpenStore(te).success(function(e,i,c,l){e.data?(a.isBuyer=1,v.setRole(a.isBuyer),s.isWdHost().success(function(e){e.success?(a.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o?a.myPopup=m.show({template:a.o2oMessage,buttons:[{text:"退出",onTap:function(){a.userCount="",a.password="",void 0==n.getUser().sessionValue?(n.clearUser(),r.go("login"),v.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")):t.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,s){if(e.success){n.clearUser(),r.go("login"),v.setRole(void 0);var i="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",i),window.localStorage.setItem("isLogin",n.isUserLogin()),I.set("storeId","")}})}}]}):null==e.data.o2o?a.loginIsAuthentication=!1:o.doInit().success(function(e){e.success&&(e.data.isAuth?(a.loginIsAccord=!1,a.loginIsAuthentication=!1):(a.isCloseBtn=e.data.forceAuthFlag,a.loginIsAccord=!1,a.isCloseBtn&&(a.loginIsAuthentication=!0)))}))):u.showToast("获取数据信息失败！")})):(a.isBuyer=0,v.setRole(a.isBuyer))}).error(function(e){u.showToast("网络连接失败！")})}i.ready(function(){function e(e){d(function(){a.keyboardHeight={bottom:e.keyboardHeight+"px"};var t=e.keyboardHeight+25;a.contentMarginBottom={"margin-bottom":t+"px"}},100)}function t(e){d(function(){a.keyboardHeight={bottom:0},a.contentMarginBottom={"margin-bottom":0}},100)}function o(e){a.globalConstant.lon=e.position.getLng(),a.globalConstant.lat=e.position.getLat(),a.globalConstant.positionStatus=!0,h.addAddressInfo()}function s(e){a.globalConstant.positionStatus=!1,h.addAddressInfo()}navigator.splashscreen&&navigator.splashscreen.hide(),L();var i=y.getUrl("DEVICE_INFO"),n=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";if(window.UmengPush&&(window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken([],function(e){w.get(i+"?device_token="+e+"&device_type="+n)}),window.UmengPush.onReceiveMessage))try{window.UmengPush.onReceiveMessage(function(e){window.UmengPush.onReceiveMessage(arguments.callee,null),e&&T.getGameId(function(t){r.go("vip",{gameId:t,msg:e})})},null)}catch(e){}if(a.hasWechat=!1,window.wechatPay&&window.wechatPay.checkAppInstalled&&window.wechatPay.checkAppInstalled(function(e){a.hasWechat=!!e}),a.hasQQ=!0,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.cordova&&window.cordova.InAppBrowser&&(window.open=window.cordova.InAppBrowser.open),a.isIOS=!!window.cordova&&-1!=ionic.Platform.platform().indexOf("ios"),a.isApp=!!window.cordova||void 0,a.screenThreeWidth={height:(window.screen.width-50)/3+10+"px"},a.screenListThreeWidth={height:(window.screen.width-20)/3+"px"},-1!=ionic.Platform.platform().indexOf("ios")?(window.addEventListener("native.keyboardshow",e),window.addEventListener("native.keyboardhide",t)):d(function(){a.keyboardHeight={bottom:0}},100),!window.cordova){var c=navigator.userAgent,l=c.indexOf("Android")>-1||c.indexOf("Adr")>-1,p=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);a.downAppUrl=p?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":l?"http://app.qq.com/#id=detail&appid=1104761357":""}a.toDownLoad=function(){var e=a.isIOS?a.globalConstant.iosDownLoadUrl:a.globalConstant.androidDownLoadUrl;window.cordova?cordova.InAppBrowser.open(e,"_system"):window.open(e,"_system")},window.navigator.userAgent.indexOf("ShunGuangRN")<=-1&&(ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(e){a.globalConstant.lat=e.latitude,a.globalConstant.lon=e.longitude,h.addAddressInfo()},function(e){"12"==e.errorCode&&m.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">打开“定位服务”来允许“顺逛”确定您的位置</div><div style="color: #000;font-size: 12px;">顺逛将获取您的位置，为您提供更精准的服务</div>'}),h.addAddressInfo()}):(mapObj=new AMap.Map(""),mapObj.plugin("AMap.Geolocation",function(){var e=new AMap.Geolocation;e.getCurrentPosition(),AMap.event.addListener(e,"complete",o),AMap.event.addListener(e,"error",s)})))}),i.registerBackButtonAction(function(e){if("advertisement"==a.fromState)r.go("homePage");else if("/paymentxyz"==g.path().substring(0,11)){var t=l.viewHistory().backView;"orderManage"==t.stateName?l.goBack(-1):l.goBack(-2)}else if("orderManage"==l.currentStateName())l.backView()?"batchDeleteOrder"==l.viewHistory().backView.stateName?l.goBack(-2):"afterOrderSubmit"==l.backView().stateName?l.goBack(-3):"ccbPay"==l.backView().stateName||"paymentxyz"==l.backView().stateName||"payResultSuccess"==l.viewHistory().backView.stateName||"payResultFailure"==l.viewHistory().backView.stateName?(v.getRole(),r.go("homePage"),l.clearCache()):l.goBack(-1):(r.go("homePage"),l.clearCache());else if("ccbPay"==l.currentStateName())r.go("orderManage");else if("homePage"==l.currentStateName()||"guidePage"==l.currentStateName()||"directPurchase"==l.currentStateName())k();else if("homePage"==l.currentStateName()||"cart"==l.currentStateName()||"personalCenter"==l.currentStateName()||"topic.qhot"==l.currentStateName()||"branchType"==l.currentStateName())r.go("homePage"),l.clearCache();else if("payResultSuccess"==l.currentStateName()||"payResultFailure"==l.currentStateName())r.go("orderManage");else if("shopRevenue"==l.currentStateName()){if(!l.backView()||"mentionCenter"==l.viewHistory().backView.stateName)return void r.go("homePage");l.backView()&&l.backView().url.indexOf("login")>0?l.goBack(-2):l.goBack()
}else if("bankCard"==l.currentStateName())null==l.viewHistory().backView?r.go("personnalCenter"):"shopRevenue"==l.viewHistory().backView.stateName||"paymentxyz"==l.viewHistory().backView.stateName?l.goBack():r.go("personnalCenter");else if("criticalSuccess"==l.currentStateName())l.goBack(-2);else if("bankCardDetail"==l.currentStateName())r.go("bankCard");else if("noteDetails"==l.currentStateName())if(a.globalConstant.showvideo){a.$apply(function(){a.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),s=0;s<o.length;s++)o[s].pause();$(".bof").css("display","block")}else a.nextPageBefore="noteDetails",l.goBack();else if("classNoteDetails"==l.currentStateName())a.nextPageBefore="classNoteDetails",l.goBack();else if("publishCircle"==l.currentStateName()||"publishEdit"==l.currentStateName())if(a.backgo="publish",a.globalConstant.showvideo){a.$apply(function(){a.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),s=0;s<o.length;s++)o[s].pause();$(".pcbf").css("display","block"),$(".pebf").css("display","block")}else l.goBack();else"letterGroupFriend"==l.currentStateName()?(a.nextPageBefore="letterGroupFriend",l.goBack()):"letterSend"==l.currentStateName()?(a.nextPageBefore="letterSend",l.goBack()):"privateLetter"==l.currentStateName()?(a.nextPageBefore="privateLetter",l.goBack()):l.goBack()},101),a.$on("$stateChangeStart",function(e,t,o,i,l){if(("homePage"==t.name||"productDetail"==t.name)&&-1!=window.location.href.indexOf("_aPlatform")&&-1!=window.location.href.indexOf("_aToken")){var d=window.location.href.split("?")[1],p=d.split("&")[0].split("=")[1],u=d.split("&")[1].split("=")[1];window.localStorage._aToken=p,window.localStorage._aPlatform=u,3==u&&s.isAuthoMid(p)}r.get(t.name).requiredLogin&&!n.isUserLogin()&&(e.preventDefault(),n.clearUser(),c.set("toState",t),c.set("toParams",o),r.go("login")),a.$on("userIntercepted",function(e){n.clearUser(),r.go("login")}),(""==i.name&&"homePage"==t.name||"login"==i.name&&"homePage"==t.name||"advertisement"==i.name&&"homePage"==t.name||"guidePage"==i.name&&"homePage"==t.name)&&w.get(y.getGameUrl("IS_KAIMENHONG_AVAILABLE")).success(function(e){!0===e&&r.go("bannerTheme",{bannerId:y.getCPUrl("KMH_ID")})})})}]),APP.service("UrlService",[function(){var e=[{SERVER_DATA:"http://m.ehaier.com/v3/",SERVER_DATA_GAME:"http://m.ehaier.com/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://m.ehaier.com/",SHARELINKHEADER:"http://m.ehaier.com/www/index.html#/",SERVER_DATA_V2:"http://m.ehaier.com/v2/",ZC_SERVER_DATA:"http://m.ehaier.com/",CCB_SERVER_DATA:"http://pay.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://message.ehaier.com:8080/",SEARCH_SERVER_DATA:"http://s.ehaier.com/search/",ITEM_SERVER_DATA:"http://detail.ehaier.com/v3/",ITEM_SERVER_DATA_NEW:"http://detail.ehaier.com/",COOPERATE_URL:"OFFICIAL_",PAY_CENTER:"http://pay.ehaier.com/",SERVER_TOP:"http://store.ehaier.com/appapi",PAY_LIVING:"http://cdn09.ehaier.com/shunguang/livingPay/www/index.html"},{SERVER_DATA:"http://mobiletest.ehaier.com:20306/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:20306/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:20306/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:20306/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:20306/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:20306/",COOPERATE_URL:"TEST_",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/"},{SERVER_DATA:"http://mobiletest.ehaier.com:38080/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38080/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38080/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38080/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38080/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38080/v3/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:38080/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/",PAY_LIVING:"http://cdn09.ehaier.com/shunguang/livingPaytest/www/index.html"},{SERVER_DATA:"http://mobiletest.ehaier.com:38081/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38081/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38081/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38081/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38081/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38081/v3/",ITEM_SERVER_DATA_NEW:"http://detailtest.ehaier.com:38081/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/search/",PAY_LIVING:"http://cdn09.ehaier.com/shunguang/livingPaytest/www/index.html",SERVER_TOP:"http://mobiletest.ehaier.com:38081/v3/thirdparty/app"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://mdev.ehaier.com:81/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http:/mdev.ehaier.com:81/mstatic",SHARELINKHEADER:"http:/mdev.ehaier.com:81/www/index.html#/",SERVER_DATA_V2:"http:/mdev.ehaier.com:81/v2/",ZC_SERVER_DATA:"http://mdev.ehaier.com:81/",CCB_SERVER_DATA:"http://mdev.ehaier.com:81/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",ITEM_SERVER_DATA_NEW:"http://detaildev.ehaier.com:81/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://m.pre.ehaier.com/v3/",SERVER_DATA_GAME:"http://m.pre.ehaier.com/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://m.pre.ehaier.com/mstatic",SHARELINKHEADER:"http://m.pre.ehaier.com/www/index.html#/",SERVER_DATA_V2:"http://m.pre.ehaier.com/v2/",ZC_SERVER_DATA:"http://m.pre.ehaier.com/",CCB_SERVER_DATA:"http://m.pre.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://s.pre.ehaier.com/v3/",ITEM_SERVER_DATA:"http://detail.pre.ehaier.com/v3/",ITEM_SERVER_DATA_NEW:"http://detaildev.ehaier.com:81/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://localhost:8100/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://localhost:8100/mstatic",SHARELINKHEADER:"http://localhost:8100/www/index.html#/",SERVER_DATA_V2:"http://mdev.ehaier.com:81/v2/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/"}],t=e[2].SERVER_DATA,o=e[2].ZC_SERVER_DATA,s=e[2].SERVER_DATA_V2,i=e[2].SERVER_MQ_WEBSOCKET,a=e[2].ZC_SERVER_DATA,n=e[2].CCB_SERVER_DATA,r=e[2].COOPERATE_URL,c=e[2].PAY_CENTER,l=e[2].SERVER_TOP,d=e[2].PAY_LIVING,p={GETTUIGUANGMA:"mstore/sg/store/wdSpreading.html",CHANGEDATA_INIT:"changeData.json",KUNBIND_INIT:"kjt/sg/kjtAccountUnbind.html",KBIND_INIT:"kjt/sg/kjtAccountBind.html",KBIND_ACTIVATION:"kjt/sg/kjtAccountActivation.html",KBIND_REALNAME:"kjt/sg/kjtAccountAuthRealName.html",SETDEFAULT_INIT:"h5/order/updateDefaultAddress.json",ADDRESS_INIT:"h5/order/memberAddresses.json",COLLECTION_LIST:"mstore/sg/collections.html",DELETECOLLECTION_INIT:"h5/sg/item/cancelProductCollection.json",COLLECTION_INIT:"h5/sg/item/productCollection.json",MESSAGECENTER_INIT:"mstore/sg/msgCenter.html",DETAILMESSAGECENTER_INIT:"detailMessageCenterfalseData.json",EASYCONNECT_INIT:"kjt/sg/withdrawSetting.html",EASYCONNECTRESULT_INIT:"mstore/sg/kjtInfo.html",EASYCONNECTACCOUNT_INIT:"mstore/sg/kjtInfo.html",GETCASH_INIT:"mstore/sg/local/myApply.html",NEW_GETCASH_INIT:"kjt/myApply.html",KJT_BALANCE:"getKjtAccount.json",GETKJTACCOUNT:"kjt/getKjtAccount.json",UNLOAD_INIT:"platform/web/member/logoutNew.json",UPDATEMEMBER_INIT:"platform/web/member/updateMember.json",UPDATE_EMAIL:"platform/web/member/updateEmail.json",UPDATEPASSWORD_INIT:"platform/web/member/updatePassword.json",SET_PASSWORD_INIT:"platform/web/member/setPassword.json",DETELEADDR_INIT:"h5/order/deleteAddress.json",CHANGEADDR_INIT:"h5/order/updateAddress.json",ADDADDRESS_INIT:"h5/order/insertAddress.json",CHECKSHOPNAME_INIT:"mstore/sg/checkSensitiveWords.html",CHANGESHOPNAME_INIT:"mstore/sg/store/changeStoreName.html",CHECKHRCODE_INIT:"mstore/sg/checkHrCode.html",EDITSHOP_INIT:"mstore/sg/wdStoreInfoEdit.html",SHOPINFO_INIT:"mstore/sg/storeInfo.html",SHOPKIND_INIT:"mstore/sg/getMemberType.html",UPLOAD_IMAGE:"platform/web/app/uploadImage",SELECT_INIT:"mstore/sg/wdMarketData.html",FAXIAN_INIT:"loadFindProductsNew.html",ASYNC_ACCESS_PRICE:"getPriceByProductList.html",CHANGESUCCESS_INIT:"mstore/sg/addMarketTypeToCookie.html",CHANGECHOOSESTATEDUI_INIT:"mstore/sg/removeProductShelvesSubmit.html",CHANGECHOOSESTATEJIA_INIT:"mstore/sg/updateProductShelvesSubmit.html",SEARCHGOODS_INIT:"mstore/sg/wdMarketSearchItem.html",ADDCART_INIT:"h5/cart/add.json",LOADMOREPRODUCTS_INIT:"mstore/sg/commonLoadItem.html",ADDADDRESSSELECTION_INIT:"mstore/sg/addPositionToCookie.json",GET_POSITION_FROM_COOLIE:"mstore/sg/getPositionFromCookie.json",CHOOSE_ADDR:"h5/order/changeAddress.json",GET_ADDRESS_ID:"mstore/sg/getAddressId.html",GET_SELECTION_IMAGE:"mstore/sg/wdMarket.html",CHECK_NOTICE:"h5/sg/checkOnly.html",ARRIVE_NOTICE:"h5/sg/insertNotice.html",START_NOTICE:"h5/sg/insertActivityNotice.html",MESSAGE_CLASSIFY:"mstore/sg/messageCenter.html",CUSTOMPAGE_MODEL:"activity/page/getCustomPageDetail.json",LOCAL_SPECIALTY:"sg/cms/chara/charaIndex.json",NEW_AND_LIMIT:"sg/cms/flashSales/chara.json",NEW_LOCAL_FLASHSALE:"sg/cms/flashSales/charasale.json",LOCAL_SPECIALTY_LIKE_TYPE:"sg/cms/chara/charaCate.json",LOCAL_SPECIALTY_LIKE_DATA:"sg/cms/chara/charaProducts.json",ALL_SPECIALTY:"sg/cms/chara/charaRegions.json",SPECIALTY_CART_NUM:"h5/cart/num.json",SPECIALY_VENUE_HOME:"/sg/cms/chara/charaPage.json",SPECIALY_PRODUCTS_LIST:"charaLoadItem.json",STORE_COLLECTIONLIST:"mstore/sg/storeCollection.json",SECONDLEVEL_PRODUCTLIST:"charaLoadItem.json",SECONDLEVEL_SECTYPELIST:"sg/cms/chara/cityChara.json",ADD_COLLECT:"v3/mstore/sg/collectStore.json",CANCEL_COLLECT:"v3/mstore/sg/collectCancel.json",LOGIN:"platform/web/member/login.json",CAPTCHALOGIN:"platform/web/member/captchaLogin.json",LOGIN_CHECK:"platform/web/widget/login.html",GET_CAPTCHA:"platform/web/member/captcha.json",GET_LOGIN_CAPTCHA:"platform/web/member/getImgCaptchafromUC.html",GET_IMG_CAPTCHA:"platform/web/member/register/getImgCaptcha.html",REGISTER_USER_INFO:"platform/web/member/register.json",GET_PASSWORD_CAPTCHA:"platform/web/member/captchaForFindPaw.json",CAPTCHA_CHECK:"platform/web/member/verifyCaptcha.json",REQUEST_PASSWORD:"platform/web/member/resetPassword.json",OTHER_LOGIN:"platform/web/member/getMember.json",STATISTICS:"mstore/sg/statistics/portal.json",SECOND_MANAGE:"mstore/sg/store/subMembers.html",THIRD_MANAGE:"mstore/sg/store/grandMembers.html",ORDER_AMOUNT:"v3/h5/order/getOrderCount.json",ORDER_MANAGE:"v3/h5/order/getOrderList.json",CANCEL_ORDER:"h5/sg/order/cancelOrder.html",SUBMIT_APPLY_REFUND:"h5/sg/order/submitOrderRepair.html",FEEDBACK:"h5/sg/content/recommend.html",FEEDBACK_PLUS:"h5/sg/content/recommendNew.html",CHECK_REFUND:"h5/sg/order/checkOrderRefund.html",CHECK_TEXT:"mstore/sg/checkSensitiveWords.html",GET_PROMOTION_USER_INFO:"platform/web/member/getPromotionUserInfo.json",SHOP_APPLY:"mstore/sg/wdApplySubmit.html",REFUND_DETAIL:"h5/sg/order/getOrderRepairsInfo.html",ORDER_TRACKING:"h5/sg/order/orderTrack.html",APPLY_REFUND:"h5/sg/order/orderRefund.html",COMMON_UNION:"mstore/sg/getMemberType.html",ORDER_DETAIL:"h5/order/getOrderDetail.json",THIRD_PARTY_LOGINS:"platform/web/member/thirdLogin.json",CUSTOMER_SERVE:"h5/sg/common/customService.html",SHUNGUANG_HELP:"mstore/sg/shunguangHelp.html",HELP_DETAIL:"mstore/sg/helpDetail.html",WECHAT_PAY:"h5/pay/wxpay.html",PAY_ORDER:"",GET_ALIPAY_INFO:"h5/sg/orderSign.html",UPLOAD_ASSESS_IMG:"h5/sg/upLoadCommentPicture.html",NEW_USER_CONTACT:"platform/web/member/bindAndLoginForThird.json",FIND_STATUS:"platform/web/wechat/bindState.json",CHECK_ASSESS_TEXT:"h5/sg/comment/checkSensitiveWords.json",UPLOAD_ASSESS_IMG_NEW:"h5/sg/comment/upLoadCommentPicture.json",EVALUCTION_NEW:"h5/sg/comment/commentPage.json",SUBMIT_EVALUCTION_NEW:"h5/sg/comment/submitComment.json",CRITICALSUC:"h5/sg/comment/commentSuccessPage.json",GET_IMG_CAPTCHA_NEW:"h5/sg/comment/getImgCaptcha.html",FAST_LOGIN_CAPTCHA_COMMENT:"h5/sg/comment/userCommentSendSmsCode.json",USER_COMMENT_PAGE:"h5/sg/comment/userCommentPage.json",SUBMIT_BUYER_COMMENT:"h5/sg/comment/submitUserComment.json",PRODUCT_RATED_ASSESS_LIST:"h5/sg/getCommentsByCondition.json",PRODUCT_ASSESS_MARK:"h5/sg//getProductImpressions.json",LOOK_ASSESS_INGO:"h5/sg/comment/getComment.json",ADD_ASSESS_SUBMIT:"h5/sg/comment/submitExperience.json",WINNING_LIST:"mstore/sg/game/winnerList.json",LOTTERY:"mstore/sg/game/luckDraw.json",GAME_INFORMATION:"mstore/sg/game/gameApp.json",GAME_HELLP:"mstore/sg/game/help/powerShare.json",GAME_HELLP_INIT:"mstore/sg/game/help/helpRecord.json",GAME_HAVE_PRIZE:"mstore/sg/game/addAddress.json",IS_KAIMENHONG_AVAILABLE:"mstore/sg/game/needRedirect.json",HASPROGRAM:"sg/cms/home/product/hasProgram.json",STORE_INFO:"platform/web/app/app_store_info",APP_HOME_DATA:"platform/web/app/app_home_data",GOODS_LIST:"mstore/sg/wdComManageDataInit.html",DELETE_GOODS:"mstore/sg/removeProductShelvesSubmit.html",UPDATE_GOODS:"mstore/sg/updateProductShelvesSubmit.html",UPDATE_GOODS_BATCH:"mstore/sg/updateStoreProductsBatch.html",DELETE_GOODS_BATCH:"mstore/sg/deleteStoreProductsBatch.html",SEARCH_GOODS:"mstore/sg/wdCommonSearch.html",REVENUE_INFO:"mstore/sg/local/wdRevenue.json",REVENUE_LIST:"mstore/sg/local/myRevenueList.json",MICRO_SCHOOL:"mstore/sg/microSchool.json",PRODUCTS_LIST:"mstore/sg/data/products.html",ACTIVITY_PRODUCTS_LIST:"mstore/sg/data/activityProducts.html",GET_SHOP_TEMPLATES:"mstore/sg/store/wdStyleChoice.html",SET_SHOP_TEMPLATES:"mstore/sg/store/changeStoreStyle.json",GET_SHOP_COVER:"mstore/sg/store/wdShopCover.html",SET_SHOP_COVER:"mstore/sg/store/changeShopCover.json",MY_STORE:"mstore/sg/manage.html",MY_STORE_NEW:"mstore/sg/manage.json",MY_STORE_FILTER_LIST:"myStoreFilter.json",GET_PRODUCTS_LIST:"mstore/sg/commonLoadItemNew.html",GET_FILTER_DATA:"wdMarketFiltrate.html",GET_ACCOUNT_STATE:"kjt/sg/wdWithdraw.html",GET_BANNER_THEME:"mstore/sg/activity/toActivityPage.html",GET_BANNER_DAILY:"mstore/sg/activity/dailyActivityProducts.json",GET_O2O_NAME:"h5/getO2OStoreInfo.html",IS_HAS_STORE:"platform/web/app/is_has_store",GET_STORE_INFO:"platform/web/app/app_store_info_new",GET_SELECTION_PRODUCTS:"mstore/sg/loadSelectProducts.html",GET_AD_IMAGE:"platform/web/app/app_navigate_banner",DELETE_ORDER:"h5/sg/order/deleteOrder.json",BATCH_DELETE_ORDER:"h5/sg/order/deleteAllOrders.json",GET_MERGE_IMAGE:"h5/sg/getMergeImage.html",CHECK_KJT_LOGIN:"kjt/checkLogin.html",GET_KJT_TOKEN:"kjt/genToken.html",GET_HAIRONGYI_ACTIVITYIFNO:"kjt/queryPromotionActivity.html",GET_PROMOTE_REWARD:"kjt/queryPromoteReward.html",GET_TOTAL_COMMISSION:"kjt/queryPromotionDailyReward.html",GET_REF_CODE:"kjt/queryPromoCode.html",GET_WALLET:"h5/sg/getBenefitMember.json",GET_WALLETDETAIL:"h5/sg/getBenefitDetails.json",GET_GETSGSTOREATTRIBUTE:"item/attribute/getSgStoreAttribute.json",GET_GETDETAILATTRIBUTE:"h5/sg/item/getDetailAttribute.json",GET_ISSHOWATTR:"item/attribute/isShowAttr.json",GET_CARTNUM:"h5/cart/getCartNum.json",HAS_BANK_LIST_NEW:"kjt/bank/getBankCardList.json",BANK_LIST_DETAIL_NEW:"kjt/bank/getCardDetail.json",BANK_DELETE_NEW:"kjt/bank/unBindCard.json",BANK_DELETE_CAPTCHA:"kjt/bank/getCaptchaForUnbind.json",BANK_HASBINGNUM_NEW:"kjt/bank/bankCardCount.json",SHOP_APPLY_SUCCESS:"mstore/sg/mechanism/openStoreRank.json",DATA_ANALYSIS_UPDATE:"mstore/sg/mechanism/findLastOrderProduct.json",DATA_ANALYSIS_DISTRIBUTION:"mstore/sg/mechanism/getSaleNumByCate.json",DATA_ANALYSIS_ACTIVITY:"mstore/sg/mechanism/getActionAnalysis.json",DATA_ANALYSIS_SALES:"mstore/sg/mechanism/getSaleNumByCity.json",GET_CDK_TOKEN:"h5/sg/cdk/getToken.json",GET_COUPONS_LIST:"mstore/sg/coupons/getCouponsByArea.html",NEW_GET_COUPONS_LIST:"activity/coupons/getCouponsCenter.html",NEW_GET_COUPONS_TYPE:"activity/coupons/getViewCouponCate.html",NEW_SHOP_COUPONS_LIST:"h5/sg/coupons/getCouponsByProductId.html",USE_COUPONS_LIST:"h5/sg/coupons/getProductsByCouponId.html",COUPONS_DETAIL_LIST:"h5/sg/coupons/getCouponDetail.html",PRODUCT_COUPONS_HAS:"activity/coupons/getHasCoupons.html",REMIND_COUPONS_LIST:"h5/sg/coupons/setRemind.html",GET_NEW_COUPONS:"activity/coupons/receiveCoupon.html",COUPONS_DONATION:"h5/sg/coupons/couponForTransferNew.html",COUPONS_GET_MENBERID:"mstore/sg/coupon/getMemberById.html",MY_COUPONS_LIST:"h5/sg/coupon/getCouponsByMemberId.html",MY_COUPONS_LIST_LATE:"h5/sg/coupon/getCouponsByMemberIdOneDay.html",SELECT_GOODS_COUPONS:"h5/order/getStoreCoupon.json",SELECT_GOODS_COUPONS0:"h5/coupons/selectCouponsForTailOrdersIncludeUnable.html",REDIRECT_URL:"platform/web/member/wxWebLogin.json",CHECK_LOGIN:"platform/web/member/checkLogin.json",STATE_ID:"platform/web/member/saveState.json",SELECT_GOODS_COUPONS1:"h5/sg/order/submitTailCoupon.json",SELECT_PLATFORM_COUPONS:"h5/order/getOrderCoupon.json",SELECT_COUPONS:"h5/order/choiceStoreCoupon.json",SELECT_COUPONS_PT:"h5/order/choiceOrderCoupon.json",CARD_COUPONS_USED:"h5/sg/order/checkCardValidate.html","CARD_ CODE_CHECK":"h5/sg/order/checkCaptcha.html",GIFT_CARD_COUPONS_USED:"h5/order/checkGift.json",GIFT_CARD_COUPONS_CANCLE:"h5/order/cancelGift.json",PAY_WAY:"h5/order/getCanChoiceDate.json",SUBMIT_PAY_WAY:"h5/order/updatePay.json",SUBMIT_DELIVE_WAY:"h5/order/choiceDate.json",CART_LIST:"h5/cart/list.html",GOODS_NUMBER:"h5/cart/update.json",DELETE:"h5/cart/delect.json",CONFIRM_ORDER:"h5/order/createOrder.json",UPDATE_ORDER:"h5/order/getPageInfo.json",CHECK_PAGE_INFO:"h5/sg/order/checkPageInfo.html",ZC_ORDER_CONFIRM:"activity/zhongchou/order/submitOrder",CONFIRM_ORDER_INFO:"h5/sg/order/orderInfo.html",LOCATION_CHANGE:"item/purchase/checkStock.json",PAY_CHECK_STOCK:"item/purchase/checkStockForNum.json",PRODUCTDETAIL_LODEDATA:"item/purchase/",EVALUATE_INFO:"item/evaluation/",POST_STORE_INFO:"h5/sg/shop/info/",PRODUCTDETAIL_PROMOS:"item/purchase/promos.json",ORDER_SUBMIT:"h5/order/asynSubmitOrder.json",GET_COUPONS_DETAIL:"h5/sg/coupon/toListItem.html",RECEIVE_COUPONS:"mstore/sg/coupons/getCouponForMember.html",ORDER_INVOICE:"h5/order/toInvoice.json",ORDER_INVOICE_LIST:"h5/sg/order/getMemberInvoicesListsByMemberId.html",SUBMIT_INVOICE:"h5/order/submitMemInvoice.json",SUBMIT_INVOICE_SECKILL:"pmt/sg/order/submitInvoice.html",ORDERDETAIL_SPECIFICATIONS:"item/purchase/specifications.json",GET_CONFIRM_RECEIVE_LIST:"h5/sg/order/confirmList.html",CONFIRM_RECEIVE:"h5/sg/order/confirmOrderProduct.html",GAME_INFO:"mstore/sg/game/oldGameApp.json",GAME_ADD_ADRESS:"mstore/sg/game/addAddress.html",SECKILL_LIST:"pmt/sg/seckill/getSeckillAllRedis.html",SECKILL_SERVICE_TIME:"pmt/sg/getServiceTime.html",CHECK_STOCK:"pmt/sg/item/checkStock.json",SECKILLDETAIL:"h5/sg/purchase/",SECKILLBUY:"pmt/sg/order/pageInfo.html",SECKILL_CONFIRM_ORDER_INFO:"pmt/sg/order/orderSubmit.html",UNRED_MESSAGE:"platform/web/member/unread_message.json",MSG_CENTER:"mstore/sg/msgCenter.html",READALL:"mstore/sg/readAllMessage.json",CHECKREAD:"mstore/sg/checkRead.json",PAY_KJT:"h5/pay/kjtpay/request.json",APP_VERSION:"platform/web/app/appVersion.json",BIND_MOBILE:"platform/web/member/bindMobile.json",WD_APPLY:"mstore/sg/wdApply.html",GETREGIONBYID:"mstore/sg/getRegionByParentId.html",GET_REGION_BY_ID_TYPE:"mstore/sg/getRegionByPIdAndReType.html",ORDER_200PAYCHECK:"h5/sg/orderPayCheckNew.html",PRODUCT_RATED_TOASSESS_LIST:"h5/sg/toAssessList.html",TEST_KQT_ID:200000055141,OFFICIAL_KQT_ID:200000030019,TEST_KMH_ID:758,OFFICIAL_KMH_ID:2668,TEST_WXSQ_ID:"wxb9b3b8793f9c3d7a",OFFICIAL_WXSQ_ID:"wxb03a523baf487993",TEST_WXSQ_URL:"http://mobiletest.ehaier.com:38080/v3/",OFFICIAL_WXSQ_URL:"http://m.ehaier.com/v3/",TEST_KQT_URL:"https://zmgs.kjtpay.com/mgs/common/page.htm",OFFICIAL_KQT_URL:"https://mgs.kjtpay.com/mgs/common/page.htm",TEST_TTQ_URL:"https://zzhuanle-h5.kjtpay.com/shunguang/myttj",OFFICIAL_TTQ_URL:"https://m-ally.hairongyi.com/shunguang/myttj",TEST_SZD_URL:"http://203.187.186.136:8130/haiercms/waterQuality",OFFICIAL_SZD_URL:"http://uhome.haier.net:8280/watercms/waterQuality",TEST_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5test/",OFFICIAL_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5/",TEST_BIG_DATA:"http://jxh.ehaier.com:1188/jslog",OFFICIAL_BIG_DATA:"http://crmxjz.ehaier.com:1188/jslog",TEST_CDK_URL:"http://map.mankaa.com/",OFFICIAL_CDK_URL:"http://map.rrskx.com/",CCB_FENQI:"paycenter/pay/fenqi/cost.html",CCB_FENQI_W:"paycenter/pay/request.html",UNION_PAY:"paycenter/unionpay/request.html",PAY_TYPE_LIST:"paycenter/pay/payTypeList",HB_COST:"paycenter/pay/hbfenqi/hbCost.html",HB_PAY_APP:"v2/h5/pay/app/Hb/request.json",HB_PAY_H5:"v2/h5/pay/Hb/alipay/request.html",JINBI_JILU:"h5/sg/member/appLoginRecord.json",SHARESUCCESS:"h5/sg/member/getShareSuccess.json",SHUNGUANG_VIP:"mstore/sg/credit/getUserCreditInfo.html",CREDIT_DETAIL:"mstore/sg/credit/findCreditDetail.html",DEVICE_INFO:"platform/web/app/saveDeviceToken.json",ORDER_INFO:"mstore/sg/findOrderInfoByOrderId.json",DINGZHI_ZHONGCHUANGHUI:"mstore/sg/diy/login/request.html",FIND_GAME_ID:"mstore/sg/findLatestGame.json",MISSION_DETAIL:"mstore/sg/task/findTaskDetail.html",MISSION_SHARE:"mstore/sg/task/doTask.html",CONNECTION_INDEX:"mstore/sg/store/getRelationships.html",SPREAD_CONNECTION:"mstore/sg/store/getContacts.html",PARTNER_DETAIL:"mstore/sg/store/getRelationshipsDetial.html",REPORT_DETAIL:"mstore/sg/selfBrokerageReportDetail.html",REPORT_DETAIL_PLUS:"mstore/sg/brokerageSettlement.html",BATCH_DELETE_ADDRESS:"h5/order/deleteBatchAddress.json",GET_QRCODE:"mstore/sg/task/generalQRCode.html",HOMEPAGE_TOP:"sg/cms/indexTop.json",HOMEPAGE_MIDDLE:"sg/cms/floor.json",HOMEPAGE_ISWDHOST:"sg/cms/isWdHost.json",HOMEPAGE_FALSHSALES:"sg/cms/flashSales/index.json",PERSONAL_CENTER:"v3/mstore/sg/myManage.json",GET_NEW_DIAMOND:"v3/mstore/sg/wallet.json",FURNISH_TOP:"sg/cms/adornhome/topRecommendProducts.json",FURNISH_BOTTOM:"sg/cms/adornhome/lowRecommendProducts.json",SUPERMARKET_TOP:"sg/cms/supermarket/topRecommendProducts.json",SUPERMARKET_BOTTOM:"sg/cms/supermarket/lowRecommendProducts.json",MYAPPOINTMENT:"sg/cms/reserve/myReserve.json",FURNISH_BANNER:"sg/cms/adornhome/adornHomeBanner.json",SUPERMARKET_BANNER:"sg/cms/supermarket/supermarketBanner.json",ELECTRICALMALL_TOP:"sg/cms/electricalSecond.json",FAST_LOGIN_CAPTCHA:"platform/web/member/captchaForSmsLogin.json",FAST_LOGIN:"platform/web/member/smsLogin.json",ACTIVITY_ICON_TABS_NEW:"sg/cms/iconConfig.json",ACTIVITY_BG:"sg/cms/middleImageConfig.json",TOKEN_GET:"platform/web/member/queryAccessToken.json",TOKEN_LOGIN_GET:"platform/web/token/getToken.json",VIDEO_ADVERTISEMENT:"platform/web/app/getBannerMovie.html",ADORNHOME_CATES:"sg/cms/adornhome/productCates.json",SUPERMARKET_CATES:"sg/cms/supermarket/productCates.json",TO_ORDER_SUBMIT_SUCCESS:"h5/sg/order/toOrderSubmitSuccess.html",SHAER_TASK:"mstore/sg/task/findTaskList.html",SHAER_HISTORY_TASK:"mstore/sg/task/findHistoryTaskList.html",MEMER_COMPETE:"mstore/sg/credit/findStoreMemberRecord.html",HOT_WORDS:"search/hotSearch.html",DEFAULTSEARCH_WORDS:"search/defaultSearch.html",ASSOCIATIONAL_WORDS:"search/suggestJson.html",GET_MY_COMMENT_LIST:"sgcommunity/story/getMyCommentList.ajax",GET_UCTIP_LIST:"sgcommunity/uctip/getucTipList.ajax",GET_USER_ISSUE_LIST:"sgcommunity/story/getUserStoryList.ajax",GET_USER_JOINTOPIC_LIST:"sgcommunity/getUserJoinTopicList.ajax",GET_USER_CREATETOPIC_LIST:"sgcommunity/getUserCreateTopicList.ajax",GET_USER_PRAISE_LIST:"sgcommunity/story/getUserPraiseStoryList.ajax",GET_USER_COLLECTION_LIST:"sgcommunity/Circle/getUserCllectionStoryList.ajax",CIRCLE_SIGNIN:"sgcommunity/sign.ajax",CIRCLE_SIGN_DATE:"sgcommunity/getSignCalendar.ajax",CIRCLE_SIGN_CHART:"sgcommunity/getRank.ajax",CIRCLE_REPLENISH_SIGN:"sgcommunity/replenishSign.ajax",GET_WECHAT_OPENID:"sgcommunity/Circle/getOpenId.ajax",GET_WECHAT_URL:"sgcommunity/Circle/getWeChatURL.ajax",USER_SIMPLE_INFO_ONE:"sgcommunity/user/userSimpleInfo1.ajax",USER_SIMPLE_INFO_TWO:"sgcommunity/user/userSimpleInfo2.ajax",USER_SIMPLE_INFO_THREE:"sgcommunity/user/userSimpleInfo3.ajax",GETUSERMESSAGECOUNT:"sgcommunity/user/getUserMessageCount.ajax",GETBANNERLIST:"sgcommunity/Circle/getBannerList.ajax",GETHOTTOPICLIST:"sgcommunity/Circle/getHotTopicList.ajax",GETHOTSTORYLIST:"sgcommunity/Circle/getHotStoryList.ajax",GETMYTOPICLIST:"sgcommunity/Circle/getMyTopicList.ajax",EXITTOPIC:"sgcommunity/schoolstory/exitTopic.ajax",GETMYFOLLOWINGSTORYLIST:"sgcommunity/Circle/getMyFreshNewsList.ajax",GETCOURSEINFO:"sgcommunity/Course/getCourseInfo.ajax",GETUPDATELIST:"sgcommunity/schoolstory/getschoolUpdateList.ajax",GETSTORYINFO:"sgcommunity/schoolstory/getStoryInfo.ajax",GETSTORYCOMMENT:"sgcommunity/schoolstory/getSchoolComment.ajax",SUBMITCOMMENT:"sgcommunity/schoolstory/submitComment.ajax",CLASS_DELETE_COMMENT:"sgcommunity/schoolstory/deleteSchoolCommentById.ajax",SCHOOLPRAISESTORY:"sgcommunity/schoolstory/schoolPraiseStory.ajax",SCHOOLCOLLECTION:"sgcommunity/schoolstory/schoolCollectionStory.ajax",SCHOOLCOMMENTPARISE:"sgcommunity/schoolCommentParise.ajax",SCHOOLCOMMENTPARISENUM:"sgcommunity/schoolstory/getCountForSchoolPraise.ajax ",GETTOPICLIST:"sgcommunity/schoolstory/getTopicList.ajax",GET_MY_STORY_LIST:"sgcommunity/story/getMyStoryList.ajax",MYCREATE_TOPIC:"sgcommunity/getMyCreateTopicList.ajax",MYJOINED_TOPIC:"sgcommunity/getMyJoinTopicList.ajax",GET_COLLECTION_STORY_LIST:"sgcommunity/Circle/getCllectionStoryList.ajax",GET_SCHOOL_COLLECTION_STORY_LIST:"sgcommunity/schoolstory/getCllectionStoryList.ajax",GET_LIKE_STORY_LIST:"sgcommunity/story/getLikeStoryList.ajax",SUBMITREPLY:"sgcoummunity/story/submitReply.ajax",FOLLOW:"sgcommunity/user/follow.ajax",GETMYFANS:"sgcoummunity/user/getMyFans.ajax",MY_FANS:"sgcommunity/user/getMyFans.ajax",INTERESTED:"sgcommunity/user/getMyInterested.ajax",MY_FOLLOWS:"sgcommunity/user/getMyFollows.ajax",RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicList.ajax",LAUNGCH_RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicListFirstPage.ajax",JOIN_TOPIC:"sgcommunity/schoolstory/joinInTopic.ajax",PLATFORM_INFO:"sgcommunity/user/getPlatformInfo.ajax",SCHOOL_INFO:"sgcommunity/user/getSchoolInfo.ajax",OTHER_INFO:"sgcommunity/user/getOtherInfo.ajax",APPLY_TOPIC:"sgcommunity/schoolstory/entryCreateTopicAndTags.ajax",EXIST_APPLY_TOPIC:"sgcommunity/schoolstory/getEntryTopicStatus.ajax",REVIEW_APPLY_TOPIC:"sgcommunity/searchEntryTopicInfo.ajax",DELETE_APPLY_TOPIC_DRAFT:"sgcommunity/Circle/delCircleTopic.ajax",STORAGE_APPLY_DRAFT:"sgcommunity/schoolstory/entryDraftTopicAndTags.ajax",STORAGE_APPLY_REFUSE:"sgcommunity/schoolstory/UpdateTopicEntryForReback.ajax",TOPIC_TAGS:"sgcommunity/schoolstory/getStoryPraiseAndUnread.ajax",TOPIC_INFO:"sgcommunity/schoolstory/getTopicInfo.ajax",BY_CONDITION:"sgcommunity/Circle/getSensitiveByCondition.ajax",CIRCLE_STORY_INFO:"sgcommunity/Circle/getStoryInfo.ajax",UPDATE_STORY:"sgcommunity/schoolstory/updateStoryNew.ajax",LIST:"sgcommunity/schoolstory/getUpdateList.ajax",TOP_STORY:"sgcommunity/Circle/topStory.ajax",DELETESTORY:"sgcommunity/Circle/deleteStory.ajax",SUBMIT_STORY:"sgcommunity/schoolstory/insertStoryNew.ajax",IS_FOLLOWED:"sgcommunity/user/getIsFollowed.ajax",SELECT_TAGS_BY_TOPICID:"sgcommunity/schoolstory/selectTagsByTopicId.ajax",SHOP_INFO:"mstore/sg/manage.html",SHOP_INFO_LIST:"mstore/sg/commonLoadItem.html",SHOP_ADD_CART:"h5/sg/cart/add.json",HIS_SHARE:"sgcommunity/Circle/getShareList.ajax",GETLISTBYCONDITION:"sgcommunity/Circle/getListByCondition.ajax",GETUSERBYCONDITION:"sgcommunity/Circle/getUserByCondition.ajax",GETSTORYBYCONDITION:"sgcommunity/Circle/getStoryByCondition.ajax",GETTOPICBYCONDITION:"sgcommunity/Circle/getTopicByCondition.ajax",GETSTORYPRAISEANDUNREAD:"sgcommunity/schoolstory/getSchoolStoryPraiseAndUnread.ajax",ADDUSER:"sgcommunity/user/addUser.ajax",GETLISTBYCODE:"sgcommunity/Circle/getListByCode.ajax",SELECT_TAGNAME:"sgcommunity/schoolstory/selectTagsCountByTagName.ajax",PERFECT_INFORMATION:"mstore/sg/checkStoreParam.json",COMMON_COMMENT:"sgcommunity/schoolstory/getStoryComment.ajax",INSERT_COMMON_COMMENT:"sgcommunity/schoolstory/insertStoryComment.ajax",COMMENT_PRAISE:"sgcommunity/story/praiseStory.ajax",COLLECTION_TOPIC:"sgcommunity/Circle/cllectionStory.ajax",TOPIC_PRAISE:"sgcommunity/schoolstory/commentParise.ajax",NOTE_PERSON_TYPE:"sgcommunity/schoolstory/selectStory2.ajax",GET_STORY_PRAISE:"sgcommunity/Circle/getStoryPraiseAndUnread.ajax",COMMENT_STORY_PRAISE:"sgcommunity/schoolstory/getCommentPraise.ajax",DELETE_COMMON_COMMENT:"sgcommunity/schoolstory/deleteComment.ajax",SHARE:"sgcommunity/Circle/share.ajax",APPLY_LECTURER:"sgcommunity/user/applyTeacher.ajax",START_APPLY_LECTURER:"sgcommunity/user/startApplyTeacher.ajax ",ENTRYFORUM:"sgcommunity/Circle/entryForum.ajax",ENLARGE_CONTENT:"sgcommunity/getEntrycapacity.ajax",DISCUSSION_STATE:"sgcommunity/Circle/getDiscussionState.ajax",CONNECT_PROUCT:"sgcommunity/circle/getProductsDetailList.ajax",EXIT_TOPIC:"sgcommunity/schoolstory/exitTopic.ajax",CANCEL_TOP:"sgcommunity/cancelTopStory.ajax",ADD_USER:"sgcommunity/user/addUser.ajax",COURSE_INFO:"sgcommunity/notice/getNoticeCourseyByCourseId.ajax",TEACHED_COURSE:"sgcommunity/story/getTeachCourse.ajax",JOINED_COURSE:"sgcommunity/story/getJoinCourse.ajax",COURSE_ALL_MEMBER:"sgcommunity/notice/getCoursePersonByCourseId.ajax",COURSE_TEACH_LIST:"sgcommunity/notice/selectCourseForTeacher.ajax",MESSAGE_BOARD_LIST:"sgcommunity/schoolstory/getWordsListByCourseID.ajax",CLASSES_LIST:"sgcommunity/course/getCourseMaterials.ajax",CLASSES_TOPIC_LIST:"sgcommunity/schoolstory/getSchoolStoryListByCourse.ajax",GET_QUESTION_DETAILS:"sgcommunity/schoolstory/getAnswersByWordsId.ajax",QUESTION_ANSWER:"sgcommunity/schoolstory/insertWords.ajax",STUDENT_SHARE:"sgcommunity/course/getStudentsShare.ajax",TEST_LIST:"sgcommunity/Circle/startAnswerList.ajax",TEST_ESSENTIAL_INFORMATION:"sgcommunity/Circle/getCourseAnswerInfo.ajax",TEST_CONSULT:"sgcommunity/Circle/getCourseAnswerResult.ajax",REGIST_MESSAGE_TOKEN:"mstore/sg/registMessageToken.html",MESSAGE_WS_URL:"ws",BROKERAGE_SETTLEMENT:"mstore/sg/brokerageSettlement.html",FLASH_TWO:"sg/cms/flashSales/docker.json",GET_BUSINESS:"sgcommunity/schoolstory/getStoryCategory.ajax",GET_RELATEDSHOP:"sgcommunity/product/commonLoadItem.html",GET_AREADYSHOP:"sgcommunity/product/getPaidProductInfo.html",GET_HOLDPRO:"sgcommunity/product/getCollectionList.ajax",SEARCH_GOODS_CIRCLE:"sgcommunity/product/wdCommonSearch.html",SEARCH_HOLDPRO:"sgcommunity/product/searchCollectionList.ajax",CIRCLE_GET_GOLD:"sgcommunity/user/getConsumeCreditNum.ajax",CIRCLE_SHAN_LIST:"sgcommunity/getTipList.ajax",CIRCLE_SHAN_TOPIC:"sgcommunity/story/tipStory.ajax",CIRCLE_SHAN_COMMENT:"sgcommunity/story/tipComment.ajax",CIRCLE_SELECT_SHOP:"sgcommunity/user/isWd.ajax",CIRCLE_GET_CIRCLE_LIST:"sgcommunity/getUcTopicCategoryList.ajax",CIRCLE_GET_SECONDLIST:"sgcommunity/getUcTopicListByCategoryId.ajax",CIRCLE_CIRCLEPERSON:"sgcommunity/Circle/getUserListByTopicId.ajax",CIRCLE_SET_ADMIN:"sgcommunity/Circle/setManager.ajax",CIRCLE_MANAGE_USER:"sgcommunity/Circle/setIsGap.ajax",CIRCLE_DELECT_USER:"sgcommunity/schoolstory/deleteUser.ajax",CIRCLE_CANG_COMMENT:"sgcommunity/schoolstory/updateCommentDisplayStatus.ajax",
CIRCLE_CANG_TOPIC:"sgcommunity/hiddenStory.ajax",CIECLE_DEL_CANG_TOPIC:"sgcommunity/cancleHiddenStory.ajax",CIRCLE_TOP_TOPIC:"sgcommunity/setTopStory.ajax",CIRCLE_SPEAK:"sgcommunity/schoolstory/getUserIsGag.ajax",CIRCLE_AGREE:"sgcommunity/story/adoptionComments.ajax",CIRCLE_SELECT_TOPIC:"sgcommunity/Circle/choiceTopicList.ajax",CIRCLE_JING_TOPIC:"sgcommunity/setChoiceStory.ajax",CIRCLE_JING_CANCLE:"sgcommunity/cancelChoiceStory.ajax",ZC_INDEX:"activity/zhongchou/index",ZC_INDEX_ACTIVITY:"activity/zhongchou/indexZActivitys",ZC_ZSTALLS_SINGLE_PAGE:"activity/zhongchou/getZStallsSinglePage",ZC_CHECK:"activity/zhongchou/check",ZC_ORDER_COMMIT:"activity/zhongchou/order/pageInfo",ZC_ACTIVITY_SINGLE_PAGE:"activity/zhongchou/getZActivitySinglePage",ZC_COMMIT_ORDER:"activity/zhongchou/order/submitOrder",GETNAVIGATIONS:"sg/cms/navigation/getNavigations.json",COMMONLOADITEMNEW:"commonLoadItemNew.html",WDCOMMONSEARCHNEW:"wdCommonSearchNew.html",MYSTORE:"mstore/sg/myStore.json",ISREALNAMEAUTH:"kjt/bank/isRealNameAuth.json",CAPTCHAMOBILE:"platform/web/member/captchaMobile.json",REALNAMEAUTH:"kjt/bank/realNameAuth.json",REALNAMECHECK:"kjt/bank/realNameCheck.json",CHECKMOBILE:"platform/web/member/checkMobile.json",CHANGEMOBILE:"platform/web/member/changeMobile.json",NEW_SEND:"sg/cms/reserve/index.json",NEW_RES:"sg/cms/reserve/preSale.json",NEW_SLIDE:"sg/cms/secondPageBanner.json",NEW_FLASHSALE:"sg/cms/flashSales/docker.json",SUC_ZHONGCHOU:"activity/zhongchou/successZActivitys",GET_SMSS:"sg/cms/reserve/sendSmsCaptcha.json",SUB_PRESS:"sg/cms/reserve/reserve.json",CHECK_RES:"sg/cms/reserve/checkMemberReserve.json",GET_PRODUCTCATENAME:"item/purchase/getProductCateName.json",GET_STORE_DETAIL:"mstore/sg/mechanism/findStoreMemberDetail.json",GET_APPLY_MENGZHU:"mstore/sg/mechanism/getTeamLevelApplyStatus.json",APPLY_MENGZHU:"mstore/sg/mechanism/teamLevelApply.json",APPLY_MENGZHU_NOT:"mstore/sg/mechanism/findTeamLevelApplyDesc.json",GET_VISI_BROW_HIS:"mstore/sg/mechanism/findStoreVisitStatistic.json",GET_STORE_DATA:"mstore/sg/mechanism/findVisitStatistic.json",GET_TEAM_DATA:"mstore/sg/mechanism/statisticalTeamData.json",GET_OWNER_DATA:"mstore/sg/mechanism/statisticalPersonalData.json",GET_PARTNER_TEAM:"mstore/sg/mechanism/pagingChildren.json",TEAM_SUPERVISE:"mstore/sg/mechanism/pagingChildren.json",TEAM_USERINFO:"mstore/sg/mechanism/findStoreMemberDetail.json",ORDER_LIST:"h5/order/getOrderList.json",TEAM_USERS:"mstore/sg/mechanism/findOrderProductUserInfo.json",TEAM_MESSAGE:"mstore/sg/mechanism/findOrderProductUserInfoDetail.json",STORE_PRODUCT:"mstore/sg/mechanism/findVisitStatistic.json",REGISTERS:"mstore/sg/checkRegisterParam.json",GET_HAIER_STAFF_MSG:"kjt/bank/sendSmsForEmp.json",POST_HAIER_STAFF_MSG:"kjt/bank/employerAuth.json",REGISTERS_NEW:"platform/web/member/checkRegisterParam.json",TRUE_REALNAMEAUTH:"kjt/bank/isRealNameAuth.json",POST_USERDATAANDID:"kjt/bank/realNameAuth.json",POST_USERDATA:"kjt/bank/realNameCheckPC.json",GET_NAMEORID:"kjt/bank/realNameCheck.json",SHOP_SUCCESS_APPLY:"mstore/sg/registerNew.json",GET_PHONEAUTH:"kjt/bank/phoneAuth.json",GET_NAMEAUTH:"kjt/bank/nameAuth.json",GET_PROMOTION_CODE:"platform/web/member/findPromotionCodeByRegion.json",NEW_SHOP_STORE:"platform/web/member/registerAndStore.json",SHOP_STORE:"mstore/sg/wdApplySubmit.html",GET_BANKNAME:"kjt/bank/getBankName.json",GET_USORID:"kjt/bank/toBindCard.html",POST_CHECKS:"kjt/bank/bindCardCheck.json",GET_CODEID:"kjt/bank/captcha.json",POST_BANKDATA:"kjt/bank/bindCard.json",GET_learningHaier:"sg/h5/web/auth/mobile/learningHaier.json",GET_homeking:"sg/h5/web/auth/mobile/homeking.json",WHITE_SHOWS_APPLY:"v3/kjt/applyForOpen.json",WHITE_SHOWS_QUERY_AVALIAMT:"v3/kjt/queryAvaliAmt.json",WHITE_SHOWS_PAY:"v3/kjt/payApply.json",WHITE_SHOWS_QUERY_STATUS:"v3/kjt/queryIousStatus.json",WHITE_SHOWS_COST:"v3/kjt/iouc/cost.json",GET_STORE_MSG:"item/home/point.json",POST_PRIVILEGE_CODE:"h5/order/checkCodeAndGift.json",IF_CIRCLEPAGE:"/circle/getSqzbLink.ajax",LIFE_SERVICES:"sg/cms/home/life.json",SMART_HOME:"sg/cms/home/smart.json",HOME_MAKE:"sg/cms/home/diy.json",NEW_HOME_BANNER:"sg/cms/home/banner.json",NEW_HOME_TOPIC:"sg/cms/home/storys.json",ACT_LIST:"sg/cms/home/designer/list.json",FULL_SOLUTION:"sg/cms/home/programs.json",FILTER_TAG:"sg/cms/home/case/label.json",FILTER_PRODUCTLIST:"sg/cms/home/case/list.json",HOME_DETAIL:"sg/cms/home/case/details.json",HOUSE_YUYUE:"sg/cms/home/design.json",HOUSE_LISTDETAIL:"sg/cms/home/programs/list.json",HOUSE_FROM_PRODETAIL:"sg/cms/home/programs/listByProductId.json",ITSOLU_DETAIL:"sg/cms/home/programs/details.json",ITSOLU_PRODUCTLIST:"sg/cms/home/programs/details/products.json",ITSOLU_PRODUCTLIST:"sg/cms/home/programs/details/sequenceProducts.json",DESIGN_DETAIL:"sg/cms/home/designer/details.json",DESIGN_SOLULIST:"sg/cms/home/designer/case/list.json",EXPORT_DETAIL:"sg/cms/home/experts.json",RECENTLY_WORK:"sg/cms/home/nearby.json",TEST_STORE_DETAIL:"sg/cms/home/nearbyDetail.json",NEARBY_TYPES:"sg/cms/home/nearby/types.json",NEARBY_LIST:"sg/cms/home/nearby/list.json",SMART_SCENES:"sg/cms/home/smart/scenes.json",SMART_SPACE:"sg/cms/home/smart/space.json",GET_SERVICE_PRO:"item/purchase/getDes.json",GET_GIFTS:"h5/order/getGiftBag.json",PRESERVATION_GIFTS:"h5/order/choiceGiftBag.json"},u=[{username:"message_user_ro",password:"nYXPFND2"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"}],g=[{name:"LOADMOREPRODUCTS_INIT",value:"SEARCH_SERVER_DATA"},{name:"GET_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SHOP_INFO_LIST",value:"SEARCH_SERVER_DATA"},{name:"ACTIVITY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"GET_FILTER_DATA",value:"SEARCH_SERVER_DATA"},{name:"SEARCHGOODS_INIT",value:"SEARCH_SERVER_DATA"},{name:"SEARCH_GOODS",value:"SEARCH_SERVER_DATA"},{name:"HOT_WORDS",value:"SEARCH_SERVER_DATA"},{name:"DEFAULTSEARCH_WORDS",value:"SEARCH_SERVER_DATA"},{name:"ASSOCIATIONAL_WORDS",value:"SEARCH_SERVER_DATA"},{name:"PRODUCTDETAIL_LODEDATA",value:"ITEM_SERVER_DATA_NEW"},{name:"PRODUCTDETAIL_PROMOS",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_PRODUCTCATENAME",value:"ITEM_SERVER_DATA_NEW"},{name:"ORDERDETAIL_SPECIFICATIONS",value:"ITEM_SERVER_DATA_NEW"},{name:"SECKILLDETAIL",value:"ITEM_SERVER_DATA"},{name:"CHECK_NOTICE",value:"ITEM_SERVER_DATA"},{name:"START_NOTICE",value:"ITEM_SERVER_DATA"},{name:"ARRIVE_NOTICE",value:"ITEM_SERVER_DATA"},{name:"GET_O2O_NAME",value:"ITEM_SERVER_DATA"},{name:"GET_MERGE_IMAGE",value:"ITEM_SERVER_DATA"},{name:"NEW_SHOP_COUPONS_LIST",value:"ITEM_SERVER_DATA"},{name:"PRODUCT_COUPONS_HAS",value:"ITEM_SERVER_DATA"},{name:"POST_STORE_INFO",value:"ITEM_SERVER_DATA"},{name:"LOCATION_CHANGE",value:"ITEM_SERVER_DATA_NEW"},{name:"EVALUATE_INFO",value:"ITEM_SERVER_DATA_NEW"},{name:"WDCOMMONSEARCHNEW",value:"SEARCH_SERVER_DATA"},{name:"COMMONLOADITEMNEW",value:"SEARCH_SERVER_DATA"},{name:"FAXIAN_INIT",value:"SEARCH_SERVER_DATA"},{name:"ASYNC_ACCESS_PRICE",value:"SEARCH_SERVER_DATA"},{name:"SPECIALY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SECONDLEVEL_PRODUCTLIST",value:"SEARCH_SERVER_DATA"},{name:"ADD_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"CANCEL_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"GET_GETSGSTOREATTRIBUTE",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_GETDETAILATTRIBUTE",value:"ITEM_SERVER_DATA"},{name:"GET_ISSHOWATTR",value:"ITEM_SERVER_DATA_NEW"},{name:"PAY_CHECK_STOCK",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_STORE_MSG",value:"ITEM_SERVER_DATA_NEW"},{name:"GET_SERVICE_PRO",value:"ITEM_SERVER_DATA_NEW"}];this.getUrl=function(t){for(var o=e[2],s=o.SERVER_DATA,i=0;i<g.length;i++)if(t===g[i].name){o[g[i].value]&&(s=o[g[i].value]);break}return s+p[t]},this.getLiveingUrl=function(){return d},this.getNewUrl=function(e){return o+p[e]},this.getTopUrl=function(e){return l+p[e]},this.getWSUrl=function(e){return i+p[e]},this.getCPUrl=function(e){return p[r+e]},this.getMQAuth=function(){return u[2]},this.getAMAPUrl=function(){return e[2].AMAP_SERVER},this.getFakeUrl=function(e){return"./data/"+p[e]},this.getHead=function(){return t},this.getHeadV2=function(){return s},this.getZCUrl=function(e){return a+p[e]},this.getThirdUrl=function(e){return a+e},this.getCcbUrl=function(e){return n+p[e]},this.getPayCenter=function(e){return c+p[e]},this.getWhiteShowsUrl=function(e){return n+p[e]},this.getEnviroment=function(){return 0},this.getSharePicHeader=function(){return e[2].SHAREPICHEADER},this.getShareLinkHeader=function(){return e[2].SHARELINKHEADER},this.getServiceV2=function(t){return e[2].SERVER_DATA_V2+p[t]},this.getGameUrl=function(t){return e[2].SERVER_DATA_GAME+p[t]}}]),APP.controller("bindingBankControl",["UrlService","InAppBrowserService","$ionicPopup","trueAuthenticationService","$ionicHistory","$timeout","$scope","$state","bindingBankService","$stateParams","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d){n.isComplete=!1,n.isPrompts=!1,n.isHasKey=!1,n.isHasVal=!1,n.isPhoneNum=!1,n.isType=!1,n.isOkType=!1,n.isEffective=!1,n.agreement=!1,n.isOther=!1,n.isAccord=!1,n.isReplaces=!1,n.isInputs=!1,n.isIdNumber=!1,n.isShows=!1,n.isOKTel=!1,n.isTrueMsg=!1,n.isNotAuthentication=!1,n.phoneNumber="",n.IDNumber="",n.userName="",n.bankNo="",n.isBankType=!1,n.isBankNum=!0,n.hasChooseBankCode="",n.hasChooseBank="",n.slice=window.slice,n.selectionStart=window.selectionStart,n.selectionEnd=window.selectionEnd,n.$on("$ionicView.beforeEnter",function(e,t){d.$on("haveChooseBank",function(e,t,o,s){n.hasChooseBank=s,n.hasChooseBankCode=o}),n.obj.bankNames=n.hasChooseBank,"back"!=t.direction&&(n.isOkType=!1,n.isEffective=!1,n.isShows=!1,n.isInputs=!1,n.isIdNumber=!1,n.isReplaces=!1,n.isAccord=!1,n.isOther=!1,n.isBankType=!1,n.isComplete=!1,n.asyncs=!1,n.isType=!1,n.isOKTel=!1,n.isBankNum=!0,n.obj.isMyBank="",n.obj.isMyName="",n.obj.isMyIdNumber="",n.obj.phoneNumber="",n.hasChooseBank="",n.obj.bankNames="",n.init())}),n.goBack=function(){i.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(n.paddingtopClass={"margin-top":"16px"},n.paddingtopClasscontent={top:"60px"}):(n.paddingtopClass={"margin-top":"0px"},n.paddingtopClasscontent={top:"44px"}),n.toRules=function(o,s){-1!=navigator.userAgent.indexOf("iPhone")?t.open(e.getHead()+"mstore/sg/helpDetail.html?id="+o,s):r.go("helpDetail",{helpId:o,content:s})},n.obj={isMyName:"",isMyIdNumber:"",isMyBank:"",phoneNumber:"",bankNames:"",agreement:!1},n.init=function(){s.doInit().success(function(e){e.success?(n.isNotAuthentication=e.data.isAuth,n.isNotAuthentication?(n.isTrueMsg=!1,n.isInputs||c.getUsOrId().success(function(e){e.success?(n.IDNumber=e.data.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,s){for(var i="";i.length<o.length;)i+="*";return t+i+s}),n.userName=e.data.realName.replace(/.{1}/,"*"),n.name=e.data.realName,n.ids=e.data.identityNo):(n.message=e.message,n.isAccord=!0)})):n.isTrueMsg=!0):(n.message=e.message,n.isRetry=!0)})},n.goTrueAutThentication=function(){n.isTrueMsg=!1,r.go("trueAuthentication",{type:5})},n.isNoTrue=function(){i.goBack(),n.isTrueMsg=!1},n.isAgreement=function(){n.obj.agreement=!n.obj.agreement},n.retry=function(){n.isOther=!1},n.isClear=function(){n.obj.isMyBank="",n.hasChooseBankCode="",n.hasChooseBank="",n.obj.phoneNumber="",n.isPhoneNum=!1},n.isClearVal=function(){n.obj.phoneNumber=""},n.isMoreInfo=function(){n.isOther=!0},n.phoneClose=function(){n.isAccord=!1},n.isRepl=function(){n.isReplaces=!0},n.replaceInfoOk=function(){n.isInputs=!0,n.isIdNumber=!0,n.isReplaces=!1,n.isType=!1,n.isOkType=!1,n.isOKTel=!1,n.isShows=!0,n.obj.isMyBank="",n.obj.phoneNumber="",n.hasChooseBankCode="",n.hasChooseBank="",n.isPhoneNum=!1,n.isBankNum=!1},n.replaceInfoClose=function(){n.isReplaces=!1,n.isInputs=!1,n.isIdNumber=!1,n.isBankNum=!0},n.mobileFun=function(){d.globalConstant.mobileNumberRegExp.test(n.obj.phoneNumber)?(n.isOKTel=!1,n.obj.agreement||""==n.userName||""==n.IDNumber?n.isComplete=!1:n.isComplete=!0):(n.isComplete=!1,n.obj.phoneNumber.length>=11?n.isOKTel=!0:n.isOKTel=!1)},n.logicFn=function(){9==n.obj.isMyBank.length?(n.bankCodes=n.obj.isMyBank.replace(/\s*/g,""),c.getBankName(n.bankCodes).success(function(e){null==e.data.bankNames?(n.isOkType=!1,n.isType=!0,n.bankNo=n.hasChooseBankCode,n.obj.bankNames=n.hasChooseBank,n.bankPhone=""):1==e.data.bankNames.cardTypeCode?(n.bankPhone=e.data.bankPhone,n.bankNo=e.data.bankNames.bankNo,n.isOkType=!0,n.isType=!1,n.isBankType=!1,n.obj.bankNames=e.data.bankNames.bankName):(n.isPhoneNum=!1,n.isBankType=!0,n.isComplete=!1)})):n.obj.isMyBank.length<9&&(n.isOkType=!1,n.isType=!1),!n.isOkType||23!=n.obj.isMyBank.length&&19!=n.obj.isMyBank.length?(n.isComplete=!1,n.isOKTel=!1,n.isOkType&&(n.isPhoneNum=!1),n.isType&&n.mobileFun()):(n.isEffective=!1,n.isEffectiveOK=!1,n.isPhoneNum=!0,n.mobileFun())},n.async=function(){""!=n.obj.isMyName&&n.obj.isMyIdNumber.length<19&&s.getUsNameOrId(n.obj.isMyName,n.obj.isMyIdNumber).success(function(e){e.data?(n.isBankNum=!0,n.info=e.message,n.isEffective=!0):(n.info=e.message,n.isEffective=!0,n.isBankNum=!1)})};n.$watch("obj",function(){""==n.obj.bankNames||23!=n.obj.isMyBank.length&&19!=n.obj.isMyBank.length?n.isPhoneNum=!1:n.isPhoneNum=!0,n.isShows?/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,15}$/.test(n.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(n.obj.isMyIdNumber)?(n.asyncs||s.getUsNameOrId(n.obj.isMyName,n.obj.isMyIdNumber).success(function(e){n.asyncs=!0,e.data?(n.info=e.message,n.isEffective=!0,n.isBankNum=!0):(n.info=e.message,n.isEffective=!0,n.isBankNum=!1)}),n.logicFn()):(n.isComplete=!1,n.isEffective=!1,n.asyncs=!1,n.isBankNum=!1):n.logicFn(),""!=n.obj.isMyBank?n.isHasKey=!0:n.isHasKey=!1,""!=n.obj.phoneNumber?n.isHasVal=!0:n.isHasVal=!1},!0);n.join=window.join,n.keyFun=function(e){var t=document.getElementById("keyRoom"),o=t.value;if(8==(e||event).keyCode){if(o){for(var s=0;s<o.length;s++)var i=o.replace(/\s$/g,"");t.value=i}}else{for(var s=0;s<o.length;s++){var a=o.split("");(s+1)%5==0&&a.splice(s,0," ")}t.value=a.join("")}},n.commonFun=function(e,t,o,s){c.bankCheck(e,t,o,s).success(function(i){i.success?i.data.isThrough&&(n.isAccord=!1,c.VerificationCode(s).success(function(i){n.message=i.message,i.success?(r.go("verificationCode",{ownerName:e,identityNo:t,cardNo:o,mobile:s,bankNo:n.bankNo,phoneNumber:n.bankPhone}),n.isAccord=!1):n.isAccord=!0})):(n.message=i.message,n.isAccord=!0)})},n.goAuthentication=function(e,t,o,s,i,a){n.bankCodes=n.obj.isMyBank.replace(/\s*/g,""),n.obj.phoneNumber=n.obj.phoneNumber.replace(/\s*/g,""),n.isShows?n.commonFun(n.obj.isMyName,n.obj.isMyIdNumber,n.bankCodes,n.obj.phoneNumber):n.commonFun(n.name,n.ids,n.bankCodes,n.obj.phoneNumber)}}]),APP.service("bindingBankService",["$http","UrlService",function(e,t){this.doInit=function(o,s){var i={userName:o,password:s};return e.get(t.getUrl("HOME_INIT"),i)},this.getBankName=function(o){var s={cardNo:o};return e.get(t.getUrl("GET_BANKNAME"),s)},this.getUsOrId=function(){return e.get(t.getUrl("GET_USORID"))},this.bankCheck=function(o,s,i,a){var n={ownerName:o,identityNo:s,cardNo:i,mobile:a};return e({method:"POST",url:t.getUrl("POST_CHECKS"),params:n})},this.VerificationCode=function(o){var s={mobile:o};return e.get(t.getUrl("GET_CODEID"),s)}}]),APP.controller("verificationCodeControl",["$ionicHistory","PopupService","$interval","$timeout","$scope","$state","verificationCodeService","$stateParams",function(e,t,o,s,i,a,n,r){i.isComplete=!1,i.captchaFlag=!0,i.isOK=!1,i.isBindBackOK=!1,i.paracont="重新获取",i.isAccord=!1,i.obj={numbers:""},i.name=r.ownerName,i.idNum=r.identityNo,i.bankCode=r.cardNo,i.mobile=r.mobile,i.phoneNum=r.mobile.replace(/^(\d{3})\d{4}(\d{4})$/,"$1****$2"),i.bankNo=r.bankNo,i.phoneNumber=r.phoneNumber;var c,l=void 0;i.goBack=function(){e.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.commonFnCode=function(){c=60,l=o(function(){c<=0?(o.cancel(l),l=void 0,c=60,i.paracont="重新获取",i.captchaFlag=!0):(i.paracont=c-1+"秒后可重发",i.captchaFlag=!1,c--)},1e3,100)},i.init=function(){n.VerificationCode(i.mobile).success(function(e){e.success?i.commonFnCode():t.showToast("获取验证码失败！")})},i.$on("$ionicView.beforeEnter",function(){i.captchaFlag=!0,c=60,i.paracont="重新获取",o.cancel(l),i.commonFnCode(),i.isAccord=!1,i.isOK=!1,i.isBindBackOK=!1,i.obj.numbers=""}),i.goAuthentication=function(){n.bankCheckOK(i.name,i.bankCode,i.bankNo,i.mobile,i.obj.numbers).success(function(e){i.message=e.message,e.success?(i.isBindBackOK=!0,i.isOK=!1,s(function(){i.isBindBackOK=!1,a.go("personnalCenter")},1e3)):(i.isBindBackOK=!1,i.isOK=!0)})},i.phoneClose=function(){i.isAccord=!1},i.Close=function(){i.isOK=!1},i.isReceived=function(){i.isAccord=!0},i.againGet=function(){i.captchaFlag&&i.init()},i.myFun=function(){/^\d{6}$/.test(i.obj.numbers)?i.isComplete=!0:i.isComplete=!1}}]),APP.service("verificationCodeService",["$http","UrlService",function(e,t){this.VerificationCode=function(o){var s={mobile:o};return e.get(t.getUrl("GET_CODEID"),s)},this.bankCheckOK=function(o,s,i,a,n){var r={ownerName:o,cardNo:s,bankNo:i,mobile:a,captcha:n};return e.post(t.getUrl("POST_BANKDATA")+"?ownerName="+r.ownerName+"&cardNo="+r.cardNo+"&bankNo="+r.bankNo+"&mobile="+r.mobile+"&captcha="+r.captcha)}}]),APP.controller("CartController",["$rootScope","HomePageService","$scope","$stateParams","CartService","$state","$ionicPopup","LoginService","$timeout","$cookies","PopupService","ProductDetailService","$ionicScrollDelegate","GetCouponsService","$location","UserService","$localstorage","IMService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){o.remindSuccess=!1;var S=1;o.getcoupons=!0,o.hasMoreCoupons=!1;var I=[];o.all={isAllChecked:!0},o.orderInitParams=null;var w,y;o.logConpous=function(){p.getShopCoupons(I[0],I[1],I[2],I[3],S,5,I[4]).success(function(e,t,s,i){e.success?1==S?(S++,o.shopCoupons=e.data,u.$getByHandle("mainScroll").scrollTop(),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(S++,o.shopCoupons=o.shopCoupons.concat(e.data),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)})},o.closeCoupons=function(){S=1,I=[],o.getcoupons=!1},o.openCoupons=function(e,t,s,i,a){I[0]=e,I[1]=t,I[2]=s,I[3]=i,I[4]=a,o.logConpous(),o.getcoupons=!0},o.getNewCoupons=function(s){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?a.go("login"):g.doGetNewCoupons(s).success(function(t){t.success?(e.couponXyzType=!0,u.scrollTop(),S=1,o.logConpous()):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(){o.tabNav="cart",o.isShow=!1,o.noGoods=!1,o.cartMessage={},o.cartSelectedMode=[],o.htmlContent=s.content,o.title=s.title,t.isWdHost().success(function(t){e.isWdHost=t.data.isHost}),p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)}),i.loadCartMessage().success(function(e,t,s,i){o.isShow=!1,0==e.totalCount?o.noGoods=!0:(o.cartMessage=e,o.cartSubTitle="总共"+o.cartMessage.totalCount+"件商品",o.noGoods=!1,o.isShow=!0,o.checkAll(!0))}).error(function(){o.isShow=!1,o.showPopup("查询购物车失败")}),o.all.isAllChecked=!1},o.$on("$ionicView.beforeEnter",function(){o.remindSuccess=!1,o.getcoupons=!1,o.hasMoreCoupons=!1,o.isBuyerForCart=r.getRole(),o.init(),o.footerSubmit={position:"fixed",bottom:"49px"},w=window.navigator.userAgent.toLowerCase(),y="micromessenger"==w.match(/MicroMessenger/i)}),o.htmlContent=s.content,o.title=s.title,o.all.isAllChecked=!1,o.totalMoney=0,o.saveSelectedIndex=function(e,t){var s=o.cartSelectedMode.indexOf(e);t?s<0&&o.cartSelectedMode.push(e):o.cartSelectedMode.splice(s,1)},o.selectedChanged=function(e,t,s){o.saveSelectedIndex(s,t),o.all.isAllChecked=o.cartSelectedMode.length==o.cartMessage.data.carts.length,o.accountTotalMoney()},o.checkAll=function(e){o.all.isAllChecked=e,angular.forEach(o.cartMessage.data.carts,function(t,s){t.isChecked=e,o.saveSelectedIndex(s,e)}),o.accountTotalMoney()},o.deleteProduct=function(e){if(o.cartSelectedMode.splice(e,1),null==o.cartMessage.data.carts[e].skku||"null"==o.cartMessage.data.carts[e].skku)var t=o.cartMessage.data.carts[e].sku;else var t=o.cartMessage.data.carts[e].skku;i.deleteProduct(t,o.cartMessage.data.carts[e].productId).success(function(e,t,s,i){1==e.success?(o.init(),void 0!=o.cartMessage.data&&o.accountTotalMoney()):alert("删除商品失败")})};var T=!1;o.nus=function(t){if(!T)if(o.cartMessage.data.carts[t].number<=1)o.cartMessage.data.carts[t].number=1;else{if(T=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var s=o.cartMessage.data.carts[t].sku;else var s=o.cartMessage.data.carts[t].skku;i.nusplus(s,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number-1).success(function(s,i,a,n){o.cartMessage.data.carts[t].number-=1,o.accountTotalMoney(),T=!1,p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}};var C=!1;o.plus=function(t){if(!C){if(C=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var s=o.cartMessage.data.carts[t].sku;else var s=o.cartMessage.data.carts[t].skku;i.nusplus(s,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number+1).success(function(s,a,n,r){if(0==s.success){var c=s.message;if(null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var l=o.cartMessage.data.carts[t].sku;else var l=o.cartMessage.data.carts[t].skku;i.nusplus(l,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number).success(function(e){return d.showToast(c),C=!1,!1})}else o.cartMessage.data.carts[t].number+=1,o.accountTotalMoney(),C=!1;p.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}},o.accountTotalMoney=function(){var e=0;angular.forEach(o.cartMessage.data.carts,function(t,s){o.cartSelectedMode.indexOf(s)>-1&&(e+=t.number*t.nowPrice,o.cartSelectedMode.sort(function(e,t){return e>t?1:-1}))}),o.totalMoney=e},o.settlement=function(){if(-1==e.isWdHost)return void a.go("login");if(o.cartSelectedMode.length>0){for(var t=[],s=[],n=[],r=[],c="",d="",p="",u=0;u<o.cartSelectedMode.length;u++)t[u]=o.cartMessage.data.carts[o.cartSelectedMode[u]];angular.forEach(t,function(e,t){s[t]=e.productId,n[t]=e.number,r[t]=e.productName,null==e.attrValueNames||"null"==e.attrValueNames?c+="null;":c+=e.attrValueNames+";",null==e.skku||"null"==e.skku?d+="null;":d+=e.skku+";",null==e.o2oAttrId||"null"==e.o2oAttrId?p+="null;":p+=e.o2oAttrId+";"}),c=c.substring(0,c.length-1),d=d.substring(0,d.length-1),p=p.substring(0,p.length-1),s=s.join(","),n=n.join(","),r=r.join(","),i.checkPageInfo(s,n).success(function(e){if(0==e.success)o.showPopup(e.message);else{for(var t=[],r=0;r<s.split(",").length;r++)"null"!=c.split(";")[r]?t.push({proId:s.split(",")[r],num:n.split(",")[r],sku:d.split(";")[r],name:c.split(";")[r]}):t.push({proId:s.split(",")[r],num:n.split(",")[r]});o.orderInitParams={proList:t,street:""},i.settlement(o.orderInitParams).success(function(e,t,s,i){if(0==e.success)o.showPopup(e.message);else if(1==e.success&&null!=e.data){o.cartSelectedMode=[];var n=new Date;n.setDate(n.getDate()+1),l.put("is_book","",{expires:n,path:"/"}),a.go("orderConfirm",{orderInitParams:JSON.stringify(o.orderInitParams)})}else o.showPopup("结算失败")})}})}else o.showPopup("您未选择任何商品")},o.showPopup=function(e){var t=n.show({template:e});c(function(){t.close()},1e3)}}]),APP.service("CartService",["$http","UrlService",function(e,t){this.loadCartMessage=function(){return e.get(t.getUrl("CART_LIST"))},this.getNumber=function(){return e.get(t.getUrl("SPECIALTY_CART_NUM"))},this.nusplus=function(o,s,i){var a={sku:o,productId:s,number:i,noLoading:!0};return e.get(t.getUrl("GOODS_NUMBER"),a)},this.deleteProduct=function(o,s){var i={sku:o,productId:s};return e.get(t.getUrl("DELETE"),i)},this.settlement=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.checkPageInfo=function(o,s){var i={productIds:o,productNames:s};return e.get(t.getUrl("CHECK_PAGE_INFO"),i)},this.check_login=function(){return e.get(t.getUrl("CHECK_LOGIN"))},this.state_id=function(o){var s={data:o};return e.get(t.getUrl("STATE_ID"),s)}}]),APP.controller("CouponsDetailController",["$rootScope","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","CouponsDetailNewService","$ionicScrollDelegate","GetCouponsService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(){for(var e=0;e<window.screen.availWidth/12;e++)t.divStr[e]=12*e+4}function g(e){return!!/^1[34578]\d{9}$/.test(e)}function m(e){return e=e<10?"0"+e:e}function f(e,o){t.endT=o-e,S=p(function(){t.endTt=m(Math.floor(t.endT/86400)),t.endTh=m(Math.floor((t.endT-86400*t.endTt)/3600)),t.endTm=m(Math.floor((t.endT-86400*t.endTt-3600*t.endTh)/60)),t.endTs=m(t.endT-86400*t.endTt-3600*t.endTh-60*t.endTm),-1==--t.endT&&($state.reload(),p.cancel(S))},1e3)}var h=n.cId,v="",$="";t.data="";var S;t.remindme=!1,t.remindSuccess=!1,t.canSubmit=!1,t.endT="",t.endTt="",t.endTh="",t.endTm="",t.endTs="",t.divStr=[],t.backGroundBlue={background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},t.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},t.openRemindMe=function(e){h=e,t.remindme=!0},t.closeRemindMe=function(){t.remindme=!1},t.telVerification=function(e){11==e.length&&g(e)?(v=e,t.canSubmit=!0):t.canSubmit=!1},t.submitBackstage=function(){d.doRemindCoupons(v,h).success(function(o){t.message=o.message,t.remindme=!1,t.remindSuccess=!0,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500),o.success&&(l.scrollTop(),t.getCouponsData(),e.$broadcast("COUPONS_DETAIL_STATE",$))})},t.progress=function(e){return.9*e},t.getNewCoupons=function(o){d.doGetNewCoupons(o).success(function(o){o.success?(l.scrollTop(),e.$broadcast("COUPONS_DETAIL_STATE",$),startIndex=1,t.getCouponsData()):(t.remindSuccess=!0,t.message=o.message,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500))})},t.goBack=function(){"advertisement"==e.fromState?$state.go("homePage"):t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.getCouponsData=function(){p.cancel(S),c.getCouponsDataNew(h).success(function(e){t.data=e.data,f(e.data.nowTime,e.data.activityStartTime)})},t.$on("$ionicView.beforeEnter",function(){t.data="",$=n.type,u(),t.getCouponsData()}),t.$on("$ionicView.beforeLeave",function(){p.cancel(S)})}]),APP.service("CouponsDetailNewService",["$http","UrlService",function(e,t){this.getCouponsDataNew=function(o){var s={couponId:o};return e.get(t.getUrl("COUPONS_DETAIL_LIST"),s)}}]),APP.controller("CouponsDetailTwoController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CouponsDetailTwoService","$timeout","UrlService","$ionicPopup","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d){e.htmlContent=o.content,e.title=o.title,e.id=o.cId,e.userID=o.userID,e.type=o.type,e.status=o.status,e.couponId=o.couponId,e.isUser=o.isUser,e.$on("$ionicView.beforeEnter",function(){e.data="",e.init()}),e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=c.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(t){t.preventDefault(),null!=e.data.memberId?a.getMemberName(e.data.memberId).success(function(t,s,i,a){1==t.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,e.couponId),e.data.messsage=t.data):(e.findMember=!1,e.data.messsage=t.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){c.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?a.donationCoupons(e.data.memberId,o).success(function(t,o,s,i){1==t.success&&0!=t.result?(d.goBack(),e.data.messsage=t.data):0==t.result&&l.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.init=function(){e.htmlContent=o.content,e.title=o.title,a.initData(e.id,e.userID,e.type,e.couponId).success(function(t,o,s,i){e.data=t.data,e.haveCity=!1,e.haveArea=!1,e.haveStreet=!1;for(var a in e.data.cityNameMap)e.haveCity=!0;for(var n in e.data.areaNameMap)e.haveArea=!0;for(var r in e.data.streetNameMap)e.haveStreet=!0})},e.getCouponSuccess="",e.getCoupon=!1,e.getCoupons=function(){a.receiveCoupons(e.data.coupon.id).success(function(t,o,s,i){e.getCouponSuccess=t.data,e.getCoupon=!e.getCoupon}),n(function(){e.getCouponSuccess=""},5e3),e.share=function(){if(window.umeng){var t=r.getSharePicHeader()+"mstatic/wd/v2/img/sg.png",o=r.getShareLinkHeader()+"mstore/sg/coupon/toList.html?id="+e.id+"&type=0&storeId="+UserService.getUser().mid+"&lastUrl=4";window.umeng.share("顺逛领领券频道,优惠券等您来抢","给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",t,o,0)}}}}]),APP.service("CouponsDetailTwoService",["$http","UrlService",function(e,t){this.donationCoupons=function(o,s){var i={memberId:o,id:s};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:i})},this.getMemberName=function(o){var s={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:s})},this.initData=function(o,s,i,a){var n={id:o,storeId:s,type:i,lastUrl:"",mId:a};return e.get(t.getUrl("GET_COUPONS_DETAIL"),n)},this.receiveCoupons=function(o){var s={couponId:o};return e({method:"POST",url:t.getUrl("RECEIVE_COUPONS"),params:s})}}]),APP.controller("GetCouponsListController",["$rootScope","HomePageService","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","GetCouponsService","$ionicScrollDelegate","$state","$interval","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(){for(var e=0;e<window.screen.availWidth/12;e++)o.divStr[e]=12*e+4}function f(e){return!!/^1[34578]\d{9}$/.test(e)}function h(e){return e=e<10?"0"+e:e}function v(e,t,s){o.endT[s]=t-e,T[s]=u(function(){o.endTt[s]=h(Math.floor(o.endT[s]/86400)),o.endTh[s]=h(Math.floor((o.endT[s]-86400*o.endTt[s])/3600)),o.endTm[s]=h(Math.floor((o.endT[s]-86400*o.endTt[s]-3600*o.endTh[s])/60)),o.endTs[s]=h(o.endT[s]-86400*o.endTt[s]-3600*o.endTh[s]-60*o.endTm[s]),-1==--o.endT[s]&&(p.reload(),u.cancel(T[s]))},1e3)}o.dataList="",o.typeIdDefault="";var $="",S="";o.divStr=[],o.remindme=!1,o.remindSuccess=!1,o.canSubmit=!1;var I=[],w=[],y=[],T=[],C="";o.hasmore=!1,o.isHasCoupons=!1;var b=1;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.endT=[],o.endTt=[],o.endTh=[],o.endTm=[],o.endTs=[],o.goBack=function(){"advertisement"==e.fromState?p.go("homePage"):o.$ionicGoBack()},o.share=function(){if(window.cordova){if(!g.getUser().mid)return void p.go("login");o.showShare=!0}else i.showAlert("只能在app分享","抱歉，只能在app分享")},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"},o.typeClass={top:"59px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"},o.typeClass={top:"43px"}),o.backGroundBlue={
background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},o.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},o.typeAllShow=!1,o.typeDefault=0,o.typeDataList=[],o.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},o.noTypeStyle={color:"rgba(102,102,102,0.87)"},o.isTypeStyleAll={border:"1px solid #2979FF",color:"#2979FF"},o.noTypeStyleAll={color:"rgba(76,76,76,0.87)",border:"1px solid #999"},o.typeButton=function(e,t){o.isHasCoupons=!1,o.typeDefault=e,o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.allTypeButton=function(e,t){if(o.isHasCoupons=!1,e>1){var s=o.typeDataList[e];o.typeDataList.splice(e,1),o.typeDataList.splice(1,0,s),o.typeDefault=1}else o.typeDefault=e;o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.cotAllType=function(e){o.typeAllShow=e},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="顺逛领券频道,优惠券等您来抢",s="给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",r=n.getShareLinkHeader()+"getCouponsList/"+g.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,s,i,r,0,null,a.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,s,i,r,0,null,a.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,s,i,r,0,null,a.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,s,i,r,0,null,a.shareSuccessCallback),a.qqShare()):4==e&&(window.umeng.shareToQzone(t,s,i,r,0,null,a.shareSuccessCallback),a.qqShare()),5==e?o.copeText(r):a.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.openRemindMe=function(e){$=e,o.remindme=!0},o.closeRemindMe=function(){o.remindme=!1},o.telVerification=function(e){11==e.length&&f(e)?(S=e,o.canSubmit=!0):o.canSubmit=!1},o.submitBackstage=function(){l.doRemindCoupons(S,$).success(function(e){o.message=e.message,o.remindme=!1,o.remindSuccess=!0,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500),e.success&&(b=1,o.init(o.typeIdDefault))})},o.progress=function(e){return.9*e},o.getNewCoupons=function(s){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?p.go("login"):l.doGetNewCoupons(s).success(function(t){t.success?(e.couponXyzType=!0,b=1,o.init(o.typeIdDefault)):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(e){for(var t=0;t<y.length;t++)u.cancel(T[y[t]]);y=[],o.dataList="",l.doInit(1,5,e).success(function(e,t,s,i){if(e.success)if(null!==e.data){o.dataList=e.data;for(var a=0;a<o.dataList.length;a++)3!=o.dataList[a].displayType&&4!=o.dataList[a].displayType||(y.push(a),I[a]=o.dataList[a].nowTime,w[a]=o.dataList[a].activityStartTime);for(var n=0;n<y.length;n++)v(I[y[n]],w[y[n]],y[n]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.isHasCoupons=!0;else o.hasmore=!1})},o.initType=function(){l.doInitType().success(function(e,t,s,a){e.success?(o.typeDataList=e.data,o.typeIdDefault=o.typeDataList[0].id,o.init(o.typeIdDefault)):i.showToast(e.message)})},o.loadMore=function(){b++,l.doInit(b,5).success(function(e,t,s,i){if(e.success){C=y.length,y=[],e.data&&(o.dataList=o.dataList.concat(e.data));for(var a=0;a<o.dataList.length;a++)3!=o.dataList[a].displayType&&4!=o.dataList[a].displayType||(y.push(a),I[a]=o.dataList[a].nowTime,w[a]=o.dataList[a].activityStartTime);for(var n=C;n<y.length;n++)v(I[y[n]],w[y[n]],y[n]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.hasmore=!1})},o.$on("$ionicView.beforeEnter",function(i,a){if("back"==a.direction)return"ClassifyMessageCenter"==s.viewHistory().forwardView.stateName&&t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1}),e.couponXyzType&&(o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})),void(e.couponXyzType=!1);d.scrollTop(),o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})}),o.$on("$ionicView.beforeLeave",function(){for(var e=0;e<y.length;e++)u.cancel(T[y[e]])}),e.$on("COUPONS_DETAIL_STATE",function(e,t){o.init(t)})}]),APP.service("GetCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i){var a={startIndex:o,pageSize:s,couponCateId:i};return e.get(t.getNewUrl("NEW_GET_COUPONS_LIST"),a)},this.doInitType=function(){return e.get(t.getNewUrl("NEW_GET_COUPONS_TYPE"))},this.doRemindCoupons=function(o,s){var i={phone:o,couponId:s};return e.get(t.getUrl("REMIND_COUPONS_LIST"),i)},this.doGetNewCoupons=function(o){var s={couponId:o};return e.get(t.getNewUrl("GET_NEW_COUPONS"),s)}}]),APP.controller("MyCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","GoodsService","$state","AreaService","$timeout","MyCouponsListService","$ionicPopup","PopupService","CacheService","UserService","$ionicScrollDelegate","$ionicModal","$http","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(){for(var t=0;t<window.screen.availWidth/12;t++)e.divStr[t]=12*t+4}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"},e.typeClass={top:"59px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"},e.typeClass={top:"43px"}),e.typeDefault=0,e.backGroundBlue={background:"url("+t.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+t.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.noTypeStyle={color:"rgba(102,102,102,0.87)"},e.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},e.toDetail=function(t,o){var s=u.getUser().mid;a.go("couponsDetailTwo",{cId:t,userID:s,type:0,status:e.status,couponId:o})},e.typeButton=function(t){e.typeDefault=t},e.typeThreeData=["未使用","已使用","即将过期"],e.divStr=[],e.goBack=function(){h.goBack()},e.province=null,e.city=null,e.area=null,e.provinceId="",e.cityId="",e.areaId="",e.streetId="",e.status=1,e.$on("$ionicView.beforeEnter",function(o,s){if(v(),"back"==s.direction)return t.couponXyzType&&(e.status=1,e.init()),void(t.couponXyzType=!1);e.status=1,e.init()}),e.init=function(){c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.getCouponsSta=function(t,o){e.data="",e.status=t,0==o&&3==e.status?(e.status=4,c.doGetNewCouponsLate(100,1,1).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})):c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,s,i){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=l.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(s){s.preventDefault(),null!=e.data.memberId?c.getMemberName(e.data.memberId).success(function(s,i,a,n){1==s.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,t),e.data.messsage=s.data):(e.findMember=!1,e.data.messsage=s.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){l.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?c.donationCoupons(e.data.memberId,o).success(function(t,o,s,i){1==t.success&&0!=t.result?(e.getCouponSuccess=t.message,r(function(){e.getCouponSuccess=""},1e3),e.data.messsage=t.data,e.init(),g.resize()):0==t.result&&d.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.goCouponCenter=function(){a.go("getCouponsList")}}]),APP.service("MyCouponsListService",["$http","UrlService",function(e,t){this.getMyCouponsList=function(o,s,i,a,n){var r={status:o,provinceId:s||"",cityId:i||"",areaId:a||"",streetId:n||"",startIndex:1,pageSize:100};return e({method:"POST",url:t.getUrl("MY_COUPONS_LIST"),params:r})},this.donationCoupons=function(o,s){var i={memberId:o,id:s};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:i})},this.getMemberName=function(o){var s={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:s})},this.doGetNewCouponsLate=function(o,s,i){var a={pageSize:o,startIndex:s,status:i};return e.get(t.getUrl("MY_COUPONS_LIST_LATE"),a)}}]),APP.controller("RetainageController",["RetainageService","$scope","$rootScope","$stateParams","$state","PopupService",function(e,t,o,s,i,a){t.relationOrderSn=s.relationOrderSn,t.isChecked=!0,t.couponList="",t.selectCoupon=function(e,o,s){s?angular.forEach(t.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(t.couponList,function(e,t){e.isChecked=!1})},t.init=function(){e.getOrderList(t.relationOrderSn).success(function(e){0==e.success?a.showToast(e.message):t.couponList=e.data.couponList})},t.confirm=function(){var e=!1,o=0;angular.forEach(t.couponList,function(t,s){t.isChecked&&(e=!0,o=t.memberCouponId)}),e?t.getCoupons(t.relationOrderSn,o):(o="",t.getCoupons(t.relationOrderSn,o))},t.getCoupons=function(t,o){e.selectCoupons(t,o).success(function(e,o,s,n){if(1==e.success){var r=e.data.price;i.go("paymentxyz",{orderSn:t,totalAmount:r})}else a.showToast(e.message)}).error(function(){alert("使用优惠券失败")})},t.$on("$ionicView.beforeEnter",function(){t.noCanUseStyle={opacity:"0.4"},t.init()})}]),APP.service("RetainageService",["$http","UrlService",function(e,t){this.getOrderList=function(o){var s={relationOrderSn:o};return e.get(t.getUrl("SELECT_GOODS_COUPONS0"),s)},this.selectCoupons=function(o,s){var i={relationOrderSn:o,memberCouponId:s};return e({method:"POST",url:t.getUrl("SELECT_GOODS_COUPONS1"),params:i})}}]),APP.controller("UseCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","UseCouponsListService","PopupService","$ionicHistory","UserService",function(e,t,o,s,i,a,n,r,c){e.htmlContent=o.content,e.tabNav="selection",e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,e.couponId=o.couponId,e.sku=o.sku,e.isChecked=!0,e.couponButton=void 0,e.isNull,e.green=[!1],e.blue=[!1],e.pink=[!1],e.$on("$ionicView.beforeEnter",function(){e.noCanUseStyle={opacity:"0.4"},e.couponList="",e.init()}),e.selectCoupon=function(t,o,s){s?angular.forEach(e.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(e.couponList,function(e,t){e.isChecked=!1})},e.init=function(){e.isNull=!1,e.htmlContent=o.content,e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,1==e.type?a.selectGoodsCoupons(e.productId,e.number).success(function(t,o,s,i){e.couponList=t.data,0==e.couponList.length&&(e.isNull=!0);for(var a=0;a<e.couponList.length;a++)e.couponList[a].isChecked=e.couponId==e.couponList[a].memberCouponId,4!=e.couponList[a].useCondition||e.couponList[a].storeId?4==e.couponList[a].useCondition||e.couponList[a].storeId?e.couponList[a].storeId&&0!=e.couponList[a].storeId&&(e.pink[a]=!0):e.blue[a]=!0:e.green[a]=!0}):2==e.type&&a.selectPlatformCoupons().success(function(t,o,s,i){e.couponList=t.data,0==e.couponList.length&&(e.isNull=!0);for(var a=0;a<e.couponList.length;a++)e.couponList[a].isChecked=e.couponId==e.couponList[a].memberCouponId,4!=e.couponList[a].useCondition||e.couponList[a].storeId?4==e.couponList[a].useCondition||e.couponList[a].storeId||(e.blue[a]=!0):e.green[a]=!0})},e.confirm=function(){var t=!1,o=0;angular.forEach(e.couponList,function(e,s){e.isChecked&&(t=!0,o=e.memberCouponId)}),t?e.getCoupons(o,e.type):(o=null,e.getCoupons(o,e.type))},e.getCoupons=function(t,o){1==o&&a.selectCoupons(e.sku,t).success(function(e,t,o,s){1==e.success&&r.goBack()}).error(function(){alert("使用优惠券失败")}),2==o&&a.selectPTCoupons(t).success(function(e,t,o,s){1==e.success&&r.goBack()}).error(function(){alert("使用优惠券失败")})},e.toDetail=function(e,t){var o=c.getUser().mid;i.go("couponsDetailTwo",{cId:e,userID:o,type:0,isUser:!0,couponId:t})}}]),APP.service("UseCouponsListService",["$http","UrlService",function(e,t){this.selectGoodsCoupons=function(o,s){var i={product:o};return e({method:"POST",url:t.getUrl("SELECT_GOODS_COUPONS"),params:i})},this.selectPlatformCoupons=function(){return e({method:"POST",url:t.getUrl("SELECT_PLATFORM_COUPONS")})},this.selectCoupons=function(o,s){var i={p:o,c:s};return e({method:"POST",url:t.getUrl("SELECT_COUPONS"),params:i})},this.selectPTCoupons=function(o){var s={c:o};return e({method:"POST",url:t.getUrl("SELECT_COUPONS_PT"),params:s})}}]),APP.controller("CommonLocationController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CommonAddressService","GoodsService","$timeout","PopupService",function(e,t,o,s,i,a,n,r,c){e.addressTitle=o.title,e.data=o.data,e.flag=o.flag,e.defaultValue=o.defaultValue,e.level=o.level;var l={};e.init=function(){e.addressTitle=o.title,o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.level=o.level,o.data?e.data=JSON.parse(o.data):s.getLocationList(0,0).success(function(t){e.data=t.data}).error(function(e){c.showToast("获取地址信息失败！")})};var d=!1;e.goSelect=ionic.Utils.debounce(function(){var o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.level>-4)s.getLocationList(o.value,o.grade).success(function(t){e.data=t.data,i.go("commonLocation",{defaultValue:JSON.stringify(e.defaultValue),data:JSON.stringify(e.data),flag:e.flag,level:e.level})}).error(function(e){c.showToast("获取地址信息失败！")});else{if(d)return;r(function(){d=!1},1500),t.$broadcast(e.flag,e.defaultValue),d=!0,e.$ionicGoBack(e.level)}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){l=a.getAddressInfo();var o=l.regionName+"/"+l.streetName;n.addAddress(l.provinceId,l.cityId,l.areaId,o,l.streetId).success(function(){var o={"text-1":l.provinceName,"text-2":l.cityName,"text-3":l.regionName,"text-4":l.streetName,"value-1":l.provinceId,"value-2":l.cityId,"value-3":l.areaId,"value-4":l.streetId};t.$broadcast(e.flag,o),e.$ionicGoBack(e.level-1)})}},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonLocationService",["$http","UrlService","$timeout",function(e,t,o){this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)}}]),APP.controller("CommonPageViewController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init(),e.htmlContent=t.content})}]),APP.controller("invoiceHtmlController",["$scope","$stateParams","$sce",function(e,t,o){e.deviceHeight=window.innerHeight,e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc),e.init=function(){e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc)},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("CommonSelectController",["$http","CommonLocationService","$scope","$rootScope","$stateParams","$state","CacheService","PopupService",function(e,t,o,s,i,a,n,r){o.data=i.data,o.flag=i.flag,o.defaultValue=i.defaultValue,o.level=i.level,o.title=i.title,o.init=function(){o.addressMessage=n.get("addressInfo"),i.defaultValue?o.defaultValue=JSON.parse(i.defaultValue):o.defaultValue={},o.level=i.level,i.data?o.data=JSON.parse(i.data):e.get("data/region.json").success(function(e){o.data=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.goSelect=function(i,n){o.level=o.level-1,"全部"==n.text&&"全国"==n.text||(o.defaultValue["text"+o.level]=n.text,o.defaultValue["value"+o.level]=n.value),o.level>-2?e.get("data/region.json").success(function(e){-1==o.level?o.data=e.data[i].children:o.data=o.data[i].children,a.go("commonSelect",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")}):o.level>-4?(ah=-1*o.level,t.getLocationList(n.value,ah).success(function(e){o.data=e.data,a.go("commonLocation",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")})):(s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level))},o.doSelectAll=function(){o.level?o.level:o.defaultValue={"text-1":"","text-2":"","text-3":"","value-1":"","value-2":"","value-3":""},s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level-1)},o.doSelectDingWei=function(){o.defaultValue={"text-1":o.addressMessage.provinceName,"text-2":o.addressMessage.cityName,"text-3":o.addressMessage.regionName,"text-4":o.addressMessage.streetName,"value-1":o.addressMessage.provinceId,"value-2":o.addressMessage.cityId,"value-3":o.addressMessage.areaId,"value-4":o.addressMessage.streetId},s.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){o.init()})}]),APP.directive("titleType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="tType"/>',link:function(e,t,o){var s=o.titleType;e.tType="templates/common/TitleTemplate"+s+".html"}}}]),APP.directive("listType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="lType"/>',link:function(e,t,o){var s=o.listType;e.lType="templates/common/ListTemplate"+s+".html"}}}]),APP.controller("CommonUnionController",["$scope","$rootScope","$stateParams","CommonUnionService","$timeout","$ionicLoading",function(e,t,o,s,i,a){e.dataUnion=[],e.flag=o.flag,e.defaultValue=o.defaultValue,e.selectSigal=o.data,e.init=function(){o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.dataUnion=[],s.getUnionList().success(function(o){for(var s=void 0,i=0,a=o.data.length;i<a;i++)e.selectSigal==o.data[i].dictionary_display_value&&(s=i),e.dataUnion.push({key:o.data[i].dictionary_db_value,text:o.data[i].dictionary_display_value,imgSelect:t.imgBaseURL+"img/ic_select.png",imgUnselect:t.imgBaseURL+"img/ic_check.png",isSelect:!1});s&&(e.dataUnion[s].isSelect=!0)})},e.goSelect=function(o,s){e.defaultValue.text=o.text,e.defaultValue.value=o.key,angular.forEach(e.dataUnion,function(e){e.isSelect=!1}),e.dataUnion[s].isSelect=!0,t.$broadcast(e.flag,e.defaultValue),e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonUnionService",["$http","UrlService",function(e,t){this.getUnionList=function(){return e.get(t.getUrl("COMMON_UNION"))}}]),APP.service("GetStatisticInfoService",["LoginService","$rootScope","$http","UserService","$localstorage","UrlService",function(e,t,o,s,i,a){function n(e){function t(e){return e>9?e:"0"+e}if(e){var o=new Date;o.setTime(e);var s=o.getFullYear(),i=o.getMonth()+1,a=o.getDate(),n=o.getHours(),r=o.getMinutes(),c=o.getSeconds();return s+"-"+t(i)+"-"+t(a)+" "+t(n)+":"+t(r)+":"+t(c)}}function r(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}function c(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}this.GetUserInfo=function(o,l,d){function p(){t.globalConstant.positionStatus?(u=t.globalConstant.lon,g=t.globalConstant.lat):setTimeout(function(){p()},5e3)}var u,g,m,f=window.location.origin,h=f+"/#/"+o,v=f+"/#/"+l,$=document.getElementsByTagName("title")[0].innerHTML,S="",I=window.innerWidth+"*"+window.innerHeight,w=n((new Date).getTime()),y="",T=navigator.language,C=navigator.platform||"",b=s.getUser().mid||"",A=i.get("IsThirdLoginType")||"",P="",x="";m=e.getRole()>0?1:0;var L="",D=t.xnFromState.url.split("/:");if(D.length>0){for(var N=1;N<D.length;N++)L+="/"+t.xnFromParams[D[N]];v=f+"/www/index.html#/"+t.xnFromState.name+L}var _="",O=t.xnToState.url.split("/:");if(O.length>0){for(var N=1;N<O.length;N++)_+="/"+t.xnToParams[O[N]];h=f+"/www/index.html#/"+t.xnToState.name+_}p(),P=-1!=location.href.indexOf("?fs")?"fromShare":"",c("visitorId")?y=c("visitorId"):(y=this.generateUUID(),r("visitorId",y));var k="",E="";d.storeId&&(k=d.storeId),d.productId&&(E=d.productId);var U=navigator.userAgent,M=U.indexOf("Android")>-1||U.indexOf("Adr")>-1;S=!U.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?M?"android":"pc":"ios","micromessenger"==U.toLowerCase().match(/MicroMessenger/i)?x="wx":"weibo"==U.toLowerCase().match(/WeiBo/i)?x="wb":"qq"==U.toLowerCase().match(/QQ/i)&&(x="qq");var R=["sg_h5",S,w,y,b,A,k,E,"",v,h,$,I,"",T,C,"",P,x,m],B=R.join("|");B=B.replace(/,/g,"");var H=a.getCPUrl("BIG_DATA")+"?data="+encodeURIComponent(B);jQuery.getScript(H,function(e){})},this.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}}]),APP.directive("errSrc",[function(){return{link:function(e,t,o){t.bind("error",function(){o.$set("src",o.errSrc?o.errSrc:"http://cdn09.ehaier.com/shunguang/H5/www/img/errPlaceholder.png")})}}}]);var JSON;JSON||(JSON={}),function(){function str(e,t){var o,s,i,a,n,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,o=0;o<a;o+=1)n[o]=str(o,c)||"null";return i=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+r+"]":"["+n.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(a=rep.length,o=0;o<a;o+=1)"string"==typeof rep[o]&&(s=rep[o],(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i));else for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i);return i=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+r+"}":"{"+n.join(",")+"}",gap=r,i}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var s;if(gap="",indent="","number"==typeof o)for(s=0;s<o;s+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,s,i=e[t];if(i&&"object"==typeof i)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s=walk(i,o),void 0!==s?i[o]=s:delete i[o]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},s=function(){};s.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var s=this._listeners[e];-1===o.arrIndexOf(s,t)&&s.push(t)},s.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var s=this._listeners[e],i=o.arrIndexOf(s,t);return-1!==i?void(s.length>1?this._listeners[e]=s.slice(0,i).concat(s.slice(i+1)):delete this._listeners[e]):void 0}},s.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var s=0;s<this._listeners[t].length;s++)this._listeners[t][s].apply(this,o)};var i=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var a=function(e){var t=this;t._events=e||[],t._listeners={}};a.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var s=0;s<t._listeners[e].length;s++)t._listeners[e][s].apply(t,o)}},a.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},a.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},a.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var n="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||n.length;var o,s=[];for(o=0;o<e;o++)s.push(n.substr(Math.floor(Math.random()*t),1));return s.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};o.polluteGlobalNamespace=function(){"_jp"in t||(t._jp={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var s=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=s.protocol+t),0===t.indexOf("/")&&(t=s.protocol+"//"+s.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var s=o.arrIndexOf(e,t);return-1===s?e.slice():e.slice(0,s).concat(e.slice(s+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var r,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},d=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return l[e]})),'"'+e+'"'},u=function(e){var t,o={},s=[];for(t=0;t<65536;t++)s.push(String.fromCharCode(t));return e.lastIndex=0,s.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=p(e);return d.lastIndex=0,d.test(t)?(r||(r=u(d)),t.replace(d,function(e){return r[e]})):t};var g=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"]
;o.probeProtocols=function(){for(var e={},t=0;t<g.length;t++){var o=g[t];e[o]=w[o]&&w[o].enabled()}return e},o.detectProtocols=function(e,t,o){var s={},i=[];t||(t=g);for(var a=0;a<t.length;a++){var n=t[a];s[n]=e[n]}var r=function(e){var t=e.shift();s[t]?i.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),s["xhr-streaming"]&&!o.null_origin?i.push("xhr-streaming"):!s["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),s["xhr-polling"]&&!o.null_origin?i.push("xhr-polling"):!s["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var m="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(m in t)){var s={};t[m]=function(e){return e in s||(s[e]={id:e,del:function(){delete s[e]}}),s[e]}}return t[m](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,s){void 0!==t.addEventListener?t.addEventListener(o,s,!1):(e.attachEvent("on"+o,s),t.attachEvent("on"+o,s))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,s){void 0!==t.addEventListener?t.removeEventListener(o,s,!1):(e.detachEvent("on"+o,s),t.detachEvent("on"+o,s))};var f={},h=!1,v=function(){for(var e in f)f[e](),delete f[e]},$=function(){h||(h=!0,v())};o.attachEvent("unload",$),o.unload_add=function(e){var t=o.random_string(8);return f[t]=e,h&&o.delay(v),t},o.unload_del=function(e){e in f&&delete f[e]},o.createIframe=function(t,s){var i,a,n=e.createElement("iframe"),r=function(){clearTimeout(i);try{n.onload=null}catch(e){}n.onerror=null},c=function(){n&&(r(),setTimeout(function(){n&&n.parentNode.removeChild(n),n=null},0),o.unload_del(a))},l=function(e){n&&(c(),s(e))},d=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};return n.src=t,n.style.display="none",n.style.position="absolute",n.onerror=function(){l("onerror")},n.onload=function(){clearTimeout(i),i=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(n),i=setTimeout(function(){l("timeout")},15e3),a=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,s){var i,a,n,r=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},l=function(){r&&(c(),o.unload_del(a),n.parentNode.removeChild(n),n=r=null,CollectGarbage())},d=function(e){r&&(l(),s(e))},p=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};r.open(),r.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),r.close(),r.parentWindow._jp=t._jp;var u=r.createElement("div");return r.body.appendChild(u),n=r.createElement("iframe"),u.appendChild(n),n.src=e,i=setTimeout(function(){d("timeout")},15e3),a=o.unload_add(l),{post:p,cleanup:l,loaded:c}};var S=function(){};S.prototype=new a(["chunk","finish"]),S.prototype._start=function(e,s,i,a){var n=this;try{n.xhr=new XMLHttpRequest}catch(e){}if(!n.xhr)try{n.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(s+=(-1===s.indexOf("?")?"?":"&")+"t="+ +new Date),n.unload_ref=o.unload_add(function(){n._cleanup(!0)});try{n.xhr.open(e,s,!0)}catch(e){return n.emit("finish",0,""),void n._cleanup()}if(a&&a.no_credentials||(n.xhr.withCredentials="true"),a&&a.headers)for(var r in a.headers)n.xhr.setRequestHeader(r,a.headers[r]);n.xhr.onreadystatechange=function(){if(n.xhr){var e=n.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&n.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),n.emit("finish",t,e.responseText),n._cleanup(!1)}}},n.xhr.send(i)},S.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},S.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new S,(o.XHRLocalObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s,{no_credentials:!0})})}).prototype=new S;var I=o.XDRObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s)})};I.prototype=new a(["chunk","finish"]),I.prototype._start=function(e,t,s){var i=this,a=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var n=a.ontimeout=a.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};a.onprogress=function(){i.emit("chunk",200,a.responseText)},a.onload=function(){i.emit("finish",200,a.responseText),i._cleanup(!1)},i.xdr=a,i.unload_ref=o.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(s)}catch(e){n()}},I.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},I.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:k.enabled()?3:4};var w=function(e,s,i){if(this===t)return new w(e,s,i);var a,n=this;n._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&o.objectExtend(n._options,i),n._base_url=o.amendUrl(e),n._server=n._options.server||o.random_number_string(1e3),n._options.protocols_whitelist&&n._options.protocols_whitelist.length?a=n._options.protocols_whitelist:(a="string"==typeof s&&s.length>0?[s]:o.isArray(s)?s:null)&&n._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),n._protocols=[],n.protocol=null,n.readyState=w.CONNECTING,n._ir=F(n._base_url),n._ir.onfinish=function(e,t){n._ir=null,e?(n._options.info&&(e=o.objectExtend(e,n._options.info)),n._options.rtt&&(t=n._options.rtt),n._applyInfo(e,t,a),n._didClose()):n._didClose(1002,"Can't connect to server",!0)}};w.prototype=new s,w.version="0.3.4",w.CONNECTING=0,w.OPEN=1,w.CLOSING=2,w.CLOSED=3,w.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},w.prototype._dispatchOpen=function(){var e=this;e.readyState===w.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=w.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},w.prototype._dispatchMessage=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new i("message",{data:e}))},w.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},w.prototype._didClose=function(e,t,s){var a=this;if(a.readyState!==w.CONNECTING&&a.readyState!==w.OPEN&&a.readyState!==w.CLOSING)throw new Error("INVALID_STATE_ERR");a._ir&&(a._ir.nuke(),a._ir=null),a._transport&&(a._transport.doCleanup(),a._transport=null);var n=new i("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&a.readyState===w.CONNECTING&&!s){if(a._try_next_protocol(n))return;n=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:n})}a.readyState=w.CLOSED,o.delay(function(){a.dispatchEvent(n)})},w.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),s=0;s<o.length;s++)t._dispatchMessage(o[s]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},w.prototype._try_next_protocol=function(t){var s=this;for(s.protocol&&(s._debug("Closed transport:",s.protocol,""+t),s.protocol=null),s._transport_tref&&(clearTimeout(s._transport_tref),s._transport_tref=null);;){var i=s.protocol=s._protocols.shift();if(!i)return!1;if(w[i]&&!0===w[i].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return s._protocols.unshift(i),s.protocol="waiting-for-load",o.attachEvent("load",function(){s._try_next_protocol()}),!0;if(w[i]&&w[i].enabled(s._options)){var a=w[i].roundTrips||1,n=(s._options.rto||0)*a||5e3;s._transport_tref=o.delay(n,function(){s.readyState===w.CONNECTING&&s._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=s._base_url+"/"+s._server+"/"+r;return s._debug("Opening transport:",i," url:"+c," RTO:"+s._options.rto),s._transport=new w[i](s,c,s._base_url),!0}s._debug("Skipping transport:",i)}},w.prototype.close=function(e,t){var s=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(s.readyState===w.CONNECTING||s.readyState===w.OPEN)&&(s.readyState=w.CLOSING,s._didClose(e||1e3,t||"Normal closure"),!0)},w.prototype.send=function(e){var t=this;if(t.readyState===w.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===w.OPEN&&t._transport.doSend(o.quote(""+e)),!0},w.prototype._applyInfo=function(t,s,i){var a=this;a._options.info=t,a._options.rtt=s,a._options.rto=o.countRTO(s),a._options.info.null_origin=!e.domain;var n=o.probeProtocols();a._protocols=o.detectProtocols(n,i,t)};var y=w.websocket=function(e,s){var i=this,a=s+"/websocket";a="https"===a.slice(0,5)?"wss"+a.slice(5):"ws"+a.slice(4),i.ri=e,i.url=a;var n=t.WebSocket||t.MozWebSocket;i.ws=new n(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=o.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};y.prototype.doSend=function(e){this.ws.send("["+e+"]")},y.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},y.enabled=function(){return!(!t.WebSocket&&!t.MozWebSocket)},y.roundTrips=2;var T=function(){};T.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},T.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},T.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},T.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},T.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var C=function(t,s,i){var a=this;if(!("_send_form"in a)){var n=a._send_form=e.createElement("form"),r=a._send_area=e.createElement("textarea");r.name="d",n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",n.appendChild(r),e.body.appendChild(n)}var n=a._send_form,r=a._send_area,c="a"+o.random_string(8);n.target=c,n.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,n.appendChild(l),l.style.display="none";try{r.value=s}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}n.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",i(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},b=function(e){return function(t,o,s){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){s(200===e||204===e,"http status "+e)},function(e){s(!1,e)}}},A=function(t,s){var i,a,n=e.createElement("script"),r=function(e){a&&(a.parentNode.removeChild(a),a=null),n&&(clearTimeout(i),n.parentNode.removeChild(n),n.onreadystatechange=n.onerror=n.onload=n.onclick=null,n=null,s(e),s=null)},c=!1,l=null;if(n.id="a"+o.random_string(8),n.src=t,n.type="text/javascript",n.charset="UTF-8",n.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},n.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(e){if(/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){c=!0;try{n.onclick()}catch(e){}}n&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===n.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))a=e.createElement("script"),a.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=a.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch(e){}n.async=!0}void 0!==n.async&&(n.async=!0),i=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(n,d.firstChild),a&&d.insertBefore(a,d.firstChild),r},P=w["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var s=this;s.ri=e,s.trans_url=t,s.send_constructor(C),s._schedule_recv()};P.prototype=new T,P.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=x(e.trans_url+"/jsonp",A,t)},P.enabled=function(){return!0},P.need_body=!0,P.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var x=function(e,s,i){var a="a"+o.random_string(6),n=e+"?c="+escape("_jp."+a),r=0,c=function(e){switch(r){case 0:delete t._jp[a],i(e);break;case 1:i(e),r=2;break;case 2:delete t._jp[a]}},l=s(n,c);return t._jp[a]=l,function(){t._jp[a]&&(r=1,t._jp[a](o.closeFrame(1e3,"JSONP user aborted read")))}},L=function(){};L.prototype=new T,L.prototype.run=function(e,t,o,s,i){var a=this;a.ri=e,a.trans_url=t,a.send_constructor(b(i)),a.poll=new z(e,s,t+o,i)},L.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var D=w["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",K,o.XHRCorsObject)};D.prototype=new L,D.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},D.roundTrips=2,D.need_body=!0;var N=w["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",K,o.XDRObject)};N.prototype=new L,N.enabled=function(){return!!t.XDomainRequest},N.roundTrips=2;var _=w["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XHRCorsObject)};_.prototype=new L,_.enabled=D.enabled,_.roundTrips=2;var O=w["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XDRObject)};O.prototype=new L,O.enabled=N.enabled,O.roundTrips=2;var k=function(){};k.prototype.i_constructor=function(e,t,s){var i=this;i.ri=e,i.origin=o.getOrigin(s),i.base_url=s,i.trans_url=t;var a=s+"/iframe.html";i.ri._options.devel&&(a+="?t="+ +new Date),i.window_id=o.random_string(8),a+="#"+i.window_id,i.iframeObj=o.createIframe(a,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=o.bind(i.onmessage,i),o.attachMessage(i.onmessage_cb)},k.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},k.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),s=e.data.slice(8,9),i=e.data.slice(9);if(o===t.window_id)switch(s){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([w.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},k.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},k.prototype.doSend=function(e){this.postMessage("m",e)},k.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var E,U=function(e,s){parent!==t?parent.postMessage(E+e+(s||""),"*"):o.log("Can't postMessage, no parent window.",e,s)},M=function(){};M.prototype._didClose=function(e,t){U("t",o.closeFrame(e,t))},M.prototype._didMessage=function(e){U("t",e)},M.prototype._doSend=function(e){this._transport.doSend(e)},M.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,w.bootstrap_iframe=function(){var s;E=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var i=e.data.slice(0,8),a=e.data.slice(8,9),n=e.data.slice(9);if(i===E)switch(a){case"s":var r=JSON.parse(n),c=r[0],l=r[1],d=r[2],p=r[3];if(c!==w.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+w.version+'".'),!o.flatUrl(d)||!o.flatUrl(p))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(p))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,p])+")");s=new M,s._transport=new M[l](s,d,p);break;case"m":s._doSend(n);break;case"c":s&&s._doCleanup(),s=null}}};o.attachMessage(i),U("s")};var R=function(e,t){var s=this;o.delay(function(){s.doXhr(e,t)})};R.prototype=new a(["finish"]),R.prototype.doXhr=function(e,t){var s=this,i=(new Date).getTime(),a=new t("GET",e+"/info"),n=o.delay(8e3,function(){a.ontimeout()});a.onfinish=function(e,t){if(clearTimeout(n),n=null,200===e){var o=(new Date).getTime()-i,a=JSON.parse(t);"object"!=typeof a&&(a={}),s.emit("finish",a,o)}else s.emit("finish")},a.ontimeout=function(){a.close(),s.emit("finish")}};var B=function(t){var s=this,i=function(){var e=new k;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),i=o[0],a=o[1];s.emit("finish",i,a)}else s.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:o,_didMessage:o};e.i_constructor(i,t,t)};e.body?i():o.attachEvent("load",i)};B.prototype=new a(["finish"]);var H=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};H.prototype=new a(["finish"]);var F=function(e){if(o.isSameOriginUrl(e))return new R(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new R(e,o.XHRLocalObject);case 2:return new R(e,o.XDRObject);case 3:return new B(e);default:return new H}};(M["w-iframe-info-receiver"]=function(e,t,s){new R(s,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var G=w["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};G.prototype=new k,G.enabled=function(){return"EventSource"in t&&k.enabled()},G.need_body=!0,G.roundTrips=3,(M["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",W,o.XHRLocalObject)}).prototype=new L;var V=w["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};V.prototype=new k,V.enabled=function(){return t.XMLHttpRequest&&k.enabled()},V.need_body=!0,V.roundTrips=3,(M["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",K,o.XHRLocalObject)}).prototype=new L;var j=w["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};j.prototype=new k,j.enabled=function(){return k.enabled()},j.need_body=!0,j.roundTrips=3,(M["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",Y,o.XHRLocalObject)}).prototype=new L;var z=function(e,t,o,s){var i=this;i.ri=e,i.Receiver=t,i.recv_url=o,i.AjaxObject=s,i._scheduleRecv()};z.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},z.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var W=function(e){var t=this,s=new EventSource(e);s.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=s.onerror=function(e,a){var n=a?"user":2!==s.readyState?"network":"permanent";t.es_close=s.onmessage=s.onerror=null,s.close(),s=null,o.delay(200,function(){t.dispatchEvent(new i("close",{reason:n}))})}};W.prototype=new s,W.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var q,J=function(){if(void 0===q)if("ActiveXObject"in t)try{q=!!new ActiveXObject("htmlfile")}catch(e){}else q=!1;return q},Y=function(e){var s=this;o.polluteGlobalNamespace(),s.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+s.id);var a,n=J()?o.createHtmlfile:o.createIframe;t._jp[s.id]={start:function(){a.loaded()},message:function(e){s.dispatchEvent(new i("message",{data:e}))},stop:function(){s.iframe_close({},"network")}},s.iframe_close=function(e,o){a.cleanup(),s.iframe_close=a=null,delete t._jp[s.id],s.dispatchEvent(new i("close",{reason:o}))},a=n(e,function(e){s.iframe_close({},"permanent")})};Y.prototype=new s,Y.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var K=function(e,t){var o=this,s=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var a=t.slice(s),n=a.indexOf("\n");if(-1===n)break;s+=n+1;var r=a.slice(0,n);o.dispatchEvent(new i("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var s=200===e?"network":"permanent";o.dispatchEvent(new i("close",{reason:s}))}};return K.prototype=new s,K.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},w.getUtils=function(){return o},w.getIframeTransport=function(){return k},w}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});var JSON;JSON||(JSON={}),function(){function str(e,t){var o,s,i,a,n,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,o=0;o<a;o+=1)n[o]=str(o,c)||"null";return i=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+r+"]":"["+n.join(",")+"]",gap=r,i}if(rep&&"object"==typeof rep)for(a=rep.length,o=0;o<a;o+=1)"string"==typeof rep[o]&&(s=rep[o],(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i));else for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(i=str(s,c))&&n.push(quote(s)+(gap?": ":":")+i);return i=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+r+"}":"{"+n.join(",")+"}",gap=r,i}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var s;if(gap="",indent="","number"==typeof o)for(s=0;s<o;s+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,s,i=e[t];if(i&&"object"==typeof i)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s=walk(i,o),void 0!==s?i[o]=s:delete i[o]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},s=function(){};s.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var s=this._listeners[e];-1===o.arrIndexOf(s,t)&&s.push(t)},s.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var s=this._listeners[e],i=o.arrIndexOf(s,t);return-1!==i?void(s.length>1?this._listeners[e]=s.slice(0,i).concat(s.slice(i+1)):delete this._listeners[e]):void 0}},s.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var s=0;s<this._listeners[t].length;s++)this._listeners[t][s].apply(this,o)};var i=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var a=function(e){var t=this;t._events=e||[],t._listeners={}};a.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var s=0;s<t._listeners[e].length;s++)t._listeners[e][s].apply(t,o)}},a.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},a.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},a.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var n="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||n.length;var o,s=[];for(o=0;o<e;o++)s.push(n.substr(Math.floor(Math.random()*t),1));return s.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};var r="_jp";o.polluteGlobalNamespace=function(){r in t||(t[r]={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var s=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=s.protocol+t),0===t.indexOf("/")&&(t=s.protocol+"//"+s.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var s=o.arrIndexOf(e,t);return-1===s?e.slice():e.slice(0,s).concat(e.slice(s+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var c,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},p=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,u=JSON&&JSON.stringify||function(e){return l.lastIndex=0,l.test(e)&&(e=e.replace(l,function(e){return d[e]})),'"'+e+'"'},g=function(e){var t,o={},s=[];for(t=0;t<65536;t++)s.push(String.fromCharCode(t));return e.lastIndex=0,s.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=u(e);return p.lastIndex=0,p.test(t)?(c||(c=g(p)),t.replace(p,function(e){return c[e]})):t};var m=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];o.probeProtocols=function(){for(var e={},t=0;t<m.length;t++){var o=m[t];e[o]=y[o]&&y[o].enabled()}return e},o.detectProtocols=function(e,t,o){var s={},i=[];t||(t=m)
;for(var a=0;a<t.length;a++){var n=t[a];s[n]=e[n]}var r=function(e){var t=e.shift();s[t]?i.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),s["xhr-streaming"]&&!o.null_origin?i.push("xhr-streaming"):!s["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),s["xhr-polling"]&&!o.null_origin?i.push("xhr-polling"):!s["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var f="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(f in t)){var s={};t[f]=function(e){return e in s||(s[e]={id:e,del:function(){delete s[e]}}),s[e]}}return t[f](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,s){void 0!==t.addEventListener?t.addEventListener(o,s,!1):(e.attachEvent("on"+o,s),t.attachEvent("on"+o,s))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,s){void 0!==t.addEventListener?t.removeEventListener(o,s,!1):(e.detachEvent("on"+o,s),t.detachEvent("on"+o,s))};var h={},v=!1,$=function(){for(var e in h)h[e](),delete h[e]},S=function(){v||(v=!0,$())};o.attachEvent("unload",S),o.unload_add=function(e){var t=o.random_string(8);return h[t]=e,v&&o.delay($),t},o.unload_del=function(e){e in h&&delete h[e]},o.createIframe=function(t,s){var i,a,n=e.createElement("iframe"),r=function(){clearTimeout(i);try{n.onload=null}catch(e){}n.onerror=null},c=function(){n&&(r(),setTimeout(function(){n&&n.parentNode.removeChild(n),n=null},0),o.unload_del(a))},l=function(e){n&&(c(),s(e))},d=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};return n.src=t,n.style.display="none",n.style.position="absolute",n.onerror=function(){l("onerror")},n.onload=function(){clearTimeout(i),i=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(n),i=setTimeout(function(){l("timeout")},15e3),a=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,s){var i,a,n,c=new ActiveXObject("htmlfile"),l=function(){clearTimeout(i)},d=function(){c&&(l(),o.unload_del(a),n.parentNode.removeChild(n),n=c=null,CollectGarbage())},p=function(e){c&&(d(),s(e))},u=function(e,t){try{n&&n.contentWindow&&n.contentWindow.postMessage(e,t)}catch(e){}};c.open(),c.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),c.close(),c.parentWindow[r]=t[r];var g=c.createElement("div");return c.body.appendChild(g),n=c.createElement("iframe"),g.appendChild(n),n.src=e,i=setTimeout(function(){p("timeout")},15e3),a=o.unload_add(d),{post:u,cleanup:d,loaded:l}};var I=function(){};I.prototype=new a(["chunk","finish"]),I.prototype._start=function(e,s,i,a){var n=this;try{n.xhr=new XMLHttpRequest}catch(e){}if(!n.xhr)try{n.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(s+=(-1===s.indexOf("?")?"?":"&")+"t="+ +new Date),n.unload_ref=o.unload_add(function(){n._cleanup(!0)});try{n.xhr.open(e,s,!0)}catch(e){return n.emit("finish",0,""),void n._cleanup()}if(a&&a.no_credentials||(n.xhr.withCredentials="true"),a&&a.headers)for(var r in a.headers)n.xhr.setRequestHeader(r,a.headers[r]);n.xhr.onreadystatechange=function(){if(n.xhr){var e=n.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&n.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),n.emit("finish",t,e.responseText),n._cleanup(!1)}}},n.xhr.send(i)},I.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},I.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new I,(o.XHRLocalObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s,{no_credentials:!0})})}).prototype=new I;var w=o.XDRObject=function(e,t,s){var i=this;o.delay(function(){i._start(e,t,s)})};w.prototype=new a(["chunk","finish"]),w.prototype._start=function(e,t,s){var i=this,a=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var n=a.ontimeout=a.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};a.onprogress=function(){i.emit("chunk",200,a.responseText)},a.onload=function(){i.emit("finish",200,a.responseText),i._cleanup(!1)},i.xdr=a,i.unload_ref=o.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(s)}catch(e){n()}},w.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},w.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:E.enabled()?3:4};var y=function(e,s,i){if(this===t)return new y(e,s,i);var a,n=this;n._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&o.objectExtend(n._options,i),n._base_url=o.amendUrl(e),n._server=n._options.server||o.random_number_string(1e3),n._options.protocols_whitelist&&n._options.protocols_whitelist.length?a=n._options.protocols_whitelist:(a="string"==typeof s&&s.length>0?[s]:o.isArray(s)?s:null)&&n._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),n._protocols=[],n.protocol=null,n.readyState=y.CONNECTING,n._ir=G(n._base_url),n._ir.onfinish=function(e,t){n._ir=null,e?(n._options.info&&(e=o.objectExtend(e,n._options.info)),n._options.rtt&&(t=n._options.rtt),n._applyInfo(e,t,a),n._didClose()):n._didClose(1002,"Can't connect to server",!0)}};y.prototype=new s,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},y.prototype._dispatchOpen=function(){var e=this;e.readyState===y.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=y.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new i("message",{data:e}))},y.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},y.prototype._didClose=function(e,t,s){var a=this;if(a.readyState!==y.CONNECTING&&a.readyState!==y.OPEN&&a.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");a._ir&&(a._ir.nuke(),a._ir=null),a._transport&&(a._transport.doCleanup(),a._transport=null);var n=new i("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&a.readyState===y.CONNECTING&&!s){if(a._try_next_protocol(n))return;n=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:n})}a.readyState=y.CLOSED,o.delay(function(){a.dispatchEvent(n)})},y.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),s=0;s<o.length;s++)t._dispatchMessage(o[s]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(t){var s=this;for(s.protocol&&(s._debug("Closed transport:",s.protocol,""+t),s.protocol=null),s._transport_tref&&(clearTimeout(s._transport_tref),s._transport_tref=null);;){var i=s.protocol=s._protocols.shift();if(!i)return!1;if(y[i]&&!0===y[i].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return s._protocols.unshift(i),s.protocol="waiting-for-load",o.attachEvent("load",function(){s._try_next_protocol()}),!0;if(y[i]&&y[i].enabled(s._options)){var a=y[i].roundTrips||1,n=(s._options.rto||0)*a||5e3;s._transport_tref=o.delay(n,function(){s.readyState===y.CONNECTING&&s._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=s._base_url+"/"+s._server+"/"+r;return s._debug("Opening transport:",i," url:"+c," RTO:"+s._options.rto),s._transport=new y[i](s,c,s._base_url),!0}s._debug("Skipping transport:",i)}},y.prototype.close=function(e,t){var s=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(s.readyState===y.CONNECTING||s.readyState===y.OPEN)&&(s.readyState=y.CLOSING,s._didClose(e||1e3,t||"Normal closure"),!0)},y.prototype.send=function(e){var t=this;if(t.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===y.OPEN&&t._transport.doSend(o.quote(""+e)),!0},y.prototype._applyInfo=function(t,s,i){var a=this;a._options.info=t,a._options.rtt=s,a._options.rto=o.countRTO(s),a._options.info.null_origin=!e.domain;var n=o.probeProtocols();a._protocols=o.detectProtocols(n,i,t)};var T=y.websocket=function(e,s){var i=this,a=s+"/websocket";a="https"===a.slice(0,5)?"wss"+a.slice(5):"ws"+a.slice(4),i.ri=e,i.url=a;var n=t.WebSocket||t.MozWebSocket;i.ws=new n(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=o.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};T.prototype.doSend=function(e){this.ws.send("["+e+"]")},T.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},T.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},T.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},C.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},C.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var b=function(t,s,i){var a=this;if(!("_send_form"in a)){var n=a._send_form=e.createElement("form"),r=a._send_area=e.createElement("textarea");r.name="d",n.style.display="none",n.style.position="absolute",n.method="POST",n.enctype="application/x-www-form-urlencoded",n.acceptCharset="UTF-8",n.appendChild(r),e.body.appendChild(n)}var n=a._send_form,r=a._send_area,c="a"+o.random_string(8);n.target=c,n.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,n.appendChild(l),l.style.display="none";try{r.value=s}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}n.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",i(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},A=function(e){return function(t,o,s){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){s(200===e||204===e,"http status "+e)},function(e){s(!1,e)}}},P=function(t,s){var i,a,n=e.createElement("script"),r=function(e){a&&(a.parentNode.removeChild(a),a=null),n&&(clearTimeout(i),n.parentNode.removeChild(n),n.onreadystatechange=n.onerror=n.onload=n.onclick=null,n=null,s(e),s=null)},c=!1,l=null;if(n.id="a"+o.random_string(8),n.src=t,n.type="text/javascript",n.charset="UTF-8",n.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},n.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(e){if(/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){c=!0;try{n.onclick()}catch(e){}}n&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===n.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))a=e.createElement("script"),a.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=a.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch(e){}n.async=!0}void 0!==n.async&&(n.async=!0),i=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(n,d.firstChild),a&&d.insertBefore(a,d.firstChild),r},x=y["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var s=this;s.ri=e,s.trans_url=t,s.send_constructor(b),s._schedule_recv()};x.prototype=new C,x.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",P,t)},x.enabled=function(){return!0},x.need_body=!0,x.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(e,s,i){var a="a"+o.random_string(6),n=e+"?c="+escape(r+"."+a),c=0,l=function(e){switch(c){case 0:delete t[r][a],i(e);break;case 1:i(e),c=2;break;case 2:delete t[r][a]}},d=s(n,l);return t[r][a]=d,function(){t[r][a]&&(c=1,t[r][a](o.closeFrame(1e3,"JSONP user aborted read")))}},D=function(){};D.prototype=new C,D.prototype.run=function(e,t,o,s,i){var a=this;a.ri=e,a.trans_url=t,a.send_constructor(A(i)),a.poll=new W(e,s,t+o,i)},D.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var N=y["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XHRCorsObject)};N.prototype=new D,N.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},N.roundTrips=2,N.need_body=!0;var _=y["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XDRObject)};_.prototype=new D,_.enabled=function(){return!!t.XDomainRequest},_.roundTrips=2;var O=y["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRCorsObject)};O.prototype=new D,O.enabled=N.enabled,O.roundTrips=2;var k=y["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XDRObject)};k.prototype=new D,k.enabled=_.enabled,k.roundTrips=2;var E=function(){};E.prototype.i_constructor=function(e,t,s){var i=this;i.ri=e,i.origin=o.getOrigin(s),i.base_url=s,i.trans_url=t;var a=s+"/iframe.html";i.ri._options.devel&&(a+="?t="+ +new Date),i.window_id=o.random_string(8),a+="#"+i.window_id,i.iframeObj=o.createIframe(a,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=o.bind(i.onmessage,i),o.attachMessage(i.onmessage_cb)},E.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},E.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),s=e.data.slice(8,9),i=e.data.slice(9);if(o===t.window_id)switch(s){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([y.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},E.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},E.prototype.doSend=function(e){this.postMessage("m",e)},E.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var U,M=function(e,s){parent!==t?parent.postMessage(U+e+(s||""),"*"):o.log("Can't postMessage, no parent window.",e,s)},R=function(){};R.prototype._didClose=function(e,t){M("t",o.closeFrame(e,t))},R.prototype._didMessage=function(e){M("t",e)},R.prototype._doSend=function(e){this._transport.doSend(e)},R.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,y.bootstrap_iframe=function(){var s;U=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var i=e.data.slice(0,8),a=e.data.slice(8,9),n=e.data.slice(9);if(i===U)switch(a){case"s":var r=JSON.parse(n),c=r[0],l=r[1],d=r[2],p=r[3];if(c!==y.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+y.version+'".'),!o.flatUrl(d)||!o.flatUrl(p))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(p))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,p])+")");s=new R,s._transport=new R[l](s,d,p);break;case"m":s._doSend(n);break;case"c":s&&s._doCleanup(),s=null}}};o.attachMessage(i),M("s")};var B=function(e,t){var s=this;o.delay(function(){s.doXhr(e,t)})};B.prototype=new a(["finish"]),B.prototype.doXhr=function(e,t){var s=this,i=(new Date).getTime(),a=new t("GET",e+"/info"),n=o.delay(8e3,function(){a.ontimeout()});a.onfinish=function(e,t){if(clearTimeout(n),n=null,200===e){var o=(new Date).getTime()-i,a=JSON.parse(t);"object"!=typeof a&&(a={}),s.emit("finish",a,o)}else s.emit("finish")},a.ontimeout=function(){a.close(),s.emit("finish")}};var H=function(t){var s=this,i=function(){var e=new E;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),i=o[0],a=o[1];s.emit("finish",i,a)}else s.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:o,_didMessage:o};e.i_constructor(i,t,t)};e.body?i():o.attachEvent("load",i)};H.prototype=new a(["finish"]);var F=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new a(["finish"]);var G=function(e){if(o.isSameOriginUrl(e))return new B(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new B(e,o.XHRLocalObject);case 2:return new B(e,o.XDRObject);case 3:return new H(e);default:return new F}};(R["w-iframe-info-receiver"]=function(e,t,s){new B(s,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var V=y["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};V.prototype=new E,V.enabled=function(){return"EventSource"in t&&E.enabled()},V.need_body=!0,V.roundTrips=3,(R["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",q,o.XHRLocalObject)}).prototype=new D;var j=y["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};j.prototype=new E,j.enabled=function(){return t.XMLHttpRequest&&E.enabled()},j.need_body=!0,j.roundTrips=3,(R["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRLocalObject)}).prototype=new D;var z=y["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};z.prototype=new E,z.enabled=function(){return E.enabled()},z.need_body=!0,z.roundTrips=3,(R["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",K,o.XHRLocalObject)}).prototype=new D;var W=function(e,t,o,s){var i=this;i.ri=e,i.Receiver=t,i.recv_url=o,i.AjaxObject=s,i._scheduleRecv()};W.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},W.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var q=function(e){var t=this,s=new EventSource(e);s.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=s.onerror=function(e,a){var n=a?"user":2!==s.readyState?"network":"permanent";t.es_close=s.onmessage=s.onerror=null,s.close(),s=null,o.delay(200,function(){t.dispatchEvent(new i("close",{reason:n}))})}};q.prototype=new s,q.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var J,Y=function(){if(void 0===J)if("ActiveXObject"in t)try{J=!!new ActiveXObject("htmlfile")}catch(e){}else J=!1;return J},K=function(e){var s=this;o.polluteGlobalNamespace(),s.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(r+"."+s.id);var a,n=Y()?o.createHtmlfile:o.createIframe;t[r][s.id]={start:function(){a.loaded()},message:function(e){s.dispatchEvent(new i("message",{data:e}))},stop:function(){s.iframe_close({},"network")}},s.iframe_close=function(e,o){a.cleanup(),s.iframe_close=a=null,delete t[r][s.id],s.dispatchEvent(new i("close",{reason:o}))},a=n(e,function(e){s.iframe_close({},"permanent")})};K.prototype=new s,K.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var Q=function(e,t){var o=this,s=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var a=t.slice(s),n=a.indexOf("\n");if(-1===n)break;s+=n+1;var r=a.slice(0,n);o.dispatchEvent(new i("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var s=200===e?"network":"permanent";o.dispatchEvent(new i("close",{reason:s}))}};return Q.prototype=new s,Q.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},y.getUtils=function(){return o},y.getIframeTransport=function(){return E},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS})(function(){var e,t,o,s,i={}.hasOwnProperty,a=[].slice;e={LF:"\n",NULL:"\0"},o=function(){function t(e,t,o){this.command=e,this.headers=null!=t?t:{},this.body=null!=o?o:""}var o;return t.prototype.toString=function(){var o,s,a,n,r;o=[this.command],a=!1===this.headers["content-length"],a&&delete this.headers["content-length"],r=this.headers;for(s in r)i.call(r,s)&&(n=r[s],o.push(s+":"+n));return this.body&&!a&&o.push("content-length:"+t.sizeOfUTF8(this.body)),o.push(e.LF+this.body),o.join(e.LF)},t.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},o=function(o){var s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S;for(n=o.search(RegExp(""+e.LF+e.LF)),r=o.substring(0,n).split(e.LF),a=r.shift(),c={},m=function(e){return e.replace(/^\s+|\s+$/g,"")},$=r.reverse(),f=0,v=$.length;f<v;f++)u=$[f],d=u.indexOf(":"),c[m(u.substring(0,d))]=m(u.substring(d+1));if(s="",g=n+2,c["content-length"])p=parseInt(c["content-length"]),s=(""+o).substring(g,g+p);else for(i=null,l=h=g,S=o.length;(g<=S?h<S:h>S)&&(i=o.charAt(l))!==e.NULL;l=g<=S?++h:--h)s+=i;return new t(a,c,s)},t.unmarshall=function(t){var s,i,a,n;return i=t.split(RegExp(""+e.NULL+e.LF+"*")),n={frames:[],partial:""},n.frames=function(){var e,t,a,n;for(a=i.slice(0,-1),n=[],e=0,t=a.length;e<t;e++)s=a[e],n.push(o(s));return n}(),a=i.slice(-1)[0],a===e.LF||-1!==a.search(RegExp(""+e.NULL+e.LF+"*$"))?n.frames.push(o(a)):n.partial=a,n},t.marshall=function(o,s,i){var a;return a=new t(o,s,i),a.toString()+e.NULL},t}(),t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var i;return t.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},i=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(e,t,s){var i;for(i=o.marshall(e,t,s),"function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}},t.prototype._setupHeartbeat=function(t){var o,a,n,r,c,l;if((c=t.version)===s.VERSIONS.V1_1||c===s.VERSIONS.V1_2)return l=function(){var e,o,s,i;for(s=t["heart-beat"].split(","),i=[],e=0,o=s.length;e<o;e++)r=s[e],i.push(parseInt(r));return i}(),a=l[0],o=l[1],0!==this.heartbeat.outgoing&&0!==o&&(n=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+n+"ms"),this.pinger=s.setInterval(n,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==a?(n=Math.max(this.heartbeat.incoming,a),"function"==typeof this.debug&&this.debug("check PONG every "+n+"ms"),this.ponger=s.setInterval(n,function(e){return function(){var t;if((t=i()-e.serverActivity)>2*n)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+t+"ms"),e.ws.close()}}(this))):void 0},t.prototype._parseConnect=function(){var e,t,o,s;switch(e=1<=arguments.length?a.call(arguments,0):[],s={},e.length){case 2:s=e[0],t=e[1];break;case 3:e[1]instanceof Function?(s=e[0],t=e[1],o=e[2]):(s.login=e[0],s.passcode=e[1],t=e[2]);break;case 4:s.login=e[0],s.passcode=e[1],t=e[2],o=e[3];break;default:s.login=e[0],s.passcode=e[1],t=e[2],o=e[3],s.host=e[4]}return[s,t,o]},t.prototype.connect=function(){var t,n,r,c;return t=1<=arguments.length?a.call(arguments,0):[],c=this._parseConnect.apply(this,t),r=c[0],this.connectCallback=c[1],n=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(s){var a,r,c,l,d,p,u,g,m,f,h,v,$;if(l="undefined"!=typeof ArrayBuffer&&s.data instanceof ArrayBuffer?(a=new Uint8Array(s.data),"function"==typeof t.debug&&t.debug("--- got data length: "+a.length),function(){var e,t,o;for(o=[],e=0,t=a.length;e<t;e++)r=a[e],o.push(String.fromCharCode(r));return o}().join("")):s.data,t.serverActivity=i(),l===e.LF)return void("function"==typeof t.debug&&t.debug("<<< PONG"));for("function"==typeof t.debug&&t.debug("<<< "+l),m=o.unmarshall(t.partialData+l),t.partialData=m.partial,v=m.frames,$=[],f=0,h=v.length;f<h;f++)switch(d=v[f],d.command){case"CONNECTED":"function"==typeof t.debug&&t.debug("connected to server "+d.headers.server),t.connected=!0,t._setupHeartbeat(d.headers),$.push("function"==typeof t.connectCallback?t.connectCallback(d):void 0);break;case"MESSAGE":g=d.headers.subscription,u=t.subscriptions[g]||t.onreceive,u?(c=t,p=d.headers["message-id"],d.ack=function(e){return null==e&&(e={}),c.ack(p,g,e)},d.nack=function(e){return null==e&&(e={}),c.nack(p,g,e)},$.push(u(d))):$.push("function"==typeof t.debug?t.debug("Unhandled received MESSAGE: "+d):void 0);break;case"RECEIPT":$.push("function"==typeof t.onreceipt?t.onreceipt(d):void 0);break;case"ERROR":$.push("function"==typeof n?n(d):void 0);break;default:$.push("function"==typeof t.debug?t.debug("Unhandled frame: "+d):void 0)}return $}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof n?n(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),r["accept-version"]=s.VERSIONS.supportedVersions(),r["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",r)}}(this)},t.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&s.clearInterval(this.pinger),this.ponger)return s.clearInterval(this.ponger)},t.prototype.send=function(e,t,o){return null==t&&(t={}),null==o&&(o=""),t.destination=e,this._transmit("SEND",t,o)},t.prototype.subscribe=function(e,t,o){var s;return null==o&&(o={}),o.id||(o.id="sub-"+this.counter++),o.destination=e,this.subscriptions[o.id]=t,this._transmit("SUBSCRIBE",o),s=this,{id:o.id,unsubscribe:function(){return s.unsubscribe(o.id)}}},t.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},t.prototype.begin=function(e){var t,o;return o=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:o}),t=this,{id:o,commit:function(){return t.commit(o)},abort:function(){return t.abort(o)}}},t.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},t.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},t.prototype.ack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("ACK",o)},t.prototype.nack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("NACK",o)},t}(),s={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,o){var i,a;return null==o&&(o=["v10.stomp","v11.stomp"]),i=s.WebSocketClass||WebSocket,a=new i(e,o),new t(a)},over:function(e){return new t(e)},Frame:o},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=s),"undefined"!=typeof window&&null!==window?(s.setInterval=function(e,t){return window.setInterval(t,e)},s.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=s):exports||(self.Stomp=s)}).call(this),APP.controller("MyRaiseController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseHaveController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseNoController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("OrderDetailsController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher",function(e,t,o,s,i,a,n,r,c,l,d,p){o.orderSnDetail=a.orderSn,o.cOrderSnDetail=a.cOrderSn,o.orderDetailList=[];var u=r.getUser();o.loginMemberId=u.mid,o.uname=u.userName,o.userlevel=0,o.shareStoreId="";var g=a.cOrderId;o.loadData=function(e,t,s){i.getOrderDetail(e,t,s).success(function(e){e.success&&(o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.shareStoreId=e.data.storeDetail.ownerId)})},o.goOrderTrack=function(e){s.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void n.showToast("退款受理中，请稍后刷新查看状态！");i.checkRefund(e).success(function(t){t.success?s.go("applyRefund",{cOrderSn:e}):n.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?s.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):s.go("productDetail",{productId:o.orderDetailList.productDetail.productId,o2oType:o.orderDetailList.productDetail.o2oType,storeId:o.orderDetailList.storeDetail.ownerId})},o.asse=function(e,t,i){i?o.isShowPcTips=!0:s.go("assess",{orderId:e,cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),s=null;s=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){s.executeScript({
code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,s.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(p.nextDirection("forward"),s.go("orderManage")):n.showToast(e.message)})}n.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,g=a.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.orderSnDetail,o.cOrderSnDetail,g)}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.controller("RiskDescriptionController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("SupportersAgreementController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("crowd_funding_details_control",["$localstorage","LoginService","HomePageService","PopupService","CreditService","UrlService","$sce","$ionicSlideBoxDelegate","$rootScope","$stateParams","$state","$scope","CrowdFundingServerSingle","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(){p.memberId=m.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==p.memberId&&(p.settingsList=e[t].list,!0)}p.productDataId=l.zActivityId,p.productList=[],p.isShowBtn=!1,p.showQQ=!1,p.showWeChat=!1,p.isShowCopyButton=!1,p.showQRimg=!1,p.isSurplus=!1,p.isStarts=!1,p.isError=!1,p.isTrues=!0,p.detailsBanner=[],p.Math=window.Math,p.init=function(e){p.isError=!0,p.isTrues=!0,p.showShare=!1,p.detailsBanner=[],l.shareId&&(c.shareId=l.shareId),u.detailsListZC(e).success(function(e){1==e.success&&(p.productList=e.data,p.detailsBanner=e.data.imageUrls,r.$getByHandle("crowd_funding_details_slider").update(),r.$getByHandle("crowd_funding_details_slider").loop(!0),p.richText=n.trustAsHtml(e.data.activityDetails),p.activityStatus=p.productList.activityStatus,0==p.activityStatus?(p.isStatus="预热中",p.isShowBtn=!0,p.isStarts=!0,p.isSurplus=!1,p.isError=!0,p.isTrues=!0):1==p.activityStatus?(p.isStatus="众筹中",p.isShowBtn=!0,p.isSurplus=!0,p.isStarts=!1,p.isError=!0,p.isTrues=!0):2==p.activityStatus?(p.isStatus="众筹成功",p.isShowBtn=!1,p.isSurplus=!0,p.isError=!0,p.isTrues=!0):3==p.activityStatus?(p.isStatus="众筹失败",p.isSurplus=!0,p.isShowBtn=!1,p.isError=!1,p.isTrues=!1):100==p.activityStatus?(p.isStatus="计算中",p.isShowBtn=!1,p.isSurplus=!0,p.isError=!0,p.isTrues=!0):(p.isStatus="获取失败",p.isError=!0,p.isTrues=!1))})},p.goToSupport=function(e){d.go("crowd_funding_hot_redound",{zActivityId:e})},p.$on("$ionicView.beforeEnter",function(){p.isBuyer=t.getRole(),v(),p.init(p.productDataId)}),p.customerServe=function(){o.isWdHost().success(function(t){if(c.isWdHost=t.data.isHost,-1==c.isWdHost)d.go("login");else{if(window.cordova){var o=ionic.Platform.isAndroid(),s=null;s=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&g(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else p.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+p.productList.id+"&flag="+p.kfTocken);return}})},p.showShare=!1,c.isApp=!!window.cordova||void 0,p.share=function(){if(!m.getUser().mid)return void d.go("login");p.moreShow=!1,window.device&&window.device.hasNewShare&&(p.showShare=!p.showShare)},p.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功"),p.isShowCopyButton=!1):s.showToast("请下载APP执行此操作")},p.hideblackCover=function(){p.showShare=!1},p.shareToPlatform=function(e){var t=p.productList.activityName,o=p.productList.activityDsp||p.productList.activityName,s=p.productList.imageUrls[0],n=a.getShareLinkHeader()+"crowd_funding_details/"+p.productList.id+"/"+m.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,n,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,n,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,n,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,n,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,n,0,null,i.shareSuccessCallback),i.qqShare()),5==e?p.copeText(n):i.successShare()):alert("umeng undefined 只能在app分享"),p.showShare=!1}}]),APP.service("CrowdFundingServerSingle",["$http","UrlService",function(e,t){this.detailsListZC=function(o){var s={zActivityId:o};return e.get(t.getZCUrl("ZC_ACTIVITY_SINGLE_PAGE"),s)}}]),APP.controller("crowd_funding_hot_redound_control",["$rootScope","HomePageService","$stateParams","$state","$scope","CrowdFundingServer_hot","$timeout","UserService","GoodsService","CommonAddressService","LoginService",function(e,t,o,s,i,a,n,r,c,l,d){function p(){i.memberId=r.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==i.memberId&&(i.settingsList=e[t].list,!0)}i.redoundId=o.zActivityId,i.isHotPopup=!1,i.hotPopupNum=1,i.isExcess=!1,i.isGo=!1,i.isFull=!1,i.isStatus=!1,i.isStars=!1,i.isEnd=!1,i.isMore=!1,i.isFind=!1,i.isGo=!0,i.notGo=!1,i.settingsList="",i.isBuyer=d.getRole(),i.init=function(e){a.redoundList(e).success(function(e){1==e.success&&(i.isHotPopup=!1,i.hotRedoundList=e.data,i.redound_status=e.data.activityStatus,1==i.redound_status&&(i.isStatus=!0,i.isStars=!1,i.isEnd=!1,i.isFull=!1),0==i.redound_status&&(i.isStars=!0,i.isFull=!0,i.isStatus=!1,i.isEnd=!1),100!=i.redound_status&&2!=i.redound_status&&3!=i.redound_status||(i.isEnd=!0,i.isFull=!0,i.isStatus=!1,i.isStars=!1))})},i.$on("$ionicView.beforeEnter",function(){i.isHotPopup=!1,i.hotPopupNum=1,i.init(i.redoundId),p(),i.isBuyer=d.getRole()}),i.plus=function(){0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0):i.hotPopupNum>=i.moreNum?(i.isExcess=!0,i.hotPopupNum=i.moreNum):(i.hotPopupNum++,i.isExcess=!1),i.moreNum==i.hotPopupNum&&(i.isExcess=!0)},i.nus=function(){1==i.moreNum?i.isExcess=!0:0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0):i.isExcess=!1,i.hotPopupNum<=1?i.hotPopupNum=1:i.hotPopupNum--},i.hot_close=function(){i.isHotPopup=!1,i.hotPopupNum=1,i.isExcess=!1},i.goPostData=function(){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?s.go("login"):s.go("orderWrite",{zStallsId:i.goPostId,number:i.hotPopupNum})})},i.goSupport=function(e,t,o,s,a,n,r,c){i.isHotPopup=!1,i.hotImg=o,i.hotAmounts=t,i.goPostId=e,i.returnTime=s,i.freight=a,i.commissionRate=r,i.remainingNum=-1==n?"无限额":n,i.isLottery=c,i.commonFn(e,t,o,s,a,n,r,c)},i.commonFn=function(e,t,o,s,n,r,c,l){("无限额"==i.remainingNum||i.remainingNum>=1)&&(i.isGo=!0,i.isHotPopup=!0,a.redoundNum(e).success(function(e){1==e.success?(i.hotNumber=e.data,i.moreNum=e.data.num,i.hotPopupNum=1,i.isExcess=!1,i.limintNum=e.data.limit,"无限额"==i.limintNum?i.isFind=!0:i.isFind=!1,0==i.moreNum?(i.hotPopupNum=1,i.isExcess=!0,i.isGo=!1,i.notGo=!0):(i.isExcess=!1,i.isGo=!0,i.notGo=!1),i.moreNum,i.hotPopupNum):i.isFind=!0}))}}]),APP.service("CrowdFundingServer_hot",["$http","UrlService",function(e,t){this.redoundList=function(o){var s={zActivityId:o};return e.get(t.getZCUrl("ZC_ZSTALLS_SINGLE_PAGE"),s)},this.redoundNum=function(o){var s={zStallsId:o};return e.get(t.getZCUrl("ZC_CHECK"),s)},this.postProduct=function(o,s){var i={zStallsId:o,num:s};return e.post(t.getZCUrl("ZC_ORDER_COMMIT")+"?zStallsId="+i.zStallsId+"&number="+i.num)}}]),APP.controller("CrowdFundingHomeControl",["$timeout","$ionicScrollDelegate","PopupService","CreditService","UrlService","$ionicSlideBoxDelegate","$rootScope","$scope","CrowdFundingServer","UserService","GoodsService","CommonAddressService","$stateParams","$state","$ionicPopup","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){r.typeNumber=u.type,r.typeNumber=2==r.typeNumber?2:1,r.flagNum=!1;var h=[2,3,1];r.selectedIndex=0,r.isFindTab=!0,r.brandList=[],r.HomeBanner=[],r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,r.moreProduct=!0,r.productList=[],r.newsList=[],r.endList=[],r.soonList=[],r.hasmore=!1,r.page=1,r.isHasData=!1,r.isMoreData=!0,r.Math=window.Math,r.init=function(e,o,s){u.shareId&&(n.shareId=u.shareId),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]}),f.getUnReadMsg().success(function(e){e.data>0?r.flagNum=!0:r.flagNum=!1}),t.scrollTop(),c.bannerList(r.typeNumber).success(function(e){1==e.success?(r.HomeBanner=e.data.zBannerList,r.peopleList=e.data.top3ZActivity,a.$getByHandle("crowd_funding_slider").update(),a.$getByHandle("crowd_funding_slider").loop(!0),0==r.peopleList.length?(r.isHasData=!0,r.isMoreData=!1):(r.isMoreData=!0,r.isHasData=!1)):(r.isHasData=!0,r.isMoreData=!1)}),c.moreData(e,o,r.typeNumber).success(function(e){1==e.success&&(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,1==o?(r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<r.newsNum))}),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]})},r.calculateWH=function(e,t){var o=new Image;o.src=e,o.width>o.height?$("#img"+t).attr("width","100%"):$("#img"+t).attr("height","100%")},r.$on("$ionicView.beforeEnter",function(){r.page=1,t.scrollTop(),r.init(h[r.selectedIndex],r.page)}),r.showShare=!1,n.isApp=!!window.cordova||void 0,r.share=function(){if(!l.getUser().mid)return void g.go("login");r.moreShow=!1,window.device&&window.device.hasNewShare&&(r.showShare=!r.showShare)},r.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),o.showToastShort("复制成功"),r.isShowCopyButton=!1):o.showToast("请下载APP执行此操作")},r.hideblackCover=function(){r.showShare=!1},r.shareToPlatform=function(e){var t="顺逛众筹为您提供与众不同的品质生活",o="http://m.ehaier.com/www/img/ic_aboutUS_1.png",a=i.getShareLinkHeader()+"crowdFunding/"+l.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback),s.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛众筹",t,o,a,0,null,s.shareSuccessCallback),s.qqShare()),5==e?r.copeText(a):s.successShare()):alert("umeng undefined 只能在app分享"),r.showShare=!1},r.crowdTab=function(e){r.page=1,c.changeSuccess(h[e]).success(function(o,s,i,a){1==o.success&&(r.page=1,r.selectedIndex=e,0==r.selectedIndex?(r.isTab=!0,r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):r.newsList=[]})):1==r.selectedIndex?(r.isFindEnd=!0,r.isFindSoon=!1,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.endNum=e.data.zActivitylistTotalCount,r.endList=e.data.zActivitylist,r.hasmore=r.endList.length<r.endNum):r.endList=[]})):2==r.selectedIndex?(r.isFindEnd=!1,r.isFindSoon=!0,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.soonNum=e.data.zActivitylistTotalCount,r.soonList=e.data.zActivitylist,r.hasmore=r.soonList.length<r.soonNum):r.endList=[]})):r.isTab=!1)})},r.loadMore=function(){r.$broadcast("scroll.infiniteScrollComplete"),r.page+=1,r.loadMoreProducts(h[r.selectedIndex],r.page,r.typeNumber)},r.loadMoreProducts=function(e,t,o){c.moreData(e,t,r.typeNumber).success(function(e){1==e.success?(r.isFind?(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<e.data.zActivitylistTotalCount):r.isFindEnd?(r.endList=r.endList.concat(e.data.zActivitylist),r.hasmore=r.endList.length<e.data.zActivitylistTotalCount):r.isFindSoon&&(r.soonList=r.soonList.concat(e.data.zActivitylist),r.hasmore=r.soonList.length<e.data.zActivitylistTotalCount),r.$broadcast("scroll.infiniteScrollComplete")):(r.$broadcast("scroll.infiniteScrollComplete"),r.hasmore=!1)})}}]),APP.service("CrowdFundingServer",["$http","UrlService",function(e,t){this.bannerList=function(o){var s={from:o};return e.get(t.getZCUrl("ZC_INDEX"),s)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getZCUrl("ZC_INDEX"),s)},this.moreData=function(o,s,i){var a={type:o,page:s,from:i};return e.get(t.getZCUrl("ZC_INDEX_ACTIVITY"),a)}}]),APP.controller("crowdfunding_child_end_control",["$scope","CrowdFundingServer_end","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a){}]),APP.service("CrowdFundingServer_end",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_new_control",["$state","$scope","CrowdFundingServer_new","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a,n){t.goDetails=function(){e.go("crowd_funding_details")}}]),APP.service("CrowdFundingServer_new",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_soon_control",["$scope","CrowdFundingServer_soon","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,s,i,a){e.init=function(){t.bannerList().success(function(t){e.HomeBanner=t.data.zBannerList,e.activityList=t.data.top3ZActivity,e.list=0,e.loadMore=function(){},e.selectTab=function(t){i.changeSuccess(typeList[t]).success(function(o,s,a,n){1==o.success&&(i.getFilterData().success(function(t){t.success&&(e.brandList=t.data.brandList,void 0!=t.data.filterMap?(e.otherList=t.data.filterMap.lstAttributes,e.resetFilter()):(e.otherList=[],e.resetFilter()))}),e.page=1,e.selectedIndex=t)})}})},e.init()}]),APP.service("CrowdFundingServer_soon",["$http","UrlService",function(e,t){this.bannerList=function(){return e.get(t.getZCUrl("ZC_INDEX"))}}]),APP.controller("orderWriteController",["$localstorage","InAppBrowserService","UserService","$scope","$stateParams","$rootScope","$state","orderWriteService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){s.invoiceHead=void 0,s.zzsInvoice=void 0,s.htmlContent=i.content,s.checkStatus=!0,s.list={},s.zStallsId=i.zStallsId,s.number=i.number,s.$on("$ionicView.afterLeave",function(e,t){a.isInvoice=!1}),s.$on("$ionicView.beforeEnter",function(e,t){s.init(s.zStallsId,s.number)}),s.init=function(e,t){r.getZStallsSinglePage(e,t).success(function(e){s.list=e.data})},s.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?t.open(g.getHead()+"mstore/sg/helpDetail.html?id="+e,o):n.go("helpDetail",{helpId:e,content:o})},s.checkInfo=function(e){s.checkStatus=!s.checkStatus},s.toInvoice=function(e){n.go("invoiceSetup",{invoiceHead:s.list.billCompany,invoiceType:e,enterPage:0})},s.toSubmit=function(){if(window.cordova?s.storeId=e.get("storeId",a.globalConstant.storeId):s.storeId=a.shareId?a.shareId:e.get("storeId",a.globalConstant.storeId),s.list.memberAddress)if(s.checkStatus)if(/^[^&<>]+$/.test(s.regAddress))r.commitOrder(s.zStallsId,s.number,s.list.invoiceType,s.storeId).success(function(e,t,o,s){if(1==e.success)n.go("paymentxyz",{orderSn:e.data,totalAmount:e.totalCount});else{c.confirm({template:e.message,okText:"返回上一页",cancelText:"留在此页"}).then(function(e){e&&m.goBack(-1)})}}).error(function(){});else{c.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{c.alert({template:"支持者协议必须选中！",okText:"知道了"})}else{c.alert({template:"收货地址必须填写！",okText:"知道了"})}}}]),APP.service("orderWriteService",["$http","UrlService",function(e,t){this.getZStallsSinglePage=function(o,s){return e({method:"POST",url:t.getZCUrl("ZC_ORDER_COMMIT"),params:{zStallsId:o,number:s}})},this.commitOrder=function(o,s,i,a){return e({method:"POST",url:t.getZCUrl("ZC_COMMIT_ORDER"),params:{zStallsId:o,number:s,invoiceType:i,sharePeopleId:a}})}}]),APP.controller("submitSuccessController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("flashsaleCtrl",["$stateParams","$scope","$state","$http","$interval","UrlService","flashService","GoodsService","$rootScope","$localstorage","$ionicSlideBoxDelegate","$ionicHistory","UserService","$ionicScrollDelegate","BannerThemeService",function($stateParams,$scope,$state,$http,$interval,UrlService,flashService,GoodsService,$rootScope,$localstorage,$ionicSlideBoxDelegate,$ionicHistory,UserService,$ionicScrollDelegate,BannerThemeService){function countDown(e,t,o,s){$scope.Tflag[o]=s,$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($interval.cancel(timer[o]),$scope.Tflag[o]=!1,$scope.showdiv[o]=!1)},1e3)}function fashbegin(e,t,o){timerbefore[o]=$interval(function(){(e+=1e3)>=t&&($interval.cancel(timerbefore[o]),$scope.init())},1e3)}function Format(e){return e=e<10?"0"+e:e}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.date=[],$scope.timeflag=[],$scope.Tflag=[],$scope.isWd=!1,$scope.flashInfoTwototal=[],$scope.flashInfoTwo=[],$scope.showtime="",$scope.datenow=0,$scope.datenow1=0,$scope.dateHour=0,$scope.datemonth=0,$scope.datayear=0,$scope.storeId=0;var timer=[],timerbefore=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="";$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.showdiv=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.timeflag=[],$scope.showdiv=[],$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId;for(var i=0;i<remindArray.length;i++)$interval.cancel(timer[remindArray[i]]);remindArray=[],flashService.getFlashone($scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e){timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1;var t={};for(var o in e.data.flashTimeProductMap)t[o]={};for(var s in t)for(var i in e.data.flashTimeProductMap)for(var a in e.data.flashTimeProductMap[i])s==i&&(t[s][new Date(a).getTime()+a]=e.data.flashTimeProductMap[i][a]);$scope.flashInfoTwototal=t,$scope.date=[];for(var n in $scope.flashInfoTwototal)$scope.date.push({time:n.slice(5).replace("/","月")+"日",item:n});$scope.date[0].id=1;var r=[],c=[],l=new Date;$scope.datenow=l.getTime(),$scope.datenow1=[],$scope.dateHour=l.getDate(),$scope.datemonth=Format(l.getMonth()+1).toString(),$scope.datayear=l.getFullYear();for(var d in $scope.flashInfoTwototal[$scope.date[0].item])$scope.datenow>=$scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime&&$scope.datenow<=$scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime?($scope.showdiv.push(!0),$scope.timeflag.push(!0),r.push($scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime)):$scope.datenow<$scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime?($scope.showdiv.push(!0),$scope.timeflag.push(!1),c.push($scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime)):$scope.datenow>$scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime?$scope.showdiv.push(!1):($scope.showdiv.push(!0),$scope.timeflag.push(!1));for(var p=0;p<c.length;p++)$scope.datenow1[p]=l.getTime(),fashbegin((new Date).getTime(),c[p],p);for(var u=0;u<r.length;u++)remindArray.push(u),countDownNowTime[u]=parseInt($scope.datenow/1e3),countDownendTime[u]=parseInt(r[u]/1e3);for(var g=timerLength;g<remindArray.length;g++)countDown(countDownNowTime[remindArray[g]],countDownendTime[remindArray[g]],remindArray[g],$scope.timeflag[g]);$scope.flashInfoTwo=$scope.flashInfoTwototal[$scope.date[0].item]})}),flashService.slidedata().success(function(e){$scope.bannerList=e.data.topBanner,$scope.others=e.data.others,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("flashsale_slide").loop(!0)})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.changecolor=function(e,t){$scope.index=e,$scope.date[0].id=0==e?1:2;for(var o in $scope.flashInfoTwototal)o==t&&($scope.flashInfoTwo=$scope.flashInfoTwototal[o]);$scope.timeflag=[],$scope.showdiv=[];var s=new Date;$scope.datenow=s.getTime();for(var i in $scope.flashInfoTwo)$scope.datenow>=$scope.flashInfoTwo[i][0].startTime&&$scope.datenow<=$scope.flashInfoTwo[i][0].endTime?($scope.showdiv.push(!0),$scope.timeflag.push(!0)):$scope.datenow<$scope.flashInfoTwo[i][0].startTime?($scope.showdiv.push(!0),$scope.timeflag.push(!1)):$scope.datenow>$scope.flashInfoTwo[i][0].endTime?$scope.showdiv.push(!1):($scope.showdiv.push(!0),$scope.timeflag.push(!1))},$scope.$on("$ionicView.beforeEnter",function(){for(var e=0;e<timerbefore.length;e++)$interval.cancel(timerbefore[e]);for(var t=0;t<timer.length;t++)$interval.cancel(timer[e]);$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){for(var o=0;o<timerbefore.length;o++)$interval.cancel(timerbefore[o]);for(var s=0;s<timer.length;s++)$interval.cancel(timer[o])}),$scope.goback=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("flashService",["$http","UrlService",function(e,t){this.PrefixInteger=function(e){return e<10?"0"+e:e},this.getFlashone=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,from:n};return e.get(t.getNewUrl("NEW_FLASHSALE"),r)},this.slidedata=function(){var o={type:2};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.factory("$localstorage",["$window",function(e){return{set:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},setObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")},setArray:function(t,o){e.localStorage[t]=JSON.stringify(o)},getArray:function(t){return JSON.parse(e.localStorage[t]||"[]")}}}]),APP.service("CommonAddressService",["AreaService","GoodsService","CacheService","$rootScope","$localstorage",function(e,t,o,s,i){var a={};return{addAddressInfo:function(){e.getLocalArea().then(function(e){var i=e.regeocode.addressComponent;t.getAddressId(i.province,i.city,i.district,i.township,i.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){var n=e.data,r=i.district+"/"+i.township;-1==window.location.href.indexOf("sg_rn_app")?t.addAddress(n.provinceId,n.cityId,n.regionId,r,n.streetId).success(function(e){s.dingWeiSuccess=!0,s.globalConstant.positionStatus?s.globalConstant.autoPosition=r:s.globalConstant.autoPosition="定位失败：崂山区/中韩街道",a={provinceId:n.provinceId,cityId:n.cityId,areaId:n.regionId,streetId:n.streetId,provinceName:i.province,cityName:i.city,regionName:i.district,streetName:i.township},setTimeout(function(){s.$broadcast("CACHE_SUCCESS",a)},2e3),o.set("addressInfo",a)},function(e){}):(s.dingWeiSuccess=!0,s.globalConstant.positionStatus?s.globalConstant.autoPosition=r:s.globalConstant.autoPosition="定位失败：崂山区/中韩街道",a={provinceId:n.provinceId,cityId:n.cityId,areaId:n.regionId,streetId:n.streetId,provinceName:i.province,cityName:i.city,regionName:i.district,streetName:i.township},setTimeout(function(){s.$broadcast("CACHE_SUCCESS",a)},2e3),o.set("addressInfo",a))}},function(e){})},function(e){a={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"};var s=a.regionName+"/"+a.streetName;t.addAddress(a.provinceId,a.cityId,a.areaId,s,a.streetId).success(function(e){o.set("addressInfo",a)},function(e){})})},getAddressInfo:function(){return o.get("addressInfo")?o.get("addressInfo"):a={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"}}}}]),APP.config(commonConfig),APP.config(route),APP.config(interceptors),APP.config(["$httpProvider",function(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"]}]),APP.factory("AreaService",["$rootScope","UrlService","$q","$http",function(e,t,o,s){return{init:function(){var e=o.defer();return navigator.geolocation.getCurrentPosition(function(t){e.resolve(t)},function(t){e.reject(t)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),e.promise},getLocalArea:function(){var t=o.defer();return AMap.plugin("AMap.Geocoder",function(){geocoder=new AMap.Geocoder({city:"010"});var o=[e.globalConstant.lon,e.globalConstant.lat];geocoder.getAddress(o,function(e,o){"complete"===e&&"OK"===o.info?t.resolve(o):t.reject(o)})}),t.promise}}}]),APP.service("CacheService",[function(){var e={};this.get=function(t){return e[t]},this.set=function(t,o){return e[t]=o},this.pop=function(t){var o=e[t];return e[t]="",o}}]),APP.factory("CalculateStrLength",function(){var e={};return e.limitStrLength=function(e,t){for(var o=0,s=0;s<e.length;s++)if(e.charCodeAt(s)>127||94==e.charCodeAt(s)){if((o+=2)>t)return e.substring(0,s-1)+"..."}else if(++o>t)return e.substring(0,s-1)+"...";if(o<=t)return e},e.dealPrice=function(e){if(null!=e&&void 0!=e){var e=e.toString(),t=e.indexOf(".");if(-1==t)return{priceInt:e,priceFloat:"00"};return{priceInt:e.substring(0,t),priceFloat:e.substring(t+1).substring(0,2)}}},e}),APP.service("CreditService",["UrlService","$http","$timeout",function(e,t,o){this.shareSuccessCallback=function(o){var s={};arguments.length>1&&(s=arguments[1]);var i=e.getUrl("SHARESUCCESS"),a=[];for(var n in s)a.push(n+"="+s[n]);t.get(i+"?"+a.join("&")).success(function(e){e.success}).error(function(e,t,o,s){})},this.successShare=function(e){},this.qqShare=function(){};var s=null;this.getGameId=function(o){if(s)o(s);else{var i=e.getUrl("FIND_GAME_ID");t.get(i).success(function(e){e.success?(s=e.data,o(e.data)):o("f265383f0538834f")}).error(function(e,t,s,i){o("f265383f0538834f")})}}}]),APP.service("FileUploadService",["$http","UrlService",function(e,t){if(window.FileTransfer){var o=new FileTransfer;this.upload=function(e,t,s,i,a,n,r,c){var l=new FileUploadOptions;l.fileKey=s||"imageFile",l.fileName=i||e.substr(e.lastIndexOf("/")+1),a&&(l.mimeType="image/jpeg");var d={};d.userName="18560683520",l.params=d,o.upload(e,encodeURI(t),r,c,l)}}}]),APP.filter("ImageFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/ic_haier_2.png"}}]).filter("ImageUserFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/user.jpg"}}]).filter("ImageTopicFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/quanzi.png"}}]).filter("scoleFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/scoleimg.png"}}]).filter("bgImgFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/bgImg.png"}}]).filter("Num4Filter",[function(){return function(e){return parseInt(e)>9999&&(e="9999+"),e}}]).filter("Num2Filter",[function(){return function(e){return parseInt(e)>99?e="99+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("BigNumFilter",[function(){return function(e){return parseInt(e)>99999?e="10万+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("bluetext",["$sce","$log",function(e,t){return function(t,o){if(!o)return e.trustAsHtml(t);var s=new RegExp(o,"gi"),i=t.replace(s,'<span style="color: #0076fd">$&</span>');return e.trustAsHtml(i)}}]).filter("cutTwoFilter",[function(){return function(e){return"number"==typeof number&&(e=e.toFixed(2),e=parseFloat(e)),e}}]).filter("formatNumber",function(){return function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}).filter("addImgURLPostfix",[function(){return function(e,t,o){return/cdn[23][0-9].ehaier.com/.test(e)&&(e=e+"@"+t+"_"+o),e}}]).filter("keepInt",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".")
;return e.toFixed(2).toString().slice(0,t)}return 0}}).filter("keepFloat",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".");return e.toFixed(2).toString().slice(t)}return".00"}}).filter("encryptPhone",function(){return function(e){return 11==e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):e}}).filter("totext",[function(){return function(e){return"1"==e?"收入":"支出"}}]).filter("chinaDate",function(){return function(e){return e.substring(4,6)+"月"+e.substring(6,8)+"日"}}).filter("FilterRealName",function(){return function(e){if(e.length>=2){for(var t=e.length,o="",s=0;s<t-1;s++)o+="*";return e=o+e.substring(t-1,t)}return e}}).filter("flashsaleDenum",function(){return function(e){return 0==e.substring(0,1)?e=e.substring(1,5):e}}).filter("delLing",function(){return function(e){return"0"==e.substring(0,1)?e=e.substring(1):e}}).filter("collectsFilter",[function(){return function(e){return e<1e4?e:e=e%100>0&&e%100<50?(e/1e4).toFixed(2)+.01:(e/1e4).toFixed(2)}}]).filter("datachange",function(){return function(e){return e=e.replace("年","/").replace("月","/").replace("日","")}}).filter("rewardToword",function(){return function(e){return"YC"==e&&(e="育成奖励"),"BC"==e&&(e="补差奖励"),"ST"==e&&(e="生态奖励"),"JY"==e&&(e="经营奖励"),"FWB"==e&&(e="服务兵奖励"),"PT"==e&&(e="平台奖励"),"PX"==e&&(e="培训奖励"),e}}).filter("highlight",["$sce","$log",function(e,t){return function(o,s){if(t.info("text: "+o),t.info("search: "+s),!s)return e.trustAsHtml(o);o=encodeURI(o),s=encodeURI(s);var i=new RegExp(s,"gi"),a=o.replace(i,'<span style="color:#2979FF">$&</span>');return a=decodeURI(a),t.info("result: "+a),e.trustAsHtml(a)}}]).filter("whiteUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),APP.service("H5LocationService",[function(){this.getLocation=function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e):alert("Geolocation is not supported by this browser.")}}]),APP.service("IMService",["$rootScope","$ionicPopup","$interval","$ionicLoading","UrlService","UserService",function(e,t,o,s,i,a){function n(){for(var e=[],t="0123456789abcdef",o=0;o<36;o++)e[o]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}var r=null,c=null,l=null,d=this;this.destroyWebSocket=function(e){if(null!=c)try{c.disconnect(function(){if(c=null,null!=l){try{l.close(),l=null}catch(e){}e&&window.setTimeout(e,3e3)}})}catch(e){}},this.validateWebSocket=function(){null!=l&&1!=l.readyState&&this.initWebSocket()},this.initWebSocket=function(t){r&&t||t&&(r=t);try{l=new WebSocket(i.getWSUrl("MESSAGE_WS_URL")),c=Stomp.over(l),c.debug=function(){window.console&&console.log&&console.log.apply};var o=function(){$.ajax({url:i.getUrl("REGIST_MESSAGE_TOKEN"),type:"post",dataType:"json",success:function(t){if(t.success){var o=t.data,s=o;e.token=o;var i="stomp-subscription-"+n();c.subscribe("/exchange/message_topic_exchange/"+s,function(e){r(JSON.parse(e.body))},{"x-queue-name":i});c.subscribe("/exchange/message_fanout_exchange",function(e){r(JSON.parse(e.body))},{"x-queue-name":i})}else d.destroyWebSocket()}})},s=function(){d.destroyWebSocket(d.initWebSocket)};c.connect(i.getMQAuth().username,i.getMQAuth().password,o,s,"/")}catch(e){}}}]),APP.factory("InAppBrowserService",["PopupService","$rootScope",function(e,t){ionic.Platform.isAndroid();return window.device&&window.device.hasNewBrowser?{open:function(t,o){var s=ionic.Platform.isAndroid(),i=null;return i=s?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),i.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&i.close(),s?e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1)||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1?i.showMyButton():i.hideMyButton():e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1||e.url.indexOf("helpDetail")>-1)?(i.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),i.addMyTitle(o))):i.hideMyButton()}),i.addEventListener("loaderror",function(t){setTimeout(function(){i.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),i}}:{open:function(t,o){var s=ionic.Platform.isAndroid(),i=null;return i=s?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),i.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&i.close(),s||(e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("helpDetail")>-1)?(i.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),i.addMyTitle(o))):i.hideMyButton())}),i.addEventListener("loaderror",function(t){setTimeout(function(){i.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),i}}}]),APP.directive("inputClear",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,s){return{restrict:"E",replace:!0,scope:{},require:"ngModel",template:'<i class="icon ion-close-circled" ng-show="isShow" style="font-size: 20px ;vertical-align: middle;color: #9b9b99;position: relative;right: 25px;margin-left: -4px;display: inline-block;width: 0"></i>',link:function(e,t,o,i){e.isShow=!1;var a=t[0].previousElementSibling;a.onblur=function(){s(function(){e.isShow=!1})},a.onfocus=function(){s(function(){a.value&&(e.isShow=!0)})},e.$watch(function(){return a.value},function(t,o,s){angular.equals(t,o)||(e.isShow=!!a.value)}),t.on("click",function(o){t[0].focus(),i.$setViewValue(""),e.isShow=!1;var n=a.blur;a.blur=function(){},s(function(){a.blur=n},100)})}}}]),APP.directive("goTop",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,s){return{restrict:"AE",replace:!0,template:'<img ng-src="{{imgBaseURL}}img/icon_toTop.png" style="width: 44px;"  ng-show="showGoTop"/>',link:function(e,t,o){var i=void 0,a=void 0,n=!1;e.showGoTop=!1,s(function(){var s="z-index:10;width:44px;position:fixed;right:10px;bottom:"+(o.offset||20)+"px!important";i=e.$$childHead.scrollCtrl,a=i.element,t[0].setAttribute("style",s)},100);var r=function(){if(i&&i.getScrollPosition()&&!n){var t=i.getScrollPosition().top;e.showGoTop=t>500,n=!0,e.$apply(function(){n=!1},500)}};s(function(){ionic.on("scroll",r,a)},1e3),t.on("click",function(){i.scrollTop(!0),s(function(){e.showGoTop=!1},200)})}}}]),APP.service("MediaService",["$http","UrlService","$ionicPopup","$rootScope",function(e,t,o,s){function i(e){try{e&&e.data&&(d?(c+=e.data.length,r=r.concat(e.data)):(c=e.data.length,r=e.data,d=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function a(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}this.getPicture=function(e,t,o){navigator.camera&&navigator.camera.getPicture&&(0==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==e&&navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}))};var n={},r=[],c=0;window.URL=window.URL||window.webkitURL;var l="",d=!0;this.addAudioEventOnWindow=function(){window.addEventListener("audioinput",i,!1),window.addEventListener("audioinputerror",a,!1)},this.removeAudioEventOnWindow=function(){window.removeEventListener("audioinput",i),window.removeEventListener("audioinputerror",a)},this.startCapture=function(e,t){try{window.audioinput&&!audioinput.isCapturing()&&(n={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(n))}catch(e){alert("startCapture exception: "+e)}};var p=function(e,t,o){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),c=0;var i=new WavAudioEncoder(n.sampleRate,n.channels);i.encode([r]);var a=i.finish("audio/wav");window.resolveLocalFileSystemURL(s.isIOS?cordova.file.dataDirectory:cordova.file.externalDataDirectory,function(s){var i="temp"+(new Date-0)+".wav";s.getFile(i,{create:!0},function(s){s.createWriter(function(i){i.write(a),setTimeout(function(){l=s.toURL(),document.getElementById(e).src=l,document.getElementById(t).load(),o&&o()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};this.stopCapture=p;var u=function(){window.resolveLocalFileSystemURL(l,function(e){e.remove(function(){d=!1},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};this.deleteMedia=u,this.getAudioUrl=function(){return l}}]),APP.service("PlatformService",[function(){this.getPlatform=function(){return window.cordova?"APP":"WEB"}}]),APP.service("PopupService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService",function(e,t,o,s,i){this.showConfirm=function(e,o,s,i){t.confirm({title:e||"提示",okText:i||"确定",cancelText:"取消",template:o||"默认提示信息"}).then(s)},this.showAlert=function(e,o,s){t.alert({title:e||"提示",okText:"确定",template:o||"默认提示信息"}).then(s)},this.showToast=function(e){var t=e||"默认提示消息";s.show({template:'<div style="background:rgba(0,0,0,0.4);border-radius:4px;padding:8px;">'+t+"</div>",duration:2e3})},this.goldIncrease=function(t){e.curMsg=0,s.show({template:'<div style="width:240px;position:absolute;left:50%;margin-left:-120px;bottom:100px;background:rgba(0,0,0,0.4);border-radius:18px;padding:8px;">'+t+"</div>",duration:2e3,animation:"fade-in",showBackdrop:!1})},this.showGoodCoupon=function(e){$("<div/>").html('<div style="width:100%;height:100%;position:fixed;background: rgba(0,0,0,0.70);z-index:100;top:0;left:0;" flex="cross:center main:center">\n    <div style="width:250px;height:264px;background: #fff url(http://cdn09.ehaier.com/shunguang/H5/www/img/im-quant@2x.png) no-repeat;background-size:100% 185px;border-radius: 8px;position:relative;">\n      <div style="position:absolute;width:24px;height:24px;top:0;right:0;" onclick="closeGoodCoupon(this)">\n        <img style="width:100%;height:100%;padding:5px;" src="http://cdn09.ehaier.com/shunguang/H5/www/img/ic-close@2x.png">\n      </div>\n      <div style="height:185px;padding:32px 24px 0;">\n        <div style="font-size: 12px;color: #fff;text-shadow: 0 1px 1px rgba(111,0,0,0.75);text-align:center;">贵店开张，价值<span style="font-size:20px;color:#FFE447;">'+e+'</span>优惠券大礼包放入你的钱包，供你任性消费！</div>\n      </div>\n      <div style="height:79px;padding-top:17px">\n        <div onclick="gomyCouponsList(this)" style="background: #f40;box-shadow: 0 1px 2px 0 rgba(255,68,0,0.50);border-radius: 78px;height:44px;margin:0 21px;font-size: 16px;color: #fff;text-align:center;line-height:44px;">我的优惠券</div>\n    </div>\n    </div>\n  </div>').appendTo($("body"))},this.levelUp=function(e,t,o){s.show({template:'<div style="width:335px;position:absolute;top:-2px;left:0;bottom:0;right:0;margin: auto;z-index:10;">\n                    <img src="http://cdn09.ehaier.com/shunguang/H5/www/img/levelUp.png" style="width:100%;position:absolute;top:0;left:0;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'<11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage'+t+'.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'==11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage mengzhu.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <p style="width:82px;height:28px;line-height:28px;font-size:20px;color:#ff3232;letter-spacing:-0.49px;text-align:center;\n                    position: absolute;top:72px;left:10px;bottom:0;right:0;margin: auto;"\n                    >'+e+'</p>\n                    <p ng-if="'+o+'" style="height:20px;position: absolute;top:253px;left:10px;bottom:0;right:0;margin: auto;font-size:14px;color:#4a4a4a;letter-spacing:-0.34px;text-align:center;">距离下一个级别还有'+o+'成长值</p>\n                    <div style="width:24px;height:24px;position: absolute;top:-210px;left:0;bottom:0;right:-220px;margin: auto;"\n                    onclick="closeLevelUpPop()" ></div>\n                </div>\n                <div class="myBackDrop" style="width:100%;height:100%;position:fixed;top:0;left:0;background:rgba(0,0,0,0.3);visibility: visible;"></div>',animation:"fade-in"})},this.dynamic=function(e){s.show({template:'<div style="width:70%;height:35px;line-height:35px;background:#000;opacity:0.5;position:absolute;top:5px;left:8px;z-index:99;border-radius:5px;font-size:12px;">'+e+"</div>",duration:3e3,showBackdrop:!1})},this.showToastShort=function(e){s.show({template:e||"默认提示消息",duration:1e3})},this.showToastWithTime=function(e,t){s.show({template:e||"默认提示消息",duration:t})},this.showImgViewer=function(e,o){var s="";if(!arguments[1]||arguments[1]){var a="default.png";null!=e&&""!=e&&(a=e),s=i.getImageUrlData()+a}else s=e;var n=t.show({template:'<img ng-src="'+s+'">',title:"",subTitle:"",cssClass:"jsh-img-viewer",buttons:[{text:"&#xe642;",type:"jsh-img-viewer-close dhcfont",onTap:function(e){n.close()}}]})},this.dialog=function(e){var t=$("<div style='background-color:rgba(0,0,0,0.5);width:100%;position:absolute;top:-2px;left:0;bottom:0;right:0;margin: auto;z-Index:10;display:flex;flex-direction: column;align-content:center;justify-content:center;align-items:center'/>").append(e.content).appendTo($("body"));return e.onOpen&&e.onOpen.call(t),e.buttons&&$(e.buttons).each(function(){this.handler&&$(this.selector).click(this.handler)}),t}}]),APP.factory("UserService",["$rootScope","$localstorage",function(e,t){var o,s=function(){this.mobile=void 0,this.rankName=void 0,this.cartNumber=void 0,this.sessionKey=void 0,this.userId=void 0,this.token=void 0,this.userName=void 0,this.mid=void 0,this.avatarImageFileId=void 0,this.nickName=void 0,this.gender=void 0,this.email=void 0,this.birthday=void 0,this.sessionValue=void 0,this.loginName=void 0,this.accessToken=void 0,this.ucId=void 0};return{getUser:function(){if(!o){o=new s;var e=t.getObject("USER_CACHE_KEY");e&&(o.mobile=e.mobile,o.rankName=e.rankName,o.cartNumber=e.cartNumber,o.sessionKey=e.sessionKey,o.userId=e.userId,o.token=e.token,o.userName=e.userName,o.mid=e.mid,o.avatarImageFileId=e.avatarImageFileId,o.nickName=e.nickName,o.gender=e.gender,o.email=e.email,o.birthday=e.birthday,o.sessionValue=e.sessionValue,o.loginName=e.loginName,o.accessToken=e.accessToken,o.ucId=e.ucId)}return o},setUser:function(i){o||(o=new s),i&&(o.mobile=i.mobile,o.rankName=i.rankName,o.cartNumber=i.cartNumber,o.sessionKey=i.sessionKey,o.userId=i.userId,o.ucId=i.ucId,o.token=i.token,o.userName=i.userName,o.mid=i.mid,o.avatarImageFileId=i.avatarImageFileId,o.nickName=i.nickName,o.gender=i.gender,o.email=i.email,o.birthday=i.birthday,o.sessionValue=i.sessionValue,o.loginName=i.loginName,o.accessToken=i.accessToken,t.setObject("USER_CACHE_KEY",o),e.$broadcast("USER:REFLASH",o))},clearUser:function(){o&&(o.mobile=void 0,o.rankName=void 0,o.cartNumber=void 0,o.sessionKey=void 0,o.userId=void 0,o.token=void 0,o.userName=void 0,o.mid=void 0,o.avatarImageFileId=void 0,o.nickName=void 0,o.gender=void 0,o.email=void 0,o.birthday=void 0,o.sessionValue=void 0,o.accessToken=void 0),t.setObject("USER_CACHE_KEY",null),e.$broadcast("USER:CLEAR")},isUserLogin:function(){return o||(o=this.getUser()),!!o.token}}}]),APP.service("VersionService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService","$http",function(e,t,o,s,i,a){window.cordova&&ionic.Platform.platform().indexOf("ios");this.checkVersion=function(){return}}]),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".play-sound {\n    padding-top: 5px;\n    padding-bottom: 5px;\n}\n\n.play-sound svg {\n    margin-bottom: -3px\n}\n\n.play-sound :first-child {\n    min-width: 50px;\n    max-width: 180px;\n    text-align: left;\n    ;\n}\n\n.play-sound i {\n    box-shadow: none !important;\n}\n\n.play-sound i::before {\n    transform: rotate(45deg);\n    color: #808080;\n}\n\n.play-sound span {\n    font-size: 8px;\n    color: #9D9D9B;\n    vertical-align: -webkit-baseline-middle;\n}\n\n.play-sound .refresh {\n    padding: 3px;\n    color: #d50000;\n    font-size: 20px;\n}\n\n.play-sound .new {\n    color: #d50000;\n}\n\n.play-sound-right {\n    transform: rotate(180deg);\n}\n\n.play-sound-right :first-child {\n    background-color: #FFFFFF !important;\n}\n\n.play-sound-right span {\n    display: inline-block;\n    transform: rotate(180deg) !important;\n}\n\n.play-sound-right div i::before {\n    color: #DDDDDD !important;\n}"),function(e){try{e=angular.module("play-sound.templates")}catch(t){e=angular.module("play-sound.templates",[])}e.run(["$templateCache",function(e){e.put("play-sound.html",'<div class="play-sound">\n    <div class="button padding-horizontal" style="padding: 0;padding-left: 8px;" ng-disabled="isLoading" ng-click="play()">\n        <img class="" src="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/playaudio.png" ng-show="!isLoading" />\n        <svg width=\'15px\' height=\'15px\' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" ng-show="isLoading"\n             preserveAspectRatio="xMidYMid" class="uil-spin" style="    position: relative;bottom: 12px;">\n            <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>\n            <g transform="translate(50 50)">\n                <g transform="rotate(0) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(45) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.12s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.12s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(90) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.25s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.25s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(135) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.37s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.37s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(180) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.5s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.5s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(225) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.62s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.62s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(270) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.75s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.75s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(315) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.87s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.87s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n            </g>\n        </svg>\n    </div>\n    <span ng-bind="dur|DurFilter" ng-if="!isLoading&&!isError"></span>\n    <span class="icon ion-ios-refresh refresh" ng-if="isError" ng-click="reload()"></span>\n    <span class="icon ion-record new" ng-if="isNew && !isLoading&&!isError"></span>\n    <audio preload="auto">\n        <source ng-src="{{url|Trusted}}" type="audio/wav">\n    </audio>\n    <loading ng-include=""></loading>\n</div>\n')}])}(),angular.module("play-sound.directive",[]).directive("playSound",["$state","$timeout","$interval","$rootScope",function(e,t,o,s){return{restrict:"E",replace:!0,scope:{url:"@url",side:"@side",isNew:"@isNew"},templateUrl:"play-sound.html",link:function(e,t,o,i){"right"==e.side&&(t[0].className="play-sound play-sound-right");var a=s.chatScope.targetScope;e.isLoading=!0,e.isError=!1;var n=t[0].getElementsByTagName("audio")[0],r=(t[0].getElementsByTagName("source")[0],t[0].getElementsByClassName("button")[0]);n.addEventListener("loadedmetadata",function(t){e.dur=n.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),n.addEventListener("canplaythrough",function(t){e.dur=n.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),n.addEventListener("ended",function(){n.pause(),n.currentTime=0},!1),n.addEventListener("error",function(){e.isError=!0},!1),a.$on("play-sound:stop",function(t,o){o.who.$id!=e.$id&&(n.pause(),n.currentTime=0)}),e.$on("$ionicParentView.beforeLeave",function(e,t){n.pause()}),e.play=function(){a.$broadcast("play-sound:stop",{who:e}),n.currentTime?(n.pause(),n.currentTime=0):(n.volume=1,e.isNew=!1,n.pause(),n.currentTime=0,n.play())},e.reload=function(){n.load(),e.isLoading=!0}}}}]),angular.module("play-sound.filter",[]).filter("DurFilter",[function(){return function(e){if(e)return isNaN(e)&&(e="?"),Math.round(e)+'"'}}]).filter("Trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("play-sound",["ionic","play-sound.filter","play-sound.directive","play-sound.templates"]),APP.controller("GameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService","$ionicScrollDelegate","$http","ProductDetailService","CommonAddressService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){function $(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var S="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var I=.22*window.innerWidth;e.gridHeight={height:I+"px"},e.gridHeightMiddle={height:2*I+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var w=330,y=window.innerHeight,T=y-373+"px";e.contentHeight={height:T},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION_GAME",e.defaultValue=null,e.level=0;var C={};e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.goBackFlag=!0,e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init(),e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&m.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=$(1e3*e.game.beginTime),e.endTime=$(1e3*e.game.endTime),p.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):l.showToast(t.message)}).error(function(){l.showMsg("网络错误")})};var b,A,P,x,L=0,D=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success&&-1!=t.result.prizeType)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.success&&-1==t.result.prizeType)r.alert({template:t.result.message});else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,s.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*D+e.endP;b=5,A=4==D?15:10,P=4==D?t-15:t-10,x=4==D?t-10:t-5}},e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=i(function(){if(L++,L>=b?w=100:L>=A?w=60:L>=P?w=100:L>=x&&(w=500),L>12*D&&e.curP===e.endP)return L=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},w))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||e.goBackFlag&&(e.goBackFlag=!1,d.goBack())},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,m.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var N=!1;e.goSelect=ionic.Utils.debounce(function(o,s){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var s=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,
e.provinceTop=m.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(s.value,ah).success(function(t){1==ah&&(areaValueCity=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,m.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=m.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=m.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,h.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),m.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else{if(N)return;i(function(){N=!1},1500),t.$broadcast(e.flag,e.defaultValue),N=!0,e.closeAddressModal()}},300),t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){C=v.getAddressInfo();var o=C.regionName+"/"+C.streetName;h.addAddress(C.provinceId,C.cityId,C.areaId,o,C.streetId).success(function(){var o={"text-1":C.provinceName,"text-2":C.cityName,"text-3":C.regionName,"text-4":C.streetName,"value-1":C.provinceId,"value-2":C.cityId,"value-3":C.areaId,"value-4":C.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",s=S,i=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback):3==t?(window.umeng.shareToQQ("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback),g.qqShare()):4==t&&(window.umeng.shareToQzone("顺逛抽奖活动",o,s,i,0,null,g.shareSuccessCallback),g.qqShare()),5==t?e.copeText(i):g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("helpStaffController",["$scope","$state","helpStaffService","$localstorage","$stateParams","$ionicPopup","PopupService",function(e,t,o,s,i,a,n){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.memberId=i.memberId,e.gameId=i.gameId,e.numberInit="";var r;e.init=function(){o.gameHellpInit(e.gameId,e.memberId).success(function(t,o,s,i){1==t.success?(r=t.data.helpNum,e.number=t.data.helpedNum,e.numberInit=t.data,e.number==r?(e.numberColor="34%",e.renshuColor="27.8%"):e.number==2*r?(e.numberColor="66.5%",e.renshuColor="60.3%"):e.number>=3*r?(e.numberColor="100%",e.renshuColor="93.8%"):(e.numberColor=e.number*(100/(3*r))+"%",e.renshuColor=e.number*(100/(3*r))-6.2+"%")):n.showToast(t.message)})},e.zhuli=function(){o.gameHellp(e.gameId,e.memberId,e.channel).success(function(t,o,s,i){1==t.success?(e.showBg=!0,e.codeNum=t.code,e.init()):t.message&&n.showToast(t.message)})},e.closeShow=function(){e.showBg=!1},e.$on("$ionicView.beforeEnter",function(){e.showBg=!1,e.codeNum="",e.memberId=i.memberId,e.gameId=i.gameId,e.channel=i.channel,e.init()})}]),APP.service("helpStaffService",["$http","UrlService",function(e,t){this.gameHellp=function(o,s,i){var a={gameId:o,memberId:s,channel:i};return e.get(t.getGameUrl("GAME_HELLP"),a)},this.gameHellpInit=function(o,s){var i={gameId:o,memberId:s};return e.get(t.getGameUrl("GAME_HELLP_INIT"),i)}}]),APP.controller("VipGameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var f="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var h=.22*window.innerWidth;e.gridHeight={height:h+"px"},e.gridHeightMiddle={height:2*h+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var v=330;e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeEnter",function(){e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init()}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=m(1e3*e.game.beginTime),e.endTime=m(1e3*e.game.endTime),p.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):alert(t.message)}).error(function(){l.showMsg("网络错误")})};var $,S,I,w,y=0,T=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,s.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*T+e.endP;$=5,S=4==T?15:10,I=4==T?t-15:t-10,w=4==T?t-10:t-5}},e.start=function(){!e.endP||e.endP>11||(e.isRuning=!0,e.timer=i(function(){if(y++,y>=$?v=100:y>=S?v=60:y>=I?v=100:y>=w&&(v=500),y>12*T&&e.curP===e.endP)return y=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},v))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!u.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||d.goBack()},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",s=f,i=a.getShareLinkHeader()+"game/"+e.gameId+"/"+u.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,s,i):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,s,i):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,s,i):3==t?window.umeng.shareToQQ("顺逛抽奖活动",o,s,i):4==t?window.umeng.shareToQzone("顺逛抽奖活动",o,s,i):5==t&&e.copeText(i),g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("anAuspiciousStartController",["$scope","anAuspiciousStartService","GameService","$ionicPopup","$timeout","CreditService","UrlService","$http","$ionicHistory","$stateParams","PopupService","UserService","InAppBrowserService","$state","$interval",function(e,t,o,s,a,n,r,c,l,d,p,u,g,m,f){function h(){P=f(e.initWinningList,2e4)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={"padding-top":"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={"padding-top":"44px"});var v=0;e.isShowForm=!1,e.picLists=[],e.surplusChance="",e.gameId=d.anAuspiciousId,e.curP=0;var S="";e.isRuning=!1;var I,w,y,T,C=330,b=0,A=Math.floor(3*Math.random())+2;e.prizeLists=[];var P=null;e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=a(function(){if(b++,b>=I?C=100:b>=w?C=60:b>=y?C=100:b>=T&&(C=500),b>12*A&&e.curP===e.endP)return b=0,e.isRuning=!1,void(e.isShowForm=!0);e.curP<12?e.curP++:e.curP=0,e.start()},C))},Array.prototype.shuffle||(Array.prototype.shuffle=function(){for(var e,t,o=this.length;o;e=parseInt(Math.random()*o),t=this[--o],this[o]=this[e],this[e]=t);return this}),e.gameButton=function(){if(!e.isRuning){t.drawPrize(e.gameId).success(function(t){if(t.success){if(e.prizeData=t.result,e.surplusChance=t.result.surplusChance,v=t.result.playTimes?t.result.playTimes:v,3!=t.result.prizeType&&-1!=t.result.prizeType){var o={mobile:"",prizeName:""};o.mobile=u.getUser().mobile,o.mobile=o.mobile.substr(0,3)+"****"+o.mobile.substr(7),o.prizeName=t.result.prizeName,e.prizeLists.shuffle(),e.prizeLists.splice(9,0,o)}-1!=t.result.prizeType?(e.endP=t.result.postion-1,e.start()):(e.curP=void 0,p.showToast(t.result.message))}else t.message&&p.showToast(t.message)}).error(function(e){p.showToast("网络错误")});var o=12*A+e.endP;I=5,w=4==A?15:10,y=4==A?o-15:o-10,T=4==A?o-10:o-5}},e.hideForm=function(){e.isShowForm=!1},function(t){t.fn.extend({RollTitle:function(t){if(!t)var t={};var o=this;e.timer=o.timer=null,o.lineH=o.find("p:first").height(),o.line=t.line?parseInt(t.line,15):parseInt(o.height()/o.lineH,10),o.speed=t.speed,o.timespan=t.timespan,0==o.line&&(this.line=1),o.scrollUp=function(){o.animate({marginTop:0},o.speed,function(){for(i=1;i<=o.line;i++)o.find("p:first").appendTo(o);o.css({marginTop:0})})},o.hover(function(){clearInterval(o.timer)},function(){o.timer=setInterval(function(){o.scrollUp()},o.timespan)}).mouseout()}})}(jQuery),e.goBack=function(){l.goBack()},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?g.open(r.getHead()+"mstore/sg/helpDetail.html?id=1034","活动规则").addEventListener("exit",function(e){}):m.go("helpDetail",{helpId:"1034",content:"活动规则"})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},e.isShowShare=function(){if(e.isShowForm=!1,v<e.information.partNum)p.showAlert("分享","每人默认1次抽奖机会，机会用完才可以分享助力哦！");else if(window.cordova){if(!u.getUser().mid)return void m.go("login");e.showShare=!0}else p.showAlert("只能在app分享","抱歉，只能在app分享")},e.chanceShare=function(e){1==e?S="WX":2==e?S="PYQ":3==e?S="QQ":4==e?S="QQKJ":5==e?S="FZLJ":0==e&&(S="WB")},e.shareToPlatform=function(t){e.chanceShare(t);var o=e.information.gameTitle,s="助力可以获得更多的抽奖机会，帮他助个力吧！",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=r.getShareLinkHeader()+"helpStaff/"+e.memberId+"/"+e.gameId+"/"+S;window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,null):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,null):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,null):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,null),n.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,null),n.qqShare()),5==t?e.copeText(a):n.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.hideblackCover=function(){e.showShare=!1},e.initWinningList=function(){t.winningList(e.gameId).success(function(t,o,s,i){1==t.success?t.data&&(e.prizeLists=t.data):t.message&&p.showToast(t.message)})},e.initInformation=function(){t.gameInformation(e.gameId).success(function(t,o,s,i){1==t.success?(e.picLists=t.data.gameImgVos,e.information=t.data,e.surplusChance=t.data.surplusChance,v=t.data.playTimes):t.message&&p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(t){e.showShare=!1,e.memberId=u.getUser().mid,e.gameId=d.anAuspiciousId,e.isShowForm=!1,e.initInformation(),e.initWinningList(),h()}),e.$on("$ionicView.enter",function(e){$(".record_list").RollTitle({line:1,speed:3e3,timespan:600})}),e.$on("$ionicView.beforeLeave",function(){f.cancel(P)})}]),APP.service("anAuspiciousStartService",["$http","UrlService",function(e,t){this.winningList=function(o){var s={gameId:o,noLoading:!0};return e.get(t.getGameUrl("WINNING_LIST"),s)},this.drawPrize=function(o){var s={gameId:o,timeStamp:(new Date).getTime()};return e.get(t.getGameUrl("LOTTERY"),s)},this.gameInformation=function(o){var s={gameId:o};return e.get(t.getGameUrl("GAME_INFORMATION"),s)}}]),APP.controller("HomeController",["$scope","HomeService","H5LocationService",function(e,t,o){e.mine="test mine angularJS",e.fangfa=function(e){o.getLocation(function(e){})},t.doInit().success(function(e,t,o,s){})}]),APP.service("HomeService",["$http","UrlService",function(e,t){this.doInit=function(o,s){var i={userName:o,password:s};return e.get(t.getUrl("HOME_INIT"),i)}}]),APP.controller("TestController",["$scope",function(e){}]),APP.controller("InvoiceSetupController",["$scope","$state","$stateParams","$rootScope","$ionicScrollDelegate","InvoiceService","$ionicPopup","$ionicHistory","$ionicModal","PopupService","ADDADDRESSService","CommonAddressService","$http","$ionicPlatform",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.htmlContent=o.content,e.enterPage=o.enterPage,e.title=o.title,e.invoiceModel={},e.addressback="",e.normalInvoiceType=1,e.normalInvoice={TaxpayerNumber:""};var m="",f={invoiceHead:"",TaxpayerNumber:""};e.faPiao={faPiaoTaiTou:"",gongSiMingCheng:"",shiBieHao:"",zhuCeDiZhi:"",zhuCeDianHua:"",kaiHuYinHang:"",kaiHuZhangHao:""},e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.receipt={consignee:"",address:"",zipcode:"",mobile:""},e.isChoose=void 0,e.invoiceType,e.whichActive,e.init=function(){e.addressRegionName="邮寄地址所在地区:",e.addressStreet="街道:",e.invoiceType=o.invoiceType,e.htmlContent=o.content,e.title=o.title,a.loadData().success(function(t,o,s,i){t.success&&(e.faPiao.gongSiMingCheng=t.data.bc,"2"==e.invoiceType?e.normalInvoice.TaxpayerNumber=t.data.tpn:"1"==e.invoiceType&&(e.faPiao.shiBieHao=t.data.tpn),m=t.data.nit,f={invoiceHead:t.data.iti,TaxpayerNumber:t.data.tpn},e.faPiao.faPiaoTaiTou=t.data.iti,e.normalInvoiceType=t.data.nit,e.faPiao.zhuCeDiZhi=t.data.rga,e.faPiao.zhuCeDianHua=t.data.rgp,e.faPiao.kaiHuYinHang=t.data.bn,e.faPiao.kaiHuZhangHao=t.data.cbn,e.addressRegionName=t.data.rca?t.data.rca.substring(0,t.data.rca.indexOf(",")):"邮寄地址所在地区:",e.addressStreet=t.data.rca?t.data.rca.substring(t.data.rca.indexOf(",")+1,t.data.rca.lastIndexOf(",")):"街道:",e.receipt.address=t.data.rca?t.data.rca.substring(t.data.rca.lastIndexOf(",")+1):"",e.receipt.consignee=t.data.rcc,e.receipt.zipcode=t.data.rcz,e.receipt.mobile=t.data.rcm)}),a.loadList().success(function(t,o,s,i){t.success&&(e.invoiceList=t.data,0==e.invoiceList.length?e.isChoose=!1:e.isChoose=!0)})},e.StreetTop=function(){e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="","邮寄地址所在地区:"!=e.addressRegionName?e.addressModalStreet.show():(l.showToast("请选择所在地"),e.addressStreet="街道:")},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,s,a){if(e.addressTipFlag=!1,i.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=a,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1)}else e.finish=!1,e.dataAdd="",d.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1},e.goSelectStreet=ionic.Utils.debounce(function(t,o){e.level=e.level-1,e.addressStreet=o.text,e.streetMsg=o.text,e.isChangeOrDefault=3,e.isDef=!0,e.addChangeAddress.regionName=e.addChangeAddress.pca+" "+e.addressStreet,e.addChangeAddress.streetId=o.value,e.positionAddress.streetId=o.value,e.positionAddress.regionName=e.positionAddress.pca+" "+e.addressStreet,e.addressModalStreet.hide(),"街道"==e.addressStreet?e.streetTextColor="color-text-s":e.streetTextColor="color-text-l"});var h=!1;e.goSelect=ionic.Utils.debounce(function(t,o){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.nowLevelIndex[e.nowLevel]=t;var o=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.hasChangeArr=e.defaultValue,e.level>-2)-1==e.level&&(e.selectProvince=o.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=i.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){1==ah&&(areaValueCity=o.value),e.dataAdd=t.data,e.addressTipFlag=!1;var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",d.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,i.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})};else if(e.level>-4&&-3!=e.level)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,e.selectArea=o.text,e.addressStreet="街道",e.textColor="color-text-l",e.cityTop=i.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=o.value);var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.level=e.levelArea,d.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),i.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else if(-3==e.level)e.addressModal.hide(),e.regionTrue=!0,e.isChangeOrDefault=4,e.streetTextColor="color-text-s",e.streetTrue=!0,e.panGoOn=!0,e.panOrgoOn=!0,e.textOne=e.defaultValue["text-1"],e.textTwo=e.defaultValue["text-2"],e.textThree=e.defaultValue["text-3"],e.address.provinceId=e.defaultValue["value-1"],e.address.cityId=e.defaultValue["value-2"],e.address.areaId=e.defaultValue["value-3"],e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addressRegionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addChangeAddress={provinceId:e.defaultValue["value-1"],cityId:e.defaultValue["value-2"],areaId:e.defaultValue["value-3"],streetId:0,pca:e.textOne+" "+e.textTwo+" "+e.textThree,regionName:""},e.selectArea=o.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=i.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,d.getLocationList(o.value,ah).success(function(t){e.dataAddStreet=t.data,2==ah&&(areaValue=o.value);var s=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(s,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1;else{if(h)return;$timeout(function(){h=!1},1500),s.$broadcast(e.flag,e.defaultValue),h=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){addressMessage=p.getAddressInfo();var t=addressMessage.regionName+"/"+addressMessage.streetName;d.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,t,addressMessage.streetId).success(function(){var t={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};d.getLocationList(addressMessage.areaId,3).success(function(t){e.dataAddStreet=t.data;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.positionAddress={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:0,pca:addressMessage.provinceName+" "+addressMessage.cityName+" "+addressMessage.regionName,regionName:""},e.isPosition=!0,s.$broadcast(e.flag,t),e.streetTextColor="color-text-s",e.addressModal.hide(),e.addressRegionName=e.positionAddress.pca,e.addressStreet="街道:"})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),c.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModalStreet=t}),e.closeAddressModal=function(){e.addressModal.hide(),e.addressModalStreet.hide()},e.preservation=function(){e.positionCommonFun=function(){e.address.provinceId=e.positionAddress.provinceId,e.address.cityId=e.positionAddress.cityId,e.address.areaId=e.positionAddress.areaId,e.address.streetId=e.positionAddress.streetId,e.address.regionName=e.positionAddress.regionName},e.isPosition&&e.positionCommonFun(),d.doInit(e.address).success(function(t,o,i,a){1==t.success&&(e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.addressRegionName="",s.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},s.addressStr=void 0,e.isChangeOrDefault=0,e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.panGoOn=!1,e.fromOrder?e.$ionicGoBack(-2):e.$ionicGoBack())})},e.chooseNormalType=function(t){t!=e.normalInvoiceType&&(e.normalInvoiceType=t,e.normalInvoiceType!=m?(e.faPiao.faPiaoTaiTou="",e.normalInvoice.TaxpayerNumber=""):(e.faPiao.faPiaoTaiTou=f.invoiceHead,e.normalInvoice.TaxpayerNumber=f.TaxpayerNumber))},e.dzClick=function(){e.faPiao.shiBieHao="",e.whichActive=0,e.invoiceType="2"},e.zzClick=function(){e.faPiao.shiBieHao="",e.whichActive=1,e.invoiceType="1"},e.dianZiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.faPiaoTaiTou)?2==e.normalInvoiceType?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.normalInvoice.TaxpayerNumber)?(e.errMessage="",e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):(e.errMessage="识别号为15位或18位或20位的数字或字母",i.scrollTop([shouldAnimate=!0])):(e.errMessage=null,e.normalInvoice.TaxpayerNumber="",e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):e.errMessage="发票抬头必填,且不能包含特殊字符"},e.naShuiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.gongSiMingCheng)&&e.faPiao.gongSiMingCheng?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.faPiao.shiBieHao)?/^.[^&<>]{4,}$/.test(e.faPiao.zhuCeDiZhi)&&e.faPiao.zhuCeDiZhi?e.faPiao.zhuCeDianHua&&e.faPiao.zhuCeDianHua.length<8||!e.faPiao.zhuCeDianHua?(e.errMessage="注册电话格式：0532-12345678",i.scrollTop([shouldAnimate=!0])):e.faPiao.kaiHuYinHang?e.faPiao.kaiHuZhangHao?"邮寄地址所在地区:"!=e.addressRegionName||"街道:"!=e.addressStreet&&"街道"!=e.addressStreet||e.receipt.address?"邮寄地址所在地区:"==e.addressRegionName?(e.errMessage="请选择所在地区",i.scrollTop([shouldAnimate=!0])):"街道:"==e.addressStreet||"街道"==e.addressStreet?(e.errMessage="请选择所在街道",i.scrollTop([shouldAnimate=!0])):e.receipt.address?(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="请填写详细地址",i.scrollTop([shouldAnimate=!0])):(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit(e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="开户账号为必填",i.scrollTop([shouldAnimate=!0])):(e.errMessage="开户银行为必填",i.scrollTop([shouldAnimate=!0])):(e.errMessage="注册地址至少5个字符，且不能包含特殊字符",i.scrollTop([shouldAnimate=!0])):(e.errMessage="识别号为15位或18位或20位的数字或字母",i.scrollTop([shouldAnimate=!0])):(e.errMessage="公司名称必填,且不能包含特殊字符",i.scrollTop([shouldAnimate=!0]))},e.toSubmit=function(t,o,i,n,c,l,d,p,u,g,m,f,h){0==e.enterPage?a.submitInvoice(t,i,o,n,c,l,d,p,u,g,m,f,h).success(function(e,t,o,i){e.success&&(s.isInvoice=!0,r.goBack())}):1==e.enterPage&&a.submitInvoiceSeckill(payment,t,o,i,n,c,l,d,p,u,g,m,f,h).success(function(e,t,o,s){e.success&&r.goBack()})},e.popMessage=function(){n.alert({templateUrl:"http://www.ehaier.com/mstatic/test/wd/activity/invoiceRule.html",cssClass:""})},e.choose=function(){t.go("invoiceList")},c.fromTemplateUrl("templates/invoice/InvoiceList.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show(),a.loadList().success(function(t,o,s,i){t.success&&(e.invoiceList=t.data)})},e.closeModal=function(){e.modal.hide()},e.listClick=function(t){e.closeModal(),a.loadList().success(function(o,s,i,a){o.success&&(e.invoiceList=o.data,e.faPiao.gongSiMingCheng=e.invoiceList[t].invoiceTitle,e.faPiao.shiBieHao=e.invoiceList[t].taxPayerNumber,e.faPiao.zhuCeDiZhi=e.invoiceList[t].registerAddress,e.faPiao.zhuCeDianHua=e.invoiceList[t].registerPhone,e.faPiao.kaiHuYinHang=e.invoiceList[t].bankName,e.faPiao.kaiHuZhangHao=e.invoiceList[t].bankCardNumber)})},e.note=function(){
l.showAlert("",'<div style="text-align:left;color:#666;">普通发票分为电子发票与纸质发票两种，以实际开票为准，不支持更换选择，订单确认后可在订单详情-发票信息模块查看具体信息；<br><br>电子发票是经过国家税务局机关认可的有效凭证,同样具有保修与财务报销的效力。相关内容您可以咨询海尔商城在线客服,或拨打海尔商城服务热线4006 999 999,同时您也可以拨打税务热线12366进行咨询。电子发票相关政策您还可以查看《青岛市国家税务局电子发票管理办法（试行）》,或登录青岛市电子发票服务平台www.chinaeinv.com查询。<br><br>纸质发票是由顺逛官方授权店进行开具。<br><br>增值税专用发票需自行选择，并详细填写公司名称、税号、地址、电话、开户银行和帐号，并注意所填的内容须与纳税信息一致。<br>另外需提供一般纳税人认证资料（营业执照副本、税务登记证副本、一般纳税人资格证书、银行开户许可证复印件）及顺逛订单号发送邮件至fapiao@ehaier.com，我们会根据您提供的资料进行资质审核，审核无误后将在订单完成关闭1-2周左右的时间为您开具发票并安排邮寄。</div>')},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("InvoiceService",["$http","UrlService",function(e,t){this.loadData=function(){return e({method:"POST",url:t.getUrl("ORDER_INVOICE")})},this.loadList=function(o){return o={},e.get(t.getUrl("ORDER_INVOICE_LIST"),o)},this.submitInvoice=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={it:o,bc:s,iti:i,tpn:a,rga:n,rgp:r,bn:c,cbn:l,rcc:d,rca:p,rcz:u,rcm:g,nit:m};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE"),data:f})},this.submitInvoiceSeckill=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={payment:o,invoiceType:s,billCompany:i,invoiceTitle:a,taxPayerNumber:n,registerAddress:r,registerPhone:c,bankName:l,bankCardNumber:d,receiptConsignee:p,receiptAddress:u,receiptZipcode:g,receiptMobile:m};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE_SECKILL"),params:f})},this.pageSubmit=function(){var o={isFromInvoices:1};return e.get(t.getUrl("CONFIRM_ORDER"),o)}}]),APP.controller("ListOfSpecialtyGoodsController",["CartService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","ListOfSpecialtyGoodsControllerService","LoginService","HomePageService","CreditService","BannerThemeService","CommonAddressService",function(CartService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,localSpecialtyHomePageService,ListOfSpecialtyGoodsControllerService,LoginService,HomePageService,CreditService,BannerThemeService,CommonAddressService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",$scope.priceArr=[],$scope.showShare=!1,$scope.canLoadMore=!0,$scope.chooseIndex=3,$scope.switch=!0,$scope.filterData="",$scope.qs="saleDesc",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.pageIndex=1,$scope.midCommList=[],$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.arrowState=[$rootScope.imgBaseURL+"img/ic_sort_state_0.png",$rootScope.imgBaseURL+"img/ic_sort_state_1.png",$rootScope.imgBaseURL+"img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/ic_screen_state_0.png",$rootScope.imgBaseURL+"img/ic_screen_state_1.png"],$scope.filter_index=0,$scope.iSDataLeftRight=!1,$scope.isListNull=!1,$scope.leftDataListIndex=1,$scope.leftDataList=[{navigationName:"全部",id:""}],$scope.rightDataList=[],$scope.listModal=null,$ionicModal.fromTemplateUrl("templates/localSpecialty/specialClassificationSelection.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.listModal=e}),$scope.closeListModal=function(){$scope.listModal.hide(),$scope.leftDataList=[{navigationName:"全部",id:""}]},$scope.getQueryString=function(e,t){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=t.substr(0).match(o);return null!=s?s[2]:""},$scope.backToList=function(e){$scope.midCommList=[],$scope.priceArr=[];var t=$scope.getQueryString("productCateId",e.url),o=$scope.getQueryString("brandId",e.url);""!=o?$scope.filterData="hasStock@"+o+"@0":$scope.qs="saleDesc",$scope.filter_index=0,$scope.chooseIndex=3,$scope.title=e.navigationName,$scope.productCateId=t,$scope.listModal.hide(),$scope.getListData(),$ionicScrollDelegate.scrollTop()};var parentId="0";$scope.getList=function(){ListOfSpecialtyGoodsControllerService.getLeftList($scope.pageId).success(function(e){if(e.success&&e.data.length>0){$scope.leftDataList=[{navigationName:"全部",id:""}];for(var t=0;t<e.data.length;t++)$scope.leftDataList.push(e.data[t]);parentId=e.data[0].id,ListOfSpecialtyGoodsControllerService.getRightList($scope.leftDataList[$scope.leftDataListIndex].id,$scope.pageId).success(function(e){if(e.success){0==e.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var t=[],o=[],s=0;s<e.data.length;s++)e.data[s].parentId==parentId&&2==e.data[s].levels?(e.data[s].children=[],t.push(e.data[s])):1==e.data[s].levels&&o.push(e.data[s]);for(var s=0;s<e.data.length;s++)for(var i=0;i<t.length;i++)e.data[s].parentId==t[i].id&&t[i].children.push(e.data[s]);$scope.rightDataList=t,$scope.slideImage=o,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()})}else $scope.iSDataLeftRight=!0})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.selectTab=function(e,t){if(parentId=e,0==t)return $scope.productCateId=0,$scope.title="全部商品",$scope.listModal.hide(),$scope.commission_index=0,$scope.price_index=0,void $scope.chooseTab(3);t!=$scope.leftDataListIndex&&($scope.leftDataListIndex=t,ListOfSpecialtyGoodsControllerService.getRightList(e,$scope.pageId).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],s=[],i=0;i<t.data.length;i++)t.data[i].parentId==e&&2==t.data[i].levels?(t.data[i].children=[],o.push(t.data[i])):1==t.data[i].levels&&s.push(t.data[i]);for(var i=0;i<t.data.length;i++)for(var a=0;a<o.length;a++)t.data[i].parentId==o[a].id&&"1"!=t.data[i].levels&&o[a].children.push(t.data[i]);$scope.rightDataList=o,$scope.slideImage=s,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}))},$scope.bannerClick=function(e){$scope.listModal.hide();var t=e.bannerId,o=e.url,s=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.memberId});break;case 2:if(o){var a=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:a,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var n=o.split("=")[1];$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"});var provinceId,cityId,districtId,streetId;$scope.$on("$ionicView.beforeEnter",function(event,data){if("back"==data.direction)return $scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),void GetSwitchChecked();$scope.title="全部商品",$scope.chooseIndex=3,$scope.commission_index=0,$scope.filter_index=0,$scope.price_index=0,$scope.pageId=$stateParams.pageId,$scope.productCateId=$stateParams.productCateId,$scope.qs="saleDesc",ListOfSpecialtyGoodsControllerService.getPositionId().success(function(res){if(res.success){var data=eval(res.data)[0];if(provinceId=data.provinceId,cityId=data.cityId,districtId=data.areaId,streetId=data.streetId,void 0!=provinceId&&void 0!=cityId&&void 0!=districtId&&void 0!=streetId)$scope.getListData();else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),GetSwitchChecked()}),$scope.settingsList="",$scope.getListData=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.$on("$ionicView.beforeLeave",function(){$scope.resetFilter(),$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"}),$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!0}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$scope.goClassification=function(){$scope.pageIndex=1,$scope.listModal.show(),$scope.getList(),$scope.leftDataListIndex=1},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),2==e){null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show();var t={productCateId:$scope.productCateId};$scope.getFilterDataLists(t)}else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==o?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var s=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==s?"price":"priceDesc"}$scope.pageIndex=1,$scope.canLoadMore=!1,$scope.ResGetList()}},$scope.ResGetList=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.getFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(e.data.brandList[t].id)>-1?t>0&&(e.data.brandList[t].active="true"):e.data.brandList[t].active="false":e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if(null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.loadMore=function(){$scope.pageIndex++,ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId,$scope.qs).success(function(e){if(e.success){for(var t=0;t<e.data.productList.length;t++)$scope.midCommList.push(e.data.productList[t]);e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0;o<t.products.length;o++)$scope.priceArr.push(t.products[o]);e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,$scope.$broadcast("scroll.infiniteScrollComplete")})}})},$scope.goBack=function(){$scope.pageIndex=1,$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMoreActive.png")},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!1},$scope.toShare=function(){return $scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",window.cordova?UserService.isUserLogin()?($scope.showShare=!0,void(window.device&&($scope.shareToPlatform(),$scope.showShare=!$scope.showShare))):void $state.go("login"):void $scope.showPopup("请下载APP执行此操作")},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t=$localstorage.get("storeId",$rootScope.globalConstant.storeId),o="顺逛•特产惠 汇集全国优质特产",s="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",i=$scope.shareImgUrl,a=UrlService.getShareLinkHeader()+"ListOfSpecialtyGoods/"+$scope.productCateId+"/"+$scope.pageId+"/"+t,n={},r=function(e){CreditService.shareSuccessCallback(e,n)};window.umeng?(0==e?window.umeng.shareToSina(o,s,i,a,0,null,r):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,r):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,r):3==e?(window.umeng.shareToQQ(o,s,i,a,0,null,r),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(o,s,i,a,0,null,r),CreditService.qqShare()),5==e?$scope.copeText(a):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("ListOfSpecialtyGoodsControllerService",["$http","UrlService","UserService",function(e,t,o){this.getProductsList=function(s,i,a,n,r,c,l,d,p){var u=o.getUser().mid||"20219251",g={storeMemberId:u,pageIndex:s,pageSize:10,filterData:i,qs:p,productCateId:a,provinceId:n,cityId:r,districtId:c,streetId:l,pageId:d,noLoading:"true"};return e.get(t.getUrl("SPECIALY_PRODUCTS_LIST"),g)},this.getAsyncPrice=function(o){var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})},this.getFilterData=function(o){return e.get(t.getUrl("GET_FILTER_DATA"),o)},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getLeftList=function(o){var s={module:2,parentId:0,regionId:o};return e.get(t.getZCUrl("GETNAVIGATIONS"),s)},this.getRightList=function(o,s){var i={module:2,parentId:o,regionId:s};return e.get(t.getZCUrl("GETNAVIGATIONS"),i)}}]),APP.controller("localSpecialtyHomePageController",["CommonAddressService","$ionicLoading","CreditService","CartService","newsendService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","BannerThemeService","PopupService","localSpecialtyHomePageService","HomePageService",function(CommonAddressService,$ionicLoading,CreditService,CartService,newsendService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,BannerThemeService,PopupService,localSpecialtyHomePageService,HomePageService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function mainRes(e){localSpecialtyHomePageService.getMaster(e).success(function(e){e.success&&(null!=e.data.topBannerList&&null!=e.data.topBannerList.bannerList?($scope.arrList.bannerList=e.data.topBannerList.bannerList,$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").update(),$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").loop(!0)):$scope.arrList.bannerList=[],null!=e.data.regionList&&null!=e.data.regionList.regionList&&(e.data.regionList.regionList.length>3?$scope.arrList.navList=e.data.regionList.regionList.slice(0,3):$scope.arrList.navList=e.data.regionList.regionList),null!=e.data.drinkList&&(null!=e.data.drinkList.bannerList||null!=e.data.drinkList.topBanner?($scope.isDrinkList=!0,$scope.arrList.specialtyListDrink=e.data.drinkList,$scope.drinkList=e.data.drinkList.bannerList):($scope.isDrinkList=!1,$scope.arrList.specialtyListDrink=[],$scope.drinkList=[])),null!=e.data.foodList&&(null!=e.data.foodList.productList||null!=e.data.foodList.topBanner?($scope.isFoodList=!0,$scope.arrList.specialtyListFood=e.data.foodList,$scope.foodList=e.data.foodList.productList):($scope.isFoodList=!1,$scope.arrList.specialtyListFood=[],$scope.foodList=[])),null!=e.data.communityList&&null!=e.data.communityList.bannerList?$scope.arrList.midCommList=e.data.communityList:$scope.arrList.midCommList=null)})}function countTimeNew(e,t,o){$scope.endT[o]=t-e,newTime[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=checkTime($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&$interval.cancel(newTime[o])},1e3)}function checkTime(e){return e<10&&(e="0"+e),e}function limitCountTimes(e){var t=checkTime(parseInt(e%864e5/36e5)),o=checkTime(parseInt(e%36e5/6e4)),s=checkTime(Math.floor(e%6e4/1e3));$scope.moreCountTime={hours:t,minutes:o,seconds:s}}$scope.allSpecialtyArr=[],$scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.crowdFundingList=!1,$scope.selectedIndex=0,$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png",$scope.showShare=!1,$scope.localSelect=0,$scope.isTimeOver=!1,$scope.flashHour="",$scope.textTime="",$scope.drinkList=[],$scope.foodList=[],$scope.isDrinkList=!1,$scope.isFoodList=!1,$scope.Timetotal=[],$scope.youLikeTypeArr=[],$scope.youLikeDataArr=[],$scope.cateId=0,$scope.dealPrice=CalculateStrLength.dealPrice,$scope.newAndlimit={flashProductList:[],newSendList:[]},$scope.arrList={bannerList:[],navList:[],specialtyListDrink:[],specialtyListFood:[],touristsList:[],midCommList:[]},$scope.addressMsg={provinceId:"",cityId:"",areaId:"",streetId:""},$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[];var newTime=[],addressMessage,remindArray=[],countDownNowTime=[],countDownendTime=[],nowT=(new Date).getTime(),timerLength="";$scope.flashTime="",$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.preheatingTime=0,$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.settingsList="",$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"}),$scope.init=function(){$scope.cartTotalNum=0,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.getAddress(),$scope.crowdFundingMsg(2),$scope.youLikeType(),$scope.getUserMsg(),$scope.getCartNum()},$scope.getUserMsg=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.newProductAndTimeLimit=function(e,t,o,s){localSpecialtyHomePageService.getNewAndLimit(e,t,o,s).success(function(e){if(e.success)if(null!=e.data)if($scope.isWd=e.data.isWd,null==e.data.flash?$scope.showFlashSale=!1:($scope.newAndlimit.flashProductList=e.data.flash.flashProductList,$scope.flashTime=e.data.flash.flashTime,$scope.preheatingTime=e.data.flash.preheatingTime,$scope.timeCount={startTime:e.data.flash.startTime,endTime:e.data.flash.endTime,systemTime:e.data.flash.systemTime},$scope.flashTime&&($scope.flashHour=$scope.flashTime.slice(11,16)+"场"),0==$scope.newAndlimit.flashProductList.length||$scope.timeCount.systemTime-new Date($scope.newAndlimit.flashProductList[0].endTime).getTime()>-1e3||$scope.timeCount.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.timeCount.systemTime-$scope.timeCount.startTime>-1e3?($scope.timer=$interval(function(){$scope.timeCount.endTime-$scope.timeCount.systemTime<1e3&&($interval.cancel($scope.timer),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)),limitCountTimes($scope.timeCount.endTime-$scope.timeCount.systemTime),$scope.timeCount.systemTime+=1e3},1e3),$timeout(function(){$scope.textTime="结束"},1e3)):($scope.timer1=$interval(function(){$scope.timeCount.startTime-$scope.timeCount.systemTime<1e3&&($interval.cancel($scope.timer1),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)),limitCountTimes($scope.timeCount.startTime-$scope.timeCount.systemTime),$scope.timeCount.systemTime+=1e3},1e3),$timeout(function(){$scope.textTime="开始"},1e3)))),null!=e.data.reverse)if(timerLength=remindArray.length,$scope.newAndlimit.newSendList=e.data.reverse.acReserveList,$scope.newAndlimitLength=e.data.reverse.acReserveList.length,0==$scope.newAndlimit.newSendList.length||$scope.newAndlimit.newSendList==[])$scope.showReserveList=!1;else{$scope.showReserveList=!0;for(var t=0;t<$scope.newAndlimit.newSendList.length;t++)remindArray.push(t),countDownNowTime[t]=parseInt(nowT/1e3),countDownendTime[t]=parseInt($scope.newAndlimit.newSendList[t].reserveEndTime/1e3);for(var o=timerLength;o<remindArray.length;o++)countTimeNew(countDownNowTime[remindArray[o]],countDownendTime[remindArray[o]],remindArray[o])}else $scope.showReserveList=!1;else $scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"};else $scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"}})},$scope.crowdFundingMsg=function(e){newsendService.getcrowold(e).success(function(e){e.success&&(0!=e.data.zActivitySuccessList.length||0!=e.data.zActivityBeginningList.length||0!=e.data.zActivityToBeginList.length)?($scope.crowdFundingList=!0,$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList):($scope.crowdFundingList=!1,$scope.zcold=[],$scope.zcnow=[],$scope.zcpre=[])})},$scope.youLikeType=function(){localSpecialtyHomePageService.getSpecialtyLikeType(3).success(function(e){e.success&&0!=e.data.length?($scope.youLikeTypeArr=e.data,0==$scope.selectedIndex&&($scope.cateId=e.data[0].cId)):$scope.youLikeTypeArr=[]})},$scope.youLikeDataList=function(e,t,o,s,i,a){localSpecialtyHomePageService.getSpecialtyLikeDta(e,t,o,s,i,a).success(function(e){
e.success&&null!=e.data?$scope.youLikeDataArr=e.data:$scope.youLikeDataArr=[]})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId,shareStoreId:$rootScope.shareId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId,shareStoreId:$rootScope.shareId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goBack=function(){for(var e=0;e<=remindArray.length;e++)$interval.cancel(newTime[remindArray[e]]);remindArray=[],$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg="img/ic_lookMoreActive.png")},$scope.toShare=function(){if(window.cordova){if(!UserService.isUserLogin())return void $state.go("login");$scope.showShare=!0}else PopupService.showToast("请下载APP执行此操作")},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t="顺逛·特产汇 汇集全国优质特产",o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的带来",s="http://cdn09.ehaier.com/shunguang/H5/www/img/specialty_share_pic.png",i=UrlService.getShareLinkHeader()+"localSpecialtyHomePage/"+$scope.storeId,a=function(){CreditService.shareSuccessCallback()};window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,a):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,a):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,a):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,a),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,a),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.cancelShare=function(){$scope.showShare=!1,$scope.isDisplay=!1},$scope.goToSpecialtyVenue=function(e,t){$scope.localSelect=e,$scope.moreSpecialtyModal.hide(),$timeout(function(){$state.go("SpecialtyVenueHome",{regionId:t,streetId:$scope.addressMsg.streetId})},600)},$scope.moreSelectSpecialty=function(){$scope.moreSpecialtyModal.show(),localSpecialtyHomePageService.getAllMsg().success(function(e){e.success&&($scope.allSpecialtyArr=e.data)})},$scope.closeMoreSpecialty=function(){$scope.moreSpecialtyModal.hide()},$scope.getAddressInit=function(){mainRes($scope.addressMsg.streetId),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId),$timeout(function(){$scope.youLikeDataList(3,$scope.cateId,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},800)},$scope.getAddress=function(){localSpecialtyHomePageService.getPositionId().success(function(res){res.success?(addressMessage=eval(res.data)[0],void 0!=addressMessage.provinceId&&void 0!=addressMessage.cityId&&void 0!=addressMessage.areaId&&void 0!=addressMessage.streetId?($scope.addressMsg={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:addressMessage.streetId},$scope.getAddressInit()):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())}).error(function(){$scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit()})},$rootScope.$on("CACHE_SUCCESS",function(e,t){for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1);var s={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(s),$scope.getAddress()}),$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId,shareStoreId:$rootScope.shareId})},$ionicModal.fromTemplateUrl("templates/localSpecialty/moreSpecialtyModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.moreSpecialtyModal=e}),$scope.$on("$destroy",function(){$scope.moreSpecialtyModal.remove()}),$scope.goToClassify=function(e,t){$scope.selectedIndex=e,$scope.cateId=t,$scope.youLikeDataList(3,t,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},$scope.toGoSecialtyVenueHome=function(e){$state.go("SpecialtyVenueHome",{regionId:e,streetId:$scope.addressMsg.streetId})},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.isDisplay=!1;for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.$on("$ionicView.beforeEnter",function(e,t){$rootScope.shareId||($rootScope.shareId=$stateParams.storeId),$scope.isDisplay=!1,nowT=(new Date).getTime(),"back"==t.direction?($scope.getCartNum(),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)):($scope.init(),GetSwitchChecked(),$scope.showShare=!1,$scope.localSelect=0)})}]),APP.service("localSpecialtyHomePageService",["$http","UrlService",function(e,t){this.getAllMsg=function(){return e.get(t.getNewUrl("ALL_SPECIALTY"))},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getMaster=function(o){var s={streetId:o,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY"),s)},this.getNewAndLimit=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a,noLoading:!0};return e.get(t.getNewUrl("NEW_AND_LIMIT"),n)},this.getSpecialtyLikeType=function(o){var s={type:o};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_TYPE"),s)},this.getSpecialtyLikeDta=function(o,s,i,a,n,r){var c={type:o,cateId:s,pId:i,cId:a,rId:n,sId:r,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_DATA"),c)}}]),APP.controller("secondLevelStoreController",["UrlService","UserService","CreditService","PopupService","$stateParams","secondLevelStoreService","CartService","HomePageService","GoodsService","$q","$localstorage","$scope","$state","LoginService","$rootScope","$ionicModal","BranchTypeDetailService","$ionicScrollDelegate","$ionicHistory",function(UrlService,UserService,CreditService,PopupService,$stateParams,secondLevelStoreService,CartService,HomePageService,GoodsService,$q,$localstorage,$scope,$state,LoginService,$rootScope,$ionicModal,BranchTypeDetailService,$ionicScrollDelegate,$ionicHistory){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function sortById(e,t){return e.sort-t.sort}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function getProductList(){secondLevelStoreService.getSecondLevelProduct($scope.storeId,$scope.pageIndex,$scope.pageSize,$scope.filterData,$scope.productCateId,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.regionId,$scope.qs).success(function(e){if(e.success){if(e.data.productList){var t=e.data.productList;$scope.productList=$scope.productList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}6*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else $scope.productList=[],PopupService.showToast(e.message)})}window.cordova?$scope.isApp=!0:$scope.isApp=!1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.iosAppHeight={height:"64px",paddingTop:"20px"},$scope.iosAppPadding={paddingTop:"64px"}):($scope.iosAppHeight={height:"44px",paddingTop:"2px"},$scope.iosAppPadding={paddingTop:"44px"}),$scope.isBuyer=LoginService.getRole(),$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png",$scope.filterData="",$scope.productCateIdType="0",$scope.switch=!0,$scope.filter_index=0,$scope.pageIndex="1",$scope.pageSize="6",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.hasmore=!1,$scope.settingsList="",$scope.checkedIndex=0,$scope.tempList=[],$scope.productList=[],$scope.arrowState=["img/ic_sort_state_0.png","img/ic_sort_state_1.png","img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/ic_screen_state_0.png","img/ic_screen_state_1.png"],$scope.filter_index=0;var tabState=["",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.filterData="",$scope.chooseIndex=3,$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.qs="saleDesc",$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.showMoreInfo=function(){$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!$scope.showShare},$scope.goToShare=function(e){if(e.preventDefault(),e.stopPropagation(),!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.clickSecondLevel=function(e){$scope.checkedIndex=e,$scope.productCateId=$scope.secTypeList[e].cId,$scope.tempList=[],$scope.productList=[],$scope.pageIndex=1,$scope.pageSize=6,$scope.resetFilter(),$scope.filterData="",getProductList()},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.hideMoreDetail=function(){$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.shareToPlatform=function(e){var t=$scope.secTitle,o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的到来~",s=$scope.sPic,i=UrlService.getShareLinkHeader()+"secondLevelStore/"+$stateParams.cityId+"/"+$scope.storeId;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.customerServe=function(){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.openFilterModal();else{if($scope.page=2,1==e){$scope.chooseIndex=e;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.chooseIndex=e,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.chooseIndex=e;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList()}},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.init=function(){var e=$q.defer(),t=$q.defer(),o=$q.all([e.promise,t.promise]);$scope.tempList=[],$scope.productList=[],$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),$scope.cartTotalNum=0,$scope.filterParams="",$scope.regionId=$stateParams.cityId,$scope.pageIndex=1,$scope.pageSize=6,$scope.checkedIndex=0,$scope.chooseIndex=3,secondLevelStoreService.getSecTypeList($scope.regionId).success(function(t){t.success&&($scope.secTitle=t.data.pathName,$scope.sPic=t.data.sPic,$scope.secTypeList=JSON.parse(t.data.classify).sort(sortById),$scope.productCateId=$scope.secTypeList[0].cId,e.resolve())}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,$scope.page=1,t.resolve()}),o.then(function(){$scope.filterData="",getProductList()}),CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.loadMore=function(){$scope.pageIndex=$scope.pageIndex+1,getProductList()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.resetFilter(),$scope.hideMoreDetail()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0});$stateParams.shareId&&($rootScope.shareId=$stateParams.shareId),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.init()})}]),APP.service("secondLevelStoreService",["$http","UrlService",function(e,t){this.getSecondLevelProduct=function(o,s,i,a,n,r,c,l,d,p,u){var g={storeMemberId:o,pageIndex:s,pageSize:i,filterData:a,qs:u||"",productCateId:n,provinceId:r,cityId:c,districtId:l,streetId:d,pageId:p};return e.get(t.getUrl("SECONDLEVEL_PRODUCTLIST"),g)},this.getSecTypeList=function(o){var s={regionId:o};return e.get(t.getNewUrl("SECONDLEVEL_SECTYPELIST"),s)}}]),APP.controller("SpecialtyVenueHomeController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","specialtyVenueHomeControllerService","$ionicPopup","CartService","LoginService","HomePageService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,P,x,L,D,N){function _(){m.memberId=$.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==m.memberId&&(m.settingsList=e[t].list,!0)}m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png",m.pageTitle="",m.collects=0,m.topImgSrc="",m.topBanners=[],m.recommendations=[],m.communities=[],m.competitiveProducts=[],m.recommendProducts=[],m.hotProducts=[],m.cities=[],m.showShare=!1,m.shareImgUrl="",m.isCollected=0,m.dealPrice=p.dealPrice,m.regionId=f.regionId,m.streetId=f.streetId,m.storeId=i.get("storeId",I.globalConstant.storeId),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_1.png",m.isBuyer=parseInt(L.getRole()),m.flashProductList=[],m.midActivtyList=[],m.midCommList=[],m.getCollected=function(){return m.isCollected?"已收藏":"收藏"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(m.paddingtopClass={"margin-top":"16px"},m.paddingtopClasscontent={top:"64px"}):(m.paddingtopClass={"margin-top":"0px"},m.paddingtopClasscontent={top:"44px"}),m.$on("$ionicView.beforeEnter",function(e,t){if(f.shareId&&(I.shareId=f.shareId),"back"==t.direction)return m.getCartNum(),D.isWdHost().success(function(e){I.isWdHost=e.data.isHost}),void _();A.getAllProducts(m.regionId,m.streetId).success(function(e){e.success&&(m.topImgSrc=e.data.topImageUrl,m.shareImgUrl=e.data.simplePicUrl,m.cities=e.data.cities,m.topBanners=e.data.topBanners,m.isCollected=e.data.isCollected,m.isCollected&&(m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_0.png"),m.recommendations=e.data.recommendations,m.hotProducts=e.data.hotProducts,m.communities=e.data.communities,m.competitiveProducts=e.data.competitiveProducts,m.pageTitle=e.data.pageTitle,m.collects=e.data.collects,m.recommendProducts=e.data.recommendProducts,h.$getByHandle("sepcialty_top_banner").update(),h.$getByHandle("sepcialty_top_banner").loop(!0),h.$getByHandle("specialty_recommond_banner").update(),h.$getByHandle("specialty_recommond_banner").loop(!0),null!=m.hotProducts&&(m.hotProdcutTitle=m.hotProducts[0].moudleTitle),null!=m.recommendations&&(m.curatorOfRecommendedTitle=m.recommendations[0][0].moduleTitle),null!=m.competitiveProducts&&(m.boutiqueTitle=m.competitiveProducts[0].moudleTitle))}),m.getCartNum(),D.isWdHost().success(function(e){I.isWdHost=e.data.isHost}),_()}),m.settingsList="",m.getCartNum=function(){x.getNumber().success(function(e){e.success?m.cartTotalNum=e.data:m.cartTotalNum=0})},m.$on("$ionicView.beforeLeave",function(){m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"}),m.goBack=function(){t.goBack()},m.showPopup=function(e){var t=P.show({template:e});S(function(){t.close()},1e3)},m.collected=function(){m.isCollected?A.cancelCollect(m.regionId).success(function(e){e.success&&(m.isCollected=0,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)-1+""),m.showPopup("取消成功"),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_1.png")}):A.addCollect(m.regionId).success(function(e){e.success&&(m.isCollected=1,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)+1+""),m.collectImgSrc=I.imgBaseURL+"img/ic_shoucang_0.png",m.showPopup("收藏成功"))})},m.goToListOfSpecialtyGoods=function(){v.go("ListOfSpecialtyGoods",{pageId:m.regionId,productCateId:0})},m.showMenu=function(){m.isDisplay?(m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"):(m.isDisplay=!0,m.menuImg=I.imgBaseURL+"img/ic_lookMoreActive.png")},m.hideMenu=function(){m.isDisplay=!1,m.menuImg=I.imgBaseURL+"img/ic_lookMore.png"},m.cancelShare=function(){m.showShare=!1},m.goSecondLevelStore=function(e){v.go("secondLevelStore",{cityId:e})},m.goProductDetail=function(){v.go("")},m.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:T.getBannerTheme(o).success(function(e){v.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:v.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:m.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);v.go("couponsDetail",{cId:a,userID:m.storeId,type:2})}else v.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);v.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?T.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){v.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&v.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:v.go("crowdFunding");break;case 7:t?v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:m.storeId}):v.go("newSend");break;case 8:t?v.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):v.go("topic.qhot")}},m.toShare=function(){return m.isDisplay=!1,window.cordova?(m.menuImg=I.imgBaseURL+"img/ic_lookMore.png",$.isUserLogin()?(m.showShare=!0,void(window.device&&(m.shareToPlatform(),m.showShare=!m.showShare))):void v.go("login")):void m.showPopup("请下载APP执行此操作")},m.toHomePage=function(){m.isDisplay=!1,v.go("homePage")},m.contactCustomer=function(){if(m.isDisplay=!1,$.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+i.get("sg_login_token_secret").substring(6),"_blank","location=no")}else v.go("login")},m.shareToPlatform=function(e){if(!$.getUser().mid)return void v.go("login");var t=i.get("storeId",I.globalConstant.storeId),s=m.pageTitle,a="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",n=m.shareImgUrl,r=o.getShareLinkHeader()+"SpecialtyVenueHome/"+m.regionId+"/"+m.streetId+"/"+t,c={},l=function(e){N.shareSuccessCallback(e,c)};window.umeng?(0==e?window.umeng.shareToSina(s,a,n,r,0,null,l):1==e?window.umeng.shareToWechatSession(s,a,n,r,0,null,l):2==e?window.umeng.shareToWechatTimeline(s,a,n,r,0,null,l):3==e?(window.umeng.shareToQQ(s,a,n,r,0,null,l),N.qqShare()):4==e&&(window.umeng.shareToQzone(s,a,n,r,0,null,l),N.qqShare()),5==e?m.copeText(r):N.successShare()):alert("umeng undefined 只能在app分享"),m.showShare=!1},m.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),C.showToastShort("复制成功"),m.isShowCopyButton=!1):C.showToast("请下载APP执行此操作")}}]),APP.service("specialtyVenueHomeControllerService",["$http","UrlService",function(e,t){this.getAllProducts=function(o,s){var i={regionId:o,streetId:s};return e.get(t.getZCUrl("SPECIALY_VENUE_HOME"),i)},this.addCollect=function(o){var s={type:2,collectId:o};return e.get(t.getZCUrl("ADD_COLLECT"),s)},this.cancelCollect=function(o){var s={type:2,collectId:o};return e.get(t.getZCUrl("CANCEL_COLLECT"),s)}}]),APP.controller("AdvertisementController",["$scope","$rootScope","$timeout","$state","$interval","$stateParams","AdvertisementService","PopupService",function(e,t,o,s,i,a,n,r){function c(){var t=window.localStorage.getItem("hasAD");"noAD"!=t?(e.imgUrl=t,l=i(function(){e.second<=1?e.skipAd():e.second--},1e3)):s.go(d)}var l,d=a.from;e.imgUrl="",e.second=9,e.skipAd=function(){i.cancel(l),s.go(d)},e.$on("$ionicView.beforeEnter",function(){d=a.from,e.second=9,c()})}]),APP.service("AdvertisementService",["$http","UrlService",function(e,t){this.getAdImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_AD_IMAGE"),o)}}]),APP.controller("DirectPurchaseController",["$scope","UserService","AccountMessageService","$state","LoginService","RegisterService","PopupService","$ionicPopup",function(e,t,o,s,i,a,n,r){e.topPlus={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topPlus={"padding-top":"42px"}),e.init=function(){var o=t.getUser();e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.userLogOut=function(){e.sessionId?o.unloadAccount(e.token,e.sessionId,e.header).success(function(e,o,a,n){if(e.success){t.clearUser(),i.setRole(void 0),s.go("guidePage");var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r)}}):(t.clearUser(),i.setRole(void 0),s.go("guidePage"))},e.goToDelete=function(){r.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.userLogOut()})},e.goShopApply=function(){a.wdApply().success(function(e){e.success?e.data?s.go("newAuthenticationHome"):s.go("registerForStore"):n.showToast("服务端错误")}).error(function(){alert("网络错误")})},e.goSelection=function(){s.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("GuidePageController",["$scope","UserService","$state","LoginService","$localstorage",function(e,t,o,s,i){e.$on("$ionicView.beforeEnter",function(){})}]),
APP.controller("LoginController",["$timeout","HomePageService","$location","newUserLoginService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w){function y(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return a.isCommission=o[i].list[0].checked,a.cashSwitch=o[i].list[1].checked,a.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),a.isCommission=!0,a.cashSwitch=!0,a.goldRainSwitch=!0}}function T(e){r.set("IsThirdLoginType",e),C++;var t={qq:4,sina:6,wechat:7};window.umeng.login(e,function(o){o=JSON.parse(o);var s={uid:o.uid,source:t[e],nickName:o.name,headerPic:o.profile_image_url?o.profile_image_url:o.headimgurl,openid:o.openid,unionid:o.unionid};if(s.uid){var i={userId:s.uid,userName:s.nickName,loginType:t[e],icon:s.headerPic,openid:s.openid,unionid:s.unionid};c.loginThird(i).success(function(e){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.success){d.setUser(e.data),I.initWebSocket();var t=e.data.mid;a.loginMemberId=e.data.mid,y(t),c.checkOpenStore(t).success(function(e){e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",t)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))}),d.setUser(e.data),e.data.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),f.wdApply().success(function(e){e.success?e.data?(d.setUser(e.data),b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(a.loginGoNum=1,m.goBack(-1)):(a.loginGoNum=0,l.go("newHome"))):l.go("RegisterForStoreLogin",{hasHistory:1}):g.showToast("服务端错误")})}else e.message?g.showToast(e.message):g.showToast("登录失败！")}).error(function(e){p.alert({title:"提示",template:"网络连接失败！"})})}else C>3?g.showToast("授权失败，请稍后再试"):T(e)},function(e){p.alert({title:"提示",template:"第三方登录失败！"})})}-1!=window.location.href.indexOf("fromCommunity")&&(a.fromCommunity=!0),n.isBuyer="1",n.isFocusShow=!0,n.identifyCodeImg="",n.showCaptcha=!1,n.showCaptchaForPhone=!1,n.eyeIndex=0,n.loginIndex=0,n.showVC=!1,n.canGetVcode=!0,n.VCodeTips="获取验证码",n.eyeArr=[a.imgBaseURL+"img/eye_close@2x.png",a.imgBaseURL+"img/eye_open@2x.png"],n.pwdArr=["password","text"],n.loginTypeArr=["短信验证码登录","账号密码登录"],n.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var C=0,b=m.viewHistory().backView,A=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";n.leftArrow={},n.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(n.leftArrow={"margin-top":"36px"},n.rightButton={top:"36px"});n.xyzloginName=d.getUser().loginName,n.userInfo={userName:n.xyzloginName,mobile:d.getUser().mobile,password:"",captcha:"",verificationCode:""},n.VCodeStyle={color:"#2979FF"},n.showVCode=function(){n.showVC=!n.showVC,n.identifyCodeImg="",n.userInfo.captcha="",1==n.loginIndex?(n.loginIndex=0,n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!1):(n.loginIndex=1,n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!0)},n.getVCode=function(){n.canGetVcode&&(n.userInfo.mobile&&0!=n.userInfo.mobile.length?n.globalConstant.mobileNumberRegExp.test(n.userInfo.mobile)?0==n.userInfo.captcha.length&&1==n.showCaptchaForPhone?g.showToast("请输入图形验证码"):c.fastLoginCaptcha(n.userInfo.mobile,n.userInfo.captcha,n.showCaptchaForPhone).success(function(e){if(e.data)if(-1==e.data&&0==n.userInfo.captcha.length)n.setImgCaptchaForPhone(),n.showCaptchaForPhone=!0,g.showToast("请输入图形验证码");else{n.canGetVcode=!n.canGetVcode;var t=60;n.timer=i(function(){t-1<0?(n.VCodeTips="获取验证码",n.VCodeStyle={color:"#2979FF"},i.cancel(n.timer),n.canGetVcode=!0):(n.VCodeStyle={color:"#666666"},t--,n.VCodeTips="重发 "+t+"s")},1e3)}else g.showToast(e.message)}):g.showToast("请输入正确的手机号格式"):g.showToast("请输入手机号"))},n.toggleEye=function(){n.eyeIndex=(n.eyeIndex+1)%2},n.setImgCaptcha=function(){n.identifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+r.get("sg_login_token_secret").substring(6)},n.setImgCaptchaForPhone=function(){n.identifyCodeImg=f.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+r.get("sg_login_token_secret").substring(6)},n.canClickLoginOrNot=function(){0!=n.userInfo.mobile.length&&0!=n.userInfo.verificationCode.length?n.canClickLogin=!0:n.canClickLogin=!1},n.toRegister=function(){b&&"guidePage"!=b.stateName?l.go("register",{hasHistory:1}):l.go("register",{hasHistory:0})},n.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&n.loginSG()},n.loginSG=function(){r.set("IsThirdLoginType","PT"),1==n.loginIndex?0==n.userInfo.mobile.length?g.showToast("请输入手机号"):n.globalConstant.mobileNumberRegExp.test(n.userInfo.mobile)?0==n.userInfo.verificationCode.length?g.showToast("请输入短信验证码"):n.userInfo.verificationCode.length>0&&n.userInfo.verificationCode.length<6||n.userInfo.verificationCode.length>6?g.showToast("短信验证码长度必须是6位"):c.fastLogin(n.userInfo.mobile,n.userInfo.verificationCode).success(function(e){if(e.data){var t=e.data.mid;y(t),a.loginMemberId=e.data.mid,d.setUser(e.data),I.initWebSocket(),a.userCount=n.userInfo.mobile,a.password="",window.localStorage.setItem("isLogin",d.isUserLogin()),g.showToast("登录成功"),e.data.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),a.fromCommunity?window.history.back(-1):b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?m.goBack(-1):l.go("newHome"),window.cordova&&(a.gio.setUserId(t.toString()),a.gio.people.set({name:d.getUser().userName,mobile:d.getUser().mobile,email:d.getUser().email,gender:d.getUser().gender,birthday:d.getUser().birthday})),setTimeout(function(){window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var o={member_id:t,device_type:a.isIOS?"ios":"android",device_token:e};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){})},0),c.checkOpenStore(t).success(function(e,o,s,i){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",t)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))})}else g.showToast(e.message)}):g.showToast("请输入正确的手机号格式"):0==n.userInfo.userName.length?g.showToast("请输入用户名"):0==n.userInfo.password.length?g.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==n.userInfo.captcha.length&&1==n.showCaptcha?g.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(n.userInfo.userName,n.userInfo.password,n.userInfo.captcha).success(function(o){if(o.success){var s=o.data.mid;y(s),a.loginMemberId=o.data.mid,d.setUser(o.data),I.initWebSocket(),a.userCount=n.userInfo.userName,a.password=n.userInfo.password,window.localStorage.setItem("isLogin",d.isUserLogin()),g.showToast("登录成功"),o.data.sessionValue?r.set("sg_login_token_secret","Bearer"+o.data.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),window.cordova&&(a.gio.setUserId(s.toString()),a.gio.people.set({name:d.getUser().userName,mobile:d.getUser().mobile,email:d.getUser().email,gender:d.getUser().gender,birthday:d.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var t={member_id:s,device_type:a.isIOS?"ios":"android",device_token:e};c.saveDeviceToken(t).success(function(e){e.success}).error(function(e){})},function(e){}),f.wdApply().success(function(e){e.success?e.data?a.fromCommunity?window.history.back(-1):b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(m.goBack(-1),a.loginGoNum=1):(a.loginGoNum=0,l.go("newHome")):t.isWdHost().success(function(e){e.success?(n.o2oMessage=e.message,1==e.data.isHost?a.fromCommunity?window.history.back(-1):1==e.data.o2o||null==e.data.o2o?l.go("newHome"):l.go("RegisterForStoreLogin",{hasHistory:1}):l.go("RegisterForStoreLogin",{hasHistory:1})):g.showToast("获取数据信息失败！")}):g.showToast("服务端错误")}),c.checkOpenStore(s).success(function(e){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){h.get(v.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+A)}),e.data?(n.isBuyer="1",c.setRole(n.isBuyer),r.set("storeId",s)):(n.isBuyer="0",c.setRole(n.isBuyer),r.set("storeId",20219251))})}else o.message?"forget_password"==o.errorCode?(g.showToast(o.message),e(function(){l.go("requestPassword")},2e3)):-1==o.data?(g.showToast(o.message),n.showCaptcha=!0,n.setImgCaptcha()):g.showToast(o.message):g.showToast("登录失败")})},n.isHideFooter=function(){n.isFocusShow=!1},n.isShowFooter=function(){n.isFocusShow=!0},n.thirdLogin=function(e){if(C=0,!window.umeng)return void alert("umeng 插件 未加载");T(e)},n.goBack=function(){window.location.href.indexOf("?fromCommunity")>-1?window.history.back():m.goBack()},n.$on("$ionicView.beforeEnter",function(e,t){if(n.showCaptcha=!1,n.showCaptchaForPhone=!1,n.setImgCaptchaForPhone(),c.checkLogin().success(function(e,t,o,s){n.setImgCaptcha(),n.setImgCaptchaForPhone()}),b=m.viewHistory().backView,"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i))if(n.urlbase=o.absUrl(),n.urlbase.indexOf("code")>0)n.codeString=n.urlbase.substring(n.urlbase.indexOf("code"),n.urlbase.indexOf("&")),n.getCode=n.codeString.substring(5),s.findStatus(n.getCode).success(function(e){if(e.success&&e.data.unionid)if(n.userData=e.data,1==n.userData.isBinded){var t=r.get("backfront");if(t){var o=JSON.parse(t);n.frontView=o.stateName,n.params=o.stateParams,e.data.memberViewA.mid,a.loginMemberId=e.data.memberViewA.mid,d.setUser(e.data.memberViewA),I.initWebSocket(),a.userCount=n.userInfo.mobile,a.password="",window.localStorage.setItem("isLogin",d.isUserLogin()),a.isWdHost=1,e.data.memberViewA.sessionValue?r.set("sg_login_token_secret","Bearer"+e.data.memberViewA.sessionValue):r.set("sg_login_token_secret","Bearer"+w.generateUUID()),"guidePage"==n.frontView||"register"==n.frontView||"changePassword"==n.frontView||"myPhoneBindSuccess"==n.frontView?(l.go("newHome"),r.set("backfront","")):(l.go(n.frontView,n.params),r.set("backfront",""))}}else n.url=encodeURIComponent(v.getThirdUrl("www/#/login/newUserLogin")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+n.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"});else{var i=JSON.stringify(b);r.set("backfront",i),n.url=encodeURIComponent(v.getThirdUrl("www/index.html#/login")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+n.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"}})}]),APP.service("LoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,s,i){var a={userName:o,password:encodeURIComponent(s),captcha:i,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),a)},this.loginUserInfo=function(o,s){var i={userName:o,password:s,noLoading:!0};return e.get(t.getUrl("LOGIN"),i)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var s={memberId:o};else s={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),s)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,s,i){if(i){var a={mobile:o,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:a,headers:{Authorization:"open the gate"}})}return a={mobile:o},e.get(t.getUrl("FAST_LOGIN_CAPTCHA"),a)},this.fastLogin=function(o,s){var i={mobile:o,captcha:s};return e.post(t.getUrl("FAST_LOGIN")+"?mobile="+i.mobile+"&captcha="+i.captcha)}}]),APP.controller("RegisterController",["$rootScope","$localstorage","$scope","$http","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){function w(t){var o=t;if(localStorage.getItem("setSwitch")){for(var s=JSON.parse(localStorage.getItem("setSwitch")),i=!1,a=s.length-1;a>=0;a--)if(s[a].id==o)return e.isCommission=s[a].list[0].checked,e.cashSwitch=s[a].list[1].checked,e.goldRainSwitch=s[a].list[2].checked,void(i=!0);if(!i){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var n={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};s.push(n),localStorage.setItem("setSwitch",JSON.stringify(s))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=[e.imgBaseURL+"img/eye_close@2x.png",e.imgBaseURL+"img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=e.imgBaseURL+"img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var y=h.hasHistory,T=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=n(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},n.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else a.showToast(e.message)}):a.showToast("请输入正确的手机号格式"):a.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?a.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?a.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?a.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(i){if(i.data){var n=i.data.mid;w(n),e.loginMemberId=i.data.mid,l.setUser(i.data),v.initWebSocket(),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+S.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?f.goBack(-1):r.go("newHome"),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(e,i,a,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get($.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?a.showToast("请输入用户名"):0==o.loginInfo.password.length?a.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?a.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(s){if(s.success){var n=s.data.mid;w(n),e.loginMemberId=s.data.mid,l.setUser(s.data),v.initWebSocket(),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),s.data.sessionValue?t.set("sg_login_token_secret","Bearer"+s.data.sessionValue):t.set("sg_login_token_secret","Bearer"+S.generateUUID()),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),i.wdApply().success(function(t){t.success?t.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("newHome")):r.go("RegisterForStoreLogin",{hasHistory:1}):a.showToast("服务端错误")}),c.checkOpenStore(n).success(function(e){e.data?t.set("storeId",n):t.set("storeId",20219251)})}else s.message?(a.showToast(s.message),-1==s.data&&(o.showCaptcha=!0),o.setImgCaptcha()):a.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)};var C=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?a.showToast("请输入验证码！"):i.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;C=n(function(){t<=0?(n.cancel(C),C=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?a.showToast("该手机号已经注册过顺逛用户，请直接登录。"):e.message?a.showToast(e.message):a.showToast("获取验证码失败！")}):a.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?a.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?a.showToast("请输入短信验证码！"):0==o.xychecked?a.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》！"):i.newAddRegisterUserInfo(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(e.data.isCanRegister){var s={mobileNum:o.userInfo.mobileNum,password:o.userInfo.password,captcha:o.userInfo.captcha,imgCaptcha:o.userInfo.captchaImg};t.setObject("register_obj",s),m(function(){r.go("newAuthenticationHome",{promotionCode:o.promotionCode,types:100})},0)}}else a.showToast(e.message)}):a.showToast("密码不符合规则！"):a.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=!1,c.checkLogin().success(function(e,t,s,i){o.setImgCatpcha()}),y=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?I.open($.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e}}]),APP.service("RegisterService",["$http","UrlService",function(e,t){this.addRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:i,imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:n})},this.newAddRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(assword),imgCaptcha:a,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:n})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RegisterForStoreController",["$localstorage","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","$rootScope","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){t.captchaFlag=!0,t.isAgreeConsent=!1,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.iconImage=f.imgBaseURL+"img/ic_photo.png";var $=m.hasHistory;t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.agreeConsent=function(){t.isAgreeConsent=!t.isAgreeConsent};var S=void 0;t.getIdentifyCode=function(){t.captchaFlag&&(t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?s.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e){if(e.success){var o=60;S=i(function(){o<=0?(i.cancel(S),S=void 0,o=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=o+"秒后可重发",t.captchaFlag=!1,o--)},1e3,100)}else"1102"==e.errorCode?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！"))},t.registerUserInfo=function(){var e=t.globalConstant.passwordRegExp;t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.password.length?s.showToast("请输入密码！"):e.test(t.userInfo.password)?0==t.userInfo.captcha.length?s.showToast("请输入短信验证码！"):t.isAgreeConsent?s.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):o.bindMobile(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void s.showToast(e.message);r.getUser();r.getUser().mobile=t.userInfo.mobileNum,a.go("newAuthenticationHome")}else"该手机已被注册！"==e.message?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("注册失败！")}):s.showToast("密码不符合规则！"):s.showToast("请输入在正确的手机号！")},t.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})},t.setHeaderImg=function(){return},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha(),$=m.hasHistory})}]),APP.controller("RegisterForStoreLoginController",["$localstorage","$rootScope","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){o.captchaFlag=!0,o.isAgreeConsent=!1,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=t.imgBaseURL+"img/ic_photo.png";var $=f.hasHistory;o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.setImgCatpcha=function(){o.identifyCodeImg=s.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.agreeConsent=function(){o.isAgreeConsent=!o.isAgreeConsent},o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})};var S=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?i.showToast("请输入验证码！"):s.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;S=a(function(){t<=0?(a.cancel(S),S=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?i.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?i.showToast("请输入短信验证码！"):o.isAgreeConsent?i.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):s.bindMobile(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void i.showToast(e.message);c.getUser();c.getUser().mobile=o.userInfo.mobileNum,t.fromCommunity?window.history.back(-2):0==t.loginGoNum?n.go("homePage"):m.goBack(-2)}else"该手机已被注册！"==e.message?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("注册失败！")}):i.showToast("密码不符合规则！"):i.showToast("请输入在正确的手机号！")},o.setHeaderImg=function(){return},o.$on("$ionicView.beforeEnter",function(){o.setImgCatpcha(),$=f.hasHistory})}]),APP.controller("RegisterV2Controller",["$rootScope","$localstorage","$scope","$http","RegisterV2Service","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w){function y(t){var o=t;if(localStorage.getItem("setSwitch")){for(var s=JSON.parse(localStorage.getItem("setSwitch")),i=!1,a=s.length-1;a>=0;a--)if(s[a].id==o)return e.isCommission=s[a].list[0].checked,e.cashSwitch=s[a].list[1].checked,e.goldRainSwitch=s[a].list[2].checked,void(i=!0);if(!i){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var n={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};s.push(n),localStorage.setItem("setSwitch",JSON.stringify(s))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}var T='<div style="background:#ffffff;width:304px;border-radius:10px;position:relative;padding:10px 0;">                          <div class="cancel-btn" style="position:absolute;top:10px;right:10px;width:20px;height: 20px;"><img src="'+e.imgBaseURL+'img/regist/xxx@2x.png" style="width:100%"></div>                          <div style="padding:20px 0px;">                            <h5 align="center" style="color:#333333 ;front-size:16px;line-height: 22px;font-weight: 600;">恭喜您成为顺逛会员</h5>                            <h5 align="center" style="color:#666666;font-size:14px;line-height:22px;">升级微店主领佣金，可享更多权益</h5>                          </div>                          <div style="width:100%">                            <img src="'+e.imgBaseURL+'img/regist/open_store.png" style="width:100%"/>                          </div>                          <div class="ok-btn new_authentication_home_btn" style="height:44px;line-height: 44px;">                              <span style="background: #2979FF;font-size: 16px;">立即升级微店主</span>                          </div>                        </div>';o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=["img/eye_close@2x.png","img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage="img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var C=h.hasHistory,b=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=n(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},n.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else a.showToast(e.message)}):a.showToast("请输入正确的手机号格式"):a.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?a.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?a.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?a.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(i){if(i.data){v.initWebSocket();var n=i.data.mid;if(y(n),e.loginMemberId=i.data.mid,l.setUser(i.data),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var d=n.toString()
;window.xneng.NTalkerLogin(d,l.getUser().userName,"0",function(e){},function(e){})}if(b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?f.goBack(-1):r.go("newHome"),window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var p={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(n+"",p)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(e,i,a,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?a.showToast("请输入用户名"):0==o.loginInfo.password.length?a.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?a.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(n){if(n.success){v.initWebSocket();var d=n.data.mid;if(y(d),e.loginMemberId=n.data.mid,l.setUser(n.data),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),n.data.sessionValue?t.set("sg_login_token_secret","Bearer"+n.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var p=d.toString();window.xneng.NTalkerLogin(p,l.getUser().userName,"0",function(e){},function(e){})}if(window.cordova&&(e.gio.setUserId(d.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var u={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(d+"",u)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:d,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),i.wdApply().success(function(t){t.success?t.data?b&&"guidePage"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("newHome")):r.go("RegisterForStoreLogin",{hasHistory:1}):a.showToast("服务端错误")}),c.checkOpenStore(d).success(function(e){e.data?t.set("storeId",d):t.set("storeId",20219251)})}else n.message?(a.showToast(n.message),-1==n.data&&(o.showCaptcha=!0),o.setImgCaptcha()):a.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.isNeedCaptcha=function(){var e=(new Date).getTime(),o=t.get("sms_captcha_timestamp"),s=o&&null!=o&&e-o<864e5;return s};var A=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?o.showCaptcha&&0==o.userInfo.captchaImg.length?a.showToast("请输入验证码！"):c.fastLoginCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg,o.showCaptcha).success(function(e){if(e.success){t.set("sms_captcha_timestamp",(new Date).getTime());var s=60;return void(A=n(function(){s<=0?(n.cancel(A),A=void 0,s=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=s+"秒后可重发",o.captchaFlag=!1,s--)},1e3,100))}o.showCaptcha=!0,e.message?a.showToast(e.message):a.showToast("获取验证码失败！")}):a.showToast("请输入正确的手机号码！"))},o.doLoginSuccess=function(){b&&"guidePage"!=b.stateName&&"login"!=b.stateName&&"register"!=b.stateName&&"changePassword"!=b.stateName&&"myPhoneBindSuccess"!=b.stateName?f.goBack(-1):r.go("newHome")},o.registerUserInfo=function(){o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captcha.length?a.showToast("请输入短信验证码！"):c.fastLogin(o.userInfo.mobileNum,o.userInfo.captcha).success(function(i){if(i.data){v.initWebSocket();var n=i.data.mid;if(y(n),l.setUser(i.data),e.isNewUser=i.data.isNewUser,e.loginMemberId=i.data.mid,e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),a.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),s.get(S.getUrl("TOKEN_LOGIN_GET")).success(function(e){}),window.xneng){var d=n.toString();window.xneng.NTalkerLogin(d,l.getUser().userName,"0",function(e){},function(e){})}if(window.cordova&&(e.gio.setUserId(n.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.baifend){var p={name:l.getUser().userName,em:l.getUser().email,cp:l.getUser().mobile+""};window.baifend.onAddUser(n+"",p)}window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:n,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(n).success(function(i,l,d,p){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){s.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),i.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",n)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251)),"0"==o.isBuyer&&h.promotionCode&&null!=h.promotionCode&&""!=$.trim(h.promotionCode))return void r.go("newAuthenticationHome",{promotionCode:h.promotionCode});if(e.isNewUser)var u=a.dialog({content:T,buttons:[{selector:".ok-btn",handler:function(){u.remove(),r.go("newAuthenticationHome",{promotionCode:h.promotionCode})}},{selector:".cancel-btn",handler:function(){u.remove(),o.doLoginSuccess()}}]});else o.doLoginSuccess()})}else a.showToast(i.message)}):a.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.canGoBack=function(e){e.pageX<32&&f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=o.isNeedCaptcha(),c.checkLogin().success(function(e,t,s,i){o.setImgCatpcha()}),C=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?w.open(S.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e},o.isShowService=!0,o.closeRule=function(){o.isShowService=!1},o.toLogin=function(){r.go("login")},o.goHelpDetail=function(){r.go("helpDetail",{helpId:1002,content:"顺逛微店注册协议"})}}]),APP.service("RegisterV2Service",["$http","UrlService","$state","$localstorage",function(e,t,o,s){this.setPassword=function(o){var i={password:o},a={TokenAuthorization:s.get("sg_login_token_secret")};return e({method:"POST",url:t.getUrl("SET_PASSWORD_INIT"),headers:a,params:i})},this.addRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:i,imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:n})},this.newAddRegisterUserInfo=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:n})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RequestPasswordController",["$localstorage","$scope","RequestPasswordService","PopupService","$interval","$state","$timeout",function(e,t,o,s,i,a,n){t.captchaFlag=!0,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.getIdentifyCode=function(){t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?s.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e,o,a,n){if(e.success){var r=60,c=void 0;c=i(function(){r<=0?(i.cancel(c),c=void 0,r=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=r+"秒后可重发",t.captchaFlag=!1,r--)},1e3,100)}else e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！")},t.passwordSubmit=function(){0==t.userInfo.mobileNum.length?s.showToast("请输入您的手机号！"):t.globalConstant.passwordRegExp.test(t.userInfo.password)?0==t.userInfo.captcha.length?s.showToast("获取验证码失败！"):o.requestPassword(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e,o,i,r){e.success?(s.showToast("修改成功"),n(function(){a.go("login")},1e3)):e.message?(s.showToast(e.message),t.setImgCatpcha()):(s.showToast("提交失败！"),t.setImgCatpcha())}):s.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)")},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha()})}]),APP.service("RequestPasswordService",["$http","UrlService",function(e,t){this.requestPassword=function(o,s,i,a){var n={mobileNum:o,captcha:s,password:encodeURIComponent(i),imgCaptcha:a};return e({method:"POST",url:t.getUrl("REQUEST_PASSWORD"),params:n})},this.getCaptcha=function(o,s){var i={mobileNum:o,captcha:s};return e.get(t.getUrl("GET_PASSWORD_CAPTCHA"),i)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")}}]),APP.controller("ShopApplyController",["$scope","$rootScope","$state","ShopApplyService","MyStoreService","GoodsService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){e.addressName="",e.goToAddress=!1,e.categoryData=[],e.selectText="",e.selectKey="";var $=window.innerHeight,S=$-373+"px";e.contentHeight={height:S},e.addressTitle="配送至",e.dataAdd=null,e.flag="SHOP_APPLY_ADDRESS",e.defaultValue=null,e.level=0;var I,w,y={};e.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:""},e.mid=l.getUser().mid,e.promotionCode=p.promotionCode,e.init=function(){e.showAlert=!1,e.goToAddress?e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour:e.addressName="",e.selectText=e.textUnion,e.selectValue=e.valueUnion,e.mid=l.getUser().mid,p.promotionCode&&(e.applyInfo.promotionCode=p.promotionCode),e.mid&&d.getStoreInfo(e.mid).success(function(t,o,s,i){t.success&&(e.storeCode=t.data.storeCode,e.storeType=t.data.storeType)})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,f.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",a.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var T=!1;e.goSelect=ionic.Utils.debounce(function(o,s){for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var s=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=f.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){1==ah&&(w=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(w,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,f.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=f.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=f.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,i.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(I=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,i.getLocationList(I,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),f.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else{if(T)return;g(function(){T=!1},1500),t.$broadcast(e.flag,e.defaultValue),T=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){y=n.getAddressInfo();var o=y.regionName+"/"+y.streetName;i.addAddress(y.provinceId,y.cityId,y.areaId,o,y.streetId).success(function(){var o={"text-1":y.provinceName,"text-2":y.cityName,"text-3":y.regionName,"text-4":y.streetName,"value-1":y.provinceId,"value-2":y.cityId,"value-3":y.areaId,"value-4":y.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.$on("$destroy",function(){e.addressModal.remove()}),t.$on("SHOP_APPLY_ADDRESS",function(t,o){e.goToAddress=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.adrProvinceId=o["value-1"],e.adrCityId=o["value-2"],e.adrAreaId=o["value-3"],e.adrStreetId=o["value-4"],e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour}),t.$on("SHOP_APPLY_UNION",function(t,o){e.textUnion=o.text,e.valueUnion=o.value}),e.checkChange=function(t,o){s.checkText(t).success(function(s){s.data||""==t||("-100"!=s.errorCode&&r.showToast("请不要使用违禁词！"),1==o?e.applyInfo.ownerName="":e.applyInfo.storeName="")})},e.shopApplySubmit=function(){return e.applyInfo.ownerName?e.applyInfo.address?e.applyInfo.storeName?(e.showAlert=!1,void(/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.ownerName)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{2,50}$/.test(e.applyInfo.address)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.storeName)?/^(HR|hr|Hr|hR).{6,18}$/.test(e.applyInfo.hrCode)||"10"!=e.selectValue?0==e.addressName.length?r.showToast("请选择所在地区！"):e.selectText?"10"!=e.selectValue?(e.showAlertCheck=!1,e.showAlert=!1,e.applyInfo.hrCode="",s.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:Math.round(t.data.totalCommission),memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):(t.errorCode="-100")?(u.show({template:"您尚未登录或登录失效,请先登录",duration:3500}),o.go("login")):r.showToast(t.message)})):(e.showAlertCheck=!1,e.showAlert=!1,s.check(e.applyInfo.hrCode).success(function(t,i,a,n){t?s.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:t.data.totalCommission,memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):r.showToast(t.message)}):e.showAlertCheck=!0})):r.showToast("请选择联盟分类！"):e.showAlert=!0:r.showToast("店铺名字为1～20的常用字符！"):r.showToast("详细地址为2～50的常用字符！"):r.showToast("店主姓名为1～20的常用字符！"))):void r.showToast("店铺名称必须填写！"):void r.showToast("详细地址必须填写！"):void r.showToast("店主姓名必须填写！")},e.clearInput=function(){e.applyInfo.ownerName=void 0,e.applyInfo.address=void 0,e.applyInfo.storeName=void 0,e.promotionCode||(e.applyInfo.promotionCode=""),e.addressName="",e.applyInfo.hrCode=void 0,e.selectText=void 0},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(t,s){if(e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&f.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.promotionCode=p.promotionCode,l.isUserLogin()){if(1==c.getRole())return u.show({template:"您已经是店主了,进店看看吧",duration:2500}),void g(function(){},2e3).then(function(){o.go("shop")});e.init()}else e.init();"back"==s.direction||e.clearInput(),e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.controller("ShopApplySuccessController",["trueAuthenticationService","$scope","$stateParams","ShopApplySuccessService","$ionicHistory","$state","$rootScope","RegisterV2Service","PopupService",function(e,t,o,s,i,a,n,r,c){var l='<div style="background:#ffffff;width:304px;border-radius:5px;position:relative;padding: 20px 20px 5px 20px;">                        <div class="cancel-btn" style="position:absolute;top:10px;right:10px;width:20px;height: 20px;">                          <img src="'+n.imgBaseURL+'img/regist/xxx@2x.png" style="width:100%">                        </div>                        <div>                          <h5 style="font-size: 16px;line-height:22px;color:#333333;opacity: 0.86;">请输入您的登录密码</h5>                        </div>                        <div style="padding:20px 0 0 0px;border-bottom:1px solid #E4E4E4;">                          <input name="password" type="password" placeholder="请输入您的密码" style="width:100%;padding:10px;font-size:14px;line-height:22px;"/>                        </div>                        <div class="ok-btn new_authentication_home_btn" style="margin-top:15px;height:44px;line-height: 44px;width:100%;">                            <span style="background: #2979FF;font-size: 16px;">提交</span>                        </div>                    </div>';t.$on("$ionicView.beforeEnter",function(){t.isNewUser=n.isNewUser;i.viewHistory().histories.root;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),s.getShopData().success(function(e){e.success?(t.memberCount=e.data.openStoreRank,"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr2","ownerregist","1"])):t.memberCount=888888}),t.isOrNoGoHomePage=function(){a.go("newHome")},t.setPassword=function(){var e=c.dialog({content:l,buttons:[{selector:".ok-btn",handler:function(){var o=e.find(":input[type='password']").val(),s=t.globalConstant.passwordRegExp;0==o.length?c.showToast("请输入密码！"):s.test(o)?(e.remove(),r.setPassword(o).success(function(e,t,o,s){e.success?(c.showToast("设置登陆密码成功！"),a.go("newHome")):e.message?c.showToast(e.message):c.showToast("设置登陆密码发生异常！")})):c.showToast("密码不符合规则！")}},{selector:".cancel-btn",handler:function(){e.remove(),a.go("newHome")}}]})}})}]),APP.service("ShopApplySuccessService",["$http","UrlService",function(e,t){this.getShopData=function(){return e.post(t.getUrl("SHOP_APPLY_SUCCESS"))}}]),APP.controller("CustomizehdController",["$scope","$stateParams","$ionicHistory","$rootScope","$state",function(e,t,o,s,i){e.imgUrl=t.url,e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},e.goBack=function(){"advertisement"==s.fromState?i.go("homePage"):e.goBackFlag&&(e.goBackFlag=!1,o.goBack())},e.$on("$ionicView.beforeEnter",function(o,s){e.goBackFlag=!0,e.imgUrl=t.url})}]),APP.controller("AboutUsController",["$scope","$rootScope",function(e,t){var o=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=o?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.softwareUpdate=function(){}}]),APP.controller("CollectionController",["$rootScope","$scope","CollectionService","$timeout","UserService","GoodsService","CommonAddressService","HomePageService",function($rootScope,$scope,CollectionService,$timeout,UserService,GoodsService,CommonAddressService,HomePageService){function getCollectionProduct(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,CollectionService.showCollection(provinceId,cityId,districtId,streetId).success(function(e,t,o,s){e.success&&($scope.items=e.data.productsList)})}else alert("获取收藏失败")}).error(function(e){var t=CommonAddressService.getAddressInfo();CollectionService.showCollection(t.provinceId,t.cityId,t.areaId,t.streetId).success(function(e,t,o,s){e.success&&($scope.items=e.data.productsList)})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}function getCollectionStoreList(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,$scope.streetId=streetId,CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,s){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})}else alert("获取收藏失败")}).error(function(e){CommonAddressService.getAddressInfo();CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,s){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})})}$scope.items=[],$scope.typeArr=["商品","店铺/场馆"],$scope.updateResult=!0,$scope.updateContent="",$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.init=function(){$scope.collectionType="product",$scope.storePage=1,$scope.storePageSize=5,$scope.hasMore=!1,$scope.items=[],getCollectionProduct()},$scope.loadMore=function(){$scope.storePage+=1,getCollectionStoreList()},$scope.checkType=function(e){0==e?($scope.collectionType="product",getCollectionProduct(),$(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px")):($scope.collectionType="store",$scope.items=[],getCollectionStoreList(),$(".collection_type>div:nth-child(2)").css("color","#2979FF"),$(".collection_type>div:nth-child(2) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(1)").css("color","#666666"),$(".collection_type>div:nth-child(1) div").css("borderBottom","0px"))},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction?$scope.direction="back":($scope.storeId=UserService.getUser().mid,$scope.direction="forword",$scope.init())}),$scope.$on("$ionicView.enter",function(){"back"==$scope.direction||($(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px"))}),$scope.delete=function(e){CollectionService.deleteCollection($scope.items[e].productId).success(function(e,t,o,s){e.success?($scope.showResult("删除成功"),$scope.init()):$scope.showResult("删除失败")})},$scope.showResult=function(e){$scope.updateContent=e,$scope.updateResult=!1,$timeout(function(){$scope.updateResult=!0},1e3)}}]),APP.service("CollectionService",["$http","UrlService",function(e,t){this.showCollection=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getUrl("COLLECTION_LIST"),n)},this.deleteCollection=function(o){var s={productId:o};return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),params:s})},this.getStoreCollection=function(o,s){var i={page:o,pageSize:s};return e.get(t.getUrl("STORE_COLLECTIONLIST"),i)}}]),APP.controller("FeedbackPlusController",["$scope","$state","FeedbackPlusService","PopupService","$ionicActionSheet","AssessService","UserService",function(e,t,o,s,i,a,n){function r(){e.feedbackType=6,e.canCommit=!1,e.feedback={content:"",phoneNumber:""},e.imageCount=0;for(var t=0;t<3;t++)e.imageList[t]="",d[t]=""}function c(t){e.$apply(function(){for(var o=0;o<3;o++)if(!e.imageList[o]){e.imageList[o]=t;break}e.imageCount++});var o=function(e){for(var t=JSON.parse(e.response),o=0;o<3;o++)if(!d[o]){d[o]=t.urls;break}},s=function(e){},i=new FileUploadOptions,r=new Date,c=r.getTime();i.fileKey="imageFile",i.fileName=n.getUser.userName+c,i.mimeType="image/jpeg",(new FileTransfer).upload(t,encodeURI(a.uploadImage()),o,s,i)}function l(e){}e.feedback={content:"",phoneNumber:""},e.feedbackType=6,e.imageCount=0,e.imageList=["","",""];var d=["","",""];e.canCommit=!1,e.checkLength=function(){setTimeout(function(){e.$apply(function(){e.feedback.content.length>=500&&(e.feedback.content=e.feedback.content.substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)},e.changeType=function(t){e.feedbackType=t},e.addImage=function(){window.cordova&&i.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),d.splice(t,1),e.imageCount--},e.phoneCheck=function(){},e.submitFeedback=function(){if(e.feedback.phoneNumber&&!e.globalConstant.mobileNumberRegExp.test(e.feedback.phoneNumber))return void s.showToast("请输入正确的手机号码！");var i={site:"mstore",type:e.feedbackType,content:e.feedback.content,contact:e.feedback.phoneNumber,file:d[0]?d[0]:"",file1:d[1]?d[1]:"",file2:d[2]?d[2]:""};o.commitFeedback(i).success(function(e){e.success&&(s.showToast("提交成功！"),setTimeout(function(){t.go("Setup")},2017))})},e.$watch("feedback.content",function(t,o){setTimeout(function(){e.$apply(function(){t.length>=500&&(e.feedback.content=t.toString().substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)}),e.$on("$ionicView.beforeEnter",function(){r()})}]),APP.service("FeedbackPlusService",["$http","UrlService",function(e,t){this.commitFeedback=function(o){return e({method:"POST",url:t.getUrl("FEEDBACK_PLUS"),params:o})}}]),APP.controller("MineController",["$scope","$timeout","UserService","ShopService","PlatformService","MESSAGECENTERService","CreditService","$state",function(e,t,o,s,i,a,n,r){e.tabNav="mine",e.account="",e.flagNum=!1,e.goMemberCenter=function(){n.getGameId(function(e){r.go("vip",{gameId:e})})},e.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==i.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},e.init=function(){s.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1});for(var t=[],i=0;i<o.getUser().userName.length;i++)t[i]=i>=3&&i<=6?"*":o.getUser().userName[i];e.account="";for(var a=0;a<t.length;a++)e.account=e.account+t[a];e.account.length>20&&(e.account=e.account.slice(0,20)+"..."),e.accreditation="海尔官方认证"},e.$on("$ionicView.beforeEnter",function(){e.init(),a.unreadMessage()})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){}]),
APP.controller("PersonalCenterController",["trueAuthenticationService","$localstorage","$rootScope","RegisterService","HomePageService","OrderManageService","$http","UrlService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","PersonalCenterService","$state","WhiteShowsService","PopupService","ProductDetailService","GoodsService",function(trueAuthenticationService,$localstorage,$rootScope,RegisterService,HomePageService,OrderManageService,$http,UrlService,InAppBrowserService,CreditService,ShopService,$scope,$timeout,UserService,PersonalCenterService,$state,WhiteShowsService,PopupService,ProductDetailService,GoodsService){$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.user=UserService.getUser(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],$scope.gotoSecondPage=function(e,t){$state.go("orderManage",{orderFlag:e,orderType:t})},$scope.goOrderManage=function(e,t){$state.go("orderManage",{orderFlag:e,orderStatus:t})},$scope.goMemberCenter=function(){CreditService.getGameId(function(e){$state.go("vip",{gameId:e})})},$scope.goGoldGame=function(){CreditService.getGameId(function(e){$state.go("goldgame",{gameId:e})})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isWhatApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isWhatApp="android":$scope.isWhatApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isWhatApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.goToMyStore=function(){1==$scope.isHost&&$state.go("myStore",{storeId:$scope.storeId})},$scope.goToRace=function(){window.location.href=UrlService.getThirdUrl("race/")},$scope.goLearningHaier=function(){PersonalCenterService.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else $state.go("login")})},$scope.goToManageMoney=function(e){$state.go("financialMoney",{whereId:"personnalCenter"})},$scope.toApplyForWhite=function(){WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}))})},$scope.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&$timeout(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else $scope.kfTocken=$localstorage.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$scope.kfTocken);return},$scope.goNewHand=function(){var e=UrlService.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},$scope.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},t=function(e){function t(e){$scope.avatarImage=e,$timeout(function(){$scope.avatarImage=e},200);var t=function(e){$ionicLoading.hide(),PopupService.showToast("上传成功");var t=JSON.parse(e.response);$scope.avatarImage=t.data.avatarImageFileId,$scope.user.avatarImageFileId=$scope.avatarImage,UserService.setUser($scope.user)},o=function(e){$ionicLoading.hide(),PopupService.showToast("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=$scope.avatarImage.substr($scope.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var i={};s.params=i,(new FileTransfer).upload($scope.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,s);var a={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(a)}function o(e){}function s(e){$scope.avatarImage=e,$timeout(function(){$scope.avatarImage=e},200);var t=function(e){PopupService.showToast("上传成功"),$ionicLoading.hide();var t=JSON.parse(e.response);$scope.avatarImage=t.data.avatarImageFileId,$scope.user.avatarImageFileId=$scope.avatarImage,UserService.setUser($scope.user)},o=function(e){PopupService.showToast("上传失败"),$ionicLoading.hide()},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=$scope.avatarImage.substr($scope.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var i={};s.params=i,(new FileTransfer).upload($scope.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,s);var a={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(a)}function i(e){}1==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,t),$timeout(function(){window.plugins.actionsheet.hide()},5e3)}else $ionicPopup.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},$scope.checkPhoneNumber=function(){RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")})},$scope.init=function(){trueAuthenticationService.doInit().success(function(e){e.success&&(e.data.isAuthByOne?$scope.changeOpacity={opacity:"1"}:$scope.changeOpacity={opacity:"0.5"})}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,null==e.data.o2o||1==e.data.o2o?$scope.iso2o=!0:$scope.iso2o=!1}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),PersonalCenterService.personalInit().success(function(e){$scope.isHost=e.data.isHost,$scope.storeName=e.data.storeName,$scope.card=e.data.card,$scope.level=e.data.level,$scope.nowLevelName=$scope.levelArr[$scope.level-1],11!=$scope.level&&($scope.nextLevelName=$scope.levelArr[$scope.level]),$scope.revenue=e.data.revenue,$scope.coupon=e.data.coupon,$scope.gold=e.data.gold,$scope.card=e.data.card}),PersonalCenterService.diamondInit().success(function(e){$scope.babyCoupon=e.data.c,$scope.babyGold=e.data.g;var t=e.data.d;parseInt(t)>9999?$scope.babyDiamond="9999+":$scope.babyDiamond=t}),OrderManageService.getOrderAmount().success(function(e){e.success&&($scope.orderAmountData=e.data)}),CreditService.getGameId(function(e){var t=UrlService.getUrl("SHUNGUANG_VIP"),o={gameId:e,withLevelPath:!0};$http.get(t,o).success(function(e){if(e.success){$scope.order=e.data.userCreditWithLevel.order,$scope.levelGrowArr=e.data.levels;$scope.levelGrowArr[e.data.userCreditWithLevel.order]&&($scope.levelUpExp=$scope.levelGrowArr[e.data.userCreditWithLevel.order].creditNum-e.data.userCreditWithLevel.totalCreditNum,$scope.levelUpExp<0&&($scope.levelUpExp=0)),$scope.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,$scope.creditNum=e.data.userCreditWithLevel.totalCreditNum}})}),PersonalCenterService.personalApply().success(function(e){e.success&&(e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2),$scope.applyName=e.data.name,$scope.applyStatus=e.data.status)}),ShopService.getMessage().success(function(e){e.success&&(PersonalCenterService.userMemberId=e.data.memberId)})},$scope.$on("$ionicView.beforeEnter",function(){$scope.avatarImage=UserService.getUser().avatarImageFileId,$scope.storeId=UserService.getUser().mid,$scope.user=UserService.getUser(),$scope.tabNav="personnalCenter",$scope.init()})}]),APP.service("PersonalCenterService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.diamondInit=function(){return e.get(t.getNewUrl("GET_NEW_DIAMOND"))},this.personalApply=function(o){var s=t.getUrl("GET_APPLY_MENGZHU");return e.get(s,o)},this.userMemberId="",this.learningHaier=function(){return e.get(t.getNewUrl("GET_learningHaier"))}}]),APP.controller("SetupController",["$ionicPopup","AccountMessageService","$rootScope","$scope","PlatformService","LoginService","UserService","$state","$localstorage","IMService",function(e,t,o,s,i,a,n,r,c,l){s.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==i.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==i.getPlatform()?cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==i.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},s.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},s.switchOff={background:"#fff","border-color":"#e6e6e6"},s.borderBottom={"margin-bottom":"3px"},s.switchState=function(e){s.settingsList[e].checked=!s.settingsList[e].checked;for(var t=JSON.parse(localStorage.getItem("setSwitch")),i=t.length-1;i>=0;i--)s.memberId==t[i].id&&(t[i].list[e].checked=s.settingsList[e].checked,localStorage.setItem("setSwitch",JSON.stringify(t)));switch(e){case 0:o.isCommission=s.settingsList[e].checked;break;case 1:o.cashSwitch=s.settingsList[e].checked;break;case 2:o.goldRainSwitch=s.settingsList[e].checked}},s.init=function(){s.memberId=n.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==s.memberId&&(s.settingsList=e[t].list,!0)},s.goGuidePage=function(){r.go("guidePage")},s.user=n.getUser(),s.accountToken=s.user.token,s.accountSessionId=s.user.sessionValue,s.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",s.unload=function(){l.destroyWebSocket(),void 0==s.user.sessionValue?(n.clearUser(),s.goGuidePage(),a.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),c.set("storeId","")):t.unloadAccount(s.accountToken,s.accountSessionId,s.accountHeaderKey).success(function(e,t,o,i){if(e.success){n.clearUser(),a.setRole(void 0),s.goGuidePage();var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r),window.localStorage.setItem("isLogin",n.isUserLogin()),c.set("storeId","")}})},s.goToDelete=function(){e.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&s.unload()})},s.$on("$ionicView.enter",function(){s.init()})}]),APP.controller("ShoppingCarController",["$scope",function(e){}]),APP.controller("accsafeCtrl",["$scope","accsafeService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.accountMessage="",e.accountEmail="",e.accountNumber="",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=n.getUser(),e.accountMessage=e.user.userName,e.accountEmail=e.user.email,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,n.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){u.set("ROLE_INFO","undefined"),s.go("guidePage")},o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,n.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){s.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("accsafeService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("accsettingCtrl",["AccountMessageService","$scope","$location","accsettingService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){var o=e[0];if(window.FileReader){var s=new FileReader;s.readAsDataURL(o),s.onloadend=function(e){t.$apply(t.iconImage=e.target.result)}}}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.isPhone=!!window.cordova,t.userInfo={picTempFile:""},t.user={},t.sexMap=["保密","男","女"],t.accountMessage="",t.accountName="",t.accountSexValue="0",t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday="",t.iconImage=i.imgBaseURL+"img/ic_login_user.png",t.accountToken="",t.accountSessionId="",t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.updateResult=!0,t.updateContent="",t.init=function(){t.user=c.getUser(),t.sexMap=["保密","男","女"],void 0!=t.user.avatarImageFileId&&(t.iconImage=t.user.avatarImageFileId),t.accountMessage=t.user.userName,t.accountName=t.user.nickName,t.accountSexValue=t.user.gender,t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday=t.user.birthday,t.accountToken=t.user.token,t.accountSessionId=t.user.sessionValue,t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(t.accountNumber)||(t.showMobile=!1)},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goGuidePage=function(){"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(t.urlbase=o.absUrl(),window.location.href=t.urlbase.substring(0,t.urlbase.indexOf("?"))+"#/guidePage"):(m.set("ROLE_INFO","undefined"),a.go("guidePage"))},t.changeIcon=function(){if("APP"==d.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(o){function s(o){t.iconImage=o,r(function(){t.iconImage=o},200);var s=function(e){l.hide(),t.showResult("上传成功");var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,c.setUser(t.user)},i=function(e){l.hide(),t.showResult("上传失败")},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),s,i,a);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};l.show(d)}function i(e){}function a(o){t.iconImage=o,r(function(){t.iconImage=o},200);var s=function(e){t.showResult("上传成功"),l.hide();var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,c.setUser(t.user)},i=function(e){t.showResult("上传失败"),l.hide()},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),s,i,a);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};l.show(d)}function n(e){}1==o?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(a,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,s),r(function(){window.plugins.actionsheet.hide()},5e3)}else{u.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},t.$watch("userInfo.picTempFile",function(){t.userInfo&&t.userInfo.picTempFile&&t.userInfo.picTempFile.length>0&&f(t.userInfo.picTempFile)},!1),t.unload=function(){void 0==t.user.sessionValue?(c.clearUser(),t.goGuidePage(),g.setRole(void 0),window.localStorage.setItem("isLogin",c.isUserLogin()),m.set("storeId","")):e.unloadAccount(t.accountToken,t.accountSessionId,t.accountHeaderKey).success(function(e,o,s,i){if(e.success){c.clearUser(),t.goGuidePage(),g.setRole(void 0);var a="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",a),window.localStorage.setItem("isLogin",c.isUserLogin()),m.set("storeId","")}})},t.goToDelete=function(){u.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&t.unload()})},t.selectDate=function(){if("APP"==d.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){r(function(){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),e.changeMessage(t.accountMessage,a+"-"+i+"-"+s,t.accountSexValue,t.accountName).success(function(e,o,n,r){e.success?(t.accountBirthday=a+"-"+i+"-"+s,t.user.birthday=a+"-"+i+"-"+s,c.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i);var a=new Date(o).getFullYear()+"-"+s+"-"+i;e.changeMessage(t.accountMessage,a,t.accountSexValue,t.accountName).success(function(e,o,s,i){e.success?(t.accountBirthday=a,t.user.birthday=a,c.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})}};p.openDatePicker(s)}},i.$on("SELECT_SEX",function(e,o){t.accountSexValue=o,t.accountSex=t.sexMap[t.accountSexValue],t.user.gender=o,c.setUser(t.user),t.showResult("修改成功")}),i.$on("CHANGE_NAME",function(e,o){t.accountName=o,t.user.nickName=o,c.setUser(t.user),t.showResult("修改成功")}),t.goBack=function(){a.go("personnalCenter")},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,r(function(){t.updateResult=!0},1e3)}}]),APP.service("accsettingService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,s,i){var a=o,n="Bearer "+i+" "+a,r={Authorization:n},c={sessionId:s};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("CompetitionController",["$scope","$ionicHistory","MemberCompleteService","PopupService","CreditService","UrlService","$state","$stateParams","$http","InAppBrowserService","$ionicSlideBoxDelegate","$location","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(e,t,o,s){for(;;){var i,a=!1;i=s?(e+(t-e-e)*Math.random()).toFixed(2):Math.ceil(e+(t-e-e)*Math.random());for(var n=0;n<o.length;n++)if(i===o[n]){a=!0;break}if(a||o.push(i),o.length===S)break}}function m(e,t){for(var o,s,i=e.slice(0),a=e.length,n=a-t;a-- >n;)s=Math.floor((a+1)*Math.random()),o=i[s],i[s]=i[a],i[a]=o;return i.slice(n)}var f=r.taskDestId;e.taskType=r.taskType,e.xyzMemberId=r.memberId;var h=["赵","钱","孙","李","周","吴","郑","王","冯","陈","褚","卫","蒋","沈","韩","杨","朱","秦","尤","许","何","吕","施","张","孔","曹","严","华","金","魏","陶","姜","戚","谢","邹","喻","柏","水","窦","章","苏","潘","葛","奚","范","彭","郎","鲁","韦","昌","马","苗","凤","花","方","俞","任","袁","柳","酆","鲍","史","唐","费","廉","岑","薛","雷","贺","倪","汤","滕","殷","罗","毕","郝","邬","安","常","乐","于","时","傅","皮","卞","齐","康","伍","余","元","卜","顾","孟","平","黄","和","穆","萧","尹","姚","邵","湛","汪","祁","毛","禹","狄","米","贝","明","臧","计","伏","成","戴","谈","宋","茅","庞","熊","纪","舒","屈","项","祝","董","梁","杜","阮","蓝","闵","席","季","麻","强","贾","路","娄","危","江","童","颜","郭","梅","盛","林","刁","钟","徐","邱","骆","高","夏","蔡","田","樊","胡","凌","霍","虞","万","支","柯","昝","管","卢","莫","经","房","裘","缪","干","解","应","宗","丁","宣","贲","邓","郁","单","杭","洪","包","诸","左","石","崔","吉","钮","龚","程","嵇","邢","滑","裴","陆","荣","翁","荀","羊","於","惠","甄","麴","家","封","芮","羿","储","靳","汲","邴","糜","松","井","段","富","巫","乌","焦","巴","弓","牧","隗","山","谷","车","侯","宓","蓬","全","郗","班","仰","秋","仲","伊","宫","宁","仇","栾","暴","甘","钭","厉","戎","祖","武","符","刘","景","詹","束","龙","叶","幸","司","韶","郜","黎","蓟","薄","印","宿","白","怀","蒲","邰","从","鄂","索","咸","籍","赖","卓","蔺","屠","蒙","池","乔","阴","郁","胥","能","苍","双","闻","莘","党","翟","谭","贡","劳","逄","姬","申","扶","堵","冉","宰","郦","雍","舄","璩","桑","桂","濮","牛","寿","通","边","扈","燕","冀","郏","浦","尚","农","温","别","庄","晏","柴","瞿","阎","充","慕","连","茹","习","宦","艾","鱼","容","向","古","易","慎","戈","廖","庾","终","暨","居","衡","步","都","耿","满","弘","匡","国","文","寇","广","禄","阙","东","殴","殳","沃","利","蔚","越","夔","隆","师","巩","厍","聂","晁","勾","敖","融","冷","訾","辛","阚","那","简","饶","空","曾","毋","沙","乜","养","鞠","须","丰","巢","关","蒯","相","查","後","荆","红","游","竺","权","逯","盖","益","桓","公","万",,"俟","司马","上官","欧阳","夏侯","诸葛","闻人","东方","赫连","皇甫","尉迟","公羊","澹台","公冶","宗政","濮阳","淳于","单于","太叔","申屠","公孙","仲孙","轩辕","令狐","钟离","宇文","长孙","慕容","鲜于","闾丘","司徒","司空","亓官","司寇","仉","督","子车","颛孙","端木","巫马","公西","漆雕","乐正","壤驷","公良","拓跋","夹谷","宰父","谷梁","晋","楚","闫","法","汝","鄢","涂","钦","段干","百里","东郭","南门","呼延","归","海","羊舌","微生","岳","帅","缑","亢","况","后","有","琴","梁丘","左丘","东门","西门","商","牟","佘","佴","伯","赏","南宫","墨","哈","谯","笪","年","爱","阳","佟","第五","言","福"],v=["奕柯","消沉","天乐","维妙","峻","哲","晓培","益申","莹莹","占宇","雨","凌昕","婉婷","建雄","小文","小冉","子安","老杰","胖胖","文","剑","霖","锰","克谦","小仙","帅帅","逸","旭梅","萍","元雪","晓莉","明燕","九庆","留强","汝彬","台铭","帆","昆仑","万里","中锋","志伟","明汉","琴","珍美","明君","涛","文武","艳艳","小刚","霞","浩","志豪","军林","叶东","远青","伟军","明浩","佑军","盛露","少青","发祥","钟森","永发","运瑞","自珍","家宝","建联","迪","慧","盛锦","素素","生平","海峰","喧喧","文宏","景翔","子博","炳良","保胜","希玮","莱","宇佳","博飞","文诺","宸萧","萍","利","墨语","宇凡","方丰","景宝","乐新","康帅","睿继","温雁","呈远","运","恩","叶","涵琰","文文","杰宪","迪勋","颜悦","杭","彬","信","帅鸿","庭达","然","睿进","锦远","康飞","茂轩"];e.indexNum=0;var S=10;e.moneyRandoms=[],g(50,3e3,e.moneyRandoms,!0);e.timeRandoms=[],g(1,60,e.timeRandoms,!1);e.userImg=[],g(0,198,e.userImg,!1),e.userList=[],e.firstName=m(h,S),e.lastName=m(v,S),e.allName=[],function(t,o){for(var s=0;s<S;s++)e.allName.push(t[s]+""+o[s]);e.allName}(e.firstName,e.lastName);for(var I=0;I<S;I++)e.userList.push({src:u.imgBaseURL+"img/userImg/"+e.userImg[I]+".jpg",money:e.moneyRandoms[I],allName:e.allName[I],time:e.timeRandoms[I]});e.goBack=function(){t.goBack()},e.share=function(){window.cordova?e.showShare=!0:s.showAlert("只能在app分享","抱歉，只能在app分享")},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?l.open(a.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):n.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"22px",height:"66px"}:e.paddingtopClass={"padding-top":"6px",height:"50px"},e.copeText=function(t){window.cordova?(cordova.plugins.clipboard.copy(t),s.showToastShort("复制成功"),e.isShowCopyButton=!1):s.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var s=e.competition.storeName+"的综合竞争力指数",n="综合竞争力指数全球排名"+e.competition.userRank+"位颤抖吧人类",r=e.competition.avatarImageFileId,c=a.getShareLinkHeader()+"competition//"+e.taskType+"/"+e.xyzMemberId;window.umeng?0==t?window.umeng.shareToSina(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"微博").success(function(){}),i.shareSuccessCallback("微博")}):1==t?window.umeng.shareToWechatSession(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"微信").success(function(){}),i.shareSuccessCallback("微信")}):2==t?window.umeng.shareToWechatTimeline(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("朋友圈")}):3==t?window.umeng.shareToQQ(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("QQ")}):4==t?window.umeng.shareToQzone(s,n,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),i.shareSuccessCallback("QQ空间")}):5==t&&e.copeText(c):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){f=r.taskDestId,e.taskType=r.taskType,e.competition="",e.showShare=!1,e.xyzMemberId=r.memberId,e.gameId=r.gameId,e.storeId="";var t=(new Date).getTime();o.myComplete(e.xyzMemberId).success(function(o){e.competition=o.data,void 0==e.competition.myInCome&&(t=(new Date).getTime(),$.ajax({url:a.getUrl("BROKERAGE_SETTLEMENT"),data:{memberId:e.xyzMemberId},type:"post",dataType:"json",success:function(t){t.success&&t.data&&(e.competition.myInCome=t.data.totalBrokerageAmount,e.$apply())},error:function(){}})),e.storeId=o.data.memberId,e.userCurrentLevelId=o.data.order;for(var s=[[248,46,91],[172,123,171],[88,234,231],[217,226,109],[253,181,70],[248,115,60]],i=[["店铺单数",e.competition.ordersCount/1],["招募结识了",e.competition.partner/2],["进行评价",e.competition.accessCount/1],["分享",e.competition.sharesCount/50],["登录",e.competition.loginsCount/50],["社区互动",e.competition.comunityCount/30]],n=1,r=0;r<i.length;r++)i[r][1]>n&&(n=i[r][1]);var c=i.length,l=document.getElementById("radarMap"),d=document.getElementById("radarMapCanvas");null==d&&(d=document.createElement("canvas"),d.id="radarMapCanvas",l.appendChild(d));var p=.49*$(document).width(),u=402*p/370;d.style="position:relative;position: absolute;z-index: -1",d.width=p,d.height=u;var g=d.getContext("2d"),m=p,f=u,h=m/2,v=f/2,S=h-3,I=2*Math.PI/c;!function(e){e.save();for(var t=S/3,o=0;o<3;o++){e.beginPath();for(var i=t*(o+1),a=[],n=0;n<c;n++){var r=h+i*Math.cos(I*n-I/2),l=v+i*Math.sin(I*n-I/2);a.push([r,l])}for(var n=0;n<a.length;n++){e.beginPath(),e.moveTo(a[n][0],a[n][1]),e.lineTo(a[(n+1)%a.length][0],a[(n+1)%a.length][1]),e.closePath();var d=e.createLinearGradient(a[n][0],a[n][1],a[(n+1)%a.length][0],a[(n+1)%a.length][1]);d.addColorStop("0.2","rgba("+s[n].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+s[(n+1)%a.length].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.beginPath(),e.moveTo(a[a.length-1][0],a[a.length-1][1]),e.lineTo(a[0][0],a[0][1]),e.closePath();var d=e.createLinearGradient(a[a.length-1][0],a[a.length-1][1],a[0][0],a[0][1]);d.addColorStop("0.2","rgba("+s[a.length-1].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+s[0].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2),i=v+S*Math.sin(I*t-I/2);e.beginPath(),e.moveTo(h,v),e.lineTo(o,i);var a=e.createLinearGradient(o,i,h,v);a.addColorStop("0","rgba("+s[t].join(",")+",1)"),a.addColorStop("0.8","rgba("+s[t].join(",")+",0.2)"),e.strokeStyle=a,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save(),e.beginPath();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2)*i[t][1]*(100/n)/100,s=v+S*Math.sin(I*t-I/2)*i[t][1]*(100/n)/100;e.lineTo(o,s)}e.closePath(),e.lineWidth=.5,e.strokeStyle="rgba(167,241,224,1)",e.stroke(),e.fillStyle="rgba(255, 0, 0, 0.2)",e.fill(),e.restore()}(g)}).error(function(e){}),o.storeDetail(e.gameId).success(function(t){1==t.success&&(e.storeCreditWithLevel=t.data.storeCreditWithLevel,e.storeCreditWithLevel&&(e.storeCurrentLevelId=t.data.storeCreditWithLevel.order,e.starName=t.data.storeCreditWithLevel.name,e.levelArray=[],e.storeCurrentLevelId<=3?e.levelArray=[u.imgBaseURL+"img/StarLevel@2x.png"]:e.levelArray=[u.imgBaseURL+"img/Diamond@2x.png"]))}),d.update(),d.loop(!0),d.enableSlide(!1)}),e.foots=[{src:u.imgBaseURL+"img/touxiang@2x.png",name:"aaa",money:"1",time:10},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"bbb",money:"2",time:20},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"ccc",money:"3",time:30},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"ddd",money:"4",time:40},{src:u.imgBaseURL+"img/touxiang@2x.png",name:"eee",money:"5",time:50}]}]),APP.service("MemberCompleteService",["$http","UrlService",function(e,t){this.myComplete=function(o){var s={ownerId:o};return e.get(t.getUrl("MEMER_COMPETE"),s)},this.missionShare=function(o,s,i){var a={taskType:o,taskDestId:s,sharePlatform:i};return e.get(t.getUrl("MISSION_SHARE"),a)},this.storeDetail=function(o){var s=t.getUrl("SHUNGUANG_VIP");return e.get(s,o)}}]),APP.controller("CustomMadeController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,s,i,a,n){e.customMadeUrl=o.trustAsResourceUrl(t.customMadeUrl),e.close=function(){n.go("shop")}}]),APP.controller("goldRecordController",["$rootScope","$localstorage","$scope","$stateParams","$state","$ionicPopup","$timeout","$http","UrlService",function(e,t,o,s,i,a,n,r,c){function l(e){r.get(c.getUrl("CREDIT_DETAIL"),e).success(function(t){p=1,0==e.searchType?(o.name1=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore1=!1):o.hasmore1=!0):1==e.searchType?(o.name2=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore2=!1:o.hasmore2=!0):2==e.searchType&&(o.name3=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore3=!1:o.hasmore3=!0)}).error(function(e){})}o.hasmore1=!1,o.hasmore2=!1,o.hasmore3=!1,o.name1="",o.name2="",o.name3="",o.flag=!1,o.a=!1,o.b=!0;var d=0,p=1,u=1,g=1,m=1,f="",h={searchType:d,startIndex:p,pageSize:9};o.storeId=t.get("storeId",e.globalConstant.storeId),l(h),o.loadMore1=function(){var e=o.name1;u+=1;var t={searchType:d,startIndex:u,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){0==t.searchType&&(o.name1=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore1=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){o.$broadcast("scroll.infiniteScrollComplete")})},o.loadMore2=function(){var e=o.name2;g+=1;var t={searchType:d,startIndex:g,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){1==t.searchType&&(o.name2=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore2=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.loadMore3=function(){var e=o.name3;m+=1;var t={searchType:d,startIndex:m,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(s){
2==t.searchType&&(o.name3=e.concat(s.data.rows),f=Math.ceil(s.data.total/s.data.pageSize),o.hasmore3=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.goBack=function(){o.$ionicGoBack()},o.show=function(){o.flag=!o.flag},o.showfalse=function(){o.flag=!1},o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={},o.$on("$ionicView.beforeEnter",function(){o.flag=!1}),o.showFlag1=function(){d=0,u=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={}},o.showFlag2=function(){d=1,g=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag2=!0,o.flag1=!1,o.flag3=!1,o.myObj2={background:"#2196F3",color:"#fff"},o.myObj1={},o.myObj3={}},o.showFlag3=function(){d=2,m=1,h={searchType:d,startIndex:p,pageSize:9},l(h),o.flag3=!0,o.flag1=!1,o.flag2=!1,o.myObj3={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj1={}}}]),APP.controller("myAppointmentController",["$ionicScrollDelegate","$interval","myAppointmentService","CalculateStrLength","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","HomePageService",function(e,t,o,s,t,i,a,n,r,c,l,d,p,u){function g(e,o){var s=o,i=t(function(){if(s)var o=a.data[e].purchaseEndTime-(new Date).getTime();else var o=a.data[e].purchaseStartTime-(new Date).getTime();if(o<0)if(s){a.data[e].hasOver=!0;for(var n=0,r=0;n<a.data.length&&a.data[n].hasOver;n++)r++;r==a.data.length&&(a.noData=!0),t.cancel(i)}else s=!0,a.data[e].hasBegan=!0,a.data[e].days=0,a.data[e].hours=0,a.data[e].minutes=0,a.data[e].seconds=0;else a.data[e].days=parseInt(o/864e5),a.data[e].hours=parseInt(o%864e5/36e5),a.data[e].minutes=parseInt(o%36e5/6e4),a.data[e].seconds=Math.floor(o%6e4/1e3)},1e3);a.intervalArr.push(i)}function m(e){for(var t=(new Date).getTime(),o=e.length,s=0;s<o;s++)e[s].hasOver=!1,e[s].purchaseStartTime>t?(e[s].hasBegan=!1,g(s,!1)):e[s].purchaseStartTime<(new Date).getTime()&&t<e[s].purchaseEndTime&&(e[s].hasBegan=!0,g(s,!0))}a.pageIndex=1,a.hasMore=!1,a.data=[],a.storeId=c.getUser().mid,a.flagNum=!1,a.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",a.goProductDetail=function(e){r.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:a.storeId})},a.init=function(){a.noData=!1,a.data=[],o.getMyAppointment(a.pageIndex).success(function(e){5==e.data.length?(a.hasMore=!0,a.data=a.data.concat(e.data),m(a.data)):e.data.length<5&&0!=e.data.length?(a.hasMore=!1,a.data=a.data.concat(e.data),m(a.data)):e.data&&0!=e.data.length||(a.noData=!0)}),u.getUnReadMsg().success(function(e){e.data>0?a.flagNum=!0:a.flagNum=!1})},a.loadMore=function(){a.pageIndex++,o.getMyAppointment(a.pageIndex).success(function(e){5==e.data.length?(a.hasMore=!0,m(e.data),a.data=a.data.concat(e.data)):e.data.length<5&&0!=e.data.length?(a.hasMore=!1,m(e.data),a.data=a.data.concat(e.data)):a.hasMore=!1})},a.$on("$ionicView.beforeLeave",function(e,o){for(var s=0,i=a.intervalArr.length;s<i;s++)t.cancel(a.intervalArr[s])}),a.$on("$ionicView.beforeEnter",function(t,o){e.scrollTop(),a.pageIndex=1,a.intervalArr=[],a.init()})}]),APP.service("myAppointmentService",["$http","UrlService",function(e,t){this.getMyAppointment=function(o){var s={pageIndex:o};return e.get(t.getNewUrl("MYAPPOINTMENT"),s)}}]),APP.controller("NewClassController",["$scope","$rootScope","$http","UrlService","PersonalCenterService",function(e,t,o,s,i){var a=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=a?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.goNewHand=function(){var e=s.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},e.goLearningHaier=function(){i.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else $state.go("login")})},e.softwareUpdate=function(){}}]),APP.controller("VipController",["CommonAddressService","ProductDetailService","$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","$http","CreditService","InAppBrowserService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S){function I(e){var t=new Date(e),o=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+s+"月"+i+"日"}function w(){d.getapplyDuozhu().success(function(e){if(e.success){o.memberId=e.data.memberId,o.teamLevelId=e.data.teamLevelId,o.applyName=e.data.name,o.teamName=e.data.name,o.applyTeamName=e.data.name,o.applyStatus=e.data.status,e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2);var t={"舵主":"duozhu@2x.png","盟主":"mengzhu@2x.png"},i=t[o.teamName],a={"-3":{text:"未通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("未通过","您本月不能申请！")}},"-2":{text:"申请",icon:s.imgBaseURL+"img/apply"+i,handler:function(){function e(e){var t=/[\ud800-\udbff][\udc00-\udfff]/g;return e=e.replace(t,"")}var t=o.applyDialog();o.fnClosePopup=function(){t.close()},o.mailIsError=!1,o.reasonIsError=!1,o.checkEmail=function(e){var t=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,s=t.test(e);o.mailIsError=!s},o.checkReason=function(t){t=e(t),o.reasonIsError=!t,o.reasonIsError&&(o.data.input2="")},o.fnExchangeGoods=function(){if(o.checkEmail(o.data.input1),!o.mailIsError){if(o.checkReason(o.data.input2),o.reasonIsError)return void(o.data.input2="");d.applyDuozhu({email:o.data.input1,applyReason:o.data.input2,teamLevelId:o.teamLevelId}).success(function(e,o,s,i){1==e.success?e.data&&p.showAlert("盟主舵主权益","申请成功"):p.showAlert("盟主舵主权益",e.message),t.close(),w()})}},o.lookLeaderRights=function(){p.showAlert("盟主舵主权益",o.LeaderRights)}}},"-1":{text:"未通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("未通过","您本月的申请被拒绝，下月继续努力！")}},0:{text:"已申请",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("已申请","您本月的申请已经提交，请等待工作人员审批！")}},1:{text:"已通过",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("已通过","您已经是"+e.data.name+"了！")}},2:{text:"不可申请",icon:s.imgBaseURL+"img/dis"+i,handler:function(){p.showAlert("盟主舵主权益",o.LeaderRights)}},3:{text:"盟主",icon:s.imgBaseURL+"img/meng@2x.png",handler:function(){p.showAlert("已通过","您已经是"+e.data.name+"了！")}}};o.applyText=a[""+e.data.status].text,o.applyIcon=a[""+e.data.status].icon,o.handler=a[""+e.data.status].handler}})}o.isShowMore=!1,o.isShowRule=!1,o.closeAll=function(){o.isShowMore=!1,o.isShowRule=!1},o.showMore=function(){o.isShowMore=!o.isShowMore},o.showRule=function(){o.isShowRule=!o.isShowRule},o.closeRule=function(){o.isShowRule=!1},o.applyDialog=function(){return l.show({cssclass:"leader-popup",template:"\n        <div class='apply-list popup-form'>\n          <div class = 'form-title' ng-show='teamName==\"盟主\"'>恭喜您获得申请盟主的资格！</div>\n          <div class = 'form-title' ng-show='teamName==\"舵主\"'>恭喜您获得申请舵主的资格！</div>\n          <div class='form-content'>\n           <div class='sub-title'>请填写申请理由，我们会尽快跟你联系</div>\n           <p class='input-name'>联系邮箱<span class='error' ng-show='mailIsError'>请填写正确邮箱</span></p>\n           <div class='input-area'><input type='text' placeholder='填写你的邮箱(必填)' ng-model='data.input1' ng-blur='checkEmail(data.input1)'></div>\n          </div>\n          <div class='form-content'>\n          <p class='input-name'>申请理由<span class='error' ng-show='reasonIsError'>请填写申请理由</span></p>\n           <div class='input-area'><textarea rows='3' ng-blur=\"checkReason(data.input2)\" cols='20' placeholder='填写你的申请理由(必填，不支持特殊字符、表情)' ng-model='data.input2'></textarea></div>\n          </div>\n          <div class='form-info'>\n            <span  ng-click='lookLeaderRights()'>点击查看更多舵主盟主权益</span>\n          </div>\n          <div class='form-button'>\n           <span class='left-btn' ng-click='fnClosePopup()' >再想想</span>\n           <span class='right-btn' ng-click='fnExchangeGoods()' >提交申请</span>\n          </div>\n        </div>\n      ",scope:o})},o.levelUp=function(e){l.alert({template:'<div style="font-size: 17px;color: #030303;letter-spacing: -0.41px;line-height: 26px;">'+e+"</div>",okText:"我知道啦"})},o.modal=void 0,o.gameId=i.gameId,o.levelMsg=i.msg,o.gameTitle,o.gameDesc,o.isShowForm=!1,o.startTime="",o.endTime="",o.hasBkgColor=!0;var y="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";o.isAdmin=i.isAdmin,o.shareStoreId;var T=.2*window.innerWidth;o.gridHeight={height:T+"px"},o.gridHeightMiddle={height:2*T+8+"px"};var C=window.innerHeight,b=C-373+"px";o.contentHeight={height:b},o.addressTitle="配送至",o.dataAdd=null,o.flag="CHANGEADDRESS_LOCATION_GAME",o.defaultValue=null,o.level=0;var A={};o.addressInfo={},o.game={},o.prizeList=[],o.startP=0,o.endP=11,o.curP=void 0,o.timer=void 0,o.isRuning=!1;var P=330;o.showShare=!1,o.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.topBtnCss4IOS={top:"12px"}),o.$on("$ionicView.beforeEnter",function(){o.isShowMore=!1,o.isShowRule=!1,o.xyzMemberId=m.getUser().mid,o.shareStoreId=i.shareStoreId,o.isAdmin=i.isAdmin,o.memberId=m.getUser().mid,S.$getByHandle("gradeScroll").scrollBy(0,0),o.dataAdd=null,o.defaultValue=null,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.watch=o.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),o.$on("$destroy",function(){o.addressModal.remove()}),o.init()}),o.init=function(){w(),o.prizeList=new Array(12),o.applyName="盟主",h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),i={gameId:e,withLevelPath:!0};-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},f.get(t,i).success(function(e){if(o.levelMsg&&o.levelUp(o.levelMsg),e.success){o.name=e.data.userCreditWithLevel.name,o.avatarImageFileId=m.getUser().avatarImageFileId?m.getUser().avatarImageFileId:e.data.avatarImageFileId,o.userCurrentLevelId=e.data.userCreditWithLevel.order,o.order=e.data.userCreditWithLevel.order,o.levelGrowArr=e.data.levels,o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,o.creditNum=e.data.userCreditWithLevel.totalCreditNum,o.userRank=e.data.userCreditWithLevel.userRank,o.congratulationMsg="有"+o.userRank+"个小伙伴超过了你",0==o.userRank&&(o.congratulationMsg="恭喜你，你已经是天下第一了，继续保持哦！"),o.storeCreditWithLevel=e.data.storeCreditWithLevel,o.storeCreditWithLevel&&(o.storeCurrentLevelId=e.data.storeCreditWithLevel.order,o.storeName=e.data.storeCreditWithLevel.name,o.levelArray=[],o.storeCurrentLevelId<=3?o.levelArray=[s.imgBaseURL+"img/StarLevel@2x.png"]:o.levelArray=[s.imgBaseURL+"img/Diamond@2x.png"]),$("canvas:not('#radarMapCanvas')").remove(),$(".cur"+o.order).radialIndicator({barColor:"#8FB8FF",barWidth:2,initValue:0,roundCorner:!0,percentage:!1,displayNumber:!1});$(".cur"+o.order).data("radialIndicator").animate(100),o.scrollMainToTop()}})}),d.storeDetailInfo({memberId:o.memberId}).success(function(e){1==e.success&&(o.storeVipName=e.data.storeName,o.teamLevelName=e.data.teamLevelName,o.storeId=e.data.memberId)}),o.showQQ=!1,o.showWeChat=!1,window.umeng&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.startP=0,o.curP=void 0,d.gameInfo({gameId:o.gameId}).success(function(e){e.success?(o.prizeList=e.data.gameImg,o.partNum=e.data.partNum,o.game=e.data.game,o.chouCount=e.data.playTimes,o.startTime=I(1e3*o.game.beginTime),o.endTime=I(1e3*o.game.endTime),g.fromTemplateUrl("templates/common/CommonGame.html",{scope:o,animation:"slide-in-left"}).then(function(e){o.modal=e}),o.game.backgroundPic||(o.hasBkgColor=!1)):alert(e.message)}).error(function(){p.showMsg("网络错误")}),d.notapplyDuozhu().success(function(e){1==e.success&&(o.LeaderRights=e.data.description)})},o.scrollMainToTop=function(){o.order<8||8==o.order?S.$getByHandle("gradeScroll").scrollTo(133*(o.order-1),0):S.$getByHandle("gradeScroll").scrollTo(931,0)};var x,L,D,N,_=0,O=Math.floor(3*Math.random())+2;o.clickChou=function(){if(!o.isRuning){d.luckDraw({gameId:o.gameId,timeStamp:(new Date).getTime()}).success(function(e){if(e.success&&-1!=e.result.prizeType)o.chouResult=e.result,o.endP=e.result.postion-1,o.start(),h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),s={gameId:e};f.get(t,s).success(function(e){e.success&&(o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum)})}),o.chouCount++;else if(e.success&&-1==e.result.prizeType)l.alert({template:e.result.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("抽奖次数")>-1)l.alert({template:e.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("GAME")>-1)l.alert({template:"对不起，奖品已被抽光"}),o.curP=void 0;else if(e.message&&e.message.indexOf("未登录")>-1)o.curP=void 0,a.go("login");else{if(o.curP=void 0,"-100"==e.errorCode)return;l.alert({template:e.message})}}).error(function(e){p.showToast("网络错误")}),o.curP=0;var e=12*O+o.endP;x=5,L=4==O?15:10,D=4==O?e-15:e-10,N=4==O?e-10:e-5}},o.starsList=[{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:s.imgBaseURL+"img/whiteStar-Grade@2x.png"}],o.starsListLimit=6,o.showPopup=function(){o.data={input1:"",input2:""},o.handler&&o.handler.call()},o.start=function(){o.endP<0||o.endP>11||(o.isRuning=!0,o.timer=n(function(){if(_++,_>=x?P=100:_>=L?P=60:_>=D?P=100:_>=N&&(P=500),_>12*O&&o.curP===o.endP)return _=0,o.isRuning=!1,void o.showForm();o.curP<12?o.curP++:o.curP=0,o.start()},P))},o.openPic=function(){o.modal.show()},o.closePic=function(){o.modal.hide()},o.share=function(){if(window.device&&window.device.hasNewShare){if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void p.showToast("请先登录,再分享");if(o.isShowForm)return;o.showShare=!o.showShare}else{if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void p.showToast("请先登录,再分享");if(o.isShowForm)return;if(window.umeng){var e=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}},o.goBack=function(){-1!=window.location.href.indexOf("sg_rn_app")&&0==u.viewHistory().histories.root.cursor&&window.postMessage("goback"),o.isAdmin&&1==o.isAdmin||o.isShowForm||("advertisement"==s.fromState?a.go("homePage"):o.$ionicGoBack())},o.showForm=function(){o.isShowForm=!0},o.hideForm=function(){o.isShowForm=!1},o.confirmGameInfo=function(){if(!o.chouResult.consignee)return void l.alert({title:"提示",template:"收件人必须填写！"});if(!o.globalConstant.mobileNumberRegExp.test(o.chouResult.mobile))return void l.alert({title:"提示",template:"请输入正确的手机号！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.address)return void l.alert({title:"提示",template:"地址必须填写！"});var e={gameId:o.chouResult.gameId,uuid:o.chouResult.uuid,prizeId:o.chouResult.gamePrizeId,consignee:o.chouResult.consignee,mobile:o.chouResult.mobile,address:o.chouResult.address,regionName:o.chouResult.regionName,isDefault:0,provinceId:o.chouResult.provinceId,cityId:o.chouResult.cityId,regionId:o.chouResult.regionId,streetId:o.chouResult.streetId};d.confirmGameInfo(e).success(function(e){e.success?(p.showToast("提交成功"),o.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},o.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},o.addressInit=function(e,s,i,a){if(o.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=a,s){o.dataAdd=JSON.parse(s),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",t.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1};var k=!1;o.goSelect=ionic.Utils.debounce(function(e,i){for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var i=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=i.text,o.defaultValue["value"+o.level]=i.value,o.level>-2){-1==o.level&&(o.selectProvince=i.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel);var r=-1*o.level;o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(i.value,r).success(function(e){if(1==r){i.value}o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){p.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){p.showToast("获取地址信息失败！")})}}else if(o.level>-4)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,-3==o.level?(o.selectArea=i.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top):o.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,r=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(i.value,r).success(function(e){if(o.dataAdd=e.data,o.addressTipFlag=!1,2==r){i.value}var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){p.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),S.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else{if(k)return;n(function(){k=!1},1500),s.$broadcast(o.flag,o.defaultValue),k=!0,o.closeAddressModal()}},300),s.$on("CHANGEADDRESS_LOCATION_GAME",function(e,t){o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.chouResult.provinceId=t["value-1"],o.chouResult.cityId=t["value-2"],o.chouResult.regionId=t["value-3"],o.chouResult.streetId=t["value-4"],o.chouResult.regionName=o.textOne+o.textTwo+o.textThree+o.textFour}),o.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){A=e.getAddressInfo();var i=A.regionName+"/"+A.streetName;t.addAddress(A.provinceId,A.cityId,A.areaId,i,A.streetId).success(function(){var e={"text-1":A.provinceName,"text-2":A.cityName,"text-3":A.regionName,"text-4":A.streetName,"value-1":A.provinceId,"value-2":A.cityId,"value-3":A.areaId,"value-4":A.streetId};s.$broadcast(o.flag,e),o.addressModal.hide()})}},g.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),o.closeAddressModal=function(){o.addressModal.hide()},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="给您推荐顺逛每日抽奖活动,不可错过哦!",s=y,i=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng?(0==e?window.umeng.shareToSina("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback),h.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛抽奖活动",t,s,i,0,null,h.shareSuccessCallback),h.qqShare()),5==e?o.copeText(i):h.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?v.open(r.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):a.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})}}]),APP.service("GameService",["$http","UrlService",function(e,t){this.gameInfo=function(o){var s=t.getGameUrl("GAME_INFO");return e.get(s,o)},this.luckDraw=function(o){var s=t.getGameUrl("LOTTERY");return e.get(s,o)},this.confirmGameInfo=function(o){var s=t.getGameUrl("GAME_HAVE_PRIZE"),i="gameId="+o.gameId+"&uuid="+o.uuid+"&prizeId="+o.prizeId+"&consignee="+o.consignee+"&mobile="+o.mobile+"&address="+o.address+"&regionName="+o.regionName+"&isDefault="+o.isDefault+"&provinceId="+o.provinceId+"&cityId="+o.cityId+"&regionId="+o.regionId+"&streetId="+o.streetId;return e({method:"POST",url:s,data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.storeDetailInfo=function(o){var s=t.getUrl("GET_STORE_DETAIL");return e.get(s,o)},this.getapplyDuozhu=function(o){var s=t.getUrl("GET_APPLY_MENGZHU");return e.get(s,o)},this.applyDuozhu=function(o){var s=t.getUrl("APPLY_MENGZHU");return e({method:"POST",url:s,params:o})},this.notapplyDuozhu=function(o){var s=t.getUrl("APPLY_MENGZHU_NOT");return e.get(s,o)}}]),APP.controller("newresCtrl",["$stateParams","$scope","flashService","$state","$ionicHistory","$interval","newresService","$ionicScrollDelegate","$rootScope","$localstorage","GoodsService","UserService","$ionicLoading","HomePageService",function($stateParams,$scope,flashService,$state,$ionicHistory,$interval,newresService,$ionicScrollDelegate,$rootScope,$localstorage,GoodsService,UserService,$ionicLoading,HomePageService){function Format(e){return e=e<10?"0"+e:e}function countDown(e,t,o){$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($state.reload(),$interval.cancel(timer[o]))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.showtime=0,$scope.pageIndex=1,$scope.newprodlist=[],$scope.hasmore=!0,$scope.isWd=!1,$scope.storeId=0,$scope.flag=!1,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png";var timer=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="",nowT=(new Date).getTime();$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){$scope.flag=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprodlist=e.data.acReserveList;for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var s=timerLength;s<remindArray.length;s++)countDown(countDownNowTime[remindArray[s]],countDownendTime[remindArray[s]],remindArray[s])})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.loadMore=function(){$scope.pageIndex++,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){if($scope.flag=!0,0==e.data.acReserveList.length)$scope.hasmore=!1,$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList),$scope.$broadcast("scroll.infiniteScrollComplete");else{if($scope.hasmore=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd)$scope.isWd=!0,$scope.storeId=UserService.getUser().mid;else{$scope.storeId=$localstorage.get("storeId",20219251),$scope.isWd=!1}$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList);for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var s=timerLength;s<remindArray.length;s++)countDown(countDownNowTime[remindArray[s]],countDownendTime[remindArray[s]],remindArray[s]);$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.$on("$ionicView.beforeEnter",function(){$scope.init()}),$scope.goBack=function(){for(var e=0;e<remindArray.length;e++)$interval.cancel(timer[remindArray[e]]);remindArray=[],$ionicHistory.goBack()}}]),APP.service("newresService",["$http","UrlService","flashService","$interval",function(e,t,o,s){this.getnewProd=function(o,s,i,a,n,r){var c={provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:o,from:r};return e.get(t.getNewUrl("NEW_SEND"),c)}}]),APP.controller("newsendCtrl",["$stateParams","$scope","GoodsService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService",function($stateParams,$scope,GoodsService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService){function add(e,t){var o=new Date,s=t,i=o.getTime(),a=$interval(function(){i+=1e3;var e=parseInt((s-i)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),r=e-24*t*60*60-60*n*60,c=parseInt(r/60),l=e-24*t*60*60-60*n*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(n)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(a))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var s={from:o}
;return e.get(t.getZCUrl("SUC_ZHONGCHOU"),s)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("presellCtrl",["$scope","flashService","$state","$ionicHistory","$interval","presellService","$ionicScrollDelegate","$rootScope","$localstorage","UserService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d){e.pageIndex=1,e.hasmore=!0,e.preselllist=[],e.storeId=0,e.flag=!1,e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.goBack=function(){s.goBack()},e.init=function(){e.storeId=c.get("storeId",r.globalConstant.storeId),e.loadMore=function(){a.getpres(e.pageIndex).success(function(t){0==t.data.length?(e.hasmore=!1,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasmore=!0,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"))}),e.pageIndex++},d.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.$on("$stateChangeSuccess",function(){e.loadMore()})}]),APP.service("presellService",["$http","UrlService","flashService","$interval",function(e,t,o,s){this.getpres=function(o){var s={pageIndex:o,pageSize:4};return e.get(t.getNewUrl("NEW_RES"),s)}}]),APP.controller("haierStaffControl",["trueAuthenticationService","$interval","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","haierStaffService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){g.captchaFlag=!0,g.paracont="获取验证码",g.isStaff=!1,g.isBtnShow=!1,g.isActiveTimer=!1,g.staffId="",g.obj={staffId:"",verification:""},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(g.paddingtopClass={"margin-top":"16px"},g.paddingtopClasscontent={top:"60px"}):(g.paddingtopClass={"margin-top":"0px"},g.paddingtopClasscontent={top:"44px"}),g.init=function(){e.doInit().success(function(e){e.success?null!=e.data.empInfo?(g.isStaff=!0,g.staffId=e.data.empInfo.empNo,f.getActiveIsStart().success(function(e){g.isActiveTimer=!!e})):(g.isStaff=!1,g.isActiveTimer=!1):o.showToast(e.message)})};g.$watch("obj",function(){/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)&&/^[0-9]{6}$/.test(g.obj.verification)?g.isBtnShow=!0:g.isBtnShow=!1},!0);g.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?n.open(a.getHead()+"mstore/sg/helpDetail.html?id="+e,t):m.go("helpDetail",{helpId:e,content:t})},g.goBack=function(){c.goBack()},g.submitStaffMsg=function(){var e=g.obj.staffId.toLowerCase();f.postStaffMsg(e,g.obj.verification).success(function(e){e.success&&null!=e.data?(o.showToast("海尔员工认证成功!"),f.getActiveIsStart().success(function(e){e?(g.init(),g.isActiveTimer=!0):(g.isActiveTimer=!1,m.go("trueAuthenticationList"))})):o.showToast(e.message)})};var $,S=void 0;g.getIdentifyCode=function(){if(g.captchaFlag)if(/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)){var e=g.obj.staffId.toLowerCase();f.doInit(e).success(function(e){e.success?($=60,S=t(function(){$<=0?(t.cancel(S),S=void 0,$=60,g.paracont="重发验证码",g.captchaFlag=!0):(g.paracont=$+"秒后可重发",g.captchaFlag=!1,$--)},1e3,100)):o.showToast(e.message)})}else o.showToast("请输入正确的员工编号！")},g.goNewYearActive=function(){m.go("bannerTheme",{bannerId:a.getCPUrl("KMH_ID")})},g.$on("$ionicView.beforeEnter",function(){g.obj={staffId:"",verification:""},g.staffId="",g.captchaFlag=!0,$=60,g.paracont="获取验证码",t.cancel(S),g.init()})}]),APP.service("haierStaffService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={empNo:o};return e.get(t.getUrl("GET_HAIER_STAFF_MSG"),s)},this.postStaffMsg=function(o,s){var i={empNo:o,captcha:s};return e({method:"POST",url:t.getUrl("POST_HAIER_STAFF_MSG"),params:i})},this.getActiveIsStart=function(){return e.get(t.getGameUrl("IS_KAIMENHONG_AVAILABLE"))}}]),APP.controller("newAuthenticationHome",["GetStatisticInfoService","HomePageService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","ShopApplyService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){n.localStorage=window.localStorage,n.addressName="请选择",n.goToAddress=!1,n.categoryData=[],n.selectText="",n.selectKey="",n.isComplete=!1,n.isHasKey=!1,n.hrCodes=!1,n.promotionCode="",n.avatarImage="img/registerSuccess.png",n.userInfo={picTempFile:""};var T=window.innerHeight,C=T-373+"px";n.contentHeight={height:C},n.addressTitle="配送至",n.dataAdd=null,n.flag="SHOP_APPLY_ADDRESS",n.defaultValue=null,n.level=0;var b={};n.user={},n.mid=m.getUser().mid,n.init=function(){n.user=m.getUser(),void 0!=n.user.avatarImageFileId&&(n.avatarImage=n.user.avatarImageFileId),n.addressName="请选择",n.showAlert=!1,n.goToAddress?n.addressName=n.textOne+n.textTwo+n.textThree:n.addressName="",n.selectText=n.textUnion,n.applyInfo.category=n.selectText,n.selectText&&(n.infos=n.selectText.substring(0,4),"人人服务"==n.infos?n.hrCodes=!0:n.hrCodes=!1),n.selectValue=n.valueUnion,n.mid=m.getUser().mid,n.mid&&f.getStoreInfo(n.mid).success(function(e,t,o,s){e.success&&(n.storeCode=e.data.storeCode,n.storeType=e.data.storeType)})},n.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},n.addressTop=function(){n.addressTipFlag=!1,n.provinceTop=0,n.nowLevel=0,n.nowLevelIndex=[-1,-1,-1,-1],n.provinceDis=!1,n.cityDis=!1,n.areaDis=!1,n.addressModal.show(),n.dataAdd=null,n.defaultValue=null,n.selectProvince="",n.selectCity="",n.selectArea="",n.addressInit(n.dataAdd,n.defaultValue,"SHOP_APPLY_ADDRESS",0)},n.addressInit=function(e,t,o,s){if(n.addressTipFlag=!1,I.$getByHandle("mainScroll").scrollTop(),n.addressTitle="配送至",n.defaultValue=e?JSON.parse(e):{},n.level=s,t){n.dataAdd=JSON.parse(t),n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel,n.applyInfo.arr=n.nowLevelIndex;for(var i=0;i<n.nowLevelIndex.length;i++)i>n.nowLevel&&(n.nowLevelIndex[i]=-1)}else n.finish=!1,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",d.getLocationList("",0).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1,n.finish=!0,n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel,n.applyInfo.num=n.nowLevel;for(var t=(JSON.stringify(n.defaultValue),JSON.stringify(n.dataAdd),0);t<n.nowLevelIndex.length;t++)t>n.nowLevel&&(n.nowLevelIndex[t]=-1)}).error(function(e){u.showToast("获取地址信息失败！")})},n.bottomBorder={"border-bottom":"2px solid red"},n.provinceFlag=!1,n.cityFlag=!1,n.areaFlag=!1,n.selectFlag=!0,n.provinceDis=!1,n.cityDis=!1,n.areaDis=!1,n.provinceSel=function(){n.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),n.selectCity="",n.selectArea="",n.provinceFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!1,n.areaDis=!1};var A=!1;n.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<n.nowLevelIndex.length;o++)o>n.nowLevel&&(n.nowLevelIndex[o]=-1);n.dataAdd="",n.nowLevelIndex[n.nowLevel]=e;var t=arguments[1],e=arguments[0];if(n.level=n.level-1,n.defaultValue["text"+n.level]=t.text,n.defaultValue["value"+n.level]=t.value,n.level>-2)-1==n.level&&(n.selectProvince=t.text,n.provinceIndex=e,n.provinceFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.provinceTop=I.$getByHandle("mainScroll").getScrollPosition().top,n.nowLevel=n.level,n.nowLevel=-1*n.nowLevel),ah=-1*n.level,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,d.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),n.dataAdd=e.data,n.addressTipFlag=!1;var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1,n.citySel=function(){n.level=n.levelArea,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",d.getLocationList(areaValueCity,1).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1;var t=JSON.stringify(n.defaultValue),o=JSON.stringify(n.dataAdd);n.addressInit(t,o,n.flag,-1),n.selectArea="",n.cityFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!1,I.$getByHandle("mainScroll").scrollTo(0,n.cityTop)}).error(function(e){u.showToast("获取地址信息失败！")})};else if(n.level>-4&&-3!=n.level)n.selectCity=n.defaultValue["text-2"],n.provinceFlag=!1,n.cityFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!1,n.cityTop=I.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*n.level,n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,s.getLocationList(t.value,ah).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1,n.areaSel=function(){n.addressTip="正在获取地址信息...",n.addressTipFlag=!0,n.dataAdd="",n.level=n.levelArea,s.getLocationList(areaValue,2).success(function(e){n.dataAdd=e.data,n.addressTipFlag=!1;var t=JSON.stringify(n.defaultValue),o=JSON.stringify(n.dataAdd);n.addressInit(t,o,n.flag,n.level),I.$getByHandle("mainScroll").scrollTo(0,n.areaTop),n.areaFlag=!0,n.selectFlag=!1,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!0}).error(function(e){u.showToast("获取地址信息失败！")})};else if(-3==n.level)n.addressModal.hide(),n.regionTrue=!0,n.textOne=n.defaultValue["text-1"],n.textTwo=n.defaultValue["text-2"],n.textThree=n.defaultValue["text-3"],n.adrProvinceId=n.defaultValue["value-1"],n.adrCityId=n.defaultValue["value-2"],n.adrAreaId=n.defaultValue["value-3"],n.addressName=n.textOne+" "+n.textTwo+" "+n.textThree,n.selectArea=t.text,n.cityFlag=!1,n.areaFlag=!1,n.selectFlag=!0,n.provinceDis=!0,n.cityDis=!0,n.areaDis=!0,n.areaTop=I.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*n.level,s.getLocationList(t.value,ah).success(function(e){n.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(n.defaultValue),s=JSON.stringify(n.dataAdd);n.addressInit(o,s,n.flag,n.level)}).error(function(e){u.showToast("获取地址信息失败！")}),n.levelArea=n.level,n.levelArea=n.levelArea+1;else{if(A)return;$(function(){A=!1},1500),r.$broadcast(n.flag,n.defaultValue),A=!0,n.closeAddressModal()}},300),n.getPosition=function(){if("定位中···"!=r.globalConstant.autoPosition){b=p.getAddressInfo();var e=b.regionName+"/"+b.streetName;d.addAddress(b.provinceId,b.cityId,b.areaId,e,b.streetId).success(function(){var e={"text-1":b.provinceName,"text-2":b.cityName,"text-3":b.regionName,"value-1":b.provinceId,"value-2":b.cityId,"value-3":b.areaId};r.$broadcast(n.flag,e),n.addressModal.hide()})}},w.fromTemplateUrl("templates/common/CommonLocation.html",{scope:n,animation:"slide-in-up"}).then(function(e){n.addressModal=e}),n.closeAddressModal=function(){n.addressModal.hide()},n.$on("$destroy",function(){n.addressModal.remove()}),r.$on("SHOP_APPLY_ADDRESS",function(e,t){n.goToAddress=!0,n.textOne=t["text-1"],n.textTwo=t["text-2"],n.textThree=t["text-3"],n.adrProvinceId=t["value-1"],n.adrCityId=t["value-2"],n.adrAreaId=t["value-3"],n.addressName=n.textOne+n.textTwo+n.textThree}),r.$on("SHOP_APPLY_UNION",function(e,t){n.textUnion=t.text,n.valueUnion=t.value}),n.checkChange=function(e,t){l.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&u.showToast("请不要使用违禁词！"),1==t?n.applyInfo.ownerName="":n.applyInfo.storeName="")})},n.goCommonUnion=function(){"请选择"==n.addressName?u.showToast("请选择所在地区！"):c.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};n.$watch("applyInfo",function(){n.applyInfo.storeName&&n.applyInfo.category?0==n.promotionCode.length&&0==n.applyInfo.promotionCode.length?n.isComplete=!1:n.isComplete=!0:n.isComplete=!1},!0);n.goAuthentication=function(){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(n.showAlert=!1,n.applyInfo.storeName.length<=1)u.showToast("店铺名字为2～20的常用字符！");else if(/[\ud800-\udbff][\udc00-\udfff]/g.test(n.applyInfo.storeName))u.showToast("亲，不可以使用表情喔!");else if(t.test(n.applyInfo.storeName))u.showToast("店铺名称不能包含特殊字符!");else if(0==n.addressName.length)u.showToast("请选择所在地区！");else if(n.selectText)if(/^(HR|hr|Hr|hR).{6,18}$/.test(n.applyInfo.hrCode)||"10"!=n.selectValue)if(0==n.promotionCode.length&&0==n.applyInfo.promotionCode.length)u.showToast("请填写推荐码!");else{n.xyzPromotionCode=0==n.promotionCode.length?n.applyInfo.promotionCode:n.promotionCode;var s={storeName:n.applyInfo.storeName,memberType:n.selectValue,provinceId:n.adrProvinceId,cityId:n.adrCityId,regionId:n.adrAreaId,regionName:n.addressName,address:n.applyInfo.address,promotionCode:n.applyInfo.promotionCode,hrCode:n.applyInfo.hrCode,isPromotionCode:n.promotionCode};a.setObject("newAuthentication_obj",s);var i=0==n.promotionCode.length?n.applyInfo.promotionCode:n.promotionCode;n.register_obj=a.getObject("register_obj"),n.register_obj.mobileNum!=n.iphoneNumber&&100==n.types?l.newShop(n.applyInfo.storeName,n.selectValue,i,n.applyInfo.hrCode,n.adrProvinceId,n.adrCityId,n.adrAreaId,n.addressName,n.applyInfo.address,n.register_obj.mobileNum,n.register_obj.password,n.register_obj.captcha,n.register_obj.imgCaptcha).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?a.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):a.set("sg_login_token_secret","Bearer"+e.generateUUID())),o.initWebSocket(),$(function(){c.go("shopApplySuccess")},100)):u.showToast(t.message)}):l.applySubmitStore(n.memberId,n.applyInfo.storeName,n.selectValue,i,n.applyInfo.hrCode,n.adrProvinceId,n.adrCityId,n.adrAreaId,n.addressName,n.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?a.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):a.set("sg_login_token_secret","Bearer"+e.generateUUID())),$(function(){c.go("shopApplySuccess")},100)):u.showToast(t.message)})}else u.showToast("上岗证号必须为HR开头，总长度8-20位！");else u.showToast("请选择类别！")},n.getPromotionCode=function(){if(!(n.adrAreaId||"请选择"!=n.addressName||n.adrCityId||n.adrProvinceId))return void u.showToast("请选择地址");0!=n.promotionCode.length?u.showToast("您已有推荐码，快快完成注册吧。"):0!=n.applyInfo.promotionCode.length?u.showToast("您已有推荐码，快快完成注册吧。"):l.getPromotion(n.adrAreaId).success(function(e){e.success?null!=e.data&&(n.applyInfo.promotionCode=e.data):u.showToast(e.message)})},n.isFocus=function(){n.isHasKey=!0},n.isBlur=function(){n.isHasKey=!1},n.isClear=function(){n.applyInfo.address="",n.isHasKey=!1},n.clearInput=function(){n.applyInfo.ownerName=void 0,n.applyInfo.address=void 0,n.applyInfo.storeName=void 0,n.addressName="请选择",n.applyInfo.hrCode=void 0,n.selectText="请选择"},n.$on("$ionicView.beforeLeave",function(e,t){n.watch()}),n.$on("$ionicView.beforeEnter",function(e,t){if(n.memberId=m.getUser().mid,n.iphoneNumber=m.getUser().mobile,n.dataAdd=null,n.defaultValue=null,n.hrCodes=!1,n.promotionCode=h.promotionCode,n.types=h.types,n.nowLevel=0,n.nowLevelIndex=[-1,-1,-1,-1],n.provinceTop=0,n.cityTop=0,n.areaTop=0,n.finish=!1,n.watch=n.$watch("finish",function(e,t){e&&I.$getByHandle("mainScroll").scrollTo(0,n.provinceTop)}),m.isUserLogin()){if(10==g.getRole())return v.show({template:"您已经是店主了,进店看看吧",duration:2500}),void $(function(){},2e3).then(function(){c.go("homePage")});n.init()}else n.init();"back"==t.direction?(void 0==n.selectValue&&(n.selectText="请选择"),n.addressName=n.textOne+" "+n.textTwo+" "+n.textThree):(n.clearInput(),n.applyInfo.storeName="",n.applyInfo.category="",n.applyInfo.promotionCode="",n.addressName="请选择",n.selectText="请选择"),n.addressInit(n.dataAdd,n.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("ShopApplyService",["$http","UrlService","$window",function(e,t,o){this.applySubmit=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,storeName:s,memberRealName:i,provinceId:a,cityId:n,regionId:r,streetId:c,regionName:l,address:d,memberType:p,memberName:u,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:$})},this.checkPerfectInformation=function(o,s,i,a,n,r,c,l,d,p){var u={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,streetId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:u})},this.checkText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),s)},this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.getPromotion=function(o){var s={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:s})},this.newShop=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,regionName:l,address:d,mobileNum:p,password:encodeURIComponent(u),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,s,i,a,n,r,c,l,d,p){var u={memberId:o,storeName:s,memberType:i,promotionCode:a,hrCode:n,provinceId:r,cityId:c,regionId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:u})}}]),APP.controller("newAuthenticationHomeV2",["GetStatisticInfoService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","OpenStoreService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w){a.localStorage=window.localStorage,a.promotionEditable=!0,a.addressName="请选择",a.goToAddress=!1,a.categoryData=[],a.selectText="请选择",a.selectKey="",a.isComplete=!1,a.isHasKey=!1,a.hrCodes=!1,a.promotionCode="",a.avatarImage="img/registerSuccess.png",a.userInfo={picTempFile:""};var y=window.innerHeight,T=y-373+"px";a.contentHeight={height:T},a.addressTitle="配送至",a.dataAdd=null,a.flag="SHOP_APPLY_ADDRESS",a.defaultValue=null,a.level=0;var C={};a.user={},a.mid=g.getUser().mid,a.init=function(){a.user=g.getUser(),void 0!=a.user.avatarImageFileId&&(a.avatarImage=a.user.avatarImageFileId),a.showAlert=!1,a.goToAddress?a.addressName=a.textOne+a.textTwo+a.textThree:"请选择"==a.addressName&&n.globalConstant.positionStatus&&a.getPosition(),a.textUnion&&(a.selectText=a.textUnion),a.applyInfo.category=a.selectText,a.selectText&&(a.infos=a.selectText.substring(0,4),"人人服务"==a.infos?a.hrCodes=!0:a.hrCodes=!1),a.selectValue=a.valueUnion,a.mid=g.getUser().mid,a.mid&&m.getStoreInfo(a.mid).success(function(e,t,o,s){e.success&&(a.storeCode=e.data.storeCode,a.storeType=e.data.storeType)})},a.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)},a.addressInit=function(e,t,o,s){if(a.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=e?JSON.parse(e):{},a.level=s,t){a.dataAdd=JSON.parse(t),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.arr=a.nowLevelIndex;for(var i=0;i<a.nowLevelIndex.length;i++)i>a.nowLevel&&(a.nowLevelIndex[i]=-1)}else a.finish=!1,a.dataAdd="",w.get("data/region.json").success(function(e){a.dataAdd=e.data,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel;for(var t=0;t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var b=!1;a.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=e;var t=arguments[1],e=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=t.text,a.defaultValue["value"+a.level]=t.value,a.level>-2)w.get("data/region.json").success(function(o){-1==a.level?(a.selectProvince=t.text,a.provinceIndex=e,a.dataAdd=o.data[e].children,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel,a.citySel=function(){a.dataAdd="",a.addressInit(s,i,a.flag,-1),a.dataAdd=o.data[e].children,a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}):a.dataAdd=a.dataAdd[e].children;var s=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(s,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")});else if(a.level>-4&&-3!=a.level)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,a.selectArea=t.text,a.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,o.getLocationList(t.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(o,s,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",a.level=a.levelArea,o.getLocationList(areaValue,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),S.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else if(-3==a.level)a.addressModal.hide(),a.regionTrue=!0,a.textOne=a.defaultValue["text-1"],a.textTwo=a.defaultValue["text-2"],a.textThree=a.defaultValue["text-3"],a.adrProvinceId=a.defaultValue["value-1"],a.adrCityId=a.defaultValue["value-2"],a.adrAreaId=a.defaultValue["value-3"],a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree,a.selectArea=t.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,o.getLocationList(t.value,ah).success(function(e){a.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(o,s,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1;else{if(b)return;v(function(){b=!1},1500),n.$broadcast(a.flag,a.defaultValue),b=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=n.globalConstant.autoPosition){C=d.getAddressInfo();var e=C.regionName+"/"+C.streetName;l.addAddress(C.provinceId,C.cityId,C.areaId,e,C.streetId).success(function(){var e={"text-1":C.provinceName,"text-2":C.cityName,"text-3":C.regionName,"value-1":C.provinceId,"value-2":C.cityId,"value-3":C.areaId};n.$broadcast(a.flag,e),a.addressModal.hide()})}},I.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},a.$on("$destroy",function(){a.addressModal.remove()}),n.$on("SHOP_APPLY_ADDRESS",function(e,t){a.goToAddress=!0,a.textOne=t["text-1"],a.textTwo=t["text-2"],a.textThree=t["text-3"],a.adrProvinceId=t["value-1"],a.adrCityId=t["value-2"],a.adrAreaId=t["value-3"],a.addressName=a.textOne+a.textTwo+a.textThree}),n.$on("SHOP_APPLY_UNION",function(e,t){a.textUnion=t.text,a.valueUnion=t.value}),a.checkChange=function(e,t){c.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&p.showToast("请不要使用违禁词！"),1==t?a.applyInfo.ownerName="":a.applyInfo.storeName="")})},a.goCommonUnion=function(){r.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};a.$watch("applyInfo",function(){a.selectValue&&a.applyInfo.category&&a.addressName&&null!=a.addressName&&0!=a.addressName.length&&"请选择"!=a.addressName&&(0!=a.promotionCode.length||0!=a.applyInfo.promotionCode.length)?a.isComplete=!0:a.isComplete=!1},!0);a.goAuthentication=function(){new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(a.showAlert=!1,0==a.addressName.length)p.showToast("请选择所在地区！");else if(a.selectValue)if(/^(HR|hr|Hr|hR).{6,18}$/.test(a.applyInfo.hrCode)||"10"!=a.selectValue)if(0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length)p.showToast("请填写推荐码!");else{a.promotionCode&&a.promotionCode.length>0?a.promotionCode:a.applyInfo.promotionCode;c.getPromotionUserInfo(a.promotionCode&&a.promotionCode.length>0?a.promotionCode:a.applyInfo.promotionCode).success(function(o){if(o.success){if(!o.data||null==o.data)return void p.showToast("推荐码不存在！");var s=p.dialog({onOpen:function(){this.find(".promotion-code").html(o.data.promotionCode),this.find(".parent-name").html(o.data.realName),this.find(".parent-mobile").html(o.data.mobile)},content:'<div style="background:#ffffff;width:304px;border-radius:8px;">                            <div style="padding:20px 10px;">                              <div>                                <h6 align="center" style="font-size:16px;line-height: 16px;color:#333333;">请确认您的推荐人信息</h6>                                <h2 align="center" class="promotion-code" style="font-size:22px;line-height:22px;"></h2>                              </div>                              <div style="padding:10px;margin:-10px auto;">                                <div style="margin: 0 auto;width: 0px;height: 0px;border-width: 10px;border-style: solid;border-color: #ffffff #ffffff #EEEEEE #ffffff;"></div>                                <div style="background:#EEEEEE;padding:20px;border-radius:4px;width:231px;margin:0px auto;">                                  <h5 style="color:#666666;font-size: 16px;line-height: 22px;">推荐人姓名：<span class="parent-name"></span></h5>                                  <h5 style="color:#666666;font-size: 16px;line-height: 22px;">推荐人电话：<span class="parent-mobile"></span></h5>                                </div>                                <h6 style="font-size:12px;line-height: 17px;color:#666666;">推荐人将成为您的服务导师，助您快速创业，请谨慎填写，一旦提交不支持修改!</h6>                              </div>                            </div>                            <div style="display:flex;flex-direction: row;justify-content:center;">                              <div class="cancel-btn" style="flex:1;text-align: center;background:#FFFFFF ;padding:10px;border-top:1px solid #EEEEEE;border-radius:0 0 0 8px;color:#2979FF;font-size:17px">取消</div>                              <div class="ok-btn" style="flex:1;text-align: center;background:#2979FF;padding:10px; border-radius:0 0 8px 0;color:#FFFFFF;font-size:17px">确定</div>                            </div>                          </div>',buttons:[{selector:".ok-btn",handler:function(){s.remove(),a.xyzPromotionCode=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;var o={memberType:a.selectValue,provinceId:a.adrProvinceId,cityId:a.adrCityId,regionId:a.adrAreaId,regionName:a.addressName,promotionCode:a.applyInfo.promotionCode,hrCode:a.applyInfo.hrCode,isPromotionCode:a.promotionCode};i.setObject("newAuthentication_obj",o);var n=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;a.memberId?c.applySubmitStore(a.memberId,a.applyInfo.storeName,a.selectValue,n,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(g.setUser(t.data.member),t.data.member.sessionValue?i.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):i.set("sg_login_token_secret","Bearer"+e.generateUUID())),v(function(){r.go("shopApplySuccess")},100)):p.showToast(t.message)}):(a.register_obj=i.getObject("register_obj"),c.newShop(a.applyInfo.storeName,a.selectValue,n,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address,a.register_obj.mobileNum,a.register_obj.password,a.register_obj.captcha,a.register_obj.imgCaptcha).success(function(o){o.success?(null!=o.data.member&&(g.setUser(o.data.member),o.data.member.sessionValue?i.set("sg_login_token_secret","Bearer"+o.data.member.sessionValue):i.set("sg_login_token_secret","Bearer"+e.generateUUID())),t.initWebSocket(),v(function(){r.go("shopApplySuccess")},100)):p.showToast(o.message)}))}},{selector:".cancel-btn",handler:function(){s.remove()}}]})}else o.message?p.showToast(o.message):p.showToast("获取推荐人信息失败！")})}else p.showToast("上岗证号必须为HR开头，总长度8-20位！");else p.showToast("请选择类别！")},a.getPromotionCode=function(){if(!(a.adrAreaId||"请选择"!=a.addressName||a.adrCityId||a.adrProvinceId))return void p.showToast("请选择地址");0!=a.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):0!=a.applyInfo.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):c.getPromotion(a.adrAreaId).success(function(e){e.success?null!=e.data&&(a.applyInfo.promotionCode=e.data):p.showToast(e.message)})},a.isFocus=function(){a.isHasKey=!0},a.isBlur=function(){a.isHasKey=!1},a.isClear=function(){a.applyInfo.address="",a.isHasKey=!1},a.clearInput=function(){a.applyInfo.ownerName=void 0,a.applyInfo.address=void 0,a.applyInfo.storeName=void 0,a.addressName="请选择",a.applyInfo.hrCode=void 0,a.selectText="请选择"},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(e,t){if(a.promotionEditable=f.promotionCode&&null!=f.promotionCode&&""!=f.promotionCode,a.memberId=g.getUser().mid,a.dataAdd=null,a.defaultValue=null,a.hrCodes=!1,a.promotionCode=f.promotionCode,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),g.isUserLogin()&&1==u.getRole())return h.show({template:"您已经是店主了,进店看看吧",duration:2500}),void v(function(){},2e3).then(function(){r.go("homePage")});a.init(),a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("OpenStoreService",["$http","UrlService","$window",function(e,t,o){this.getPromotionUserInfo=function(o){return e({method:"GET",url:t.getUrl("GET_PROMOTION_USER_INFO")+"?promotionCode="+o})},this.applySubmit=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,storeName:s,memberRealName:i,provinceId:a,cityId:n,regionId:r,streetId:c,regionName:l,address:d,memberType:p,memberName:u,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:$})},this.checkPerfectInformation=function(o,s,i,a,n,r,c,l,d,p){var u={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,streetId:l,regionName:d,address:p};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:u})},this.checkText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),s)},this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.getPromotion=function(o){var s={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:s})},this.newShop=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={storeName:o,memberType:s,promotionCode:i,hrCode:a,provinceId:n,cityId:r,regionId:c,regionName:l,address:d,mobileNum:p,password:encodeURIComponent(u),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,s,i,a,n,r,c,l,d,p){var u={memberId:o,memberType:i,promotionCode:a,hrCode:n,provinceId:r,
cityId:c,regionId:l,regionName:d};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:u})}}]),APP.controller("trueAuthenticationControl",["PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){p.isMake=!1,p.isMatching=!1,p.isPrompts=!1,p.isPopup=!1,p.isRetry=!1,p.isOther=!1,p.isTrueMsg=!1,p.isAgain=!1,p.userType=l.type,p.IDNumber="",p.userName="",p.storeCode=0,p.storeType=0,p.channal="APP",p.obj={isMyName:"",isMyIdNumber:""},p.init=function(){g.doInit().success(function(e){e.success?(p.isNotAuthentication=e.data.isAuth,null!=e.data.identity&&p.isNotAuthentication?(p.isOkAuthentication={color:"#999"},p.IDNumber=e.data.identity.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,s){for(var i="";i.length<o.length;)i+="*";return t+i+s}),p.userName=e.data.identity.realName.replace(/.{1}/,"*"),p.obj.isMyName=e.data.identity.realName,p.obj.isMyIdNumber=e.data.identity.identityNo,p.phoneNumber=e.data.identity.mobile):(p.isOkAuthentication={color:"#000"},p.isNotAuthentication=!1,p.phoneNumber=a.getUser().mobile,p.isPopup=!1,p.isMake=!1,p.isMatching=!1,p.isPrompts=!1)):(p.message=e.message,p.isRetry=!0)})},p.retry=function(){p.isRetry=!1},p.IwantETC=function(){p.isTrueMsg=!1},p.commonFunctions=function(){p.isPopup=!0,d(function(){p.isPopup=!1,u.go("homePage")},1e3)},p.clickOk=function(){t.checkOpenStore(p.memberId).success(function(e,t,i,a){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){f.get(s.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?p.isTrueMsg=!0:(p.isTrueMsg=!1,g.postUserMsg(p.obj.isMyName,p.obj.isMyIdNumber,p.phoneNumber,p.channal).success(function(e){e.data?(p.message=e.message,o.loginIsAuthentication=!1,p.isPopup=!0,p.isMatching=!1,p.isRetry=!1,p.isOther=!1,d(function(){p.isPopup=!1,u.go("homePage")},1e3)):(p.message=e.message,p.isRetry=!0,p.isMatching=!0,p.isPrompts=!1,p.isPopup=!1)}))}).error(function(t){e.showToast("网络连接失败！")})},p.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,t):u.go("helpDetail",{helpId:e,content:t})},p.isSubmit=function(){p.isTrueMsg=!1,g.postUserMsg(p.obj.isMyName,p.obj.isMyIdNumber,p.phoneNumber,p.channal).success(function(e){e.data?(p.message=e.message,p.isMatching=!1,p.isRetry=!1,p.isOther=!1,p.isPopup=!0,p.isPrompts=!1,o.loginIsAuthentication=!1,p.mentionCenterNum=o.canGetMount,d(function(){p.isPopup=!1,5==p.userType?u.go("bankCard"):2==p.userType?u.go("homePage"):8==p.userType?u.go("mentionCenter",{canAmount:p.mentionCenterNum}):u.go("personnalCenter")},600)):(p.message=e.message,p.isRetry=!0,p.isMatching=!0,p.isPrompts=!1,p.isPopup=!1)})},p.retry=function(){p.isRetry=!1};p.$watch("obj",function(){/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/.test(p.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(p.obj.isMyIdNumber)?g.getUsNameOrId(p.obj.isMyName,p.obj.isMyIdNumber).success(function(e){e.data?(p.message=e.message,p.isPrompts=!0,p.isMake=!0,p.isMatching=!1,p.isRetry=!1):(p.message=e.message,p.isMake=!1,p.isPrompts=!1,p.isMatching=!0,p.isRetry=!1)}):(p.isMake=!1,p.isPrompts=!1,p.isMatching=!1)},!0);p.goBack=function(){n.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"60px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"44px"}),p.$on("$ionicView.beforeEnter",function(){p.memberId=a.getUser().mid,p.isPopup=!1,p.isRetry=!1,p.isMake=!1,p.isMatching=!1,p.isPrompts=!1,p.newAuthentication_obj=r.getObject("newAuthentication_obj"),p.register_obj=r.getObject("register_obj"),p.promotionCodeRouter=p.newAuthentication_obj.isPromotionCode,p.promotionCodeRouter&&(p.phoneNumber=p.register_obj.mobileNum),p.memberId&&p.promotionCodeRouter&&(p.phoneNumber=p.register_obj.mobileNum),p.init(),p.obj.isMyName="",p.obj.isMyIdNumber=""})}]),APP.service("trueAuthenticationService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("TRUE_REALNAMEAUTH"))},this.getUsNameOrId=function(o,s){var i={realName:o,identityNo:s};return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:i})},this.postUserMsg=function(o,s,i,a){var n={realName:o,identityNo:s,mobile:i,channal:a};return e({method:"POST",url:t.getUrl("POST_USERDATAANDID"),params:n})},this.postUserInfoPC=function(o,s,i){var a={realName:o,identityNo:s,mobile:i};return e({method:"POST",url:t.getUrl("POST_USERDATA"),params:a})}}]),APP.controller("trueAuthenticationListControl",["trueAuthenticationService","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationListService","IMService","$http",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){u.isTrueAuthentication=!1,u.isStaff=!1,u.init=function(){e.doInit().success(function(e){e.success?(null!=e.data.identity?u.isTrueAuthentication=!0:u.isTrueAuthentication=!1,null!=e.data.empInfo?u.isStaff=!0:u.isStaff=!1):t.showToast(e.message)})},u.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?a.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,t):g.go("helpDetail",{helpId:e,content:t})},u.goBack=function(){r.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.$on("$ionicView.beforeEnter",function(){u.init()})}]),APP.service("trueAuthenticationListService",["$http","UrlService",function(e,t){}]),APP.controller("CarTrackController",["$scope","$stateParams","$sce",function(e,t,o){e.trackUrl=o.trustAsResourceUrl(t.trackUrl)}]),APP.controller("ConfirmReceiveController",["$scope","PopupService","$stateParams","ConfirmReceiveService","$ionicViewSwitcher","$state",function(e,t,o,s,i,a){function n(){s.getConfirmList(e.orderId).success(function(t){t.success&&(e.confirmCount=t.data.numberCount,e.confirmReceivelist=t.data.orderProductList)})}e.orderId="",e.confirmCount="",e.confirmReceivelist=[],e.confirmReceive=function(e){function o(o){o&&s.confirmReceive(e).success(function(e){e.success?n():t.showToast(e.message)})}t.showConfirm("",'"确认收货"将代表您已收到所购商品！',o,"确认")},e.goOrderManage=function(){i.nextDirection("forward"),a.go("orderManage")},e.$on("$ionicView.beforeEnter",function(t,s){e.orderId=o.orderId,n()})}]),APP.service("ConfirmReceiveService",["$http","UrlService",function(e,t){this.getConfirmList=function(o){var s={orderId:o};return e.get(t.getUrl("GET_CONFIRM_RECEIVE_LIST"),s)},this.confirmReceive=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CONFIRM_RECEIVE"),s)}}]),APP.controller("SendGoodsTimeController",["$ionicHistory","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","SendGoodsTimeService","PopupService","$timeout",function(e,t,o,s,i,a,n,r,c){t.htmlContent=o.content,t.title=o.title,t.data={time:[{text:"9:00-13:00"},{text:"13:00-18:00"},{text:"18:00-21:00"}]},t.zfb_checked=!0,t.huod_checked=!1,t.kjt_checked=!1,t.init=function(){t.htmlContent=o.content,t.title=o.title,t.dateTimes=[],t.datas={},n.getSendGoodsDates().success(function(e,o,s,i){t.storeInfo=e.data;for(var a=0;a<e.data.length;a++)t.datas={text:e.data[a]},t.dateTimes.push(t.datas)})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.chooseDate=function(){a.show({buttons:t.dateTimes,cancel:function(){},buttonClicked:function(e){return t.dateChoose=t.dateTimes[e].text,!0},cssClass:"limitScrollHeight"})},t.chooseTime=function(){a.show({buttons:t.data.time,cancel:function(){},buttonClicked:function(e){return t.timeChoose=t.data.time[e].text,!0}})},t.confirm=function(){if(!t.dateChoose)return void r.showToast("请填写配送时间");t.dateChoose=t.dateChoose.substr(0,10),t.timeChoose="",n.confirmSendGoodsDates(1,t.dateChoose,t.timeChoose).success(function(t,o,s,i){1==t.success&&e.goBack()})}}]),APP.service("SendGoodsTimeService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){return e({method:"POST",url:t.getUrl("PAY_WAY")})},this.confirmSendGoodsDates=function(o,s,i){var a={cd:o,day:s,time:i};return e({method:"POST",url:t.getUrl("SUBMIT_DELIVE_WAY"),params:a})}}]),APP.controller("AfterOrderSubmitController",["$scope","$stateParams","$rootScope","$ionicLoading","PaymentService","$ionicHistory","PopupService","InAppBrowserService","$state","EasyConnectService","$ionicPopup","AfterOrderSubmitService","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.htmlContent=t.content,e.title=t.title,e.payment="",e.showPay=!0,e.isToStore=!1;var g="";e.paymentCode=t.paymentCode;var m,f,h;e.init=function(){e.htmlContent=t.content,e.title=t.title,e.messageData=t.messageData,e.data=JSON.parse(e.messageData),m=e.data.os,f=e.data.pyc,h=e.data.oa},e.payTest=function(e,t,o){return void c.go("paymentxyz",{orderSn:e,totalAmount:o})},e.orderRace=function(){window.location.href=u.getThirdUrl("race/")},e.goToStore=function(){c.go("myStore",{storeId:g,shareStoreId:g})},e.goBack=function(){a.goBack(-2)},e.orderRace=function(){window.location.href=u.getThirdUrl("race/")},e.$on("$ionicView.beforeEnter",function(){e.init();var t=a.viewHistory().histories.root.stack,o=t.length;t[o-3]&&"productDetail"==t[o-3].stateName?g=t[o-3].stateParams.shareStoreId:t[o-4]&&"productDetail"==t[o-4].stateName&&(g=t[o-4].stateParams.shareStoreId),g&&(e.isToStore=!0)})}]),APP.service("AfterOrderSubmitService",["$http","UrlService",function(e,t){this.getAliPayInfo=function(o,s,i){var a={tradeNo:o,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+o,price:s,notifyUrl:i};return e({method:"POST",url:t.getUrl("GET_ALIPAY_INFO"),params:a})}}]),APP.controller("BankCardChoseController",["bankCardPaymentListService","$scope","$stateParams","$state","$ionicHistory","PopupService","$ionicPopup","$http","UrlService","UserService",function(e,t,o,s,i,a,n,r,c,l,d){t.orderSn=o.orderSn,t.totalAmount=o.totalAmount,t.cardsArr=[],t.goCart=function(){s.go("orderManage")},t.toPay=function(e){var o={orderSn:t.orderSn,totalAmount:t.totalAmount,whereName:e};switch(e){case"ccb_credit":s.go("debitCardPayment",o);break;case"ccb_fenqi":s.go("ccbfenqi",o);break;case"ceb_credit":s.go("debitCardPayment",o);break;case"ceb_fenqi":s.go("ccbfenqi",o)}},t.goBack=function(){t.$ionicGoBack()},t.$on("$ionicView.beforeEnter",function(){e.getCcbCost("sg").success(function(e){e.success&&(t.cardsArr=e.data)})})}]),APP.service("bankCardPaymentListService",["$http","UrlService",function(e,t){this.getCcbCost=function(o){var s=t.getPayCenter("PAY_TYPE_LIST")+"?callback=JSON_CALLBACK&channel="+o+"&category=1";return e.jsonp(s)}}]),APP.controller("CcbPayController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,s,i,a,n){e.ccbUrl=o.trustAsResourceUrl(t.url),window.screen.width<=320?e.height="50%":e.height="80%";t.orderSn;e.goBack=function(){n.go("orderManage")}}]),APP.controller("CcbFenqiController",["$q","CcbFenqiService","$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","InAppBrowserService","UrlService","PaymentService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){function h(o){var s=e.defer();return t.payRequest(o).success(function(e){s.resolve(e)}),s.promise}function v(e){var t="";if("ceb_fenqi"==s.whereName)t=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var n="";e.data.ccbfenqi.INSTALLNUM&&(n="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),t=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+n+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}if(i.isIOS){var r=null;r=cordova.InAppBrowser.open(t,"_blank","location=no,shownativetitlebar=yes,titlebartitlestr="+o.title+"分期"),r.addEventListener("exit",function(e){a.go("orderManage")}),r.addEventListener("loadstart",function(e){-1!=e.url.indexOf("orderManage")&&(r.close(),a.go("orderManage"))})}else a.go("ccbPay",{url:t,orderSn:o.orderSn})}o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/CCB.png",o.title="建行信用卡",s.whereName.indexOf("ceb")>=0&&(o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/12CEB.png",o.title="光大信用卡"),o.whereName=s.whereName,o.$on("$ionicView.beforeEnter",function(){o.isAndroid=ionic.Platform.isAndroid(),o.isAndroid?o.androidOrIosStyle={right:"5px"}:o.androidOrIosStyle={left:"70px"},o.isShowDet=!1,o.isChooseFenqi=!1,o.orderSn=s.orderSn,t.getCcbCost(o.orderSn,"sg",s.whereName).success(function(e){o.payList=e.data.costInfo,o.totalFee=e.data.totalFee,o.benefitFee=e.data.benefitFee,o.payFee=e.data.payFee,o.cfgMark=e.data.cfgMark,o.feeInfo=null!=e.data.feeInfo&&e.data.feeInfo;for(var t=o.payList.length,s=0;s<t;s++)o.payList[s].fenqiNum=!1;o.payList[0].fenqiNum=!0,o.number=o.payList[0].number;for(var s=t-1;s>=0;s--)1==o.payList[s].isFree?o.payList[s].isFree=!0:o.payList[s].isFree=!1})}),o.showDetail=function(){o.isShowDet=!o.isShowDet},o.changeFenqiNum=function(e){o.isChooseFenqi=!0;for(var t=o.payList.length,s=0;s<t;s++)o.payList[s].number==e?(o.payList[s].fenqiNum=!0,o.number=e):o.payList[s].fenqiNum=!1},o.toPay=function(){if(!o.number)return void l.showToast("请选择一种分期方式");if(window.cordova){var e={orderSn:o.orderSn};m.orderPayCheck(e).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:s.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){13!=e.errorCode&&e.success?v(e):13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){e.success&&v(e)})):a.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}else{var t={orderSn:o.orderSn};m.orderPayCheck(t).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:s.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){if(13!=e.errorCode&&e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var s="";e.data.ccbfenqi.INSTALLNUM&&(s="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+s+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}else 13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){if(e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var s="";e.data.ccbfenqi.INSTALLNUM&&(s="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM);var o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+s+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}})):a.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}}}]),APP.service("CcbFenqiService",["$http","UrlService","UserService",function(e,t,o){this.getCcbCost=function(s,i,a){var n=t.getPayCenter("CCB_FENQI")+"?callback=JSON_CALLBACK&orderSn="+s+"&channel="+i+"&payType="+a+"&version=1&memberId="+o.getUser().mid;return e.jsonp(n)},this.payRequest=function(o,s){var i="";if(o.joinActivity)var i="&joinActivity=1";var a=t.getPayCenter("CCB_FENQI_W")+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+i;return e.jsonp(a)},this.payRequestWithGuangDaTest=function(o){var s="";if(o.joinActivity)var s="&joinActivity=1";var i=t.getGuangDaTestPay()+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+s;return e.jsonp(i)}}]),APP.controller("choiceOfGiftsController",["spacificationsService","$ionicModal","$scope","$stateParams","$rootScope","$state","$ionicPopup","$timeout","PopupService","LoginService","$http","$ionicHistory","$ionicScrollDelegate","$ionicLoading","UrlService","choiceOfGiftsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){o.clientSideList=[],o.isGoBack=!1,o.data=[],o.postArr=[],o.num=0,o.goBack=function(){o.num>0?o.isGoBack=!0:(o.isGoBack=!1,p.goBack())},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.init=function(){f.doInit().success(function(e){e.success&&null!=e.result?o.clientSideList=e.result:c.showToast("获取数据为空或者失败")})},o.changeType=function(e,t,s){if(1==t)c.showToast("您已选择了此商品");else{o.num++;for(var i=0;i<e.length;i++)e[i].isDefault="0";e[s].isDefault="1"}},o.goBackFill=function(){o.isGoBack=!1},o.clickOk=function(){o.isGoBack=!1,p.goBack()},o.showDetailInfo=function(t){u.$getByHandle("mainScroll").scrollTop(),o.StoreModal.show(),e.doInit(t).success(function(e,t,s,i){null==e.data?o.data=[]:o.data=e.data.productAttrs})},o.preservation=function(){o.postArr=[];for(var e=0;e<o.clientSideList.length;e++)for(var t=0;t<o.clientSideList[e].length;t++)1==o.clientSideList[e][t].isDefault&&o.postArr.push({g:o.clientSideList[e][t].group,s:o.clientSideList[e][t].spu});f.toSubmit(o.postArr).success(function(e){e.success&&e.result?(c.showToast(e.message),p.goBack()):c.showToast(e.message)})},t.fromTemplateUrl("templates/common/commonGifts.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.StoreModal=e}),o.closeStoreModal=function(){o.StoreModal.hide()};var h=window.innerHeight,v=h-370+"px";o.storeContentHeight={height:"auto"},o.contentHeight={height:v};var $=h-370+50+"px";o.storeMsgTop={top:$},o.$on("$ionicView.beforeEnter",function(e,t){o.isGoBack=!1,o.clientSideList=[],o.data=[],o.postArr=[],o.num=0,o.init()})}]),APP.service("choiceOfGiftsService",["$http","UrlService",function(e,t){this.doInit=function(){return e({method:"POST",url:t.getUrl("GET_GIFTS")})},this.toSubmit=function(o){var s={p:o},i=t.getUrl("PRESERVATION_GIFTS",s);return e({headers:{},method:"POST",url:i,data:s})}}]),APP.controller("debitCardPaymentController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){o.totalAmount,o.orderSn;t.whereName=o.whereName,t.goBack=function(){c.goBack()}}]),APP.controller("OrderConfirmController",["$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory","$ionicScrollDelegate","$ionicLoading",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(){e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.couponsPrice=0,e.couponAmount=0,e.allPrice=0,e.newPrice=0,e.orderData={},e.htmlContent=t.content,e.title=t.title,e.searchGoodsName.name=null,e.searchGoodsName.giftName=null,e.codFlag=!1,e.couponsDiscount=null,e.buttonDisabled=[!0,!0,!0],w=[]}function f(){if(!0!==e.disableSubmitBtn)if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))e.disableSubmitBtn=!0,e.isHasCode=!1,e.isFillIn=!0,i.toSubmit(e.isBooking,w).success(function(t,i,n,r){if(!0===t.success){e.disableSubmitBtn=!1,g.hide(),window.cordova&&o.gio.track("SubmitOrder",{paymentMethod:t.data.pyc,totalPrice:e.allPrice!=e.newPrice?e.newPrice:e.allPrice,productCount:e.proNumberTotal});var c=t;if(!0===c.success&&c.data&&c.data.os){var l=c.data,u=c.data.pyc;if(101==c.data.ps)return void s.go("orderManage");if(window.xneng){var m="",f=o.xnFromState,h=o.xnToState,v=o.xnFromParams,$=o.xnToParams,S=f.url.split("/:");if(S.length>0){for(var I=1;I<S.length;I++)m+="/"+v[S[I]];m=d.getHead().match(/(\S*)v3/)[1]+"www/index.html#/"+f.name+m}var w="",S=h.url.split("/:");if(S.length>0){for(var I=1;I<S.length;I++)w+="/"+$[S[I]];w=d.getHead().match(/(\S*)v3/)[1]+"www/index.html#/"+h.name+w}window.xneng.NTalkerOrderAction("提交订单",w,m,"",l.os,l.oa,function(e){},function(e){})}if(window.baifend){for(var y=[],T=[],C=[],I=0;I<e.orderConfirmMessage.ops.length;I++)y[I]=e.orderConfirmMessage.ops[I].sku,T[I]=e.orderConfirmMessage.ops[I].price,C[I]=e.orderConfirmMessage.ops[I].num;var b={uid:e.orderConfirmMessage.mid?e.orderConfirmMessage.mid+"":"",total:l.oa};o.itemId=y,o.baifendprice=T,o.proNumberTotal=C,window.baifend.onOrder(l.orderSn,y,T,C,l.orderAmount,b)}"online"==u?(e.orderConfirmMessage.tca>0&&(o.couponXyzType=!0),s.go("paymentxyz",{orderSn:t.data.os,totalAmount:t.data.oa})):s.go("afterOrderSubmit",{messageData:JSON.stringify(l),paymentCode:u})}else{var A=a.confirm({template:c.message?c.message:"创建订单失败",okText:"返回上一页",cancelText:"留在此页"});A.then(function(e){e&&p.goBack(-1)})}}else{e.disableSubmitBtn=!1,g.hide();var A=a.confirm({template:t.message,okText:"返回上一页",cancelText:"留在此页"});A.then(function(e){e&&p.goBack(-1)})}}).error(function(t){e.disableSubmitBtn=!1,g.hide()});else{a.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}}function h(t){if(e.regAddress){if(3==t||!e.orderConfirmMessage.coAmt){if(0!=t)for(var o=0;o<e.orderConfirmMessage.ops.length;o++)if(e.orderConfirmMessage.ops[o].ca)return void a.alert({template:T,okText:"知道了"});return 2==t||1!=e.giftSearchButton&&1!=e.orderConfirmMessage.useGiftCard||void a.alert({template:T,okText:"知道了"})}a.alert({template:T,okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}}function v(t){w=[],u.resize(),e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0;for(var o=t.length,s=0;s<o;s++){var i=null,a=null;i=$(I,t[s].quota),i>e.newPrice&&(i=e.newPrice),a=Math.floor($(i,t[s].proportion)),i=a/t[s].proportion,a>e.pointsList[s].count&&(a=e.pointsList[s].count,i=a/t[s].proportion),e.pointsList[s].pointDiscount=i,e.pointsList[s].canUsePoint=a,e.pointsChecked[s]=!1,S[s]=!1,e.pointsList[s].canUsePoint>0&&(e.buttonDisabled[s]=!1)}}function $(e,t){var o=0,s=e.toString(),i=t.toString();try{o+=s.split(".")[1].length}catch(e){}try{o+=i.split(".")[1].length}catch(e){}return Number(s.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,o)}e.o2oTypeMap={},e.htmlContent=t.content,e.title=t.title,e.tabNav="selection",e.couponsPrice=0,e.couponAmount=0,e.smallPrice=[],e.snewPrice=[],e.allPrice=0,e.newPrice=0,e.isBook=t.Book,e.attrValueNames=t.attrValueNames||"",e.skku=t.skku||"",e.disableSubmitBtn=!1,e.searchGoodsName={name:"",giftName:""},e.invoiceHead=void 0,e.zzsInvoice=void 0,e.searchButton=!1,e.giftSearchButton=!1,e.canUseGiftCard=void 0,e.item={isChecked:!1,isGiftChecked:!1},e.data={memberId:""},e.deliMap={"9:0000":"9:00-13:00",130000:"13:00-18:00",180000:"18:00-21:00"},e.pointsChecked=[!1,!1,!1];var S=[!1,!1,!1];e.couponsDiscount=null,e.seaShellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.pointsList=null;var I=null,w=[3,2,1];e.buttonDisabled=[!0,!0,!0],e.orderInitParams=JSON.parse(t.orderInitParams),e.selectedPayType=null,e.privilege="",e.giftList=[],e.isHasCode=!1,e.isFillIn=!1,e.isHxCode=!1,e.goBack=function(){p.goBack()},e.goWriteOff=function(){var t=document.getElementById("privilegeCode");""!=t.value?i.postPrivilegeCode(t.value).success(function(o){o.success&&o.result?(r.showToast("验证成功"),e.privilege=t.value,e.isHxCode=!0,i.updateOrder(e.orderInitParams).success(function(o){o.success?(r.showToast("验证成功"),null!=o.data.hb?(e.privilege=o.data.hb.c,e.giftList=o.data.hb.p):(e.privilege=t.value,e.giftList=[])):(r.showToast(o.message),e.giftList=[])})):(r.showToast(o.message),e.isHxCode=!1,e.privilege="",e.giftList=[])}):r.showToast("请填写正确的特权码")},e.init=function(o){e.o2oAttrId=t.o2oAttrId,m(),i[o?"updateOrder":"doInit"](e.orderInitParams).success(function(t,o,i,a){if(!t.success)return void s.go("homePage");null!=t.data.hb&&(e.giftList=t.data.hb.p,e.privilege=t.data.hb.c),e.orderConfirmMessage=t.data,e.pointsList=t.data.bl?t.data.bl:null,e.canUseGiftCard=e.orderConfirmMessage.canUseGiftCard,e.regAddress=e.orderConfirmMessage.addr,e.regInvoice=e.orderConfirmMessage.inv.iti,e.invoiceHead=e.orderConfirmMessage.inv.iti,e.o2oTypeMap=e.orderConfirmMessage.o2oTypeMap,e.zzsInvoice=e.orderConfirmMessage.inv.iti,e.isBooking=e.orderConfirmMessage.book?1:0,e.selectedPayType={code:e.orderConfirmMessage.pays[0].code,name:e.orderConfirmMessage.pays[0].name},e.proNumberTotal=0;for(var n=0,r=e.orderConfirmMessage.ops.length;n<r;n++)e.proNumberTotal+=e.orderConfirmMessage.ops[n].num;1==e.isBook&&(e.isBooking=1),e.paymentType=e.orderConfirmMessage.pays,e.paymentCode=e.paymentType[0].paymentCode,e.codFlag=!1,2==e.orderConfirmMessage.pays.length&&(e.codFlag=!0),e.couponsDiscount=e.orderConfirmMessage.tca,e.allPrice=e.orderConfirmMessage.pam,e.newPrice=e.orderConfirmMessage.oam,I=e.orderConfirmMessage.oam,e.orderConfirmMessage.bl&&v(e.orderConfirmMessage.bl)}).error(function(e,t,o,s){})},e.isOnlinePay=[!0,!1],e.choosePayType=function(t,o){e.selectedPayType.code!=o&&i.choosePayType({name:t,code:o}).success(function(s){1==s.success&&(e.isOnlinePay=[!1,!0],e.selectedPayType={name:t,code:o})})},e.$on("$ionicView.beforeEnter",function(t,o){e.isHasCode=!1,e.isFillIn=!1,"back"==o.direction?e.init(!0):(e.init(),e.privilege="",e.giftList=[],e.isHxCode=!1),e.isBuyerForOrder=c.getRole(),0==e.isBuyerForOrder?e.footerSubmit={position:"fixed",bottom:"0px"}:e.footerSubmit={position:"fixed",bottom:"49px"}}),e.$on("$ionicView.afterLeave",function(e,t){o.isInvoice=!1}),e.$watch("searchGoodsName.name",function(t,o){t?e.searchButton=!0:(e.searchButton=!1,e.item.isChecked=!1)}),e.$watch("searchGoodsName.giftName",function(t,o){t?e.giftSearchButton=!0:(e.giftSearchButton=!1,e.item.isGiftChecked=!1)}),e.toInvoice=function(t){s.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:0})},e.goBackFill=function(){e.isHasCode=!1,e.isFillIn=!0},e.toSubmit=function(t){9==e.orderConfirmMessage.ot?2==t?f():e.isFillIn||""!=e.privilege&&e.giftList!=[]?e.isFillIn?f():1==t&&f():e.isHasCode=!0:f()},e.toPayment=function(e){s.go("payment",{paymentCode:e})},e.tosendGoodsTime=function(){s.go("sendGoodsTime")},e.showPopup=function(e){var t=a.show({template:e});n(function(){t.close()},1e3)},e.useGiftCard=function(t){t&&i.useGiftCard(t).success(function(t,o,s,i){1==t.success?(e.item.isGiftChecked=!0,"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):(e.item.isGiftChecked=!0,e.init(!0))):r.showAlert("提示","验证优惠券失败","")})},e.cancleGiftCard=function(){a.confirm({title:"提示",template:"是否确认取消优惠?",okText:"确定",cancelText:"取消"}).then(function(t){t&&i.cancleGiftCard().success(function(t,o,s,i){1==t.result?(r.showAlert("提示","取消成功",""),e.init(!0)):e.showPopup("取消失败")})})},e.useCard=function(t,o,s,a){t&&i.useCard(t,o,s,a).success(function(t,o,s,i){1==t.success?"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):e.couponsForTransfer():r.showAlert("提示","验证优惠券失败","")})};var y;e.couponsForTransfer=function(){function t(){e.expiredSecond=e.expiredSecond-1,e.expiredSecond>0?(e.searchButton=!1,y=n(function(){t()},1e3)):(e.searchButton=!0,o.close())}e.expiredSecond=121,y&&n.cancel(y),t();var o=a.show({template:'<div class="row padding-0"><span class="col-30 text-align-c">验证码</span> <input class="col-60 border text-align-c" style="border-color: #32BEFF !important;height: 20px" type="number" ng-model="data.memberId" placeholder="请输入验证码"></div><div> 验证码将在<span class="color-text-red" ng-bind="expiredSecond"></span>秒后过期</div>',title:"请输入验证码",subTitle:"请输入验证码",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){e.data.memberId?i.cardCheck(e.data.memberId).success(function(t,s,i,a){1==t.success?(r.showAlert("提示","使用成功",""),e.init(!0),o.close()):r.showAlert("提示",t.message,"")}):r.showAlert("提示","请输入验证码",""),t.preventDefault()}}]})},e.goCard=function(){h(1)},e.goGiftCard=function(){h(2)},e.goUseCouponList=function(e){if(!e.couponId)if(1==e.type){if(!h(0))return}else if(2==e.type&&!h(3))return;s.go("useCouponsList",e)};var T="礼品券不可与优惠券/卡券同时使用，请核对要使用的优惠券";e.countPoint=function(t,o){if(0!=e.pointsList[t].canUsePoint){if(e.pointsChecked[t]=!e.pointsChecked[t],1==S[t]&&0==e.pointsChecked[t])return e.newPrice=e.newPrice+e.diamondDiscount+e.seashellDiscount+e.insuranceDiscount,v(e.orderConfirmMessage.bl),void(S[t]=e.pointsChecked[t]);if(0==S[t]&&1==e.pointsChecked[t]){var s,i;switch(s=$(I,e.pointsList[t].quota),s>e.newPrice&&(s=e.newPrice),i=Math.floor($(s,e.pointsList[t].proportion)),s=i/e.pointsList[t].proportion,i>e.pointsList[t].count&&(i=e.pointsList[t].count,s=i/e.pointsList[t].proportion),e.pointsList[t].pointDiscount=s,e.pointsList[t].canUsePoint=i,e.newPrice=e.newPrice-s,o){case"diamond":e.diamondDiscount=s;break;case"seashell":e.seashellDiscount=s;break;case"insurance":e.insuranceDiscount=s}w.push({benefitType:o,count:i,amt:s});for(var a=0;a<e.pointsList.length;a++)if(0==e.pointsChecked[a]&&a!=t){var n,r;n=$(I,e.pointsList[a].quota),n>e.newPrice&&(n=e.newPrice),r=Math.floor($(n,e.pointsList[a].proportion)),n=r/e.pointsList[a].proportion,0==r&&(e.buttonDisabled[a]=!0),r>e.pointsList[a].count&&(r=e.pointsList[a].count,n=r/e.pointsList[a].proportion),e.pointsList[a].pointDiscount=n,e.pointsList[a].canUsePoint=r}S[t]=e.pointsChecked[t]}u.resize()}},e.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},e.switchOff={background:"#fff","border-color":"#e6e6e6"}}]),APP.service("orderConfirmService",["$http","UrlService",function(e,t){this.doInit=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.updateOrder=function(){return e({method:"post",url:t.getUrl("UPDATE_ORDER")})},this.toSubmit=function(o,s){var i={remark:"",isBooking:o,benefitList:s};return e({method:"POST",url:t.getUrl("ORDER_SUBMIT"),data:i})},this.useCard=function(o,s,i,a){var n={cardCode:o,productId:s,number:i,storeCode:a};return e({method:"POST",url:t.getUrl("CARD_COUPONS_USED"),params:n})},this.cardCheck=function(o){var s={captcha:o};return e.get(t.getUrl("CARD_ CODE_CHECK"),s)},this.useGiftCard=function(o){var s={cardCode:o};return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_USED"),params:s})},this.cancleGiftCard=function(){return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_CANCLE")})},this.choosePayType=function(o){return e({method:"POST",
url:t.getUrl("SUBMIT_PAY_WAY"),data:o})},this.postPrivilegeCode=function(o){var s={c:o};return e({method:"POST",url:t.getUrl("POST_PRIVILEGE_CODE"),params:s})}}]),APP.controller("OrderSearchController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){function S(e){e?n.deleteOrder(w).success(function(e){e.success?(t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()):(g.showToastShort(e.message),w="")}).error(function(e){g.showToastShort("删除失败！"),w=""}):w=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus="",t.isIos=!1;var I="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId;var w="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.orderStatus=o.orderStatus?o.orderStatus:"","0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1)},t.initSearch=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.availableToTop(),t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,t.orderStatus,0,5,t.search.keyWord,!0)},t.loadOrderList=function(e,o,s,i,a,c,l){n.getOrderList(o,s,i,a,c).success(function(o){o.success&&(e?l?t.searchOrderList=t.searchOrderList.concat(o.data.orders):t.orderList=t.orderList.concat(o.data.orders):l?(t.searchOrderList=o.data.orders,0==t.searchOrderList.length?t.noOrders=!0:t.noOrders=!1):t.orderList=o.data.orders,l?t.hasMoreDataSearch=o.data.orderProductSize:t.hasMoreData=o.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length),e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");I=e.result,window.alipay.pay({payInfo:I},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){i.go("paymentxyz",{orderSn:e})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),i.go("orderTracking",{orderSn:e})},t.goOrderDetails=function(e,o,s,a,n,r){t.memberId==n&&(r&&t.closeSearchModal(),s?i.go("refundDetail",{orderProductId:a,memberId:n}):i.go("orderDetail",{orderSn:e,cOrderSn:o}))},t.goAssess=function(e){i.go("assess",{orderId:e})},t.goLookAssess=function(e){i.go("lookAssess",{orderId:e})},t.orderCancel=function(e){n.cancelOrder(e,"mstore").success(function(e){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()})},t.availableToTop=function(){r.$getByHandle("searchOrderHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||(t.init(),t.noOrders=!1)}),a.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){t.searchModal.show(),t.searchOrderList=[],t.pageIndexSearch=0,t.hasMoreDataSearch=!1},t.closeSearchModal=function(){m.goBack()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,"",t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){w=e,g.showConfirm("","确认删除此订单？",S,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("assessed")})}]),APP.controller("payResultSuccessController",["$scope","$stateParams","CirclePageService","$localstorage","SeeMoreService","UrlService",function(e,t,o,s,i,a){e.$on("$ionicView.beforeEnter",function(){o.getCircleLink("","","3").success(function(t){t.success&&(e.circleUrl=t.data)})}),e.babyonerace=function(){window.location.href=a.getThirdUrl("race/")}}]),APP.controller("PaymentController",["$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService",function(e,t,o,s,i,a){e.htmlContent=t.content,e.title=t.title,e.payWay="alipaymobile",e.zfb_checked=!0,e.huod_checked=!1,e.kjt_checked=!1,e.alipayText=null,e.codText=null,e.kjtpayText=null,e.wxpay_checked=!1,e.wxpayText=null,e.paymentCode=t.paymentCode,e.payWayList=[],e.payWayMap={alipaymobile:"支付宝",cod:"货到付款",kjtpay:"快捷通",wxpay:"微信支付"},e.init=function(){e.htmlContent=t.content,e.title=t.title,e.paymentCode=t.paymentCode,a.getSendGoodsDates().success(function(t,o,s,i){e.payWayList=t.data.payWayList;for(var a=0;a<t.data.payWayList.length;a++)"alipaymobile"==t.data.payWayList[a].paymentCode?e.alipayText=t.data.payWayList[a].paymentName:"cod"==t.data.payWayList[a].paymentCode?e.codText=t.data.payWayList[a].paymentName:"kjtpay"==t.data.payWayList[a].paymentCode&&(e.kjtpayText=t.data.payWayList[a].paymentName)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.checkedpay=function(t){e.paymentCode=t},e.pushPayWay=function(){if(!e.paymentCode)return void alert("请选择一个支付方式");a.submitSendGoodsDates(e.paymentCode).success(function(t,o,s,i){1==t.success?e.$ionicGoBack():alert(t.message)})}}]),APP.service("PaymentService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){var o={toUrl:"1"};return e.get(t.getUrl("PAY_WAY"),o)},this.submitSendGoodsDates=function(o){var s={payWay:o};return e({method:"POST",url:t.getUrl("SUBMIT_PAY_WAY"),params:s})},this.wPay=function(o){return e.get(t.getUrl("WECHAT_PAY"),o)},this.kjtPay=function(o){return e.get(t.getUrl("PAY_KJT"),o)},this.orderPayCheck=function(o){return e.get(t.getUrl("ORDER_200PAYCHECK"),o)}}]),APP.controller("PaymentControllerxyz",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","UserService","WhiteShowsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.orderSn=o.orderSn,t.priceinit="500.00",t.alipaymobile=[],t.alipaymobiles=!1,t.kjtpay=[],t.kjtpays=!1,t.wxpay=[],t.wxpays=!1,t.canClick=!0,t.showIous=!0,t.canPayWhiticos=!1,t.icosImg=s.imgBaseURL+"img/baitiao-paylist.png",t.iousStatus=-1,t.htmlContent=o.content,t.title=o.title,t.payWay="alipaymobile",t.totalAmount=o.totalAmount,t.paymentCode="",t.payWayList=[],t.payment="",t.showPay=!0,t.isToStore=!1;var v="";t.isRed=!1,t.urlImg="http://m.ehaier.com/www/img/jh.png",t.canClick=!0,t.showCcb=!0;var $="",S={orderSn:t.orderSn};t.toPay=function(){var e={totalAmount:t.price,orderSn:t.orderSn};i.go("bankCardChose",e)},t.init=function(){g.get(m.getUrl("TO_ORDER_SUBMIT_SUCCESS"),S).success(function(e){t.price=e.data.orders.orderAmount,t.price>=600?(t.canPayWhiticos=!0,t.icosImg=s.imgBaseURL+"img/baitiao-paylist.png"):(t.canPayWhiticos=!1,t.icosImg=s.imgBaseURL+"img/baitiao-paylist-1.png");for(var o=e.data.paywayList,i=0;i<o.length;i++)"alipaymobile"==o[i].paymentCode?(t.alipaymobile=o[i],t.alipaymobiles=!0):"kjtpay"==o[i].paymentCode?(t.kjtpay=o[i],t.kjtpays=!0):"wxpay"==o[i].paymentCode&&(t.wxpay=o[i],t.wxpays=!0);!0!==e.data.isSupportLk?t.showCcb=!1:1==e.data.isSupportLk&&1==e.data.islk?(t.isRed=!0,t.urlImg="http://m.ehaier.com/www/img/ic-ccb.png",t.canClick=!0):1==e.data.isSupportLk&&!0!==e.data.islk&&(t.canClick=!1),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackOrder",{oid:t.orderSn,otp:t.price+""},[]])})},t.$on("$ionicView.beforeEnter",function(){t.init(),$=c.viewHistory().backView,s.paySuccess&&u.alert({template:"此订单已经支付",okText:"确定"}).then(function(e){t.goList()})}),t.goList=function(){$?"orderManage"==$.stateName||"orderSearch"==$.stateName?c.goBack(-1):"Retainage"==$.stateName?i.go("orderManage"):c.goBack(-2):i.go("orderManage")},t.toSpendBai=function(){var e={orderSn:o.orderSn};i.go("spendBaiInstallment",e)},t.goCart=function(){i.go("orderManage")};var I,w;t.payWayMap={alipaymobile:"支付宝",paymentName:"建行信用卡分期",kjtpay:"快捷通",wxpay:"微信支付"},t.iousPay=function(){h.queryIousStatus({userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){if(e.success){if(t.iousStatus=e.data.applyStatus,!t.canPayWhiticos)return;2==t.iousStatus||3==t.iousStatus?i.go("applyForWhite"):0==t.iousStatus?h.applyForOpen({resultUrl:"http://m.ehaier.com/www/index.html",userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):1==t.iousStatus&&n.orderPayCheck(S).success(function(e){-200==e.errorCode?l.showAlert("提示",e.message,function(){}):h.payApply({userId:f.getUser().ucId,token:f.getUser().accessToken,orderSn:o.orderSn,resultUrl:"http:www.baidu.com"}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)})})}})},t.checkedpay=function(e){t.paymentCode=e,I=o.orderSn,w=t.price,t.payTest(I,t.paymentCode,w)},t.payTest=function(o,s,a){if(!window.cordova){var r={orderSn:o};return void n.orderPayCheck(r).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else if("alipaymobile"==s)window.location.href=m.getHeadV2()+"h5/pay/alipay/request.html?orderSn="+o;else if("wxpay"==s){var t=window.navigator.userAgent;if(!t||-1==t.indexOf("MicroMessenger"))return void l.showToast("请使用与定金相同的支付方式-微信支付，登录顺逛微店公众号付款。");if(t.substring(t.indexOf("MicroMessenger")+15,t.indexOf("MicroMessenger")+16)<5)return void l.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href=m.getHeadV2()+"h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+o+"&orderAmount="+a+".00"}else"kjtpay"==s&&p.getMessage().success(function(e,t,s,a){e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount?window.location.href=m.getHeadV2()+"h5/pay/kjtpay/request.html?orderSn="+o+"&kjtAcount="+e.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("bankCard")})}).error(function(){alert("网络失败")})})}if("alipaymobile"==s)if(window.alipay){var c=o,g=m.getHeadV2()+"h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?e.getAliPayInfo(c,a,g).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});v=e.result,window.alipay.pay({payInfo:v},function(e){t.showPay=!1,i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}).error(function(e){}):window.alipay.pay({tradeNo:c,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+c,price:a,notifyUrl:g},function(e){i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}else alert("支付宝 插件不存在");else if("wxpay"==s){window.wechatPay||alert("微信支付插件未加载 ");var f={orderSn:o};n.wPay(f).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){t.showPay=!1,i.go("payResultSuccess")},function(e){i.go("payResultFailure")})}else alert("网络连接错误")}).error(function(e){alert(e)})}else"kjtpay"==s&&p.getMessage().success(function(e,t,s,a){if(e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount){var r={orderSn:o,kjtAmount:e.data.kjtAccount.memberKjtpayAccount};n.kjtPay(r).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.success){d.open(e.data).addEventListener("exit",function(e){i.go("orderManage")})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("bankCard")})}).error(function(){alert("网络失败")})}}]),APP.controller("spendBaiInstallmentController",["$scope","$state","$ionicHistory","spendBaiInstallmentService","$stateParams","UrlService","AfterOrderSubmitService","PopupService","PaymentService","$ionicLoading",function(e,t,o,s,i,a,n,r,c,l){e.isShowDet=!1,e.payList=[],e.totalFee=null,e.number=3,e.goBack=function(){e.$ionicGoBack()},e.showDetail=function(){e.isShowDet=!e.isShowDet},e.changeFenqiNum=function(t){e.number=t},e.toPay=function(){if(!e.number)return void r.showAlert("提示","请选择期数后付款",function(){});a.getHeadV2();c.orderPayCheck({orderSn:i.orderSn}).success(function(o){if(-200==o.errorCode)return void r.showAlert("提示",o.message,function(){});window.cordova?s.sendToPayApp(i.orderSn,e.number).success(function(e){if(e.success){var o=e.data.orderInfo;window.alipay.pay({payInfo:o},function(e){t.go("payResultSuccess")},function(e){t.go("payResultFailure")})}}):window.location.href=a.getZCUrl("HB_PAY_H5")+"?orderSn="+i.orderSn+"&number="+e.number})},e.$on("$ionicView.beforeEnter",function(){s.getHBCost(i.orderSn).success(function(t){t.success&&(e.payList=t.data.payList,e.totalFee=t.data.totalFee)}),e.number=3})}]),APP.service("spendBaiInstallmentService",["$http","UrlService",function(e,t){this.getHBCost=function(o){var s=t.getPayCenter("HB_COST")+"?callback=JSON_CALLBACK&orderSn="+o;return e.jsonp(s)},this.sendToPayApp=function(o,s){var i=t.getZCUrl("HB_PAY_APP")+"?orderSn="+o+"&number="+s;return e.get(i)}}]),APP.controller("CommodityListController",["$scope","$localstorage","$rootScope","UseCouponsService","$stateParams","$ionicScrollDelegate","PopupService",function(e,t,o,s,i,a,n){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.backGroundBlue={background:"url("+o.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+o.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.goBack=function(){e.$ionicGoBack()},e.productList=[],e.couponList=[];var r=i.couponId;e.hasmore=!1;var c=1;e.getShopData=function(){s.doInit(r,1,5).success(function(t){t.success?(t.coupon&&(e.couponList=t.coupon),t.productsList&&(e.productList=t.productsList),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)):n.showToast(t.message)})},e.loadMore=function(){c++,s.doInit(r,c,5).success(function(t,o,s,i){t.productsList&&(e.productList=e.productList.concat(t.productsList)),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)})},e.$on("$ionicView.beforeEnter",function(){e.hasmore=!1,c=1,e.getShopData()})}]),APP.service("UseCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i){var a={couponId:o,startIndex:s,pageSize:i};return e.get(t.getUrl("USE_COUPONS_LIST"),a)}}]),APP.controller("GoodsSearchController",["$ionicHistory","$scope","GoodsSearchService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService","HomePageService","$state","UrlService",function($ionicHistory,$scope,GoodsSearchService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService,HomePageService,$state,UrlService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}function historyOldUse(){if(jl=localStorage.getItem("historys")){var e=jl.split("$$"),t=unique(e);t.length>10?(t.length=10,$scope.history=t):$scope.history=t}else $scope.hShow=!1,$scope.hShowB=!0}function searchStartNew(){$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.wdCommonSearchNew("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}function searchStart(){window.cordova&&$rootScope.gio.evar.set({source:"Search",value:$scope.searchGoodsName.name}),$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}var Focus=document.querySelector("#focus");$scope.history=[],$scope.hShow=!0,$scope.hShowB=!0;var bv="",bvv="aicxyz",jl=localStorage.getItem("historys");$scope.hotWords="",$scope.lianXiWords="",$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.comprehensive=["img/comprehensive_black.png","img/comprehensive_white.png"],$scope.comprehensive_index=0,$scope.arrowState=["img/arrow_state_0.png","img/arrow_state_1.png","img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/filter_state_0.png","img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commissionDesc","commission"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.switch=!0,$scope.productIds="",$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.front=$stateParams.front,$scope.shareStoreId=$stateParams.shareStoreId,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="",searchType="0",provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="全部",$scope.brandList=[],$scope.filterParameterArr=["all","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.qs="";var u=navigator.userAgent;$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.settingsList="",-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.alWs=function(e){e?($scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.hShow=!1,$scope.lianXC=!0,$scope.searchData=null,$scope.xyzShData=null,GoodsSearchService.associationalWords(e).success(function(e){$scope.lianXiWords=e.data})):($ionicScrollDelegate.scrollTop(),$scope.searchData=null,$scope.xyzShData=null,$scope.hShow=!0,$scope.hShowB=!1,historyOldUse(),$scope.emptySearch=!1,$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.showTab=!1)},$scope.$on("$ionicView.enter",function(){"back"==bvv?($scope.showTab=!0,Focus.blur()):($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,setTimeout(function(){try{Focus.focus()}catch(e){}},200))}),$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.hotWordShow=!0,GoodsSearchService.hotWords().success(function(e){$scope.hotWords=e.data,$scope.hotWords||($scope.hotWordShow=!1)}),GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),bv=$ionicHistory.viewHistory().backView,bvv=t.direction,$scope.emptySearch=!1,$scope.isShowUp=!1,historyOldUse(),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,"back"==t.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{localStorage.getItem("historys")?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",searchType="0",$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.front=$stateParams.front,$stateParams.shareStoreId?memberId=$stateParams.shareStoreId:UserService.getUser().mid&&(memberId=UserService.getUser().mid),$scope.searchGoodsName={name:""}}}),$scope.sGoods=function(h){$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.filterParams="",$scope.lianXC=!1,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.searchGoodsName.name=h;var oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name;if(oldRecord){var Record=newRecord+"$$"+oldRecord;localStorage.setItem("historys",Record)}else localStorage.setItem("historys",newRecord);historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()})},$scope.searchGoods=function(){return $scope.searchData="",$scope.xyzShData="",$scope.filterParams="",$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.chooseIndex=0,$scope.lianXC=!1,$scope.isShowUp=!1,""!=$scope.searchGoodsName.name||$scope.gsPlaceholder?$scope.gsPlaceholder&&""==$scope.searchGoodsName.name?void $scope.sGoods($scope.gsPlaceholder):void(""!=$scope.searchGoodsName.name&&(oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name,oldRecord?(Record=newRecord+"$$"+oldRecord,localStorage.setItem("historys",Record)):localStorage.setItem("historys",newRecord),historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}))):void PopupService.showToast("请填写搜索内容")},$scope.todoSomething=function(e){13==e.keyCode&&($scope.searchGoods(),Focus.blur())},$scope.babyrace=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):window.location.href=UrlService.getThirdUrl("race/")})},$scope.changeState=function(e,t,o){1==t?GoodsSearchService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.searchData[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):GoodsSearchService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.searchData[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.loadMore=function(){0==$scope.front?GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!0,$scope.qs).success(function(e,t,o,s){0!=e.data.productList.length?($scope.searchData=$scope.searchData?$scope.searchData.concat(e.data?e.data.productList:[]):[],$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)
}):1==$scope.front&&GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!0,$scope.qs).success(function(e,t,o,s){0!=e.data.productList.length?($scope.searchData=$scope.searchData?$scope.searchData.concat(e.data?e.data.productList:[]):[],$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)})},$scope.type={choose:[{text:"商品"},{text:"店名"},{text:"店铺码"}],typeId:["0","1","2"]};var placeholderList=["请填入名字或型号等关键字","请搜索店铺名称关键字","请搜索店铺码"];$scope.chooseType=function(e){$scope.isShowUp=!$scope.isShowUp,(e||0==e)&&($scope.searchGoodsName={name:""},$scope.hasmore=!1,$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.typeChoose=$scope.type.choose[e].text,searchType=$scope.type.typeId[e],$scope.gsPlaceholder=placeholderList[e])},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs=tabState[1][t]}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.xyzShData=[],$scope.qs=tabState[4][o]}GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1,$scope.qs).success(function(e,t,o,s){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,$scope.comprehensive_index=1,$scope.chooseIndex=0,$scope.showComprehensiveSub=!1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}}))})},$ionicModal.fromTemplateUrl("templates/product/SearchFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t){var o=0,s=$scope.brandList.length;if("全部"==t.brandName){$scope.brandList[0].isActive=!0;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive=!1}else{t.isActive=!t.isActive;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive?o++:$scope.brandList[0].isActive=!1;if(0==o&&($scope.brandList[0].isActive=!0),o==s-1){$scope.brandList[0].isActive=!0;for(var i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive=!1}}if($scope.brandList[0].isActive)$scope.filterParameterArr[1]="all";else{for(var a="",i=1;i<$scope.brandList.length;i++)$scope.brandList[i].isActive&&(a+=$scope.brandList[i].id+";");a=a.substring(0,a.length-1),$scope.filterParameterArr[1]=a}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.searchData=null,$scope.xyzShData=null,$scope.filterModal.hide(),$scope.lianXC=!1,searchStartNew(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){for(var e=0;e<$scope.brandList.length;e++)$scope.brandList[e].isActive=0==e;$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){$scope.filterModal.show(),GoodsService.getFilterData($scope.productIds).success(function(e){if(e.success){for(var t=e.data.brandList,o=0;o<t.length;o++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(t[o].id)>-1?o>0&&(t[o].isActive=!0):t[o].isActive=!1:t[o].isActive=0==o;$scope.brandList=t}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()})}]),APP.service("GoodsSearchService",["$http","UrlService",function(e,t){this.wdCommonSearchNew=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,qs:m,noLoading:g};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),f)},this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p,u){var g={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p,qs:u};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),g)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g,m){var f={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g,qs:m};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),f)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.hotWords=function(){var o={platform:3};return e.get(t.getUrl("HOT_WORDS"),o)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.associationalWords=function(o){var s={searchKey:o,platform:3};return e.get(t.getUrl("ASSOCIATIONAL_WORDS"),s)}}]),APP.controller("SelectionController",["GoodsSearchService","$http","$scope","GoodsService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService",function(GoodsSearchService,$http,$scope,GoodsService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService){function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),getProductList($scope.memberId,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,1,"saleDesc","all",!1)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,s,i,a,n,r,c,l,d){GoodsService.getSelectionProducts(e,t,o,s,i,a,n,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}$scope.rightC={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"11px",right:"8px"},$scope.rightCd={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"31px",right:"8px"},$scope.iosCss={width:"52px"};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.slideImage=[];var typeList=["faxian","all","bx","xyj","kt","cd","rsq","cfdq","bg","zncp","shjd","sjd","bbjg","jtbj","sykt","sgch","jkqc","sm","shfw"];$scope.data={},$scope.tabNav="selection",$scope.productList=[],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[[!0],[!0]],$scope.selectedIndex=0,$scope.isFind=!0,$scope.hasFindData=!1,$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.isFindTab=!0,$scope.filterParameterArr=["hasStock","all","0"],$scope.filterOtherPatam=[],$scope.filterArray="",$scope.filterPrice={min:"",max:""},$scope.toggleLeft=function(){$ionicSideMenuDelegate.toggleLeft()},$scope.brand=!0,$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePriceRange=function(){$scope.priceRange=!$scope.priceRange},$scope.changeOther=function(e){$ionicScrollDelegate.resize(),$scope.otherState[e]=!$scope.otherState[e]},$scope.StockStateArr=["all","hasStock"],$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.chooseBrand=function(e){$scope.isBrand=[!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.isBrand[e]=!0,$scope.filterParameterArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName},$scope.isPriceRange=[!0,!1,!1,!1,!1,!1,!1],$scope.choosePriceRange=function(e){switch($scope.isPriceRange=[!1,!1,!1,!1,!1,!1,!1],$scope.isPriceRange[e]=!0,$scope.filterParameterArr[2]=e,e){case 0:$scope.priceName="全部";break;case 1:$scope.priceName="0～1000";break;case 2:$scope.priceName="1001～2000";break;case 3:$scope.priceName="2001～3000";break;case 4:$scope.priceName="3001～4000";break;case 5:$scope.priceName="4001～5000";break;case 6:$scope.priceName="5000以上"}},$scope.chooseOtherItem=function(e,t,o){for(var s=0;s<o;s++)$scope.isCurrent[e][s]=s===t;$scope.filterOtherPatam[e]=$scope.otherList[e].lstAttributeOptions[t].id,$scope.otherName[e]=$scope.otherList[e].lstAttributeOptions[t].optionValue},$scope.filterEnsure=function(){if($scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,""==$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(""==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max&&""!=$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e=$scope.filterParameterArr.join("@"),t=$scope.filterOtherPatam.join(";");$scope.filterArray=e+"@"+t,tabState[2]=$scope.filterArray,$scope.chooseIndex=2,$scope.page=1,$scope.filterModal.hide(),$scope.productList=[],$scope.init()},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:"",max:""},$scope.otherState=[!1,!1];for(var e=$scope.otherList.length,t=0;t<e;t++)$scope.filterOtherPatam[t]=0,$scope.isCurrent[t]=[!0,!1];$ionicScrollDelegate.resize()},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.changeStateFind=function(e,t,o){1==t?GoodsService.changeChooseStateJia($scope.memberId,e,"1").success(function(e,t,s,i){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺上架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺上架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui($scope.memberId,e).success(function(e,t,s,i){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺下架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺下架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))})},$scope.changeStateFindNormal=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺上架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺下架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))})},$scope.showSlideImage=!0,$scope.changeState=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.productList[o].onShelf=!0)}):GoodsService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.productList[o].onShelf=!1)})},$scope.selectTab=function(e){GoodsService.changeSuccess(typeList[e]).success(function(t,o,s,i){1==t.success&&(GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?($scope.otherList=e.data.filterMap.lstAttributes,$scope.resetFilter()):($scope.otherList=[],$scope.resetFilter()))}),$scope.page=1,$scope.selectedIndex=e,0!=$scope.selectedIndex?($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.isFind=!1,$scope.isTab=!0,$scope.productList=[],$scope.requestParam="isHotDesc",$scope.init()):($scope.isFind=!0,$scope.isTab=!1,$scope.findInit()))})},$scope.toggleRight=function(){$ionicSideMenuDelegate.toggleRight()},$scope.chooseIndex=0,$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show(),GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?$scope.otherList=e.data.filterMap.lstAttributes:$scope.otherList=[])});else{if($scope.page=1,$scope.resetFilter(),0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-278+"px",top:"291px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"271px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"291px"}:$scope.comprehensiveSubHeight={height:"auto",top:"271px"});if(1==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=2==$scope.commission_index?1:2,$scope.requestParam=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.productList=[]}else if(3==e)$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.requestParam="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.productList=[];else if(4==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.requestParam=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.productList=[]}$scope.init()}},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.page=1,$scope.loadMore=function(){0==$scope.selectedIndex?$scope.$broadcast("scroll.infiniteScrollComplete"):($scope.page+=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!0))},$scope.loadMoreProducts=function(e,t,o,s,i,a,n,r,c,l,d,p){GoodsService.loadMoreProducts(e,t,o,s,i,a,n,r,c,l,d,p).success(function(e,t,o,s){if(null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=$scope.productList.concat(e.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var i=$scope.productList.length;$scope.hasmore=!(i===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})},$scope.findInit=function(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!1).success(function(e,t,o,s){$scope.data={},$scope.hasFindData=!0,$scope.data=e,$scope.$broadcast("scroll.infiniteScrollComplete")})},$scope.init=function(){$scope.hasmore=!1,$scope.page=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!1)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getSlideImage=function(){GoodsService.getSlideImage().success(function(e,t,o,s){$scope.slideImage=[{},{},{}],$scope.slideImage=e.data.bannersList,$scope.memberId=e.data.memberId,$scope.storeId=e.data.storeId,$ionicSlideBoxDelegate.$getByHandle("selection_slider").update()})},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$scope.getAddress=function(){GoodsService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$ionicModal.fromTemplateUrl("templates/product/SelectionFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success&&$scope.selectTab($scope.selectedIndex)})}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.requestParam="isHotDesc"),$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.init()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.showComprehensiveSub=!1,$scope.nowLevel=0,
$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),ShopService.getMessage().success(function(e){e.data.count>0?$scope.flagNum=!0:$scope.flagNum=!1}),"back"!=t.direction&&($scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.getSlideImage(),initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0))}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.controller("SpecificationsController",["$scope","spacificationsService","$stateParams","$ionicPopup","$rootScope",function(e,t,o,s,i){e.$on("$ionicView.beforeEnter",function(){e.flag=!1,e.tabNav="selection",e.productId=o.productId,t.doInit(e.productId).success(function(t,o,s,i){null==t.data?e.flag=!0:(e.flag=!1,e.data=t.data.productAttrs)})})}]),APP.service("spacificationsService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={productId:o};return e.get(t.getUrl("ORDERDETAIL_SPECIFICATIONS"),s)}}]),APP.controller("applyForCardController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.toApplyForCard=function(e){var t=null;1==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11753&pro_code=FHTG107707SJ01HESG":2==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11754&pro_code=FHTG107707SJ01HESG":3==e&&(t="https://xyk.cebbank.com/cebalipay/apply/fz/card-app-status.htm"),window.cordova?3==e?window.emc.presentH5View(t,"查询联名卡进度"):window.emc.presentH5View(t,"联名卡申请"):window.location.href=t}}]),APP.controller("BranchTypeController",["HomePageService","$http","$scope","BranchTypeService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService","ProductDetailService",function(HomePageService,$http,$scope,BranchTypeService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService,ProductDetailService){function getThreeTwoCategory(e){$ionicSlideBoxDelegate.slide(0),BranchTypeService.GetLeftDataList(e).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],s=[],i=0;i<t.data.length;i++)t.data[i].parentId==e&&2==t.data[i].levels?(t.data[i].children=[],o.push(t.data[i])):1==t.data[i].levels&&s.push(t.data[i]);for(var i=0;i<t.data.length;i++)for(var a=0;a<o.length;a++)t.data[i].parentId==o[a].id&&o[a].children.push(t.data[i]);$scope.rightDataList=o,$scope.slideImage=s,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()})}function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),BranchTypeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,s,i,a,n,r,c,l,d){BranchTypeService.getSelectionProducts(e,t,o,s,i,a,n,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.flagNum=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.leftDataList="",$scope.rightDataList="",$scope.leftDataListIndex="0",$scope.ParentParentId="0",$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.iSDataLeftRight=!1,$scope.inntDataList=function(){$scope.tabNav="homePage",ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),BranchTypeService.GetLeftDataList($scope.ParentParentId).success(function(e){e.success&&e.data.length>0?($scope.leftDataList=e.data,getThreeTwoCategory(e.data[$scope.leftDataListIndex].id)):($scope.leftDataList="",$scope.rightDataList="",$scope.iSDataLeftRight=!0)})},BranchTypeService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),$scope.$watch("slideImage",function(){$ionicSlideBoxDelegate.update()}),$scope.learnRsq=function(){window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.showSlideImage=!0,$scope.slideImage=[],$scope.bannerClick=function(e){var t=e.bannerId,o=e.url,s=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.memberId});break;case 2:if(o){var a=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:a,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var n=o.split("=")[1];$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.isFindTab=!0,$scope.selectTab=function(e,t){$scope.leftDataListIndex=t,getThreeTwoCategory(e),$ionicScrollDelegate.$getByHandle("branchtype-right-scroll").scrollTop()},$scope.brenchToChild=function(e){$state.go("branchTypeDetail")};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue;$scope.data={},$scope.tabNav="branchType",$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;BranchTypeService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getAddress=function(){BranchTypeService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,BranchTypeService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success})}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.inntDataList(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start(),$scope.showComprehensiveSub=!1,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.isWdHost=$scope.isBuyer,$scope.dataAdd=null,$scope.defaultValue=null,initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)}),$scope.$on("$destroy",function(){$scope.filterModal&&$scope.filterModal.remove(),$scope.addressModal&&$scope.addressModal.remove()})}]),APP.service("BranchTypeService",["$http","UrlService",function(e,t){this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.GetLeftDataList=function(o){var s={parentId:o,timer:(new Date).getTime()};return e.get(t.getZCUrl("GETNAVIGATIONS"),s)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)}}]),APP.controller("BranchTypeDetailController",["HomePageService","$ionicHistory","$scope","BranchTypeDetailService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(HomePageService,$ionicHistory,$scope,BranchTypeDetailService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}if($scope.attributeId="",$scope.brandId="",$scope.productCateId="",$scope.productCateIdType="0",$scope.filterData="",$scope.filterParams="",$scope.qs="",$scope.switch=!0,$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.storeId="",BranchTypeDetailService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),-1!=$stateParams.productCateId.indexOf("brandId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.brandId=arr[0].split("=")[1],$scope.productCateIdType="1",$scope.filterData="hasStock@"+$scope.brandId+"@0",$scope.productCateId=arr[1].split("=")[1],$scope.qs="isHotDesc"}else if(-1!=$stateParams.productCateId.indexOf("&productCateId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.productCateId=arr[1].split("=")[1],$scope.attributeId=arr[0].split("=")[1],$scope.productCateIdType="2",$scope.filterData="hasStock@all@0@"+$scope.attributeId,$scope.qs="isHotDesc"}else $scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateId=$stateParams.productCateId.split("=")[1],$scope.productCateIdType="0",$scope.qs="isHotDesc";$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.pageIndex="1",$scope.pageSize="5",$scope.memberId=UserService.getUser().mid,$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.locationImgUrltransform90={transform:"rotate(90deg)"},$scope.changeColor={"font-size":"17px"},$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null};var u=navigator.userAgent;-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.$on("$ionicView.beforeEnter",function(e,v){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.userId=UserService.getUser().mid,"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,$scope.searchGoodsName={name:""},BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.streetId=obj[0].streetId,$scope.districtId=obj[0].areaId}$scope.pageIndex=1,$scope.ResGetList()})}if(0==$scope.isBuyer?$scope.storeId=$localstorage.get("storeId","20219251"):$scope.storeId=$scope.userId,$scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}$scope.hasmore=!0}),$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.contentDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),$scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){
for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})}}]),APP.service("BranchTypeDetailService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u){if(d)var g={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateId:l,memberId:d,filterData:p,qs:u,fromType:"1",noLoading:!0};else var g={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateId:l,filterData:p,qs:u,fromType:"1",noLoading:!0,memberId:""};return e.get(t.getUrl("COMMONLOADITEMNEW"),g)},this.getFilterData=function(o){var s={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))}}]),APP.controller("ElectricalMallController",["BannerThemeService","$ionicHistory","$interval","ElectricalMallService","$ionicSlideBoxDelegate","$ionicScrollDelegate","HomePageService","GoodsService","BranchTypeDetailService","$q","$ionicModal","CalculateStrLength","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","LoginService","$localstorage","$rootScope","$stateParams","$ionicPopup","PopupService",function(BannerThemeService,$ionicHistory,$interval,ElectricalMallService,$ionicSlideBoxDelegate,$ionicScrollDelegate,HomePageService,GoodsService,BranchTypeDetailService,$q,$ionicModal,CalculateStrLength,InAppBrowserService,CreditService,ShopService,$scope,$timeout,UserService,$state,LoginService,$localstorage,$rootScope,$stateParams,$ionicPopup,PopupService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}$scope.productCateId="2729",$scope.filterData="",$scope.qs="",$scope.switch=!0,$scope.isListNull=!1,$scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateIdType="0",$scope.qs="isHotDesc",$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.pageIndex="1",$scope.pageSize="5",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.flashHour="",$scope.flashText="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.memberId=UserService.getUser().mid,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.datatypeNameArr=[{productCateId:"2729",name:"空调"},{productCateId:"2725",name:"洗衣机"},{productCateId:"2723",name:"冰箱"},{productCateId:"2743",name:"彩电"},{productCateId:"2741",name:"热水器"},{productCateId:"2742",name:"厨房电器"},{productCateId:"2726",name:"冷柜"},{productCateId:"2973",name:"智能产品"},{productCateId:"2737",name:"生活家电"},{productCateId:"2774",name:"水家电"},{productCateId:"2736",name:"家庭医疗"},{productCateId:"2811",name:"家用中央空调"}],$scope.storeId=UserService.getUser().mid,$scope.countTime={},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.selectedIndex=0,$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($scope.page=2,0==e)return void($scope.showComprehensiveSub=!$scope.showComprehensiveSub);if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.qs="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.qs=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.qs="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var s=o.length-1,i=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var a=0;a<o.length;a++)a>0&&"true"==o[a].active&&(o[0].active="false",i++);if(i==s||0==i){for(var a=0;a<o.length;a++)a>0&&(o[a].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var a=0;a<o.length;a++)a>0&&(o[a].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var s=0;s<$scope.lstAttributes[t].lstAttributeOptions.length;s++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[s].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[s].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].id==$scope.attributeId?(o[t].lstAttributeOptions[i].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,s=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var i=0;i<o[t].lstAttributeOptions.length;i++)o[t].lstAttributeOptions[i].active=0==i?"true":"false";s.push(o[t])}$scope.lstAttributes=s}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,s=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&"true"==t.lstAttributeOptions[i].active&&(t.lstAttributeOptions[0].active="false",s++);if(s==o||0==s){for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var i=0;i<t.lstAttributeOptions.length;i++)i>0&&(t.lstAttributeOptions[i].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,s,i){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.selectTab=function(e){$scope.filterParams="isHotDesc",$scope.qs="isHotDesc",$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.pageIndex="1",$scope.selectedIndex=e,$scope.productCateId=$scope.datatypeNameArr[e].productCateId,$scope.resetFilter(),$scope.filterData="",BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData,$scope.qs).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(e){if(e.success)for(var o=0,s=t.length;o<s;o++)for(var i=t[o],a=0,n=e.products.length;a<n;a++){var r=e.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$scope.contentDataList=[],$scope.hasmore=!1,ElectricalMallService.getTopMsg().success(function(e){$scope.bannerList=e.data.topBannerList,$scope.midActivtyList=e.data.midActivtyList,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,getFlashSales(),ElectricalMallService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId,1).success(function(e){$scope.floors=e.data.floors,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),$scope.page=1,$scope.getListInit()}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.backToTop=function(){$ionicScrollDelegate.scrollTo(0,$scope.scrollFixedTop,!0)},$scope.onScroll=function(){$scope.scrollTop=$ionicScrollDelegate.getScrollPosition().top,$scope.scrollFixedTop=$(".scrollFixed")[0].offsetTop,$scope.$apply(function(){$scope.showBackToTopImg=$scope.scrollTop>$scope.scrollFixedTop})},$scope.$on("$ionicView.enter",function(e,t){$(".backToTop").attr("totop",$(".scrollFixed")[0].offsetTop),$("go-top").attr("totop",$(".scrollFixed")[0].offsetTop),ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeEnter",function(e,v){if($scope.showBackToTopImg=!1,GetSwitchChecked(),$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});else{$scope.showFlashSale=!1;var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.areaId=obj[0].areaId}}),$scope.init(),$ionicScrollDelegate.scrollTop()}if($scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}}),$scope.$on("$ionicView.beforeLeave",function(e,t){$interval.cancel($scope.timer),$interval.cancel($scope.timer1)})}]),APP.service("ElectricalMallService",["$http","UrlService",function(e,t){this.getTopMsg=function(){return e.get(t.getNewUrl("ELECTRICALMALL_TOP"))},this.getMiddleMsg=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,street:a,position:n};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),r)}}]),APP.controller("familydetailController",["$scope","$stateParams","$sce",function(e,t,o){e.detailUrl=o.trustAsResourceUrl(t.detailUrl),e.title=t.title,e.goBack=function(){$("#iframecontainer").remove(),e.$ionicGoBack()}}]),APP.controller("familytryController",["$scope","$state",function(e,t){e.gotojianyue=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/",title:"简约风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/","_blank","location=yes")},e.gototianyuan=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/",title:"田园风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/","_blank","location=yes")},e.gotohunda=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/",title:"混搭风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/","_blank","location=yes")},e.gotocity=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/",title:"城市智慧生活"}):window.open("http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/","_blank","location=yes")}}]),APP.controller("furnishController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","furnishService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,furnishService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,furnishService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),furnishService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.EMSearchImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/EMSearch@3x.png",$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.AdornhomeCates[e].id),$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":
if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),furnishService.getAdornhomeCates().success(function(e){$scope.AdornhomeCates=e.data,getFurnishAllData($scope.AdornhomeCates[0].id)}),furnishService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq(0)").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("furnishService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("HomePageController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","HomePageService","ProductDetailService",function($ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,HomePageService,ProductDetailService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_icon")&&($scope.nowImgIcon=$localstorage.getObject("activity_icon")),"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.oldImgIcon={jydq:$rootScope.imgBaseURL+"img/homepageNew/jy.png",jjjz:$rootScope.imgBaseURL+"img/homepageNew/jz.png",bhcs:$rootScope.imgBaseURL+"img/homepageNew/bh.png",shfw:$rootScope.imgBaseURL+"img/homepageNew/sh.png",wddp:$rootScope.imgBaseURL+"img/homepageNew/kd.png",jrlc:$rootScope.imgBaseURL+"img/living.png",gd:$rootScope.imgBaseURL+"img/homepageNew/fl.png",xpzc:$rootScope.imgBaseURL+"img/homepageNew/more.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.activityColorOld={jydqFontColor:"#666666",jrlcFontColor:"#666666",wddpFontColor:"#666666",bhcsFontColor:"#666666",shfwFontColor:"#666666",jjjzFontColor:"#666666",xpzcFontColor:"#666666",gdFontColor:"#666666"},$scope.activityColor={},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):HomePageService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)locationFlag=!0,-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,locationFlag=!0;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.onScroll=function(){var e=$ionicScrollDelegate.getScrollPosition().top,t=Math.round(e/204*100)/100;$scope.$apply(function(){e<10?($scope.changeOpacity={"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0.30), rgba(255,255,255,0.00))"},$scope.changeColor={color:"#ffffff"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):e<100&&e>=10?($scope.changeOpacity={background:"rgba(255,255,255,"+t+")"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.changeColor={color:"#ffffff"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):($scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.changeColor={color:"#666666"},$scope.searchBg={background:"#e8e8e8",color:"#ffffff"},$scope.changeOpacity={background:"rgba(255,255,255,"+t+")"})})},$scope.init=function(){$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="homePage",HomePageService.getActivityIcon().success(function(e){e.data?($localstorage.setObject("activity_icon",e.data.iconImageConfig),$scope.nowImgIcon=e.data.iconImageConfig,e.data.iconFontConfig?($scope.activityColor={},$scope.activityColor=e.data.iconFontConfig):$scope.activityColor=$scope.activityColorOld):($localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld)}).error(function(){$localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld}),HomePageService.getActivityBg().success(function(e){e.data?($scope.homePageActivityBg=e.data,$localstorage.setObject("activity_bg",e.data),e.data.middleImagePart3?$(".sg_notice").removeClass("noActiveBorderTop"):$(".sg_notice").addClass("noActiveBorderTop"),$scope.homePageActivityBg1=$scope.homePageActivityBg.middleImagePart1,e.data.middleImagePart2?($scope.homePageActivityBg2=$scope.homePageActivityBg.middleImagePart2,$scope.homePageActivityBg2Img={background:"url('"+$scope.homePageActivityBg.middleImagePart2.pic+"') left top/100% no-repeat"}):$scope.homePageActivityBg2Img={background:"#ffffff"},$scope.homePageActivityBg3=$scope.homePageActivityBg.middleImagePart3):($(".sg_notice").addClass("noActiveBorderTop"),$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"})}).error(function(){$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"}}),GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),HomePageService.getTopMsg().success(function(e){$localstorage.setObject("homepage_topMsg",e),$scope.bannerList=e.data.topBannerList,$scope.good=e.data.good,$scope.askEvery=e.data.askEvery,$scope.mustBuy=e.data.mustBuy,$scope.wiki=e.data.wiki;var t=e.data.midCommList;$scope.midCommList=t?t.slice(0,2):null,$scope.midActivtyList=e.data.midActivtyList,$scope.midBannerList=e.data.midBannerList,$scope.crowdFunding=e.data.crowdFunding,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200),$scope.$broadcast("scroll.refreshComplete"),$scope.refreshing=!1}),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,HomePageService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.race=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):window.location.href=UrlService.getThirdUrl("race/")})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var c=t+"&openType=h5";window.emc.presentH5View(c,"")}else window.emc.presentH5View(t,"");else if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var l=t+"&openType=h5";window.open(l,"_blank","location=yes")}else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isIosApp="android":$scope.isIosApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isIosApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.$on("$ionicView.enter",function(e,t){ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$scope.refreshData=function(){$scope.refreshing=!0,GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()}),$scope.$on("$ionicView.beforeEnter",function(e,t){GetSwitchChecked(),setTimeout(function(){readCache()},0),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())})}]),APP.service("HomePageService",["$http","UrlService","MyStoreService","LoginService","$localstorage","UserService",function(e,t,o,s,i,a){this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))},this.isAuthoMid=function(e){o.login(e).success(function(e){a.setUser(e.data),i.set("sg_login_token_secret","Bearer"+e.data.sessionValue),memberId=a.getUser().mid,s.checkOpenStore(memberId).success(function(e){e.data?(s.setRole(1),i.set("storeId",memberId)):(s.setRole(0),i.set("storeId",20219251))})})}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.controller("ImageAndWordController",["$sce","$scope","imageAndWordService","$stateParams","$ionicPopup","$rootScope","$ionicScrollDelegate","$http","$interval",function(e,t,o,s,i,a,n,r,c){t.scrollToTop=function(){n.scrollTop([shouldAnimate=!0])},t.Mp42="",t.Png42="",t.flagMp4=!1,t.$on("$ionicView.beforeEnter",function(){t.productId=s.productId,t.tabNav="selection",t.flag=!1,o.doInit(t.productId).success(function(o,s,i,a){if(o.data.mp4FileId2){t.flagMp4=!0;var n=JSON.parse(o.data.mp4FileId2);t.Mp42=e.trustAsResourceUrl(n.video),t.Png42=n.img}else t.flagMp4=!1;if(o.success)if(null==o.data.detailImgs||0!=o.data.detailImgs.length){t.imagesUrl=e.trustAsHtml(o.data.detailImgs);var r=0,l=0,d=c(function(){if($("div#image-and-word").find("img").length)if(r=$("div#image-and-word").find("img").length,l==r)new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d);else{l=0;for(var e=0;e<r;e++)$("div#image-and-word").find("img")[e].width&&l++;l==r&&(new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d))}},200);t.flag=!1}else t.flag=!0;else t.flag=!0})}),a.$on("$stateChangeStart",function(e,t,o,s,i){if("imageAndWord"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()})}]),APP.service("imageAndWordService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCTDETAIL_PROMOS"),s)}}]),
APP.controller("lifeServiceController",["$scope","$ionicHistory","HomePageService","$rootScope","$state","UrlService","PopupService",function(e,t,o,s,i,a,n){e.goToLivingCost=function(){},e.goToEMC=function(){e.isApp?o.isWdHost().success(function(e){if(s.isWdHost=e.data.isHost,-1==e.data.isHost)i.go("login");else{var t=UserService.getUser().accessToken;t?window.emc.presentEmcView(a.getEnviroment(),t,""):n.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")}}):n.showToast("请去顺逛App查看此服务")},e.goBack=function(){t.goBack()}}]),APP.controller("ProductDetailController",["GoodsService","CirclePageService","$localstorage","HomePageService","$interval","$scope","$sce","$stateParams","$rootScope","ProductDetailService","CommonAddressService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","PopupService","$cookies","LoginService","ShopService","$ionicHistory","CreditService","$ionicModal","$http","$ionicScrollDelegate","GetCouponsService","flashService","WhiteShowsService","CartService","$location","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b,A,P,x,L,D,N,_,O){function k(){for(var e=0;e<a.choosedActiveObj.length;e++){for(var t=[],o=0;o<a.choosedActiveObj.length;o++)if(e!=o)for(var s=0;s<a.choosedActiveObj[o].length;s++)1==a.choosedActiveObj[o][s].active&&t.push(a.choosedActiveObj[o][s].sgAttribute.id);for(var i=[],n=0;n<a.sgStoreAttribute.length;n++){for(var r=a.sgStoreAttribute[n].attrValueIds.split(","),c=0,l=0;l<r.length;l++)for(var d=0;d<t.length;d++)t[d]==r[l]&&c++;c==t.length&&(i=i.concat(r))}for(var p=[],u=0;u<i.length;u++){var g=!0;if(0==p.length)p.push(i[u]);else{for(var m=0;m<p.length;m++)p[m]==i[u]&&(g=!1);g&&p.push(i[u])}}for(name in a.StoreAttribute)for(var n=0;n<a.StoreAttribute[name].length;n++){var f=a.StoreAttribute[name];if(f[0].attrName==a.choosedActiveObj[e][0].attrName&&1!=f[n].active){for(var h=!0,v=0;v<p.length;v++)if(f[n].sgAttribute.id==p[v]){h=!1;break}f[n].active=h?2:0}}}}function E(){for(var e=[],t=0;t<a.sgStoreAttribute.length;t++){for(var o=a.sgStoreAttribute[t].attrValueIds.split(","),s=0,i=0;i<o.length;i++)for(var n=0;n<a.attrValueIds.length;n++)a.attrValueIds[n]==o[i]&&s++;s==a.attrValueIds.length&&(e=e.concat(o))}for(var r=[],c=0;c<e.length;c++){var l=!0;if(0==r.length)r.push(e[c]);else{for(var d=0;d<r.length;d++)r[d]==e[c]&&(l=!1);l&&r.push(e[c])}}for(name in a.StoreAttribute)for(var t=0;t<a.StoreAttribute[name].length;t++){for(var p=a.StoreAttribute[name],u=!1,g=0;g<a.NoActiveObj.length;g++)p[t].attrName==a.NoActiveObj[g][0].attrName&&(u=!0);if(u){for(var m=!0,f=0;f<r.length;f++)if(p[t].sgAttribute.id==r[f]){m=!1;break}p[t].active=m?2:0}}}function U(){for(name in a.StoreAttribute){for(var e=!1,t=0;t<a.StoreAttribute[name].length;t++){var o=a.StoreAttribute[name];1==o[t].active&&(e=!0,a.StoreAttributeActiveList.push(o[t].sgAttribute.attrValueName),a.attrValueIds.push(o[t].sgAttribute.id),a.attrValueNames.join().indexOf(o[t].sgAttribute.attrValueName)<=-1&&a.attrValueNames.push(o[t].sgAttribute.attrValueName))}e&&a.choosedActiveObj.push(a.StoreAttribute[name])}var s=!0;for(name in a.StoreAttribute){for(var t=0;t<a.StoreAttribute[name].length;t++){var o=a.StoreAttribute[name];if(1==o[t].active){s=!1;break}s=!0}s&&a.NoActiveObj.push(a.StoreAttribute[name])}}function M(){for(var e=0;e<8;e++)a.divStrl[e]=12*e+1}function R(){for(var e=0;e<8;e++)a.divStrm[e]=12*e+1}function B(){for(var e=0;e<2;e++)a.divStrt[e]=90*e-8}function H(){var e=N.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&b({method:"POST",url:h.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){f.setUser(e.data),o.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}function F(){l.evalute(a.productId).success(function(e){a.positiveRate=e.data.positiveRate,a.totalNum=e.data.totalNum})}-1!=window.location.href.indexOf("fromCommunity")&&(c.fromCommunity=!0),a.hasProgram=0,a.noFresh=!1,a.remindSuccess=!1,a.hasMoreCoupons=!1;var G,V=1;a.expectTime="",a.commission=null,a.finMoreAct=!1,a.finalPrice="",a.actualPrice="",a.bigActivity=!1,a.getcoupons=!1;var j=0;a.IsShowAttribute="",a.StoreAttribute=null,a.StoreAttributePrice=0,a.StoreAttributNumber="有货",a.StoreAttributeActiveList=[],a.attrValueIds=[],a.attrValueIdsBefore=[],a.attrValueNames=[],a.NoActiveObj=[],a.skku=null,a.openSpecNumberType=null,a.isOpenBottom=!1,a.BottomCartNum="0",a.picAttr="",a.sgStoreAttribute=[],a.serviceProm=[],a.serId="",a.serviceDetail=[],a.AttrswiperImgs=[],a.isAllAttr=!1,a.isAllAttrpic=!1,a.isShowAttrLeftArrow=!1,a.tabNav="selection",a.isBuyer=I.getRole(),a.shareStoreId=r.shareStoreId,a.O2OStoreName="",a.o2oCode="",a.isFromBanner=!1;var z=y.viewHistory().backView;a.userId=f.getUser().mid,a.showShare=!1,a.moreShow=!1,a.isShowBigPic=!1,a.activeSlide=0,a.nowActiveSlide=0,a.isShowLeftArrow=!1,a.isShowService=!1,a.canGetVcode=!0,a.VCodeTips="获取验证码",a.VCodeStyle={color:"#2979FF"},a.Mp41="",a.Png41="",a.flagMp4=!1,a.a=1,a.b=1,a.isPackage=!1,a.message="",a.endT="",a.endTt="",a.endTh="",a.endTm="",a.endTs="",a.startT="",a.startTt="",a.startTh="",a.startTm="",a.startTs="";var W,q,J,Y;a.isShowCopyButton=!1,a.couponList=[],a.giftInfo="",a.stockNumber=null,a.o2oStoreId=null,a.whiteShowsState=1,a.whiteShowsCount=0,a.costInfo=[],a.isWhiteShows=!1,a.whiteShowsMsg="查看更多",a.whiteShowsTit="顺逛白条",a.stockType="",a.flagMP4IconStyle={display:"inline-block"},a.orderInitParams=null,a.iosContentCss={top:"64px"},a.otherContentCss={top:"44px"},a.hardLoading=function(){a.StoreMsgModal.show(),l.getHomeDecorationStoreMsg(a.o2oCode,a.productModel.cityId).success(function(e){e.success&&e.data?a.homeDecorationData=e.data:a.homeDecorationData=[]}).error(function(){a.homeDecorationData=[]})},a.hasProgarmClick=function(){m.go("houseSoluteDetail",{solutionId:a.productId})},a.showWhiteShows=function(){if(!f.getUser().accessToken)return void v.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");var e=null;e=a.productModel.isActivityProduct?a.finalPrice:a.actualPrice,L.cost({token:f.getUser().accessToken,payAmt:e,proGroup:a.productModel.product.department,sku:a.productModel.product.sku}).success(function(e){e.success&&(a.whiteShowsMsg=e.data.feeInfo,a.whiteShowsTit=e.data.feeInfo,a.whiteShowsState=e.data.applyStatus,a.costInfo=e.data.costInfo,1==a.whiteShowsState&&(a.whiteShowsCount=e.data.crdComAvailAmt),a.isWhiteShows=!0),100==e.errorCode&&m.go("login")})},a.hideWhiteShows=function(){a.isWhiteShows=!1},a.clickWhiteShows=function(){2==a.whiteShowsState||3==a.whiteShowsState?m.go("applyForWhite"):0==a.whiteShowsState&&L.applyForOpen({backUrl:window.location.href,userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){e.success&&L.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&m.go("login")})},a.OpenAndClose="modal-Spec-Closes",a.SpecNumberActive=function(e,t){a.StoreAttributeActiveList=[],a.attrValueIds=[],a.attrValueNames=[],a.NoActiveObj=[],a.choosedActiveObj=[];if(0==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=1}else if(1==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=0}else if(2==e.active)return;if(U(),k(),E(),a.attrValueIds.length>0)if(function(e){var t=0;for(var o in e)t++;return t}(a.StoreAttribute)==a.attrValueIds.length)for(var o=0;o<a.sgStoreAttribute.length;o++){for(var s=0,i=0;i<a.attrValueIds.length;i++)a.sgStoreAttribute[o].attrValueIds.indexOf(a.attrValueIds[i])>-1&&s++;s==a.attrValueIds.length&&(a.StoreAttributePrice=a.sgStoreAttribute[o].price,a.StoreAttributNumber="库存"+a.sgStoreAttribute[o].num,a.skku=a.sgStoreAttribute[o].skku,a.picAttr=a.sgStoreAttribute[o].pic,a.stockNumber=a.sgStoreAttribute[o].num)}else a.StoreAttributePrice=a.actualPrice,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.skku=null,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"";else a.StoreAttributePrice=a.actualPrice,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.skku=null,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"";0==a.NoActiveObj.length?a.isAllAttr=!0:a.isAllAttr=!1},a.openSpecNumber=function(e){a.IsShowAttribute&&0==a.NoActiveObj.length&&0!=a.StoreAttributeActiveList.length&&null!=a.skku&&e>1?2==e?(a.openSpecNumberType=2,a.addToCart()):3==e?(a.openSpecNumberType=3,a.buyNow()):4==e?(a.openSpecNumberType=4,a.buyNow()):5==e?(a.openSpecNumberType=5,a.buyNow(1)):6==e?(a.openSpecNumberType=6,a.toNotice()):7==e?(a.openSpecNumberType=7,a.startNotice()):8==e?(a.openSpecNumberType=8,a.nowOrder()):9==e&&(a.openSpecNumberType=9,a.buyNow()):a.IsShowAttribute?(a.isOpenBottom=1==e,1==e?a.openSpecNumberType=1:2==e?a.openSpecNumberType=2:3==e?a.openSpecNumberType=3:4==e?a.openSpecNumberType=4:5==e?a.openSpecNumberType=5:6==e?a.openSpecNumberType=6:7==e?a.openSpecNumberType=7:8==e?a.openSpecNumberType=8:9==e&&(a.openSpecNumberType=9),null==a.StoreAttribute&&l.getSgStoreAttribute(a.productId,a.o2oStoreId,a.productModel.product.sku).success(function(e){if(e.success){for(var t=e.data.sgAttribute,o=e.data.sgStoreAttribute,s=0;s<o.length;s++)a.AttrswiperImgs.push(o[s].pic);for(name in t){j++;for(var s=0;s<t[name].length;s++){t[name][s].active=0}}if(1==j)for(key in t)for(var s=0;s<t[key].length;s++)for(var i=t[key],n=0;n<o.length;n++)i[s].sgAttribute.id==o[n].attrValueIds&&0==o[n].num&&(i[s].active=2);a.StoreAttribute=t;for(var s=0;s<o.length;s++)o[s].num>0&&a.sgStoreAttribute.push(o[s]);U(),E()}}),a.OpenAndClose="modal-Spec-opens",U(),E()):2==e?a.addToCart():3==e?a.buyNow():4==e?a.buyNow():5==e?a.buyNow(1):6==e?a.toNotice():7==e?a.startNotice():8==e?a.nowOrder():9==e&&a.buyNow()},a.closeConfirmModel=function(){if(1!=a.openSpecNumberType)if(null!=a.skku&&0==a.NoActiveObj.length&&0!=a.StoreAttributeActiveList.length);else{for(var e="",t=0;t<a.NoActiveObj.length;t++)e.indexOf(a.NoActiveObj[t][0].attrName)<=-1&&(e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName);if(e)return void v.showToast("请选择"+e)}2==a.openSpecNumberType?a.addToCart():3==a.openSpecNumberType?a.buyNow():4==a.openSpecNumberType?a.buyNow():5==a.openSpecNumberType?a.buyNow(1):6==a.openSpecNumberType?a.toNotice():7==a.openSpecNumberType?a.startNotice():8==a.openSpecNumberType?a.nowOrder():9==a.openSpecNumberType&&a.buyNow(),a.closeSpecNumber()},a.closeSpecNumber=function(){a.OpenAndClose="modal-Spec-Closes"},a.getCartNumFn=function(e){l.getCartNum().success(function(t){t.success&&(a.BottomCartNum=t.data,1==e&&u(function(){v.showToast("加入购物车成功")},200))})};var K=window.innerHeight,Q=K-373+"px";a.storeContentHeight={height:"auto"},a.contentHeight={height:Q};var X=K-373+52+"px";a.storeMsgTop={top:X},a.addressTitle="配送至",a.dataAdd=null,a.flag="PRODUCT_DETAIL_LOCATION",a.defaultValue=null,a.level=0;var Z,ee,te={};a.divStrl=[],a.divStrm=[],a.divStrt=[],a.init=function(){H(),a.showQQ=!1,a.showWeChat=!1,a.isShowCopyButton=!1,a.positiveRate=0,a.totalNum=0,a.skku=null,a.user=f.getUser(),a.iscompleteLoad=!1,a.productId=r.productId,F(),window.cordova?o.get("storeId",c.globalConstant.storeId)==r.storeId?a.storeId=r.storeId:a.storeId=o.get("storeId",c.globalConstant.storeId):r.shareStoreId?(c.shareId=r.shareStoreId,a.storeId=c.shareId):a.storeId=c.shareId?c.shareId:r.storeId,a.o2oType=r.o2oType,a.fromType=r.fromType,0==a.noFresh&&(l.hasProgram(a.productId).success(function(e){e.success?a.hasProgram=e.data:v.showToast(e.message)}),l.loadData(a.productId,a.storeId,a.o2oType,a.fromUrl,a.fromType).success(function(e,o,s,r){function d(e){return e=e<10?"0"+e:e}if(a.iscompleteLoad=!0,a.productModel=e.data,a.picAttr=a.productModel.swiperImgs?a.productModel.swiperImgs[0]:"",c.addressDefaultMsg={provinceId:a.productModel.provinceId,cityId:a.productModel.cityId,regionId:a.productModel.regionId,streetId:a.productModel.streetId,provinceName:a.productModel.provinceName,cityName:a.productModel.cityName,pcrName:a.productModel.pcrName},c.addressDefMsg=JSON.stringify(c.addressDefaultMsg),window.cordova&&c.gio.track("ProdView",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId}),a.copyText=a.productModel.product.productFullName+a.productModel.product.productTitle+h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.productModel.storeId+"/"+a.productModel.storeId+"?fs",e.data.mp4FileId1){var p=JSON.parse(e.data.mp4FileId1);a.flagMp4=!0,a.Mp41=n.trustAsResourceUrl(p.video),a.Png41=p.img,a.a=1,a.b=1}else a.a=0,a.b=1,a.flagMp4=!1;a.endT=a.productModel.activityEndTime-a.productModel.activityNowTime,W=i(function(){a.endTt=Math.floor(a.endT/86400),a.endTh=d(Math.floor((a.endT-86400*a.endTt)/3600)),a.endTm=d(Math.floor((a.endT-86400*a.endTt-3600*a.endTh)/60)),a.endTs=d(a.endT-86400*a.endTt-3600*a.endTh-60*a.endTm),-1==--a.endT&&(m.reload(),i.cancel(W),i.cancel(q))},1e3),a.startT=a.productModel.activityStartTime-a.productModel.activityNowTime,q=i(function(){a.startTt=Math.floor(a.startT/86400),a.startTh=d(Math.floor((a.startT-86400*a.startTt)/3600)),a.startTm=d(Math.floor((a.startT-86400*a.startTt-3600*a.startTh)/60)),a.startTs=d(a.startT-86400*a.startTt-3600*a.startTh-60*a.startTm),-1==--a.startT&&(m.reload(),i.cancel(q),i.cancel(W))},1e3),a.productCount=1,a.productModel.subProductImagesList||(a.productModel.subProductImagesList=[]),a.actualPrice=a.productModel.actualPrice,a.StoreAttributePrice=a.actualPrice,a.productModel.isActivityProduct?a.finalPrice=a.productModel.finalPrice:(a.productModel.finalPrice-a.productModel.actualPrice>0&&(a.finMoreAct=!0),a.finalPrice=a.productModel.finalPrice),1==a.productModel.product.onSale&&l.locationChange(a.productModel.product.sku,a.productModel.product.productId,a.productModel.regionId,1,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId).success(function(e,o,s,n){if(a.staticProm=e.data.l,a.hasStock=e.data.hasStock,a.isSupportCOD=e.data.isSupportCOD,a.expectTime=e.data.expectTime,a.commission=e.data.commission,a.commissionRate=e.data.commissionRate,a.finalPrice=e.data.finalPrice,a.actualPrice=e.data.actualPrice,a.StoreAttributePrice=a.actualPrice,a.finMoreAct=a.finalPrice-a.actualPrice>0,a.bigActivity=e.data.bigActivity,a.isB2C=e.data.isB2C,a.freeOrder=e.data.freeOrder,a.halfDay=e.data.halfDay,a.oneDay=e.data.oneDay,2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var r=0;r<a.serviceProm.length;r++)a.serId+=a.serviceProm[r].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[];if(a.isPackage=e.data.isPackage,a.couponList=e.data.sgStoreCouponVoList,a.giftInfo=e.data.giftInfo,a.stockNumber=e.data.stockNum,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.isFlashsales=e.data.isFlashsales,e.data.flashsalesEndTime?a.flashsalesEndTime=new Date(e.data.flashsalesEndTime.replace(/-/g,"/")).getTime():a.flashsalesEndTime=0,a.stockType=e.data.stockType,a.flashsalesEndTime<(new Date).getTime()&&(a.isFlashsales=!1),e.data.o2OStoreInfo&&e.data.o2OStoreInfo.o2OStoreName?(a.showO2OMsg=!0,a.O2OStoreName=e.data.o2OStoreInfo.o2OStoreName,a.avatarImageFileId=e.data.o2OStoreInfo.avatarImageFileId,a.o2oStoreId=e.data.o2OStoreInfo.o2oStoreId,a.O2Omobile=e.data.o2OStoreInfo.mobile,a.O2OStoreCode=e.data.o2OStoreInfo.storeCode,a.o2oCode=e.data.o2OStoreInfo.storeCode,a.O2Omobile?a.showPhoneCall=!0:a.showPhoneCall=!1,a.serviceGrade=e.data.o2OStoreInfo.serviceGrade,a.productGrade=e.data.o2OStoreInfo.productGrade,a.logisticalGrade=e.data.o2OStoreInfo.logisticalGrade):a.showO2OMsg=!1,a.o2oStoreId||(a.o2oStoreId=""),t.getCircleLink(a.productId,a.o2oStoreId,"2").success(function(e){e.success&&(a.topTeam=!0,a.teamUrl=e.data)}),l.getProductCouponsHas(a.productModel.product.sku,a.productModel.product.productId,1,a.actualPrice,a.productModel.storeId,a.o2oStoreId).success(function(e){e.success&&(a.couponListNew=e.data.couponList)}),null==a.o2oStoreId||"null"==a.o2oStoreId)var d="";else var d=a.o2oStoreId;if(l.getIsShowAttr(a.productId,d).success(function(e){e.result?a.IsShowAttribute=!0:a.IsShowAttribute=!1}),window.cordova&&c.gio.track("stockInfo",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock,ReceivingProvince:a.productModel.provinceName,ReceivingCity:a.productModel.cityName,ReceivingDistrict:a.productModel.regionName?a.productModel.regionName.substring(0,a.productModel.regionName.indexOf("/")):"",ReceivingStreet:a.productModel.regionName?a.productModel.regionName.substring(a.productModel.regionName.indexOf("/")+1):""}),"undefined"!=typeof gio&&(gio("track","getAddress",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock?"有货":"无货",ReceivingProvince:a.productModel.provinceName,ReceivingCity:a.productModel.cityName,ReceivingDistrict:a.productModel.regionName?a.productModel.regionName.substring(0,a.productModel.regionName.indexOf("/")):"",ReceivingStreet:a.productModel.regionName?a.productModel.regionName.substring(a.productModel.regionName.indexOf("/")+1):""}),gio("track","ProdView",{productId:a.productModel.product.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId})),window.baifend&&l.getProductCateName(a.productModel.product.productCatePath).success(function(e){var t={uid:a.userId?a.userId+"":"",del:!1,name:a.productModel.product.productFullName,seller_lnk:"/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.storeId+"/",cmp:a.productModel.product.productActivityInfo?a.productModel.product.productActivityInfo:"",typ:"shop",img:a.productModel.product.defaultImageUrl,memp:a.actualPrice,ratecnt:a.totalNum,cat:e.data,brd:a.productModel.product.brandName,stk:a.stockNumber+""};window.baifend.onAddItem(a.productModel.product.sku,t)}),1==a.isFlashsales){a.state=!0;var p=new Date,u=a.flashsalesEndTime,g=p.getTime();if(u<g)a.state=!1;else var f=i(function(){g+=1e3;var e=parseInt((u-g)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime1=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),e<=-1&&(a.state=!1,i.cancel(f),m.reload())},1e3)}a.originalPrice=e.data.originalPrice,a.isAcReserve=e.data.isAcReserve,a.acReserveType=e.data.acReserveType,a.acReserveId=e.data.acReserveId,e.data.acReserveEndTime?a.acReserveEndTime=new Date(e.data.acReserveEndTime.replace(/-/g,"/")).getTime():a.acReserveEndTime=0,a.state1=!0;var h=new Date,v=a.acReserveEndTime,$=h.getTime(),S=i(function(){$+=1e3;var e=parseInt((v-$)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),-1==e&&(G.close(),m.reload(),i.cancel(S),a.state1=!1)},1e3);1==a.isAcReserve&&(1==a.acReserveType&&(a.repur="预约",a.repurNum=e.data.acReserveNum),2==a.acReserveType&&(a.repur="抢购",a.repurNum=e.data.acPurchaseNum))}),g.update()}).error(function(e,t,o,s){v.showToast(e.message)}))},a.nus=function(){if(a.productCount<2)a.productCount=1;else if(!a.isAllAttr&&a.IsShowAttribute){for(var e="",t=0;t<a.NoActiveObj.length;t++)e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName;v.showToast("请选择"+e)}else a.productCount-=1,a.productCount<=a.stockNumber&&(a.hasStock=!0);if(2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var t=0;t<a.serviceProm.length;t++)a.serId+=a.serviceProm[t].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[]},a.plus=function(){if(a.IsShowAttribute)if(a.isAllAttr)a.productCount+=1,a.productCount>a.stockNumber&&(a.hasStock=!1);else{for(var e="",t=0;t<a.NoActiveObj.length;t++)e+="&nbsp;&nbsp;"+a.NoActiveObj[t][0].attrName;v.showToast("请选择"+e)}else a.productCount+=1,a.productCount>a.stockNumber&&(a.hasStock=!1);if(2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var t=0;t<a.serviceProm.length;t++)a.serId+=a.serviceProm[t].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[]},a.makeACall=function(){p.confirm({template:a.O2Omobile,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+a.O2Omobile,"_system"):window.open("tel:"+a.O2Omobile))})},c.$on("$stateChangeStart",function(e,t,o,s,i){if("productDetail"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()}),a.slideHasChanged=function(e){for(var t=document.getElementsByTagName("video"),o=0;o<t.length;o++)t[o].pause()},a.seeBigPic=function(e){"attr"==e?(a.isShowAttrLeftArrow=!0,a.isAllAttrpic=!0,a.activeSlide=0,setTimeout(function(){for(var e=a.AttrswiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500)):(a.isShowBigPic=!0,a.isShowLeftArrow=!0,a.flagMp4?a.activeSlide=e:a.activeSlide=e-1,setTimeout(function(){for(var e=a.productModel.swiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500))},a.showBigPic=function(e){a.isShowBigPic=!1,a.isShowLeftArrow=!1},a.showBigPicAttr=function(){a.isShowAttrLeftArrow=!1,a.isAllAttrpic=!1},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},a.addressInit=function(t,o,s,i){if(a.addressTipFlag=!1,A.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=t?JSON.parse(t):{},a.level=i,o){a.dataAdd=JSON.parse(o),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel;for(var n=0;n<a.nowLevelIndex.length;n++)n>a.nowLevel&&(a.nowLevelIndex[n]=-1)}else a.finish=!1,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",e.getLocationList("",0).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel;for(var t=(JSON.stringify(a.defaultValue),JSON.stringify(a.dataAdd),0);t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){v.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var oe=!1;a.goSelect=ionic.Utils.debounce(function(t,o){for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=t;var o=arguments[1],t=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=o.text,a.defaultValue["value"+a.level]=o.value,a.level>-2)-1==a.level&&(a.selectProvince=o.text,a.provinceIndex=t,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=A.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel),ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,e.getLocationList(o.value,ah).success(function(e){1==ah&&(ee=o.value),a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(t,s,a.flag,a.level)}).error(function(e){v.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.citySel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",e.getLocationList(ee,1).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,-1),a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,A.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}).error(function(e){v.showToast("获取地址信息失败！")})};else if(a.level>-4)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,-3==a.level?(a.selectArea=o.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=A.$getByHandle("mainScroll").getScrollPosition().top):a.cityTop=A.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,l.getLocationList(o.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(Z=o.value);var t=JSON.stringify(a.defaultValue),s=JSON.stringify(a.dataAdd);a.addressInit(t,s,a.flag,a.level)}).error(function(e){v.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",l.getLocationList(Z,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),A.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){v.showToast("获取地址信息失败！")})};else{if(oe)return;u(function(){oe=!1},1500),c.$broadcast(a.flag,a.defaultValue),oe=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=c.globalConstant.autoPosition){te=d.getAddressInfo();var e=te.regionName+"/"+te.streetName;l.addAddress(te.provinceId,te.cityId,te.areaId,e,te.streetId).success(function(){var e={"text-1":te.provinceName,"text-2":te.cityName,"text-3":te.regionName,"text-4":te.streetName,"value-1":te.provinceId,"value-2":te.cityId,"value-3":te.areaId,"value-4":te.streetId};c.$broadcast(a.flag,e),a.addressModal.hide()})}},C.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},C.fromTemplateUrl("templates/common/CommonStoreInfo.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.StoreMsgModal=e}),a.closeStoreModal=function(){a.StoreMsgModal.hide()};var se=c.$on("PRODUCT_DETAIL_LOCATION",function(e,o){a.noFresh=!0,a.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+"/"+o["text-4"],a.productModel.provinceId=o["value-1"],a.productModel.cityId=o["value-2"],a.productModel.regionId=o["value-3"],a.productModel.streetId=o["value-4"],c.addressStr=JSON.stringify(o),a.productModel.pcrName&&a.noFresh&&l.locationChange(a.productModel.product.sku,a.productModel.product.productId,a.productModel.regionId,a.productCount,o["value-1"],o["value-2"],a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId).success(function(e,s,n,r){if(a.staticProm=e.data.l,a.o2oCode=e.data.o2OStoreInfo.storeCode,a.hasStock=e.data.hasStock,a.isSupportCOD=e.data.isSupportCOD,a.expectTime=e.data.expectTime,a.commission=e.data.commission,a.commissionRate=e.data.commissionRate,a.finalPrice=e.data.finalPrice,a.actualPrice=e.data.actualPrice,a.StoreAttributePrice=a.actualPrice,a.noFresh=!1,a.iscompleteLoad=!0,a.finMoreAct=a.finalPrice-a.actualPrice>0,a.bigActivity=e.data.bigActivity,a.isB2C=e.data.isB2C,a.freeOrder=e.data.freeOrder,a.halfDay=e.data.halfDay,a.oneDay=e.data.oneDay,2!=a.productModel.product.productAttribute){a.serId="",a.serviceProm=Object.assign([],a.staticProm,[]);for(var d=0;d<a.serviceProm.length;d++)a.serId+=a.serviceProm[d].i+",";(a.isB2C||!a.isSupportCOD||a.productModel.isActivityProduct||!a.hasStock||a.productCount>2)&&a.serviceProm.map(function(e,t){if("货到付款"==e.n){a.serId="",a.serviceProm.splice(t,1);for(var o=0;o<a.serviceProm.length;o++)a.serId+=a.serviceProm[o].i+","}})}else a.serviceProm=[];if(a.isPackage=e.data.isPackage,a.couponList=e.data.sgStoreCouponVoList,a.giftInfo=e.data.giftInfo,a.stockNumber=e.data.stockNum,a.StoreAttributNumber=a.hasStock?"有货":"无货",a.isFlashsales=e.data.isFlashsales,e.data.flashsalesEndTime?a.flashsalesEndTime=new Date(e.data.flashsalesEndTime.replace(/-/g,"/")).getTime():a.flashsalesEndTime=0,a.stockType=e.data.stockType,a.flashsalesEndTime<(new Date).getTime()&&(a.isFlashsales=!1),window.cordova&&c.gio.track("stockInfo",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock,ReceivingProvince:o["text-1"],ReceivingCity:o["text-2"],ReceivingDistrict:o["text-3"],ReceivingStreet:o["text-4"]}),"undefined"!=typeof gio&&gio("track","getAddress",{productId:a.productModel.product.productId,productFirstName:"",hasStock:a.hasStock?"有货":"无货",ReceivingProvince:o["text-1"],ReceivingCity:o["text-2"],ReceivingDistrict:o["text-3"],ReceivingStreet:o["text-4"]}),1==a.isFlashsales){a.state=!0;var p=new Date,u=a.flashsalesEndTime,g=p.getTime();if(u<g)a.state=!1;else var f=i(function(){g+=1e3;var e=parseInt((u-g)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime1=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),e<=-1&&(a.state=!1,i.cancel(f),m.reload())},1e3)}a.originalPrice=e.data.originalPrice,a.isAcReserve=e.data.isAcReserve,a.acReserveType=e.data.acReserveType,a.acReserveId=e.data.acReserveId,e.data.acReserveEndTime?a.acReserveEndTime=new Date(e.data.acReserveEndTime.replace(/-/g,"/")).getTime():a.acReserveEndTime=0,a.state1=!0;var h=new Date,v=a.acReserveEndTime,$=h.getTime(),S=i(function(){$+=1e3;var e=parseInt((v-$)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,s=parseInt(o/3600),n=e-24*t*60*60-60*s*60,r=parseInt(n/60),c=e-24*t*60*60-60*s*60-60*r;a.showtime=t+"天"+x.PrefixInteger(s)+":"+x.PrefixInteger(r)+":"+x.PrefixInteger(parseInt(c)),-1==e&&(G.close(),m.reload(),a.state=!1,i.cancel(S))},1e3);1==a.isAcReserve&&(1==a.acReserveType&&(a.repur="预约",a.repurNum=e.data.acReserveNum),2==a.acReserveType&&(a.repur="抢购",a.repurNum=e.data.acPurchaseNum)),e.data.o2OStoreInfo&&e.data.o2OStoreInfo.o2OStoreName?(a.showO2OMsg=!0,a.O2OStoreName=e.data.o2OStoreInfo.o2OStoreName,a.avatarImageFileId=e.data.o2OStoreInfo.avatarImageFileId,a.o2oStoreId=e.data.o2OStoreInfo.o2oStoreId,a.O2Omobile=e.data.o2OStoreInfo.mobile,a.O2Omobile?a.showPhoneCall=!0:a.showPhoneCall=!1,a.serviceGrade=e.data.o2OStoreInfo.serviceGrade,a.productGrade=e.data.o2OStoreInfo.productGrade,a.logisticalGrade=e.data.o2OStoreInfo.logisticalGrade):a.showO2OMsg=!1,t.getCircleLink(a.productId,a.o2oStoreId,"2").success(function(e){e.success&&(a.topTeam=!0,a.teamUrl=e.data)}),l.getProductCouponsHas(a.productModel.product.sku,a.productModel.product.productId,1,a.actualPrice,a.productModel.storeId,a.o2oStoreId||"").success(function(e){e.success&&(a.couponListNew=e.data.couponList)}),l.getIsShowAttr(a.productId,a.o2oStoreId||"").success(function(e){e.result?a.IsShowAttribute=!0:a.IsShowAttribute=!1})})});a.$on("$destroy",function(){se(),se=null}),a.openMore=function(){a.moreShow=!a.moreShow},a.closeCoupons=function(){a.getcoupons=!1,V=1},a.logConpous=function(){l.getShopCoupons(a.productModel.product.productId,a.productModel.product.brandId,a.productModel.product.productCateId,a.productModel.actualPrice,V,5,a.o2oStoreId).success(function(e,t,o,s){e.success?1==V?(V++,a.shopCoupons=e.data,A.$getByHandle("mainScroll").scrollTop(),a.shopCoupons.length<e.totalCount?(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!0):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)):(V++,
a.shopCoupons=a.shopCoupons.concat(e.data),a.shopCoupons.length<e.totalCount?(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!0):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)):(a.$broadcast("scroll.infiniteScrollComplete"),a.hasMoreCoupons=!1)})},a.openCoupons=function(){a.logConpous(),a.getcoupons=!0},a.getNewCoupons=function(e){s.isWdHost().success(function(t){c.isWdHost=t.data.isHost,-1==c.isWdHost?m.go("login"):P.doGetNewCoupons(e).success(function(e){e.success?(c.couponXyzType=!0,A.scrollTop(),V=1,a.logConpous()):(a.remindSuccess=!0,a.message=e.message,setTimeout(function(){a.$apply(function(){a.remindSuccess=!1})},1500))})})},a.goMessageCenter=function(){a.moreShow=!1,m.go("messageCenter")},a.goBack=function(){if("advertisement"==c.fromState)m.go("homePage");else if(0==y.viewHistory().histories.root.cursor&&c.fromCommunity){var e=window.history.length;window.history.go(-(e-c.firstLocationPage+1))}else a.goBackFlag&&(a.goBackFlag=!1,y.goBack())},a.showCopyButton=function(){window.cordova&&(a.isShowCopyButton=!0)},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(){a.showBackBtn=c.fromCommunity||!c.fromCommunity&&0!=y.viewHistory().histories.root.cursor,a.isShowBigPic=!1,a.remindSuccess=!1,a.isWhiteShows=!1,V=1,a.getcoupons=!1,conjs=document.getElementsByClassName("container"),M(),R(),B(),a.goBackFlag=!0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&A.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),a.isIos=!!ionic.Platform.isIOS(),c.isApp=!!window.cordova||void 0,a.shareStoreId=r.shareStoreId,a.userId=f.getUser().mid,a.isBuyer=I.getRole(),a.init(),a.addressInit(a.dataAdd,a.defaultValue,"PRODUCT_DETAIL_LOCATION",0),y.viewHistory().backView&&(z=y.viewHistory().backView,"bannerTheme"!=z.stateName&&"bannerDaily"!=z.stateName||(a.isFromBanner=!0)),a.$on("$destroy",function(){a.addressModal.remove()}),c.addressStr=void 0,J=window.navigator.userAgent.toLowerCase(),Y="micromessenger"==J.match(/MicroMessenger/i),a.getCartNumFn(0)}),a.$on("$ionicView.afterLeave",function(){i.cancel(W),i.cancel(q)}),a.changeState=function(e){"orderDetail"==z.stateName&&0==a.isBuyer||(1==e?l.changeChooseStateJia(a.productModel.product.productId,"1").success(function(e,t,o,s){a.productModel.onShelf=!a.productModel.onShelf}):l.changeChooseStateDui(a.productModel.product.productId).success(function(e,t,o,s){a.productModel.onShelf=!a.productModel.onShelf}))},a.addToCart=function(){1==a.isFlashsales&&1!=a.productCount?v.showToast("限时抢购商品，一次只能购买一个"):D.loadCartMessage().success(function(e){if(1==a.isFlashsales&&e.data.carts)for(var t=0;t<e.data.carts.length;t++)if(e.data.carts[t].productId==a.productId)return v.showToast("限时抢购商品，一次只能购买一个"),!1;l.checkStockForPay(a.IsShowAttribute?a.skku:"",a.productModel.product.productId,a.productModel.regionId,a.productCount,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId,a.stockType,a.o2oStoreId,a.productModel.storeId).success(function(e,t,o,s){if(!e.data.hasStock)return a.showPopup("库存不足！"),!1;l.addToCart(a.productModel.product.sku,a.productModel.product.productId,a.productCount,"",a.productModel.product.productId,a.skku,a.attrValueNames,a.o2oStoreId,a.productModel.streetId).success(function(e,t,o,s){1==e.success?(window.cordova&&c.gio.track("ScAdd",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId,skku:a.skku,attrValueNames:a.attrValueNames}),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr3","addcart","1"]),a.getCartNumFn(1),a.IsShowAttribute&&(a.productCount=1)):v.showToast("加入购物车失败")})})})},a.buyNow=function(e){a.IsShowAttribute?a.orderInitParams={proList:[{proId:a.productModel.product.productId,num:a.productCount,sku:a.skku,name:a.attrValueNames.join()}],street:a.productModel.streetId}:a.orderInitParams={proList:[{proId:a.productModel.product.productId,num:a.productCount}],street:a.productModel.streetId},s.isWdHost().success(function(t){c.isWdHost=t.data.isHost,-1==c.isWdHost?m.go("login"):l.checkStockForPay(a.skku,a.productModel.product.productId,a.productModel.regionId,a.productCount,a.productModel.provinceId,a.productModel.cityId,a.productModel.pcrName,a.productModel.storeId,a.productModel.streetId,a.stockType,a.o2oStoreId,a.productModel.storeId).success(function(t,o,s,i){if(!t.data.hasStock&&"1"!=e)return l.loadData(a.productId,a.storeId,a.o2oType,a.fromUrl,a.fromType).success(function(e){if(e.data.product.bookable){p.show({template:'<div style="color: black;text-align: center;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>库存不足，是否去预订?</span></div>',scope:a,buttons:[{text:"否"},{text:"<b>是</b>",type:"button-positive",onTap:function(e){l.buyNow(a.orderInitParams).success(function(e,t,o,s){if(e.success&&e.data){var i=new Date;i.setDate(i.getDate()+1),m.go("orderConfirm",{orderInitParams:JSON.stringify(a.orderInitParams)})}else a.showPopup("操作失败")}).error(function(e,t,o,s){a.showPopup("操作失败！")})}}]})}else a.showPopup("库存不足！")}),!1;l.buyNow(a.orderInitParams).success(function(t,o,s,i){if(t.success&&t.data){window.cordova&&c.gio.track("BuyNow",{productId:a.productId,productFirstName:"",productSecondName:"",o2oType:a.o2oType,storeId:a.storeId});var n=new Date;n.setDate(n.getDate()+1),"1"===e?S.put("is_book","1",{expires:n,path:"/"}):S.put("is_book","",{expires:n,path:"/"}),m.go("orderConfirm",{orderInitParams:JSON.stringify(a.orderInitParams)})}else"1001"==t.code&&t.success,a.showPopup(t.message)}).error(function(e,t,o,s){a.showPopup("操作失败！")})})})},a.toNotice=function(){p.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>商品名称：</span><span ng-bind="productModel.product.productFullName"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.checkNotice(a.productId,a.user.mobile,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId).success(function(e){if(e.success)if(0===e.result)l.arriveNotice(a.productId,a.user.mobile,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId,a.productModel.product.sku,a.productModel.product.productFullName,a.productModel.provinceName,a.productModel.cityName,a.productModel.regionName,a.o2oStoreId).success(function(e){if(e.success){v.showAlert("","您的资料已经提交，到货后我们会第一时间通知您！")}});else{v.showAlert("","该手机号在该地区已经申请到货通知，不能重复申请！")}})}}]})},a.startNotice=function(){p.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.startNotice(a.productId,a.user.mobile).success(function(e){v.showToast("提交成功！")})}}]})},a.tianJiaShouCang=function(){s.isWdHost().success(function(e){c.isWdHost=e.data.isHost,-1==c.isWdHost?m.go("login"):l.addShouCang(a.productId,a.productModel.product.productName,a.productModel.product.defaultImageUrl,a.productModel.product.sku,a.productModel.pcrName).success(function(e){a.showPopup("收藏成功"),a.productModel.isCollected=!a.productModel.isCollected})})},a.quXiaoShouCang=function(){l.cancelShouCang(a.productId).success(function(e){a.showPopup("取消成功"),a.productModel.isCollected=!a.productModel.isCollected})},a.showPopup=function(e){var t=p.show({template:e});u(function(){t.close()},1e3)},a.customerServe=function(){if(f.isUserLogin())if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&u(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else a.kfTocken=o.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+a.productId+"&storeId="+a.storeId+"&flag="+a.kfTocken);else m.go("login")},a.share=function(){if(!f.getUser().mid)return void m.go("login");if(a.moreShow=!1,window.device&&window.device.hasNewShare){if(!a.productModel)return void a.showPopup("网络连接失败，请稍后分享");a.showShare=!a.showShare}else if(window.umeng){if(!a.productModel)return void a.showPopup("网络连接失败，请稍后分享");var e=a.productModel.product.productFullName,t=a.productModel.product.productTitle||a.productModel.product.productFullName,o=a.productModel.product.defaultImageUrl,s=h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.productModel.storeId+"/"+a.productModel.storeId+"?fs";window.umeng.share(e,t,o,s,0)}},a.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),v.showToastShort("复制成功"),a.isShowCopyButton=!1):v.showToast("请下载APP执行此操作")},a.hideblackCover=function(){a.showShare=!1},a.shareToPlatform=function(e){if(!f.getUser().mid)return void m.go("login");var t=a.productModel.product.productFullName,o=a.productModel.product.productTitle||a.productModel.product.productFullName,s=a.productModel.product.defaultImageUrl,i=h.getShareLinkHeader()+"productDetail/"+a.productId+"/"+a.o2oType+"/"+a.fromType+"/"+a.userId+"/"+a.userId+"?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,T.shareSuccessCallback),T.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,T.shareSuccessCallback),T.qqShare()),5==e?a.copeText(i):T.successShare()):alert("umeng undefined 只能在app分享"),a.showShare=!1},a.closeRule=function(){a.isShowService=!1},a.openRule=function(){a.isShowService=!0,l.getServicePromise(a.serId).success(function(e){e.success&&(a.serviceDetail=e.data)})},a.open3d=function(){var e=a.productModel.product.vrUrl;window.cordova?c.isIOS?window.emc.presentH5View(e,"3D体验"):m.go("c",{vrUrl:a.productModel.product.vrUrl}):window.open(e)},a.nowOrder=function(){s.isWdHost().success(function(e){c.isWdHost=e.data.isHost,-1==c.isWdHost?m.go("login"):l.checkRes(a.acReserveId,a.productId).success(function(e){if(0==e.success)v.showToast(e.message);else var t=p.show({template:'<div style="text-align: center;color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;">预约信息确认</div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div><div style="text-align: left;color: black;font-size: 12px"><span>验证码：</span><input type="text" ng-model="user.message" style="display: inline;width: 35%;border: solid 1px #ddd;"/><span style="margin-left:8px;padding:4px;background:#d6d7d9" ng-click="getSms()" ng-style="VCodeStyle">{{VCodeTips}}</span></div><div style="text-align: left;color: #666666;font-size: 12px"><p>温馨提示:</p><p>1.我们会向此手机号发送抢购信息通知,请认真填写;</p><p>2.提交后信息不可修改</p><p>3.预约成功不代表购买成功</p></div>',scope:a,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){return e.preventDefault(),a.globalConstant.mobileNumberRegExp.test(a.user.mobile)?void 0==a.user.message||""==a.user.message?void v.showToast("请输入验证码!"):void l.checkRes(a.acReserveId,a.productId).success(function(e){0==e.success&&v.showToast(e.message),1==e.success&&1==e.data?l.sendRes(a.acReserveId,a.productId,a.user.mobile,a.user.message,a.productModel.provinceId,a.productModel.cityId,a.productModel.regionId,a.productModel.streetId).success(function(e){0==e.success&&v.showToast(e.message),1==e.success&&1==e.data?(v.showToast('<div style="position:relative;"><img src="img/u93.png"/><span class="myduigou">√</span></div><p>商品预约成功</p><p>可在<b>个人中心-我的预约</b>中查看预约商品</p>'),t.close()):1==e.success&&0==e.data&&v.showToast("预约人数太多,稍后重试")}):1==e.success&&0==e.data&&v.showToast("预约人数太多,稍后重试"),a.user.message=""}):void v.showToast("请输入正确的手机号码！")}}]})})})},a.getSms=function(){if(a.canGetVcode){if(!a.globalConstant.mobileNumberRegExp.test(a.user.mobile))return void v.showToast("请输入正确的手机号码！");l.sendSms(a.user.mobile).success(function(e){if(0==e.success)v.showToast(e.message);else{a.canGetVcode=!a.canGetVcode;var t=60;a.timersms=i(function(){t-1<0?(a.VCodeTips="获取验证码",a.VCodeStyle={color:"#2979FF"},i.cancel(a.timersms),a.canGetVcode=!0):(a.VCodeStyle={color:"#666666"},t--,a.VCodeTips="重发 "+t+"s")},1e3)}})}}}]),APP.service("ProductDetailService",["$http","UrlService",function(e,t){this.hasProgram=function(o){var s={channel:1,productId:o};return e.get(t.getNewUrl("HASPROGRAM"),s)},this.locationChange=function(o,s,i,a,n,r,c,l,d){var p={sku:o,prodId:s,regionId:i,number:a,provinceId:n,cityId:r,pcrName:c,memberId:l,streetId:d};return e.get(t.getUrl("LOCATION_CHANGE"),p)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.loadData=function(o,s){var i={storeId:s};return e.get(t.getUrl("PRODUCTDETAIL_LODEDATA")+o+".json",i)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.addToCart=function(o,s,i,a,n,r,c,l,d){if(0==c.length)var c="",r="";var p={sku:o,productId:s,number:i,o2oStoreName:a,o2omap:n,skku:r,attrValueNames:c,o2oAttrId:l,streetId:d};return e.get(t.getUrl("ADDCART_INIT"),p)},this.buyNow=function(o){return e({method:"POST",url:t.getUrl("CONFIRM_ORDER"),data:o})},this.addShouCang=function(o,s,i,a,n){var r="productId="+o+"&productName="+s+"&imageUrl="+i+"&sku="+a+"&PCGName="+n;return e({method:"POST",url:t.getUrl("COLLECTION_INIT"),data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.cancelShouCang=function(o){var s="productId="+o;return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.checkNotice=function(o,s,i,a,n,r){var c={productId:o,mobile:s,provinceId:i,cityId:a,areaId:n,streetId:r};return e.get(t.getUrl("CHECK_NOTICE"),c)},this.startNotice=function(o,s){var i={productId:o,mobile:s};return e.get(t.getUrl("START_NOTICE"),i)},this.arriveNotice=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={productId:o,mobile:s,provinceId:i,cityId:a,areaId:n,streetId:r,sku:c,productName:l,provinceName:d,cityName:p,areaName:u,o2oStoreId:g};return e.get(t.getUrl("ARRIVE_NOTICE"),m)},this.getO2OName=function(o,s,i,a,n){var r={sku:o,provinceId:s,cityId:i,regionId:a,streetId:n};return e.get(t.getUrl("GET_O2O_NAME"),r)},this.getMergeImage=function(o,s){var i={productId:o,storeId:s};return e.get(t.getUrl("GET_MERGE_IMAGE"),i)},this.sendSms=function(o){var s={mobile:o};return e.get(t.getNewUrl("GET_SMSS"),s)},this.getShopCoupons=function(o,s,i,a,n,r,c){var l={productId:o,brandId:s,cateId:i,price:a,startIndex:n,pageSize:r,o2oStoreId:c};return e.get(t.getUrl("NEW_SHOP_COUPONS_LIST"),l)},this.getProductCouponsHas=function(o,s,i,a,n,r){var c={sku:o,prodId:s,number:i,finalPrice:a,memberId:n,o2oStoreId:r};return e.get(t.getNewUrl("PRODUCT_COUPONS_HAS"),c)},this.sendRes=function(o,s,i,a,n,r,c,l){var d={acReserveId:o,productId:s,mobile:i,mobileCode:a,provinceId:n,cityId:r,districtId:c,streetId:l};return e.get(t.getNewUrl("SUB_PRESS"),d)},this.checkRes=function(o,s){var i={acReserveId:o,productId:s};return e.get(t.getNewUrl("CHECK_RES"),i)},this.evalute=function(o){return e.get(t.getUrl("EVALUATE_INFO")+o+".json")},this.checkStockForPay=function(o,s,i,a,n,r,c,l,d,p,u,g){if("WA"==p)var m={stockType:p,productId:s,number:a,memberId:l,streetId:d,regionId:i};else if("O2O"==p)var m={stockType:p,productId:s,number:a,memberId:l,streetId:d,o2oStoreId:u,storeCode:g};else var m={stockType:p,productId:s,number:a,memberId:l,streetId:d};return o&&(m=$.extend(m,{sku:o})),e.get(t.getUrl("PAY_CHECK_STOCK"),m)},this.getSgStoreAttribute=function(o,s,i){var a={productId:o,storeId:s,sku:i};return e.get(t.getUrl("GET_GETSGSTOREATTRIBUTE"),a)},this.getDetailAttribute=function(o,s,i,a){var n={productId:o,storeId:s,attrValueIds:i,attrIds:a};return e.get(t.getUrl("GET_GETDETAILATTRIBUTE"),n)},this.getIsShowAttr=function(o,s){var i={productId:o,storeId:s};return e.get(t.getUrl("GET_ISSHOWATTR"),i)},this.getCartNum=function(){return e.get(t.getUrl("GET_CARTNUM"))},this.getHomeDecorationStoreMsg=function(o,s){var i={s:o,c:s};return e.get(t.getUrl("GET_STORE_MSG"),i)},this.getServicePromise=function(o){var s={sid:o};return e.get(t.getUrl("GET_SERVICE_PRO"),s)}}]),APP.controller("productEffectController",["$scope","$stateParams","$sce",function(e,t,o){e.vrUrl=o.trustAsResourceUrl(t.vrUrl)}]),APP.controller("ProductRatedController",["$scope","$stateParams","$rootScope","ProductRatedService","$ionicPopup","$timeout","$ionicScrollDelegate","$state","UserService","UrlService",function(e,t,o,s,i,a,n,r,c,l){function d(t){s.loadData(e.productId,e.pageIndex,e.pageSize,e.assessLevel,t).success(function(t,o,s,i){if(null!=t.data&&0!=t.data.length||1!=e.pageIndex){e.isHasData=!0,e.assessList=e.assessList.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"),e.hasMore=5==t.data.length;for(var a=0;a<e.assessList.length;a++)if(null!=e.assessList[a].experienceTime){var n=e.assessList[a].experienceTime,r=e.assessList[a].createTime,c=(n-r)/1e3,l=parseInt(c/86400);e.assessList[a].dayTime=l>0?l:0}else e.assessList[a].dayTime=0}else e.isHasData=!1})}e.allComment=!0,e.goodComment=!1,e.neutralComment=!1,e.negativeComment=!1,e.havePicComment=!1,e.productId=t.productId,e.assessLevel="all",e.hasPic="",e.pageSize=5,e.pageIndex=1,e.assessList=[],e.assessListDay=[],e.isHasData=!0,e.hasMore=!1,e.productRatedSub={top:"43px"},e.productRatedContent={top:"128px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.productRatedSub={top:"63px"},e.productRatedContent={top:"148px"}),e.isCheckStyle={color:"#fff",background:"#fd4f00"},e.noCheckStyle={color:"#000",background:"#fdebeb"},e.initData=function(){s.getData(e.productId).success(function(t,o,s,i){e.assessData=t.data}),s.getTabData(e.productId).success(function(t,o,s,i){e.markData=t.data}),e.pageIndex=1,e.assessList=[],d(!1)},e.loadMore=function(){e.pageIndex=e.pageIndex+1,d(!0)},e.goBack=function(){e.$ionicGoBack()},e.clickCommentType=function(t){n.scrollTop(),e.allComment="all"==t,e.goodComment="praise"==t,e.neutralComment="neutral"==t,e.negativeComment="poor"==t,e.havePicComment="image"==t,e.assessLevel=t,e.hasPic="",e.pageIndex=1,e.assessList=[],d(!1)},e.showLarge=function(t){e.showBigImage=!0,e.largeImg=t},e.closeImg=function(){e.showBigImage=!1},e.$on("$ionicView.beforeEnter",function(){n.scrollTop(),e.isHasData=!0,e.initData()})}]),APP.service("ProductRatedService",["$http","UrlService",function(e,t){this.getData=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCT_RATED_TOASSESS_LIST"),s)},this.getTabData=function(o){var s={productId:o};return e.get(t.getUrl("PRODUCT_ASSESS_MARK"),s)},this.loadData=function(o,s,i,a,n){var r={productId:o,pageIndex:s,pageSize:i,commentType:a,noLoading:n};return e.get(t.getUrl("PRODUCT_RATED_ASSESS_LIST"),r)}}]),APP.controller("SeeMoreController",["UrlService","$sce","HomePageService","PopupService","$ionicPopup","UrlService","$q","$rootScope","CommonAddressService","AreaService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","SeeMoreService","GoodsService","$localstorage","RegisterService",function(e,t,o,s,i,e,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){var e=a.defer();return ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(t){n.globalConstant.lat=t.latitude,n.globalConstant.lon=t.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),n.globalConstant.positionStatus=!0},function(e){"12"==e.errorCode&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),n.globalConstant.positionStatus=!1}):c.init().then(function(t){n.globalConstant.lat=t.coords.latitude,n.globalConstant.lon=t.coords.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),n.globalConstant.positionStatus=!0},function(e){"1"==e.code&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),n.globalConstant.positionStatus=!1}),e.promise}u.toHomeking=function(){h.homeking().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"好慷在家"):window.location.href=t}else f.go("login")})},u.goToManageMoney=function(){1==n.isWdHost?f.go("financialMoney",{whereId:"seeMore"}):0==n.isWdHost?S.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):s.showToast("服务端错误")}).error(function(){alert("网络错误")}):f.go("login")},u.goToEmc=function(){u.isApp?o.isWdHost().success(function(t){n.isWdHost=t.data.isHost,-1==t.data.isHost?f.go("login"):o.token_get().success(function(t){var o=t.data;o?window.emc.presentEmcView(e.getEnviroment(),o,""):s.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):s.showToast("请去顺逛App查看此服务")},u.openCC=function(t,i){switch(t){case 1:o.isWdHost().success(function(t){n.isWdHost=t.data.isHost,-1==t.data.isHost?f.go("login"):I().then(function(t){var o=e.getCPUrl("SZD_URL"),s=o+"?token="+m.getUser().token+"&alt="+n.globalConstant.lat+"&lng="+n.globalConstant.lon+"&cityCode="+t;window.cordova?window.emc.presentH5View(s,"水之道"):window.open(s,"_blank","location=yes")})});break;case 2:window.cordova?window.emc.presentH5View(i,"游戏头条"):window.open(i,"_blank","location=yes");break;case 3:o.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else{var t="http://m.ehaier.com/v3/mstore/sg/diy/login/request.html?flag="+$.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=t);window.emc.presentH5View(t,"海尔交互定制平台")}});break;case 4:o.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else if(window.cordova){var t=m.getUser().accessToken;window.emc.presentWashView(n.userAccount,n.password,t)}else s.showToast("请去顺逛App查看此服务")});break;case 5:;window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes");break;case 6:var a="http://uhome.haier.net:8470/acbizCms/aircircle/indexAirCircle.do";window.cordova?window.emc.presentH5View(a,"好空气"):window.open(a,"_blank","location=yes");break;case 7:var r="http://linkcook.cn/quanquan/ulist.html";window.cordova?window.emc.presentH5View(r,"馨小厨"):window.open(r,"_blank","location=yes");break;case 8:var c="http://jiuzhidao.com/wap/";window.cordova?window.emc.presentH5View(c,"酒知道"):window.open(c,"_blank","location=yes");break;case 9:var l="http://b2b.haier.com/mobiles/index.html";window.cordova?window.emc.presentH5View(l,"海尔企业购"):window.open(l,"_blank","location=yes");break;case 10:var d="http://www.saywash.com/saywash/WashCallWx/page/index.html";window.cordova?window.emc.presentH5View(d,"社区洗"):window.open(d,"_blank","location=yes")}},u.$on("$ionicView.beforeEnter",function(){window.cordova?u.isApp=!0:u.isApp=!1}),u.goToApplyForCard=function(){o.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):f.go("applyForCard")})}}]),APP.service("SeeMoreService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.homeking=function(){return e.get(t.getNewUrl("GET_homeking"))}}]),APP.controller("superMarketController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.EMSearchImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/EMSearch@3x.png",$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.superMarket_xScroll div").eq(0).width(),s=$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq(0)").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").css({width:o,left:s})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),
APP.controller("OrderConfirmSeckillController",["$scope","SeckillService","$stateParams","$rootScope","$state","OrderConfirmSeckillService","$ionicPopup","$timeout","PopupService","CacheService","SeckillDetailService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p){e.htmlContent=o.content,e.title=o.title,e.tabNav="selection",e.searchGoodsName={name:""},e.seckillId,e.numbers,e.productIds,e.invoiceHead=void 0,e.zzsInvoice=void 0,e.isEnd=!1,e.unSale,e.init=function(){if(e.isEnd=!1,t.getServerTime().then(function(t){var s=t.data.data,i=o.beginTime,a=o.endTime,n=p(function(){(s+=1)<i||s>=i&&s<=a||s==i||s>a&&(e.isEnd=!0,p.cancel(n))},1e3)}),e.orderData={},e.htmlContent=o.content,e.title=o.title,e.seckillId=o.seckillId,e.numbers=o.numbers,e.productIds=o.productIds,e.orderConfirmMessage=l.get("seckillOrderInfo"),!e.orderConfirmMessage)throw new Error("订单生成失败,fatal---error");e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle},e.$on("$ionicView.beforeEnter",function(t,o){if("back"==o.direction){var s={isFromInvoices:1};d.seckillBuy(s).success(function(t){1==t.success&&null!=t.data?(e.orderConfirmMessage=t.data,e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle):e.showPopup("订单查询失败 ")}).error(function(e){alert("网络错误")})}else e.init()}),e.toInvoice=function(t){i.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:1})},e.toSubmit=function(){if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))a.toSubmit(e.seckillId).success(function(t,o,s,a){if(1==t.success){var n=JSON.stringify(t.data.order);i.go("afterOrderSubmit",{messageData:n})}else 0==t.success&&e.showPopup(t.message)}).error(function(){alert("网络失败")});else{n.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{n.alert({template:"收货地址必须填写！",okText:"知道了"})}},e.toPayment=function(){i.go("payment")},e.tosendGoodsTime=function(){i.go("sendGoodsTime")},e.showPopup=function(e){var t=n.show({template:e});r(function(){t.close()},1e3)}}]),APP.service("OrderConfirmSeckillService",["$http","UrlService",function(e,t){this.toSubmit=function(o){var s={remark:"",seckillId:o};return e({method:"POST",url:t.getUrl("SECKILL_CONFIRM_ORDER_INFO"),params:s})}}]),APP.controller("SeckillDetailController",["$scope","$stateParams","$rootScope","ProductDetailService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","SeckillDetailService","CacheService","CommonAddressService","SeckillService","$interval","countdownService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){e.noFresh=!1,e.tabNav="selection",e.isButton=!0,e.countDownMsg="",e.seckillList=[],e.isEnd=!1,e.productId=t.productId,e.message,e.beginTime=t.beginTime,e.endTime=t.endTime,e.unSale,e.init=function(){e.isEnd=!1,g.getServerTime().then(function(t){var o=t.data.data,s=e.beginTime,i=e.endTime,a="",n=m(function(){o+=1,o<s?(a=f.getTime(f.getTimeDif(1e3*s,1e3*o)),e.countDownMsg="距开始"+a):o>=s&&o<=i||o==s?e.countDownMsg="秒杀":o>i&&(e.isEnd=!0,e.countDownMsg="秒杀活动已结束",m.cancel(n))},1e3)}),e.user=c.getUser(),e.iscompleteLoad=!1,e.storeId=t.storeId,e.o2oType=t.o2oType,e.status=t.status,e.fromType=t.fromType,e.front=t.front,e.sku=t.sku,e.seckillId=t.seckillId,e.hasStock=!0,e.memberId="",e.seckillPrice=t.seckillPrice,e.actualPrice,e.pcPrice,e.O2OStoreName,e.hasStock,e.productCount=1,e.swiperImgs=[],e.user&&e.user.mid&&(e.memberId=e.user.mid);var o=u.getAddressInfo(),s={sku:e.sku,prodId:e.productId,regionId:o.areaId,number:1,provinceId:o.provinceId,cityId:o.cityId,pcrName:o.provinceName+" "+o.cityName+" "+o.regionName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId},i={productId:e.productId,storeId:e.storeId,fromUrl:"seckillList",seckillId:e.seckillId,ts:new Date-0};d.seckillDetail(i).success(function(t){0==t.success?e.unSale=!0:(e.productModel=t.data.product,e.productModel.pcrName=t.data.pcrName,e.iscompleteLoad=!0,e.swiperImgs=t.data.swiperImgs,e.actualPrice=t.data.actualPrice,e.pcPrice=t.data.finalPrice,e.O2OStoreName=t.data.O2OStoreName,d.checkStock(s).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1}))}).error(function(e){alert("网络错误")})},o.$on("SECKILL_LOCATION_"+e.productId,function(t,o){if(e.noFresh=!0,e.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+" "+o["text-4"],e.productModel.pcrName){var s={sku:e.sku,prodId:e.productId,regionId:o["value-3"],number:1,provinceId:o["value-1"],streetId:o["value-4"],cityId:o["value-2"],pcrName:e.productModel.pcrName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId};d.checkStock(s).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1})}}),e.goBack=function(){1==e.front?r.go("myStore"):e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()}),e.changeState=function(t){1==t?s.changeChooseStateJia(e.productModel.product.sku,"1").success(function(t,o,s,i){e.productModel.product.onShelf=!e.productModel.product.onShelf}):s.changeChooseStateDui(e.productModel.product.sku).success(function(t,o,s,i){e.productModel.product.onShelf=!e.productModel.product.onShelf})},e.changeArea=function(){r.go("commonLocation",{flag:"SECKILL_LOCATION_"+e.productId})},e.seckillBuy=function(){var t={productIds:e.productId,numbers:1,seckillId:e.seckillId,COOKIE_DOMAIN:"mk",DOMAIN_URL:"http://172.24.1.22",POM_STATIC_DOMAIN_NAME:"http://172.24.1.22/mstatic"};d.seckillBuy(t).success(function(o){1==o.success&&null!=o.data?(p.set("seckillOrderInfo",o.data),r.go("orderConfirmSeckill",{seckillId:t.seckillId,numbers:t.numbers,productIds:t.productIds,beginTime:e.beginTime,endTime:e.endTime})):0==o.success?(e.unSale=!0,e.init()):e.showPopup("立即购买失败")}).error(function(e){alert("网络错误")})},e.tianJiaShouCang=function(){s.addShouCang(e.productId,e.productModel.product.productName,e.productModel.product.defaultImageUrl,e.productModel.product.sku,e.productModel.pcrName).success(function(t){e.showPopup("收藏成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.quXiaoShouCang=function(){s.cancelShouCang(e.productId).success(function(t){e.showPopup("取消成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.showPopup=function(e){var t=i.show({template:e});a(function(){t.close()},1e3)},e.customerServe=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_blank","location=yes"):(e.indexOf("iPhone"),window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"))},e.share=function(){if(!c.getUser().mid)return void h.showToast("请先登录,再分享");if(window.umeng){var t=l.getShareLinkHeader()+"seckillDetail/"+e.productId+"/"+e.o2oType+"/"+e.fromType+"/"+e.storeId+"/"+e.front+"/"+e.seckillPrice+"/"+e.seckillId+"/"+e.sku+"/"+e.status+"/"+e.beginTime+"/"+e.endTime+"/"+c.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀商品,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}}]),APP.service("SeckillDetailService",["$http","UrlService",function(e,t){this.checkStock=function(o){var s=t.getUrl("CHECK_STOCK");return e.get(s,o)},this.seckillDetail=function(o){if(!o.productId)return void alert("无productId error");var s=t.getUrl("SECKILLDETAIL")+o.productId+".html";return e.get(s,o)},this.seckillBuy=function(o){var s=t.getUrl("SECKILLBUY");return e.get(s,o)}}]),APP.controller("SeckillListController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","SeckillService","$localstorage","UserService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d){function p(e){var t=new Date(e),o=(t.getFullYear(),t.getMonth()+1);o=o<10?"0"+o:o;var s=t.getDate();s=s<10?"0"+s:s;var i=t.getHours();i=i<10?"0"+i:i;var a=t.getMinutes();a=a<10?"0"+a:a;var n=t.getSeconds();return n=n<10?"0"+n:n,o+"月"+s+"日"+i+":"+a+":"+n}e.storeId,e.seckillStatus=0,e.seckillList=[],e.timer=void 0,e.curTime,e.timeDiff,e.isNull;e.init=function(){e.isNull=!1,e.seckillList=[];var o=c.get("storeId",t.globalConstant.storeId);e.storeId=o,r.getServerTime().error(function(){alert("网络失败")}).then(function(t){var o=t.data.data;e.serverMs=1e3*o;new Date(e.serverMs);return r.getSeckillList()}).then(function(t){function o(e,t){return e-t}if(!t)return e.ponitList=[],void alert("网络失败");e.seckillList=t.data.data,0==e.seckillList.size&&(e.isNull=!0),e.ponitList=[],angular.forEach(e.seckillList,function(t,o){t.beginStr=p(1e3*t.beginTime),t.endStr=p(1e3*t.endTime),t.status=void 0,e.serverMs<1e3*t.beginTime?(t.status=1,e.ponitList.push(1e3*t.beginTime-e.serverMs)):e.serverMs>=1e3*t.beginTime&&e.serverMs<=1e3*t.endTime?(e.ponitList.push(1e3*t.endTime-e.serverMs),t.status=2):e.serverMs>1e3*t.endTime&&(t.status=3),angular.forEach(t.sgSeckillItemFormList,function(e,o){e.beginTime=t.beginTime,e.endTime=t.endTime})}),e.ponitList.sort(o),e.ponitList[0]&&(e.timer=i(function(){e.init()},e.ponitList[0]>36e5?36e5:e.ponitList[0]))},function(t){alert("网络失败"),e.isNull=!0})},e.toDetail=function(e,t){s.go("seckillDetail",{productId:e.productId,o2oType:0,fromType:4,storeId:o.storeId,front:0,sku:e.sku,seckillPrice:e.seckillPrice,seckillId:e.seckillId,status:t,beginTime:e.beginTime,endTime:e.endTime})},e.$on("$ionicView.beforeEnter",function(t,o){e.init()}),e.$on("$ionicView.beforeLeave",function(t,o){i.cancel(e.timer)}),e.doRefresh=function(){i(function(){e.init(),e.$broadcast("scroll.refreshComplete")},1e3)},e.share=function(){if(!l.getUser().mid)return void d.showToast("请先登录,再分享");if(window.umeng){var e=a.getShareLinkHeader()+"seckillList/"+l.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}}]),APP.service("SeckillService",["$http","UrlService",function(e,t){this.getSeckillList=function(){var o=t.getUrl("SECKILL_LIST");return e.post(o)},this.getSeckillDetail=function(e){t.getUrl("SECKILL_LIST",e)},this.getServerTime=function(o){var s=t.getUrl("SECKILL_SERVICE_TIME",o);return e.get(s)}}]),APP.directive("countdown",["$timeout","countdownService",function(e,t){return{restrict:"E",template:"<i>{{time.dd}}</i> <span>天</span> <i>{{time.hh}}</i>{{type}}<i>{{time.mm}}</i>{{type}}<i>{{time.ss}}</i>",link:function(o,s,i){function a(s){if(n>0&&s>0){var d=new Date-0+r,s=c-d;o.time=t.changeMs2Time(s),l=e(function(){a(s)},1e3)}else i.callback?(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o[i.callback](i.callbackparam)):(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o.callback())}o.type=i.type||":";var n,r,c,l=void 0;Math.random();if(!i.endtime)return!1;i.endtime&&i.curtime&&(c=t.formatTime2Ms(i.endtime),i.curtime?(n=t.getTimeDif(i.endtime,i.curtime),r=i.curtime-new Date-0,a(1)):t.getCurrTime().then(function(e){i.curtime=e.data,n=t.getTimeDif(i.endtime,i.curtime),r=i.curtime-new Date-0,a(1)}))},controller:["$scope",function(e){e.callback=function(){},e.$on("$destroy",function(){})}]}}]),APP.factory("countdownService",["$http",function(e){return{getTimeDif:function(e,t){return this.formatTime2Ms(e)-this.formatTime2Ms(t||new Date)},formatTime2Ms:function(e){return e?Date.parse(e.toString().replace(/-/g,"/"))||e:0},changeMs2Time:function(e){if(!e||parseInt(e)<0)return{dd:"00",hh:"00",mm:"00",ss:"00"};var t=parseInt(e/864e5),o=t<10?"0"+t:t;e=parseInt(e%864e5);var s=parseInt(e/36e5),i=s<10?"0"+s:s;e-=36e5*s;var a=parseInt(e/6e4),n=a<10?"0"+a:a;e-=6e4*a;var r=parseInt(e/1e3);return{dd:o,hh:i,mm:n,ss:r<10?"0"+r:r}},getTime:function(e,t){var o=this.changeMs2Time(e);return t=t||":",":"==t?o.dd+"天"+o.hh+":"+o.mm+":"+o.ss:o.dd+"天"+o.hh+"时"+o.mm+"分"+o.ss+"秒"},getCurrTime:function(){return e.post("/currTime")}}}]),APP.controller("AllCircleController",["HomePageService","$scope","$rootScope","$state","$ionicScrollDelegate","$ionicPopup","PopupService","AllCircleService","$ionicSlideBoxDelegate","$timeout","UserService","$ionicModal",function(e,t,o,s,i,a,n,r,c,l,d,p){t.isDisplay=!1,t.moreTag=!1,t.hasmore=!0,o.toFilterCode="",t.scrollMainTop=function(){i.$getByHandle("allMainScroll").scrollTop([!0])},t.searchTag={searchKey:"",tagSearch:"",pageIndex:1,pageSize:10},t.tagsName=[],t.circleList="",t.search=function(e){},t.goBack=function(){t.$ionicGoBack()},t.inPersonalPage=function(e){s.go("personalHomepageHe",{othersId:e})},t.goShop=function(){s.go("myStore",{storeId:t.userId,shareStoreId:""})},t.toFilterTagSearch=function(){o.toFilterCode=1,s.go("qSearchBiao")},t.isClick=function(){t.isDisplay=!t.isDisplay},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&i.scrollTop(),i.resize()},t.jumpMsgCenter=function(){s.go("ClassifyMessageCenter")},t.getCircleLists=function(){t.pageNum=1;var e={pageIndex:t.pageNum,pageSize:10,tagIds:""};r.filterCircle(e).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList}).error(function(){})},t.tagsFilter=function(e,o,s){if(t.moreTag=!1,t.pageNum=1,t.searchId=e,1==s)t.tagsName[o].isChecked=!1,t.init(),i.$getByHandle("allMainScroll").scrollTop();else{angular.forEach(t.tagsName,function(e){e.isChecked=!1}),t.tagsName[o].isChecked=!0;var a={pageIndex:1,pageSize:5,tagIds:e};r.filterCircle(a).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList,i.$getByHandle("allMainScroll").scrollTop()}).error(function(){})}},t.toCirclePage=function(e){s.go("circlePage",{circleId:e})},t.toApplyCircle=function(e){t.showNum=e,r.existApplyingCircle().success(function(e){e.success?(s.go("applyCircle"),delete o.reviewCircleId):t.applyCircleModal.show()}).error(function(){})},t.getTags=function(){var e={topicId:"",noLoading:!0};r.getTags(e).success(function(e){t.tagsName=e.data.list})},t.joinCircle=function(i){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)s.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:i.id}),o.gio.track("active",{circleID:i.id})),t.itemTopicName=i.topicName;var a={ids:i.id,noLoading:!0};r.joinTopic(a).success(function(e){1==e.success?(i.isJoin=1,1==e.success?(t.inCircle=!0,l(function(){t.inCircle=!1},1e3)):n.showToast(e.message)):-2e3==e.errorCode&&(n.showToast(e.message),o.loginIsAccord2=!0)})}})},t.loadMore=function(){t.pageNum+=1;var e={tagIds:t.searchId?t.searchId:"",pageIndex:t.pageNum,pageSize:5};r.getTopicList(e).success(function(e){e.data.list.topicList&&0!=e.data.list.topicList.length?l(function(){t.totalCount=e.totalCount,t.circleList=t.circleList.concat(e.data.list.topicList),t.$broadcast("scroll.infiniteScrollComplete");var o=t.circleList.length;t.hasmore=!(o==e.totalCount),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.hideApplyCircleModal=function(){t.applyCircleModal.hide()},t.getTitleList=function(){r.getTopicTitleList().success(function(e){if(e.success){t.titleList=e.data.list,t.itemTopicList(t.titleList[0].id,0);for(var o=0;o<t.titleList.length;o++)t.titleList[o].className=""}})},t.itemTopicList=function(e,o){var s={categoryId:e};r.getTopicSecondList(s).success(function(e){if(e.success){for(var s=0;s<t.titleList.length;s++)t.titleList[s].className="";t.titleList[o].className="bac",t.secondList=e.data.list}})},t.init=function(){t.titleList=[],t.secondList=[],t.userId=d.getUser().mid,p.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.applyCircleModal=e}),t.pageNum=0,t.getTitleList(),t.getCircleLists(),t.getTags(),t.searchId="",t.moreTag=!1,t.isDisplay=!1,t.hasmore=!0,t.circleList=[],i.$getByHandle("allMainScroll").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||($("ion-header-bar").show(),t.init())})}]),APP.service("AllCircleService",["$http","UrlService",function(e,t){this.getUserMessageCount=function(){return e.post(t.getUrl("GETUSERMESSAGECOUNT"))},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.getTopicTitleList=function(){return e.get(t.getUrl("CIRCLE_GET_CIRCLE_LIST"))},this.getTopicSecondList=function(o){return e.get(t.getUrl("CIRCLE_GET_SECONDLIST"),o)},this.getTopicList=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.filterCircle=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.existApplyingCircle=function(o){return e({method:"POST",url:t.getUrl("EXIST_APPLY_TOPIC"),data:o})}}]),APP.controller("AllMembersController",["$scope","$state","$stateParams","AllMembersService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,s,i,a,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.noDisplay=function(){e.isDisplay=!1},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.goBack=function(){t.go("circlePage",{circleId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(o){e.isDisplay=!1,t.go("personalHomepageHe",{othersId:o})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.isClick=function(){e.isDisplay?e.isDisplay=!1:e.isDisplay=!0},e.toSetAdmin=function(){"true"==e.isHost||"true"==e.superAdmin?t.go("CircleSetAdmin",{topicId:e.topicId}):(e.isDisplay=!1,a.showToast("您不是圈主，不能进行此操作"))},e.toManageUser=function(){"true"==e.isAdmin||"true"==e.isHost||"true"==e.superAdmin?t.go("manageUser",{topicId:e.topicId}):(e.isDisplay=!1,a.showToast("您不是圈主或管理员，不能进行此操作"))},e.init=function(){e.isDisplay=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.hasmore=!1;var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},s.getuserlist(t).success(function(t){e.isAdmin=t.data.ifAdmin,e.isHost=t.data.ifHost,e.superAdmin=t.data.isManager,e.mainuserlist=t.data.list1,e.mainuser2list=t.data.list2,e.userNum=t.totalCount,e.userlist=t.data.list,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.mainuserlist=t.data.list1,e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list),e.$broadcast("scroll.infiniteScrollComplete");var o=e.userlist.length;e.hasmore=!(o===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("AllMembersService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)}}]),APP.factory("anchorScroll",function(){function e(e,o,s){var i=$(window).height();e=$(e),s=s>0?s:i/10,$("html, body").animate({scrollTop:o?e.offset().top-s:e.offset().top+e.outerHeight()+s-i},{duration:200,easing:"linear",complete:function(){t(e)||e[0].scrollIntoView(!!o)}})}function t(e){function t(e){return e>n&&e<r}e=$(e);var o=$(window),s=o.height(),i=e.offset().top,a=e.outerHeight(),n=o.scrollTop(),r=n+s;return!!t(i+(a>s?s:a)/2)||a>s&&t(i+a-s/2)}return{toView:e,inView:t}}),APP.controller("ApplyCircleController",["$scope","$rootScope","$state","ApplyCircleService","PopupService","$ionicActionSheet","$timeout","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$ionicModal","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,c){e.userPicUrl="",e.bigPicUrl="",t.storeId=[],t.nameStringToObj=[],t.addedTags=[],e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:2,topicId:""},e.init=function(){1==t.showApplyTag?e.showApplyBtn=!1:e.showApplyBtn=!0,d.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyCircleModal=t}),1==t.ifInit?(e.tagsName=t.allNames,t.ifInit=2):(e.topicId="",e.auditRefuseStatus="",t.allNames="",t.addedTags=[],t.nameStringToObj=[],t.frequentTags="",e.tagsName="",t.reviewCircleId&&(e.reviewApplyCircle(),e.getTags()),e.auditOpinion="",c.resize())},e.goBack=function(){e.$ionicGoBack(),t.showApplyTag="",delete t.reviewCircleId},e.warnDelete=function(o){e.isDisplay=!1;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除草稿吗？</div>',title:"删除草稿",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.deleteDraftCircle()}},{text:"放弃"}]});n(function(){},3e3)},e.hideApplyCircleModal=function(){e.applyCircleModal.hide()},e.openStatus=function(t){e.auditOpinion[t].open_status=!e.auditOpinion[t].open_status},e.jumpSelect=function(){o.go("selectTags")},e.deleteDraftCircle=function(){var o={id:t.reviewCircleId};s.delectDraft(o).success(function(o){o.success&&(delete t.reviewCircleId,e.$ionicGoBack())})},e.imgPush=function(t){a.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function i(t){e.userPicUrl=t,n(function(){e.existPhoto=!0},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.userPicUrl,encodeURI(s.uploadImage()),o,i,a)}function a(){}function c(t){e.userPicUrl=t,e.existPhoto=!0,n(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.userPicUrl,encodeURI(s.uploadImage()),o,i,a)}return 0==t?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(c,a,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.imgBigPush=function(t){a.show({buttons:[{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function i(t){e.applyData.topicBgImg="",e.bigPicUrl=t,e.existPhoto=!0,n(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicBgImg=o.urls.toString()},i=function(e){r.hide()},a={};(new FileTransfer).upload(e.bigPicUrl,encodeURI(s.uploadImage()),o,i,a)}if(0==t)return navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:640,targetHeight:180}),!0}})},e.deleteTags=function(e){t.addedTags.splice(e,1)},e.deleteFrequentTags=function(e,o){for(var s=0;s<t.frequentTags.length;s++)t.frequentTags[s].name==o&&(t.frequentTags[s].isChecked=!1);t.storeNames.splice(e,1),t.storeId.splice(e,1),t.nameStringToObj.splice(e,1)},e.commitData=function(){var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};s.judgeWords(o).success(function(a){if("没有敏感词"==a.message){var r=e.applyData;r.tagIds=t.storeId.toString(),e.pushTags=[];for(var c=0;c<t.addedTags.length;c++)e.pushTags.push(t.addedTags[c].name);r.tagNames=e.pushTags.toString(),3==e.darftStatus?(r.auditStatus=2,s.storageDraft(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})):t.reviewCircleId?s.refuseStorage(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){}):s.applyCircleInfo(r).success(function(s){0==s.success?i.showToast(s.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",n(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})}else i.showToast("存在敏感词"+a.data)}).error(function(){})},e.applyTopicNotice=function(){l.show({template:"<p>确认提交圈子申请吗？</p>",title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>提交</span>",type:"",onTap:function(){e.commitData()}}]});n(function(){},3e3)},e.applyTopic=function(o){e.userPicUrl?""==e.applyData.topicImg?i.showToast("图片正在上传，请稍后再试"):e.bigPicUrl&&""==e.applyData.topicBgImg?i.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?i.showToast("申请理由不能少于20字"):t.nameStringToObj.length+t.addedTags.length<3?i.showToast("选择标签不能少于三个"):e.applyTopicNotice():i.showToast("请输入圈子申请理由"):i.showToast("请输入圈子介绍"):i.showToast("请输入圈子名称"):i.showToast("亲，你没有设置背景图哦"):i.showToast("亲，你没有设置头像哦"):e.bigPicUrl&&""==e.applyData.topicBgImg?i.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?i.showToast("申请理由不能少于20字"):e.applyTopicNotice():i.showToast("请输入圈子申请理由"):i.showToast("请输入圈子介绍"):i.showToast("请输入圈子名称"):i.showToast("亲，你没有设置背景图哦"):i.showToast("亲，你没有设置头像哦")},e.$on("$ionicView.beforeEnter",function(o,s){"back"===s.direction?e.init():(e.init(),e.userPicUrl="",e.bigPicUrl="",e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:e.topicId?3:2,topicId:t.reviewCircleId?t.reviewCircleId:""})}),e.reviewApplyCircle=function(){var o={topicId:t.reviewCircleId};s.reviewEditApply(o).success(function(t){e.darftStatus=t.data.list.auditStatus,e.topicId=t.data.list.id,e.auditRefuseStatus=t.data.list.auditStatus,e.applyData.topicImg=t.data.list.topicImg,e.applyData.topicBgImg=t.data.list.topicBgImg,e.bigPicUrl=t.data.list.topicBgImg,e.userPicUrl=t.data.list.topicImg,e.applyData.topicName=t.data.list.topicName,e.applyData.topicDescription=t.data.list.topicDescription,e.applyData.topicReason=t.data.list.entryReason,e.auditOpinion=t.data.list.auditHistory,c.resize()}).error(function(){})},e.getTags=function(){var o={id:t.reviewCircleId};s.getTags(o).success(function(o){e.tags=o.data.list;for(var s=0;s<e.tags.length;s++)if(e.tags[s].approval){var i={name:e.tags[s].name};t.addedTags.push(i)}else{var a={name:e.tags[s].name};t.nameStringToObj.push(a)}})},e.storageDraft=function(){if(!(e.applyData.topicImg||e.applyData.topicBgImg||e.applyData.topicName||e.applyData.topicDescription||e.applyData.topicReason||e.applyData.topicReason))return void i.showToast("亲，请至少填一项哦");var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};e.applyData.auditStatus=3,s.judgeWords(o).success(function(o){if("没有敏感词"==o.message){var a=e.applyData;a.tagIds=t.storeId.toString(),e.pushTags=[];for(var r=0;r<t.addedTags.length;r++)e.pushTags.push(t.addedTags[r].name);a.tagNames=e.pushTags.toString(),e.topicId&&3==e.auditRefuseStatus?s.storageDraft(a).success(function(t){0==t.success?i.showToast(t.message):(e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):1==e.auditRefuseStatus?s.refuseStorage(a).success(function(t){0==t.success?i.showToast(t.message):(e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):s.applyCircleInfo(a).success(function(o){0==o.success?i.showToast(o.message):(t.reviewCircleId=o.data,e.auditRefuseStatus=3,e.topicId=o.data,e.applyData.topicId=o.data,e.draftStorgeSuccess=!0,n(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){})}else i.showToast("存在敏感词"+o.data)}).error(function(){})}}]),APP.service("ApplyCircleService",["$http","UrlService",function(e,t){this.applyCircleInfo=function(o){return e({method:"POST",url:t.getUrl("APPLY_TOPIC"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})},this.reviewEditApply=function(o){return e({method:"POST",url:t.getUrl("REVIEW_APPLY_TOPIC"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.storageDraft=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_DRAFT"),data:o})},this.delectDraft=function(o){return e({method:"POST",url:t.getUrl("DELETE_APPLY_TOPIC_DRAFT"),data:o})},this.refuseStorage=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_REFUSE"),data:o})}}]),APP.controller("CircleGroupDiscussController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService","$q","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){function v(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId=tlz55&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},S,I)}function $(e){alert("得到图片失败")}function S(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.groupMsg="图片文件",o.data.imageUrl=s,o.data.fileType=".jpg",o.data.groupMsgUserId=e.csId,o.data.timeStamp=new Date-0,o.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss");var i={c:"sendGroupMsg",groupId:e.groupId,msg:s,msgType:1,token:e.token};r.sendMsg(i).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(o.data)}else l.showToast("发送消息失败--发送音频后")},function(e){})}function I(e){alert("上传失败")}function w(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function y(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.circleId,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode},e.toShareListPage=function(e){i.go("shareListPage",{sl:e})};var T=c.getUser();e.groupId,e.chatId=e.groupId,e.row=0,e.token=c.getUser().sessionValue,e.isClick=function(t){t?e.isDisplay=!e.isDisplay:i.go("discussionGroup",{groupId:e.groupId,circleId:e.circleId})},e.toMemberList=function(){i.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.isSchool=!0,e.sgdMode=2,e.toggleMode=function(t){e.sgdMode=t},e.init=function(){},e.noMoreHistory=!1,e.getMsgByMun=function(){if(!e.noMoreHistory){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};r.getMsgByMun(t).success(function(t){if(t)if(t.rows&&angular.isArray(t.rows)){
for(var o=0;o<t.rows.length;o++)r.filtMsg(t.rows[o]);e.messages=t.rows.concat(e.messages),t.rows.length<1e3&&(e.noMoreHistory=!0)}else consoel.warn("sg--getMsgByMun-- response  not array !! ");else l.showToast("获得 讨论组 历史聊天记录 失败")}).finally(function(){e.$broadcast("scroll.refreshComplete")})}},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=f.defer(),o=0==e.messages.length?1:0,s={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token,row:e.row,isSelf:o};return r.getMsg(s).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++)o.data.msgs[s].groupMsg&&(r.filtMsg(o.data.msgs[s]),e.messages.push(o.data.msgs[s]));e.row=o.data.row,t.resolve(1)}else t.reject(1)},function(e){alert(e)}),t.promise},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};e.CustumerParam.msg||l.showToast("发送的消息不能为空"),r.sendMsg(t).then(function(o){if(o){if(o.data&&103==o.data.rt)return void l.showToast("您已经被禁言，请联系管理员");var s={groupMsg:t.msg,groupMsgUserId:e.csId,groupMsgUserName:T.nickName,sendTimes:(new Date).pattern("yyyy-MM-dd hh:mm:ss")};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=""}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.getImg=function(e){p.getPicture(e,v,$)},e.play=function(){var e=document.getElementById("audioInCD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){p.startCapture("sourceInCD","audioInCD")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),p.stopCapture("sourceInCD","audioInCD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},C,b)};var C=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,s.data.groupMsg="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.groupMsgUserId=e.csId,s.data.timeStamp=new Date-0,s.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss"),e.deleteRecord();var i={c:"sendGroupMsg",groupId:e.groupId,msg:o,msgType:1,token:e.token};r.sendMsg(i).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(s.data)}else l.showToast("发送消息失败--发送音频后");e.loopGetMsg()},function(e){})},b=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");e.isPlaying||a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:A})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.chooseOne=function(e){e.isSelected=!e.isSelected},e.shareToGroup=function(){var t=[];angular.forEach(e.messages,function(e,o){e.isSelected&&t.push(e)});var o="讨论组名称$share"+JSON.stringify(t);i.go("groupsToShare",{shareList:o})},e.deleteGroupMsg=function(){},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o;var a=c.getUser();e.csId=a.mid,e.init(),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",w),window.addEventListener("native.keyboardhide",y),p.addAudioEventOnWindow(),e.groupId=s.groupId,e.circleId=s.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),"back"==i.direction?e.loopGetMsg():(e.messages=[],e.groupId=61,e.loopGetMsg())});var A=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(t,o){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",w),window.removeEventListener("native.keyboardhide",y),e.killTimer()}),e.goBack=function(){e.isPlaying||e.$ionicGoBack()}}]),APP.service("CircleGroupDiscussService",["$http","UrlService","$sce",function(e,t,o){function s(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+i[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+i[t]+'.png" />')}this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.getAllMsg=function(t){return e({method:"POST",url:"http://123.56.3.136:8181/api/invoke",params:t})},this.getMsgByMun=function(t){return e({method:"POST",url:"http:///123.56.3.136:8180/Service/chatGroup/queryPageGroupMsg",params:t})},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.sendTimes&&(e.timeStamp=new Date(e.sendTimes)-0),e.groupMsg&&e.groupMsg.indexOf("$share")>-1){var t=e.groupMsg.indexOf("$share"),o=e.groupMsg.substring(0,t),i=e.groupMsg.substring(t+6),a=/\\/g;i=i.replace(a,"");var n=JSON.parse(i),r=0;angular.isArray(n)&&(r=n.length);e.shareMsgsList=n,e.fileType="share",e.shareMsgsLength=r,e.from=o}else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.groupMsg;else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.groupMsg;else if(e.groupMsg.indexOf("[")>-1&&e.groupMsg.indexOf("]")>-1)for(var c=1;c<16;c++)e.groupMsg=s(e.groupMsg,c)};var i=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];new Date,new Date("2014-8-4 10:21:12")}]),APP.directive("resizeFootBarcd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-cd"),a=e.$getByHandle("cdScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]);var sm={groupMsg:'飞机飞啊飞哇$share[{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav\\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:22\\",\\"isSelected\\":true},{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav\\",\\"groupMsgUserId\\":1383068791,\\"groupMsgUserName\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:23\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 \\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:24\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"aaf啊积极饿哇 啊发\\",\\"groupMsgUserId\\":1234,\\"groupMsgUser\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:25\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png\\",\\"groupMsgUserId\\":1234,\\"groupMsgUserName\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:26\\",\\"isSelected\\":true}]'};Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},o={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+o[this.getDay()+""]));for(var s in t)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[s]:("00"+t[s]).substr((""+t[s]).length)));return e};var historyMsg={total:0,core:"10000",rows:[{groupId:61,companyId:138306984,groupMsg:"test1111",sendTimes:"2017-02-28 14:49:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:50:15",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:51:58",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 15:00:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test2223",sendTimes:"2017-02-28 16:27:12",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:29:49",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:30:05",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"}],footer:[]};APP.controller("CirclePageController",["HomePageService","$http","$localstorage","$location","$scope","$rootScope","$state","$stateParams","CirclePageService","$ionicScrollDelegate","NoteDetailsService","UrlService","PopupService","$ionicModal","ionicDatePicker2","ionicTimePicker","$timeout","UserService","$ionicPopup","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I){function w(){var e=s.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&t({method:"POST",url:p.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){v.setUser(e.data),o.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}function y(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}i.isDisplay=!1,i.showList=!1,i.moreTag=!1,i.hasmore=!0,i.showTopBtn=!1,i.circleIDIF=!1,i.contentNum={contentNum:""},i.topicId,i.topData,i.listData=[],i.circleId,i.tagsName,i.showShare=!1,i.topicid="",i.allowPub=!0,i.topicSummary,i.signSuccess=!1,i.init=function(){662!=i.circleId&&665!=i.circleId||(i.circleIDIF=!0,662==i.circleId?c.getCircleLink("","","1").success(function(e){e.success&&(i.circleUrl=e.data)}):665==i.circleId&&c.getCircleLink("","","3").success(function(e){e.success&&(i.circleUrl=e.data)})),a.mediaurl="",a.mediaImg="",i.userId=v.getUser().mid,i.phoneHeight=document.documentElement.clientHeight/2,i.showQQ=!1,i.isDisplay=!1,i.showList=!1,i.showWeChat=!1,i.showShare=!1,i.timeWidget={hour:"",minute:""},i.timeWidget2={hour:"",minute:""},window.cordova?i.ifInApp=!1:i.ifInApp=!0,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){i.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){i.showWeChat=0!=e})),i.$broadcast("scroll.refreshComplete"),i.moreTag=!1,i.ifDownload=!0,i.pageIndex=1,i.hasmore=!0,i.listData=[],i.getTags(),i.getListMsg(),i.getTopicSummary(),i.getCircleMembers(),l.$getByHandle("mainScroll").scrollTop(),i.stateIfOpen={},i.applyDiscussionData={topicId:"",entryReason:"",startDate:"",startHour:"",startMin:"",endDate:"",endHour:"",endMin:""},i.personType={isAdmin:!1},window.cordova?i.openFromBrowser=!0:i.openFromBrowser=!1},i.NumberCheck=function(e){/^\d*$/.test(e)||(isNaN(parseInt(e))?i.contentNum.contentNum=0:i.contentNum.contentNum=parseInt(e))},i.goBack=function(){i.circleIDIF?window.open(i.circleUrl+"&openType=h5"):i.$ionicGoBack()},i.isClick=function(){i.isDisplay=!i.isDisplay},i.goshare=function(){if(!v.getUser().mid)return void n.go("login");i.showShare=!i.showShare},i.isClick=function(){i.isDisplay=!i.isDisplay},i.showCameraList=function(){if(window.cordova&&(a.gio.track("createTopic",{circleID:i.circleId}),a.gio.track("active",{circleID:i.circleId})),i.topicSummary.isJoin){var e={topicId:i.circleId};c.circleSpeak(e).success(function(e){e.success?0==e.data.isGap&&(i.showList=!i.showList):-2e3==e.errorCode?(u.showToast(e.message),a.loginIsAccord2=!0):u.showToast("您已被禁言，不能发话题")})}else{S.show({template:"<p>亲，先加入我们再秀话题吧。</p>",title:"退出圈子",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>加入</span>",type:"",onTap:function(){i.joinCircle()}},{text:"再想想"}]});h(function(){},3e3)}},i.jumpPublishCircle=function(){n.go("publishCircle")},i.goShop=function(){n.go("myStore",{storeId:i.userId,shareStoreId:""})},i.closeDownload=function(){i.ifDownload=!1},i.jumpMsg=function(){n.go("ClassifyMessageCenter")},i.inPersonalPage=function(e){n.go("personalHomepageHe",{othersId:e})},i.toNoteDetails=function(e,t,o){i.noteIndex=o,n.go("noteDetails",{noteId:e,isShortStory:t})},i.hideList=function(){i.showList=!1},i.scrollToTop=function(){l.$getByHandle("mainScroll").scrollTop(!0),i.showTopBtn=!1},i.getScrollHeight=function(){i.scrollHeight=Math.abs(document.getElementById(i.topicSummary.topicName).getBoundingClientRect().top),i.scrollHeight>3*i.phoneHeight?i.showTopBtn=!0:i.showTopBtn=!1},i.jumpPhoto=function(e){i.showList=!1,3!=e?n.go("publishCircle",{identifierCode:"",topicId:i.circleId,topicStyle:e}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(t){n.go("publishCircle",{identifierCode:"",topicId:i.circleId,topicStyle:e});var o=JSON.parse(t),s=o.videoFile,r=o.imageFile,c=s.replace("\\",""),l=r.replace("\\","");a.mediaurla=c,a.mediaImga=l},function(e){})},i.getTags=function(){var e={id:i.circleId,flag:0};c.getTags(e).success(function(e){i.tagsName=e.data.list})},i.tagsNameList=function(e,t){i.tagsIndex=e,i.tagId=t,i.listData=[],i.pageIndex=1,i.hasmore=!0,i.getListMsg()},i.joinCircle=function(){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else{window.cordova&&(a.gio.track("follow",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var t={ids:i.circleId};c.joinTopic(t).success(function(e){1==e.success?(i.inCircle=!0,h(function(){i.inCircle=!1},1e3),i.topicSummary.isJoin=!0,i.getCircleMembers(),i.getTopicSummary()):u.showToast(e.message)})}}),window.cordova&&(a.gio.track("follow",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var t={ids:i.circleId};c.joinTopic(t).success(function(e){1==e.success?(i.inCircle=!0,h(function(){i.inCircle=!1},1e3),i.topicSummary.isJoin=!0,i.getCircleMembers(),i.getTopicSummary()):-2e3==e.errorCode&&(u.showToast(e.message),a.loginIsAccord2=!0)})},i.signIn=function(){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else if(i.topicSummary.isJoin){var t={topicId:i.circleId,userId:i.userId,signType:2};c.circleSignIn(t).success(function(e){if(e.success){i.signInfoData=e.data;var t=S.show({template:"<div class='sign-box' flex='main:center'>\n                              <div ng-click=\"closeSign()\" class='sign-close' flex='main:right'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                              <div class='sign-bg'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_background.png\" style='width:100%;' alt=\"\" /></div>\n                              <div class='sign-content'>\n                                <div class='sign-title' flex='main:center cross:center'>\n                                  <div class='sign-icon' flex='cross:center'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                                  <div class='title-text'>签到排名<span>{{signInfoData.rank}}</span></div>\n                                </div>\n                                <p ng-if='signInfoData.golds>0'>获得<span class='sign-num'>{{signInfoData.golds}}</span>金币</p>\n                                <p ng-if='signInfoData.signRules'>连续签到<span class='sign-num'>{{signInfoData.signRules.continuitySign}}</span>天即可获取<span class='sign-num'>{{signInfoData.signRules.golds}}</span>金币</p>\n                              </div>\n                              <div class='sign-foot' ng-click='goSignInChart(circleId)'>签到排行榜</div>\n                            </div>",cssClass:"signPopup",scope:i});i.closeSign=function(){t.close(),i.getTopicSummary()},i.goSignInChart=function(e){t.close(),n.go("signInChart",{topicId:e})}}else u.showToast(e.message)})}else u.showToast("请先加入圈子")})},i.signDate=function(e,t,o){n.go("signDate",{userId:e,topicId:t,monthFlag:o})},i.jumpAllMembers=function(e){n.go("allMembers",{topicId:e})},i.isMoreTag=function(){i.moreTag=!i.moreTag,0==i.moreTag&&l.scrollTop(),l.resize()},i.getCircleMembers=function(){var e={topicId:i.circleId};c.circleMembers(e).success(function(e){e.success&&(i.members=e.data.list,i.membersHead=e.data.list1[0])})},i.getTopicSummary=function(){var e={topicId:i.circleId};c.getCircleInfo(e).success(function(e){i.topicSummary=e.data.list[0],c.topicName=i.topicSummary.topicName,0==i.topicSummary.allowPubStory?i.allowPub=!1:1==i.topicSummary.allowPubStory&&(i.allowPub=!0),i.topicid=e.data.list.id,i.minNum=i.topicSummary.capacity;var t=i.topicSummary.dateNow.split("-"),o=Number(t[0]),s=Number(t[1]),a=Number(t[2]);i.signSucDate={signYear:o,signMonth:s,signDay:a},c.signSuccessDate=i.signSucDate})},i.extendContent=function(){if(i.contentNum.contentNum<=i.minNum)i.biggerThanFive=!0,h(function(){i.biggerThanFive=!1},3e3);else if(i.contentNum.contentNum>2e3)i.biggerThanTwoThousand=!0,h(function(){i.biggerThanTwoThousand=!1},3e3);else{var e={topicId:i.circleId,entryCapacity:i.contentNum.contentNum};c.extendContent(e).success(function(e){e.success?(i.hideBigerModal(),i.contentNum.contentNum="",a.applyBottomNotice=!0,i.isDisplay=!1,h(function(){a.applyBottomNotice=!1},3e3)):u.showToast(e.message)})}},i.noticeDownload=function(){a.downAppUrl||u.showToast("不支持该手机")},i.applyDiscussion=function(){var e=i.applyDiscussionData;e.topicId=i.circleId,c.applyDiscuss(e).success(function(e){1==e.success?(u.showToast(e.message),i.hideModal(),i.applyDiscussionData.endHour="",i.applyDiscussionData.endMin="",i.applyDiscussionData.startHour="",i.applyDiscussionData.startMin=""):u.showToast(e.message)}).error(function(){})},i.stateDiscussion=function(){var e={topicId:i.circleId};c.discussionState(e).success(function(e){1==e.success?(i.stateIfOpen=e.data,i.stateIfOpen.isAdmin=!0):u.showToast("获取讨论组 服务器异常")}).error(function(){u.showToast("获取讨论组 相关信息失败")})},i.toChat=function(){var e=i.circleId,t=i.stateIfOpen.groupId;if(!e||!t)return void u.showToast("缺少讨论组参数，错误");n.go("circleGroupDiscuss",{circleId:e,groupId:t})},i.loadMoreMsg=function(){i.pageIndex+=1;var e=y("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:i.pageIndex,pageSize:5,topicId:i.circleId,tagId:i.tagId,noLoading:!0,userCode:o?i.weChatOpenId:e};c.getCircleList(s).success(function(e){if(e.data.list&&0!=e.data.list.length){i.listData=i.listData.concat(e.data.list),i.$broadcast("scroll.infiniteScrollComplete");var t=i.listData.length;i.hasmore=!(t===e.data.storeItemsCounts)}else i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1,u.showToast("没有更多消息了")}).error(function(){i.$broadcast("scroll.infiniteScrollComplete")})},i.loadTopicStory=function(){c.getTopStory(topData).success(function(e){})},i.showModal=function(){g.fromTemplateUrl("templates/quanzi/selectModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.selectModal=e,i.selectModal.show()})},i.hideModal=function(){i.selectModal.hide()},i.showBigerModal=function(){g.fromTemplateUrl("templates/quanzi/biggerModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.biggerModal=e,i.biggerModal.show()}),i.isDisplay=!1},i.hideBigerModal=function(){i.biggerModal.hide()},i.getListMsg=function(){var e=y("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i);i.listMsg={pageIndex:1,pageSize:5,topicId:i.circleId,tagId:i.tagId,userCode:o?i.weChatOpenId:e},c.getCircleList(i.listMsg).success(function(e){i.listData=e.data.list,i.whichPersonType(),i.stateDiscussion()}).error(function(){})},i.whichPersonType=function(){var e={topicId:i.circleId,noLoading:!0};d.getPersonType(e).success(function(e){1==e.success&&(i.personType={isAdmin:e.data.isAdmin})})},i.topicPraise=function(e,t){window.cordova&&(a.gio.track("like",{circleID:r.circleId}),a.gio.track("active",{circleID:r.circleId}));var o=y("loginId"),s=window.navigator.userAgent.toLowerCase(),n="micromessenger"==s.match(/MicroMessenger/i),l={id:e,noLoading:!0,userCode:n?i.weChatOpenId:o};c.pushPraise(l).success(function(e){1==e.success?1==i.listData[t].praiseFlag?(i.listData[t].praiseNumber=i.listData[t].praiseNumber-1,i.listData[t].praiseFlag=!i.listData[t].praiseFlag):(i.listData[t].praiseNumber=i.listData[t].praiseNumber+1,i.listData[t].praiseFlag=!i.listData[t].praiseFlag):h(function(){u.showToast(e.message)},200)})},i.topicFavorite=function(t,o){e.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==a.isWdHost)n.go("login");else{var s={id:t};c.topicFavorite(s).success(function(e){1==e.success?1==i.listData[o].collectionFlag?(i.listData[o].collectionNumber=i.listData[o].collectionNumber-1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):(i.listData[o].collectionNumber=i.listData[o].collectionNumber+1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):h(function(){u.showToast(e.message)},200)})}});var s={id:t};c.topicFavorite(s).success(function(e){1==e.success?1==i.listData[o].collectionFlag?(i.listData[o].collectionNumber=i.listData[o].collectionNumber-1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):(i.listData[o].collectionNumber=i.listData[o].collectionNumber+1,i.listData[o].collectionFlag=!i.listData[o].collectionFlag):-2e3==e.errorCode&&(u.showToast(e.message),a.loginIsAccord2=!0)})},i.shareToStore=function(){var e={flag:0,topicId:i.circleId};d.shareStore(e).success(function(e){e.success})},i.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),h(function(){u.showToastShort("复制成功")},200)):u.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){-1!=s.absUrl().indexOf("token")&&(window.location.hash=s.path());var t="邀请您关注"+i.topicSummary.topicName+"圈子",o="欢迎关注"+i.topicSummary.topicName+"圈子，与"+i.topicSummary.topicName+"微店主同城交流互动。",a="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=p.getShareLinkHeader()+"circlePage/"+i.circleId;i.circleId;window.umeng?0==e?window.umeng.shareToSina(t,o,a,n,0,null,I.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,a,n,0,null,I.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,a,n,0,null,I.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,a,n,0,null,I.shareSuccessCallback),I.qqShare()):4==e?(window.umeng.shareToQzone(t,o,a,n,0,null,I.shareSuccessCallback),I.qqShare()):5==e?i.copeText(n):I.successShare():alert("umeng undefined 只能在app分享"),i.showShare=!1,i.shareToStore()},i.dateOne="开始时间",i.dateTwo="结束时间",i.a=1,i.b=1,i.firstDatePicker=function(){var e={callback:function(e){i.dateOne=e,i.applyDiscussionData.startDate=e,i.a=2},to:new Date(i.dateTwo)};m.openDatePicker(e)},i.secondDatePicker=function(){var e={callback:function(e){i.dateTwo=e,i.applyDiscussionData.endDate=e,i.b=2},from:new Date(i.dateOne)};m.openDatePicker(e)},i.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};f.openTimePicker(e)},i.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};f.openTimePicker(e)},i.exitTopicNotice=function(){S.show({template:"<p>亲，忍心离开我们圈子了吗？</p>",title:"退出圈子",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>退出</span>",type:"",onTap:function(){i.exitTopic()}},{text:"再想想"}]});h(function(){},3e3)},i.exitTopic=function(){var e={topicId:i.circleId};c.exitTopic(e).success(function(e){e.success?(i.isDisplay=!1,i.isDisplay=!1,i.outawayCircle=!0,i.showList=!1,h(function(){i.outawayCircle=!1},1e3),i.topicSummary.isJoin=!1,i.getCircleMembers(),i.getTopicSummary()):(i.isDisplay=!1,u.showToast(e.message))}).error(function(){u.showToast(response.message)})},i.wechatOpenId=function(){d.getWeChatOpenId().success(function(e){e.success&&(e.data?(i.weChatOpenId=e.data,d.weChatOpenId=e.data,i.init()):i.wechatUrlOpenId())})},i.wechatUrlOpenId=function(){var e=s.absUrl();d.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},i.$on("$ionicView.beforeEnter",function(t,o){i.circleId=r.circleId,i.tagId=null,w(),window.location.hash=s.path(),i.tagsIndex=0,a.ifDeleteNoteList&&(i.listData.splice(i.noteIndex,1),a.ifDeleteNoteList=!1),"back"==o.direction?i.getTopicSummary():(window.cordova&&a.gio.track("circleEntry",{circleID:i.circleId}),$("ion-header-bar").show()),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?e.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==a.isWdHost?i.wechatOpenId():i.init()}):"back"==o.direction||i.init()}),i.$on("$stateChangeSuccess",function(e,t,o,s,n){a.fromState=s.name,a.toState=t.name,"publishCircle"==a.fromState&&i.init()})}]),APP.service("CirclePageService",["$http","UrlService",function(e,t){this.getCircleLink=function(o,s,i){var a={productId:o,storeId:s,type:i};return e.get(t.getTopUrl("IF_CIRCLEPAGE"),a)},this.getCircleInfo=function(o){return e({method:"POST",url:t.getUrl("TOPIC_INFO"),data:o})},this.topicName="",this.shareinfor=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.circleMembers=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCODE"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.getTopStory=function(o){return e({method:"POST",url:t.getUrl("TOP_STORY"),data:o})},this.circleSpeak=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SPEAK"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.extendContent=function(o){return e({method:"POST",url:t.getUrl("ENLARGE_CONTENT"),data:o})},this.applyDiscuss=function(o){return e({method:"POST",url:t.getUrl("ENTRYFORUM"),data:o})},this.discussionState=function(o){return e({method:"POST",url:t.getUrl("DISCUSSION_STATE"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.getCircleList=function(o){return e({method:"POST",url:t.getUrl("LIST"),data:o})},this.exitTopic=function(o){return e({method:"POST",url:t.getUrl("EXIT_TOPIC"),data:o})},this.circleSignIn=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGNIN"),data:o})},this.signSuccessDate=""}]),APP.controller("CircleSetAdminController",["$scope","$state","$stateParams","CircleSetAdminService","$ionicScrollDelegate","PopupService",function(e,t,o,s,i,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.addAdmin=function(o){t.go("selectAdmin",{topicId:e.topicId})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.decAdmin=function(t){var o={topicId:e.topicId,userCode:t,indentityStatus:0};s.setAdmin(o).success(function(t){t.success&&e.getCircleUser()}).error(function(){})},e.getCircleUser=function(){var t={topicId:e.topicId};s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2}).error(function(){})},e.init=function(){e.pageIndex=1,e.input={isinput:""},e.getCircleUser()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("CircleSetAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("CIRCLE_CIRCLEPERSON"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,o,s){function i(){var e=t.html();o.stripBr&&"<br>"===e&&(e=""),s.$setViewValue(e)}s&&(s.$render=function(){t.html(s.$viewValue||"")},t.on("blur keyup change",function(){e.$apply(i)}))}}}),
APP.controller("ClassNoteDetailsController",["$scope","$rootScope","$ionicModal","$state","$stateParams","$ionicLoading","$http","PlatformService","ClassNoteDetailsService","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","TopicdetailsService","$timeout","$ionicActionSheet","PopupService","$timeout","UrlService","NoteDetailsService","UserService","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,g,h,v,S,I){e.isDisplay=!1,e.inputShow=!0,e.praiseNum={},e.commentId="",e.circleId,e.circleDetail,e.commentList,e.commentWords={words:""},e.pinglunis=!1,e.topicheight=0,e.comment={text:"",rows:1},e.noteDetail={reply:"说点什么"},e.$watch("noteDetail.reply",function(e,t,o){}),e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,e.isImage=!1,e.showBigImg=!1,e.imgString="",e.isPublishImage=!1,e.imgA=[],e.showBigBac=!1,e.goBack=function(){e.$ionicGoBack(),t.nextPageBefore="classNoteDetails"},e.goshare=function(){if(!S.getUser().mid)return void s.go("login");e.showShare=!e.showShare,e.isDisplay=!1},e.goToScore=function(t){if($(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),"linklink"==t.target.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("all-to"==t.target.className)if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("atopic"==t.target.className){if(t.target.attributes["data-a"]){var o=t.target.attributes["data-a"].value;e.tolink(o)}else if(t.target.attributes.dataa){var o=t.target.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.className){if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.attributes.dataa){var o=t.target.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.parentNode.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.parentNode.attributes.dataa){var o=t.target.parentNode.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var s=o.indexOf("#");o.substring(s)}else e.tolink(o)}},e.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},e.goShop=function(){s.go("myStore",{storeId:e.userId,shareStoreId:""})},e.noticeDownload=function(){t.downAppUrl||f.showToast("不支持该手机")},e.jumpMsg=function(){s.go("ClassifyMessageCenter")},e.inPersonalPage=function(e){0!=e&&s.go("personalHomepageHe",{othersId:e})},e.isClick=function(){e.isDisplay=!e.isDisplay},e.downLoadPhoto=function(o){e.photoUrl=o,t.isIOS?m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(o,function(e){f.showToast("保存成功")},function(e){f.showToast("保存失败")})}}):m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW");var o=new FileTransfer,s=encodeURI(e.photoUrl);return o.download(s,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存成功")},function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}})},e.productConnect=function(){var t={productId:e.circleDetail.productId,userCode:e.circleDetail.userCode};v.connectProduct(t).success(function(t){e.products=t.data.list})},e.toProductDetail=function(e){s.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},e.editTopic=function(){s.go("publishEdit",{topicId:e.circleId})},e.showCommentView=function(t){e.commentId=t;l.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:e,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){e.insertComments()}}]});g(function(){},3e3)},e.isInputShow=function(){e.inputShow=!e.inputShow},e.pinglunshow=function(){var t=d.$getByHandle("pinglun"),o=t.getScrollPosition(),s=o.top,i=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-i,g(function(){e.pinglunis=s>e.topicheight},200)},e.nocommontId=function(){e.commontId&&(e.commontId="",e.toSomeone="",e.commentWords.words="",e.iconImageData=[])},e.focuss=function(){e.isPublishImage=!0,e.showBac=!0,e.iconImageData.length>0&&(e.isImage=!0)},e.deleteImg=function(t){e.iconImageData.splice(t,1)},e.showLarge=function(t){e.showBigBac=!0,e.showBigImg=!0,e.Url=t},e.closeBigImg=function(){e.showBigImg=!1,e.showBigBac=!1},e.closeImg=function(){e.isImage=!1,e.isPublishImage=!1,e.showBac=!1},e.imgPush=function(t){if(e.isImage=!0,e.iconImageData.length>=9)return void f.showToast("最多添加9张");m.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};g(function(){e.iconImageData.push(o),e.existPhoto=!0},200)}function s(){}if(0==t)return navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var i=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s)}e.$apply()},function(e){},{maximumImagesCount:i,width:800,quality:50}),!0}}})},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis,e.shuxiaoxi=!e.shuxiaoxi},e.favorite=function(){var t={id:e.circleId,noLoading:!0};c.pushPraise(t).success(function(e){})},e.follow=function(o){if(0==o){var s={id:e.circleDetail.userCode,isFollow:1};c.followNote(s).success(function(o){1==o.success?e.circleDetail.isFolled=1:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}else if(1==o){var s={id:e.circleDetail.userCode,isFollow:0};c.followNote(s).success(function(o){1==o.success?e.circleDetail.isFolled=0:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}},e.getA=function(){g(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},1e3)},e.getCircleDetails=function(){var t={id:e.circleId};c.getCircleDetails(t).success(function(t){e.circleDetail=t.data,e.circleDetail.productId&&e.productConnect()}),e.getA()},e.getComment=function(){var t={pageIndex:1,pageSize:1e4,id:e.circleId};c.getComments(t).success(function(t){e.commentNumbers=t.totalCount,e.commentList=t.data.list,e.imgString="",e.imgA=[];for(var o=0;o<e.commentList.length;o++)e.commentList[o].commentImgs&&(e.imgString=e.commentList[o].commentImgs,e.imgA=e.imgString.split(","),e.commentList[o].imgaa=e.imgA);d.resize()})},e.getFocus=function(t,o){event.stopPropagation(),e.commentWords.words="",e.iconImageData=[],e.isPublishImage=!0,e.showBac=!0,e.commontId=t,e.toSomeone="回复给："+o,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.leaveFocus=function(){e.commontId="",e.toSomeone=""},e.insertComments=function(){var t=0;if(e.commentWords.words){var o={keywords:e.commentWords.words};p.judgeWords(o).success(function(o){"没有敏感词"==o.message?0==e.iconImageData.length?e.publishTopic():angular.forEach(e.iconImageData,function(o,s){var i=function(o){a.hide(),t++;var i=JSON.parse(o.response),n=i.urls;e.imgUrlList[s]=n,t==e.iconImageData.length&&e.publishTopic()},n=function(e){a.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(v.uploadImage()),i,n,r)}):(f.showToast("存在敏感词",o.data),e.commentWords.words="")})}else f.showToast("内容不能为空")},e.publishTopic=function(t){if(e.commontId){var t={comment:e.commentWords.words,commentTo:e.commontId,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}else{var t={comment:e.commentWords.words,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}},e.insertCommentOK=function(t){c.insertComment(t).success(function(t){e.getComment(),1==t.success?(f.showToast("回复成功"),e.commentWords.words="",e.commontId="",e.toSomeone="",e.iconImageData=[],e.imgUrlList=[],e.isImage=!1,e.isPublishImage=!1,e.showBac=!1):(g(function(){f.showToast(t.message)},200),e.commentWords.words="")}).error(function(t){f.showToast("网络异常"),e.commentWords.words=""})},e.topicPraise=function(t){var o={id:t,noLoading:!0};c.pushPraise(o).success(function(t){1==t.success?(e.isPraise=!e.isPraise,e.getStoryPraiseNum(),f.showToast("点赞成功")):f.showToast(t.message)})},e.topicFavorite=function(o){var s={id:o,noLoading:!0};c.topicFavorite(s).success(function(o){1==o.success?(e.isFavorite=!e.isFavorite,e.getStoryPraiseNum(),f.showToast("收藏成功")):-2e3==o.errorCode?(f.showToast(o.message),t.loginIsAccord2=!0):f.showToast(o.message)})},e.commentPraise=function(t,o){var s={commentId:t.id};c.commentPraise(s).success(function(s){1==s.success&&(t.commentPraiseNumberFlag=!t.commentPraiseNumberFlag,e.commentPraiseNum(t,o))})},e.getStoryPraiseNum=function(){var t={id:e.circleId};c.getStoryPraise(t).success(function(t){e.praiseNum=t.data})},e.commentPraiseNum=function(t,o){var s={commentId:t.id};c.commentPraiseNum(s).success(function(t){e.commentList[o].commentPraiseNumber=t.totalCount})},e.deleteStory=function(){var t={storyId:e.circleDetail.id};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("话题删除成功"),s.go("circlePage",{circleId:e.circleDetail.topicId}))})},e.warnDeleteComments=function(o){e.isDisplay=!1,e.deleteId=o;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){e.deleteComment()}}]});g(function(){},3e3)},e.deleteComment=function(){var t={id:e.deleteId};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("删除成功"),e.getComment())})},e.shareToStore=function(){var t={flag:2,storyId:e.circleDetail.id};v.shareStore(t).success(function(e){e.success})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){f.showToastShort("复制成功")},200)):f.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.circleDetail.storyName+"-顺逛微社区",s=e.circleDetail.storyContentText.substr(0,30),i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=h.getShareLinkHeader()+"classNoteDetails/"+e.circleId;window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,I.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,I.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,I.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,I.shareSuccessCallback),I.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,I.shareSuccessCallback),I.qqShare()),5==t?e.copeText(a):I.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1,e.shareToStore()},e.closeDownload=function(){e.ifDownload=!1},e.init=function(){e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,o.fromTemplateUrl("templates/quanzi/biggerPictureModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.biggerPictureModal=t}),e.userId=S.getUser().mid,window.cordova?e.ifInApp=!1:e.ifInApp=!0,e.toSomeone="",e.showQQ=!1,e.ifDownload=!0,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.commentWords={words:""},e.showShare=!1,e.isFavorite=!0,e.isPraise=!0,e.isDisplay=!1,e.circleId=i.noteId,e.ifShort=i.isShortStory,e.personType={isAdmin:!1,isCreateStory:!1},e.getCircleDetails(),e.getComment(),e.getStoryPraiseNum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ClassNoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("GETSTORYINFO"),data:o})},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("CLASS_DELETE_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOLLECTION"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("GETSTORYCOMMENT"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("SUBMITCOMMENT"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GETSTORYPRAISEANDUNREAD"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISENUM"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})}}]),APP.controller("ClassesDetailsController",["$scope","$rootScope","$state","$stateParams","ClassesDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r){e.isClick=0,e.input={input:""},e.classInfo={courseCategory:"",courseName:"",courseStartTime:"",teacher:"",teacherIntroduce:"",forumStartTime:"",forumEndTime:"",courseDescription:"",timeOrder:""},e.membersJoin={courseId:2,createTime:"2017-01-17 11:24:00.0",id:3,type:"2",userCode:"",userImg:"",userName:""},e.teacherList={userName:2,teacherIntroduce:"2017-01-17 11:24:00.0",userImg:3,children:"2",courseName:"",courseId:""},e.messageBoardList={questionId:"",questionContent:"",questionTime:"",questionUserName:"",questionUserCode:"",questionUserImg:"",firstAnswerId:"",firstAnswerContent:"",firstAnswerTime:"",firstAnswerUserName:"",firstAnswerUserCode:"",firstAnswerUserImg:"",firstAnswerIsTeacher:"",answersTotal:"",totalCount:""},e.classesList={},e.topicList={},e.shareList={},e.init=function(){e.ifShowInput=!0,e.getClassInfo(),e.getClassesList(),e.getMessageBoardList(),e.getClassTopicList(),e.studentShare()},e.click0=function(){e.isClick=0},e.click1=function(){e.isClick=1},e.click2=function(){e.isClick=2},e.goBack=function(){e.$ionicGoBack()},e.getClassInfo=function(){var t={courseId:2};i.getClassInfo(t).success(function(t){e.classInfo=t.data.list[0],e.classJoinMember(),e.getTeacherList()})},e.classJoinMember=function(){var t={courseId:2};i.classJoinMember(t).success(function(t){e.membersJoin=t.data.list})},e.getTeacherList=function(){var t={courseId:2};i.getTeacherList(t).success(function(t){e.teacherList=t.data.list})},e.getClassesList=function(){var t={courseId:2};i.getClassesList(t).success(function(t){e.classesList=t.data.list})},e.getClassTopicList=function(){var t={courseId:2};i.getClassTopicList(t).success(function(t){e.topicList=t.data.list})},e.studentShare=function(){var t={courseId:1};i.studentShare(t).success(function(t){e.shareList=t.data.list,r.$getByHandle("mainScroll").resize()})},e.getMessageBoardList=function(){var t={courseId:1,pageSize:5,pageIndex:1};i.getMessageBoardList(t).success(function(t){e.messageBoardList=t.data.list})},e.toQuestionDetail=function(e){o.go("questionDetails",{wordsId:e})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showInput=function(){e.ifShowInput=!e.ifShowInput},e.commitAnswer=function(){var t={wordsContent:e.input.input,courseId:"",parentId:""};i.askQuestion(t).success(function(e){}).error(function(){})}}]),APP.service("ClassesDetailsService",["$http","UrlService",function(e,t){this.getClassInfo=function(o){return e({method:"POST",url:t.getUrl("COURSE_INFO"),data:o})},this.classJoinMember=function(o){return e({method:"POST",url:t.getUrl("COURSE_ALL_MEMBER"),data:o})},this.getTeacherList=function(o){return e({method:"POST",url:t.getUrl("COURSE_TEACH_LIST"),data:o})},this.getClassesList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_LIST"),data:o})},this.getClassTopicList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_TOPIC_LIST"),data:o})},this.studentShare=function(o){return e({method:"POST",url:t.getUrl("STUDENT_SHARE"),data:o})},this.getMessageBoardList=function(o){return e({method:"POST",url:t.getUrl("MESSAGE_BOARD_LIST"),data:o})},this.askQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})}}]),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$q","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(t){e.tempUrl=t;var o=r.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,$)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.imageUrl=s,o.data.fileType=".jpg",o.data.companyId=void 0,o.data.message="图片文件",o.data.companyId=void 0,e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})}function $(e){alert("上传失败")}function S(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function I(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.productObjs=[],e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.isShowRecord=!1,e.tempUrl,e.isOffLine=!1,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.userInCC.mid,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["mid","image"],values:[1111222,333]};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?l.showToast("客服暂时不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.isPlaying||e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=g.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++)r.filtMsg(o.data.msgs[s]),o.data.msgs[s].message&&e.messages.push(o.data.msgs[s]);t.resolve(1)}else t.resolve(1)},function(e){alert(e),t.resolve(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};if(!t.msg)return void l.showToast("发送消息不能为空");r.sendMsg(t).then(function(o){if(o){var s={message:t.msg,companyId:void 0};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(t){var s={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:t,desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(s).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var s={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(s).then(function(e){if(e);o.goBack()},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.transferTo=1,e.transferChat=function(){var t={cmd:"transferChat",c:e.csId,v:e.uuID,chatId:e.chatId,transNum:1,aId:e.transferTo};r.transferChat(t).then(function(t){t&&t.data?"success"==t.data.result?(e.chatId=t.data.chat1,e.csId=e.transferTo):alert("transfer chat  server response error ！！！"):alert("transfer chat  net error ！！！")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(e){p.getPicture(e,f,h)},e.play=function(){var e=document.getElementById("audioInCC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){p.startCapture("sourceInCC","audioInCC")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),p.stopCapture("sourceInCC","audioInCC",e.transfer)},e.transfer=function(){var t=r.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,s.data.message="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(s.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};r.addEvent(i).then(function(t){t?a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败"),e.loopGetMsg()})},y=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("content");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.sendLink=function(t){var o=JSON.stringify(t),s="$prodLink"+o,i={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:s};if(!i.msg)return void l.showToast("发送消息不能为空");r.sendMsg(i).then(function(t){if(t){var o={message:i.msg,companyId:void 0};r.filtMsg(o),e.messages.push(o),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.isPlaying=!1,"back"==s.direction||(e.productObjs=[],e.init()),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",S),window.addEventListener("native.keyboardhide",I),p.addAudioEventOnWindow()});var T=void 0;e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",S),window.removeEventListener("native.keyboardhide",I)}),e.$on("play-sound-ended",function(t,o){for(var s=0;s<e.messages.length;s++)e.messages[s].imageUrl===o.id.src&&s<e.messages.length-1&&".wav"===e.messages[s+1].fileType&&e.$broadcast("play-sound-next",{id:e.messages[s+1].imageUrl})}),e.goBack=function(){e.isPlaying||e.isOffLine||(e.actSheet=d.show({buttons:[{text:"<b>非常满意</b> "},{text:"<b>比较满意</b> "},{text:"<b>一般</b> "},{text:"<b>不满意</b> "}],titleText:"评价客服",cancelText:"取消",cancel:function(){},buttonClicked:function(t){return e.opinion(t),!0}}))}}]),APP.service("CustomerConversationService",["$http","UrlService","$sce",function(e,t,o){function s(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+a[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+a[t]+'.png" />')}var i="http://123.56.3.136:8182";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke/",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.getUUID=function(){return e.get(i+"/getVistorId.dll")},this.opinion=function(t){return e.get(i+"/msg.dll",t)},this.endChat=function(t){return e.get(i+"/msg.dll",t)},this.transferChat=function(t){return e.get(i+"/msg.dll",t)},this.addEvent=function(t){return e.get(i+"/msg.dll",t)},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.message&&e.message.indexOf("$prodLink")>-1)e.message="已经发送了 商品链接";else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("[")>-1&&e.message.indexOf("]")>-1)for(var t=1;t<16;t++)e.message=s(e.message,t)};var a=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.getUploadUrl=function(){return i+"/receive3.jsp"}}]),APP.directive("resizeFootBar",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content"),a=e.$getByHandle("ccScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("GroupSettingController",["$scope","GroupSettingService","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","UserService","PopupService","CircleGroupDiscussService","$ionicModal","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.isShowName=!0,e.confirmData={groupName:"",groupMax:"0"};var g={userGag:0,userId:"test",userState:"0",userName:"我是路飞",userImg:"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png"},m={userGag:1,userId:"test",userState:"1",userName:"我不是是路飞",userImg:"https://git.oschina.net/uploads/80/436680_xu6767.png"};e.groupId;var f=c.getUser();e.token=f.sessionValue,e.groupUsers=[g,m,g,m,g,m,g,m,g,m,g,m],e.groupDesp={},e.groupSetting={yes:!1,userId:void 0};var h=window.innerWidth;e.jinyanHover={top:"5px",left:.1*h-21-1.5+"px"},e.groupInfo,e.query=function(){var o={groupId:e.groupId,token:e.token};t.query(o).success(function(t){t&&t.userInfo&&(e.groupUsers=t.userInfo)},function(e){alert("查询群组成员失败")})},e.init=function(){e.query(),e.queryGroup()},e.delGroupUser=function(o){var s={userId:o.userId,groupId:e.groupId};t.deleteGroupUser(s).then(function(t){t&&(l.showToast("删除用户成功"),e.query())},function(e){alert("net error--- delGroup  failed")})},e.getAllMsg=function(){var t={c:"getGroupMsg",groupId:e.groupId,token:e.token};d.getAllMsg(t).then(function(t){t&&t.data?e.historyMsgs=t.data.rows:l.showToast("获得讨论组列表失败")},function(e){alert("net error--- delGroup  failed")})},e.getMsgByMun=function(){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};d.getMsgByMun(t).then(function(e){if(e);},function(e){alert("net error--- delGroup  failed")})},p.fromTemplateUrl("templates/quanzi/groupName.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.groupName=t}),e.openName=function(){e.isShowName=!0,e.groupName.show()},e.closeName=function(){e.groupName.hide()},e.openMaxRecord=function(){e.isShowName=!1,e.groupName.show()},e.queryGroup=function(){var o={companyId:f.mid,groupId:e.groupId,token:e.token};t.queryGroup(o).then(function(t){t.data&&t.data.rows&&(e.groupInfo=t.data.rows[0],e.groupDesp=JSON.parse(e.groupInfo.desp))},function(e){alert("net error--- delGroup  failed")})},e.upDateGroup=function(){var o;if(e.confirmData.groupName){var s=JSON.parse(e.groupDesp);o={id:e.groupId,desp:"{}",token:s,groupName:e.confirmData.groupName}}if(e.confirmData.groupMax){if(!angular.isNumber(e.confirmData.groupMax))return void l.showToast("请输入一个秒数");e.groupDesp.timeSet=e.confirmData.groupMax;var s=JSON.parse(e.groupDesp);o={id:e.groupId,desp:s,token:e.token,groupName:e.confirmData.groupName}}if(!o)return void l.showToast("输入不能为空");t.updateGroup(o).then(function(t){t&&(l.showToast("更改讨论组信息成功"),e.queryGroup())},function(e){alert("net error--- addGroupUser  failed")})},e.queryGroupByMemberId=function(){var o={userId:f.mid,token:e.token};t.queryGroupByMemberId(o).then(function(e){},function(e){alert("net error--- addGroupUser  failed")})},e.addGroupUser=function(){e.groupSetting.userId||l.showToast("请输入合法的用户Id");var o={userId:e.groupSetting.userId,groupId:e.groupId};t.updateGroupUser(o).then(function(t){t&&(l.showToast("添加成员成功"),e.query())},function(e){alert("net error--- addGroupUser  failed")})},e.gagGroupUser=function(o){var s;if("null"===o.userGag||"0"===o.userGag)s=1;else{if("1"!=o.userGag)return;s=0}var i={userId:o.userId,userGagType:s,groupId:e.groupId};t.gagGroupUser(i).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.gagAll=function(){var o={groupGagType:e.groupSetting.yes?1:0,groupId:e.groupId};t.getGroupGag(o).then(function(t){t&&(l.showToast("gagAll"),e.query())},function(e){alert("net error--- gagAll  failed")})},e.$on("$ionicView.beforeEnter",function(){e.groupId=u.groupId,e.circleId=u.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),e.init()}),e.tabSelected=!0,e.switchTab=function(){e.tabSelected=!e.tabSelected},e.createGroup=function(){t.createGroup("admin","讨论组名字","讨论组介绍信息").success(function(t){e.groupId=t.groupId})},
e.deleteGroup=function(){t.deleteGroup(e.groupId).success(function(e){})},e.toGroupEditMember=function(){a.go("groupEditMember",{groupId:e.groupId})},e.toGroupAddMember=function(){a.go("groupAddMember",{groupId:e.groupId,circleId:e.circleId})}}]),APP.service("GroupSettingService",["$http",function(e){var t="http://123.56.3.136:8180/Service/chatGroup";this.register=function(t){return e.get("http://123.56.3.136:8180/Service/Company/addApi",t)};this.query=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/queryGroupUser",params:t})},this.queryGroup=function(o){return e({method:"POST",url:t+"/queryGroup",params:o})},this.queryGroupByMemberId=function(o){return e({method:"POST",url:t+"/queryChatGroupUserId",params:o})},this.updateGroup=function(o){return e({method:"POST",url:t+"/updateChatGroupDesp",params:o})},this.filtGroup=function(e){};this.deleteGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/deleteGroupUser",params:t})};this.gagGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/getGroupUserGag",params:t})};this.updateGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/updateGroupUser",params:t})};this.getGroupGag=function(t){return e({method:"POST",url:"http://172.16.63.96:8080/console/Service/chatGroup/getGroupGag",params:t})};this.createGroup=function(t,o,s){return e({method:"POST",url:url,params:"http://172.16.63.98:8080/console/Service/chatGroup/getCreateGroupChat"})},this.deleteGroup=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/console/Service/chatGroup/getCloseGroupChat",params:{id:t}})}}]),APP.controller("GroupAddMemberController",["$scope","$stateParams","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","CirclePageService","$q",function(e,t,o,s,i,a,n,r,c,l,d,p,u){e.input={keywords:""},e.iconShow=!0,e.members=[],e.groupId=t.groupId;var g=l.getUser();e.token=g.sessionValue,e.circleId=408,e.members=[],e.membersHead=[],e.membersCommon=[],e.membersAdded=[],e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.getCircleMembers=function(){var t=u.defer(),o={topicId:e.circleId};return p.circleMembers(o).success(function(o){o.success?(e.membersCommon=o.data.list,e.membersHead=o.data.list1,t.resolve(1)):(d.showToast("获取圈子成员失败"),t.reject(1))}),t.promise},e.query=function(){var t={groupId:e.groupId,token:e.token};c.query(t).success(function(t){if(t&&t.userInfo){e.membersAdded=t.userInfo;for(var o=0;o<e.membersHead.length;o++){for(var s=!1,i=e.membersHead[o].memberId,a=0;a<e.membersAdded.length;a++)if(i==e.membersAdded[a].userId){s=!0;break}if(!s){var n={};n.idCate=0,n.imageFile=e.membersHead[o].img,n.nickName=e.membersHead[o].userName,n.userId=e.membersHead[o].memberId,n.userGag="0",n.userState=1,e.members.push(n)}}for(var r=0;r<e.membersCommon.length;r++){for(var c=!1,i=e.membersCommon[r].id,l=0;l<e.membersAdded.length;l++)if(i==e.membersAdded[l].userId){c=!0;break}if(!c){var n={};n.idCate=0,n.imageFile=e.membersCommon[r].userImg,n.nickName=e.membersCommon[r].userName,n.userId=e.membersCommon[r].id,n.userGag="0",n.userState=1,e.members.push(n)}}}},function(e){alert("查询群组成员失败")})},e.$on("$ionicView.beforeEnter",function(){e.members=[],e.groupId=t.groupId,e.circleId=t.circleId,e.getCircleMembers().then(function(){e.query()})}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){for(var t=[],o=0;o<e.members.length;o++)e.members[o].isSelected&&t.push(e.members[o]);for(var s=function(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=s(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=s(e[o]);return t}return e},i=s(t),a=0;a<i.length;a++)delete i[a].$$hashKey,delete i[a].isSelected;var n=JSON.stringify(i),r={groupMembers:n,groupId:e.groupId,token:e.token};c.updateGroupUser(r).then(function(t){t&&(d.showToast("添加成员成功"),e.getCircleMembers().then(function(){e.query()}))},function(e){alert("net error--- add group Members ---failed")})}}]),APP.service("GroupAddMemberService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("GroupEditMemberController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.input={keywords:""},e.iconShow=!0;var m=c.getUser();e.token=m.sessionValue,e.groupId=g.groupId,e.query=function(){var t={groupId:e.groupId,token:e.token};e.members=[],r.query(t).success(function(t){t&&t.userInfo&&(e.members=t.userInfo)},function(e){alert("查询群组成员失败")})},e.members=[],e.init=function(){var t=c.getUser();e.token=t.sessionValue,e.query()},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.gagOrNo=function(t){for(var o="",s=0;s<e.members.length;s++)e.members[s].isSelected&&(o=o+e.members[s].userId+",");o=o.substr(0,o.length-1);var i=t,a={userId:o,userGagType:i,groupId:e.groupId,token:e.token};r.gagGroupUser(a).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.$on("$ionicView.beforeEnter",function(){e.groupId=g.groupId,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("GroupsToShareController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupAddMemberService","UserService","PopupService","$ionicActionSheet","MediaService","GroupSettingService","CircleGroupDiscussService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){e.input={keywords:""},e.iconShow=!0,e.members=[],e.shareListStr=void 0,e.isAllSelected=!1,e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t};var m=c.getUser();e.groupId=55,e.token=m.sessionValue,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(e){},e.init=function(){var t=c.getUser();e.token=t.sessionValue;var o={userId:t.mid,token:e.token};u.queryGroupByMemberId(o).then(function(t){if(t&&t.data){for(var o=0;o<t.data.rows.length;o++)try{t.data.rows[o].despObj=JSON.parse(t.data.rows[o].desp)}catch(e){t.data.rows[o].despObj={}}e.members=t.data.rows}else l.showToast("获得讨论组列表失败")})},e.$on("$ionicView.beforeEnter",function(){e.shareListStr=s.shareList,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){var t={groupMembers:'[{"userId":"138307014","idCate":"0","nickName":"cao138307014","imageFile":"www.baidu.com"},{"userId":"138990945","idCate":"0","nickName":"15648756478","imageFile":"www.baidu.com"}]',groupId:e.groupId,token:e.token};r.addMembers(t).then(function(e){e&&l.showToast("添加成员成功")},function(e){alert("net error--- add group Members ---failed")})},e.sendToGroups=function(){for(var t="",o=0;o<e.members.length;o++)e.members[o].isSelected&&(t=t+e.members[o].groupId+",");if(!t)return void alert("no chooesed");t=t.substr(0,t.length-1);var s={c:"sendGroupMsg",groupId:t,msg:e.shareListStr,msgType:1,token:e.token};g.sendMsg(s).then(function(e){e||l.showToast("发送消息失败--发送音频后")},function(e){})}}]),APP.service("GroupsToShareService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("MessageDetailsController",["$scope","$state","$stateParams","SelectTagsService",function(e,t,o,s){}]),APP.service("MessageDetailsService",["$http","UrlService",function(e,t){}]),APP.controller("MyCirclePagesController",["$scope","$rootScope","$state","MyCirclePagesService",function(e,t,o,s){e.myTopics="",e.myCreatTopics="",e.input={keywords:""},e.iconShow=!0,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.input={keywords:""},e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo()},e.search=function(t){e.getMyCreatTopicInfo(t.target.value),e.getMyJoinedCircleInfo(t.target.value),window.cordova&&cordova.plugins.Keyboard.close()},e.viewTopic=function(e){o.go("circlePage",{circleId:e})},e.reviewApplyCircle=function(e){t.reviewCircleId=e,o.go("applyCircle")},e.clickIn=function(e,s){0==s?o.go("circlePage",{circleId:e}):2==s?(t.showApplyTag=1,t.reviewCircleId=e,o.go("applyCircle")):(t.reviewCircleId=e,o.go("applyCircle"))},e.getMyCreatTopicInfo=function(t){var o={keywords:t};s.getMyCreatTopics(o).then(function(t){e.myCreatTopics=t.data.data.list},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};s.getMyJoinedTopics(o).then(function(t){e.myTopics=t.data.data.list},function(e){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyCirclePagesService",["$http","UrlService",function(e,t){this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("MYCREATE_TOPIC"),data:o})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("MYJOINED_TOPIC"),data:o})}}]),APP.controller("MyLessonesController",["$scope","$state","MyCirclePagesService",function(e,t,o){e.goBack=function(){e.$ionicGoBack()},e.init=function(){},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyLessonesService",["$http","UrlService",function(e,t){this.getMyTopics=function(o){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:o})}}]),APP.directive("comImageBox",["$rootScope","$ionicActionSheet","PopupService","CreditService","$timeout",function(e,t,o,s,i){return{restrict:"E",template:'<div class="LightBox" style="display:none;" ><div class="ImgViewer" on-tap="hideBigImage($event)"><img src="{{Url}}"></div></div>',transclude:!1,templateNamespace:"html",scope:!1,link:{pre:function(t,o,s,a){function n(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;L=t[0].clientX,D=t[0].clientY,b=T,A=C,N=0,_=0}function r(e){var t=e.originalEvent?e.originalEvent.touches:e.touches,s=T-p*S/2+g/2,i=g-(s+p*S),a=C-u*S/2+m/2,n=m-(a+u*S);""===f&&(1===t.length?f="swipe":2===t.length&&(f="pinch",w=S,v=l(t),P=t[0].clientX-parseInt((t[0].clientX-t[1].clientX)/2,10)-o.find("img")[0].offsetLeft-b,x=t[0].clientY-parseInt((t[0].clientY-t[1].clientY)/2,10)-o.find("img")[0].offsetTop-A)),"swipe"===f?(e.preventDefault(),N=t[0].clientX-L,_=t[0].clientY-D,T=b+N,C=A+_,d(),s>0&&i>0&&(T=0,d()),a>0&&n>0&&(C=0,d())):"pinch"===f&&(e.preventDefault(),h=l(t),I=h/v,S=I*w,T=P*(1-I)+b+N,C=x*(1-I)+A+_,d(),T=0,C=0,d())}function c(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;if(!(""===f||t.length>0)){S<1?(S=1,T=0,C=0):S>y&&(S=y,I=S/w,T=P*(1-I)+b+N,C=x*(1-I)+A+_);var o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S);o>0&&s<0?(T=p*S/2-g/2,d()):o<0&&s>0&&(T=g/2-p*S/2,d()),i<0&&a>0?(C=m/2-u*S/2,d()):i>0&&a<0&&(C=u*S/2-m/2,d()),o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S),i>0&&a>0&&(C=0,d()),o>0&&s>0&&(T=0,d()),o=T-p*S/2+g/2,s=g-(o+p*S),i=C-u*S/2+m/2,a=m-(i+u*S),d(.1),f=""}}function l(e){var t=Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2));return parseInt(t,10)}function d(e){var t=e?"all cubic-bezier(0,0,.5,1) "+e+"s":"",s=[S,0,0,S,T,C],i="matrix("+s.join(",")+")";o.find("img").css({"-webkit-transition":t,transition:t,"-webkit-transform":i+" translate3d(0,0,0)",transform:i})}var p,u,g,m,f="",h=0,v=0,S=(!!window.cordova&&ionic.Platform.platform().indexOf("ios"),1),I=1,w=1,y=parseInt(s.maxScale,10);(isNaN(y)||y<=1)&&(y=20);var T=0,C=0,b=0,A=0,P=0,x=0,L=0,D=0,N=0,_=0;g=$(".LightBox").width(),m=$(".LightBox").height(),t.Url="",t.bigImage=!1,t.noreload=!1,t.showBigImage=function(s,i){"VIDEO"!=s.target.tagName&&void 0!=s.target.currentSrc&&(s.stopPropagation(),t.Url=s.target.currentSrc,e.picBigUrl=t.Url,t.bigImage=!0,$(".LightBox").show(150,function(){$("ion-header-bar").hide(),$(".Main .tab-nav").hide(),$(".LightBox .ImgViewer img").each(function(){$(this).css({width:"90%"}),p=$(this).width(),u=$(this).height(),$(this).css({marginLeft:p/2*-1,marginTop:u/2*-1})})}),o.find("img").on("touchstart",n),o.find("img").on("touchmove",r),o.find("img").on("touchend",c))},t.hideBigImage=function(){t.bigImage=!1,t.noreload=!0,i(function(){t.noreload=!1},500),$("ion-header-bar").show(),$(".Main .tab-nav").show(),$(".LightBox").hide(200),f="",h=0,v=0,S=1,I=1,w=1,y=parseInt(s.maxScale,10),(isNaN(y)||y<=1)&&(y=20),T=0,C=0,b=0,A=0,P=0,x=0,L=0,D=0,N=0,_=0,d()}},post:function(e,t,o,s){}}}}]),APP.directive("myfocus",["$timeout","$parse",function(e,t){return{link:function(o,s,i){var a=t(i.myfocus);o.$watch(a,function(t){!0===t?e(function(){s[0].focus()}):!1===t&&e(function(){s[0].blur()})})}}}]),APP.filter("trusted",["$sce",function(e){return function(t){return"string"==typeof t?e.trustAsHtml(t):t}}]),APP.controller("NoteDetailsController",["ionicDatePicker","$localstorage","CirclePageService","HomePageService","$scope","$ionicHistory","$rootScope","$compile","$state","$ionicModal","$stateParams","$http","NoteDetailsService","$ionicLoading","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","$timeout","$ionicActionSheet","PopupService","UrlService","UserService","CreditService","PlatformService","$location",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,S,I,w,y,T,C,b){function A(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function P(){var e=b.absUrl();secritIdIndex=e.indexOf("secritId"),tokenIndex=e.indexOf("&token"),_urlToken=decodeURI(e.substring(secritIdIndex+9,tokenIndex)),""!=_urlToken&&p({method:"POST",url:w.getUrl("OTHER_LOGIN"),params:{token:_urlToken},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){y.setUser(e.data),t.set("sg_login_token_secret","Bearer"+e.data.sessionValue)})}self.touchStart=function(e){if(self.startCoordinates=getPointerCoordinates(e),!ionic.tap.ignoreScrollStart(e)){if(ionic.tap.containsOrIsTextInput(e.target))return void(self.__hasStarted=!1);self.__isSelectable=!0,self.__enableScrollY=!0,self.__hasStarted=!0,self.doTouchStart(e.touches,e.timeStamp)}},i.isDisplay=!1,i.inputShow=!0,i.praiseNum={},i.commentId="",i.circleId,i.circleDetail,i.commentList,i.products="",i.iconImageData=[],i.imgUrlList=[],i.isImage=!1,i.showBigImg=!1,i.showBac=!1,i.imgString="",i.isPublishImage=!1,i.imgA=[],i.showBigBac=!1,i.shanList="",i.commentIndex=1,i.commentWords={words:""},i.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],i.pinglunis=!1,i.topicheight=0,i.comment={text:"",rows:1},i.noteDetail={reply:"说点什么"},i.$watch("noteDetail.reply",function(e,t,o){}),i.goBack=function(){662==i.circleDetail.topicId?c.go("circlePage",{circleId:662}):665==i.circleDetail.topicId?c.go("circlePage",{circleId:665}):(i.$ionicGoBack(),n.nextPageBefore="noteDetails")},i.goshare=function(){if(!y.getUser().mid)return void c.go("login");i.showShare=!i.showShare,i.isDisplay=!1,u.getShop().success(function(e){e.success&&e.data?i.shareUserId=i.userId:i.shareUserId=null})},i.inCirclePage=function(e){c.go("circlePage",{circleId:e})},i.inPersonalPage=function(e){0!=e&&(e==y.getUser().mid?c.go("personalHomepageMe"):c.go("personalHomepageHe",{othersId:e}))},i.goShop=function(){c.go("myStore",{storeId:i.userId,shareStoreId:""})},i.jumpMsg=function(){c.go("ClassifyMessageCenter")},i.isClick=function(){i.isDisplay=!i.isDisplay},i.downLoadPhoto=function(e){i.photoUrl=n.picBigUrl,n.isApp&&(n.isIOS?S.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){n.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(n.picBigUrl,function(e){I.showToast("保存成功")},function(e){I.showToast("保存失败")})}}):S.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){n.$broadcast("LOADING:SHOW");var e=new FileTransfer,t=encodeURI(i.photoUrl);return e.download(t,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){n.$broadcast("LOADING:HIDE"),I.showToast("保存成功")},function(e){n.$broadcast("LOADING:HIDE"),I.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}}))},i.bigvideo=function(e){n.globalConstant.showvideo=!0,v(function(){$(".video-src1").attr("src",i.video)},100)},i.hideVideo=function(e){e.target.previousElementSibling.pause(),n.globalConstant.showvideo=!1},i.playing=function(e){e.target.style.display="none",e.target.nextElementSibling.play(),i.targetv=e.target.nextElementSibling,i.targetv.addEventListener("ended",function(){e.target.style.display="block"})},i.editTopic=function(){1==i.circleDetail.isReward?1==i.circleDetail.rewardStatus?I.showToast("该悬赏贴已关闭，不能修改"):i.commentList.length>0?I.showToast("该悬赏贴已有评论，不能修改"):c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:2}):i.video?c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:3}):c.go("publishEdit",{topicId:i.circleDetail.topicId,noteId:i.circleId,isShortStory:i.ifShort,topicStyle:1})},i.showCommentView=function(e){i.commentId=e;m.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:i,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){i.isOne&&(i.isOne=!1,i.insertComments())}}]});v(function(){},3e3)},i.isInputShow=function(){i.inputShow=!i.inputShow},i.pinglunshow=function(){var e=f.$getByHandle("pinglun"),t=e.getScrollPosition(),o=t.top,s=window.innerHeight-118;i.topicheight=document.getElementById("topicxiang").clientHeight-s,v(function(){i.pinglunis=o>i.topicheight},200)},i.addImage=function(){S.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function s(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},i.xiaoxishow=function(){i.xxshow=0!=i.count.count,i.isshow=!i.isshow,i.xiaoxis=!i.xiaoxis,i.shuxiaoxi=!i.shuxiaoxi},i.favorite=function(){var e={id:i.circleId};u.pushPraise(e).success(function(e){})},i.getCircleDetails=function(){var e={id:i.circleId};u.getCircleDetails(e).success(function(e){i.circleDetail=e.data,662!=i.circleDetail.topicId&&665!=i.circleDetail.topicId||(i.circleIDIF=!0,662==i.circleDetail.topicId?o.getCircleLink("","","1").success(function(e){e.success&&(i.circleUrl=e.data)}):665==i.circleDetail.topicId&&o.getCircleLink("","","3").success(function(e){e.success&&(i.circleUrl=e.data)})),i.circleDetail.mediaInfo&&(i.video=i.circleDetail.mediaInfo[0].url,v(function(){$(".video-src").attr("src",i.video),$(".video-src").attr("poster",i.circleDetail.mainImg)},200)),i.circleDetail.rewardEndTime&&(i.circleDetail.rewardEndTime=i.circleDetail.rewardEndTime.substring(0,10)),i.circleDetail.rewardComment&&(i.circleDetail.rewardComment[0].imgaa=i.circleDetail.rewardComment[0].commentImgs.split(",")),1==i.circleDetail.dataTypeNew&&i.circleDetail.storyImgs&&(i.storyCommityImgs=i.circleDetail.storyImgs.split(",")),i.imgArr=[];for(var t=1;t<=i.circleDetail.mainImgArray.length;t++)i.imgArr.push(t);i.whichPersonType(),1==i.ifShort&&i.circleDetail.productId&&i.productConnect(),i.getA()})},i.follow=function(e){if(0==e){var t={id:i.circleDetail.userCode,isFollow:1};u.followNote(t).success(function(e){1==e.success?(i.circleDetail.isFolled=1,i.alreadyFollow=!0,v(function(){i.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(I.showToast(e.message),n.loginIsAccord2=!0)})}else if(1==e){var t={id:i.circleDetail.userCode,isFollow:0};u.followNote(t).success(function(e){1==e.success?i.circleDetail.isFolled=0:-2e3==e.errorCode&&(I.showToast(e.message),n.loginIsAccord2=!0)})}},i.getComment=function(){i.commentIndex=1;var e=A("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:1,pageSize:10,id:i.circleId,userCode:o?i.weChatOpenId:e};u.getComments(s).success(function(e){i.commentNumbers=e.totalCount,i.commentList=e.data.list,i.commentNumbers>10&&(i.hasmore=!0),i.imgString="",i.imgA=[];for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1,i.commentList[t].commentImgs&&(i.imgString=i.commentList[t].commentImgs,i.imgA=i.imgString.split(","),i.commentList[t].imgaa=i.imgA);f.resize()})},i.loadMore=function(){i.commentIndex=i.commentIndex+1;var e=A("loginId"),t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:i.commentIndex,pageSize:10,id:i.circleId,userCode:o?i.weChatOpenId:e};u.getComments(s).success(function(e){i.commentNumbers=e.totalCount,i.commentList=i.commentList.concat(e.data.list),i.commentNumbers>i.commentList.length?i.$broadcast("scroll.infiniteScrollComplete"):(i.hasmore=!1,I.showToast("没有更多评论了")),i.imgString="",i.imgA=[];for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1,i.commentList[t].commentImgs&&(i.imgString=i.commentList[t].commentImgs,i.imgA=i.imgString.split(","),i.commentList[t].imgaa=i.imgA)})},i.getFocus=function(e,t,o){event.stopPropagation();for(var s=0;s<i.commentList.length;s++)i.commentList[s].ischecked=!1;i.commentWords.words="",i.iconImageData=[],i.isPublishImage=!0,i.showBac=!0,i.commontId=e,i.toSomeone="回复给："+t,setTimeout(function(){document.getElementById("inputId").focus()},200)},i.focuss=function(){s.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==n.isWdHost&&c.go("login")})},i.deleteImg=function(e){i.iconImageData.splice(e,1)},i.showLarge=function(e){i.showBigBac=!0,i.showBigImg=!0,i.Url=e},i.closeBigImg=function(){i.showBigImg=!1,i.showBigBac=!1},i.closeImg=function(){i.images=!1,i.isImage=!1,i.isPublishImage=!1,i.showBac=!1},i.imgPush=function(e){if(i.isImage=!0,i.iconImageData.length>=9)return void I.showToast("最多添加9张");S.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){var t={imgUrl:e};v(function(){i.iconImageData.push(t),i.existPhoto=!0},200)}function o(){}if(0==e)return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==e){var s=9-i.iconImageData.length;return window.imagePicker.getPictures(function(e){for(var t=0;t<e.length;t++){var o={imgUrl:e[t]};i.iconImageData.push(o)}i.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},i.insertCom=function(e){s.isWdHost().success(function(t){if(n.isWdHost=t.data.isHost,-1==n.isWdHost)c.go("login");else if(window.cordova&&(n.gio.track("comment",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId})),"IMG"==e.target.nodeName)if(i.commontId){var o={commentId:i.commontId,commentImgs:e.target.src,id:i.circleId};i.insertCommentOK(o)}else{var o={commentImgs:e.target.src,id:i.circleId};i.insertCommentOK(o)}})},i.insertComments=function(){s.isWdHost().success(function(e){if(n.isWdHost=e.data.isHost,-1==n.isWdHost)c.go("login");else{window.cordova&&(n.gio.track("comment",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId}));var t=0;if(i.commentWords.words){var o={keywords:i.commentWords.words};h.judgeWords(o).success(function(e){"没有敏感词"==e.message?0==i.iconImageData.length?(i.iconImageData=[],i.imgUrlList=[],i.publishTopic()):angular.forEach(i.iconImageData,function(e,o){var s=function(e){g.hide(),t++;var s=JSON.parse(e.response),a=s.urls;i.imgUrlList[o]=a,t==i.iconImageData.length&&i.publishTopic()},a=function(e){g.hide()},n={},r=new FileTransfer;r.upload(e.imgUrl,encodeURI(u.uploadImage()),s,a,n)}):(I.showToast("存在敏感词",e.data),i.commentWords.words="")})}else I.showToast("内容不能为空")}})},i.nocommontId=function(){i.isDisplay=!1;for(var e=0;e<i.commentList.length;e++)i.commentList[e].ischecked=!1;i.commontId&&(i.commontId="",i.toSomeone="",i.commentWords.words="",i.iconImageData=[])},i.publishTopic=function(e){if(i.commontId){var e={comment:i.commentWords.words,commentId:i.commontId,commentImgs:i.imgUrlList.toString(),id:i.circleId};i.insertCommentOK(e)}else{var e={comment:i.commentWords.words,commentImgs:i.imgUrlList.toString(),id:i.circleId};i.insertCommentOK(e)}},i.insertCommentOK=function(e){u.insertComment(e).success(function(e){i.getComment(),1==e.success?(I.showToast("回复成功"),i.commentWords.words="",i.commontId="",i.toSomeone="",i.iconImageData=[],i.imgUrlList=[],i.isImage=!1,i.isPublishImage=!1,i.showBac=!1,i.images=!1,i.haierImg=!1,i.shunguangImg=!1):(v(function(){I.showToast(e.message)},200),i.commentWords.words="")}).error(function(e){I.showToast("网络异常"),i.commentWords.words=""})},i.topicPraise=function(e){window.cordova&&(n.gio.track("like",{circleID:i.circleDetail.topicId}),n.gio.track("active",{circleID:i.circleDetail.topicId}));var t=window.navigator.userAgent.toLowerCase(),o="micromessenger"==t.match(/MicroMessenger/i),s=A("loginId"),a={id:e,noLoading:!0,userCode:o?i.weChatOpenId:s};u.pushPraise(a).success(function(e){1==e.success?(i.isPraise=!i.isPraise,i.getStoryPraiseNum()):I.showToast(e.message)})},i.topicFavorite=function(e){var t={id:e,noLoading:!0};u.topicFavorite(t).success(function(e){1==e.success?(i.isFavorite=!i.isFavorite,i.getStoryPraiseNum()):-2e3==e.errorCode?(I.showToast(e.message),n.loginIsAccord2=!0):I.showToast(e.message)})},i.goToScore=function(e){if("IMG"==e.target.tagName&&(i.noreload||i.showBigImage(e)),$(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),$(".noteContent a").removeAttr("href"),"linklink dot-block"==e.target.className)if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else{var t=e.target.outerText;i.tolink(t)}else if("all-to"==e.target.className)if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;i.tolink(t)}else{var t=e.target.outerText;i.tolink(t)}else if("atopic"==e.target.className){if(e.target.attributes["data-a"]){var t=e.target.attributes["data-a"].value;i.tolink(t)}else if(e.target.attributes.dataa){var t=e.target.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.className){if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.attributes.dataa){var t=e.target.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.className){if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.className)if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;i.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;i.tolink(t)}},i.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==C.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==C.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.getA=function(){v(function(){
$(".detailEditor .editor a").html(function(e,t){if(!this.attributes["data-a"])return t;if(this.attributes["data-a"].value){this.setAttribute("href",this.attributes["data-a"].value);var o=this.attributes["data-a"].value;return'<div class="all-to"><img class="imgimg" src="'+i.imgBaseURL+'/img/link.png"/><span class="linklink dot-block">'+o+"</span></div>"}})},20),v(function(){$(".detailEditor .editor div").removeAttr("contenteditable"),$(".detailEditor .editor div").addClass("copy")},30),v(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},100),v(function(){$(".detailEditor .editor .imgHeight").css({height:"auto",width:"auto","background-image":"none"}),$(".detailEditor .editor .imgHeight img").css({width:"100%",display:"block"}),$(".detailEditor .editor .imgHeight span").css({display:"none"}),$(".detailEditor .editor span").css("font-size","12px")},60)},i.topicShan=function(e){i.images=!1,i.haierImg=!1,i.shunguangImg=!1,1==i.circleDetail.isReward?I.showToast("该话题是悬赏话题，不能被打赏"):(i.showShan=!0,i.goldNum(),e?i.shanCommentId=e:(i.shanCommentId="",i.shanTopicId=i.circleId))},i.selectImg=function(){i.images=!0,i.haierImg=!0,i.shunguangImg=!1,i.yearImg=!1},i.selectHaier=function(){i.haierImg=!0,i.shunguangImg=!1,i.yearImg=!1},i.selectshun=function(){i.haierImg=!1,i.shunguangImg=!0,i.yearImg=!1},i.selectYear=function(){i.haierImg=!1,i.shunguangImg=!1,i.yearImg=!0},i.deleteShan=function(){i.reward.num="";for(var e=0;e<i.shanNum.length;e++)i.shanNum[e].isChecked=!1;i.shanGoldNum="",i.showShan=!1},i.clickMore=function(e){if(i.isDisplay=!1,i.commentList[e].ischecked)for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;else{for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;i.commentList[e].ischecked=!0}},i.toRewardList=function(){c.go("topicRewardList",{tipId:i.circleId})},i.selectGod=function(e){if(i.reward.num="",i.shanNum[e].isChecked){for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.shanGoldNum=""}else{for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.shanNum[e].isChecked=!0,i.shanGoldNum=i.shanNum[e].num}},i.otherGoldNum=function(){for(var e=0;e<i.shanNum.length;e++)i.shanNum[e].isChecked=!1;i.shanGoldNum=i.reward.num},i.noticeDownload=function(){n.downAppUrl||I.showToast("不支持该手机")},i.commentPraise=function(e,t){var o=window.navigator.userAgent.toLowerCase(),s="micromessenger"==o.match(/MicroMessenger/i),a=A("loginId"),n={commentId:e.id,noLoading:!0,userCode:s?i.weChatOpenId:a};u.commentPraise(n).success(function(o){if(1==o.success){if(i.circleDetail.rewardComment){if(e.id==i.circleDetail.rewardComment[0].id){i.circleDetail.rewardComment[0].commentPraiseNumberFlag=!i.circleDetail.rewardComment[0].commentPraiseNumberFlag;for(var s=0;s<i.commentList.length;s++)e.id==i.commentList[s].id&&(i.commentList[s].commentPraiseNumberFlag=!i.commentList[s].commentPraiseNumberFlag)}}else for(var s=0;s<i.commentList.length;s++)e.id==i.commentList[s].id&&(i.commentList[s].commentPraiseNumberFlag=!i.commentList[s].commentPraiseNumberFlag);i.getCommentPraiseNum(e,t)}else I.showToast(o.message)})},i.getStoryPraiseNum=function(){var e=window.navigator.userAgent.toLowerCase(),t="micromessenger"==e.match(/MicroMessenger/i),o=A("loginId"),s={id:i.circleId,noLoading:!0,userCode:t?i.weChatOpenId:o};u.getStoryPraise(s).success(function(e){i.praiseNum=e.data})},i.getCommentPraiseNum=function(e,t){var o=window.navigator.userAgent.toLowerCase(),s="micromessenger"==o.match(/MicroMessenger/i),a=A("loginId"),n={commentId:e.id,noLoading:!0,userCode:s?i.weChatOpenId:a};u.commentPraiseNum(n).success(function(t){if(i.circleDetail.rewardComment){if(e.id==i.circleDetail.rewardComment[0].id){i.circleDetail.rewardComment[0].commentPraiseNumber=t.totalCount;for(var o=0;o<i.commentList.length;o++)e.id==i.commentList[o].id&&(i.commentList[o].commentPraiseNumber=t.totalCount)}}else for(var o=0;o<i.commentList.length;o++)e.id==i.commentList[o].id&&(i.commentList[o].commentPraiseNumber=t.totalCount)})},i.startTime=function(){if("APP"==C.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){v(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear(),a=new Date(e);a.setDate(e.getDate()+7);var n=a.getMonth()+1;n<10&&(n="0"+n),o<10&&(o="0"+o),t<10&&(t="0"+t);var r=s+"-"+o+"-"+t;i.start=r,i.end=a.getFullYear()+"-"+n+"-"+a.getDate()},200)})}else{var o={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e);i.startOk=new Date(e);var o=new Date(e);i.endOk=o,o.setDate(t.getDate()+7);var s=new Date(e).getMonth()+1,a=new Date(e).getDate();s<10&&(s="0"+s),a<10&&(a="0"+a);var n=new Date(e).getFullYear()+"-"+s+"-"+a;i.start=n,i.end=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()}};e.openDatePicker(o)}},i.endTime=function(){if("APP"==C.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){v(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t);var a=s+"-"+o+"-"+t;i.end=a},200)})}else{var o={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:i.startOk,to:i.endOk,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);var s=new Date(e).getFullYear()+"-"+t+"-"+o;i.end=s}};e.openDatePicker(o)}},i.selectStartEnd=function(){i.topStyle=1,i.startend="img/ic_select.png",i.day="img/ic_check.png"},i.selectDay=function(){i.topStyle=0,i.day="img/ic_select.png",i.startend="img/ic_check.png"},i.deleteTop=function(){i.showTop=!1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"},i.deleteJing=function(){i.showJing=!1,i.topStyle=3,i.topicJing=!0,i.isFirstJing=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"},i.selectTop=function(){i.showTop=!0},i.selectJing=function(){i.showJing=!0},i.topicTopOK=function(){i.personType.isSuperManager&&(i.topicTop?i.topicTop=!1:i.topicTop=!0)},i.topicJingOK=function(){i.personType.isSuperManager&&(i.topicJing?i.topicJing=!1:i.topicJing=!0)},i.firstTop=function(){i.isFirstTop?i.isFirstTop=!1:i.isFirstTop=!0},i.firstJing=function(){i.isFirstJing?i.isFirstJing=!1:i.isFirstJing=!0},i.topPosts=function(){if(i.isFirstTop||i.topicTop)if(0==i.topStyle||1==i.topStyle){if(1==i.topStyle){if(i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:3};i.okTop(e)}else if(i.isFirstTop&&!i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:2};i.okTop(e)}else if(!i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:1,topStartDate:i.start,topEndDate:i.end,topicTop:1};i.okTop(e)}}else if(0==i.topStyle)if(i.topTopic.day){var t=parseInt(i.topTopic.day);if(t>0)if(t<30){if(i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:3};i.okTop(e)}else if(i.isFirstTop&&!i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:2};i.okTop(e)}else if(!i.isFirstTop&&i.topicTop){var e={storyId:i.circleId,topStatus:0,topNum:t,topicTop:1};i.okTop(e)}}else I.showToast("置顶天数不能超过30天，请重新输入");else I.showToast("置顶天数需大于0天，请重新输入")}else I.showToast("请输入置顶天数")}else I.showToast("请选择置顶时间");else I.showToast("请选择置顶位置")},i.okTop=function(e){u.topStory(e).success(function(e){e.success?(I.showToast("置顶成功"),i.circleDetail.isTopicTop=!0,i.showTop=!1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"):I.showToast(e.message)})},i.JingPosts=function(){if(i.isFirstJing||i.topicJing)if(0==i.topStyle||1==i.topStyle){if(1==i.topStyle){if(i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:3};i.okJing(e)}else if(i.isFirstJing&&!i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:2};i.okJing(e)}else if(!i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:1,choiceStartDate:i.start,choiceEndDate:i.end,topicChoice:1};i.okJing(e)}}else if(0==i.topStyle)if(i.topTopic.day){var t=parseInt(i.topTopic.day);if(t>0)if(t<30){if(i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:3};i.okJing(e)}else if(i.isFirstJing&&!i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:2};i.okJing(e)}else if(!i.isFirstJing&&i.topicJing){var e={storyId:i.circleId,choiceStatus:0,choiceNum:t,topicChoice:1};i.okJing(e)}}else I.showToast("设置精华天数不能超过30天，请重新输入");else I.showToast("置顶天数需大于0天，请重新输入")}else I.showToast("请输入天数")}else I.showToast("请选择精华时间");else I.showToast("请选择精华位置")},i.okJing=function(e){u.JingStory(e).success(function(t){t.success?(I.showToast("设置精华成功"),i.circleDetail.isChoice=e.topicChoice,i.showJing=!1,i.topStyle=3,i.topicJing=!0,i.isFirstJing=!1,i.startend="img/ic_check.png",i.day="img/ic_check.png"):I.showToast(t.message)})},i.cancelTop=function(){var e={storyId:i.circleId};u.cancelTop(e).success(function(e){e.success?(i.circleDetail.isTopicTop=!1,i.circleDetail.isTop=!1,I.showToast(e.message)):I.showToast(e.message)})},i.cancelJing=function(){var e={storyId:i.circleId};u.cancelJing(e).success(function(e){e.success?(i.circleDetail.isChoice=0,I.showToast(e.message)):I.showToast(e.message)})},i.deleteStory=function(){var e={storyId:i.circleDetail.id};u.deleteTopic(e).success(function(e){1==e.success?(I.showToast("话题删除成功"),n.ifDeleteNoteList=!0,c.go("circlePage",{circleId:i.circleDetail.topicId})):I.showToast(e.message)})},i.warnDelete=function(e){if(i.isDisplay=!1,i.commentId=e,1==i.circleDetail.isReward&&0==i.circleDetail.rewardStatus){m.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>该话题是悬赏话题，删除金币不退回，确认删除吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){i.deleteStory()}},{text:"放弃"}]})}else{m.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除话题吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:i,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){i.deleteStory()}},{text:"放弃"}]})}v(function(){},3e3)},i.warnDeleteComments=function(e){i.isDisplay=!1,i.deleteId=e;m.show({template:'<img src="{{imgBaseURL}}img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:i,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){i.deleteComment()}}]});v(function(){},3e3)},i.deleteComment=function(e){var t={id:i.deleteId};u.deleteStory(t).success(function(e){1==e.success?(I.showToast("删除成功"),i.getComment()):I.showToast(e.message)})},i.productConnect=function(){var e={productId:i.circleDetail.productId,userCode:i.userShareId?i.userShareId:i.circleDetail.userCode};u.connectProduct(e).success(function(e){e.success&&(i.products=e.data.list)})},i.toProductDetail=function(e){c.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},i.whichPersonType=function(){var e={storyId:i.circleDetail.id,topicId:i.circleDetail.topicId};u.getPersonType(e).success(function(e){1==e.success&&(i.personType={isAdmin:e.data.isAdmin,isCreateStory:e.data.isCreateStory,isSuperManager:e.data.isSuperManager,isCircleManager:e.data.isCircleManager})})},i.shareToStore=function(){var e={flag:1,storyId:i.circleDetail.id};u.shareStore(e).success(function(e){e.success})},i.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),v(function(){I.showToastShort("复制成功")},200)):I.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){-1!=b.absUrl().indexOf("token")&&b.search("token","null");var t=i.circleDetail.storyName?i.circleDetail.storyName+"-顺逛微社区":i.circleDetail.userName+"的话题-顺逛微社区",o=i.circleDetail.storyContentText.substr(0,30)||"马上进入，参与话题讨论吧...",s=i.circleDetail.mainImgArray[0]?i.circleDetail.mainImgArray[0]:"http://www.ehaier.com/mstatic/wd/v2/img/sg.png";if(i.shareUserId)var a=w.getShareLinkHeader()+"noteDetails/"+i.circleId+"/"+i.ifShort+"/"+i.shareUserId;else var a=w.getShareLinkHeader()+"noteDetails/"+i.circleId+"/"+i.ifShort+"/";if(window.umeng){var n={topicId:i.circleId},r=function(e){T.shareSuccessCallback(e,n)};0==e?window.umeng.shareToSina(t,o,s,a,0,null,r):1==e?window.umeng.shareToWechatSession(t,o,s,a,0,null,r):2==e?window.umeng.shareToWechatTimeline(t,o,s,a,0,null,r):3==e?(window.umeng.shareToQQ(t,o,s,a,0,null,r),T.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,a,0,null,r),T.qqShare()),5==e?i.copeText(a):T.successShare()}else alert("umeng undefined 只能在app分享");i.showShare=!1,i.shareToStore()},i.closeDownload=function(){i.ifDownload=!1},i.goldNum=function(){u.getGold().success(function(e){e.success?e.data>9999?i.canShanGold=9999:e.data<0?i.canShanGold=0:i.canShanGold=e.data:-2e3==e.errorCode?(I.showToast(e.message),i.showShan=!1,n.loginIsAccord2=!0):i.showShan=!1})},i.getShanList=function(){var e={tipId:parseInt(i.circleId),pageIndex:1,pageSize:10,type:1};u.getList(e).success(function(e){i.shanList=e.data})},i.shanTopic=function(){i.shanCommentId=i.shanCommentId+"",i.shanGoldNum?i.shanOK():i.reward.num?(i.shanGoldNum=parseInt(i.reward.num),i.shanOK()):I.showToast("请选择打赏金币")},i.shanOK=function(){if(i.shanGoldNum<=9999)if(i.shanGoldNum<=i.canShanGold)if(i.shanCommentId.length>0){var e={commentId:i.shanCommentId,amount:i.shanGoldNum};u.shanComment(e).success(function(e){if(e.success){i.showShan=!1,I.showToast("打赏成功"),v(function(){i.getShanList()},1e3);for(var t=0;t<i.commentList.length;t++)i.commentList[t].ischecked=!1;for(var o=0;o<i.shanNum.length;o++)i.shanNum[o].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanCommentId=""}else I.showToast(e.message)})}else{var t={storyId:parseInt(i.shanTopicId),amount:i.shanGoldNum};u.shanTopic(t).success(function(e){if(e.success){i.showShan=!1,I.showToast("打赏成功"),v(function(){i.getShanList()},1e3);for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanTopicId=""}else{i.showShan=!1;for(var t=0;t<i.shanNum.length;t++)i.shanNum[t].isChecked=!1;i.reward.num="",i.shanGoldNum="",i.shanTopicId="",I.showToast(e.message)}})}else I.showToast("您的金币数不足，请修改打赏金额");else I.showToast("最多可打赏9999金币，请修改打赏金额")},i.gotoothers=function(e){c.go("personalHomepageHe",{othersId:e.userId})},i.cangComment=function(e){var t={id:e.id,isDisplay:e.isDisplay};u.cangComment(t).success(function(e){e.success?(I.showToast(e.message),v(function(){i.getComment()},1e3)):I.showToast(e.message)})},i.cangTopic=function(){var e={storyId:i.circleId};u.cangTopic(e).success(function(e){e.success?i.getCircleDetails():I.showToast(e.message)})},i.delCangTopic=function(){var e={storyId:i.circleId};u.delCangTopic(e).success(function(e){e.success?i.getCircleDetails():I.showToast(e.message)})},i.topicAgree=function(e){m.show({template:"<div>您是否确认采纳该回复？</div>",title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:i,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){var o={storyId:i.circleId,commentId:e};u.topicAgree(o).success(function(e){e.success?(I.showToast("已经被采纳"),i.getCircleDetails(),i.getStoryPraiseNum(),i.getComment()):I.showToast(e.message)})}}]})},i.init=function(){i.images=!1,i.haierImg=!1,i.shunguangImg=!1,n.globalConstant.showvideo=!1,i.commentIndex=1,i.topStyle=3,i.topicTop=!0,i.isFirstTop=!1,i.topicJing=!0,i.isFirstJing=!1,i.showJing=!1,i.topTopic={day:5},i.startend="img/ic_check.png",i.day="img/ic_check.png";var e=new Date,t=parseInt(e.getMonth())+1,o=new Date(e);o.setDate(e.getDate()+7);var s=parseInt(o.getMonth())+1;i.start=e.getFullYear()+"-"+t+"-"+e.getDate(),i.end=o.getFullYear()+"-"+s+"-"+o.getDate(),i.shareUserId=null,i.userShareId=d.shareStoreId,i.circleId=d.noteId,i.circleIDIF=!1,i.shanList="",n.ifDeleteNoteList=!1,i.reward={num:""},i.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],i.getShanList(),i.userId=y.getUser().mid,window.cordova?i.ifInApp=!1:i.ifInApp=!0,i.ifDownload=!0,i.toSomeone="",i.showQQ=!1,i.showWeChat=!1,i.showShare=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){i.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){i.showWeChat=0!=e})),i.commentWords={words:""},i.showShare=!1,i.isFavorite=!0,i.isPraise=!0,i.isDisplay=!1,i.ifShort=d.isShortStory,i.personType={isAdmin:!1,isCreateStory:!1},i.getCircleDetails(),i.getStoryPraiseNum(),i.getComment(),l.fromTemplateUrl("templates/quanzi/TopDaysModal.html",{scope:i,animation:"slide-in-up"}).then(function(e){i.selectModal=e})},i.wechatOpenId=function(){u.getWeChatOpenId().success(function(e){e.success&&(e.data?(i.weChatOpenId=e.data,u.weChatOpenId=e.data,i.init()):i.wechatUrlOpenId())})},i.wechatUrlOpenId=function(){var e=b.absUrl();u.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},i.$on("$ionicView.beforeEnter",function(){P(),window.location.hash=b.path(),i.isIOS=!!ionic.Platform.isIOS(),n.$on("$stateChangeStart",function(e,t,o,s,i){if("noteDetails"==s.name)for(var a=document.getElementsByTagName("video"),n=0;n<a.length;n++)a[n].pause()}),ionic.Platform.isAndroid()&&(i.hideBigImage(),$(".LightBox").hide(0)),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?s.isWdHost().success(function(e){n.isWdHost=e.data.isHost,-1==n.isWdHost?i.wechatOpenId():i.init()}):i.init()}),i.$on("$ionicView.beforeLeave",function(){$("ion-header-bar").show(),$(".Main .tab-nav").show()}),i.gotoCompare=function(){},i.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)},i.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);i.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),i.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)}}]),APP.service("NoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.deleteTopic=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETE_COMMON_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("TOPIC_PRAISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("COMMON_COMMENT"),data:o})},this.topStory=function(o){return e.get(t.getUrl("CIRCLE_TOP_TOPIC"),o)},this.JingStory=function(o){return e.get(t.getUrl("CIRCLE_JING_TOPIC"),o)},this.cancelJing=function(o){return e.get(t.getUrl("CIRCLE_JING_CANCLE"),o)},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("INSERT_COMMON_COMMENT"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GET_STORY_PRAISE"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("COMMENT_STORY_PRAISE"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})},this.cancelTop=function(o){return e.get(t.getUrl("CANCEL_TOP"),o)},this.cangComment=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_CANG_COMMENT"),data:o})},this.cangTopic=function(o){return e.get(t.getUrl("CIRCLE_CANG_TOPIC"),o)},this.delCangTopic=function(o){return e.get(t.getUrl("CIECLE_DEL_CANG_TOPIC"),o)},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getGold=function(){return e.get(t.getUrl("CIRCLE_GET_GOLD"))},this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)},this.getShop=function(o){return e.get(t.getUrl("CIRCLE_SELECT_SHOP"))},this.topicAgree=function(o){return e.get(t.getUrl("CIRCLE_AGREE"),o)},this.shanTopic=function(o){return e.get(t.getUrl("CIRCLE_SHAN_TOPIC"),o)},this.shanComment=function(o){return e.get(t.getUrl("CIRCLE_SHAN_COMMENT"),o)},this.getWeChatOpenId=function(){return e({method:"POST",url:t.getUrl("GET_WECHAT_OPENID")})},this.getWeChatUrlOpenId=function(o){var s={url:o};return e.post(t.getUrl("GET_WECHAT_URL")+"?url="+encodeURIComponent(s.url))},this.weChatOpenId=""}]),APP.controller("PublishCircleController",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicLoading","$ionicActionSheet","PublishCircleService","ApplyCircleService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.identifyCode="",e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.goSelectGoods=function(){o.go("selectGoods")},e.judgeWords=function(){var t={keywords:e.publishInfo.storyContent};c.judgeWords(t).success(function(e){"没有敏感词"==e.message||d.showToast(e.message)})},e.$watch("publishInfo.storyContent",function(){p.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&d.showToast("话题内容不得超过500字")}),e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.publishClick=function(s){if(s.mainImg=e.imgUrlList.toString(),e.publishInfo.topicId=e.topicId,0!=e.publishInfo.storyContent.length||e.iconImageData.length)if(e.publishInfo.storyContent.length>500)d.showToast("话题内容不得超过500字");else if(e.iconImageData.length!=e.imgUrlList.length)d.showToast("图片正在上传，请稍后再试");else{var i={keywords:e.publishInfo.storyContent};c.judgeWords(i).success(function(i){"没有敏感词"==i.message?r.publish(s).success(function(s){1==s.success?(d.showToast("发布成功"),t.publishSuccess=!0,l(function(){t.publishSuccess=!1},1e3),e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("circlePage",{circleId:e.topicId})):d.showToast(s.message)}).error(function(){}):d.showToast("存在敏感词",i.data)})}else e.publishNotice=!0,l(function(){e.publishNotice=!1},1e3)},e.imgUrlList=[],e.addPicture=function(){function t(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},i=function(e){a.hide()},n={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),s,i,n)}function o(){}return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0},e.photoAlbum=function(){var t=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s);var i=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){a.hide()},c={};(new FileTransfer).upload(s.imgUrl,encodeURI(r.uploadImage()),i,n,c)}e.$apply()},function(e){},{maximumImagesCount:t,width:800,quality:50}),!0},e.imgPush=function(t){if(e.iconImageData.length>=9)return void d.showToast("最多添加9张");n.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},i=function(e){a.hide()},n={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),s,i,n)}function s(){}if(0==t)return navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var i=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var s={imgUrl:t[o]};e.iconImageData.push(s);var i=function(t){a.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){a.hide()},c={};(new FileTransfer).upload(s.imgUrl,encodeURI(r.uploadImage()),i,n,c)}e.$apply()},function(e){},{maximumImagesCount:i,width:800,quality:50}),!0}}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.wordsNum=500,e.showBigImage=!1,e.iconImageData=[],e.publishInfo.storyContent="",e.topicId=s.topicId,e.identifyCode=s.identifierCode,1==e.identifyCode?e.addPicture():2==e.identifyCode&&e.photoAlbum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishCircleService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("SUBMIT_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.controller("PublishEditController",["$scope","$rootScope","$state","$stateParams","PublishEditService","PopupService","$timeout","$ionicActionSheet","$ionicLoading","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.identifyCode="",e.publishInfo={id:s.topicId,mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.$watch("publishInfo.storyContent",function(){l.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&a.showToast("话题内容不得超过500字")}),e.getNoteDetail=function(){e.iconImageData=[],e.imgUrlList=[];var t={id:s.topicId};i.getDetails(t).success(function(t){e.detailData=t.data,e.publishInfo.storyContent=e.detailData.storyContent;for(var o=0;o<e.detailData.mainImgArray.length;o++){var s={imgUrl:e.detailData.mainImgArray[o]};e.imgUrlList.push(e.detailData.mainImgArray[o]),e.iconImageData.push(s)}})},e.publishClick=function(r){var c={keywords:e.publishInfo.storyContent};i.judgeWords(c).success(function(c){"没有敏感词"==c.message?(e.publishInfo.mainImg=e.imgUrlList.toString(),0!=e.publishInfo.storyContent.length||e.publishInfo.mainImg?e.iconImageData.length!=e.imgUrlList.length?a.showToast("图片正在上传，请稍后再试"):i.publish(r).success(function(i){1==i.success?(a.showToast("发布成功"),t.editSuccess=!0,n(function(){t.editSuccess=!1},1e3),e.publishInfo={id:s.topicId,mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("noteDetails",{noteId:e.circleId,isShortStory:e.ifShort})):a.showToast(i.message)}).error(function(){}):(e.publishNotice=!0,n(function(){e.publishNotice=!1},1e3))):a.showToast("存在敏感词",c.data)}).error(function(){})},e.imgUrlList=[],e.imgPush=function(t){if(e.iconImageData.length>=9)return void a.showToast("最多添加9张");r.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};n(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var s=function(t){c.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(i.uploadImage()),s,a,r)}function s(){}function a(){}function r(t){var o={imgUrl:t};e.iconImageData.push(o),e.existPhoto=!0,n(function(){for(var t=0;t<e.iconImageData.length;t++);},200);var s=function(t){c.hide();var o=JSON.parse(t.response),s=o.urls;e.imgUrlList.push(s),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(i.uploadImage()),s,a,r)}return 0==t?(navigator.camera.getPicture(o,s,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(r,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.showBigImage=!1,e.circleId=s.noteId,e.ifShort=s.isShortStory,e.getNoteDetail()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishEditService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("UPDATE_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})}}]),APP.controller("QuestionDetailsController",["$scope","$rootScope","$state","$stateParams","QuestionDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r){e.getListDate={wordsId:"",pageSize:"",pageIndex:""},e.answerDate={wordsContent:"",courseId:"",parentId:""},e.init=function(){e.wordId=s.wordsId,e.getQuestionList()},e.getQuestionList=function(){var t={wordsId:e.wordId,pageSize:10,pageIndex:1};i.getQuestionDetail(t).success(function(e){}).error(function(){})},e.commitAnswer=function(){e.answerDate={wordsContent:"",courseId:"",parentId:""},i.answerQuestion(e.answerDate).success(function(e){}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QuestionDetailsService",["$http","UrlService",function(e,t){this.answerQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})},this.getQuestionDetail=function(o){return e({method:"POST",url:t.getUrl("GET_QUESTION_DETAILS"),data:o})}}]),APP.controller("SchoolGroupDiscussController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;u.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,$)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);t.data.message=t.response.imageUrl,t.data.fileType=".jpg",t.data.companyId=void 0,e.$apply(function(){e.messages.push(t.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};m.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})}function $(e){alert("上传失败")}function S(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function I(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:void 0},e.footerStyle={bottom:"0px"},
e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode};c.getUser();e.groupId=55,e.token="21CB91E8209EA98369F5E504449497D7",e.sgdMode=0,e.toggleMode=function(t){e.sgdMode=t},e.miniTaolun=[{msg:33333},{msg:"erfjwqefjwiqawijofejwjfwe"},{msg:"大事发生反饥饿叫啊喂哦 i 发尾峰"},{msg:"一张图片"}],e.isClick=function(){e.isDisplay=!e.isDisplay},e.toMemberList=function(){i.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||m.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["exp_colum6","sss"],values:[1111222,333]};m.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId)}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token};r.getMsg(t).then(function(t){if(t&&t.data&&t.data.msgs&&0!=t.data.msgs.length)for(var o=0;o<t.data.msgs.length;o++)m.filtMsg(t.data.msgs[o]),t.data.msgs[o].message&&e.messages.push(t.data.msgs[o])},function(e){alert(e)})},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};r.sendMsg(t).then(function(o){if(o){var s={message:t.msg,companyId:void 0};m.filtMsg(s),e.messages.push(s)}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};m.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(){d.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){p.getPicture(e,f,h)}})},e.play=function(){var e=document.getElementById("audioInSD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.startRecord=function(){p.startCapture("sourceInSD","audioInSD")},e.deleteRecord=function(){p.deleteMedia()},e.stopRecord=function(){p.stopCapture("sourceInSD","audioInSD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=p.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),u.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,s=JSON.parse(t.response);o=s.data.imageUrl,o=o.replace(/8181/,"8082"),s.data.message="音频文件",s.data.imageUrl=o,s.data.fileType=".wav",s.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(s.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};m.addEvent(i).then(function(t){t?a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败")})},y=function(e){alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),a(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){e.CustumerParam.msg=e.CustumerParam.msg+"["+t+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.messages=[{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{message:"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 ",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:2}];var i={message:"aaf啊积极饿哇  啊发[1]",companyId:1234,userName:"我zou是路飞啊啊啊",idCate:0};m.filtMsg(i),e.messages.push(i),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",S),window.addEventListener("native.keyboardhide",I),p.addAudioEventOnWindow()});var T=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){p.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",S),window.removeEventListener("native.keyboardhide",I)}),e.goBack=function(){e.$ionicGoBack()}}]),APP.directive("resizeFootBarsd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-sd"),a=e.$getByHandle("cdScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("SelectGoodsController",["$scope",function(e){e.init=function(){},e.$on("$ionicView.beforeEnter",function(){})}]),APP.service("SelectGoodsService",["$http","UrlService",function(e,t){}]),APP.controller("SelectTagsController",["$scope","$rootScope","$state","$stateParams","SelectTagsService","PopupService","$timeout","$ionicScrollDelegate","$interval",function(e,t,o,s,i,a,n,r,c){t.frequentTags="",t.storeId=[],t.storeNames=[],t.nameStringToObj=[],t.addedTags=t.addedTags,e.namedTags="",e.isShow=!1,e.init=function(){e.phoneHeight=document.documentElement.clientHeight/2,e.getScrollHeight=function(){e.scrollHeight=document.getElementById("aaa").scrollTop},e.timer=c(function(){e.scrollHeight=document.getElementById("aaa").scrollTop,e.scrollHeight>e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},100),e.isShow=!1,t.nameStringToObj=[],t.frequentTags.length||(e.getFrequentlyTags(),t.storeId=[],t.storeNames=[],t.nameStringToObj=[])},e.goBack=function(){c.cancel(e.timer);for(var s=0;s<t.storeNames.length;s++){var i={name:t.storeNames[s]};t.nameStringToObj.push(i)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.getFrequentlyTags=function(){var e={id:t.reviewCircleId?t.reviewCircleId:""};i.getTags(e).success(function(e){if(t.frequentTags=e.data.list,e.data.list1){for(var o=0;o<e.data.list1.length;o++)t.storeId.push(e.data.list1[o].id);for(var s=0;s<e.data.list2.length;s++)t.storeNames.push(e.data.list2[s].name)}})},e.backApply=function(){c.cancel(e.timer);for(var s=0;s<t.storeNames.length;s++){var i={name:t.storeNames[s]};t.nameStringToObj.push(i)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.showInput=function(){e.isShow=!0,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.scrollToTop=function(){r.$getByHandle("mainScroll").scrollTop(),e.showTopBtn=!1},e.submitNamedTags=function(){var o={tagName:e.namedTags};if(o.tagName){for(var s=1,r=0;r<t.addedTags.length;r++){if(t.addedTags[r].name==o.tagName){a.showToast(response.message),s=0;break}s=1}1==s&&i.confirmTag(o).success(function(o){if(1==o.data)if(t.addedTags.length<5){var s={name:e.namedTags};t.addedTags.push(s),e.namedTags="",n(function(){e.isShow=!1},200)}else a.showToast("最多添加5个自定义标签");else a.showToast(o.message)})}else a.showToast("标签名不能为空");e.deleteTags=function(e){t.addedTags.splice(e,1)}},e.ifClicked=function(e,o,s,i){if(1==s)for(var n=0;n<=t.storeId.length;n++)t.storeId[n]==o&&(t.storeId.splice(n,1),t.storeNames.splice(n,1),t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked);else t.storeId.length<10?(t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked,t.storeId.push(o),t.storeNames.push(i)):a.showToast("最多选择10个")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SelectTagsService",["$http","UrlService",function(e,t){this.getFrequentTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.confirmTag=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGNAME"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})}}]),APP.controller("ServiceConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","ServiceConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","CustomerConversationService","$ionicPopup","$stateParams","MediaService","FileUploadService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$){function S(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.cId;$.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},w,y)}function I(e){alert("得到图片失败")}function w(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);o.data.message="图片文件";var s=o.data.imageUrl,i={imageUrl:s,fileType:".jpg",msg:"图片文件"};e.$apply(function(){e.messages.push(i)}),r.sendMsg(e.chatId,e.receiverId,"m",s,e.token).then(function(e){e&&e.data&&0==e.data.rt||alert("发送信息失败")})}function y(e){alert("上传失败")}function T(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function C(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.second=9,e.CustumerParam={msg:""},e.messages=[],e.token=c.getUser().sessionValue,e.cId=void 0,e.csTimer=void 0,e.receiverId="",e.chatId=void 0,e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.cId=h.to,e.receiverId=h.from,e.chatId=h.chatId,e.cId&&e.receiverId&&e.chatId&&(e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId))},e.goBack=function(){e.isPlaying||e.$ionicGoBack()},e.loginCs=function(){var t={c:"li",u:"admin",p:"123456"};e.chatId=void 0,r.login(t).then(function(t){t?(e.token=t.data.token,e.cId=t.data.ci,a(function(){e.loopGetMsg()},500)):alert("login error！！！")})},e.logoutCs=function(){},e.getLocalData=function(){a(function(){r.loadMessages(kefuData)},1200)},e.getMsg=function(){var t=d.defer();return r.getMsg(e.token).then(function(o){o&&o.data&&o.data.msgs&&0!=o.data.msgs.length?(angular.forEach(o.data.msgs,function(e,t){r.filtMsg(e),"close"==e.ty||e.ty}),r.loadMessages(o.data.msgs),e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId),t.resolve(1)):0==!o.data.msgs.length?t.resolve(1):t.reject(1)}),t.promise},e.sendMsg=function(){var t=e.CustumerParam.msg;return e.chatId&&e.receiverId?t?void r.sendMsg(e.chatId,e.receiverId,"m",t,e.token).then(function(o){if(o&&o.data&&0==o.data.rt){var s={msg:t,ty:"message"};r.filtMsg(s),e.messages.push(s),e.CustumerParam.msg=""}else alert("发送信息失败")}):void l.showToast("发送消息不能为空"):void alert("no chatId or receiverId ---sendMsg failed!")},e.getImg=function(e){v.getPicture(e,S,I)},e.startRecord=function(){v.startCapture("sourceInSC","audioInSC")},e.deleteRecord=function(){v.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),v.stopCapture("sourceInSC","audioInSC",e.transfer)},e.play=function(){var e=document.getElementById("audioInSC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=a(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),a(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,a.cancel(e.recordTimer))},1e3)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.cId,o=v.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),$.upload(o,t,void 0,void 0,void 0,{},b,A)};var b=function(t){var o=JSON.parse(t.response),s=o.data.imageUrl;o.data.message="音频文件",o.data.msg=o.data.imageUrl;var i={imageUrl:s,fileType:".wav",msg:"音频文件"};e.deleteRecord(),e.$apply(function(){e.messages.push(i)}),r.sendMsg(e.chatId,e.receiverId,"m",s,e.token).then(function(t){t&&t.data&&0==t.data.rt||alert("发送信息失败"),e.loopGetMsg()})},A=function(t){e.loopGetMsg(),alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("contentS").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):a(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("contentS");a(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,s){e.init(),e.footerStyle={bottom:"0px"},t.chatScope=o,a(function(){e.loopGetMsg()},3e3),window.addEventListener("native.keyboardshow",T),window.addEventListener("native.keyboardhide",C),v.addAudioEventOnWindow()}),e.$on("$ionicView.afterEnter",function(t,o){e.$broadcast("$ionicParentView.afterEnter",{who:t})}),e.$on("$ionicView.beforeLeave",function(){v.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",T),window.removeEventListener("native.keyboardhide",C),e.killTimer()})}]),APP.service("ServiceConversationService",["$http","UrlService",function(e,t){function o(e,t){r.entrySet[e]=t,r.count++}function s(e){return r.entrySet[e]}function i(e){for(var t in r.entrySet)if(t===e)return!0;return!1}function a(e){i(e)&&(delete r.entrySet[e],r.count--)}function n(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var r={count:0,entrySet:{}};this.isEmptyMap=function(){return 0===r.count},this.put=o,this.get=s,this.containsKey=i,this.remove=a,this.loadMessages=function(e){if(e&&angular.isArray(e))for(var t,a,n,r=0;r<e.length;r++)t=e[r],a=t.ci+"$"+t.fr+"$"+t.to,i(a)?(n=s(a),angular.isArray(n)&&n.push(t)):o(a,[t])},r.all=[],this.getAll=function(){for(var e in r.entrySet)r.all=r.all.concat(r.entrySet[e]);return r.all},this.getEntrySet=function(){return r.entrySet};var c="http://123.56.3.136:8181/api/invoke";this.login=function(t){return e({method:"POST",url:c,params:t})},this.kefulogin=function(t){return e({method:"POST",url:c,params:{c:"li",u:t}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e({method:"POST",url:c,params:{c:"re",token:t,noLoading:!0}})},this.filtMsg=function(e){"EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0);if(e.msg&&e.msg.indexOf("$prodLink")>-1){e.fileType="prodLink";var t=e.msg.substring(9),o=JSON.parse(t);e.prodObj=o}else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("[")>-1&&e.msg.indexOf("]")>-1)for(var s=1;s<16;s++)e.msg=n(e.msg,s)};var l=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.sendMsg=function(t,o,s,i,a){return e({method:"POST",url:c,params:{c:"sd",ci:t,to:o,ty:s,msg:i,token:a}})}}]),APP.directive("resizeFootBars",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,s,i){t.$on("taResize",function(t,s){if(s){var i=document.body.querySelector("#message-detail-content-s"),a=e.$getByHandle("scScroll"),n=s[0].offsetHeight,r=n+10;r=r>44?r:44,o[0].style.height=r+"px",i.style.bottom=r+"px",a.scrollBottom()}})}}}]),APP.controller("ShareListPageController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService",function(e,t,o,s,i,a,n,r,c,l,d,p){e.input={keywords:""},e.iconShow=!0,e.members=[],e.originData=void 0,e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.originData=s.sl,e.members=e.originData.shareMsgsList}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("TestDetailsController",["$scope","$rootScope","$state","$stateParams","TestDetailsService","PopupService","$timeout","$ionicModal",function(e,t,o,s,i,a,n,r){e.examQuestionList={},e.selectedOptions=[],e.summitOptions=[],e.testResult="",e.init=function(){r.fromTemplateUrl("templates/quanzi/CommitTestPaperModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.commitPaperModal=t}),e.showTestDetails(),e.getTestResult()},e.showTestDetails=function(){var t={courseId:1};i.getTestList(t).success(function(t){e.index=0,e.examQuestionList=t.data.list})},e.getTestResult=function(){var t={courseId:1};i.getTestResult(t).success(function(t){e.testResult=t.data.list})},e.jumpQuestionDetail=function(t){e.index=t-1},e.beforeQuestion=function(){e.index-=1},e.nextQuestion=function(){e.index+=1,e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,respondentsAnswer:e.summitCourseId?e.summitOptions:""};i.getTestList(t).success(function(t){e.selectedOptions=[];for(var o=e.examQuestionList[e.index].respondentsAnswer.split(","),s=0;s<o.length;s++)e.selectedOptions.push(o[s])})},e.submitPaper=function(){e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,submitPaperFlag:1,respondentsAnswer:e.summitCourseId?e.summitOptions:""};i.getTestList(t).success(function(t){e.selectedOptions=[]}).error(function(e){a.showToast(e.message)})},e.selectAnswer=function(t,o){if(e.examId=e.examQuestionList[t].id,e.summitCourseId=e.examQuestionList[t].courseId,"单选"==e.examQuestionList[t].subjectType){for(var s=0;s<e.examQuestionList[t].optionsList.length;s++)e.examQuestionList[t].optionsList[s].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}else if("多选"==e.examQuestionList[t].subjectType)if(1==e.examQuestionList[t].optionsList[o].isSelect)for(var s=0;s<e.selectedOptions.length;s++)e.selectedOptions[s]==e.examQuestionList[t].optionsList[o].optionsName&&(e.examQuestionList[t].optionsList[o].isSelect=!1,e.selectedOptions.splice(s,1),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString());else e.examQuestionList[t].optionsList[o].isSelect=!e.examQuestionList[t].optionsList[o].isSelect,e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString();else if("判断"==e.examQuestionList[t].subjectType){for(var s=0;s<e.examQuestionList[t].optionsList.length;s++)e.examQuestionList[t].optionsList[s].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}},e.showCommitPaper=function(){e.commitPaperModal.show()},e.hideCommitPaper=function(){e.commitPaperModal.hide()},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestDetailsService",["$http","UrlService",function(e,t){this.getTestList=function(o){return e({method:"POST",url:t.getUrl("TEST_LIST"),data:o})},this.getTestResult=function(o){return e({method:"POST",url:t.getUrl("TEST_CONSULT"),data:o})}}]),APP.controller("TestPageController",["$scope","$rootScope","$state","$stateParams","TestPageService","PopupService","$timeout",function(e,t,o,s,i,a,n){e.essentialInfo={},e.init=function(){e.getEssentialInfo()},e.toTestDetails=function(){o.go("testDetails")},e.getEssentialInfo=function(){var t={courseId:1};i.getEssentialInfo(t).success(function(t){e.essentialInfo=t.data.list})},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestPageService",["$http","UrlService",function(e,t){this.getEssentialInfo=function(o){return e({method:"POST",url:t.getUrl("TEST_ESSENTIAL_INFORMATION"),data:o})}}]),APP.controller("TopicController",["$scope","$rootScope","$ionicHistory","$state","TopicService","$localstorage",function(e,t,o,s,i,a){t.xiaoxis=!1,e.shuxiaoxi=!1,e.count=0,t.msgCount="",e.init=function(){e.tabNav="qhot",i.getxiaoxi().success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.onTabSelected=function(){t.xiaoxis=!1},e.open=function(){var e="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+a.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=e);window.emc.presentH5View(e,"创意社区")}}]),APP.service("TopicService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("TopicdetailsController",["$scope","$rootScope","$ionicHistory","TopicdetailsService","$http","$ionicSlideBoxDelegate","$stateParams","$sce","$ionicScrollDelegate","$timeout",function(e,t,o,s,i,a,n,r,c,l){e.tielist="",e.pinglunlist="",e.isshow=!1,e.xxshow=!1,e.huatiid="",e.xiaoxis=!1,e.userlist="",e.topicheight=0,e.pinglunis=!1,e.count="",e.dianzans="",t.showRightTop=!1,e.goBack=function(){e.$ionicGoBack()},e.pinglunshow=function(){var t=c.$getByHandle("pinglun"),o=t.getScrollPosition(),s=o.top,i=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-i,l(function(){e.pinglunis=s>e.topicheight},200)},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis},e.addImage=function(){$ionicActionSheet.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function s(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},e.gotoxiaoxi=function(){$state.go("qzMessageCenter"),e.isshow=!1,e.xxshow=!1},e.dianzan=function(){var t={id:e.huatiid};s.dianzan(t).success(function(t,o,s,i){e.dianzans=t.success})},e.init=function(){e.huatiid=n.huatiid;var o={pageIndex:1,pageSize:5,id:0};s.getpinglun(o).success(function(t,o,s,i){return e.pinglunlist=t.data.list,t});var i={id:e.huatiid};s.gettieData(i).success(function(t,o,s,i){return e.tielist=t.data,t}).error(function(){}),s.getdianzan(i).success(function(t,o,s,i){e.count=t.data}).error(function(){}),s.getxiaoxi(i).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init(),e.huatiid=n.huatiid})}]),APP.service("TopicdetailsService",["$http","UrlService",function(e,t){this.gettieData=function(o){return e.post(t.getUrl("GETSTORYINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getdianzan=function(o){return e.post(t.getUrl("GETSTORYPRAISEANDUNREAD"),o)},this.dianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.getpinglun=function(o){return e.post(t.getUrl("GETSTORYCOMMENT"),o)}}]),APP.directive("audioPanel",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/AudioPanel.html",scope:!0,link:function(e,t,o){}}}),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","$ionicPopup",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){try{e&&e.data&&(w?(S+=e.data.length,$=$.concat(e.data)):(S=e.data.length,$=e.data,w=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function h(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=1,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.isShowRecord=!1,e.CustumerParam={msg:"说点什么"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){a.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=a(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.userInCC=c.getUser(),r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t=d.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var s=0;s<o.data.msgs.length;s++){if(o.data.msgs[s].message&&o.data.msgs[s].message.indexOf("http")>-1&&o.data.msgs[s].message.indexOf(".jpg")>-1)o.data.msgs[s].fileType=".jpg",o.data.msgs[s].imageUrl=o.data.msgs[s].message;else if(o.data.msgs[s].message&&o.data.msgs[s].message.indexOf("http")>-1&&o.data.msgs[s].message.indexOf(".wav")>-1){o.data.msgs[s].fileType=".wav";var i=o.data.msgs[s].message;o.data.msgs[s].imageUrl=g.trustAsResourceUrl(i)}e.messages.push(o.data.msgs[s])}t.resolve(1)}else t.reject(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};r.sendMsg(t).then(function(o){e.messages.push({message:t.msg})},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(){var t={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:"2",desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(t).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var o={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(o).then(function(e){if(e);},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.sendPic=function(){p.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){function o(t){alert("getPicSuccess"),e.avatarImage=t;var o=function(t){u.hide(),l.showToast("上传成功");var o=JSON.parse(t.response);e.avatarImage=o.data.imageUrl,o.data.message="拍照图片",e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},s=function(e){u.hide(),l.showToast("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var a={};a.userName="18560683520",i.params=a,(new FileTransfer).upload(t,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,s,i)}function s(e){alert(e)}function i(t){e.avatarImage=t;var o=function(t){l.showToast("上传成功"),u.hide();var o=JSON.parse(t.response);o.data.message="相册图片",e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},s=function(e){l.showToast("上传失败"),u.hide()},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var a={};a.userName="18560683520",i.params=a,(new FileTransfer).upload(e.avatarImage,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,s,i)}function a(e){}return 0==t?navigator.camera.getPicture(o,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==t&&navigator.camera.getPicture(i,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})};var v={},$=[],S=0;window.URL=window.URL||window.webkitURL;var I="",w=!0;e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1};var y=function(){try{window.audioinput&&!audioinput.isCapturing()&&(v={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(v));m.alert({title:"开始录音",
template:"录音已经开始，按下确定结束"}).then(function(e){T()})}catch(e){alert("startCapture exception: "+e)}};e.startRecord=y;var T=function(){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),S=0;var e=new WavAudioEncoder(v.sampleRate,v.channels);e.encode([$]);var t=e.finish("audio/wav");window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory,function(e){e.getFile("xuftest123.wav",{create:!0},function(e){e.createWriter(function(o){o.write(t),setTimeout(function(){I=e.toURL(),document.getElementById("source").src=I,document.getElementById("audio").load()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};e.endRecord=T;var C=function(){window.resolveLocalFileSystemURL(I,function(e){e.remove(function(){alert("delete success"),w=!1,document.getElementById("source").src="",document.getElementById("audio").load()},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};e.deleteRecord=C;var b=function(){alert("start transfer");var t=function(t){alert("上传成功");var o=JSON.parse(t.response);o.data.message="音频文件",o.data.imageUrl=g.trustAsResourceUrl(o.data.imageUrl),e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})},o=function(e){alert("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName="aaa";var i={};i.userName="18560683520",s.params=i;var a=new FileTransfer,n="http://123.56.3.136:8088/live/receive.jsp?fileType=.wav&chatId="+e.chatId+"&cId=1";a.upload(I,encodeURI(n),t,o,s)};e.transfer=b,e.$on("$ionicView.beforeEnter",function(){e.init(),window.addEventListener("audioinput",f,!1),window.addEventListener("audioinputerror",h,!1),e.messages=[]}),e.$on("$ionicView.afterEnter",function(){}),e.$on("$ionicView.beforeLeave",function(){window.removeEventListener("audioinput",f),window.removeEventListener("audioinputerror",h),e.killTimer()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("CustomerConversationService",["$http","UrlService",function(e,t){var o="http://123.56.3.136:8088";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8088/live//msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.getUUID=function(){return e.get(o+"/live/getVistorId.dll")},this.opinion=function(t){return e.get(o+"/live/msg.dll",t)},this.endChat=function(t){return e.get(o+"/live/msg.dll",t)},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)},this.upload=function(){},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)}}]);var fangkeData=[{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:null,event:!0,exts:{},fromUserId:"admin",message:"admin",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"EVENT_ACCEPT",viewUserId:"admin"},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"hhah",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014076122.jpg",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014105480.wav",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null}];APP.controller("examCtrl",["$scope","$state","examService","NoteDetailsService",function(e,t,o,s){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.optionLetter=["A.","B.","C.","D."],e.answer=["a","b","c","d"],e.showWhich=[],e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.init=function(){e.isDisplay=!1,e.Qs=o.getQs(),e.showWhich[0]=!0,s.getxiaoxi().success(function(t,o,s,i){e.messageNum=t.data.count,e.ifRed=parseInt(t.data.count)}).error(function(e,t,o,s){alert("网络失败！")})},e.chooseWhich=function(t){e.showWhich=[],e.showWhich[t]=!0},e.$on("myIndex",function(t,o){e.$broadcast("yourIndex",o)}),e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("examService",[function(){var e=[{family:"一",questions:[{description:"题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目二题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目三题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目四题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目五题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目六题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目七题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]}]},{family:"二",questions:[{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"三",questions:[{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"四",questions:[{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]}];this.getQs=function(){return e}}]),APP.directive("eachRepeat",function(){return{link:function(e,t,o){e.$emit("myIndex",e.$index+1)}}}),APP.directive("receiveIndex",function(){return{link:function(e,t,o){e.$on("yourIndex",function(e,t){})}}}),APP.controller("heIssueController",["$http","$scope","$location","$anchorScroll","$cacheFactory","heIssueService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","personalHomepageHeService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T){function C(e,o,s,i){a.getMyIssue(e,o,s,i).success(function(e){1==e.success&&(t.issueData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function b(e,o,s,i){a.getMyComment(e,o,s,i).success(function(e){1==e.success&&(t.commentData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.commentList=t.commentList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function A(e,o,s){a.getMyStory(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function P(e,o,s){a.getDaShang(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.DaShangData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.DaShangList=t.DaShangList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function x(e,o,s){a.getCollection(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.CollectionList=t.CollectionList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function L(e){a.getMyJoinedTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function D(e){a.getMyCreatTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function N(e,o,s){a.getUserPraise(e,o,s).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.UserPraiseList=t.UserPraiseList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}t.titles=[{title:"TA的发布"},{title:"TA的评论"},{title:"TA的原创"}],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){t.$ionicGoBack()},t.hasmore=!1,t.init=function(e,o,s){t.cuurentUserId=o,t.pageIndex=1,t.pageSize=5,t.pageSize10=10,"original"==e?A(t.pageIndex,t.pageSize,t.cuurentUserId):"issue"==e?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"comment"==e?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"dashang"==e?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==e?x(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==e?1==s?D(t.cuurentUserId):0==s&&L(t.cuurentUserId):"zan"==e&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.loadMore=function(){"comment"==n.title?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"issue"==n.title?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"original"==n.title?A(t.pageIndex,t.pageSize,t.cuurentUserId):"dashang"==n.title?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==n.title?x(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==n.title?0==t.chooseQuanIndex?D(t.cuurentUserId):1==t.chooseQuanIndex&&L(t.cuurentUserId):"zan"==n.title&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.$on("$ionicView.beforeEnter",function(e,o){if("back"!=o.direction){switch(h.scrollTop(),t.chooseIndex=0,t.issueList=[],t.issueType=0,t.chooseComIndex=0,t.chooseQuanIndex=0,t.quanziTitle="加入",t.chooseResuIndex=0,t.commentList=[],t.commentType=0,t.MyStoryList=[],t.DaShangList=[],t.CollectionList=[],t.myTopicList=[],t.UserPraiseList=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=n.memberId,"his"==n.who?t.titleStart="TA":"mine"==n.who&&(t.titleStart="我"),n.title){case"issue":t.titleEnd="的发布";break;case"comment":t.titleEnd="的评论";break;case"original":t.titleEnd="的原创";break;case"dashang":t.titleEnd="的打赏";break;case"quanzi":t.titleEnd="的圈子";break;case"zan":t.titleEnd="的赞";break;case"shoucang":t.titleEnd="的收藏";break;default:t.titleEnd="的发布"}t.init(n.title,n.id,0)}}),t.chooseTab=function(e){h.scrollTop(),t.page=2,0==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):1==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):2==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType)):3==e&&(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",n.id,t.issueType))},t.chooseComTab=function(e){h.scrollTop(),0==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType)):1==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType)):2==e&&(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",n.id,t.commentType))},t.chooseQuanTab=function(e){0==e?(t.myTopicList=[],t.chooseQuanIndex=0,t.quanziTitle="加入",t.init("quanzi",n.id,0)):1==e&&(t.myTopicList=[],t.chooseQuanIndex=1,t.quanziTitle="创建",t.init("quanzi",n.id,1))},t.toNoteDetails=function(e,t){c.go("noteDetails",{noteId:e,isShortStory:t})},t.CommentDetails=function(e){2==e.flag?c.go("classNoteDetails",{noteId:e.storyId}):c.go("noteDetails",{noteId:e.storyId,isShortStory:e.isShortStory})},t.viewStory=function(e){2!==e.flag?c.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):c.go("classNoteDetails",{noteId:e.id})},t.topicPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:n.circleId}),f.gio.track("active",{circleID:n.circleId}));var s={id:e,noLoading:!0};a.pushPraise(s).success(function(e){1==e.success?1==t.MyStoryList[o].praiseFlag?(t.MyStoryList[o].praiseNumber=t.MyStoryList[o].praiseNumber-1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):(t.MyStoryList[o].praiseNumber=parseInt(t.MyStoryList[o].praiseNumber)+1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.CollectionPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:n.circleId}),f.gio.track("active",{circleID:n.circleId}));var s={id:e.id,noLoading:!0};1==e.flag&&a.pushPraise(s).success(function(e){1==e.success?1==t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)}),2==e.flag&&a.SchoolPraise(s).success(function(e){1==e.success?0!=t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.dealStory=function(e,o){var s;s=2!==e.flag?o:1==o?3:4;var i=e.storyTopicId?e.storyTopicId:e.id;T.dealStory(i,s).then(function(o){if(1==o.data.success){var a;switch(s){case 1:a=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?a-1:a+1,e.praiseFlag=!e.praiseFlag;break;case 2:a=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?a-1:a+1,e.collectionFlag=!e.collectionFlag;for(var n=0;n<t.CollectionList.length;n++)i==t.CollectionList[n].id&&t.CollectionList.splice(n,1);break;case 3:a=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?a-1:a+1,e.praiseFlag=!e.praiseFlag;break;case 4:for(a=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?a-1:a+1,e.collectionFlag=!e.collectionFlag,n=0;n<t.CollectionList.length;n++)i==t.CollectionList[n].id&&t.CollectionList.splice(n,1)}}},function(){w.showToast("网络错误！")})},t.viewTopic=function(e){c.go("circlePage",{circleId:e})},t.gotoqSearch=function(){c.go("qSearch")}}]),APP.service("heIssueService",["$http","UrlService",function(e,t){this.getMyIssue=function(o,s,i,a){return e({method:"post",url:t.getUrl("GET_USER_ISSUE_LIST"),data:{pageIndex:o,pageSize:s,userId:i,storyType:a}})},this.getMyStory=function(o,s,i){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyComment=function(o,s,i,a){return e({method:"post",url:t.getUrl("GET_MY_COMMENT_LIST"),data:{pageIndex:o,pageSize:s,userId:i,commentType:a}})},this.myCommentId="",this.getDaShang=function(o,s,i){return e({method:"post",url:t.getUrl("GET_UCTIP_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getCollection=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_JOINTOPIC_LIST"),data:{userCode:o}})},this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_CREATETOPIC_LIST"),data:{userCode:o}})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.SchoolPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.getUserPraise=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_PRAISE_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.filter("commentArrImg",function(){return function(e){return e.split(",")}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".padding_zero {\n  padding: 0;\n}\n\n.ionic_datepicker_popup .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_popup .padding_top_zero {\n  padding-top: 0;\n}\n.ionic_datepicker_popup .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_popup .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_popup .calendar_grid {\n  height: 215px;\n}\n.ionic_datepicker_popup .today {\n  border: 1px solid #009688;\n  border-radius: 50%;\n}\n.ionic_datepicker_popup .selected_date {\n  background-color: #009688;\n  border-radius: 50%;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_popup .popup-head {\n  background-color: #009688;\n  display: none;\n}\n.ionic_datepicker_popup .popup-head .popup-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-head .popup-sub-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body {\n  background-color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body .selected_date_full {\n  background-color: #019688;\n  margin: -10px -10px 0 -10px;\n  height: 45px;\n  text-align: center;\n  font-weight: bold;\n  color: #fff;\n  line-height: 45px;\n  font-size: 18px;\n}\n.ionic_datepicker_popup .popup-body .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_popup .popup-body .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_popup .popup-body .month_select, .ionic_datepicker_popup .popup-body .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select .input-label, .ionic_datepicker_popup .popup-body .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select select, .ionic_datepicker_popup .popup-body .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select:after, .ionic_datepicker_popup .popup-body .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-body .show_nav {\n  padding: 10px 0 0 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section {\n  padding: 5px 0;\n  text-align: left;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section {\n  padding: 5px 0;\n  text-align: right;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 45px;\n}\n.ionic_datepicker_popup .popup-buttons button {\n  background-color: #009688;\n  border-radius: 0;\n  margin-right: 1px;\n  color: #ffffff;\n}\n\n.ionic_datepicker_modal .header, .ionic_datepicker_modal .footer {\n  background-color: #009688;\n}\n.ionic_datepicker_modal .header .title, .ionic_datepicker_modal .header .button, .ionic_datepicker_modal .footer .title, .ionic_datepicker_modal .footer .button {\n  color: #ffffff;\n}\n.ionic_datepicker_modal .footer .button-block {\n  margin: 0;\n}\n.ionic_datepicker_modal .today {\n  border: 1px solid #009688;\n}\n.ionic_datepicker_modal .selected_date {\n  background-color: #009688;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_modal .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_modal .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_modal .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_modal .month_select, .ionic_datepicker_modal .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_modal .month_select .input-label, .ionic_datepicker_modal .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_modal .month_select select, .ionic_datepicker_modal .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0 10px;\n}\n.ionic_datepicker_modal .month_select:after, .ionic_datepicker_modal .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_modal .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_modal .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_modal .date_col {\n  height: 50px;\n  line-height: 50px;\n}\n.ionic_datepicker_modal .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_modal .font_22px {\n  font-size: 22px;\n}\n.platform-android .ionic_datepicker_modal .bar .title.title-left {\n  text-align: center;\n}\n.platform-android .ionic_datepicker_modal select {\n  left: 25%;\n}\n.platform-ios .ionic_datepicker_modal select {\n  left: 5%;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-modal.html",'<ion-modal-view class="ionic_datepicker_modal">\n  <ion-header-bar class="header">\n    <h1 class="title">{{selctedDateEpoch | date : mainObj.dateFormat}}</h1>\n  </ion-header-bar>\n  <ion-content class="ionic_datepicker_modal_content">\n    <div class="">\n      <div class="row text-center">\n        <div class="col col-10 left_arrow">\n          <button class="button-clear font_22px" ng-click="prevMonth()"\n                  ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n            <i class="icon ion-chevron-left"></i>\n          </button>\n        </div>\n        <div class="col col-80 text-center">\n          <div class="row select_section">\n            <div class="col-50 padding_right_5px">\n              <label class="item item-input item-select month_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n                  <option ng-repeat="month in monthsList" ng-selected="month == currentMonthSelected" value="{{month}}">\n                    {{month}}\n                  </option>\n                </select>\n              </label>\n            </div>\n            <div class="col-50 padding_left_5px">\n              <label class="item item-input item-select year_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class="col col-10 right_arrow">\n          <button class=" button-clear font_22px" ng-click="nextMonth()"\n                  ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n            <i class="icon ion-chevron-right"></i>\n          </button>\n        </div>\n      </div>\n      <div class="calendar_grid">\n        <div class="row padding-top weeks_row">\n          <div class="col text-center font_bold"\n               ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n        </div>\n        <div>\n          <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n            <div class="col padding_zero date_col" ng-repeat="col in cols track by $index"\n                 ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || (dayList[row + $index].disabled))}"\n                 ng-click="dateSelected(dayList[row + $index])">\n              <div class="date_cell">\n                {{dayList[row + col].date}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n  <ion-footer-bar class="footer">\n    <div class="row padding_zero">\n      <button class="button button-clear button-block button_set" ng-if="!mainObj.closeOnSelect"\n              ng-click="setIonicDatePickerDate()">{{mainObj.setLabel}}\n      </button>\n      <button class="button button-clear button-block button_today"  ng-if="mainObj.showTodayButton"\n              ng-click="setIonicDatePickerTodayDate()">{{mainObj.todayLabel}}\n      </button>\n      <button class="button button-clear button-block button_close"\n              ng-click="closeIonicDatePickerModal()">{{mainObj.closeLabel}}\n      </button>\n    </div>\n  </ion-footer-bar>\n</ion-modal-view>\n')}]),APP.run(["$templateCache",function(e){
e.put("ionic-datepicker-popup.html",'<div class="selected_date_full">{{selctedDateEpoch | date : mainObj.dateFormat}}</div>\n<div class="date_selection">\n  <div class="row show_nav">\n    <div class="col-10 prev_btn_section">\n      <button class="button-clear" ng-click="prevMonth()"\n              ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n        <i class="icon ion-chevron-left"></i>\n      </button>\n    </div>\n    <div class="col-80 text-center">\n      <div class="row select_section">\n        <div class="col-50 padding_right_5px">\n          <label class="item item-input item-select month_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n              <option ng-repeat="month in monthsList" ng-selected="month==currentMonthSelected" value="{{month}}">\n                {{month}}\n              </option>\n            </select>\n          </label>\n        </div>\n        <div class="col-50 padding_left_5px">\n          <label class="item item-input item-select year_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n          </label>\n        </div>\n      </div>\n    </div>\n    <div class="col-10 next_btn_section">\n      <button class="button-clear" ng-click="nextMonth()"\n              ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n        <i class="icon ion-chevron-right"></i>\n      </button>\n    </div>\n  </div>\n  <div class="calendar_grid">\n    <div class="row weeks_row">\n      <div class="col text-center font_bold"\n           ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n    </div>\n    <div>\n      <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n        <div class="col no_padding date_col" ng-repeat="col in cols track by $index"\n             ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || dayList[row + $index].disabled)}"\n             ng-click="dateSelected(dayList[row + $index])">\n          <div class="date_cell">\n            {{dayList[row + col].date}}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),APP.provider("ionicDatePicker2",function(){var e={inputDate:new Date,from:new Date(2012,8,1),to:new Date(2018,8,1),setLabel:"确定",todayLabel:"今天",closeLabel:"关闭",mondayFirst:!0,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],templateType:"popup",dateFormat:"yyyy-MM-dd",showTodayButton:!1,closeOnSelect:!1,disableWeekdays:[]};this.configDatePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup","$ionicModal","IonicDatepickerService2",function(t,o,s,i){function a(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function n(e){e.disabledDates&&0!==e.disabledDates.length?(u.disabledDates=[],angular.forEach(e.disabledDates,function(e,t){e=a(new Date(e)),u.disabledDates.push(e.getTime())})):u.disabledDates=[]}function r(e){e=a(e),u.currentDate=angular.copy(e);var t=new Date(e.getFullYear(),e.getMonth(),1).getDate(),o=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();u.monthsList=[],u.mainObj.monthsList&&12===u.mainObj.monthsList.length?u.monthsList=u.mainObj.monthsList:u.monthsList=i.monthsList,u.yearsList=i.getYearsList(u.mainObj.from,u.mainObj.to),u.dayList=[];var s,n;u.firstDayEpoch=a(new Date(e.getFullYear(),e.getMonth(),t)).getTime(),u.lastDayEpoch=a(new Date(e.getFullYear(),e.getMonth(),o)).getTime();for(var r=t;r<=o;r++)s=new Date(e.getFullYear(),e.getMonth(),r),n=s.getTime()<u.fromDate||s.getTime()>u.toDate||u.mainObj.disableWeekdays.indexOf(s.getDay())>=0,u.dayList.push({date:s.getDate(),month:s.getMonth(),year:s.getFullYear(),day:s.getDay(),epoch:s.getTime(),disabled:n});var c=u.dayList[0].day-u.mainObj.mondayFirst;c=c<0?6:c;for(var l=0;l<c;l++)u.dayList.unshift({});u.rows=[0,7,14,21,28,35],u.cols=[0,1,2,3,4,5,6],u.currentMonth=u.mainObj.monthsList[e.getMonth()],u.currentYear=e.getFullYear(),u.currentMonthSelected=angular.copy(u.currentMonth),u.currentYearSelected=angular.copy(u.currentYear),u.numColumns=7}function c(e){u.mainObj=angular.copy(e),u.selctedDateEpoch=a(u.mainObj.inputDate).getTime(),u.mainObj.weeksList&&7===u.mainObj.weeksList.length?u.weeksList=u.mainObj.weeksList:u.weeksList=["S","M","T","W","T","F","S"],u.mainObj.mondayFirst&&u.weeksList.push(u.mainObj.weeksList.shift()),u.disableWeekdays=u.mainObj.disableWeekdays,r(u.mainObj.inputDate),n(u.mainObj)}function l(){u.modal.show()}function d(){u.modal.hide()}var p={},u=t.$new();return u.today=a(new Date).getTime(),u.disabledDates=[],u.prevMonth=function(){1===u.currentDate.getMonth()&&u.currentDate.setFullYear(u.currentDate.getFullYear()),u.currentDate.setMonth(u.currentDate.getMonth()-1),u.currentMonth=u.mainObj.monthsList[u.currentDate.getMonth()],u.currentYear=u.currentDate.getFullYear(),r(u.currentDate)},u.nextMonth=function(){11===u.currentDate.getMonth()&&u.currentDate.setFullYear(u.currentDate.getFullYear()),u.currentDate.setDate(1),u.currentDate.setMonth(u.currentDate.getMonth()+1),u.currentMonth=u.mainObj.monthsList[u.currentDate.getMonth()],u.currentYear=u.currentDate.getFullYear(),r(u.currentDate)},u.dateSelected=function(e){e&&0!==Object.keys(e).length&&(u.selctedDateEpoch=e.epoch,u.mainObj.closeOnSelect&&(u.mainObj.callback(u.selctedDateEpoch),"popup"==u.mainObj.templateType.toLowerCase()?u.popup.close():d()))},u.setIonicDatePickerTodayDate=function(){var e=new Date;r(new Date),u.selctedDateEpoch=a(e).getTime(),u.mainObj.closeOnSelect&&(u.mainObj.callback(u.selctedDateEpoch),d())},u.setIonicDatePickerDate=function(){u.mainObj.callback(u.selctedDateEpoch),d()},u.monthChanged=function(e){var t=u.monthsList.indexOf(e);u.currentDate.setMonth(t),r(u.currentDate)},u.yearChanged=function(e){u.currentDate.setFullYear(e),r(u.currentDate)},s.fromTemplateUrl("ionic-datepicker-modal.html",{scope:u,animation:"slide-in-up"}).then(function(e){u.modal=e}),u.$on("$destroy",function(){u.modal.remove()}),u.closeIonicDatePickerModal=function(){d()},p.openDatePicker=function(t){var s=[];delete u.fromDate,delete u.toDate,u.mainObj=angular.extend({},e,t),u.mainObj.from&&(u.fromDate=a(new Date(u.mainObj.from)).getTime()),u.mainObj.to&&(u.toDate=a(new Date(u.mainObj.to)).getTime()),t.disableWeekdays&&e.disableWeekdays&&(u.mainObj.disableWeekdays=t.disableWeekdays.concat(e.disableWeekdays)),c(u.mainObj),u.mainObj.closeOnSelect||(s=[{text:u.mainObj.setLabel,type:"button_set",onTap:function(e){u.mainObj.callback(u.selctedDateEpoch)}}]),u.mainObj.showTodayButton&&s.push({text:u.mainObj.todayLabel,type:"button_today",onTap:function(e){var t=new Date;r(new Date),u.selctedDateEpoch=a(t).getTime(),u.mainObj.closeOnSelect||e.preventDefault()}}),s.push({text:u.mainObj.closeLabel,type:"button_close",onTap:function(e){}}),"popup"==u.mainObj.templateType.toLowerCase()?(u.currentYear=(new Date).getFullYear(),u.popup=o.show({templateUrl:"ionic-datepicker-popup.html",scope:u,cssClass:"ionic_datepicker_popup",buttons:s})):l()},p}]}),APP.service("IonicDatepickerService2",function(){this.monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"],this.getYearsList=function(e,t){var o=[],s=1900,i=2100;s=e?new Date(e).getFullYear():s,i=t?new Date(t).getFullYear():i;for(var a=s;a<=i;a++)o.push(a);return o}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".ionic_timepicker_popup .font_28px {\n  font-size: 28px;\n}\n.ionic_timepicker_popup .margin_zero {\n  margin: 0;\n}\n.ionic_timepicker_popup .padding_zero {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup {\n  background-color: #ffffff;\n}\n.ionic_timepicker_popup .popup-head {\n  display: none;\n}\n.ionic_timepicker_popup .popup-body {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 44px;\n  height: 44px;\n}\n.ionic_timepicker_popup .popup-buttons .button:not(:last-child) {\n  margin-right: 1px;\n}\n.ionic_timepicker_popup .padding_left_15px {\n  padding-left: 15px;\n}\n.ionic_timepicker_popup .heading {\n  height: 44px;\n  background-color: #009688;\n  color: #ffffff;\n  text-align: center;\n  line-height: 44px;\n  font-size: 18px;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_colon {\n  padding-top: 45px;\n  text-align: center;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_arrows {\n  width: 100%;\n}\n.ionic_timepicker_popup .time_picker_box_text {\n  height: 40px;\n  text-align: center;\n  border: 1px solid #dddddd;\n  font-size: 16px;\n  line-height: 38px;\n}\n.ionic_timepicker_popup .overflowShow {\n  white-space: normal !important;\n}\n.ionic_timepicker_popup .button_set, .ionic_timepicker_popup .button_close {\n  background-color: #009688;\n  color: #ffffff;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-timepicker.html",'<div><div class=heading>{{time.hours}} : {{time.minutes}} <span ng-show="time.format == 12">{{time.meridian}}</span></div><div class=row ng-class="{\'padding_left_15px\':time.format == 12}"><div class="col col-25" ng-class="{\'col-offset-20 col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseHours()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.hours class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseHours()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon">:</label><div class="col col-25" ng-class="{\'col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseMinutes()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.minutes class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseMinutes()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon" ng-if="time.format == 12">:</label><div class="col col-25" ng-if="time.format == 12"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.meridian class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-down"></i></button></div></div></div>')}]),APP.provider("ionicTimePicker",function(){var e={setLabel:"确定",closeLabel:"关闭",inputTime:60*(new Date).getHours()*60+60*(new Date).getMinutes(),format:24,step:1};this.configTimePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup",function(t,o){function s(e,t){a.time.hours=Math.floor(e/3600);var o=e%3600;12==t&&(a.time.hours>12?(a.time.hours-=12,a.time.meridian="PM"):a.time.meridian="AM"),a.time.minutes=o/60,a.time.hours=a.time.hours.toFixed(0),a.time.minutes=a.time.minutes.toFixed(0),1==a.time.hours.toString().length&&(a.time.hours="0"+a.time.hours),1==a.time.minutes.toString().length&&(a.time.minutes="0"+a.time.minutes),a.time.format=a.mainObj.format}var i={},a=t.$new();return a.today=function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}(new Date).getTime(),a.time={},a.increaseHours=function(){a.time.hours=Number(a.time.hours),12==a.mainObj.format&&(12!=a.time.hours?a.time.hours+=1:a.time.hours=1),24==a.mainObj.format&&(a.time.hours=(a.time.hours+1)%24),a.time.hours=a.time.hours<10?"0"+a.time.hours:a.time.hours},a.decreaseHours=function(){a.time.hours=Number(a.time.hours),12==a.mainObj.format&&(a.time.hours>1?a.time.hours-=1:a.time.hours=12),24==a.mainObj.format&&(a.time.hours=(a.time.hours+23)%24),a.time.hours=a.time.hours<10?"0"+a.time.hours:a.time.hours},a.increaseMinutes=function(){a.time.minutes=Number(a.time.minutes),a.time.minutes=(a.time.minutes+a.mainObj.step)%60,a.time.minutes=a.time.minutes<10?"0"+a.time.minutes:a.time.minutes},a.decreaseMinutes=function(){a.time.minutes=Number(a.time.minutes),a.time.minutes=(a.time.minutes+(60-a.mainObj.step))%60,a.time.minutes=a.time.minutes<10?"0"+a.time.minutes:a.time.minutes},a.changeMeridian=function(){a.time.meridian="AM"===a.time.meridian?"PM":"AM"},i.openTimePicker=function(t){var i=[];a.mainObj=angular.extend({},e,t),s(a.mainObj.inputTime,a.mainObj.format),i.push({text:a.mainObj.setLabel,type:"button_set",onTap:function(e){var t=0;12==a.time.format?(a.time.hours=Number(a.time.hours),"PM"==a.time.meridian&&12!=a.time.hours?a.time.hours+=12:"AM"==a.time.meridian&&12==a.time.hours&&(a.time.hours-=12),t=60*a.time.hours*60+60*a.time.minutes):t=60*a.time.hours*60+60*a.time.minutes,a.mainObj.callback(t)}}),i.push({text:a.mainObj.closeLabel,type:"button_close"}),a.popup=o.show({templateUrl:"ionic-timepicker.html",scope:a,cssClass:"ionic_timepicker_popup",buttons:i})},i}]}),APP.controller("manageUserController",["$scope","$state","$stateParams","manageUserService","$ionicScrollDelegate","PopupService","anchorScroll","$ionicPopup",function(e,t,o,s,i,a,n,r){e.mainuserlist="",e.userlist="",e.topicId="",e.aList=[],e.isShut=[],e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.selectUser=function(t){for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].id==t.id&&("img/ic_select.png"==e.mainuser2list[o].ischeck?e.mainuser2list[o].ischeck="img/ic_check.png":e.mainuser2list[o].ischeck="img/ic_select.png");for(var s=0;s<e.userlist.length;s++)t.id==e.userlist[s].id&&("img/ic_select.png"==e.userlist[s].ischeck?(e.userlist[s].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[s].ischeck="img/ic_select.png",e.userCode=t.userCode))},e.allDo=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}else if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}},e.noSpeak=function(){for(var t=0;t<e.userlist.length;t++)"img/ic_select.png"==e.userlist[t].ischeck&&(e.isShut.push(e.userlist[t].isgag),e.manageList.push(e.userlist[t].userCode));if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var o=0;o<e.mainuser2list.length;o++)"img/ic_select.png"==e.mainuser2list[o].ischeck&&(e.isShut.push(e.mainuser2list[o].isgag),e.manageList.push(e.mainuser2list[o].userCode));if(e.manageList.length>0){for(var s=e.manageList.join(","),i={topicId:e.topicId,userCode:s,isGag:1},n=0;n<e.isShut.length;n++)1==e.isShut[n]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(i)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else e.yesno&&!e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,a.showToast("已选对象为禁言者，无需禁言")):e.ok(i)}else a.showToast("您还没有选择任何成员")},e.release=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&(e.isShut.push(e.mainuser2list[t].isgag),e.manageList.push(e.mainuser2list[t].userCode));for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&(e.isShut.push(e.userlist[o].isgag),e.manageList.push(e.userlist[o].userCode));if(e.manageList.length>0){for(var s=e.manageList.join(","),i={topicId:e.topicId,userCode:s,isGag:0},n=0;n<e.isShut.length;n++)1==e.isShut[n]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部解除禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(i)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else!e.yesno&&e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,a.showToast("已选对象为非禁言者，无需解除")):e.ok(i)}else a.showToast("您还没有选择任何成员")},e.ok=function(t){s.manageUser(t).success(function(t){e.allcheck="img/ic_check.png",e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,e.getallList()}).error(function(){})},e.yes=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&e.manageList.push(e.mainuser2list[t].userCode);for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&e.manageList.push(e.userlist[o].userCode);if(e.manageList.length>0){var i=e.manageList.join(","),n={topicId:e.topicId,userCodeS:i,isAll:0};s.delectUser(n).success(function(t){t.success?(e.getallList(),a.showToast("删除成功")):a.showToast(t.message)}).error(function(){})}else a.showToast("您还没有选择任何成员")},e.search=function(t){var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var n=0;n<e.userlist.length;n++)"#"==e.userlist[n].categoryName&&(e.userlist[n].categoryName="toOther");for(var r=0;r<e.mainuser2list.length;r++)e.mainuser2list[r].ischeck="img/ic_check.png";for(var n=0;n<e.userlist.length;n++)e.userlist[n].ischeck="img/ic_check.png";i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.getallList=function(){var t={topicId:e.topicId,pageSize:20,pageIndex:1};s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].ischeck="img/ic_check.png";for(var s=0;s<e.userlist.length;s++)e.userlist[s].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var s=e.userlist.length;e.hasmore=!(s===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.hasmore=!1,e.yesno=!1,e.noyes=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.isShut=[],e.allcheck="img/ic_check.png",e.userCode="",e.manageList=[],e.pageIndex=1,e.input={isinput:""},e.getallList()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("manageUserService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.manageUser=function(o){return e.post(t.getUrl("CIRCLE_MANAGE_USER"),o)},this.delectUser=function(o){return e.post(t.getUrl("CIRCLE_DELECT_USER"),o)}}]),APP.controller("moreInterestingCtrl",["$scope","$state","$timeout","PopupService","myFansService",function(e,t,o,s,i){e.myInterested={pageIndex:0,pageSize:8,interestedList:[],hasMore:!0,api:function(e,t){return i.getMyInterested(e,t)}},e.init=function(){e.myInterested.hasMore=!0,e.myInterested.pageIndex=0,e.myInterested.interestedList=[],e.loadData(e.myInterested,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(t,i){void 0==i&&(i=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(s){o(function(){1==s.success&&(t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.interestedList=t.interestedList.concat(s.data.list),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络错误！")})},e.followI=function(t,a){var n=a?1:0;i.follow(t.memberId,n).success(function(s){if(1==s.success)for(var i=0;i<e.myInterested.interestedList.length;i++)t.memberId==e.myInterested.interestedList[i].memberId&&(e.myInterested.interestedList.splice(i,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3))}).error(function(){s.showToast("网络错误！")})},e.viewHim=function(e){t.go("personalHomepageHe",{othersId:e})}}]),APP.controller("myFansCtrl",["$scope","$timeout","$state","PopupService","myFansService",function(e,t,o,s,i){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFansData={pageIndex:0,pageSize:6,myFans:[],hasMore:!0,api:function(e,t){return i.getMyFans(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFansData.pageIndex=0,e.myFansData.myFans=[],e.myFansData.hasMore=!0,i.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){s.showToast("网络错误！")}),e.loadData(e.myFansData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(o,i){void 0==i&&(i=1e3),o.pageIndex=o.pageIndex+1,o.api(o.pageIndex,o.pageSize).success(function(s){t(function(){1==s.success&&(o.hasMore=o.pageIndex*o.pageSize<s.totalCount,o.myFans=o.myFans.concat(s.data.list),e.nothing=!o.myFans.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络错误！")})},e.followI=function(o,a){var n=a?1:0;i.follow(o.memberId,n).success(function(s){if(1==s.success){for(var i=0;i<e.interested.length;i++)o.memberId==e.interested[i].memberId&&e.interested.splice(i,1);a&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}}).error(function(){s.showToast("网络错误！")})},e.followF=function(o,a){var n=a?1:0,r=o.followId?o.followId:o.memberId;i.follow(r,n).success(function(o){o.success,a&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}).error(function(){s.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){o.go("moreInteresting")},e.jumpMsg=function(){o.go("messageCenter")},e.viewHim=function(e){e.followId?o.go("personalHomepageHe",{othersId:e.followId}):o.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFansService",["$http","UrlService",function(e,t){this.getMyFans=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("MY_FANS"),data:i})},this.getMyInterested=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("INTERESTED"),data:i})},this.follow=function(o,s){var i={id:o,isFollow:s};return e({method:"post",url:t.getUrl("FOLLOW"),data:i})}}]),APP.controller("myFollowCtrl",["$scope","$rootScope","$timeout","$state","PopupService","myFollowService","myFansService",function(e,t,o,s,i,a,n){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFollowsData={pageIndex:0,pageSize:6,myFollows:[],hasMore:!0,api:function(e,t){return a.getMyFollows(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFollowsData.pageIndex=0,e.myFollowsData.myFollows=[],e.myFollowsData.hasMore=!0,n.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){i.showToast("网络错误！")}),e.loadFollowData(e.myFollowsData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadFollowData=function(t,s){void 0==s&&(s=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(i){o(function(){1==i.success&&(t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.myFollows=t.myFollows.concat(i.data.list),e.nothing=!t.myFollows.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络失败！")})},e.followI=function(t,s){var a=s?1:0;n.follow(t.memberId,a).success(function(s){if(1==s.success){for(var i=0;i<e.interested.length;i++)t.memberId==e.interested[i].memberId&&(e.interested.splice(i,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3));e.nothing=!1,t.isFollow=!t.isFollow,t.followId=t.memberId,e.myFollowsData.myFollows.push(t)}}).error(function(){i.showToast("网络失败！")})},e.followF=function(t,o){var s=o?1:0,a=t.followId?t.followId:t.memberId;n.follow(a,s).success(function(t){if(1==t.success)for(var o=0;o<e.myFollowsData.myFollows.length;o++)a==e.myFollowsData.myFollows[o].followId&&(e.myFollowsData.myFollows.splice(o,1),e.myFollowsData.myFollows.length||(e.nothing=!0))}).error(function(){i.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){s.go("moreInteresting")},e.jumpMsg=function(){s.go("messageCenter")},e.viewHim=function(e){e.followId?s.go("personalHomepageHe",{othersId:e.followId}):s.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFollowService",["$http","UrlService",function(e,t){this.getMyFollows=function(o,s){var i={pageIndex:o,pageSize:s};return e({method:"post",url:t.getUrl("MY_FOLLOWS"),data:i})}}]),APP.controller("mySettingsCtrl",["$scope","$state","$ionicPopup","mySettingsService","personalHomepageMeService","NoteDetailsService",function(e,t,o,s,i,a){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.myInfo={},e.data={},e.userId="",e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.creditDetails=function(){t.go("shop")},e.viewCredit=function(){t.go("quanziRecommend")},e.init=function(){e.userId="1",e.isDisplay=!1,i.getUserData("2",e.userId).success(function(t,o,s,i){1==t.success&&(e.myInfo=t.data)}).error(function(e,t,o,s){alert("网络失败！")})},e.apply=function(){window.alert("接口还没出来，你申请也没用，略略略……")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("mySettingsService",function(){}),APP.controller("personalHomepageHeCtrl",["HomePageService","heIssueService","$scope","$http","$rootScope","NoteDetailsService","$state","$timeout","$interval","$stateParams","$window","$location","$ionicScrollDelegate","UserService","PopupService","personalHomepageHeService","personalHomepageMeService","myFansService","communityRecommendService","UrlService","CreditService",function(HomePageService,heIssueService,$scope,$http,$rootScope,NoteDetailsService,$state,$timeout,$interval,$stateParams,$window,$location,$ionicScrollDelegate,UserService,PopupService,personalHomepageHeService,personalHomepageMeService,myFansService,communityRecommendService,UrlService,CreditService){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.contentHeight={height:"296px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.contentHeight={height:"280px"}),$scope.gotoPriLetter=function(){$state.go("privateLetter",{userCode:$scope.othersId})},$scope.user=void 0,$scope.messageNum=void 0,$scope.ifRed=void 0,$scope.isDisplay=void 0,$scope.othersId="",$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.shopList=[],$scope.shareType=void 0,$scope.byShareLink=void 0,$scope.provinceId="",$scope.cityId="",$scope.regionId="",$scope.streetId="",$scope.showShare=!1,$scope.hisStory={nums:-1,pageIndex:0,pageSize:6,storyList:[],hasMore:!0,api:function(e,t,o){return personalHomepageMeService.getMyStory(e,t,o)}},$scope.hisShare={nums:-1,pageIndex:0,pageSize:6,shareList:[],hasMore:!0,api:function(e,t,o){return personalHomepageHeService.hisShare(e,t,o)}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.init=function(tab){switch(personalHomepageHeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId}),$scope.user=UserService.getUser(),$scope.othersId=$stateParams.othersId,$scope.isDisplay=!1,$scope.byShareLink=!$rootScope.isApp,$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,$scope.tabNav="personalHomePageHe",$scope.hisLists=[{title:"dashang",icon:$rootScope.imgBaseURL+"img/homepage/dashang@2x.png",text:"TA的打赏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:$rootScope.imgBaseURL+"img/homepage/zan@2x.png",text:"TA的赞",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:$rootScope.imgBaseURL+"img/homepage/Shape@2x.png",text:"TA的收藏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"}],tab){case 0:$scope.getShopList();break;case 1:$scope.getHisStory();break;case 2:$scope.getHisShare()}personalHomepageHeService.hisShare(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisShare.nums=e.data.totalCount)}),personalHomepageMeService.getMyStory(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisStory.nums=e.data.totalCount)})},$scope.$on("$ionicView.beforeEnter",function(e,t){"forward"==t.direction||"exit"==t.direction||"none"==t.direction?$scope.init(0):"back"==t.direction&&($scope.isDisplay=!1,$scope.downRefresh($scope.selectedIndex))}),$scope.downRefresh=function(e){switch(e){case 0:$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.getShopList();break;case 1:$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisStory();break;case 2:$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisShare()}$scope.$broadcast("scroll.refreshComplete")},$scope.getShopList=function(){$scope.selectedIndex=0,$scope.hisInfo||(personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){if(1==e.success){if($scope.hisInfo=e.data,e.data.storeGride)if($scope.levelArray=[],
e.data.storeGride<=3)for(var t=0;t<e.data.storeGride;t++)$scope.levelArray.push("img/StarLevel@2x.png");else for(var t=0;t<e.data.storeGride-3;t++)$scope.levelArray.push("img/DiamondLevel@2x.png");$scope.hisInfo.isStore&&$scope.shop}}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}))},$scope.loadGoods=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisGoods.goodsList=[]),e.api($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.data.storeItemsCounts,e.hasMore=e.pageIndex*e.pageSize<o.data.storeItemsCounts,e.goodsList=e.goodsList.concat(o.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisStory=function(){$scope.selectedIndex=1,$scope.hisStory.storyList||$scope.loadHisStory($scope.hisStory,0)},$scope.loadHisStory=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisStory.storyList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.storyList=e.storyList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisShare=function(){$scope.selectedIndex=2,$scope.hisShare.shareList||$scope.loadShare($scope.hisShare,0)},$scope.loadShare=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisShare.shareList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.shareList=e.shareList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.downloadSg=function(){var e=$rootScope.isIOS?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":"http://app.qq.com/#id=detail&appid=1104761357";$window.location.assign(e)},$scope.hideDownload=function(){$scope.byShareLink=!1},$scope.show=function(){$scope.isDisplay=!$scope.isDisplay},$scope.disappear=function(){$scope.isDisplay=!1},$scope.dealStory=function(e,t){var o=e.storyTopicId?e.storyTopicId:e.id;personalHomepageHeService.dealStory(o,t).then(function(o){if(1==o.data.success){var s;switch(t){case 1:s=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?s-1:s+1,e.praiseFlag=!e.praiseFlag;break;case 2:s=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?s-1:s+1,e.collectionFlag=!e.collectionFlag;break;case 3:s=parseInt(e.praiseNumber1),e.praiseNumber1=e.praiseFlag1?s-1:s+1,e.praiseFlag1=!e.praiseFlag1;break;case 4:s=parseInt(e.collectionNumber1),e.collectionNumber1=e.collectionFlag1?s-1:s+1,e.collectionFlag1=!e.collectionFlag1}}else PopupService.showToast(o.data.message)},function(){PopupService.showToast("网络错误！")})},$scope.follow=function(e){HomePageService.isWdHost().success(function(t){if($rootScope.isWdHost=t.data.isHost,-1==$rootScope.isWdHost)$state.go("login");else if(0==e){var o={id:$stateParams.othersId,isFollow:1};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.isFollow=1,$scope.hisInfo.praise+=1,$scope.alreadyFollow=!0,$timeout(function(){$scope.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}else if(1==e){var o={id:$stateParams.othersId,isFollow:0};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.praise-=1,$scope.hisInfo.isFollow=0):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}})},$scope.ToIssue=function(e,t,o){"issue"==e&&heIssueService.getMyIssue(1,5,o,0).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"comment"==e&&heIssueService.getMyComment(1,5,o,0).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"quanzi"==e&&heIssueService.getMyJoinedTopics(o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"dashang"==e&&heIssueService.getDaShang(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"zan"==e&&heIssueService.getUserPraise(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"shoucang"==e&&heIssueService.getCollection(1,5,o).success(function(s){-2e3==s.errorCode?(PopupService.showToast(s.message),$rootScope.loginIsAccord2=!0):1==s.success&&$state.go("heIssue",{title:e,who:t,id:o})})},$scope.joinTopic=function(e){var t=e.storyTopicId;communityRecommendService.joinTopic(t).then(function(t){1==t.data.success?e.topicFocusFlag=!0:-2e3==t.errorCode&&(PopupService.showToast(t.data.message),$rootScope.loginIsAccord2=!0)},function(){PopupService.showToast("网络错误")})},$scope.addToCart=function(e){var t={productId:e,number:1,o2oStoreName:"",o2omap:e+","};personalHomepageHeService.toCart(t).then(function(e){1==e.data.success?PopupService.showToast("加入购物车成功"):PopupService.showToast(e.data.message)},function(e){PopupService.showToast(e)})},$scope.viewHim=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.toProductDetails=function(e){$state.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId})},$scope.viewShop=function(){window.cordova&&$rootScope.gio.evar.set({source:"Community",value:$scope.shop?$scope.shop.storeId:$stateParams.othersId}),$state.go("myStore",{storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId,shareStoreId:""})},$scope.jumpMsg=function(){$state.go("messageCenter")},$scope.viewStory=function(e){var t=e.storyTopicId?e.storyTopicId:e.id;2!==e.flag?$state.go("noteDetails",{noteId:t,isShortStory:e.isShortStory}):$state.go("classNoteDetails",{noteId:t})},$scope.viewTopic=function(e){$state.go("circlePage",{circleId:e})},$scope.share=function(e){if(window.umeng){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.shareType=e}else alert("只能在app分享,请下载app！")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e,t){var o,s,i,a;t?$scope.shop&&(o=($scope.shop.storeName?$scope.shop.storeName:"他")+"的顺逛小店",s="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=UrlService.getShareLinkHeader()+"myStore/"+$scope.shop.storeId+"/"+$scope.shop.storeId+"/"):(o=($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的空间",s="欢迎关注"+($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=UrlService.getShareLinkHeader()+"personalHomePageHe/"+$scope.hisInfo.memberId),window.umeng?0==e?window.umeng.shareToSina(o,s,i,a,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,CreditService.shareSuccessCallback):3==e?window.umeng.shareToQQ(o,s,i,a,0,null,CreditService.shareSuccessCallback):4==e?window.umeng.shareToQzone(o,s,i,a,0,null,CreditService.shareSuccessCallback):5==e&&$scope.copeText(a):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("personalHomepageHeService",["$http","UrlService",function(e,t){this.hisShare=function(o,s,i){var a={pageIndex:o,pageSize:s,userCode:i};return e({method:"post",url:t.getUrl("HIS_SHARE"),data:a})},this.toCart=function(o){var s={productId:o.productId,number:o.number,o2oStoreName:o.o2oStoreName,o2omap:o.o2omap};return e({method:"get",url:t.getUrl("SHOP_ADD_CART"),params:s})},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.dealStory=function(o,s){var i,a={id:o,noLoading:!0};switch(s){case 1:i="COMMENT_PRAISE";break;case 2:i="COLLECTION_TOPIC";break;case 3:i="SCHOOLPRAISESTORY";break;case 4:i="SCHOOLCOLLECTION"}return e({method:"post",url:t.getUrl(i),data:a})}}]),APP.controller("personalHomepageMeCtrl",["$scope","heIssueService","myFollowService","myFansService","$rootScope","$state","$timeout","$interval","$ionicScrollDelegate","PopupService","UserService","personalHomepageMeService","UrlService","personalHomepageHeService","$ionicModal","CreditService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.contentHeight={height:"296px"}):(e.paddingtopClass={"margin-top":"0px"},e.contentHeight={height:"280px"}),e.goBackTo=function(){e.$ionicGoBack()},e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.userId="",e.user=void 0,e.userData={},e.data=[],e.story=void 0,e.selectedIndex=void 0,e.notApply=void 0,e.teachedList="",e.joinedList="",e.showShare=!1,e.myTopics=void 0,e.noTopic=!1,e.myStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return p.getMyStory(e,t)}},e.myCollectionStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return p.getMyCollection(e,t)}},e.init=function(t){e.tabNav="personalHomepageMe",e.hisLists=[{title:"dashang",icon:i.imgBaseURL+"img/homepage/dashang@2x.png",text:"我的打赏",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:i.imgBaseURL+"img/homepage/zan@2x.png",text:"我的赞",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:i.imgBaseURL+"img/homepage/Shape@2x.png",text:"我的收藏",nums:"0",goIcon:i.imgBaseURL+"img/homepage/go2@2x.png"}],m.fromTemplateUrl("templates/quanzi/ApplyTeacherModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyTeacherModal=t}),e.myTopics=void 0,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.notApply=!0,e.isDisplay=!1,e.data=[],e.selectedIndex=void 0,e.user=d.getUser(),e.userId=d.getUser().mid,p.getUserData1("2",e.userId).success(function(t){if(e.userData1=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(i.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(i.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),p.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),p.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),p.getMyCollection(1,0).then(function(t){1==t.data.success&&(e.myCollectionStory.nums=t.data.totalCount)}),e.$broadcast("scroll.refreshComplete")},e.showApplyModal=function(){p.startApply().success(function(t){t.success?0==t.data.applyStatus?e.data.isApply=!0:1==t.data.applyStatus?(e.message=t.message,e.applyStatus=1,e.applyTeacherModal.show()):(e.introduce=t.data.introduce,e.message=t.message,e.applyStatus=2,e.applyTeacherModal.show()):e.data.isApply=!1},function(e){})},e.hideApplyModal=function(){delete e.applyStatus,e.applyTeacherModal.hide()},e.jumpMyCircle=function(){a.go("myCirclePages")},e.applyStatus3=function(){e.hideApplyModal(),n(function(){e.applyStatus=3,e.applyTeacherModal.show()},500)},e.editApply=function(){e.hideApplyModal(),e.data.isApply=!0},e.getTeachedList=function(){var t={pageSize:10,pageIndex:1};p.teachedLessones(t).success(function(t){e.teachedList=t.data.list}).error(function(){})},e.getJoinededList=function(){var t={pageSize:10,pageIndex:1};p.joinedLessones(t).success(function(t){e.joinedList=t.data.list,e.classesCount=t.data}).error(function(){})},e.selectTab=function(t){switch(e.selectedIndex=t,t){case 0:e.myCollectionStory.storyList||e.loadData(e.myCollectionStory,0),n(function(){e.story=e.myCollectionStory},0);break;case 1:e.myStory.storyList||e.loadData(e.myStory,0),e.story=e.myStory;break;case 2:e.myTopics||p.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}n(function(){c.resize()},200)},e.loadData=function(t,o){null!=o&&void 0!=o||(o=1e3),t.pageIndex=t.pageIndex+1,1==t.pageIndex&&(t.storyList=[]),t.api(t.pageIndex,t.pageSize).success(function(s){n(function(){1==s.success&&(t.nums=s.totalCount,t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.storyList=t.storyList.concat(s.data.list),e.$broadcast("scroll.infiniteScrollComplete"))},o)}).error(function(){alert("网络失败！")})},e.$on("$ionicView.beforeEnter",function(t,o){"forward"==o.direction||"exit"==o.direction||"none"==o.direction?e.init(1):"back"==o.direction&&(e.isDisplay=!1,e.downRefresh(e.selectedIndex))}),e.downRefresh=function(t){switch(p.getUserData1("2",e.userId).success(function(t){if(e.userData=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(i.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(i.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),p.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),p.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),t){case 0:e.selectedIndex=0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.loadData(e.myCollectionStory,0);break;case 1:e.selectedIndex=1,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.loadData(e.myStory,0);break;case 2:e.selectedIndex=2,e.myTopics=void 0,p.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}e.$broadcast("scroll.refreshComplete")},e.noFind=function(){e.userData.img="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/user.jpg"},e.apply=function(t){var o={introduce:t,status:2==e.applyStatus?1:0};if(t)p.apply(o).then(function(t){1==t.data.success?(e.notApply=!1,l.showToast("申请已提交，等待审核……"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){});else if(3==e.applyStatus){var o={introduce:t,status:2};p.apply(o).then(function(t){1==t.data.success?(e.hideApplyModal(),e.introduce="",e.notApply=!1,l.showToast("申请已放弃"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){})}else l.showToast("申请描述不能为空，请填写……")},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.dealStory=function(t,o){var s;s=2!==t.flag?o:1==o?3:4;var i=t.storyTopicId?t.storyTopicId:t.id;g.dealStory(i,s).then(function(o){if(1==o.data.success){var a;switch(s){case 1:a=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?a-1:a+1,t.praiseFlag=!t.praiseFlag;break;case 2:if(a=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?a-1:a+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(var n=0;n<e.myCollectionStory.storyList.length;n++)i==e.myCollectionStory.storyList[n].id&&(e.myCollectionStory.storyList.splice(n,1),e.myCollectionStory.nums--);break;case 3:a=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?a-1:a+1,t.praiseFlag=!t.praiseFlag;break;case 4:if(a=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?a-1:a+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(n=0;n<e.myCollectionStory.storyList.length;n++)i==e.myCollectionStory.storyList[n].id&&(e.myCollectionStory.storyList.splice(n,1),e.myCollectionStory.nums--)}}},function(){l.showToast("网络错误！")})},e.ToMyIssue=function(e,o,s){"issue"==e&&t.getMyIssue(1,5,s,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"comment"==e&&t.getMyComment(1,5,s,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"quanzi"==e&&t.getMyJoinedTopics(s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"dashang"==e&&t.getDaShang(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"zan"==e&&t.getUserPraise(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})}),"shoucang"==e&&t.getCollection(1,5,s).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),i.loginIsAccord2=!0):1==t.success&&a.go("heIssue",{title:e,who:o,id:s})})},e.settings=function(){a.go("mySettings")},e.fans=function(){s.getMyFans(1,6).success(function(e){1==e.success?a.go("myFans"):-2e3==e.errorCode&&(l.showToast(e.message),i.loginIsAccord2=!0)})},e.follows=function(){o.getMyFollows(1,6).success(function(e){1==e.success?a.go("myFollow"):-2e3==e.errorCode&&(l.showToast(e.message),i.loginIsAccord2=!0)})},e.jumpMsg=function(){a.go("messageCenter")},e.viewTopic=function(e){a.go("circlePage",{circleId:e})},e.viewMyTopic=function(){i.xinxianshow=!1,i.myquanshow=!0,i.buttonshowl=!1,i.buttonshowr=!0,a.go("topic.qmine")},e.viewStory=function(e){2!==e.flag?a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):a.go("classNoteDetails",{noteId:e.id})},e.viewShop=function(){a.go("myStore",{storeId:e.userData.memberId,shareStoreId:""})},e.viewHim=function(e){1==e.flag&&a.go("personalHomepageHe",{othersId:e.userCode})},e.share=function(){if(!d.getUser().mid)return void a.go("login");window.umeng?e.showShare=!e.showShare:alert("只能在app分享,请下载app！")},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=(e.userData.userName?e.userData.userName:"他")+"的空间",s="欢迎关注"+(e.userData.userName?e.userData.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",i="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",a=u.getShareLinkHeader()+"personalHomePageHe/"+e.userData.memberId;window.umeng?0==t?window.umeng.shareToSina(o,s,i,a,0,null,f.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,f.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,f.shareSuccessCallback):3==t?window.umeng.shareToQQ(o,s,i,a,0,null,f.shareSuccessCallback):4==t?window.umeng.shareToQzone(o,s,i,a,0,null,f.shareSuccessCallback):5==t&&e.copeText(a):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("personalHomepageMeService",["$http","UrlService",function(e,t){this.getUserData1=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_ONE"),data:i})},this.getUserData2=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_TWO"),data:i})},this.getUserData3=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_THREE"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyStory=function(o,s,i){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.getMyCollection=function(o,s,i){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:s,userId:i}})},this.startApply=function(){return e({method:"post",url:t.getUrl("START_APPLY_LECTURER"),data:{}})},this.apply=function(o){return e({method:"post",url:t.getUrl("APPLY_LECTURER"),data:o})},this.teachedLessones=function(o){return e({method:"post",url:t.getUrl("TEACHED_COURSE"),data:o})},this.joinedLessones=function(o){return e({method:"post",url:t.getUrl("JOINED_COURSE"),data:o})}}]),APP.controller("QdatabaseController",["$scope","$rootScope","$ionicHistory","QdatabaseService","$http","$ionicSlideBoxDelegate","$timeout","$state",function(e,t,o,s,i,a,n,r){e.quanlist="",e.isshow=!1,e.topshow=!1,e.xxshow=!1,e.sshow=!1,t.xiaoxis=!1,e.shuxiaoxi=!1,e.userlist="",e.count=0,e.ziliaolist="",t.msgCount="",e.totalCount=0,e.nogengduo="没有更多数据",e.storyName={name:""},e.storyType="",t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.goBack=function(){e.$ionicGoBack()},e.soushow=function(){e.sshow=!e.sshow},e.gotoxiaoxi=function(){r.go("qzMessageCenter"),t.xiaoxis=!1},e.toMsgCenter=function(){r.go("qzMessageCenter")},e.gototiezi=function(e){r.go("topicdetails",{noteId:e.id,isShortStory:e.isShortStory})},e.inputclass=function(t){e.storyType=t.id,e.init()},e.inputname=function(t){e.storyType="",e.init(),e.sshow=!1},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,storyName:e.storyName.name,storyType:e.storyType};n(function(){s.getziliaolist(t).success(function(t,o,s,i){return e.ziliaolist=t.data.list,e.totalCount=t.totalCount,t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},200),e.isjiazai=e.pageSize*e.pageIndex,e.hasMore=e.isjiazai>e.totalCount},e.loadData=function(){n(function(){var t=e.isjiazai<=e.totalCount;if(e.isjiazai=e.pageIndex*e.pageSize,e.pageIndex=e.pageIndex+1,t){var o={pageSize:e.pageSize,pageIndex:e.pageIndex};return s.getziliaolist(o).success(function(t,o,s,i){return e.ziliaolist=e.ziliaolist.concat(t.data.list),e.totalCount=t.totalCount,t}).error(function(){}),e.hasMore=t,e.$broadcast("scroll.refreshComplete"),void e.$broadcast("scroll.infiniteScrollComplete")}e.nogengduo="没有更多数据",e.hasMore=t,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){s.gettopic().success(function(t,o,s,i){return e.quanlist=t.data,t}),s.getxiaoxi().success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.dataList=[],e.hasMore=!0,e.pageSize=5,e.pageIndex=1,e.isjiazai=0,e.totalCount="",e.initdata()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QdatabaseService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.gettopic=function(){return e.get("./data/fenlei.json")},this.getziliaolist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)}}]),APP.controller("qSearchController",["$scope","$rootScope","$ionicHistory","qSearchService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.biaoqian="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",e.$ionicGoBack()},e.goqSearchThree=function(){window.cordova&&cordova.plugins.Keyboard.close(),n.go("qSearchThree",{keywords:e.input.isinput})},e.search=function(e){n.go("qSearchThree",{keywords:e.target.value})},e.BgoqSearchTwo=function(e){n.go("qSearchThree",{keywords:e.name})},e.init=function(){e.input.isinput="";var t={isHot:0};s.getbiaoqian(t).success(function(t,o,s,i){return r(function(){e.biaoqian=t.data.list,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),setTimeout(function(){document.getElementById("qSearch").focus()},200),l.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.init(),e.showmore=!0})}]),APP.service("qSearchService",["$http","UrlService",function(e,t){this.getbiaoqian=function(o){return e.post(t.getUrl("TOPIC_TAGS"),o)}}]),APP.controller("qSearchBiaoController",["HomePageService","$scope","$rootScope","$ionicHistory","qSearchBiaoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u){t.topiclist="",t.pageIndex="",t.pageSize=10,t.keywords="",t.ismore="",t.totalCount="",t.hasMore="",t.ismoreshow="",t.showmore="",t.input={isinput:t.isinput},t.goBack=function(){1==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("allCircle")):2==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("qSearch")):r.go("qSearchThree",{keywords:t.input.isinput})},t.goqSearchTwo=function(){r.go("qSearchTwo",{keywords:t.input.isinput})},t.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},t.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),t.input.isinput=e.target.value,t.init()},t.joinCircle=function(s){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)r.go("login");else{t.itemTopicName=s.topicName;var a={ids:s.id};i.joinTopic(a).success(function(e){1==e.success?(s.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):p.showToast(e.message)}).error(function(){p.showToast("加入失败")})}}),t.itemTopicName=s.topicName;var a={ids:s.id};i.joinTopic(a).success(function(e){1==e.success?(s.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):-2e3==e.errorCode&&(p.showToast(e.message),o.loginIsAccord2=!0)}).error(function(){p.showToast("加入失败")})},t.loadData=function(){c(function(){if(t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.pageIndex=t.pageIndex+1,!t.hasMore)return p.showToast("没有更多数据"),t.hasMore;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};i.gettopic(e).success(function(e,o,s,i){return c(function(){t.topiclist=t.topiclist.concat(e.data.list),t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){p.showToast("没有更多数据")}),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3)},t.init=function(){t.keywords=t.input.isinput,t.pageIndex=1,t.pageSize=10;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};i.gettopic(e).success(function(e,o,s,i){return c(function(){t.topiclist=e.data.list,t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){}),u.scrollTop()},t.$on("$ionicView.beforeEnter",function(){t.showmore=!1,t.input={isinput:d.keywords},t.keywords=t.input.isinput,t.init(),t.showmore=!0})}]),APP.service("qSearchBiaoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchThreeController",["$scope","$rootScope","$ionicHistory","qSearchThreeService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.userlist="",e.topiclist="",e.huatilist="",e.pageIndex="",e.pageSize=3,e.showmore="",e.usershow="",e.topicshow="",e.tiezishow="",e.input={isinput:""},e.keywords=e.input.isinput,e.goBack=function(){e.input.isinput="",n.go("qSearch")},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.memberId})},e.storygotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userCode})},e.gototiezi=function(e){n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoquanezi=function(e){n.go("circlePage",{circleId:e.id})},e.goqSearchBiao=function(){e.keywords=e.input.isinput,n.go("qSearchBiao",{keywords:e.keywords})},e.BgoqSearchUser=function(){e.keywords=e.input.isinput,n.go("qSearchUser",{keywords:e.keywords})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.BgoqSearchTie=function(){e.keywords=e.input.isinput,n.go("qSearchTie",{keywords:e.keywords})},e.joinCircle=function(o){e.itemTopicName=o.topicName;var i={ids:o.id};s.joinTopic(i).success(function(s){1==s.success?(o.isJoin=1,e.init(),e.inCircle=!0,r(function(){e.inCircle=!1},1e3)):-2e3==s.errorCode&&(d.showToast(s.message),t.loginIsAccord2=!0)}).error(function(){d.showToast("加入失败")})},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=3;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return e.userlist=t.data.list,e.usershow=t.totalCount>3,t}).error(function(){});var o={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gettopic(o).success(function(t,o,s,i){return e.topiclist=t.data.list,e.topicshow=t.totalCount>3,t}).error(function(){});var i={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(i).success(function(t,o,s,i){return e.huatilist=t.data.list,e.tiezishow=t.totalCount>3,t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchThreeService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchTieController",["$scope","$rootScope","$ionicHistory","qSearchTieService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.huatilist="",e.pageIndex="",e.pageSize=10,e.keywords="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){n.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){n.go("qSearchTwo",{keywords:e.input.isinput})},e.gototiezi=function(e){n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(t).success(function(t,o,s,i){return r(function(){e.huatilist=e.huatilist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.gethuati(t).success(function(t,o,s,i){return r(function(){e.huatilist=t.data.list,e.totalCount=t.totalCount,
e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchTieService",["$http","UrlService",function(e,t){this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)}}]),APP.controller("qSearchTwoController",["$scope","$rootScope","$ionicHistory","qSearchTwoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.topiclist="",e.ismore="",e.topicListCount="",e.pageIndex="",e.pageSize=10,e.tagIds="",t.toFilterCode=2,e.ismoreshow="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",n.go("qSearch")},e.goqSearchBiao=function(){n.go("qSearchBiao",{keywords:e.input.isinput})},e.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),n.go("qSearchBiao",{keywords:e.target.value})},e.gotobiao=function(){t.toFilterCode=2,n.go("qSearchBiao",{keywords:e.input.isinput})},e.gotoquanezi=function(e){n.go("circlePage",{circleId:e.id})},e.joinCircle=function(t){e.itemTopicName=t.topicName;var o={ids:t.id};s.joinTopic(o).success(function(o){1==o.success?(t.isJoin=1,e.inCircle=!0,r(function(){e.inCircle=!1},1e3),e.init()):d.showToast(o.message)}).error(function(){d.showToast("加入失败")})},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,tagIds:e.tagIds};s.gettopic(t).success(function(t,o,s,i){return r(function(){e.topiclist=e.topiclist.concat(t.data.list.topicList),e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){t.toFilterCode=2,e.pageIndex=1,e.pageSize=10;var o={pageIndex:e.pageIndex,pageSize:e.pageSize,tagIds:e.tagIds};s.gettopic(o).success(function(t,o,s,i){return r(function(){e.topiclist=t.data.list.topicList,e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.ismore=t.data.list.createDate1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.tagIds=l.tagIds,e.input={isinput:l.tagname},e.init(),e.showmore=!0})}]),APP.service("qSearchTwoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETLISTBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchUserController",["$scope","$rootScope","$ionicHistory","qSearchUserService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p){e.userlist="",e.pageIndex="",e.pageSize=10,e.biaoqian="",e.ismore="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){n.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){n.go("qSearchTwo",{keywords:e.input.isinput})},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.memberId})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return r(function(){e.userlist=e.userlist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.userlist<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};s.getuser(t).success(function(t,o,s,i){return r(function(){e.userlist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),p.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchUserService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)}}]),APP.controller("QhotController",["$scope","$rootScope","PlatformService","HomePageService","CLASSIFYMESSAGECRNTERService","$ionicHistory","QhotService","ShopService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}e.flagNum=!1,e.tielist="",e.quanlist="",e.bannerlist="",e.selectedIndex="",t.xiaoxis=!1,e.dataList=[],e.nogengduo="",e.userdata="",e.topshow=!1,e.hasMore=!0,e.ismore=!0,e.totalCount="",e.datafist="",e.message="",e.showList=!1;var h=null;t.showRightTop=!1,t.msgCount="",e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){d.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoxiaoxi=function(){d.go("ClassifyMessageCenter")},e.gotomyzhu=function(){d.go("personalHomepageMe")},e.gotoothers=function(e){d.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){d.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){d.go("allCircle")},e.scrollToTop=function(){m.$getByHandle("qhotHandle").scrollTop(!0),e.showTopBtn=!1},e.getScrollHeight=function(){e.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),e.scrollHeight>3*e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},e.hotgo=function(){var e=m.$getByHandle("pinglun"),t=e.getScrollPosition().left,o=document.getElementById("hotdiv").offsetWidth;t>4.3*o&&d.go("allCircle")},e.gotoqSearch=function(){d.go("qSearch")},e.dianzan=function(o,s){window.cordova&&(t.gio.track("like",{circleID:e.tielist[s].topicId}),t.gio.track("active",{circleID:e.tielist[s].topicId}));var i=f("loginId"),a={id:o,noLoading:!0,userCode:i};n.postdianzan(a).success(function(t){1==t.success?1==e.tielist[s].praiseFlag?(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber-1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber+1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):p(function(){g.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?n.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):g.showToast(t.message),t}).error(function(){}):n.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=f("loginId"),o=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0,userCode:t}:{pageSize:e.pageSize,pageIndex:e.pageIndex,userCode:t};p(function(){n.getstorylist(o).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){e.pageIndex+=1;var t=f("loginId"),o={pageSize:5,pageIndex:e.pageIndex,noLoading:!0,userCode:t};n.getstorylist(o).success(function(t){t.data.list&&0!=t.data.list.length?h=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.infiniteScrollComplete");var o=e.tielist.length;e.hasmore=!(o==t.totalCount),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.jumpBannerUrl=function(e,t){if(0==e){var s=t.split("/");"noteDetails"==s[1]?d.go("noteDetails",{noteId:s[2],isShortStory:s[3]}):"circlePage"==s[1]?d.go("circlePage",{circleId:s[2]}):d.go("personalHomepageMe")}else if(1==e)if(t.indexOf("mobiletest.ehaier.com:8880")>-1||t.indexOf("pre.m.ehaier.com:8880")>-1||t.indexOf("thsq.ehaier.com")>-1){var i=t+"&openType=h5";"APP"==o.getPlatform()?cordova.InAppBrowser.open(i,"_system","location=yes"):window.open(i)}else{var a=navigator.userAgent;a.indexOf("Android")>-1||a.indexOf("Linux")>-1?"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t):(a.indexOf("iPhone"),"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t))}},e.showCameraList=function(){e.showList=!e.showList},e.hideList=function(){e.showList=!1},e.isClick=function(){e.isDisplay=!e.isDisplay},e.jumpPhoto=function(o){s.isWdHost().success(function(s){t.isWdHost=s.data.isHost,-1==t.isWdHost?d.go("login"):(e.showList=!1,3!=o?d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(s){var i=JSON.parse(s),a=i.videoFile,n=i.imageFile,r=a.replace("\\",""),c=n.replace("\\","");t.mediaurla=r,t.mediaImga=c,d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o})},function(e){}))})},e.init=function(){e.showList=!1,e.isDisplay=!1,e.phoneHeight=document.documentElement.clientHeight/2;var o=e.quanlist?{pageIndex:1,pageSize:15,noLoading:!0}:{pageIndex:1,pageSize:15};n.gettopic(o).success(function(t,o,s,i){return e.quanlist=t.data.list,t}).error(function(){});var s=e.quanlist?{bannerType:0,noLoading:!0}:{bannerType:0};n.getlunbo(s).success(function(t,o,s,i){return e.bannerlist=t.data.list,l.$getByHandle("qhot_slider").update(),t}).error(function(){});var i={noLoading:!!e.quanlist||""};n.getxiaoxi(i).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.hasMore=!0,e.initdata(),r.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(o,s){window.cordova&&t.gio.track("communityEntry"),"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),p(function(){n.getusertopic().success(function(t,o,s,i){e.datafist=t.data,e.datafist&&d.go("quanziRecommend")}).error(function(){})},1e3),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(h)})}]),APP.service("QhotService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETHOTSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getxiaoxi=function(o){return e.get(t.getUrl("UNRED_MESSAGE"),o)},this.getlunbo=function(o){return e.post(t.getUrl("GETBANNERLIST"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETHOTTOPICLIST"),o)},this.getusertopic=function(o){return e.post(t.getUrl("ADDUSER"),o)},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("QmineController",["$scope","$rootScope","$ionicHistory","QmineService","$http","$ionicSlideBoxDelegate","CLASSIFYMESSAGECRNTERService","$state","$timeout","PopupService","MyCirclePagesService",function(e,t,o,s,i,a,n,r,c,l,d){e.tielist="",e.flagNum=!1,e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";var p=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.xxshow=function(){t.xinxianshow=!0,t.myquanshow=!1,t.buttonshowl=!0,t.buttonshowr=!1},e.wdshow=function(){t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0},e.gototiezi=function(e){r.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotomyzhu=function(){r.go("personalHomepageMe")},e.gotoxiaoxi=function(){r.go("ClassifyMessageCenter")},e.gotoothers=function(e){r.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){r.go("allCircle")},e.gotoqSearch=function(){r.go("qSearch")},e.joinCircle=function(o){window.cordova&&(t.gio.track("follow",{circleID:o.id}),t.gio.track("active",{circleID:o.id})),e.itemTopicName=o.topicName;var i={ids:o.id,noLoading:!0};s.joinTopic(i).success(function(t){1==t.success?(o.isJoin=1,o.topicFocusFlag=1,e.init(),e.inCircle=!0,c(function(){e.inCircle=!1},1e3)):l.showToast(t.message)}).error(function(){l.showToast("加入失败")})},e.dianzan=function(o,i){window.cordova&&(t.gio.track("like",{circleID:e.tielist[i].topicId}),t.gio.track("active",{circleID:e.tielist[i].topicId}));var a={id:o,noLoading:!0};s.postdianzan(a).success(function(t){1==t.success?1==e.tielist[i].praiseFlag?(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber-1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber+1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):c(function(){l.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?s.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):l.showToast(t.message),t}).error(function(){}):s.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};c(function(){s.gettielist(t).success(function(t,o,s,i){if(t.success)return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){c(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return l.showToast("没有更多数据"),e.nogengduo="没有更多数据",e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};s.gettielist(t).success(function(t,o,s,i){return p=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.getMyCreatTopicInfo=function(t){var o={keywords:t};d.getMyCreatTopics(o).then(function(t){t.data.success&&(e.myCreatTopics=t.data.data.list)},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};d.getMyJoinedTopics(o).then(function(t){t.data.success&&(e.myTopics=t.data.data.list)},function(e){})},e.clickIn=function(e,o){0==o?r.go("circlePage",{circleId:e}):2==o?(t.showApplyTag=1,t.reviewCircleId=e,r.go("applyCircle")):(t.reviewCircleId=e,r.go("applyCircle"))},e.viewTopic=function(e){r.go("circlePage",{circleId:e})},e.init=function(){e.myCreatTopics=[],e.myTopics=[],e.tielist="",e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";t.showRightTop=!1,e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo(),e.selectedIndex=void 0;var o=e.quanlist?{ids:"",noLoading:!0}:{ids:""};s.gettopic(o).success(function(t,o,s,i){if(t.success)return e.quanlist=t.data.list,t}).error(function(){});var i={pageIndex:1,pageSize:3};s.gettuitopic(i).success(function(t,o,s,i){if(t.success)return e.tuiquanlist=t.data.list,t}).error(function(){});var a=e.quanlist?{noLoading:!0}:"";s.getxiaoxi(a).success(function(t,o,s,i){t.data&&0!=t.data?e.flagNum=!0:e.flagNum=!1}).error(function(){}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(){"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),t.showRightTop=!1,t.xiaoxis=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(p)})}]),APP.service("QmineService",["$http","UrlService",function(e,t){this.gettielist=function(o){return e.post(t.getUrl("GETMYFOLLOWINGSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETMYTOPICLIST"),o)},this.gettuitopic=function(o){return e.post(t.getUrl("RECOMMEND_LIST"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("communityRecommendCtrl",["$scope","$rootScope","$timeout","$state","PopupService","communityRecommendService",function(e,t,o,s,i,a){e.idArray=[],e.ids=[],e.topics=[],e.matrixes=[],e.init=function(){e.$broadcast("scroll.refreshComplete"),a.getCommunities().success(function(o){if(1==o.success){if(e.topics=o.data.list,e.topics.length>12)for(var s=0;s<Math.ceil(e.topics.length/12);s++)e.matrixes[s]=e.topics.slice(12*s,12*s+12);for(var a=0;a<e.topics.length;a++)1==e.topics[a].recommend&&(e.ids.push(e.topics[a].id),e.idArray.push(e.topics[a].id))}else-2e3==o.errorCode&&(i.showToast(o.message),t.loginIsAccord2=!0)}).error(function(){i.showToast("网络错误！")})},e.selectAll=function(t){if(e.ids.length!=e.topics.length){e.ids=[];for(var o=0;o<e.topics.length;o++)e.topics[o].isJoin||(e.topics[o].isJoin=!0),e.ids.push(e.topics[o].id)}else{for(o=0;o<e.topics.length;o++)e.topics[o].isJoin&&(e.topics[o].isJoin=!1);e.ids=[],e.ids=e.ids.concat(e.idArray)}},e.joinOrApply=function(t){if(0==t.recommend||null==t.recommend)if(t.isJoin=!t.isJoin,t.isJoin)e.ids.push(t.id);else for(var o=0;o<e.ids.length;o++)e.ids[o]==t.id&&e.ids.splice(o,1)},e.done=function(){e.ids.length?a.joinTopic(e.ids).then(function(t){1==t.data.success?(e.ids=[],s.go("topic.qhot")):i.showToast(t.data.message)},function(){}):s.go("topic.qhot")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("communityRecommendService",["$http","UrlService",function(e,t){this.joinTopic=function(o){var s={ids:o.toString()};return e({method:"post",url:t.getUrl("JOIN_TOPIC"),data:s})},this.getCommunities=function(){return e({method:"post",url:t.getUrl("LAUNGCH_RECOMMEND_LIST")})}}]),APP.controller("QwschoolController",["$scope","$rootScope","$ionicHistory","QwschoolService","$http","$state","CLASSIFYMESSAGECRNTERService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l){e.tielist="",e.flagNum=!1,e.quanlist="",e.classlist="",e.ziliaolist="",e.buttonshowl=!1,e.buttonshowr=!0,t.xiaoxis=!1,e.isjiazai=0,e.nogengduo="",e.userdata="",e.selectedIndex=void 0,e.hasMore=!0,e.ismore=!0,e.message="",e.catelist="",e.selectCheck="";var d=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){a.go("classNoteDetails",{noteId:e.id})},e.gotomyzhu=function(){a.go("personalHomepageMe")},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userCode})},e.gotoqSearch=function(){a.go("qSearch")},e.gotoxiaoxi=function(){a.go("messageCenter")},e.gotoziliao=function(){a.go("qdatabase")},e.dianzan=function(t,o){var i={id:t,noLoading:!0};s.postdianzan(i).success(function(t){1==t.success?1==e.tielist[o].praiseFlag?(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber-1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber+1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):r(function(){c.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?s.postshoucang(t).success(function(t,o,s,i){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):c.showToast(t.message),t}).error(function(){}):s.postshoucang(t).success(function(t,o,s,i){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.selectlist=function(t){if(e.selectCheck==t)e.selectCheck="",e.storyid="",e.initdata();else{e.pageIndex=1,e.selectCheck=t,e.storyid=parseInt(t);var o={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};r(function(){s.getstorylist(o).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)}},e.initdata=function(){e.storyid="",e.selectCheck="",e.pageSize=5,e.pageIndex=1;var t=e.userdata?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};r(function(){s.getstorylist(t).success(function(t,o,s,i){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.tielist<5?e.hasMore=!1:(e.hasMore=!0,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")),t}).error(function(){})},300)},e.loadData=function(){if(e.pageIndex=e.pageIndex+1,e.storyid)var t={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};else var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};s.getstorylist(t).success(function(t,o,s,i){return d=setTimeout(function(){t.data.list.length<5?(e.hasMore=!1,c.showToast("没有更多数据"),e.nogengduo="没有更多数据"):e.hasMore=!0,e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){})},e.init=function(){e.selectedIndex=void 0;var o={noLoading:!0};s.business().success(function(t){e.catelist=t.data.list}),s.getxiaoxi(o).success(function(o,s,i,a){t.msgCount=o.data,e.topshow=0!=t.msgCount,o.data&&0!=o.data?e.flagNum=!0:e.flagNum=!1}).error(function(){});var i={id:1,type:1,noLoading:!0};s.getuserdata(i).success(function(t,o,s,i){return e.userdata=t.data,t}).error(function(){});var a={noLoading:!0};s.getclass(a).success(function(t,o,s,i){return e.classlist=t.data.list,t}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(o,s){"classNoteDetails"==t.nextPageBefore?t.nextPageBefore="":($("ion-header-bar").show(),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(d)})}]),APP.service("QwschoolService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getclass=function(o){return e.post(t.getUrl("GETCOURSEINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.postdianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.postshoucang=function(o){return e.post(t.getUrl("SCHOOLCOLLECTION"),o)},this.business=function(o){return e.post(t.getUrl("GET_BUSINESS"),o)}}]),APP.controller("qzMessageCenterController",["$scope","$state","qzMessageCenterService",function(e,t,o){e.hasmore=!1,e.selectedIndex=0,e.id="",e.platformData,e.smallClassData,e.otherData,e.param={pageSize:5,id:e.id,page:e.page,noLoading:!0},e.goBack=function(){e.$ionicGoBack()},e.goDetails=function(){t.go("messageDetails")},e.getPlatformData=function(){o.getPlatformMsg().success(function(t){e.platformData=t.data})},e.getSmallClassData=function(){o.getSmallClassMsg().success(function(t){e.smallClassData=t.data})},e.getOtherData=function(){o.getOtherMsg().success(function(t){e.otherData=t.data})},e.page=1,e.loadMore=function(){e.page+=1,e.loadMoreMsg(e.param)},e.loadMoreMsg=function(t){o.loadMoreProducts(t).success(function(t,o,s,i){if(null!=t.data.msgList&&void 0!=t.data.msgList&&0!=t.data.msgList.length){e.msgList=e.msgList.concat(t.data.msgList),e.$broadcast("scroll.infiniteScrollComplete");var a=e.msgList.length;e.hasmore=!(a===t.data.storeItemsCounts)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,e.msgList=[]})},e.init=function(){e.getPlatformData(),e.getSmallClassData(),e.getOtherData()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("qzMessageCenterService",["$http","UrlService",function(e,t){this.getPlatformMsg=function(){return e.get(t.getUrl("PLATFORM_INFO"),params)},this.getSmallClassMsg=function(){return e.get("data/smallClassMessage.json")},this.getOtherMsg=function(){return e.get("data/otherMessage.json")},this.loadMoreMessage=function(o){return params={pageSize:o.pageSize,id:o.id,page:o.page,noLoading:o.noLoading},e.get(t.getUrl(),params)}}]),APP.controller("relatedProductController",["$ionicHistory","$http","$scope","relatedProductsService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService",function($ionicHistory,$http,$scope,relatedProductsService,$stateParams,$state,$cookieStore,$ionicPopup,$timeout,LoginService,$rootScope,$ionicModal,$localstorage,PopupService){$scope.provinceId=0,$scope.cityId=0,$scope.regionId=0,$scope.streetId=0,$scope.productList=[],$scope.imgimg=[],$rootScope.image=[],$scope.isAreadyShop=!1,$scope.prolist=[],$scope.searchGoodsName="",$scope.gsPlaceholder="搜索商品",$scope.isShop=!0,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.page=1,$scope.loadMore=function(){$scope.page+=1,0==$scope.selectedIndex?$scope.searchOK?$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,2):$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5):1==$scope.selectedIndex?($scope.areadyPage+=1,$scope.areadyShop($scope.areadyPage,5)):3==$scope.selectedIndex&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,1)},$scope.onTabSelected=function(e){$scope.selectedIndex=e,$scope.page=1,$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.searchOK=!1,0==e?($scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)):1==e?($scope.shop0=!1,$scope.shop1=!0,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.areadyPage=0,$scope.productList=[],$scope.areadyShop($scope.areadyPage,5)):2==e?($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!0,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.holdPro()):3==e&&($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!0,$scope.isShop=!1,$scope.search=!0,$scope.productList=[])},$scope.loadMoreProducts=function(e,t,o,s,i,a){relatedProductsService.loadMoreProducts(e,t,o,s,i,a).success(function(e){if(null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.storeItemsCounts);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.areadyShop=function(e,t){relatedProductsService.areadyShop(e,t).success(function(e){if(null!=e.productList&&void 0!=e.productList&&0!=e.productList.length){$scope.productList=$scope.productList.concat(e.productList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.productTotal);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.holdPro=function(){relatedProductsService.holdPro().success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchHold=function(){if($scope.productList=[],""==$scope.searchName.searchHold&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchHold&&$scope.searchGoodsHold($scope.searchName.searchHold)},$scope.searchGoodsHold=function(e){relatedProductsService.searchHoldPro(e).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.todoSomething=function(e,t){13==e.keyCode&&($scope.searchProduct(t),Focus.blur())},$scope.searchProduct=function(e){if($scope.searchOK=!0,$scope.page=1,$scope.productList=[],1==e){if(""==$scope.searchName.searchAll&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchAll&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}else if(2==e){if(""==$scope.searchName.searchShop&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchShop&&$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}},$scope.searchGoods=function(e,t,o,s,i,a,n,r){
relatedProductsService.searchGoods(e,t,o,s,i,a,n,r).success(function(e){if($scope.isShop=!0,null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!(e.productsList<5);for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.productOK=function(){$ionicHistory.goBack(),$rootScope.nextPageBefore="relatedProduct"},$scope.selectOrderAddress=function(e){if($rootScope.productId.length<5)if(-1!=$rootScope.image[e.productId].indexOf("check"))$rootScope.productId.push(e),$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_select.png",$scope.isChooseOrder=!0;else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else if(5==$rootScope.productId.length)if(-1!=$rootScope.image[e.productId].indexOf("check"))PopupService.showToast("最多能选择5个");else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else PopupService.showToast("最多能选择5个");$scope.imgimg=$rootScope.image},$scope.init=function(){$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.selectedIndex=0,$scope.hasmore=!1,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.productList=[],relatedProductsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.initPro()})},$scope.initPro=function(){$scope.page=1,$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.isIOS=!!ionic.Platform.isIOS(),$scope.init()}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.service("relatedProductsService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,s,i,a,n,r){var c={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n,pageSize:r};return e.get(t.getUrl("GET_RELATEDSHOP"),c)},this.areadyShop=function(o,s){var i={start:o,offset:5};return e.get(t.getUrl("GET_AREADYSHOP"),i)},this.holdPro=function(){return e.get(t.getUrl("GET_HOLDPRO"))},this.searchHoldPro=function(o){var s={keyword:o};return e.get(t.getUrl("SEARCH_HOLDPRO"),s)},this.searchGoods=function(o,s,i,a,n,r,c,l){var d={keyword:o,pageIndex:s,pageSize:i,provinceId:a,cityId:n,districtId:r,streetId:c,fromType:l};return e.get(t.getUrl("SEARCH_GOODS_CIRCLE"),d)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getFilterData=function(){return e.get(t.getUrl("GET_FILTER_DATA"))}}]),APP.controller("selectAdminController",["$scope","$state","$stateParams","selectAdminService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,s,i,a,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=[],e.toAnchor=function(t){e.isDisplay=!1,"#"==t?n.toView("#toOther",!0):n.toView("#"+t,!0)},e.goBack=function(){t.go("CircleSetAdmin",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.selectUser=function(t){for(var o=0;o<e.userlist.length;o++)t.id==e.userlist[o].id?"img/ic_select.png"==e.userlist[o].ischeck?(e.userlist[o].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[o].ischeck="img/ic_select.png",e.userCode=t.userCode):e.userlist[o].ischeck="img/ic_check.png"},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};s.getuserlist(o).success(function(t,o,s,a){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var n=0;n<e.userlist.length;n++)e.userlist[n].ischeck="img/ic_check.png";i.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.yes=function(){if(e.userCode.length>0){var o={topicId:e.topicId,userCode:e.userCode,indentityStatus:1};s.setAdmin(o).success(function(o){o.success?t.go("CircleSetAdmin",{topicId:e.topicId}):a.showToast(o.message)}).error(function(){})}else a.showToast("请选择管理员")},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};s.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var s=e.userlist.length;e.hasmore=!(s===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,a.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.userCode="";var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},s.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list;for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("selectAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("sharedMsgsList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/SharedMsgsList.html",scope:!0,link:function(e,t,o){}}}),APP.controller("signDateController",["CirclePageService","signDateService","PopupService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){function h(e,t){var o=t;s.month=t,s.fullDay=new Date(e,o,0).getDate(),s.startWeek=new Date(e,o-1,1).getDay(),s.lastMonthDay=new Date(e,o-1,0).getDate(),s.nextMonthDay=new Date(e,o+1,0).getDate(),s.total=(s.fullDay+s.startWeek)%7==0?s.fullDay+s.startWeek:s.fullDay+s.startWeek+(7-(s.fullDay+s.startWeek)%7),s.fullPrevMonth=[],s.fullNextMonth=[],s.fullCurrentMonth=[];for(var i=0;i<s.lastMonthDay;i++)s.fullPrevMonth[i]=i+1;for(var i=0;i<s.nextMonthDay;i++)s.fullNextMonth[i]=i+1;for(var i=0;i<s.signList.length;i++)s.fullCurrentMonth[i]=i+1;s.prevLast=s.fullPrevMonth.splice(s.lastMonthDay-s.startWeek,s.startWeek),s.nextFrist=s.fullNextMonth.splice(0,7-(s.fullDay+s.startWeek)%7),s.currentDays=s.prevLast.concat(s.signList).concat(s.nextFrist)}function v(e,o,i,a,n){t.getSignDate(e,o,i,a,n).success(function(e){if(e.success){s.isMoreSign=e.data.replenishSignGolds;var t=e.data.list,o=t[0].signDate.split("-");s.signList=e.data.list,s.getYear=Number(o[0]),s.getMonth=Number(o[1]),s.signCount=e.data.signCount,s.replenishSignGolds=e.data.replenishSignGolds,s.signRules=e.data.signRules,h(s.getYear,s.getMonth)}})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?s.paddingtopClass={"padding-top":"30px"}:s.paddingtopClass={"padding-top":"14px"},s.goBack=function(){s.$ionicGoBack()},s.$on("$ionicView.beforeEnter",function(e,t){"back"!=t.direction&&(s.month=(new Date).getMonth(),s.year=(new Date).getFullYear(),s.init())}),s.init=function(){s.isMoreSign="",s.signSucDate=e.signSuccessDate,s.topicName=e.topicName,s.defaultDate=s.signSucDate.signYear+"-"+s.signSucDate.signMonth+"-"+s.signSucDate.signDay,s.userId=i.userId,s.topicId=i.topicId,s.monthFlag=Number(i.monthFlag),v(s.userId,s.topicId,s.monthFlag,s.signSucDate.signYear,s.signSucDate.signMonth)},s.replenishSign=function(){s.replenishPopup=g.show({template:"<div class='rep-box'>\n                    <div class='rep-close' ng-click='closeReplenishPopup()'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                    <div class='rep-head'>选择补签日期</div>\n                    <div class='rep-content'>\n                      <div class='con-date' ng-click='selectDate()'>\n                        \n                        <div class='input'>{{defaultDate}}</div>\n                        <i><img ng-src=\"{{imgBaseURL}}img/signIn/date_icon.png\" alt=\"\" /></i>\n                      </div>\n                      <div class='con-info'>补签将消耗您<span style=\"font-size:22px;\">{{replenishSignGolds}}</span>个金币</div>\n                    </div>\n                    <div class='rep-foot' ng-click='replenishSuccess(defaultDate,2,topicId,userId)'>确认补签</div>\n                  </div>",cssClass:"replenishPopup",scope:s}),s.closeReplenishPopup=function(){s.replenishPopup.close()}},s.replenishSuccess=function(e,i,a,n){var r=e.split("-")[0],c=e.split("-")[1];r==s.signSucDate.signYear&&c==s.signSucDate.signMonth?(t.getReplenishSign(e,i,a,n).success(function(e){e.success?(s.signInfoData=e.data,s.replenishPopup.close(),s.replenishSucPopup=g.show({template:"<div class='suc-box'>\n                          <div class='suc-close' ng-click='closeReplenishSucPopup()'><img src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"\" /></div>\n                          <div class='suc-bg'><img src=\"{{imgBaseURL}}img/signIn/buqian_bg.png\" alt=\"\" /></div>\n                          <div class='suc-content'>\n                            <div class='suc-title' flex='main:center cross:center'>\n                              <div class='suc-icon' flex='cross:center'><img src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                              <div class='title-text'>签到排名<span style=\"font-size:16px;\">{{signInfoData.rank}}</span></div>\n                            </div>\n                               </div>\n                          <div class='suc-foot' ng-click='closeReplenishSucPopup()'>知道啦</div>\n                        </div>",cssClass:"replenishSucPopup",scope:s})):o.showToast(e.message)}),s.closeReplenishSucPopup=function(){s.replenishSucPopup.close(),s.init()}):o.showToast("对不起，只能补签当月")},s.selectDate=function(){if("APP"==p.getPlatform()){var e=s.signSucDate.signYear,t=s.signSucDate.signMonth,o=s.signSucDate.signDay,i={date:new Date(e,t-1,o),mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(i,function(e){c(function(){var t=e.getDate(),o=e.getMonth()+1,i=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t),s.defaultDate=i+"-"+o+"-"+t},200)})}else{var t=s.signSucDate.signMonth,e=s.signSucDate.signYear,a={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(e,t-1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);new Date(e).getFullYear();s.defaultDate=new Date(e).getFullYear()+"-"+t+"-"+o}};u.openDatePicker(a)}},s.signChart=function(e){n.go("signInChart",{topicId:e})},s.weeks=["日","一","二","三","四","五","六"],s.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==p.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==p.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},s.signDateActive=function(e,t,o){0!=t&&(1==t?n.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:o.fromType,storeId:o.storeId}):2==t||3==t&&s.tolink(e))},s.prevMonth=function(){s.getMonth-1==0?(s.getYear-=1,s.getMonth=12):s.getMonth-=1,s.monthFlag+=1,v(s.userId,s.topicId,s.monthFlag,s.getYear,s.getMonth)},s.nextMonth=function(){s.getMonth+1==13?(s.getYear+=1,s.getMonth=1):s.getMonth+=1,s.monthFlag-=1,v(s.userId,s.topicId,s.monthFlag,s.getYear,s.getMonth)}}]),APP.service("signDateService",["$http","UrlService",function(e,t){this.getSignDate=function(o,s,i,a,n){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_DATE"),data:{userId:o,topicId:s,monthFlag:i,year:a,month:n}})},this.getReplenishSign=function(o,s,i,a){return e({method:"POST",url:t.getUrl("CIRCLE_REPLENISH_SIGN"),data:{replenishSignDate:o,signType:s,topicId:i,userId:a}})},this.getUserData=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.controller("signInChartController",["$scope","$rootScope","$state","$stateParams","$ionicScrollDelegate","signInChartService","UserService","personalHomepageMeService",function(e,t,o,s,i,a,n,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"30px"}:e.paddingtopClass={"padding-top":"14px"},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.topicId=s.topicId,e.signType=2,e.myCircleRankType=1,e.allCircleRankType=2,e.myCommunityRankType=3,e.allCommunityRankType=4,e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId)},e.getCircleChartFun=function(t,o,s){var i={rankType:t,signType:o,topicId:s};a.CurrentCircleChart(i).success(function(t){t.success&&(1==i.rankType||3==i.rankType?(e.userSignCount=t.data.rank[0].signCount,e.userRank=t.data.rank[0].rank):2!=i.rankType&&4!=i.rankType||(e.rankList=t.data.rank))})},e.$on("$ionicView.beforeEnter",function(t,o){"back"!=o.direction&&(i.scrollTop(),e.tabIndex=0,e.signListTitle="圈子",e.init())}),e.chooseTab=function(t){e.tabIndex=t,0==t?(e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId),e.signListTitle="圈子"):(e.getCircleChartFun(e.myCommunityRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCommunityRankType,e.signType,e.topicId),e.signListTitle="社区")}}]),APP.service("signInChartService",["$http","UrlService",function(e,t){this.CurrentCircleChart=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_CHART"),data:o})},this.getUserData=function(o,s){var i={type:o,id:s};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:i})},this.getMyTopics=function(o,s,i){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:s,userId:i}})}}]),APP.controller("topicRewardListController",["$ionicHistory","$http","$scope","topicRewardListService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService","NoteDetailsService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){o.tipId="",o.page=1,o.getList=function(){var e={tipId:parseInt(o.tipId),pageIndex:1,pageSize:5,sort:1,type:1};s.getList(e).success(function(e){o.shantotal=e.data,o.shanList=e.data.ucTips,e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)})},o.loadMore=function(){o.page=o.page+1;var e={tipId:parseInt(o.tipId),pageIndex:o.page,pageSize:5,sort:1,type:1};s.getList(e).success(function(e){o.shanList=o.shanList.concat(e.data.ucTips),o.$broadcast("scroll.infiniteScrollComplete"),e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1,g.showToast("没有更多了"))})},o.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userId})},o.follow=function(e,t){if(e.isFollow){var s={id:e.userId,isFollow:0};m.followNote(s).success(function(e){if(1==e.success)for(var s=0;s<o.shanList.length;s++)o.shanList[s].userId==o.shanList[t].userId&&(o.shanList[s].isFollow=!1);else g.showToast(e.message)})}else{var s={id:e.userId,isFollow:1};m.followNote(s).success(function(e){if(1==e.success)for(var s=0;s<o.shanList.length;s++)o.shanList[s].userId==o.shanList[t].userId&&(o.shanList[s].isFollow=!0);else g.showToast(e.message)})}},o.scrollToTop=function(){f.$getByHandle("rewardHandle").scrollTop(!0),o.showTopBtn=!1},o.getScrollHeight=function(){o.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),o.scrollHeight>2*o.phoneHeight?o.showTopBtn=!0:o.showTopBtn=!1},o.init=function(){o.phoneHeight=document.documentElement.clientHeight/2,o.hasmore=!1,o.page=1,o.tipId=i.tipId,o.getList()},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(e,t){o.init()})}]),APP.service("topicRewardListService",["$http","UrlService",function(e,t){this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)}}]),APP.controller("dataAnalysisController",["$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","dataAnalysisService",function(e,t,o,s,i,a){function n(){e.byStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function r(){e.byStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyleActive={color:"#666","border-bottom":"0 solid #2979FF"}}function c(){e.cityByStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityLgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function l(){u=[{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""}],g=[]}function d(){var e=document.getElementById("container"),t=echarts.init(e);f=t;var o=null;(o={graphic:{type:"text",left:"center",top:"center",z:99,zLevel:100,style:{text:v,x:100,y:100,width:30,height:30}},legend:{selectedMode:!1,x:"center",y:"bottom",data:g,itemHeight:9,itemWidth:9},clickable:!1,series:[{name:"半径模式",type:"pie",radius:[15,75],center:["50%","50%"],roseType:"area",x:"50%",max:40,sort:"ascending",clickable:!1,label:{normal:{formatter:"{d}%",textStyle:{fontWeight:"normal",fontSize:12}}},itemStyle:{normal:{color:function(e){return["#FB497C","#FFBB41","#6FE621","#4FCCFF","#4D7BF3","#b7009b","#32af01","#c10037"][e.dataIndex]}}},data:u}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}function p(){var e=document.getElementById("activeContenter"),t=echarts.init(e);h=t;var o=null;(o={title:{subtext:"单位：次"},calculable:!0,xAxis:[{type:"category",axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#dedede"}},data:[{value:"分享\n店铺",textStyle:{fontSize:"12",color:"#37394C"}},{value:"分享\n商品",textStyle:{fontSize:"12",color:"#37394C"}},{value:"任务\n完成",textStyle:{fontSize:"12",color:"#37394C"}},{value:"社区\n互动",textStyle:{fontSize:"12",color:"#37394C"}},{value:"评价\n次数",textStyle:{fontSize:"12",color:"#37394C"}},{value:"登录\n次数",textStyle:{fontSize:"12",color:"#37394C"}}]}],yAxis:[{axisLabel:{textStyle:{fontSize:"12",color:"#37394C"}},type:"value",splitNumber:2,axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"完成了",type:"bar",itemStyle:{normal:{color:function(e){return["#67AAF9"][0]}}},barWidth:"7",data:m}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.PercentageCal=function(e,t){return num=parseFloat(e),total=parseFloat(t),isNaN(num)||isNaN(total)?"-":total<=0?"0%":Math.round(num/total*1e4)/100+"%"};var u,g,m,f,h,v="本月",$="";e.isHasData=!1,e.init=function(){a.doInit($).success(function(t){t.success&&(e.dataUpdate=t.data,t.data&&(e.dataUpdateAddTime=1e3*parseInt(t.data.addTime)))})},e.disbuBL=function(t){a.distributionBL(t,$).success(function(t){if(t.success){if(t.data.length<=0)return void(e.isHasData=!0);e.isHasData=!1;for(var o=0;o<t.data.length;o++)u[o].value=t.data[o].mySaleNum,u[o].name=t.data[o].cateName,g[o]=t.data[o].cateName,o==t.data.length-1&&(u.length=t.data.length,d());0==t.data.length&&d()}})},e.actyBL=function(t){a.activityBL(t,$).success(function(t){t.success&&(e.dataActivity=t.data,m[0]=t.data.STORE_SHARE,m[1]=t.data.PRODUCT_SHARE,m[2]=t.data.TASK,m[3]=t.data.COMMUNITY,m[4]=t.data.ASSESS,m[5]=t.data.LOGIN,p())})},e.salesCity=function(t){a.salesCity(t,$).success(function(t){t.success&&(t.data.length>0?e.dataRegional=t.data:e.dataRegional=null)})},e.chooseCityDate=function(t){"BY"==t?(e.salesCity(!0),c()):(e.salesCity(!1),e.cityLgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityByStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseDate=function(t){l(),f&&f.dispose(),"BY"==t?(v="本月",e.disbuBL("true"),n()):(v="累计",e.disbuBL("false"),e.lgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseActive=function(t){h&&h.dispose(),m=[],"BY"==t?(e.actyBL(!0),r()):(e.actyBL(!1),e.lgStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyleActive={color:"#666","border-bottom":"0 solid #2979FF"})},e.$on("$ionicView.beforeEnter",function(){e.containerPic=!0,e.activeContenterPic=!0,e.isHasData=!1,v="本月",$="",$=i.memberId,n(),r(),c(),l(),m=[],s.scrollTop(),e.dataUpdate=null,e.dataUpdateAddTime=null,e.dataActivity="",e.dataRegional=null,e.init(),e.disbuBL(!0),e.actyBL(!0),e.salesCity(!0)}),e.$on("$ionicView.beforeLeave",function(){f&&f.dispose(),h&&h.dispose(),e.containerPic=!1,e.activeContenterPic=!1})}]),APP.service("dataAnalysisService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={memberId:o};return e.get(t.getUrl("DATA_ANALYSIS_UPDATE"),s)},this.distributionBL=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_DISTRIBUTION"),i)},this.activityBL=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_ACTIVITY"),i)},this.salesCity=function(o,s){var i={onlyCurrentMonth:o,memberId:s};return e.get(t.getUrl("DATA_ANALYSIS_SALES"),i)}}]),APP.controller("ApplyRefundController",["$scope","$ionicActionSheet","ApplyRefundService","PopupService","$timeout","$stateParams","$ionicHistory","$timeout","$rootScope",function(e,t,o,s,i,a,n,i,r){e.cOrderSnDetail=a.cOrderSn,e.refundData=[],e.description=8,e.typeActual=0,e.applyRefund={reason:""},e.init=function(){e.applyRefundType="请选择退款原因",o.applyRefund(e.cOrderSnDetail).success(function(t){t.success&&(e.refundData=t.data,e.typeActual=t.data.orderType,1==e.typeActual?e.repairType="退货退款":e.repairType="退货不退款")})},e.openSelect=function(){var o=t.show({buttons:[{text:"七天无理由"},{text:"大小尺寸"},{text:"颜色款式"},{text:"质量问题"},{text:"配送问题"},{text:"库存问题"},{text:"地址问题"},{text:"其他"}],titleText:"请选择退款原因",buttonClicked:function(t){switch(t){case 0:e.applyRefundType="七天无理由";break;case 1:e.applyRefundType="大小尺寸";break;case 2:e.applyRefundType="颜色款式";break;case 3:e.applyRefundType="质量问题";break;case 4:e.applyRefundType="配送问题";break;case 5:e.applyRefundType="库存问题";break;case 6:e.applyRefundType="地址问题";break;case 7:e.applyRefundType="其他"}return o(),e.description=t,!0}});i(function(){o()},1e4)},e.submitRefund=function(){8==e.description?s.showToast("请选择退款原因"):o.setApplyRefund(e.cOrderSnDetail,e.typeActual,e.applyRefund.reason,e.applyRefundType).success(function(e){"S"==e.data.state?(r.$broadcast("ORDER_RETURN_BACK"),s.showToast("提交成功！"),i(function(){n.goBack()},2e3)):e.data.message?(s.showToast(e.data.message),i(function(){n.goBack()},2e3)):s.showToast("提交失败！")})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ApplyRefundService",["$http","UrlService",function(e,t){this.setApplyRefund=function(o,s,i,a){var n={cOrderSn:o,typeActual:s,description:i,reason:a};return e.get(t.getUrl("SUBMIT_APPLY_REFUND"),n)},this.applyRefund=function(o){var s={cOrderSn:o};return e.get(t.getUrl("APPLY_REFUND"),s)}}]),APP.controller("AssessController",["$scope","AssessService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope",function(e,t,o,s,i,a,n,r,c,l){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.assessData=[],e.parameter=[],e.isAssessed=!1,e.cOrderSnData=[],e.value=[],e.click=[],e.fileIds=[],e.click[0]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.iconImageData=[],e.iconImageData[0]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""},e.value[0]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.init=function(o,s){e.show=!1,t.getAssess(o,s).success(function(t,o,s,i){if(t.success){e.isAssessed=!t.data.products||0==t.data.products.length,e.assessDataLength=t.data.products.length,e.assessData=t.data.products;for(var a=0;a<e.assessDataLength;a++)e.cOrderSnData.push({cOrderSn:t.data.products[a].cOrderSn}),e.click[a]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.value[a]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.iconImageData[a]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""};e.addTime=t.data.addTime,e.ckCode=t.data.ckCode,e.consignee=t.data.consignee,e.memberId=t.data.memberId,e.memberName=t.data.memberName,e.mobile=t.data.mobile}else e.isAssessed=!0}).error(function(){e.isAssessed=!0})},e.assessType=function(t,o){0==t?(e.click[o].isClickGood=!e.click[o].isClickGood,e.click[o].isClickMiddle=!1,e.click[o].isClickBad=!1):1==t?(e.click[o].isClickMiddle=!e.click[o].isClickMiddle,e.click[o].isClickGood=!1,e.click[o].isClickBad=!1):2==t&&(e.click[o].isClickBad=!e.click[o].isClickBad,e.click[o].isClickMiddle=!1,e.click[o].isClickGood=!1),angular.forEach(e.click,function(t,o,s){t.isClickGood?e.value[o].evalution=1:t.isClickMiddle?e.value[o].evalution=2:t.isClickBad&&(e.value[o].evalution=3)})},e.setParams=function(){e.parameter=[];for(var t=0;t<e.assessDataLength;t++)e.parameter.push({addTime:e.addTime,assString:e.value[t].comment,cOrderSn:e.cOrderSnData[t].cOrderSn,ckCode:e.ckCode,consignee:e.consignee,evalution:e.value[t].evalution,memberId:e.memberId,memberName:e.memberName,mobile:e.mobile,productScore:e.value[t].value1,serviceScore:e.value[t].value3,shippingScore:e.value[t].value2,fileUrl1:e.iconImageData[t].imgUrl1,fileUrl2:e.iconImageData[t].imgUrl2,fileUrl3:e.iconImageData[t].imgUrl3,fileUrl4:e.iconImageData[t].imgUrl4,fileUrl5:e.iconImageData[t].imgUrl5})},e.submitAssess=function(){for(var o=0;o<e.assessDataLength;o++){if(!/^.{5,300}$/.test(e.value[o].comment))return void(1==e.assessDataLength?n.showToast("请输入5～300字的评价！"):n.showToast("请于第"+(o+1)+"件商品输入5～300字的评价！"));if(0==e.value[o].evalution)return void(1==e.assessDataLength?n.showToast("请选择评价！"):n.showToast("请于第"+(o+1)+"件商品选择评价！"));if(0==e.value[o].value1)return void(1==e.assessDataLength?n.showToast("请选择商品评分！"):n.showToast("请于第"+(o+1)+"件商品选择商品评分！"));if(0==e.value[o].value2)return void(1==e.assessDataLength?n.showToast("请选择物流评分！"):n.showToast("请于第"+(o+1)+"件商品选择物流评分！"));if(0==e.value[o].value3)return void(1==e.assessDataLength?n.showToast("请选择服务评分！"):n.showToast("请于第"+(o+1)+"件商品选择服务评分！"))}for(var i="",a=0;a<e.assessDataLength;a++)i+=e.value[a].comment;t.checkAssessText(i).success(function(o){o?(n.showToast("成功"),e.setParams(),t.submitAssessInfo(e.parameter,e.fileIds).success(function(e){e.success?(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),c.goBack()},1e3)):e.message?n.showToast(e.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.uploadImg=function(o){if("APP"==i.getPlatform()){var r={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},c=function(i){function r(i){e.iconImage=i,s(function(){e.iconImage=i},200);var r=function(t){a.hide(),n.showToast("上传成功");for(var s=JSON.parse(t.response),i=s.fileIds,r=0;r<i.length;r++)e.fileIds.push(i[r]);var c=s.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:n.showToast("最多只能输入5张照片！")},c=function(e){a.hide(),n.showToast("上传失败")},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var p={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};a.show(p)}function c(e){}function l(i){e.iconImage=i,s(function(){e.iconImage=i},200);var r=function(t){a.hide(),n.showToast("上传成功");for(var s=JSON.parse(t.response),i=s.fileIds,r=0;r<i.length;r++)e.fileIds.push(i[r]);var c=s.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:n.showToast("最多只能输入5张照片！")},c=function(e){n.showToast("上传失败"),a.hide()},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var p={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};a.show(p)}function d(e){}1==i?navigator.camera.getPicture(r,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}):2==i&&navigator.camera.getPicture(l,d,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0})};window.plugins.actionsheet.show(r,c)}else n.showToast("请下载客户端实现上传图片功能")},e.$on("$ionicView.beforeEnter",function(){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.init(e.orderId,e.cOrderSn)}),e.showLarge=function(t){e.show=!0,e.largeImg=t},e.closeImg=function(){e.show=!1},e.deleteImg=function(){e.show=!1;for(var t=0,o=0;o<e.assessDataLength;o++){if(e.largeImg==e.iconImageData[o].imgUrl1){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl2){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl3){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl4){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl5){t=o;break}}e.largeImg==e.iconImageData[t].imgUrl1?(e.iconImageData[t].imgUrl1=e.iconImageData[t].imgUrl2,e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl2?(e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl3?(e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl4?(e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl5&&(e.iconImageData[t].imgUrl5="")},e.goBack=function(){for(var t=!1,o=0;o<e.assessDataLength;o++)if(""!=e.iconImageData[o].imgUrl1||0!=e.value[o].value1||0!=e.value[o].value2||0!=e.value[o].value3||""!=e.value[o].comment||0!=e.value[o].evalution){var t=!0;break}if(t){n.showConfirm("","您的评价未完成，您确定离开吗？",function(e){e&&c.goBack()
})}else c.goBack()}}]),APP.service("AssessService",["$http","UrlService",function(e,t){this.getAssess=function(o,s){var i={orderId:o,cOrderSn:s};return e.get(t.getUrl("GET_ASSESS"),i)},this.checkAssessText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),s)},this.submitAssessInfo=function(o,s){s=s.join();var i={assessList:JSON.stringify(o),fileIds:s};return e({method:"POST",url:t.getUrl("SUBMIT_ASSESS"),params:i})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.directive("commentBar",[function(){return{restrict:"E",template:'<div class="col padding-top-bottom-0"><img class="padding-left-10" width="20%" ng-click="comment(0)" ng-src="{{commentValue>=1?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(1)" ng-src="{{commentValue>=2?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(2)" ng-src="{{commentValue>=3?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(3)" ng-src="{{commentValue>=4?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(4)" ng-src="{{commentValue>=5?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"></div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("BannerDailyController",["$scope","BannerDailyService","$stateParams","$rootScope","$http","$state","UserService","CommonAddressService","GoodsService","$ionicHistory","PopupService","UrlService","$localstorage","$ionicLoading","BannerThemeService","CreditService","$ionicScrollDelegate","$ionicModal","$timeout",function($scope,BannerDailyService,$stateParams,$rootScope,$http,$state,UserService,CommonAddressService,GoodsService,$ionicHistory,PopupService,UrlService,$localstorage,$ionicLoading,BannerThemeService,CreditService,$ionicScrollDelegate,$ionicModal,$timeout){function getBannerDailyProducts(e,t,o,s,i,a,n,r){BannerDailyService.getBannerDaily(e,t,o,s,i,a,n,r).success(function(e){$scope.activityProductList=[],$scope.activityProductList=e.productsList,$ionicLoading.hide()})}function getShareInfo(e,t){BannerThemeService.getBannerTheme(e,t).success(function(e){shareInfo=e.data})}$scope.shareStoreId=$stateParams.shareStoreId;var bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,provinceId="",cityId="",areaId="",streetId="";$scope.storeId="",$scope.layout=$stateParams.layout,$scope.layout="layout-colum2",$scope.activityProductList=[],$scope.districtName="";var sharePic="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",shareInfo={},screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="DAILY_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.showShare=!1,$scope.dayliTitleStyle={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.dayliTitleStyle={top:"18px"}),$rootScope.isApp?$scope.BannerTopopType={right:"50px"}:$scope.BannerTopopType={right:"10px"},$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,GoodsService.getAddress().success(function(response){if(void 0!=response.data&&response.data&&0!=response.data.length){var addressInfo=eval(response.data),regionIndex=addressInfo[0].regionName.indexOf("/");$scope.districtName=addressInfo[0].regionName.substr(0,regionIndex),getBannerDailyProducts(memberId,addressInfo[0].provinceId,addressInfo[0].cityId,addressInfo[0].areaId,addressInfo[0].streetId,addressInfo.regionName,bannerId,platformType)}else{var defaultAddressInfo=CommonAddressService.getAddressInfo();$scope.districtName=defaultAddressInfo.regionName,getBannerDailyProducts(memberId,defaultAddressInfo.provinceId,defaultAddressInfo.cityId,defaultAddressInfo.areaId,defaultAddressInfo.streetId,defaultAddressInfo.regionName,bannerId,platformType)}}).error(function(e){var t=CommonAddressService.getAddressInfo();$scope.districtName=t.regionName,getBannerDailyProducts(memberId,t.provinceId,t.cityId,t.areaId,t.streetId,t.regionName,bannerId,platformType)}),getShareInfo(bannerId,platformType)},$rootScope.$on("DAILY_LOCATION",function(e,t){$scope.districtName=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.districtName+"/"+$scope.streetName;provinceId=t["value-1"],cityId=t["value-2"],areaId=t["value-3"],streetId=t["value-4"],GoodsService.addAddress(provinceId,cityId,areaId,o,streetId).success(function(e,t,o,s){e.success&&getBannerDailyProducts(memberId,provinceId,cityId,areaId,streetId,$scope.districtName,bannerId)})}),$scope.goBack=function(){$ionicHistory.goBack()},$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.dataAdd=null,$scope.defaultValue=null,$scope.goBackFlag=!0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"DAILY_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})}),$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"COUPONSLIST",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"COUPONSLIST",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):($scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.share=function(){if(window.device&&window.device.hasNewShare){if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");$scope.showShare=!$scope.showShare}else{if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");if(window.umeng){var e=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid;window.umeng.share(shareInfo.title,shareInfo.content,shareInfo.imgUrl,e,0)}}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid,o=shareInfo.title,s=shareInfo.imgUrl,i=shareInfo.content;window.umeng?(0==e?window.umeng.shareToSina(o,i,s,t,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,t,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,t,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(t),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1}}]),APP.service("BannerDailyService",["$http","UrlService",function(e,t){this.getBannerDaily=function(o,s,i,a,n,r,c,l){var d={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,provinceName:void 0,cityName:void 0,districtName:r,bannerId:c,platformType:l};return e.get(t.getUrl("GET_BANNER_DAILY"),d)}}]),APP.controller("BannerThemeController",["$scope","BannerThemeService","$stateParams","$state","$ionicHistory","$localstorage","UserService","PopupService","UrlService","CreditService","InAppBrowserService","$rootScope",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(o,s){t.getBannerTheme(o,s).success(function(t){e.activityImageList=t.data.productList,h=t.data})}var g=o.bannerId,m=a.get("storeId","20219251"),f=o.platformType;e.activityImageList=[];e.shareStoreId=o.shareStoreId;var h={};e.showShare=!1,e.leftArrow={},e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},window.cordova&&ionic.Platform.isIOS,e.leftShare={top:"16px",position:"absolute",right:"8px","z-index":"10",width:"32px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.leftArrow={top:"14px"}),e.goDetail=function(t){var o=e.activityImageList[t];if(o.productId)s.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:"",storeId:m,shareStoreId:e.shareStoreId});else if(o.activityUrl)if(-1!=o.activityUrl.indexOf("VRshop")){var i=null,a=c.getHead().replace("v3","www"),n=a+"index.html#/VrPage/";i=d.open(n),i.addEventListener("loadstart",function(e){-1!=e.url.indexOf("backToApp")&&i.close()})}else if(-1!=o.activityUrl.indexOf("coupon/toList"))s.go("getCouponsList",{shareStoreId:e.shareStoreId});else if(-1!=o.activityUrl.indexOf("m.ehaier.com/www/index.html")){var r=o.activityUrl.slice(o.activityUrl.indexOf("#/"));window.location.hash=r}else window.cordova?p.isIOS?cordova.InAppBrowser.open(o.activityUrl,"_system","location=yes"):cordova.InAppBrowser.open(o.activityUrl,"_blank","location=yes"):window.open(o.activityUrl,"_blank","location=yes")},e.goBack=function(){i.backView()?i.goBack():s.go("homePage")},e.init=function(){e.showQQ=!1,e.showWeChat=!1,g=o.bannerId,f=o.platformType,u(g,f)},e.$on("$ionicView.beforeEnter",function(t,s){o.shareStoreId&&(p.shareId=o.shareStoreId),m=o.shareStoreId?o.shareStoreId:a.get("storeId","20219251"),e.shareStoreId=o.shareStoreId,"back"==s.direction||e.init()}),e.share=function(){if(window.device&&window.device.hasNewShare){if(!n.getUser().mid)return void r.showToast("请先登录,再分享");e.showShare=!e.showShare}else{if(!n.getUser().mid)return void r.showToast("请先登录,再分享");if(window.umeng){var t=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+n.getUser().mid;window.umeng.share(h.title,h.content,h.imgUrl,t,0)}}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),r.showToastShort("复制成功")):r.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+n.getUser().mid,s=h.title,i=h.imgUrl,a=h.content;window.umeng?(0==t?window.umeng.shareToSina(s,a,i,o,0,null,l.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(s,a,i,o,0,null,l.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(s,a,i,o,0,null,l.shareSuccessCallback):3==t?(window.umeng.shareToQQ(s,a,i,o,0,null,l.shareSuccessCallback),l.qqShare()):4==t?(window.umeng.shareToQzone(s,a,i,o,0,null,l.shareSuccessCallback),l.qqShare()):5==t&&e.copeText(o),l.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("BannerThemeService",["$http","UrlService",function(e,t){this.getBannerTheme=function(o,s){if(s)var i={bannerId:o,isHost:"1",backUrl:"",platformType:s};else i={bannerId:o,isHost:"1",backUrl:""};return e.get(t.getUrl("GET_BANNER_THEME"),i)}}]),APP.controller("ChooseShopTemplateController",["$rootScope","$scope","$ionicModal","ChooseShopTemplateService","UserService",function(e,t,o,s,i){t.titleTemplateArray=[],t.listTemplateArray=[],t.titleId="",t.listId="",t.previewImgIndex="",t.storeId=i.getUser().mid,t.init=function(){t.storeId=i.getUser().mid,t.getTemplate(t.storeId)},t.getTemplate=function(e){s.getShopTemplates(e).success(function(e,o,s,i){t.titleTemplateArray=e.data.titleTemplate,t.listTemplateArray=e.data.listTemplate,angular.forEach(t.titleTemplateArray,function(e){1==e.selected&&(t.titleId=e.tit)}),angular.forEach(t.listTemplateArray,function(e){1==e.selected&&(t.listId=e.layout)})}).error(function(e){})},t.setTemplate=function(e){s.setShopTemplate(e).success(function(e,o,s,i){t.getTemplate(t.storeId)})},t.chooseTitleTemplate=function(e){t.titleId=t.titleTemplateArray[e].tit;var o=t.titleId+"-"+t.listId;t.setTemplate(o)},t.chooseListTemplate=function(e){t.listId=t.listTemplateArray[e].layout;var o=t.titleId+"-"+t.listId;t.titleId,t.listId;t.setTemplate(o)},o.fromTemplateUrl("my-preview-modal.html",{scope:t,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){t.modal=e}),t.preview=function(){switch(t.listId+t.titleId){case"layout-dftit-df":t.previewImgIndex="01";break;case"layout-dftit-bp":t.previewImgIndex="02";break;case"layout-dftit-colum2":t.previewImgIndex="03";break;case"layout-bptit-df":t.previewImgIndex="04";break;case"layout-bptit-bp":t.previewImgIndex="05";break;case"layout-bptit-colum2":t.previewImgIndex="06";break;case"layout-colum2tit-df":t.previewImgIndex="07";break;case"layout-colum2tit-bp":t.previewImgIndex="08";break;case"layout-colum2tit-colum2":t.previewImgIndex="09"}t.modal.show()},t.closeModal=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.$on("$ionicView.beforeEnter",function(){t.init()})}]),APP.service("ChooseShopTemplateService",["$http","UrlService",function(e,t){this.getShopTemplates=function(o){var s={storeId:o,noLoading:!0};return e.get(t.getUrl("GET_SHOP_TEMPLATES"),s)},this.setShopTemplate=function(o){var s={templateId:o,noLoading:!0};return e({method:"POST",url:t.getUrl("SET_SHOP_TEMPLATES"),params:s})}}]),APP.service("ConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o,s,i){var a={relationshipType:o,pageIndex:s,pageSize:i};return e.get(t.getUrl("CONNECTION_INDEX"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.service("ConnectionDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("ConnectionSearchController",["$scope","ConnectionSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,s,i,a,n){function r(e,o){for(var s in e)e[s].storeName=t.limitStrLength(e[s].storeName,o)}e.backToLastView=function(){e.$ionicGoBack()};var c=document.querySelector("#focus");e.gotoPartnerDetail=function(e,t){1==t?a.go("partnerDetail",{ownerId:e}):a.go("connectionDetail",{ownerId:e})},e.searchConnection=function(){if(""==e.searchValue)return void i.showToast("请填写搜索内容");t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){e.searchResults=t.data.partners,r(e.searchResults,e.storeNameListLength),0==e.searchResults.length?e.noSearchResults=!0:e.noSearchResults=!1})},e.loadMore=function(){e.pageIndex++,t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){t.success&&(t.data.partners.length<e.pageNum?(e.hasMore=!1,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasMore=!0,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")))})},e.$on("$ionicView.enter",function(){"back"==e.direction?c.blur():(e.searchValue="",e.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),e.$on("$ionicView.beforeEnter",function(t,o){e.direction=o.direction,e.searchType=n.searchType,e.storeNameListLength=Math.floor((window.innerWidth-82)/17*2-1),e.pageIndex=0,e.pageNum=10,e.hasMore=!0,1==e.searchType?e.placeHolder="请输入合伙人信息":e.placeHolder="请输入人脉信息"})}]),APP.service("ConnectionSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,s,i,a){var n={relationshipType:o,keyword:s,pageIndex:i,pageSize:a};return e.get(t.getUrl("CONNECTION_INDEX"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("CustomPageCtrl",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","CustomPageService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicLoading",function($stateParams,$scope,$rootScope,UrlService,CreditService,UserService,$state,CustomPageService,$timeout,$localstorage,$ionicSlideBoxDelegate,GetCouponsService,PopupService,BannerThemeService,GoodsService,$ionicLoading){$scope.customPageId=$stateParams.customPageId?$stateParams.customPageId:"",$scope.showShare=!1,$scope.shareimg="",$scope.storeId=0,$scope.hashtitle="",$scope.sharedesp="",$scope.moduleList=[],$scope.skuMap={},$scope.couponMap={},$scope.index=[],$scope.showjuanyz=!1,$scope.juanlist=[],$scope.juankeling={},$scope.juanqiangwan={},$scope.streetId=12036596,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,window.cordova||-1!=window.location.hash.indexOf("sg_rn_app")?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),GoodsService.getAddress().success(function(response){if(response.success&&response.data){var addressMessage=eval(response.data)[0];void 0!=addressMessage.streetId&&($scope.streetId=addressMessage.streetId)}CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(e){if(1==e.success){$scope.hashtitle=e.data.name,$scope.moduleList=e.data.modualList,$scope.skuMap=e.data.skuMap,$scope.couponMap=e.data.couponMap,$scope.sharedesp=e.data.description;for(var t in $scope.moduleList)if("SWITCH"==$scope.moduleList[t].modualType){$scope.shareimg=$scope.moduleList[t].imageList[0].imageUrl;break}for(var o=0;o<$scope.moduleList.length;o++)$scope.moduleList[o].tabList&&($scope.index[o]=0);for(var s in e.data.couponMap)e.data.couponMap[s].totalGetNum>=e.data.couponMap[s].totalLimitNum?($scope.juankeling[s]=!0,$scope.juanqiangwan[s]=!0):(e.data.couponMap[s].getNum<e.data.couponMap[s].personLimitNum&&($scope.juankeling[s]=!0,$scope.juanqiangwan[s]=!1),e.data.couponMap[s].getNum>=e.data.couponMap[s].personLimitNum&&($scope.juankeling[s]=!1,$scope.juanqiangwan[s]=!1));$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}else PopupService.showToast(e.message)})})},$rootScope.$on("CACHE_SUCCESS",function(e,t){var o={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(o),$scope.init()}),$scope.changestyle=function(e,t){$scope.index[t]=e},$scope.getjuan=function(e,t){1!=$scope.juanqiangwan[e]&&0!=$scope.juankeling[e]&&(UserService.getUser().mid?GetCouponsService.doGetNewCoupons(e).success(function(t){t.success?CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(o){var s=o.data.couponMap[e].getNum,i=o.data.couponMap[e].personLimitNum;if(o.data.couponMap[e].totalGetNum>=o.data.couponMap[e].totalLimitNum)return $scope.juankeling[e]=!0,void($scope.juanqiangwan[e]=!0);s<i&&($scope.juankeling[e]=!0,$scope.juanqiangwan[e]=!1),s>=i&&($scope.juankeling[e]=!1,$scope.juanqiangwan[e]=!1),PopupService.showToast(t.message)}):PopupService.showToast(t.message)}):PopupService.showToast("领卷需要登录哦"))},$scope.goshare=function(){var e=$scope.hashtitle,t=$scope.sharedesp,o=$scope.shareimg,s=UrlService.getShareLinkHeader()+"CustomPage/"+$scope.customPageId;window.postMessage("custPageShare|"+e+"|"+t+"|"+o+"|"+s)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.hashtitle,o=$scope.sharedesp,s=$scope.shareimg,i=UrlService.getShareLinkHeader()+"CustomPage";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction||$scope.init()})}]),APP.service("CustomPageService",["$http","UrlService",function(e,t){this.getdata=function(o,s){if(""==o)var i={streetId:s};else var i={customPageId:o,streetId:s};return e.get(t.getNewUrl("CUSTOMPAGE_MODEL"),i)}}]),APP.controller("CustomerServiceController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","CustomerServiceService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){n.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),s(function(){t.availableToTop(),t.pageIndex=0,t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,""),t.loadOrderAmount(t.orderFlag)},1e3)}function w(e){e?n.deleteOrder(C).success(function(e){e.success?t.init():(g.showToastShort(e.message),C="")}).error(function(e){g.showToastShort("删除失败！"),C=""}):C=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=5,t.isIos=!1,t.BDO=!1;var y,T="";t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderAmountData=[],t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var C="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.loadOrderAmount(0),t.loadOrderList(!1,0,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),t.pageIndex=0},t.batchDeleteOrder=function(){i.go("batchDeleteOrder")},t.loadOrderList=function(e,o,s,i,a,c,l,d){n.getOrderList(o,s,i,a,c,d).success(function(i){if(i.success){if("closed"==s?(y=i.data.canDeleteAll,i.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(y=!1,t.BDO=!1),t.emptySearch=!1,i.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(i.data.orders);else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=t.orderList.concat(i.data.orders);else if(l)t.searchOrderList=i.data.orders;else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=i.data.orders;l?t.hasMoreDataSearch=i.data.orderProductSize:t.hasMoreData=i.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadOrderAmount=function(e){n.getOrderAmount(e).success(function(e){e.success&&(t.orderAmountData=e.data)})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.loadMoreSearch=function(){t.pageIndexSearch++,
t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"",!0)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");T=e.result,window.alipay.pay({payInfo:T},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};p.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):i.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),i.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){i.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,s,a,n,r){r&&t.closeSearchModal(),i.go("orderDetail",{orderSn:e,cOrderSn:o})},t.goAssess=function(e,t,o){o?i.go("assess",{orderId:e,cOrderSn:t}):i.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?i.go("lookAssess",{orderId:e,cOrderSn:t}):i.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",I,"确定")},t.confirmReceive=function(e,o,s){function a(e){e&&S.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',a,"确认"):i.go("confirmReceive",{orderId:s})},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.raiseStatusOne={background:"red",color:"#ffffff"},t.raiseStatusTwo={background:"red",color:"#ffffff"},t.raiseStatusThree={background:"red",color:"#ffffff"},t.raiseStatusFour={background:"red",color:"#ffffff"},t.orderFlag=0,t.BDO=!!y,"back"==o.direction||t.init()}),t.deleteOrder=function(e){C=e,g.showConfirm("","确认删除此订单？",w,"删除")},d.$on("AFTER_COMMIT",function(e){t.loadOrderAmount(0)})}]),APP.service("CustomerServiceService",["$http","UrlService",function(e,t){this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,pageIndex:i,pageSize:a,keyword:n};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(o){var s={chooseOrder:o};return e.get(t.getNewUrl("ORDER_AMOUNT"),s)},this.cancelOrder=function(o,s){var i={orderId:o,cancelFlag:s};return e.get(t.getUrl("CANCEL_ORDER"),i)},this.payOrder=function(o){var s={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),s)},this.deleteOrder=function(o){var s={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),s)}}]),APP.filter("cut",function(){return function(e,t,o,s){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var i=e.lastIndexOf("");-1!=i&&(e=e.substr(0,i))}return e+(s||"…")}}),APP.controller("FeedbackController",["$scope","$ionicActionSheet","FeedbackService","PopupService","$timeout",function(e,t,o,s,i){e.userInfo={type:6,content:"",contact:""},e.init=function(){e.feedbackType="请选择"},e.openSelect=function(){var o=t.show({buttons:[{text:"功能意见"},{text:"界面意见"},{text:"您的新需求"},{text:"操作意见"},{text:"流量问题"},{text:"其他"}],titleText:"请选择",buttonClicked:function(t){switch(t){case 0:e.feedbackType="功能意见";break;case 1:e.feedbackType="界面意见";break;case 2:e.feedbackType="您的新需求";break;case 3:e.feedbackType="操作意见";break;case 4:e.feedbackType="流量问题";break;case 5:e.feedbackType="其他"}return o(),e.userInfo.type=t,!0}});i(function(){o()},1e4)},e.submitFeedback=function(){6==e.userInfo.type?s.showToast("请选择反馈类型！"):0==e.userInfo.content.length?s.showToast("请输入反馈内容！"):e.globalConstant.mobileNumberRegExp.test(e.userInfo.contact)?o.setFeedback(e.userInfo.type,e.userInfo.content,e.userInfo.contact).success(function(e,t,o,i){e.success?s.showToast("提交成功"):s.showToast(e.message)}):s.showToast("请输入正确的联系方式！")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("FeedbackService",["$http","UrlService",function(e,t){this.setFeedback=function(o,s,i){var a={type:o,content:s,contact:i};return e.get(t.getUrl("FEEDBACK"),a)}}]),APP.controller("GoodsManageController",["$scope","GoodsManageService","$ionicModal","UserService","GoodsService",function(e,t,o,s,i){e.flag=[],e.isShowOnFooter=!1,e.isShowOffFooter=!1,e.moreOrCheck=!1,e.goodsList=[],e.onSaleAmount,e.offSaleAmount,e.searchGoodsList=[];var a,n=[],r=!1,c=!0,l=1,d=1;e.keywords={keyword:""},e.init=function(){e.loadData(a,l,20,242,3466),t.getGoodsList(a,0,20,242,3466).success(function(t,o,s,i){t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0})},e.loadData=function(o,s,i,a,n){t.getGoodsList(o,s,i,a,n).success(function(t,o,i,a){for(var n=0,r=t.productsList.length;n<r;n++)t.productsList[n].isSelected=!1;e.goodsList=t.productsList,1==s?t.productsList&&t.productsList.length>0?e.onSaleAmount=t.productsList.length:e.onSaleAmount=0:0==s&&(t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0)})},e.searchGoods=function(){d=1,t.searchGoods(d,5,a,e.keywords.keyword,20,242,3466).success(function(t,o,s,i){e.searchGoodsList=t.productsList})},e.searchMore=function(){d+=1,t.searchGoods(d,5,a,e.keywords.keyword,20,242,3466).success(function(t,o,s,i){e.searchGoodsList=e.searchGoodsList.concat(t.productsList)})},e.onSale=function(){if(!c){c=!0,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("onSale").style.color="#32BEFF";document.getElementById("offSale").style.color="black",l=1,e.loadData(a,l,20,242,3466)}},e.offSale=function(){if(c){c=!1,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("offSale").style.color="#32BEFF";document.getElementById("onSale").style.color="black",l=0,e.loadData(a,l,20,242,3466)}},e.showBtn=function(e){if(c){var t=document.getElementsByClassName("sm-bottom-btn-on");angular.forEach(t,function(t,o){t.style.display=o==e?"inline-block":"none"})}else{var o=document.getElementsByClassName("sm-bottom-btn-off");angular.forEach(o,function(t,o){t.style.display=o==e?"inline-block":"none"})}},e.batchOperate=function(){for(var t=document.getElementsByClassName("sm-bottom-btn-on"),o=document.getElementsByClassName("sm-bottom-btn-off"),s=0,i=e.goodsList.length;s<i;s++)t[s].style.display="none",o[s].style.display="none";c?e.isShowOnFooter=!e.isShowOnFooter:e.isShowOffFooter=!e.isShowOffFooter,e.moreOrCheck=!e.moreOrCheck},e.deleteGoods=function(t){e.goodsList[t].sku;e.flag[t]=!e.flag[t],c?e.onSaleAmount=e.onSaleAmount-1:e.offSaleAmount=e.offSaleAmount-1,e.goodsList.splice(t,1)},e.soldOut=function(o){var s=e.goodsList[o].sku;t.updateGoods(a,s,1).success(function(e){}),e.flag[o]=!e.flag[o],e.onSaleAmount=e.onSaleAmount-1,e.offSaleAmount=e.offSaleAmount+1,e.goodsList.splice(o,1)},e.putAway=function(o){var s=e.goodsList[o].sku;t.updateGoods(a,s,0).success(function(e){}),e.flag[o]=!e.flag[o],e.offSaleAmount=e.offSaleAmount-1,e.onSaleAmount=e.onSaleAmount+1,e.goodsList.splice(o,1)},e.putAwayBatch=function(){var o=n.join("@");t.updateGoodsBatch(o,0).success(function(e,t,o,s){}),e.loadData(a,0,20,242,3466),n=[]},e.soldOutBatch=function(){var o=n.join("@");t.updateGoodsBatch(o,1).success(function(e,t,o,s){}),e.loadData(a,1,20,242,3466),n=[]},e.deleteGoodsBatch=function(){n.join("@");c?e.loadData(a,1,20,242,3466):e.loadData(a,0,20,242,3466),n=[]},e.selectGoods=function(t){if(0==e.goodsList[t].isSelected)e.goodsList[t].isSelected=!0,n.push(e.goodsList[t].sku);else if(e.goodsList[t].isSelected=!1,n&&n.length>=0){var o=n.indexOf(e.goodsList[t].sku);n.splice(o,1)}r=n.length==e.goodsList.length},e.selectAll=function(){r?(angular.forEach(e.goodsList,function(e){e.isSelected=!1}),r=!1):(angular.forEach(e.goodsList,function(e){e.isSelected=!0}),r=!0)},o.fromTemplateUrl("templates/shop/GoodsSearch.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.searchModal=t}),e.openSearchModal=function(){e.searchModal.show()},e.closeSearchModal=function(){e.searchModal.hide()},e.$on("$destroy",function(){e.searchModal.remove()}),e.removeProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,i.changeChooseStateDui(o).success(function(e,t,o,s){})},e.addProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,i.changeChooseStateJia(o,"1").success(function(e,t,o,s){})},e.$on("$ionicView.beforeEnter",function(){a=s.getUser().mid,e.init()})}]),APP.service("GoodsManageService",["$http","UrlService",function(e,t){this.getGoodsList=function(o,s,i,a,n){var r={memberId:o,onShelf:s,provinceId:i,cityId:a,districtId:n};return e.get(t.getUrl("GOODS_LIST"),r)},this.deleteGoods=function(o,s){var i={memberId:o,sku:s};return e.get(t.getUrl("DELETE_GOODS"),i)},this.updateGoods=function(o,s,i){var a={memberId:o,sku:s,onShelf:i};return e.get(t.getUrl("UPDATE_GOODS"),a)},this.searchGoods=function(o,s,i,a,n,r,c){var l={pageIndex:o,pageSize:s,memberId:i,keyword:a,provinceId:n,cityId:r,districtId:c};return e.get(t.getUrl("SEARCH_GOODS"),l)},this.updateGoodsBatch=function(o,s){var i={skuStr:o,onShelf:s};return e.post(t.getUrl("UPDATE_GOODS_BATCH"),i)},this.deleteGoodsBatch=function(o){var s={skuStr:o};return e.post(t.getUrl("DELETE_GOODS_BATCH"),s)}}]),APP.controller("HelpDetailController",["$scope","$stateParams","HelpDetailService","$ionicModal","$timeout","$sce","UrlService","PlatformService",function(e,t,o,s,i,a,n,r){e.helpId=t.helpId,e.title=t.content,e.isIos=!1,e.htmlContent=t.content,e.trustSrc=function(e){return a.trustAsResourceUrl(e)},e.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?e.isIos=!0:e.isIos=!1,e.htmlContent=n.getHead()+"mstore/sg/helpDetail.html?id="+t.helpId,e.trustSrc=function(e){return a.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.service("HelpDetailService",["$http","UrlService",function(e,t){this.getHelpDetail=function(o){var s={id:o};return e.get(t.getUrl("HELP_DETAIL"),s)}}]),APP.controller("LookAssessController",["$scope","LookAssessService","$stateParams","$ionicLoading","$timeout","PlatformService","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.show=!1,e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.goBack=function(){r.goBack()},e.closeImg=function(){e.show=!1},e.showLarge=function(t){e.show=!0,e.largeImg=t},e.init=function(o){t.getLookAssess(o).success(function(t,o,s,i){t.success?(e.assessList=t.data.comment,e.stateList=t.data,e.timeIsOrNo=(e.timeNow-e.assessList.createTime)/1e3/60/60/24<90):n.showToast(t.memessage)})},e.$on("$ionicView.beforeEnter",function(){e.cOrderSn=o.cOrderSn,e.init(e.cOrderSn),e.timeNow=Date.parse(new Date)})}]),APP.service("LookAssessService",["$http","UrlService",function(e,t){this.getLookAssess=function(o){var s={cOrderSn:o};return e.get(t.getUrl("LOOK_ASSESS_INGO"),s)}}]),APP.controller("ManageMoneyController",["$scope","ManageMoneyService","$ionicModal","$state","InAppBrowserService","$stateParams","UrlService","PopupService","$rootScope",function(e,t,o,s,i,a,n,r,c){function l(){t.checkKjtLogin().success(function(o){if(o.data.isLogin)f=o.data.token,e.promotionList=[],d(o.data.token),e.getPromoteReward(o.data.token,1,g),p(o.data.token);else{var a=I+"index.html#/manageMoney/"+$+"?page="+S,r=escape(a),c=n.getCPUrl("KQT_URL")+"?page=authorizeMain&partner_id="+m+"&return_url="+r;if(window.cordova){var l="",u="page="+I+"index.html#/homePage/",v="page="+I+"index.html#/shopRevenue";h=i.open(c),h.addEventListener("exit",function(){-1!=l.indexOf("auth_code")||-1!=l.indexOf(v)||-1!=l.indexOf(u)||e.$ionicGoBack()}),h.addEventListener("loadstart",function(o){if(l=unescape(o.url),-1!=o.url.indexOf("auth_code")){var i=o.url.indexOf("auth_code")+10,a=o.url.toString().substr(i,32);h.close(),t.getKjtToken(a).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),p(t.data.token)})}else-1!=l.indexOf(v)&&-1==l.indexOf("&return_url=")?s.go("shopRevenue"):-1!=l.indexOf(u)&&-1==l.indexOf("&return_url=")&&s.go("homePage")})}else window.location.href=c}})}function d(o){t.getHryActivityInfo(o).success(function(t){t.success&&(e.activityInfo=t.data.promotionActivityList,e.activityRule=t.data.description)})}function p(o){t.getRefCode(o).success(function(t){t.success&&(e.promoCode=t.data.promoCode,e.qrCodeUrl=t.data.qrCodeUrl)})}var u=1,g=5,m=n.getCPUrl("KQT_ID"),f="",h=null;e.activityInfo=[],e.activityRule="";var v=null,$=a.frontState,S="",I=n.getHead().replace("v3","www");e.showAgreement=!1,e.hasMoreData=!1,e.promoCode="",e.qrCodeUrl="",e.promotionList=[],e.init=function(){if(u=1,-1!=v.indexOf("auth_code")){var o=v.indexOf("auth_code")+10,s=v.toString().substr(o,32);t.getKjtToken(s).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),p(t.data.token)})}else l()},e.getPromoteReward=function(o,s,i){t.getPromoteReward(o,s,i).success(function(t){if(t.success){e.promotionList=e.promotionList.concat(t.data.promotionList);var o=e.promotionList.length;e.hasMoreData=o!=t.totalCount}else e.hasMoreData=!1})},e.getMoreData=function(){u++,e.getPromoteReward(f,u,g)},e.shareToPlatform=function(t){var o="好友力邀您来海融易，海融易为您准备了一份688大礼，快来领取吧！",s="http://m.ehaier.com/www/img/icon_inside_qrcode.png",i=e.qrCodeUrl;window.umeng?1==t?window.umeng.shareToWechatSession("快来领688元红包！",o,s,i,0,null,function(){e.sharemodal.hide()}):window.umeng.shareToWechatTimeline("快来领688元红包！",o,s,i,0,null,function(){e.sharemodal.hide()}):r.showAlert("只能在app分享","抱歉，只能在app分享")},e.skipToTTJ=function(){var e=I+"index.html#/manageMoney/"+$,t=escape(e),o=n.getCPUrl("TTQ_URL")+"?token="+f+"&loginUrl="+t+"&returnUrl="+t;if(window.cordova){var s=null;s=i.open(o),s.addEventListener("loadstart",function(e){-1!=e.url.indexOf("index.html#/manageMoney")&&s.close()})}else window.location.href=o},e.goBack=function(){"shopRevenue"==$?s.go("shopRevenue"):s.go("financialMoney",{whereId:"manageMoney"})},o.fromTemplateUrl("mm-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),o.fromTemplateUrl("mm-share-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.sharemodal=t}),e.openQRModal=function(){e.qrCodemodal.show();var t=new AraleQRCode({text:e.qrCodeUrl,size:106,image:c.imgBaseURL+"img/icon_inside_qrcode.png",imageSize:30}),o=document.getElementById("createdQrCode");0!=o.childNodes.length&&o.removeChild(o.childNodes[0]),o.appendChild(t),o.childNodes[0].style.position="relative"},e.closeQRModal=function(){e.qrCodemodal.hide()},e.openShareModal=function(){e.sharemodal.show()},e.closeShareModal=function(){e.sharemodal.hide()},e.openAgreement=function(){e.sharemodal.hide(),setTimeout(function(){e.showAgreement=!0},300)},e.closeAgreement=function(){e.showAgreement=!1},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.sharemodal.remove()}),e.$on("$ionicView.beforeEnter",function(t,o){v=window.location.href,$=a.frontState,I=n.getHead().replace("v3","www"),S="shopRevenue"==$?I+"index.html#/shopRevenue":I+"index.html#/homePage/",e.init()})}]),APP.service("ManageMoneyService",["$http","UrlService",function(e,t){this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))},this.getKjtToken=function(o){var s={authCode:o};return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:s})},this.getHryActivityInfo=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("GET_HAIRONGYI_ACTIVITYIFNO"),params:s})},this.getPromoteReward=function(o,s,i){var a={token:o,pageNo:s,pageSize:i};return e({method:"POST",url:t.getUrl("GET_PROMOTE_REWARD"),params:a})},this.getRefCode=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("GET_REF_CODE"),params:s})}}]),APP.controller("MicroSchoolController",["$scope","MicroSchoolService","HomePageService",function(e,t,o){e.microSchoolInfo=[],e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.init=function(){e.tabChange(0,8),o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.tabChange=function(t,o){for(var s=document.getElementsByClassName("sg-ws-button"),i=0,a=s.length;i<a;i++)i==t?(s[i].style.color="#32BEFF",s[i].style.borderBottom="2px solid #32BEFF"):(s[i].style.color="black",s[i].style.borderBottom="none");e.loadData(o)},e.loadData=function(o){t.getMicroSchoolInfo(o).success(function(t,o,s,i){e.microSchoolInfo=t.data}).error(function(e){})},e.$on("$ionicView.beforeEnter",function(t,s){if("back"==s.direction)return void o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1});e.init()})}]),APP.service("MicroSchoolService",["$http","UrlService",function(e,t){this.getMicroSchoolInfo=function(o){var s={childId:o};return e.get(t.getUrl("MICRO_SCHOOL"),s)},this.getMicroSchoolDetail=function(o,s){var i={childId:o,id:s};return e.get(t.getUrl(""),i)}}]),APP.controller("MicroSchoolDetailController",["$scope","$stateParams","$sce","MicroSchoolService",function(e,t,o,s){e.childId=t.childId,e.id=t.id,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.loadData(e.childId,e.id)},e.loadData=function(e,t){s.getMicroSchoolDetail(e,t).success(function(e,t,o,s){})},e.$on("$ionicView.beforeEnter",function(){e.title=t.title,e.childId=t.childId,e.id=t.id,e.init()})}]),APP.controller("MyStoreController",["$localstorage","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyStoreService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","SetShopCoverService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","ShopService","$http","GetStatisticInfoService","HomePageService",function($localstorage,$scope,$stateParams,$rootScope,$ionicHistory,$state,$ionicSideMenuDelegate,UserService,MyStoreService,$ionicSlideBoxDelegate,$ionicModal,ChooseShopTemplateService,PopupService,GoodsService,CommonAddressService,$timeout,$ionicScrollDelegate,UrlService,SetShopCoverService,BannerThemeService,SeckillService,countdownService,$interval,$ionicLoading,LoginService,CreditService,ShopService,$http,GetStatisticInfoService,HomePageService){function loadProducts(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){MyStoreService.getProductsList(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f).success(function(e){if($scope.allProducts=e.totalCount,e.data&&null!=e.data.productList&&void 0!=e.data.productList&&0!=e.data.productList.length){if(1==c?($scope.productsList=e.data.productList,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})):($scope.productsList=$scope.productsList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.traceId).success(function(t){if(t.success)for(var o=0,s=e.data.productList.length;o<s;o++)for(var i=e.data.productList[o],a=0,n=t.products.length;a<n;a++){var r=t.products[a];i.sku==r.sku&&(i.finalPrice=r.finalPrice,i.commission=r.commission)}})),$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide(),$scope.productsList){var t=$scope.productsList.length;$scope.hasMoreData=!(e.totalCount===t)}}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasMoreData=!1,$scope.allProducts=0,$scope.productsList=[],$scope.contentDataListxyz=[]})}function restParams(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?(provinceId=e.provinceId,cityId=e.cityId,districtId=e.areaId,streetId=e.streetId,$scope.address=e.regionName):(provinceId=16,cityId=17,districtId=2450,streetId=12036596,$scope.address="崂山区")}$scope.lType="templates/common/ListTemplate1.html",$scope.tType="templates/common/TitleTemplate1.html",$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.filterCategory=[!0,!1,!1],$scope.myStoreInfo={},$scope.slideImage=[],$scope.avatarImage="",$scope.address="",$scope.categorySelected=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[!0,!1],$scope.brandSelected=[!0,!1],$scope.priceSelected=[!0,!1];var firstParamsArr=["all","all","0"],secondParamsArr=[],paramIndex=0;$scope.allProducts=0,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1,$scope.coverImage=$rootScope.imgBaseURL+"img/bg_shop_4.png",$scope.countDownMsg="",$scope.screenWidth=window.innerWidth,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$scope.storeTitleName="",$scope.stockName="显示全部货",$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"];var token="";$scope.brand=!0,$scope.iSPrice=!0,$scope.productCateIdType="0",$scope.productCateId="",$scope.switch=!0,$scope.StockStateArr=["all","hasStock"],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$scope.leftArrow={},$scope.mystoreTitle={},$scope.addressDiv={},$scope.addressLabel={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.leftArrow={top:"14px"},$scope.mystoreTitle={top:"18px"},$scope.addressDiv={top:"16px"},$scope.addressLabel={top:0}),$scope.messageImgFlag=!0,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="配送至",$scope.dataAdd=null,$scope.flag="STORE_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity,pageIndex=1,pageSize=5,filterData="",qs="saleDesc",fromType="2",flag="",memberId="",productCateId=0,provinceId=16,cityId=173,districtId=2450,streetId=12036596,provinceName="",cityName="",sortColumn="saleDesc";$scope.stockState=!1,$scope.showShare=!1,$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.productsList=[],$scope.contentDataListxyz=[],restParams(),MyStoreService.getStoreInfo($scope.storeId,$scope.shareStoreId).success(function(e){switch(e.data.titleLayout){case"tit-df":$scope.tType="templates/common/TitleTemplate1.html";break;case"tit-bp":$scope.tType="templates/common/TitleTemplate2.html";break;case"tit-colum2":$scope.tType="templates/common/TitleTemplate3.html"}switch(e.data.listLayout){case"layout-df":$scope.lType="templates/common/ListTemplate1.html";break;case"layout-bp":$scope.lType="templates/common/ListTemplate2.html";break;case"layout-colum2":$scope.lType="templates/common/ListTemplate3.html"}$scope.coverImage=e.data.coverUrl,$scope.myStoreInfo=e.data,$scope.slideImage=e.data.banner,$scope.avatarImage=e.data.avatarImageFileId,$scope.storeTitleName=$scope.myStoreInfo.storeName+$scope.myStoreInfo.storeTypeName,$ionicSlideBoxDelegate.$getByHandle("my_store_slider").update(),$ionicSlideBoxDelegate.loop(!0)}),ShopService.getLevelInfo(function(e){e.success(function(e){if(e.success&&($scope.avatarImageFileId=e.data.avatarImageFileId,$scope.userCurrentLevelId=e.data.userCreditWithLevel.order,$scope.userName=e.data.userCreditWithLevel.name,$scope.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel))if($scope.levelArray=[],e.data.storeCreditWithLevel.order<=3){$scope.imgCount=e.data.storeCreditWithLevel.order;for(var t=0;t<e.data.storeCreditWithLevel.order;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/StarLevel@2x.png")}else for(var t=0;t<e.data.storeCreditWithLevel.order-3;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/Diamond@2x.png")})},$scope.storeId),$timeout(function(){MyStoreService.getPositionFromCookie().success(function(response,status,headers,config){if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,$scope.address=addressInfo[0].regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)}else getCurrentPosition(),$timeout(function(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},500)})},500),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.getSeckillInfo=function(){SeckillService.getServerTime().success(function(e){var t=e.data,o=$scope.myStoreInfo.seckill.beginTime,s=$scope.myStoreInfo.seckill.endTime,i="",a=$interval(function(){t+=1,t<o?(i=countdownService.getTime(countdownService.getTimeDif(1e3*o,1e3*t)),$scope.countDownMsg="距离开始时间还有"+i):t>=o&&t<=s?(i=countdownService.getTime(countdownService.getTimeDif(1e3*s,1e3*t)),$scope.countDownMsg="距离结束时间还有"+i):t>s&&($scope.countDownMsg="秒杀活动已结束",$interval.cancel(a))},1e3)})},$scope.loadMore=function(){pageIndex+=1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,$scope.filterParams,fromType,flag,!0,qs)},$scope.saleNum=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="#32BEFF",e.color="white",t.backgroundColor="white",t.color="#888",o.backgroundColor="white",o.color="#888",qs="saleDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},$scope.popularity=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="#32BEFF",t.color="white",o.backgroundColor="white",o.color="#888",qs="isHotDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs)},$scope.productsFilter=function(){var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="white",t.color="#888",o.backgroundColor="#32BEFF",o.color="white",$scope.filterModal.show(),$scope.switch&&GoodsService.getFilterData().success(function(e){if(e.success){for(var t=e.data.brandList,o=0;o<t.length;o++)$scope.filterParameterArr&&$scope.filterParameterArr[1]&&"all"!=$scope.filterParameterArr[1]?$scope.filterParameterArr[1].indexOf(t[o].id)>-1?o>0&&(t[o].isActive=!0):t[o].isActive=!1:t[o].isActive=0==o;$scope.brandList=t}})},$scope.changeDown=function(e){e.down=!e.down},$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t){firstParamsArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName;for(var o=0,s=$scope.brandList.length;o<s;o++)$scope.brandSelected[o]=o===e;var i=0,a=$scope.brandList.length;if("全部"==t.brandName){$scope.brandList[0].isActive=!0;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive=!1}else{t.isActive=!t.isActive;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive?i++:$scope.brandList[0].isActive=!1;if(0==i&&($scope.brandList[0].isActive=!0),i==a-1){$scope.brandList[0].isActive=!0;for(var o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive=!1}}if($scope.brandList[0].isActive)$scope.filterParameterArr[1]="all";else{for(var n="",o=1;o<$scope.brandList.length;o++)$scope.brandList[o].isActive&&(n+=$scope.brandList[o].id+";");n=n.substring(0,n.length-1),$scope.filterParameterArr[1]=n}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字")
;if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}$scope.filterParams=$scope.filterParameterArr.join("@"),restParams(),loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,$scope.filterParams,fromType,flag,!1,qs),$scope.filterModal.hide()},$scope.resetFilter=function(){for(var e=0;e<$scope.brandList.length;e++)$scope.brandList[e].isActive=0==e;$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$ionicScrollDelegate.resize()},$scope.category=function(){$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.changeCategory=function(e,t){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],productCateId=t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1,qs);for(var o=0,s=$scope.categorySelected.length;o<s;o++)$scope.categorySelected[o]=o===e;$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,shareStoreId:$stateParams.shareStoreId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,shareStoreId:$stateParams.shareStoreId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$ionicModal.fromTemplateUrl("my-qrcode-modal.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){$scope.qrCodemodal=e}),$ionicModal.fromTemplateUrl("templates/product/SearchFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.openQrcode=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.qrCodemodal.show()},$scope.backToStore=function(){$scope.filterModal.hide()},$scope.closeModal=function(){$scope.qrCodemodal.hide(),$scope.filterModal.hide()},$scope.$on("$destroy",function(){$scope.qrCodemodal.remove(),$scope.filterModal.remove()}),$scope.saveQrCode=function(){var e="";e=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"DCIM/Camera/myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var t=encodeURI($scope.myStoreInfo.qrcode),o={};(new FileTransfer).download(t,e,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();PopupService.showAlert("","图片已经保存至"+t)}else PopupService.showToast("保存成功")},function(e){PopupService.showToast("保存失败！")},!0,o)},$scope.share=function(){if(!UserService.getUser().mid)return void $state.go("login");if(window.device&&window.device.hasNewShare)$scope.showShare=!$scope.showShare;else{var e=$scope.myStoreInfo.storeName,t=$scope.avatarImage,o=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.storeId+"/?fs";window.umeng?window.umeng.share(e,"我的顺逛店铺，精选好货，快来逛逛吧~",t,o,0):alert("只能在app分享,请下载app！")}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.myStoreInfo.storeName,o="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",s=$scope.avatarImage,i=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.userId+"/?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(i),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.goMessageCenter=function(){$state.go("messageCenter")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.goBuyerCenter=function(){$scope.shareStoreId?$state.go("buyerCenter",{shareStoreId:$scope.shareStoreId}):$state.go("buyerCenter")},$scope.toProductDetail=function(e,t,o,s,i,a,n,r){window.cordova&&$rootScope.gio.track("prodClickInStore",{productId:e,o2oType:t,productFirstName:a,productSecondName:n,storeId:s,storeName:$scope.storeTitleName,hasStock:r}),$state.go("productDetail",{productId:e,o2oType:t,fromType:o,storeId:s,shareStoreId:i})},$scope.goBack=function(){$ionicHistory.backView()&&$scope.$ionicGoBack()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"1px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"STORE_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,MyStoreService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",MyStoreService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;MyStoreService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e),$scope.closeAddressModal()})}},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("STORE_LOCATION",function(e,t){$scope.address=t["text-3"],provinceId=t["value-1"],cityId=t["value-2"],districtId=t["value-3"],provinceName=t["text-1"],streetId=t["value-4"],cityName=t["text-2"];var o=t["text-3"]+"/"+t["text-4"];GoodsService.addAddress(provinceId,cityId,districtId,o,streetId).success(function(e,t,o,s){$scope.init()})}),$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId,provinceName=t.provinceName,cityName=t.cityName,$scope.address=t.regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.dataAdd=null,$scope.defaultValue=null,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,token=$stateParams.token,token&&MyStoreService.login(token).success(function(e){if(!e.success||null==e.data.mid)return void $state.go("login");UserService.setUser(e.data),e.data.sessionValue?$localstorage.set("sg_login_token_secret","Bearer"+e.data.sessionValue):$localstorage.set("sg_login_token_secret","Bearer"+GetStatisticInfoService.generateUUID())}),$scope.buttonShow=!1,memberId=$stateParams.storeId,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$ionicScrollDelegate.scrollTop(),$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})})}]),APP.service("MyStoreService",["$http","UrlService",function(e,t){this.getActivityProductsList=function(o,s,i,a,n,r,c){var l={storeId:o,isWdHost:s,productCateId:i,provinceId:a,cityId:n,districtId:r,sortColumn:c};return e.get(t.getUrl("ACTIVITY_PRODUCTS_LIST"),l)},this.getCommonProductsList=function(o,s,i,a,n,r,c,l){var d={storeId:o,isHost:s,productCateId:i,provinceId:a,cityId:n,districtId:r,pageIndex:c,sortColumn:l,noLoading:!0};return e.get(t.getUrl("PRODUCTS_LIST"),d)},this.getPositionFromCookie=function(){var o={};return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"),o)},this.getProductsList=function(o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){var $={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,provinceName:r,cityName:c,districtName:l,pageIndex:d,pageSize:p,productCateId:u,filterData:g,fromType:m,flag:f,noLoading:h,qs:v};return e.get(t.getUrl("COMMONLOADITEMNEW"),$)},this.getMyStoreInfo=function(o,s,i,a,n){var r={COOKIE_DOMAIN:o,DOMAIN_URL:s,POM_STATIC_DOMAIN_NAME:i,link:a,storeId:n,fromType:2};return e.get(t.getUrl("MY_STORE"),r)},this.getStoreInfo=function(o,s){if(s)var i={storeId:o,shareStoreId:s};else var i={storeId:o};return e.get(t.getUrl("MY_STORE_NEW"),i)},this.getMyStoreInfoNew=function(o){var s={memberId:o};return e.get(t.getUrl("SHUNGUANG_VIP"),s)},this.getFilterList=function(o){var s={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.login=function(o){var s={token:o};return e({method:"POST",url:t.getUrl("OTHER_LOGIN"),params:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("HelpController",["$scope","$state","HelpService","InAppBrowserService","UrlService",function(e,t,o,s,i){e.helpData=[],e.loadData=function(){o.getHelpList().success(function(t){e.helpData=t.data.second})},e.goHelpDetail=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,o).addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(){e.loadData()})}]),APP.service("HelpService",["$http","UrlService",function(e,t){this.getHelpList=function(){return e.get(t.getUrl("SHUNGUANG_HELP"))}}]),APP.controller("OrderDetailController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u){o.orderSnDetail=a.orderSn,o.cOrderSnDetail=a.cOrderSn,o.userOrder="",o.orderDetailList=[];var g=r.getUser();o.loginMemberId=g.mid,o.uname=g.userName,o.userlevel=0,o.shareStoreId="";var m=a.cOrderId;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.init=function(){u.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})},o.goPayment=function(e,t){s.go("paymentxyz",{orderSn:e,totalAmount:t})},o.loadData=function(e,t){i.getOrderDetail(e,t).success(function(e){e.success&&(o.userOrder=e.data.loginMemberId==e.data.memberId,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier)})},o.goOrderTrack=function(e){s.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void n.showToast("退款受理中，请稍后刷新查看状态！");i.checkRefund(e).success(function(t){t.success?t.data&&t.data.isPackage?n.showConfirm("",t.data.packageMessage,function(t){t&&s.go("applyRefund",{cOrderSn:e})}):s.go("applyRefund",{cOrderSn:e}):n.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?s.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):s.go("productDetail",{productId:o.orderDetailList.productId,o2oType:o.orderDetailList.o2oType,storeId:o.orderDetailList.ckCode})},o.asse=function(e,t,o){s.go("publicationEvaluation",{cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),s=null;s=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,s.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(p.nextDirection("forward"),s.go("orderManage")):n.showToast(e.message)})}n.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.ml20={"margin-left":50},o.ml0={"margin-left":0},o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,m=a.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.cOrderSnDetail,m),o.init()}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.service("OrderDetailService",["$http","UrlService",function(e,t){this.getOrderDetail=function(o,s){var i={cOrderSn:o,cOrderId:s};return e.get(t.getUrl("ORDER_DETAIL"),i)},this.checkRefund=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CHECK_REFUND"),s)},this.customService=function(){return t.getUrl("CUSTOMER_SERVE")}}]),APP.controller("OrderManageController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){function w(e){e&&(n.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),s(function(){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,"")},1e3))}function y(e){e?n.deleteOrder(b).success(function(e){e.success?t.init():(g.showToastShort(e.message),b="")}).error(function(e){g.showToastShort("删除失败！"),b=""}):b=""}t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=0,t.isIos=!1,t.BDO=!1;var T,C="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var b="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType=o.orderType?o.orderType:"全部订单",t.orderFlag=o.orderFlag?o.orderFlag:0,t.orderStatus=o.orderStatus?o.orderStatus:0,t.availableToTop(),t.loadOrderList(!1,t.orderFlag,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),I.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.batchDeleteOrder=function(){i.go("batchDeleteOrder")},t.loadOrderList=function(e,o,s,i,a,c,l,d){n.getOrderList(o,s,i,a,c,d).success(function(i){if(i.success){if("closed"==s?(T=i.data.canDeleteAll,i.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(T=!1,t.BDO=!1),t.emptySearch=!1,i.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(i.data.orders);else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=t.orderList.concat(i.data.orders);else if(l)t.searchOrderList=i.data.orders;else if(3==o)for(var a=i.data.orders,n=0,c=a.length;n<c;n++)1==a[n].zActivityOrder&&t.orderList.push(a[n]);else t.orderList=i.data.orders;l?t.hasMoreDataSearch=i.data.orderProductSize:t.hasMoreData=i.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,s){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var a=e,n="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?$.getAliPayInfo(a,s,n).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");C=e.result,window.alipay.pay({payInfo:C},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:a,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+a,price:s,notifyUrl:n},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};p.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,s,a,n){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};p.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else u.alert({template:e.message,okText:"知道了"})})}else u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+s+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,s,a){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:u.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){i.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};p.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):i.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,s){e.getOrderList(t).success(function(e){0==e.success?g.showToast(e.message):(couponLists=e.data.couponList,couponLists.length>0&&s?i.go("Retainage",{relationOrderSn:t}):i.go("paymentxyz",{orderSn:t}))})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.searchModal.hide(),i.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){i.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,s,a,n,r){r&&t.closeSearchModal(),i.go("orderDetail",{orderSn:e,cOrderSn:o,cOrderId:a})},t.goAssess=function(e,t,o){o?i.go("assess",{orderId:e,cOrderSn:t}):i.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?i.go("lookAssess",{orderId:e,cOrderSn:t}):i.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",w,"确定")},t.confirmReceive=function(e,o,s){function a(e){e&&S.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',a,"确认"):i.go("confirmReceive",{orderId:s})},t.goBack=function(){if(t.orderFlag=0,t.orderStatus="",t.search.keyWord="",t.pageIndex=0,t.hasMoreData=!1,t.orderList=[],!m.backView())return i.go("homePage"),void m.clearCache();if("batchDeleteOrder"==m.viewHistory().backView.stateName)m.goBack(-2);else{if("afterOrderSubmit"==m.viewHistory().backView.stateName)return void m.goBack(-3);if("ccbPay"==m.viewHistory().backView.stateName||"paymentxyz"==m.viewHistory().backView.stateName||"ccbfenqi"==m.viewHistory().backView.stateName||"orderConfirm"==m.viewHistory().backView.stateName)return i.go("personnalCenter"),void m.clearCache();if("payResultSuccess"==m.viewHistory().backView.stateName||"payResultFailure"==m.viewHistory().backView.stateName||"confirmReceive"==m.viewHistory().backView.stateName)return i.go("personnalCenter"),void m.clearCache()}m.backView()&&m.backView().url.indexOf("login")>0?m.goBack(-2):m.goBack()},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.BDO=!!T,"back"==o.direction?I.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1}):t.init()}),a.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){i.go("orderSearch")},t.closeSearchModal=function(){t.searchModal.hide(),t.availableToTop()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndex=0,t.loadOrderList(!1,0,"",t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){b=e,g.showConfirm("","确认删除此订单？",y,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("4")})}]),APP.service("OrderManageService",["$http","UrlService",function(e,t){this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,pageIndex:i,pageSize:a,keyword:n};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(){return e.get(t.getNewUrl("ORDER_AMOUNT"))},this.cancelOrder=function(o,s){var i={orderId:o,cancelFlag:s};return e.get(t.getUrl("CANCEL_ORDER"),i)},this.payOrder=function(o){var s={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),s)},this.deleteOrder=function(o){var s={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),s)}}]),APP.filter("cut",function(){return function(e,t,o,s){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var i=e.lastIndexOf("");-1!=i&&(e=e.substr(0,i))}return e+(s||"…")}}),APP.controller("OrderTrackingController",["$localstorage","$scope","OrderTrackingService","$stateParams","PopupService","$timeout","UrlService","$state",function(e,t,o,s,i,a,n,r){t.customerServe=function(){if(window.cordova){var o=ionic.Platform.isAndroid(),s=null;s=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&a(function(){s.executeScript({
code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else t.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+t.kfTocken);return},t.orderSn=s.orderSn,t.orderTrackingData=[],t.Tracks=[],t.loadData=function(e){o.getOrderTracking(e).success(function(e){e.success?(t.Tracks=e.data.orderWorkFlowsViewA[0].orderWorkFlowList,t.orderTrackingData=e.data.orderWorkFlowsViewA):e.message?i.showToast(e.message):i.showToast("获取物流信息失败！")})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},t.showTrajectory=function(e,t){var o="http://wx.rrskx.com/rrswx/view/order/orderDetail.jsp?orderId=";0==n.getEnviroment()&&(o="http://wx.rrskx.com/rrswx-test/view/order/orderDetail.jsp?orderId="),e?o=o+"JSG"+t:o+=t,window.emc?window.emc.presentH5View(o,"车辆轨迹"):window.location.href=o},t.$on("$ionicView.beforeEnter",function(){t.loadData(t.orderSn)})}]),APP.service("OrderTrackingService",["$http","UrlService",function(e,t){this.getOrderTracking=function(o){var s={orderSn:o};return e.get(t.getUrl("ORDER_TRACKING"),s)},this.getCDKToken=function(){return e.get(t.getUrl("GET_CDK_TOKEN"))}}]),APP.service("PartnerDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getPartnerMessage=function(o,s){var i={ownerId:o,relationshipType:s};return e.get(t.getUrl("PARTNER_DETAIL"),i)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("RefundDetailController",["$localstorage","$http","RefundDetailService","$scope","$stateParams","PopupService","$timeout",function(e,t,o,s,i,a,n){s.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),o=null;o=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&n(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else s.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+s.kfTocken);return},s.orderProductId=i.orderProductId,s.memberId=i.memberId,s.orderTrackingData=[],s.orderTD="",s.loadData=function(e,t){o.getRefundDetail(e,t).success(function(e){e.success?(s.orderTrackingData=e.data.orderWorkFlowList,s.orderTD=e.data):e.message?a.showToast(e.message):a.showToast("获取物流信息失败！")})},s.$on("$ionicView.beforeEnter",function(){s.loadData(s.orderProductId,s.memberId)})}]),APP.service("RefundDetailService",["$http","UrlService",function(e,t){this.getRefundDetail=function(o,s){var i={orderProductId:o,memberId:s};return e.get(t.getUrl("REFUND_DETAIL"),i)}}]),APP.controller("RevenueDetailController",["$scope","$stateParams","RevenueDetailService","$rootScope","$ionicPopup","PlatformService","ionicDatePicker","$timeout",function(e,t,o,s,i,a,n,r){function c(e){var e=e.getFullYear()+"年"+(e.getMonth()+1>9?e.getMonth()+1:"0"+(e.getMonth()+1))+"月"+(e.getDate()>9?e.getDate():"0"+e.getDate())+"日";return e}function l(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,s=e.getDate(),i=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);1==o?(t=e.getFullYear()-1,o=12):o-=1,(t%4==0&&t%100!=0||t%400==0)&&(i[2]=29),i[o]<s&&(s=i[o]),s<10&&(s="0"+s),o<10&&(o="0"+o);var a=t+"年"+o+"月"+s+"日";return a}e.nulldata=!1,e.type=t.code,e.title=t.title,e.revenueList=[],e.total="",e.reward={},e.rewardO={},e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardXY=!1,e.startTime="",e.endTime="",e.rewardStart="",e.rewardEnd="",e.earningType=t.earningType;var d=0;e.init=function(){e.earningType=t.earningType,d=0,e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardYC=!1,e.isRewardXY=!1,4==e.type?(e.rewardStart=l(),e.rewardEnd=c(new Date)):(e.rewardStart="",e.rewardEnd=""),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)},e.loadData=function(t,s,i,a,n,r,c){o.getRevenueList(t,s,i,a,n,r,c).success(function(t,o,i,a){e.nulldata=!1,t.success?(e.total=t.data.total,t.data.reward&&(e.reward=t.data.reward),t.data.rewardO&&(e.rewardO=t.data.rewardO),1!=s&&"0"==e.total&&""==t.data.rewardO.expectBrokerage&&""==t.data.rewardO.expectMonth&&""==t.data.rewardO.expectOpen&&""==t.data.rewardO.expectOpenCommend&&""==t.data.rewardO.expectRecommend&&""==t.data.rewardO.expectLeader&&""==t.data.rewardO.expectDzLeader&&""==t.data.rewardO.expectXyAmount&&""==t.data.rewardO.expectThreeLevel&&(e.nulldata=!0),t.data.rewardA&&(e.isRewardA=!0),t.data.rewardB&&0!=t.data.rewardB.length&&(e.isRewardB=!0),t.data.rewardC&&0!=t.data.rewardC.length&&(e.isRewardC=!0),t.data.rewardY&&0!=t.data.rewardY.length&&(e.isRewardY=!0),t.data.rewardZ&&0!=t.data.rewardZ.length&&(e.isRewardZ=!0),t.data.rewardTZ&&0!=t.data.rewardTZ.length&&(e.isRewardTZ=!0),t.data.rewardD&&0!=t.data.rewardD.length&&(e.isRewardD=!0),t.data.rewardXY&&0!=t.data.rewardXY.length&&(e.isRewardXY=!0)):e.revenueList=[],e.$broadcast("scroll.infiniteScrollComplete")})},e.chooseTime=function(){e.startTime=e.rewardStart,e.endTime=e.rewardEnd;var t=i.show({cssClass:"xvv-popupTime",template:'<div class="xvv-Time"><div>选择时间</div><div ng-click="lookDateModel(1)"><p>开始</p><p>{{startTime}}</p></div><div><img src="http://cdn09.ehaier.com/shunguang/H5/www/img/goOrder@2x.png"/></div><div ng-click="lookDateModel(2)"><p>结束</p><p>{{endTime}}</p></div></div>',scope:e,buttons:[{text:"取消"},{text:"确定",type:"button-positive",onTap:function(o){o.preventDefault(),e.rewardStart=e.startTime,e.rewardEnd=e.endTime,t.close(),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)}}]})},e.lookDateModel=function(t){if("APP"==a.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),r(function(){1==t&&(e.startTime=a+"年"+i+"月"+s+"日"),2==t&&(e.endTime=a+"年"+i+"月"+s+"日")},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i),1==t&&(e.startTime=new Date(o).getFullYear()+"年"+s+"月"+i+"日"),2==t&&(e.endTime=new Date(o).getFullYear()+"年"+s+"月"+i+"日")}};n.openDatePicker(s)}},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()})}]),APP.service("RevenueDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n,r,c){var l={earningType:o,type:s,rewardType:i,page:a,pageSize:n,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]),APP.controller("SecondManageController",["$scope","SecondManageService","UserService","UrlService","PopupService","CreditService",function(e,t,o,s,i,a){e.search={keyWords:""},e.pageIndex=0,e.pageSize=10,e.hasMoreData=!1,e.secondMemberDate=[],e.secondMemberList=[],e.rank=2,e.showShare=!1,e.init=function(){e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t}));o.getUser();e.rank=2,e.getCode(),e.loadData(!1,"",0,e.pageSize,e.rank)},e.getSecAndThi=function(t){e.rank=t,e.search.keyWords="",e.loadData(!1,e.search.keyWords,0,e.pageSize,e.rank)},e.getCode=function(){t.doGetCode().success(function(t){e.mid=t.data.promotionCode})},e.loadData=function(o,s,i,a,n){t.getSecAndThi(s,i,a,n).success(function(t){t.success&&(e.secondMemberDate=t.data,o?e.secondMemberList=e.secondMemberList.concat(t.data.memberInfo):(e.pageIndex=0,e.secondMemberList=t.data.memberInfo),e.hasMoreData=t.data.memberExist,(t.data.memberInfo&&t.data.memberInfo.length<10||!t.data.memberInfo)&&(e.hasMoreData=!1),e.isHaveDate=t.data.memberExist),o&&e.$broadcast("scroll.infiniteScrollComplete")})},e.loadMore=function(){e.pageIndex++,e.loadData(!0,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.searchSecondMember=function(){e.pageIndex=0,e.loadData(!1,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=o.getUser().avatarImageFileId,i=s.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?window.umeng.share("成为我的合伙人，一起赚丰厚佣金！","有梦就有店，高收入0投资，挣钱真简单～",t,i,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var i="成为我的合伙人，一起赚丰厚佣金！",n="有梦就有店，高收入0投资，挣钱真简单～",r=o.getUser().avatarImageFileId,c=s.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?(0==t?window.umeng.shareToSina(i,n,r,c,0,null,a.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(i,n,r,c,0,null,a.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(i,n,r,c,0,null,a.shareSuccessCallback):3==t?(window.umeng.shareToQQ(i,n,r,c,0,null,a.shareSuccessCallback),a.qqShare()):4==t?(window.umeng.shareToQzone(i,n,r,c,0,null,a.shareSuccessCallback),a.qqShare()):5==t&&e.copeText(c),a.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SecondManageService",["$http","UrlService",function(e,t){this.getSecAndThi=function(o,s,i,a){var n={keyword:o,pageIndex:s,pageSize:i};return 2==a?e.get(t.getUrl("SECOND_MANAGE"),n):e.get(t.getUrl("THIRD_MANAGE"),n)},this.doGetCode=function(){return e.get(t.getUrl("GETTUIGUANGMA"))}}]),APP.controller("SetShopCoverController",["$scope","SetShopCoverService","UserService","$ionicPopup",function(e,t,o,s){e.shopCoverList=[],e.storeId=o.getUser().mid,e.init=function(){e.getCover(e.storeId)},e.getCover=function(o){t.getShopCover(o).success(function(t,o,s,i){e.shopCoverList=t.data.shopCover})},e.chooseCover=function(o){var i=e.shopCoverList[o].coverUrl;t.setShopCover(i).success(function(t,o,i,a){e.getCover(e.storeId);var n=s.show({template:"修改店铺模板成功"});setTimeout(function(){n.close()},1e3)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.service("SetShopCoverService",["$http","UrlService",function(e,t){this.getShopCover=function(o){var s={storeId:o};return e.get(t.getUrl("GET_SHOP_COVER"),s)},this.setShopCover=function(o){var s={url:o};return e({method:"POST",url:t.getUrl("SET_SHOP_COVER"),params:s})}}]),APP.controller("ShopController",["$ionicViewSwitcher","$scope","UserService","ShopService","$ionicSlideBoxDelegate","$ionicScrollDelegate","MyStoreService","UrlService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","PopupService","MESSAGECENTERService","$rootScope","$state","BannerThemeService","$localstorage","VersionService","InAppBrowserService","$stateParams","$interval","$sce","CreditService","IMService","ManageMoneyService","LoginService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,P){t.flagNum=!1,t.tabNav="shop",t.storeInfo={},t.avatarImage="",t.slideImage=[],t.shareInfo={},t.user=o.getUser(),t.storeId="",t.btnList=[{url:"shopRevenue",icon:m.imgBaseURL+"img/btn_shop_revenue.png",name:"营收"},{url:"getCouponsList",icon:m.imgBaseURL+"img/btn_shop_coupon.png",name:"优惠券"},{url:"manageMoney",icon:"img/btn_shop_licai.png",name:"投资"},{url:"orderManage",icon:m.imgBaseURL+"img/btn_order_manager.png",name:"订单"},{url:"microSchool",icon:m.imgBaseURL+"img/btn_small_school.png",name:"微学堂"},{url:"teamSupervise",icon:m.imgBaseURL+"img/btn_two_management.png",name:"合伙人"},{url:"storeTeamOwner",icon:m.imgBaseURL+"img/btn_statistics.png",name:"统计"},{url:"vip",icon:m.imgBaseURL+"img/btn_storefront_renovation.png",name:"会员中心"}],t.showShare=!1;var x="",L="";t.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.topBtnCss4IOS={top:"12px"}),t.goMemberCenter=function(){T.getGameId(function(e){f.go("vip",{gameId:e})})},t.init=function(){s.getStoreInfo().success(function(e,o,s,i){t.storeInfo=e.data,t.storeId=t.storeInfo.ownerId,v.set("storeId",t.storeInfo.ownerId)}),s.getLevelInfoBefore().success(function(e){t.slideImage=e.data.banner,i.$getByHandle("shop_slider").update(),i.$getByHandle("shop_slider").loop(!0)}),s.getLevelInfo(function(e){e.success(function(e){if(t.avatarImageFileId=e.data.avatarImageFileId,t.userCurrentLevelId=e.data.userCreditWithLevel.order,t.userName=e.data.userCreditWithLevel.name,t.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel)if(t.levelArray=[],e.data.storeCreditWithLevel.order<=3){t.imgCount=e.data.storeCreditWithLevel.order;for(var o=0;o<e.data.storeCreditWithLevel.order;o++)t.levelArray.push(m.imgBaseURL+"img/Star-Grade@2x.png")}else for(var o=0;o<e.data.storeCreditWithLevel.order-3;o++)t.levelArray.push(m.imgBaseURL+"img/Diamond-Grade@2x.png")})},x),s.getMessage().success(function(e){t.msg=e.data.list[0].content,e.data.count>0?t.flagNum=!0:t.flagNum=!1}),$.checkVersion()},t.slideImageClick=function(e){"1"==t.slideImage[e].type?"主题活动"==t.slideImage[e].activityType?f.go("bannerTheme",{bannerId:t.slideImage[e].bannerId,platformType:t.slideImage[e].platformType}):"日常活动"==t.slideImage[e].activityType&&h.getBannerTheme(t.slideImage[e].bannerId,t.slideImage[e].platformType).success(function(o){f.go("bannerDaily",{bannerId:t.slideImage[e].bannerId,layout:o.data.layout,platformType:t.slideImage[e].platformType})}):"6"==t.slideImage[e].type&&f.go("crowdFunding")},t.share=function(){if(window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else{var e=t.storeInfo.storeName+"的顺逛小店",o=t.storeInfo.avatarImageFileId,s=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?window.umeng.share(e,"买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",o,s,0):alert("只能在app分享,请下载app！")}},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.storeInfo.storeName+"的顺逛小店",s="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",i=t.storeInfo.avatarImageFileId,a=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?(0==e?window.umeng.shareToSina(o,s,i,a,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,a,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):4==e?(window.umeng.shareToQzone(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):5==e&&t.copeText(a),T.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(e){function s(e){t.avatarImage=e,p(function(){t.avatarImage=e},200);var s=function(e){d.hide(),u.showToast("上传成功");var s=JSON.parse(e.response);t.avatarImage=s.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},i=function(e){d.hide(),u.showToast("上传失败")},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),s,i,a);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function i(e){}function a(e){t.avatarImage=e,p(function(){t.avatarImage=e},200);var s=function(e){u.showToast("上传成功"),d.hide();var s=JSON.parse(e.response);t.avatarImage=s.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},i=function(e){u.showToast("上传失败"),d.hide()},a=new FileUploadOptions;a.fileKey="imageFile",a.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),a.mimeType="image/jpeg";var n={};a.params=n,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),s,i,a);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function n(e){}1==e?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(a,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,s),p(function(){window.plugins.actionsheet.hide()},5e3)}else c.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},t.enter=function(o){if(-1!=o.indexOf("http"))if(window.cordova)if(m.isIOS)if(window.device.hasNewBrowser){var s=null;s=S.open(o),s.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else if(window.device.hasNewBrowser){var s=null;s=S.open(o),s.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else window.open(o,"_blank","location=yes");else-1!=o.indexOf("vip")?t.goMemberCenter():(f.go(o),e.nextDirection("forwoard"))},t.goNewHand=function(){-1!=navigator.userAgent.indexOf("iPhone")?S.open(r.getHead()+"mstore/sg/helpDetail.html?id=613","新手必读").addEventListener("exit",function(e){}):f.go("helpDetail",{helpId:"613",content:"新手必读"})},t.setSwitchFun=function(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,i=o.length-1;i>=0;i--)if(o[i].id==t)return m.isCommission=o[i].list[0].checked,m.cashSwitch=o[i].list[1].checked,m.goldRainSwitch=o[i].list[2].checked,void(s=!0);if(!s){m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0;var a={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(a),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var n=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(n)),m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0}},t.$on("$ionicView.beforeEnter",function(e,s){if(t.isApp=!!window.cordova||void 0,L=I.token)n.login(L).success(function(e){if(!e.success||null==e.data.mid)return void f.go("login");o.setUser(e.data),v.set("sg_login_token_secret","Bearer"+e.data.sessionValue),x=o.getUser().mid,A.checkOpenStore(x).success(function(e){e.data?(t.isBuyer="1",A.setRole(t.isBuyer),v.set("storeId",x)):(t.isBuyer="0",A.setRole(t.isBuyer),v.set("storeId",20219251))}),t.avatarImage=o.getUser().avatarImageFileId,a.scrollTop(),t.setSwitchFun(x),t.init()}).error(function(){f.go("login")});else{if(x=o.getUser().mid,t.avatarImage=o.getUser().avatarImageFileId,!o.getUser().mid)return void f.go("login");a.scrollTop(),t.setSwitchFun(x),t.init()}})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){this.getStoreInfo=function(){var o={noLoading:!0};return e({method:"POST",url:t.getUrl("GET_STORE_INFO"),params:o})},this.getLevelInfo=function(s,i){o.getGameId(function(o){s(e.get(t.getUrl("SHUNGUANG_VIP")+"?gameId="+o+"&memberId="+i))})},this.getLevelInfoBefore=function(){return e.get(t.getUrl("MY_STORE"))},this.getMessage=function(){return e.get(t.getUrl("MESSAGECENTER_INIT"))}}]),APP.controller("ShopRenovateController",["$scope","SetShopCoverService","UserService",function(e,t,o){e.shopCoverUrl="",e.storeId=o.getUser().mid,e.init=function(){t.getShopCover(e.storeId).success(function(t){for(var o=0,s=t.data.shopCover.length;o<s;o++)1==t.data.shopCover[o].selected&&(e.shopCoverUrl=t.data.shopCover[o].coverUrl)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.controller("ShopRevenueController",["$scope","$state","$ionicHistory","ShopRevenueService","PopupService","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n){function r(){s.isHasBindBankNum().success(function(e){e.success&&(p=e.data)})}function c(e){s.getAccountState(e).success(function(e){e.success&&(d=e.data)})}function l(){s.getTotalCommission().success(function(t){t.data.isLogin?e.totalCommission=t.data.totalReward:e.totalCommission=""}).error(function(e){})}e.styleFlag=!0,e.myInComeOut={},e.myTrendOut={},e.earningType="";var d=0;e.totalCommission="",e.messaegBalance="",e.numFlag=!0;var p="";e.init=function(){e.myInComeOut=[],e.myTrendOut=[],e.styleFlag=!0,e.earningType="B",e.loadData(7,e.earningType),r(),c(e.earningType),l(),s.getKjtBalance().success(function(t){t.success?(e.messaegBalance=t.data.a,window.localStorage.setItem("darcy_ktj_token",t.data.t),e.numFlag=!0):(e.messaegBalance=t.message,e.numFlag=!1)}).error(function(e){})},e.loadData=function(t,o){s.getRevenueInfo(t,o).success(function(t,o,s,i){e.myInComeOut=t.data.myInComeOut,e.myTrendOut=t.data.myTrendOut;for(var a=echarts.init(document.getElementById("shopRevenueChart")),n=e.myTrendOut.dates,r=0;r<e.myTrendOut.dates.length;r++)n=n.replace("'","");var c={grid:{show:!0,left:"10%",top:"5%",right:"5%",bottom:"15%",padding:20,backgroundColor:new echarts.graphic.LinearGradient(0,0,1,1,[{offset:0,color:"#1188D7"},{offset:1,color:"#3CA9F1"}])},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"line",lineStyle:{color:"rgba(255,255,255,0.2)",width:2}}},xAxis:{type:"category",boundaryGap:!1,data:n.split(","),axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede",width:1}},axisTick:{lineStyle:{color:"#dedede",width:1}}},yAxis:[{type:"value",backgroundColor:"#1188D7",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbol:"circle",showSymbol:!1,symbolSize:6,smooth:!0,areaStyle:{normal:{color:"rgba(255,255,255,0.10)"}},itemStyle:{normal:{borderWidth:2,borderColor:"#ffffff",color:"#1188D7",lineStyle:{color:"#ffffff",width:2}}},data:e.myTrendOut.values.split(",")}]};a.setOption(c)})};var u=!0;e.changeProductType=function(t,o){u&&(e.styleFlag=o,u=!1,e.earningType=t,e.loadData(7,e.earningType),setTimeout(function(){u=!0},500))},e.goHelpDetail=function(){-1!=navigator.userAgent.indexOf("iPhone")?a.open(n.getHead()+"mstore/sg/helpDetail.html?id=15","营收结算规则").addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:15,content:"营收结算规则"})},e.withdraw=function(){1==d||3==d||4==d||parseInt(p)>0?e.myInComeOut?t.go("mentionCenter",{canAmount:e.myInComeOut.canAmount}):t.go("mentionCenter",{canAmount:0}):t.go("bankCard")},e.goBack=function(){if(!o.backView()||"mentionCenter"==o.viewHistory().backView.stateName)return void t.go("homePage");o.backView()&&o.backView().url.indexOf("login")>0?o.goBack(-2):o.goBack()},e.closePopup=function(){e.loginIsAuthentication=!1},e.$on("$ionicView.beforeEnter",function(){e.loginIsAuthentication=!1,e.loginIsAuthenticationClose=!0,p="",e.init()})}]),APP.service("ShopRevenueService",["$http","UrlService",function(e,t){this.getRevenueInfo=function(o,s){var i={range:o,earningType:s};return e.get(t.getUrl("REVENUE_INFO"),i)},this.getAccountState=function(o){var s={earningType:o};return e.get(t.getUrl("GET_ACCOUNT_STATE"),s)},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))},this.activation=function(){return e.get(t.getUrl("KBIND_ACTIVATION"))},this.isHasBindBankNum=function(){return e.get(t.getUrl("BANK_HASBINGNUM_NEW"))},this.realName=function(){return e.get(t.getUrl("KBIND_REALNAME"))},this.getTotalCommission=function(){var o={startDate:"",endDate:""};return e({method:"POST",url:t.getUrl("GET_TOTAL_COMMISSION"),params:o})},this.getKjtBalance=function(){return e.get(t.getUrl("GETKJTACCOUNT"))}}]),APP.service("SpreadConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMessage=function(o,s,i){var a={partnerId:o,pageIndex:s,pageSize:i};return e.get(t.getUrl("SPREAD_CONNECTION"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("StatisticsController",["$ionicHistory","$q","$scope","$ionicHistory","$state","StatisticsService","$ionicScrollDelegate",function(e,t,o,e,s,i,a){function n(e,t){for(var o in e)e[o].storeName=i.limitStrLength(e[o].storeName,t)}function r(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=r(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=r(e[o]);return t}return e}function c(e){var o=t.defer();return o.resolve(r(e)),o.promise}o.backToLastView=function(){s.go("personnalCenter"),e.clearCache()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},o.switchType=function(e){o.typeState[e]||(o.typeState=[!1,!1],o.typeState[e]=!0,o.isPersonalStat=!o.isPersonalStat)},o.scrollToTop=function(){a.scrollTop({shouldAnimate:!0}),o.isShowScrollToTopButton=!1},o.watchScrollPosition=function(){a.getScrollPosition().top>10&&(o.isShowScrollToTopButton=!0)},o.switchConnectionType=function(e){0==o.connectionType[e]&&(o.connectionType=[!1,!1],o.connectionType[e]=!0,o.optionArr=[!0,!1],0==e&&o.hasPartner&&(c(o.partnerData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})),1==e&&o.hasConnection&&(c(o.connectionData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.connectionData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})))},o.switchOption=function(e){0==o.optionArr[e]&&(o.optionArr=[!1,!1],o.optionArr[e]=!0,o.isShowOption=!o.isShowOption)},o.closeOption=function(){o.isShowOption=!o.isShowOption},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e},o.timeTransform=function(e){var t=new Date;return t.setTime(e),t.Format("yyyy-MM-dd hh:mm:ss")},o.init=function(){i.getReportMessage().success(function(e){o.allData=e.data,0!=e.data.subLevelReportList.length?(o.hasSubLevel=!0,e.data.subLevelReportList[0]&&!$.isEmptyObject(e.data.subLevelReportList[0])?(o.hasPartner=!0,o.partnerData=e.data.subLevelReportList[0],e.data.subLevelReportList[1]&&!$.isEmptyObject(e.data.subLevelReportList[1])?(o.hasConnection=!0,o.connectionData=e.data.subLevelReportList[1],c(o.partnerData.brokerageReportList).then(function(e){n(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){n(e,o.totalStoreNameLength),o.totalContent=e})):(o.hasConnection=!1,c(o.partnerData.brokerageReportList).then(function(e){o.nowMonthContent=e,n(o.nowMonthContent,o.nowStoreNameLength)}),c(o.partnerData.brokerageReportList).then(function(e){o.totalContent=e,n(o.totalContent,o.totalStoreNameLength)}))):(o.hasPartner=!1,o.hasConnection=!1)):(o.hasSubLevel=!1,o.hasPartner=!1,o.hasConnection=!1)}),i.getReportMessagePlus().success(function(e){o.newBrokerageAmount=e.data.newBrokerageAmount,o.totalBrokerageAmount=e.data.totalBrokerageAmount})},o.$on("$ionicView.beforeEnter",function(){o.isPersonalStat=!1,o.typeState=[!0,!1],o.connectionType=[!0,!1],o.optionArr=[!0,!1],o.isShowOption=!1,o.isShowScrollToTopButton=!1,o.nowStoreNameLength=Math.floor(.21*(window.innerWidth-24)/13*4-3),o.totalStoreNameLength=Math.floor(.38*(window.innerWidth-24)/13*2-1),o.init()})}]),APP.service("StatisticsService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getReportMessage=function(){return e.get(t.getUrl("REPORT_DETAIL"))},this.getReportMessagePlus=function(){return e.get(t.getUrl("REPORT_DETAIL_PLUS"))},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("VRController",["$rootScope","$scope","UrlService","$sce","$ionicHistory","$stateParams",function(e,t,o,s,i,a){t.iframeUrl=s.trustAsResourceUrl(e.imgBaseURL+"VRshop/index.html");var n=a.isH5;t.goBack=function(){n?i.goBack():window.location.href="backToApp"}}]),APP.controller("WithdrawCashController",["$scope","$stateParams","WithdrawCashService","PopupService","$timeout","$ionicHistory","$state","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r,c){e.canAmount="",e.account="",e.canGetCash=!1,e.loadFinish=!1,e.init=function(){e.canGetCash=!1,t.canAmount?e.canAmount=t.canAmount:e.canAmount=0,e.canAmount>0&&(e.canGetCash=!0),e.loadFinish=!1,o.getMessage().success(function(t,o,i,a){t.success?t.data.kjtAccount&&(e.loadFinish=!0,e.account=t.data.kjtAccount.memberKjtpayAccount):(s.showToast(t.message),e.loadFinish=!1)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.getCashNow=function(){o.getCash(e.account).success(function(e,t,o,i){e.success?n.go("withdrawSuccess",{content:e.data.result}):s.showToast(e.message)})},e.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?r.open(c.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})}}]),APP.service("WithdrawCashService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.getCash=function(o){var s={kjtAccount:o};return e.get(t.getUrl("NEW_GETCASH_INIT"),s)}}]),APP.controller("WithdrawSuccessController",["$scope","$stateParams","$ionicHistory",function(e,t,o){e.content=t.content,e.goBack=function(){o.goBack(-2)}}]),APP.controller("batchDeleteOrderController",["$ionicHistory","$ionicPopup","$scope","PopupService","OrderManageService","BatchOrderService","$ionicScrollDelegate","$state","$ionicViewSwitcher","$rootScope",function(e,t,o,s,i,a,n,r,c,l){o.hasMoreData=!1,o.closeOrderData=[];var d=0;o.goBack=function(){c.nextDirection("enter"),r.go("orderManage")},o.loadData=function(){d=0,i.getOrderList(1,"closed",0,5,"").success(function(e){if(e.success){n.scrollTop(),o.isSelectAllOrder=!1,o.closeOrderData=e.data.orders,o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.image=[];for(var t=0;t<o.closeOrderData.length;t++)o.image[t]="img/ic_check.png"}})},o.loadMore=function(){d++,i.getOrderList(1,"closed",d,5,"").success(function(e){if(e.success){
for(var t=o.closeOrderData.length;t<e.data.orders.length+o.closeOrderData.length;t++)o.image[t]="img/ic_check.png",o.isSelectAllOrder=!1;o.closeOrderData=o.closeOrderData.concat(e.data.orders),o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.$broadcast("scroll.infiniteScrollComplete")}})},o.selectOrderAddress=function(e){o.chooseOrderNum=0,-1!=o.image[e].indexOf("check")?(o.image[e]="img/ic_select.png",o.chooseOrderNum++,o.isChooseOrder=!0):(o.image[e]="img/ic_check.png",o.chooseOrderNum--),o.chooseOrderNum==o.image.length?o.isSelectAllOrder=!0:o.isSelectAllOrder=!1},o.selectAllOrder=function(){if(o.isSelectAllOrder){for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_check.png";o.chooseOrderNum=0,o.isSelectAllOrder=!1}else{for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_select.png";o.isSelectAllOrder=!0,o.chooseOrderNum=o.image.length}},o.batchDelete=function(){o.isChooseOrder=!1;for(var e=0;e<o.image.length;e++)-1!=o.image[e].indexOf("select")&&(o.isChooseOrder=!0);if(!o.isChooseOrder)return void s.showToast("请选择要删除的订单");t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){if(e){for(var t="",s=[],i=0,n=o.image.length;i<n;i++)-1!=o.image[i].indexOf("select")&&s.push(o.closeOrderData[i].orderId);t=s.join(",");var l={orderIds:t};a.batchDelete(l).success(function(e){if(e.success){if(o.isSelectAllOrder&&!o.hasMoreData)return c.nextDirection("enter"),void r.go("orderManage");o.loadData()}})}})},o.$on("$ionicView.beforeEnter",function(){n.scrollTop(),d=0,o.image=[],o.chooseOrderNum=0,o.isChooseOrder=!1,o.isSelectAllOrder=!1,window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?o.isIosAndInApp=!0:o.isIosAndInApp=!1,window.cordova?o.isApp=!0:o.isApp=!1,o.isIosAndInApp&&(o.iosStyleOne={padding:"64px 0 90px 0"},o.iosStyleTwo={top:"20px"}),o.isApp?o.bottomDivHeight={height:"40px"}:o.bottomDivHeight={height:"120px"},o.loadData()})}]),APP.service("BatchOrderService",["$http","UrlService",function(e,t){this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ORDER"),o)}}]),APP.controller("chaseEvaluateController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","chaseEvaluateService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){function m(o){var s=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):n.showToast(o.message)},i=function(e){alert(e)},a=new FileUploadOptions,r=new Date,c=r.getTime();a.fileKey="imageFile",a.fileName=p.getUser.userName+c,a.headers={TokenAuthorization:g.get("sg_login_token_secret")},a.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),s,i,a)}function f(e){}var h=[],v=!0;e.goBack=function(){c.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?n.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(t){t?v&&(v=!1,u.submitEvaluateNew(e.wdOrderSn,e.commentObj.commentTt,h.join(",")).success(function(t){v=!0,t.success?t.data&&(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?n.showToast(t.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.$on("$ionicView.beforeEnter",function(){v=!0,e.wdOrderSn=o.cOrderSn,e.isMyOrder=1==o.isMeorder,e.commentObj={commentTt:""},e.imageCount=0,e.imageList=[],h=[]})}]),APP.service("chaseEvaluateService",["$http","UrlService",function(e,t){this.submitEvaluateNew=function(o,s,i){var a={cOrderSn:o,experienceContent:s,fileIds:i};return e({method:"POST",url:t.getUrl("ADD_ASSESS_SUBMIT"),params:a})}}]),APP.controller("criticalSuccessController",["$scope","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","UrlService","CreditService","criticalSuccessService",function(e,t,o,s,i,a,n,r,c,l,d,p){function u(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e){var t,o,s,i,a,n,r,c="",l=0;for(e=_utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),o=e.charCodeAt(l++),s=e.charCodeAt(l++),i=t>>2,a=(3&t)<<4|o>>4,n=(15&o)<<2|s>>6,r=63&s,isNaN(o)?n=r=64:isNaN(s)&&(r=64),c=c+_keyStr.charAt(i)+_keyStr.charAt(a)+_keyStr.charAt(n)+_keyStr.charAt(r);return c},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var s=e.charCodeAt(o);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}}var g=new u;e.thisTitleName="评价成功",e.goBack=function(){"lookAssess"==r.viewHistory().backView.stateName?r.goBack(-1):r.goBack(-2)},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"});var m;e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),a.showToastShort("复制成功")):a.showToast("请下载APP执行此操作")},e.shareToPlatform=function(t){m=encodeURIComponent(g.encode(e.wdOrderSn));var o=e.isCriticalShop.productName,s=e.isCriticalShop.productImg,i=l.getShareLinkHeader()+"useExperience/"+m;window.umeng?(0==t?window.umeng.shareToWechatSession("邀请评价",o,s,i,0,null,d.shareSuccessCallback):1==t&&window.umeng.shareToQQ("邀请评价",o,s,i,0,null,d.shareSuccessCallback),2==t?e.copeText(i):d.successShare()):alert("只能在app分享")},e.criticalInit=function(){p.criticalNo(e.wdOrderSn).success(function(t){t.success?(e.noCriticalOrderList=t.data.waitComments,e.isCriticalShop=t.data.productInfo,e.isMeOrder=t.data.isMyOrder,e.isStore=t.data.isStoreMember):a.showToastShort(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.thisTitleName="评价成功","lookAssess"==r.viewHistory().backView.stateName&&(e.thisTitleName="邀请评价"),e.wdOrderSn=t.cOrderSn,e.shareList=[{img:c.imgBaseURL+"img/mm-wechat.png",text:"微信"},{img:c.imgBaseURL+"img/qq.png",text:"QQ"},{img:c.imgBaseURL+"img/btn_link.png",text:"复制链接"}],e.criticalInit()})}]),APP.service("criticalSuccessService",["$http","UrlService",function(e,t){this.criticalNo=function(o){var s={cOrderSn:o};return e.get(t.getUrl("CRITICALSUC"),s)}}]),APP.controller("evaluationSuccessController",["$scope",function(e){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.$on("$ionicView.beforeEnter",function(){})}]),APP.controller("FinancialMoneyController",["InAppBrowserService","$rootScope","$scope","$state","FinancialMoneyService","UrlService","$stateParams",function(e,t,o,s,i,a,n){var r=a.getHead().replace("v3/","www/index.html");o.ssAuth=null,t.financialMoneyWhereId="","manageMoney"!=n.whereId&&(t.financialMoneyWhereId=n.whereId),o.loginUrl=r+"#/financialMoney/"+t.financialMoneyWhereId,o.returnUrl=r+"#/"+t.financialMoneyWhereId;o.$on("$ionicView.beforeEnter",function(){var e=window.location.href.indexOf("page=");if(-1!=e&&-1==window.location.href.indexOf("auth_code")){var t=unescape(window.location.href).substring(e+5);return void(window.location.href=t)}o.init()}),o.init=function(){function e(){i.checkKjtLogin().success(function(e){if(e.data.isLogin)o.ssAuth=e.data.token,angular.element("#hairongyi").submit();else{var s=r+"#/"+t.financialMoneyWhereId,i=r+"#/financialMoney/"+t.financialMoneyWhereId+"?page="+s,a=escape(i),n="https://zmgs.kjtpay.com/mgs/common/page.htm?page=authorizeMain&partner_id=200000055141&return_url="+a;window.location.href=n}})}var s=unescape(window.location.href);if(-1!=s.indexOf("auth_code")){var a=s.indexOf("auth_code")+10,n=s.toString().substr(a,32);i.getToken({authCode:n}).success(function(t){o.ssAuth=t.data.token,e()})}else e()}}]),APP.service("FinancialMoneyService",["$http","UrlService","UserService",function(e,t,o){this.getToken=function(o){return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:o})},this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))}}]),APP.controller("publicationEvaluationController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(o){var s=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):n.showToast(o.message)},i=function(e){alert(e)},a=new FileUploadOptions,r=new Date,c=r.getTime();a.fileKey="imageFile",a.fileName=p.getUser.userName+c,a.headers={TokenAuthorization:u.get("sg_login_token_secret")},a.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),s,i,a)}function m(e){}var f=[],h=[],v=!0;e.goBack=function(){c.goBack()},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}f=[],e.impressionArr.forEach(function(t){f.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.evaluateMethod=function(t){e.evaluateList=t},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?n.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(o){o?v&&(v=!1,t.submitEvaluationNew(e.wdOrderSn,e.commentObj.commentTt,e.evaluateList,e.valueAll.value1,e.valueAll.value3,e.valueAll.value2,h.join(","),f.join(","),e.isMeOrder,e.isStore).success(function(t){v=!0,t.success?t.data&&(n.showToastShort("商品评价成功！"),s(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?n.showToast(t.message):n.showToast("提交失败！")})):n.showToast("您的评论里面包含敏感词！")})},e.init=function(){t.evaluationInit(e.wdOrderSn).success(function(t){t.success?(e.isMeOrder=1==t.data.isMyOrder,e.isStore=0==t.data.isStoreMember,e.isMeOrder||e.isStore?e.placeholderText="您可以写下您的购物体验，供其他小伙伴参考哦！":e.placeholderText="您写下购物体验后，收货人会自动收到邀评短信，可进行详细的图文评价！",e.impressionStr=t.data.impression,e.productPic=t.data.productInfo.productImg):n.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f=[],v=!0,e.isMeOrder=!1,e.placeholderText="您写下购物体验后，收货人会自动收到邀评短信，可进行详细的图文评价！",e.wdOrderSn=o.cOrderSn,e.productPic="",e.commentObj={commentTt:""},e.valueAll={value1:"5",value2:"5",value3:"5"},e.impressionArr=[],e.impressionStr=[],e.evaluateList=5,e.imageCount=0,e.imageList=[],h=[],e.canCommit=!1,e.init()})}]),APP.service("publicationEvaluationService",["$http","UrlService",function(e,t){this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG_NEW")},this.checkAssessText=function(o){var s={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),s)},this.evaluationInit=function(o){var s={cOrderSn:o};return e.get(t.getUrl("EVALUCTION_NEW"),s)},this.submitEvaluationNew=function(o,s,i,a,n,r,c,l,d,p){if(d||p)var u={cOrderSn:o,commentContent:s,star:i,productStar:a,serviceStar:n,shippingStar:r,fileIds:c,impressions:l};else u={cOrderSn:o,commentContent:s,star:i};return e({method:"POST",url:t.getUrl("SUBMIT_EVALUCTION_NEW"),params:u})}}]),APP.directive("commentBarNew",[function(){return{restrict:"E",template:'<div>\n        <img ng-click = "comment(0)" ng-src=\'{{commentValue>=1?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(1)" ng-src=\'{{commentValue>=2?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(2)" ng-src=\'{{commentValue>=3?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(3)" ng-src=\'{{commentValue>=4?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(4)" ng-src=\'{{commentValue>=5?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n      </div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("useExperienceController",["$scope","$stateParams","$timeout","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$localstorage","$interval","useExperienceService","publicationEvaluationService","$ionicPopup",function(e,t,o,s,i,a,n,r,c,l,d,p,u){window.onerror=function(e,t,o,s,i){setTimeout(function(){})},document.querySelector("#file").addEventListener("change",function(){var t=this;lrz(t.files[0],{width:800}).then(function(t){e.$apply(function(){e.imageCount>=5?i.showToast("最多上传5张图片"):(e.imageList.push(t.base64),g.push(t.base64.replace("base64,","base64-")),e.imageCount++)})})});var g,m=[],f=!0;e.imageCount=0,e.imageList=[],e.isCanComment=!0,e.VCodeTips="获取验证码",e.canGetVcode=!0,e.userInfo={mobile:"",captcha:"",verificationCode:""},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.removeImage=function(t){u.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){o&&(e.imageList.splice(t,1),g.splice(t,1),e.imageCount--)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?i.showToast("请输入2～500字的评价！"):0==e.userInfo.mobile.length?i.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?0==e.userInfo.verificationCode.length?i.showToast("请输入短信验证码"):p.checkAssessText(e.commentObj.commentTt).success(function(t){t?f&&(f=!1,d.submitBuyerComment(e.wdOrderSn,e.userInfo.mobile,e.userInfo.verificationCode,e.commentObj.commentTt,g,m.join(","),e.valueAll.value1,e.valueAll.value3,e.valueAll.value2).success(function(e){f=!0,e.success?e.data&&(i.showToastShort("商品评价成功！"),o(function(){r.$broadcast("AFTER_COMMIT"),a.go("evaluationSuccess")},1e3)):e.message?i.showToast(e.message):i.showToast("提交失败！")})):i.showToast("您的评论里面包含敏感词！")}):i.showToast("请输入正确的手机号格式")},e.setImgCaptchaForPhone=function(){e.identifyCodeImg=d.getImgCaptchaNew()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},e.getVCode=function(){e.canGetVcode&&(e.userInfo.mobile.length<=0?i.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?e.userInfo.captcha.length<=0?i.showToast("请输入图形验证码"):d.fastLoginCaptchaNew(e.wdOrderSn,e.userInfo.mobile,e.userInfo.captcha).success(function(t){if(t.data){e.canGetVcode=!e.canGetVcode;var o=60;e.timer=l(function(){o-1<0?(e.VCodeTips="获取验证码",l.cancel(e.timer),e.canGetVcode=!0):(o--,e.VCodeTips=o+"s后可重发 ")},1e3)}else i.showToast(t.message)}):i.showToast("请输入正确的手机号格式"))},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}m=[],e.impressionArr.forEach(function(t){m.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.useExperienceInit=function(t){d.userCommentPage(t).success(function(t){t.success?(e.productObj=t.data.productInfo,e.impressionStr=t.data.impression,e.isCanComment=t.data.status):i.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){g=[],f=!0,l.cancel(e.timer),e.productObj=[],e.impressionStr=[],l.cancel(e.timer),e.wdOrderSn=t.cOrderSn,e.useExperienceInit(e.wdOrderSn),e.setImgCaptchaForPhone(),m=[],e.commentObj={commentTt:""},e.valueAll={value1:5,value2:5,value3:5},e.impressionArr=[],e.impressionStr=[],e.canCommit=!1}),e.$on("$ionicView.beforeLeave",function(){l.cancel(e.timer)})}]),APP.service("useExperienceService",["$http","UrlService",function(e,t){this.getImgCaptchaNew=function(){return t.getUrl("GET_IMG_CAPTCHA_NEW")},this.fastLoginCaptchaNew=function(o,s,i){var a={cOrderSn:o,mobile:s,imgCaptcha:i};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA_COMMENT"),params:a})},this.userCommentPage=function(o){var s={cOrderSn:o};return e.get(t.getUrl("USER_COMMENT_PAGE"),s)},this.submitBuyerComment=function(o,s,i,a,n,r,c,l,d){var p={cOrderSn:o,mobile:s,mobileCode:i,userCommentContent:a,imageFile:n,impressions:r,productStar:c,serviceStar:l,shippingStar:d};return e({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:t.getUrl("SUBMIT_BUYER_COMMENT"),transformRequest:function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:p})}}]),APP.controller("teamMessageController",["$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","teamMessageService","UserService","UrlService","PopupService","CreditService","$state",function(e,t,o,s,i,a,n,r,c,l){s.isBasics=!1,s.userId=e.memberId,s.selectedIndex=0,s.orderFlag=3,s.orderStatus=0,s.pageIndex=0,s.pageSize=10,s.typeTeam=e.type,s.goBack=function(){t.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingtopClasscontent={top:"276px"}):(s.androidClass={"line-height":"44px"},s.paddingtopClasscontent={top:"260px"}),s.switchCheck=function(e){o.scrollTop(),s.isBasics=0!=e,1==e&&(s.selectedIndex=0,s.orderInit(s.selectedIndex)),1==s.checkArr[e]||(s.hasMore=!0,s.pageIndex=0,s.checkArr=[!1,!1],s.checkArr[e]=!s.checkArr[e],s.relationshipType=0==e?1:2,s.init())},s.backToLastView=function(){l.go("teamSupervise"),t.clearCache()},s.gotoPartnerDetail=function(e,t){1==t?l.go("partnerDetail",{ownerId:e}):l.go("connectionDetail",{ownerId:e})},s.gotoSpreadConnection=function(e){l.go("spreadConnection",{partnerId:e})},s.init=function(){i.getConnectionMsg(s.userId).success(function(e){e.success&&(s.productList=e.data,s.firstOrderTime=s.productList.firstOrderTime)})},s.orderInit=function(e){i.getOrderList(s.orderFlag,e,s.userId,s.pageIndex,s.pageSize).success(function(e){e.success&&(s.orders=e.data.orders,s.hasMore=e.data.orders.length<e.data.countResult)})},s.orderByList=function(e){s.selectedIndex=e,s.pageIndex=0,o.scrollTop(),s.orderInit(s.selectedIndex)},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.loadMore=function(){s.pageIndex++,i.getOrderList(s.orderFlag,s.selectedIndex,s.userId,s.pageIndex,s.pageSize).success(function(e){e.success&&(e.data.orders.length<e.data.countResult?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMore=!0,s.orders=s.orders.concat(e.data.orders)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMore=!1))})},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void o.scrollTop();o.scrollTop(),s.relationshipType=1,s.checkArr=[!0,!1],s.hasMore=!0,s.init(s.userID),s.orderFlag=3,s.orderStatus=0,s.pageIndex=0,s.pageSize=10})}]),APP.service("teamMessageService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o){var s={memberId:o};return e.get(t.getUrl("TEAM_USERINFO"),s)},this.getOrderList=function(o,s,i,a,n){var r={orderFlag:o,orderStatus:s,queryMemberId:i,pageIndex:a,pageSize:n,noLoading:!0};return e.get(t.getUrl("ORDER_LIST"),r)}}]),APP.controller("teamSuperviseController",["$ionicPopup","$state","UserService","$scope","CLASSIFYMESSAGECRNTERService","$localstorage","$rootScope","teamSuperviseService","$stateParams","$ionicScrollDelegate","UrlService","CreditService","PopupService","HomePageService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){s.productList=[],s.childrenList=[],s.rowsList=[],s.isFindTab=!0,s.selectedIndex=0,s.isUserShow=!1,s.isTeamInfo=!1,s.isUser=!1,s.page=1,s.cascade=!1,s.isTeam=!0,s.sortIndex=0,s.sortInd=0,s.sortNum=2,s.pageSize=10,s.userpageSize=10,s.orderOrTeams=!1,s.sortsIndex=1,s.messageImgFlag=!0,s.flagNum=!1,s.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png",s.arrowState=[n.imgBaseURL+"img/sortT.png",n.imgBaseURL+"img/sortF.png"],s.Math=window.Math;var m=["startTime","isAuthenticated","teamLevelOrder","isActive"],f=["shopKeepers","purchasedNum","recentBuyingTime"];s.memberId=o.getUser().mid,s.substring=window.substring,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingContentClass={top:"0px"}):(s.paddingtopClass={"padding-top":"0"},s.paddingContentClass={top:"0px"}),s.init=function(){g.getUnReadMsg().success(function(e){e.data>0?s.flagNum=!0:s.flagNum=!1})},s.share=function(){if(window.device&&window.device.hasNewShare)s.showShare=!s.showShare;else{var e=o.getUser().avatarImageFileId,t=d.getShareLinkHeader()+"register/0/"+s.productList.owner.promotionCode;window.umeng?window.umeng.share("顺逛店主邀请你一起瓜分5亿佣金","海尔社群交互平台，零成本创业APP，一起来赚钱吧",e,t,0):alert("只能在app分享,请下载app！")}},s.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastWithTime("复制成功",2e3)):u.showToast("请下载APP执行此操作")},s.hideblackCover=function(){s.showShare=!1},s.shareToPlatform=function(e){var t="我正在使用顺逛APP，推荐给你哦",i="时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",a=o.getUser().avatarImageFileId,n=d.getShareLinkHeader()+"register/0/"+s.productList.owner.promotionCode;window.umeng?(0==e?window.umeng.shareToSina(t,i,a,n,0,null,p.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,i,a,n,0,null,p.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,i,a,n,0,null,p.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,i,a,n,0,null,p.shareSuccessCallback),p.qqShare()):4==e&&(window.umeng.shareToQzone(t,i,a,n,0,null,p.shareSuccessCallback),p.qqShare()),5==e?s.copyText(n):p.successShare()):alert("umeng undefined 只能在app分享"),s.showShare=!1},s.lookreferee=function(){var t=e.show({template:'<div style="color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;margin-top:-12px">推荐人信息</div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">我的推荐人 : <b>{{myheader.realName}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">ID : <b>{{myheader.memberId}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:-5px;position:relative;">手机号 : <b>{{myheader.mobile}}</b>&nbsp;&nbsp;<img ng-src="{{imgBaseURL}}img/headerphone.png" width="20" heihgt="20" style="position:absolute;top:-2px;" ng-click="cellphone()"/></div>',scope:s,buttons:[{text:"<b>确定</b>",type:"button-positive",onTap:function(e){e.preventDefault(),t.close()}}]})},s.cellphone=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+s.myheader.mobile,"_system"):window.open("tel:"+s.myheader.mobile)},s.userM=function(){r.userData(s.memberId,s.page,s.pageSize,f[2],s.orderIndex).success(function(e){e.success&&(s.usersNumber=e.data.total)})},s.goMemberCenter=function(){p.getGameId(function(e){t.go("vip",{gameId:e})})},s.commontFun=function(e){l.scrollTop(),0==s.selectedIndex?(s.orderOrTeams=!1,s.info=0):1==s.selectedIndex&&(s.orderOrTeams=!0,s.info=1),r.doInit(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[e],s.orderIndex,s.active,s.store).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.usercomFun=function(e){r.userData(s.memberId,s.page,s.userpageSize,f[e],s.orderIndex).success(function(e){e.success&&(s.rowsList=e.data.rows,s.hasmore=s.rowsList.length<e.data.total)})},s.teamClickFun=function(e){l.scrollTop(),s.sortInd=e,s.page=1,0==s.sortsIndex?(s.sortsIndex=1,s.orderIndex="desc",s.commontFun(s.sortInd,s.orderIndex)):1==s.sortsIndex&&(s.sortsIndex=0,s.orderIndex="asc",s.commontFun(s.sortInd,s.orderIndex))},s.teamTrueAttestation=function(e){l.scrollTop(),s.sortInd=e,s.isAuthenticated=2,s.orderIndex="desc",s.page=1,s.childrenList=[],s.commontFun(s.sortInd)},s.teamLevel=function(e){s.childrenList=[],s.sortInd=e,s.orderIndex="desc",s.page=1,s.commontFun(s.sortInd)},s.teamActive=function(e){s.sortInd=e,s.isActiveNum=2,s.isAuthenticated=2,s.orderIndex="desc",s.page=1,s.childrenList=[],s.commontFun(s.sortInd)},s.userClickFun=function(e){s.sortNum=e,s.orderIndex="desc",s.page=1,s.usercomFun(s.sortNum)},s.userNumber=function(e){s.sortNum=e,s.orderIndex="desc",s.page=1,s.usercomFun(s.sortNum)},s.userTime=function(e){s.sortNum=e,s.page=1,0==s.sortsIndex?(s.sortsIndex=1,s.orderIndex="desc",s.usercomFun(s.sortNum,s.orderIndex)):1==s.sortsIndex&&(s.sortsIndex=0,s.orderIndex="asc",s.usercomFun(s.sortNum,s.orderIndex))},s.goBack=function(){s.$ionicGoBack()},s.getShopData=function(){r.doInit(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[s.sortIndex],s.orderIndex).success(function(e){e.success&&(e.data.parent?(s.hasparent=!0,s.myheader=e.data.parent):s.hasparent=!1,s.productList=e.data,s.childrenList=e.data.children,s.unauthenticatedNum=Math.floor(e.data.total-e.data.authenticatedNum),s.unactiveNum=Math.floor(e.data.total-e.data.unActiveNum),s.hasmore=s.childrenList.length<e.data.total)})},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.Reps=function(e){if(e)return e.substring(0,1)},s.teamTab=function(e){s.selectedIndex=e,s.sortInd=0,s.page=1,s.orderIndex="desc",s.childrenList=[],s.rowsList=[],l.scrollTop(),0==s.selectedIndex?(s.sortsIndex=1,s.orderIndex="desc",s.isTeam=!0,s.isTeamInfo=!1,s.isUserShow=!1,s.isUser=!1,s.isAuthenticated=2,s.isActiveNum=2,s.commontFun(s.sortInd,s.orderIndex)):1==s.selectedIndex?(s.isTeam=!0,s.isUserShow=!1,s.isTeamInfo=!1,s.isUser=!1,s.sortsIndex=1,s.orderIndex="desc",s.isAuthenticated=2,s.isActiveNum=2,s.commontFun(s.sortInd,s.orderIndex)):2==s.selectedIndex&&(s.isTeam=!1,s.isTeamInfo=!0,s.isUserShow=!0,s.isUser=!0,s.sortNum=2,s.orderIndex="desc",s.sortsIndex=1,s.usercomFun(s.sortNum,s.orderIndex))},s.storeFun=function(e){r.newStore(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[1],s.orderIndex,e).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.storeMoreFn=function(e,t){r.storeMore(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex,t).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.Authenticated=function(e){s.isAuthenticated=e,0==e?(s.page=1,s.store=!1,s.storeFun(s.store)):1==e&&(s.page=1,s.store=!0,s.storeFun(s.store))},s.activeFun=function(e){r.newActive(s.memberId,s.orderOrTeams,s.page,s.pageSize,m[3],s.orderIndex,e).success(function(e){e.success&&(s.productList=e.data,s.childrenList=e.data.children,s.hasmore=s.childrenList.length<e.data.total)})},s.activeMoreFn=function(e,t){r.activeMore(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex,t).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.isActive=function(e){l.scrollTop(),s.isActiveNum=e,0==e?(s.page=1,s.active=!1,s.activeFun(s.active)):1==e&&(s.page=1,s.active=!0,s.activeFun(s.active))},s.userLoadMore=function(e){r.userData(s.memberId,e,s.userpageSize,f[s.sortNum],s.orderIndex).success(function(e){e.success&&(s.rowsList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.rowsList=s.rowsList.concat(e.data.rows)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.teamLoadMore=function(e){r.doInit(s.memberId,s.orderOrTeams,e,s.pageSize,m[s.sortInd],s.orderIndex).success(function(e){e.success&&(s.childrenList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.childrenList=s.childrenList.concat(e.data.children)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.loadMore=function(){0==s.sortInd&&(0==s.selectedIndex||1==s.selectedIndex)||2==s.sortNum&&2==s.selectedIndex?0==s.sortsIndex?s.orderIndex="asc":1==s.sortsIndex&&(s.orderIndex="desc"):s.orderIndex="desc",0==s.selectedIndex&&(0==s.sortInd||2==s.sortInd)||1==s.selectedIndex&&(0==s.sortInd||2==s.sortInd)?(s.page++,s.teamLoadMore(s.page)):(0!=s.selectedIndex||1!=s.sortInd&&3!=s.sortInd)&&(1!=s.selectedIndex||1!=s.sortInd&&3!=s.sortInd)||(0==s.isActiveNum?(s.active=!1,s.page++,s.activeMoreFn(s.page,s.active)):1==s.isActiveNum?(s.active=!0,s.page++,s.activeMoreFn(s.page,s.active)):0==s.isAuthenticated?(s.store=!1,s.page++,s.storeMoreFn(s.page,s.store)):1==s.isAuthenticated?(s.store=!0,s.page++,s.storeMoreFn(s.page,s.store)):(s.page++,s.teamLoadMore(s.page))),2==s.selectedIndex&&(s.page++,s.userLoadMore(s.page))},s.commonFn=function(){l.scrollTop(),s.rowsList=[],s.productList=[],s.childrenList=[],s.selectedIndex=0,s.sortInd=0,s.sortNum=2,s.page=1,s.memberId=o.getUser().mid,s.store=!0,s.active=!0,s.isTeam=!0,s.isUser=!1,s.isUserShow=!1,s.isTeamInfo=!1,s.orderIndex="desc",s.hasmore=!0,s.sortIndex=0,s.getShopData()},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void g.getUnReadMsg().success(function(e){e.data>0?s.flagNum=!0:s.flagNum=!1});s.commonFn(),s.userM(),s.init()})}]),APP.service("teamSuperviseService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l){var d={withParent:!0,memberId:o,cascade:s,pageNumber:i,
pageSize:a,sort:n,order:r};return e.get(t.getUrl("TEAM_SUPERVISE"),d)},this.storeMore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.activeMore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newStore=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newActive=function(o,s,i,a,n,r,c){var l={memberId:o,cascade:s,pageNumber:i,pageSize:a,sort:n,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.userData=function(o,s,i,a,n){var r={memberId:o,pageNumber:s,pageSize:i,sort:a,order:n};return e.get(t.getUrl("TEAM_USERS"),r)}}]),APP.controller("userMessageController",["$state","$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","userMessageService","$rootScope",function(e,t,o,s,i,a,n){i.userId=t.memberId,i.name=t.name,i.mobile=t.mobile,i.isTeamNum=t.isTeamNum,i.page=1,i.pageSize=20,i.sortsIndex=2,i.arrowState=[n.imgBaseURL+"img/sortT.png",n.imgBaseURL+"img/sortF.png",n.imgBaseURL+"img/sort2.png"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingtopClasscontent={top:"246px"},i.teamInfos={top:"46%"}):(i.paddingtopClass={"padding-top":"0"},i.paddingtopClasscontent={top:"220px"},i.teamInfos={top:"36%"}),i.init=function(){a.getConnectionMsg(i.mobile,i.page,i.pageSize).success(function(e){e.success&&(i.productList=e.data,i.userList=e.data.rows,i.hasmore=i.userList.length<e.data.total)})},i.priceRange=function(e){var t=Math.floor(e/1e3);return t>=20?1e3*t+"~":1e3*t+"~"+(1e3*t+1e3)},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.goBack=function(){i.$ionicGoBack()},i.goBackMsg=function(){e.go("teamMessage",{memberId:i.userId})},i.userLoadMore=function(e){a.getConnectionMsg(i.userId,e,i.pageSize).success(function(e){e.success&&(i.userList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.userList=i.userList.concat(e.data.rows)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.loadMore=function(){i.page++,i.userLoadMore(i.page)},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void s.scrollTop();s.scrollTop(),i.page=1,i.pageSize=20,i.hasMore=!0,i.init(i.userId,i.page,i.pageSize)})}]),APP.service("userMessageService",["$http","UrlService",function(e,t){this.getConnectionMsg=function(o,s,i){var a={mobile:o,pageNumber:s,pageSize:i,noLoading:!0};return e.get(t.getUrl("TEAM_MESSAGE"),a)}}]),APP.controller("userSearchController",["$rootScope","$scope","userSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,s,i,a,n,r){t.memberId=s.getUser().mid,t.page=1,t.pageSize=20,t.pageNum=10,t.searchValue="",t.selectedIndex=r.selectedIndex,t.Reps=function(e){if(e)return e.substring(0,1)},t.backToLastView=function(){t.$ionicGoBack()};var c=document.querySelector("#focus");t.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},t.commonFun=function(e){o.teamSearch(t.memberId,t.searchValue,e,t.page,t.pageNum).success(function(e){e.success&&(t.searchResults=e.data.children,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.searchConnection=function(){if(""==t.searchValue)return void a.showToast("请填写搜索内容");0==t.selectedIndex&&(t.cascade=!1,t.commonFun(t.cascade)),1==t.selectedIndex&&(t.cascade=!0,t.commonFun(t.cascade)),2==t.selectedIndex&&o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults=e.data.rows,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.loadMore=function(){t.page++,o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults.length<e.data.total?(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!0,t.searchResults=t.searchResults.concat(e.data.rows)):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!1))})},t.$on("$ionicView.enter",function(){"back"==t.direction?c.blur():(t.searchValue="",t.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),t.$on("$ionicView.beforeEnter",function(e,o){t.direction=o.direction,t.page=1,t.pageSize=20,t.pageNum=10,t.hasMore=!0,t.placeHolder="请输入用户名称"})}]),APP.service("userSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,s,i,a){var n={memberId:o,pageNumber:s,pageSize:i,userName:a,noLoading:!0};return e.get(t.getUrl("TEAM_USERS"),n)},this.teamSearch=function(o,s,i,a,n){var r={memberId:o,keyword:s,cascade:i,pageNumber:a,pageSize:n,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),r)}}]),APP.controller("newUserLoginController",["$stateParams","$location","$timeout","HomePageService","newUserLoginService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){r.isBuyer="1",r.isFocusShow=!0,r.identifyCodeImg="",r.showCaptcha=!1,r.showCaptchaForPhone=!0,r.eyeIndex=0,r.loginIndex=0,r.canGetVcode=!0,r.VCodeTips="获取验证码",r.eyeArr=[n.imgBaseURL+"img/eye_close@2x.png",n.imgBaseURL+"img/eye_open@2x.png"],r.pwdArr=["password","text"],r.loginTypeArr=["短信验证码登录","账号密码登录"],r.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var T=0;r.show=!1;ionic.Platform.isAndroid()||ionic.Platform.isIOS();r.leftArrow={},r.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(r.leftArrow={"margin-top":"36px"},r.rightButton={top:"36px"});r.xyzloginName=p.getUser().loginName,r.userInfo={userName:r.xyzloginName,mobile:p.getUser().mobile,password:"",captcha:"",verificationCode:""},r.VCodeStyle={color:"#2979FF"},r.getVCode=function(){r.canGetVcode&&(r.userInfo.mobile&&0!=r.userInfo.mobile.length?r.globalConstant.mobileNumberRegExp.test(r.userInfo.mobile)?0==r.userInfo.captcha.length?m.showToast("请输入图形验证码"):i.fastLoginCaptcha(r.userInfo.mobile,r.userInfo.captcha).success(function(e){if(e.data)if(-1==e.data&&0==r.userInfo.captcha.length)r.setImgCaptchaForPhone(),r.showCaptchaForPhone=!0,m.showToast("请输入图形验证码");else{r.canGetVcode=!r.canGetVcode;var t=60;r.timer=a(function(){t-1<0?(r.VCodeTips="获取验证码",r.VCodeStyle={color:"#2979FF"},a.cancel(r.timer),r.canGetVcode=!0):(r.VCodeStyle={color:"#666666"},t--,r.VCodeTips="重发 "+t+"s")},1e3)}else m.showToast(e.message)}):m.showToast("请输入正确的手机号格式"):m.showToast("请输入手机号"))},r.toggleEye=function(){r.eyeIndex=(r.eyeIndex+1)%2},r.setImgCaptcha=function(){r.identifyCodeImg=l.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},r.setImgCaptchaForPhone=function(){r.identifyCodeImg=h.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},r.canClickLoginOrNot=function(){0!=r.userInfo.mobile.length&&0!=r.userInfo.verificationCode.length?r.canClickLogin=!0:r.canClickLogin=!1},r.concactID=function(){r.loginIndex=1},r.mobileLogin=function(){r.loginIndex=0},r.toRegister=function(){frontView&&"guidePage"!=r.frontView?d.go("register",{hasHistory:1}):d.go("register",{hasHistory:0})},r.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&r.loginSG()},r.loginSG=function(){var e=t.absUrl();0==r.loginIndex?e.indexOf("code")<0?m.showToast("请重新打开页面，获取授权"):0==r.userInfo.mobile.length?m.showToast("请输入手机号"):r.globalConstant.mobileNumberRegExp.test(r.userInfo.mobile)?0==r.userInfo.captcha.length?m.showToast("请输入图形验证码"):0==r.userInfo.verificationCode.length?m.showToast("请输入短信验证码"):r.userInfo.verificationCode.length>0&&r.userInfo.verificationCode.length<6||r.userInfo.verificationCode.length>6?m.showToast("短信验证码长度必须是6位"):r.userData.unionid?i.fastLogin("1","7",r.userData.unionid,"",r.userInfo.mobile,r.userInfo.verificationCode,r.userInfo.captcha).success(function(e){if(e.success){r.userdataDetail=e.data;e.data.mid;n.loginMemberId=e.data.mid,p.setUser(e.data),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),r.frontView?"newUserLogin"==r.frontView||"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront","")):d.go("relactOK",{nickname:r.userdataDetail.nickname,mobile:r.userInfo.mobile,email:""})}else m.showToast(e.message)}):m.showToast("请重新打开页面，获取授权"):m.showToast("请输入正确的手机号格式"):e.indexOf("code")<0?m.showToast("请重新打开页面，获取授权"):0==r.userInfo.userName.length?m.showToast("请输入用户名"):0==r.userInfo.password.length?m.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):r.userData.unionid?i.fastLogin("2","7",r.userData.unionid,r.userInfo.password,r.userInfo.userName,"","").success(function(e){if(e.success){r.userdataDetail=e.data;e.data.mid;n.loginMemberId=e.data.mid,p.setUser(e.data),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),r.frontView?"newUserLogin"==r.frontView||"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront","")):d.go("relactOK",{nickname:r.userdataDetail.nickname,mobile:r.userInfo.userName,email:""})}else m.showToast(e.message)}):m.showToast("请重新打开页面，获取授权")},r.isHideFooter=function(){r.isFocusShow=!1},r.isShowFooter=function(){r.isFocusShow=!0},r.thirdLogin=function(e){if(T=0,!window.umeng)return void alert("umeng 插件 未加载");umengLogin(e)},r.goBack=function(){f.goBack()},r.$on("$ionicView.beforeEnter",function(){var e={title:"",url:""};window.history.pushState(e,"","#/login/newUserLogin"),r.backYes=!1,o(function(){r.backYes=!0},1500),r.urlbase=t.absUrl(),s.isWdHost().success(function(e){n.isWdHost=e.data.isHost}),window.onpopstate=function(){r.backYes&&-1==n.isWdHost&&window.history.go(-3)};var a=c.get("backfront");r.urlbase.indexOf("code")>0?(r.codeString=r.urlbase.substring(r.urlbase.indexOf("code"),r.urlbase.indexOf("&")),r.getCode=r.codeString.substring(5),i.findStatus(r.getCode).success(function(e){if(e.success)if(e.data.unionid){if(r.userData=e.data,1==r.userData.isBinded)if(a){var t=JSON.parse(a);r.frontView=t.stateName,r.params=t.stateParams;e.data.memberViewA.mid;n.loginMemberId=e.data.memberViewA.mid,p.setUser(e.data.memberViewA),w.initWebSocket(),n.userCount=r.userInfo.mobile,n.password="",window.localStorage.setItem("isLogin",p.isUserLogin()),n.isWdHost=1,e.data.memberViewA.sessionValue?c.set("sg_login_token_secret","Bearer"+e.data.memberViewA.sessionValue):c.set("sg_login_token_secret","Bearer"+y.generateUUID()),"guidePage"==r.frontView||"register"==r.frontView||"changePassword"==r.frontView||"myPhoneBindSuccess"==r.frontView?(d.go("newHome"),c.set("backfront","")):(d.go(r.frontView,r.params),c.set("backfront",""))}else d.go("relactOK",{nickname:r.userData.nickname,mobile:r.userData.mobile,email:r.userData.email});else if(r.loginIndex=0,a){var t=JSON.parse(a);r.frontView=t.stateName,r.params=t.stateParams}}else m.showToast("请重新打开页面，获取授权");else m.showToast("请重新打开页面，获取授权")}).error(function(){m.showToast("请重新打开页面，获取授权")})):(r.url=encodeURIComponent($.getThirdUrl("www/#/login/newUserLogin")),document.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb03a523baf487993&redirect_uri="+r.url+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"),r.showCaptcha=!1,r.showCaptchaForPhone=!1,r.setImgCaptchaForPhone(),l.checkLogin().success(function(e,t,o,s){r.setImgCaptcha(),r.setImgCaptchaForPhone()})})}]),APP.service("newUserLoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,s,i){var a={userName:o,password:encodeURIComponent(s),captcha:i,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),a)},this.loginUserInfo=function(o,s){var i={userName:o,password:s,noLoading:!0};return e.get(t.getUrl("LOGIN"),i)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var s={memberId:o};else s={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),s)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.findStatus=function(o){var s={code:o};return e.get(t.getUrl("FIND_STATUS"),s)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,s){var i={mobile:o,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:i,headers:{Authorization:"open the gate"}})},this.fastLogin=function(o,s,i,a,n,r,c){var l={type:o,loginType:7,unionid:i,password:a,mobile:n,captcha:r,imgCaptcha:c};return e({method:"POST",url:t.getUrl("NEW_USER_CONTACT"),params:l})}}]),APP.controller("relactOKController",["$stateParams","$timeout","relactOKService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PopupService","$ionicHistory","$http","UrlService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){a.leftArrow={},a.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(a.leftArrow={"margin-top":"36px"},a.rightButton={top:"36px"}),a.init=function(){},a.$on("$ionicView.beforeEnter",function(){a.nickname=e.nikename,a.mobile=e.mobile,a.email=e.email,a.mobile.length>1?a.user=a.mobile:a.user=a.email})}]),APP.service("relactOKService",["$http","UrlService","$localstorage",function(e,t,o){}]),APP.controller("AddAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","ADDADDRESSService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage=i.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var m=window.innerHeight,f=m-373+"px";o.contentHeight={height:f};var h=m-250+"px";o.contentHeightStreet={height:h},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={};var v={};o.init=function(){if(o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn){var e=l.viewHistory().backView;e&&"address"==e.stateName?e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&o.addressMsgInit():(o.addressRegionName="所在地区",o.defaultImage=i.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s")}else o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.defaultOrchange&&o.hasChangeCommon();o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.hasChangeCommon=function(){o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree+" "+o.streetMsg,o.address.provinceId=o.hasChangeArr["value-1"],o.address.cityId=o.hasChangeArr["value-2"],o.address.areaId=o.hasChangeArr["value-3"],a.getLocationList(o.hasChangeArr["value-3"],o.hasChangeArr["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.addressMsgInit=function(){o.textColor="color-text-l",o.streetTextColor="color-text-l",void 0==i.addressStr?(o.defaultOrchange=!0,o.isChangeOrDefault=1,o.productChangeAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsg=JSON.parse(i.addressDefMsg),o.addressNum=o.adsMsg.pcrName.indexOf("/"),o.adsDefMsgInfo=o.adsMsg.pcrName,o.addressStreet=o.adsDefMsgInfo.substring(o.addressNum+1),o.addressRegName=o.adsMsg.pcrName.substring(o.addressNum,-1),o.addressRegionName=o.addressRegName,o.productDefaultAddress={provinceId:o.adsMsg.provinceId,cityId:o.adsMsg.cityId,areaId:o.adsMsg.regionId,streetId:o.adsMsg.streetId,regionName:o.addressRegName+" "+o.addressStreet,streetText:o.addressRegName},a.getLocationList(o.adsMsg.regionId,o.adsMsg.provinceId).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})):(o.defaultOrchange=!0,o.isChangeOrDefault=2,o.productDefaultAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsgChange=JSON.parse(i.addressStr),o.productChangeAddress={provinceId:o.adsMsgChange["value-1"],cityId:o.adsMsgChange["value-2"],areaId:o.adsMsgChange["value-3"],streetId:o.adsMsgChange["value-4"],regionName:o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"]+" "+o.adsMsgChange["text-4"]},o.addressStreet=o.adsMsgChange["text-4"],o.addressRegionName=o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"],a.getLocationList(o.adsMsgChange["value-3"],o.adsMsgChange["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")}))},o.$on("$ionicView.beforeEnter",function(){o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.commonGoBack=function(){t.confirm({template:"您当前信息未保存，是否保存信息？",cancelText:"离开",okText:"留在此页面"}).then(function(e){e||(o.panGoOn=!1,o.addressRegionName="所在地区",o.$ionicGoBack())})},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"");var t=l.viewHistory().backView;t&&"address"==t.stateName&&t.stateParams&&t.stateParams&&"YES"==t.stateParams.comeFromOrder&&(e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address?o.commonGoBack():l.goBack()}),e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&"所在地区"!=o.addressRegionName&&"街道"!=o.addressStreet?o.commonGoBack():l.goBack()}},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.setDefault=function(){0==o.defaultHide?(o.address.isDefault="0",o.defaultHide=!0):(o.address.isDefault="1",o.defaultHide=!1)},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,s,i){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=i,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,a.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var $=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<o.nowLevelIndex.length;s++)s>o.nowLevel&&(o.nowLevelIndex[s]=-1);o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",a.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.level=o.levelArea,a.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,a.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if($)return;c(function(){$=!1},1500),i.$broadcast(o.flag,o.defaultValue),$=!0,o.closeAddressModal()}},300),o.getPosition=function(){if("定位中···"!=i.globalConstant.autoPosition){v=n.getAddressInfo();var e=v.regionName+"/"+v.streetName;a.addAddress(v.provinceId,v.cityId,v.areaId,e,v.streetId).success(function(){var e={"text-1":v.provinceName,"text-2":v.cityName,"text-3":v.regionName,"text-4":v.streetName,"value-1":v.provinceId,"value-2":v.cityId,"value-3":v.areaId,"value-4":v.streetId};a.getLocationList(v.areaId,3).success(function(e){o.dataAddStreet=e.data;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.positionAddress={provinceId:v.provinceId,cityId:v.cityId,areaId:v.areaId,streetId:0,pca:v.provinceName+" "+v.cityName+" "+v.regionName,regionName:""},o.isPosition=!0,i.$broadcast(o.flag,e),o.streetTextColor="color-text-s",o.addressModal.hide()})}},p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),p.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.fromOrder;var e=l.viewHistory().backView;e&&"address"==e.stateName&&e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&(o.fromOrder=!0),o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.fromOrder?o.isPosition?o.positionCommonFun():o.defaultOrchange&&1==o.isChangeOrDefault?(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.regionName):3==o.isChangeOrDefault?(o.newAddAddress(),!o.regionTrue&&o.isDef&&(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.streetText+" "+o.addressStreet)):o.defaultOrchange&&2==o.isChangeOrDefault?(o.address.provinceId=o.productChangeAddress.provinceId,o.address.cityId=o.productChangeAddress.cityId,o.address.areaId=o.productChangeAddress.areaId,o.address.streetId=o.productChangeAddress.streetId,o.address.regionName=o.productChangeAddress.regionName):4==o.isChangeOrDefault&&o.newAddAddress():o.isPosition?o.positionCommonFun():o.newAddAddress(),a.doInit(o.address).success(function(e,t,s,a){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",i.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},i.addressStr=void 0,o.isChangeOrDefault=0,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,o.fromOrder?o.$ionicGoBack(-2):o.$ionicGoBack()):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):o.globalConstant.mobileNumberRegExp.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+" "+o.addressStreet+" "+o.address.address,e.getLocation(o.allAddress,function(s,i){if("complete"==s&&i.geocodes.length){var a=i.geocodes[0].location.lat,n=i.geocodes[0].location.lng,r=[n,a];e.getAddress(r,function(e,s){if("complete"===e&&"OK"===s.info){o.township=s.regeocode.addressComponent.township,o.addressStreet=o.township;for(var i=[],a=[],i=o.dataAddStreet,n=0;n<i.length;n++)if(a.push(i[n].text),-1!=a.indexOf(o.township)){var r=a.indexOf(o.township);o.isNotDistinguish=!0,o.addChangeAddress.streetId=i[r].value,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=i[r].value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet}else o.isNotDistinguish=!1;if(o.isNotDistinguish){t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,
o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},i.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("ADDADDRESSService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={co:o.consignee,pi:o.provinceId,ci:o.cityId,ri:o.areaId,si:o.streetId,rn:o.regionName,mo:o.mobile,ar:o.address,de:o.isDefault,zc:"",ph:""};return e({method:"POST",url:t.getUrl("ADDADDRESS_INIT"),data:s})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("AddPrizeAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","AddressPrizeService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var f=window.innerHeight,h=f-373+"px";o.contentHeight={height:h};var v=f-250+"px";o.contentHeightStreet={height:v},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={},o.init=function(){o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn?(o.addressRegionName="所在地区",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s"):(o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree),o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.$on("$ionicView.beforeEnter",function(){o.gameId=s.gameId,o.uuid=s.uuid,o.prizeId=s.prizeId,o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"")},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,s,i){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=i,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1)}else o.finish=!1,a.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var $=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var s=0;s<o.nowLevelIndex.length;s++)s>o.nowLevel&&(o.nowLevelIndex[s]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",a.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,a.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,a.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(t,s,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,a.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var s=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(s,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if($)return;c(function(){$=!1},1500),i.$broadcast(o.flag,o.defaultValue),$=!0,o.closeAddressModal()}},300),p.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),p.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.isPosition?o.positionCommonFun():o.newAddAddress(),a.doInit(o.address,o.gameId,o.uuid,o.prizeId).success(function(e,t,s,a){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",i.addressStr=void 0,o.isChangeOrDefault=0,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,r.showToast("添加成功"),setTimeout(function(){o.$ionicGoBack()},1e3)):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+o.address.address,e.getLocation(o.allAddress,function(s,i){if("complete"==s&&i.geocodes.length){var a=i.geocodes[0].location.lat,n=i.geocodes[0].location.lng,r=[n,a];e.getAddress(r,function(e,s){if("complete"===e&&"OK"===s.info){var i=s.regeocode.addressComponent;o.textThree==i.district?m.getAddressId(i.province,i.city,i.district,i.township,i.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){o.township=i.township,o.addressStreet=o.township,o.addChangeAddress.streetId=e.data.streetId,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=e.data.streetId,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet;t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}).error(function(e){o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}):o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},i.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("AddressPrizeService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a){var n={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,regionId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,gameId:s,uuid:i,prizeId:a};return e({method:"POST",url:t.getGameUrl("GAME_HAVE_PRIZE"),params:n})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)}}]),APP.controller("AddressController",["$ionicHistory","$ionicPopup","ChangeAddressService","$scope","AddressService","$state","$stateParams","$timeout","PopupService","$rootScope","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d){s.image=[],s.keywords={keyword:""},s.addressMap=[],s.myData=[],s.updateResult=!0,s.updateContent="",s.goBack=function(){e.goBack()},s.init=function(){i.getAddressList(void 0).success(function(e,t,o,i){if(e.success){s.myData=e.data,0==s.myData.length?s.iosStyleOne={backgroundColor:"#fff"}:s.iosStyleOne={};for(var a=0,n=[],r=!1,c=0;c<e.data.length;c++)if("1"==e.data[c].de){a=c,r=!0;break}n[0]=e.data[a];for(var l=0;l<a;l++)n[l+1]=e.data[l];for(var d=a+1;d<e.data.length;d++)n[d]=e.data[d];s.addressMap=n;for(var p=0;p<s.addressMap.length;p++)s.image[p]="img/ic_check.png";r&&(s.image[0]="img/ic_select.png")}})},s.setDefault=function(e){var t=s.addressMap[e];o.setDefaultAddr(t.id).success(function(e,t,o,i){1==e.success?s.init():s.showResult("修改失败")})},s.searchDataList=function(){if(0==s.keywords.keyword.length)return void c.showToast("请输入要搜索的关键字");i.getAddressList(s.keywords.keyword).success(function(e,t,o,i){if(e.success){s.myData=e.data,0==s.myData.length?s.iosStyleOne={backgroundColor:"#fff"}:s.iosStyleOne={};for(var a=0,n=[],r=!1,c=0;c<e.data.length;c++)if("1"==e.data[c].de){a=c,r=!0;break}n[0]=e.data[a];for(var l=0;l<a;l++)n[l+1]=e.data[l];for(var d=a+1;d<e.data.length;d++)n[d]=e.data[d];s.addressMap=n;for(var p=0;p<s.addressMap.length;p++)s.image[p]="img/ic_check.png";r&&(s.image[0]="img/ic_select.png")}})},s.cleanSearchData=function(){s.keywords.keyword="",s.init()},s.$on("$ionicView.beforeEnter",function(){d.scrollTop(),s.keywords.keyword="",window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?s.isIosAndInApp=!0:s.isIosAndInApp=!1,window.cordova?s.isApp=!0:s.isApp=!1,s.isApp?s.bottomDivHeight={height:"40px"}:s.bottomDivHeight={height:"120px"},s.init()}),s.goToChange=function(e){var t=JSON.stringify(s.addressMap[e]);a.go("changeAddress",{addressData:t})},s.goToDelete=function(e){t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(t){if(t){var o=s.addressMap[e].id;i.deleteAddr(o).success(function(e,t,o,i){e.success?(c.showToast("删除成功"),setTimeout(function(){s.init()},1e3)):c.showToast("删除失败")})}})},s.goToConfirm=function(e){"YES"==n.comeFromOrder&&i.chooseLocation(e.id).success(function(e,t,o,i){1==e.success?s.$ionicGoBack():c.showToast("更改收货物地址失败,请重新选择")})}}]),APP.service("AddressService",["$http","UrlService",function(e,t){this.getAddressList=function(o){var s={k:o};return e({method:"POST",url:t.getUrl("ADDRESS_INIT"),params:s})},this.deleteAddr=function(o){return e({method:"POST",url:t.getUrl("DETELEADDR_INIT"),params:{m:o}})},this.chooseLocation=function(o){var s={address:o};return e({method:"POST",url:t.getUrl("CHOOSE_ADDR"),params:s})}}]),APP.controller("BatchDeleteAddressController",["BatchAddressService","$ionicHistory","$ionicPopup","$scope","PopupService","$rootScope",function(e,t,o,s,i,a){s.goBack=function(){t.goBack()},s.init=function(){s.image=[],s.chooseAddressNum=0,e.getAddressList().success(function(e,t,o,i){if(e.success){s.addressArray=e.data;for(var a=0,n=s.addressArray.length;a<n;a++)s.image[a]="img/ic_check.png"}})},s.selectDeleteAddress=function(e){-1!=s.image[e].indexOf("check")?(s.image[e]="img/ic_select.png",s.chooseAddressNum++):(s.image[e]="img/ic_check.png",s.chooseAddressNum--),s.chooseAddressNum==s.image.length?s.isSelectAllAddress=!0:s.isSelectAllAddress=!1},s.selectAllAddress=function(){if(s.isSelectAllAddress){for(var e=0,t=s.addressArray.length;e<t;e++)s.image[e]="img/ic_check.png";s.chooseAddressNum=0,s.isSelectAllAddress=!1}else{for(var e=0,t=s.addressArray.length;e<t;e++)s.image[e]="img/ic_select.png";s.isSelectAllAddress=!0,s.chooseAddressNum=s.image.length}},s.batchDelete=function(){if(0==s.chooseAddressNum)return void i.showToast("请选择要删除的地址");o.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){if(o){for(var i="",a=[],n=0,r=s.image.length;n<r;n++)-1!=s.image[n].indexOf("select")&&a.push(s.addressArray[n].id);i=a.join(",");var c={m:i};e.batchDelete(c).success(function(e){if(e.success){if(s.isSelectAllAddress)return void t.goBack();s.init()}})}})},s.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?s.isIosAndInApp=!0:s.isIosAndInApp=!1,window.cordova?s.isApp=!0:s.isApp=!1,s.isIosAndInApp&&(s.iosStyleOne={padding:"64px 0 90px 0"},s.iosStyleTwo={top:"20px"}),s.isApp?s.bottomDivHeight={height:"40px"}:s.bottomDivHeight={height:"120px"},s.chooseAddressNum=0,s.isSelectAllAddress=!1,s.init()})}]),APP.service("BatchAddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e({method:"POST",url:t.getUrl("ADDRESS_INIT")})},this.batchDelete=function(o){return e({method:"POST",url:t.getUrl("BATCH_DELETE_ADDRESS"),params:o})}}]),APP.controller("ChangeAddressController",["$scope","$stateParams","$rootScope","ChangeAddressService","CommonAddressService","GoodsService","PopupService","$timeout","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d){var p=JSON.parse(t.addressData);e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.address={acceptor:p.co,mobile:p.mo,detailAds:p.ar,regionName:p.rn,addrId:p.id,provinceId:p.pi,cityId:p.ci,areaId:p.ri,streetId:p.si},e.panGoOn=!1,e.updateResult=!0,e.updateContent="";var u=window.innerHeight,g=u-373+"px";e.contentHeight={height:g},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION",e.defaultValue=null,e.level=0;var m,f,h={};e.panGoOn=!1,e.updateResult=!0,e.updateContent="",e.init=function(){var o=JSON.parse(t.addressData);0==e.panGoOn?e.address={acceptor:o.co,mobile:o.mo,detailAds:o.ar,regionName:o.rn,addrId:o.id,provinceId:o.pi,cityId:o.ci,areaId:o.ri,streetId:o.si}:e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree+" "+e.textFour,e.panGoOn=!1},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&d.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.init(),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.setDefault=function(){s.setDefaultAddr(e.address.addrId).success(function(t,o,s,i){1==t.success?e.$ionicGoBack():e.showResult("修改失败")})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,s,i){if(e.addressTipFlag=!1,d.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=i,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var r=0;r<e.nowLevelIndex.length;r++)r>e.nowLevel&&(e.nowLevelIndex[r]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",a.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){n.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var v=!1;e.goSelect=ionic.Utils.debounce(function(t,s){for(var i=0;i<e.nowLevelIndex.length;i++)i>e.nowLevel&&(e.nowLevelIndex[i]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=t;var s=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=s.text,e.defaultValue["value"+e.level]=s.value,e.level>-2)-1==e.level&&(e.selectProvince=s.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=d.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){1==ah&&(f=s.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){n.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(f,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,d.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){n.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=s.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=d.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=d.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,a.getLocationList(s.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(m=s.value);var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){n.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,a.getLocationList(m,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level),d.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){n.showToast("获取地址信息失败！")})};else{if(v)return;r(function(){v=!1},1500),o.$broadcast(e.flag,e.defaultValue),v=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=o.globalConstant.autoPosition){h=i.getAddressInfo();var t=h.regionName+"/"+h.streetName;s.addAddress(h.provinceId,h.cityId,h.areaId,t,h.streetId).success(function(){var t={"text-1":h.provinceName,"text-2":h.cityName,"text-3":h.regionName,"text-4":h.streetName,"value-1":h.provinceId,"value-2":h.cityId,"value-3":h.areaId,"value-4":h.streetId};o.$broadcast(e.flag,t),e.addressModal.hide()})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.doChange=function(){return""==e.address.acceptor?void n.showToast("收货人不能为空"):e.address.acceptor.length>10||e.address.acceptor.length<2?void n.showToast("收货人为2-10个字符"):""==e.address.mobile?void n.showToast("手机号码不能为空"):e.globalConstant.mobileNumberRegExp.exec(e.address.mobile)?"所在区域"==e.address.regionName?void n.showToast("请选择所在区域"):/^.[^&<>]{2,29}$/.exec(e.address.detailAds)?void s.changeAddr(e.address).success(function(t,o,s,i){t.success?e.$ionicGoBack():e.showResult("修改失败")}):void n.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void n.showToast("手机号码不正确")},o.$on("CHANGEADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.address.provinceId=o["value-1"],e.address.cityId=o["value-2"],e.address.areaId=o["value-3"],e.address.streetId=o["value-4"],e.init()}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,r(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeAddressService",["$http","UrlService",function(e,t){this.changeAddr=function(o){var s={id:o.addrId,co:o.acceptor,mo:o.mobile,rn:o.regionName,pi:o.provinceId,ci:o.cityId,ri:o.areaId,si:o.streetId,ar:o.detailAds,zc:"",ph:""};return e({method:"POST",url:t.getUrl("CHANGEADDR_INIT"),data:s})},this.setDefaultAddr=function(o){var s={m:o};return e({method:"POST",url:t.getUrl("SETDEFAULT_INIT"),params:s})},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("BankCardController",["$localstorage","$scope","HomePageService","$ionicHistory","InAppBrowserService","UrlService","$state","bankCardService","$ionicScrollDelegate","EasyConnectService",function(e,t,o,s,i,a,n,r,c,l){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){null==s.viewHistory().backView?n.go("personnalCenter"):"shopRevenue"==s.viewHistory().backView.stateName||"paymentxyz"==s.viewHistory().backView.stateName?s.goBack():n.go("personnalCenter")},t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.clickBind=function(){if(!window.device)return void window.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.bind().success(function(o,s,n,r){if(window.device&&window.device.hasNewBrowser){var c=ionic.Platform.isAndroid();if(c){var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}else{var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}else{var c=ionic.Platform.isAndroid();if(c){var d=cordova.InAppBrowser.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");d.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){d.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),d.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&d.close()}),d.addEventListener("exit",function(e){t.init()})}else{var l=i.open(a.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}})},t.init=function(){o.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?t.iso2o=!0:t.iso2o=!1}),r.doInit().success(function(e){e.success&&(0==e.data.isBindKJT?t.isBindKjt=!0:t.isBindKjt=!1,0==e.data.isBindYHK?t.isBindBank=!0:t.isBindBank=!1,t.hasBindKJT=e.data.isBindKJT,t.hasBindYHK=e.data.isBindYHK,t.backGroundOrImg=e.data.BankCardList,t.backGroundOrKjt=e.data.kjtAccount)})},t.$on("$ionicView.beforeEnter",function(){c.scrollTop(),t.backGroundOrKjt="",t.backGroundOrImg="",t.isBindKjt=!1,t.isBindBank=!1,t.init()})}]),APP.service("bankCardService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("HAS_BANK_LIST_NEW"))}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){
this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("bankCardDetailController",["$localstorage","$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","bankCardDetialService","$state","UrlService","EasyConnectService","InAppBrowserService","PopupService","$interval",function(e,t,o,s,i,a,n,r,c,l,d,p,u){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){r.go("bankCard")};var g="";t.nameKjt="",t.isKJT=!1,t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.VCodeTips="获取验证码",t.canGetVcode=!0,t.userInfo={verificationCode:""},t.getVCode=function(){t.canGetVcode&&n.fastLoginCaptchaNew(g).success(function(e){if(e.success){p.showToast("您正在操作解绑银行卡，短信验证码已经发送到您绑定银行卡时的预留银行手机号"+t.bankCardDetailList.phoneNo+"中，请查收并进行验证。"),t.canGetVcode=!t.canGetVcode;var o=60;t.timer=u(function(){o-1<0?(t.VCodeTips="获取验证码",u.cancel(t.timer),t.canGetVcode=!0):(o--,t.VCodeTips=o+"s后可重发 ")},1e3)}else p.showToast(e.message)})},t.unBindBank=function(){if(t.userInfo.verificationCode.length<=0)p.showToast("请输入短信验证码");else{s.confirm({template:"确认解除绑定该银行卡?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){e&&n.deleteBank(g,t.userInfo.verificationCode).success(function(e){e.success?(p.showToast("您的银行卡已经解绑成功！"),setTimeout(function(){r.go("bankCard")},2e3)):p.showToast(e.message)})})}},t.clickUnBind=function(){if(!window.device)return void window.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.unBlind().success(function(t,o,s,i){var a=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(a){var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=ionic.Platform.isAndroid();if(a){var l=cordova.InAppBrowser.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");l.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&$timeout(function(){l.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),l.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&l.close()}),l.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){r.go("bankCard")})}}})},t.init=function(){n.doInit(g).success(function(e){e.success&&(t.bankCardDetailList=e.data)})},t.$on("$ionicView.beforeEnter",function(){i.scrollTop(),g="",t.nameKjt="",t.bankCardDetailList,g=a.cardNoShow,t.nameKjt=a.nameKjt,""!=t.nameKjt?(t.isKJT=!0,t.bankCardDetailList=g):(t.isKJT=!1,t.init())})}]),APP.service("bankCardDetialService",["$http","UrlService",function(e,t){this.doInit=function(o){var s={cardNo:o};return e.get(t.getUrl("BANK_LIST_DETAIL_NEW"),s)},this.deleteBank=function(o,s){var i={cardNo:o,captcha:s};return e.get(t.getUrl("BANK_DELETE_NEW"),i)},this.fastLoginCaptchaNew=function(o){var s={cardNo:o};return e.get(t.getUrl("BANK_DELETE_CAPTCHA"),s)}}]),APP.controller("bankSupportController",["$scope","$ionicHistory","$ionicPopup",function(e,t,o){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}]}]),APP.controller("chooseTheBankController",["$scope","$ionicHistory","$ionicPopup","$state","$rootScope",function(e,t,o,s,i){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.differentStyleHas=-1,e.differentStyle={background:"#eee"},e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}],e.chooseBank=function(o,s,a){e.differentStyleHas=o,i.$broadcast("haveChooseBank",o,s,a),t.goBack()}}]),APP.controller("mentionCenterController",["$rootScope","$ionicPopup","$localstorage","$scope","HomePageService","$ionicHistory","bankCardService","mentionCenterService","$stateParams","$state","ShopRevenueService","EasyConnectService","UrlService","InAppBrowserService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){function f(e){d.getAccountState(e).success(function(e){e.success&&(accountState=e.data)})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"margin-top":"16px"},s.paddingtopClasscontent={top:"60px"}):(s.paddingtopClass={"margin-top":"0px"},s.paddingtopClasscontent={top:"44px"}),s.matchValue=0,s.account="",s.goBack=function(){null==a.viewHistory().backView?l.go("personnalCenter"):a.goBack()},s.backGroundOrPic={"03020000":{img:"1CITIC"},"01030000":{img:"2ABC"},"01020000":{img:"3ICBC"},"01050000":{img:"4CCB"},"03080000":{img:"5CMB"},"03180000":{img:"6SZPAB"},"01040000":{img:"7BOC"},"03090000":{img:"8CIB"},"03100000":{img:"9SPDB"},"03050000":{img:"10CMBC"},"03040000":{img:"11HXB"},"03030000":{img:"12CEB"},"01000000":{img:"13PSBC"},"03010000":{img:"14COMM"},"04031000":{img:"15BCCB"},"03060000":{img:"16GDB"},"03110000":{img:"17EGBANK"},"04233310":{img:"18HCCB"},"04083320":{img:"19NBCB"},88888888:{img:"20KJT"}},s.clickBank=function(e){s.matchValue=e},s.getCashNow=function(){r.getCash(s.backGroundOrKjt.memberKjtpayAccount,"KJT").success(function(e,o,s,i){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var a=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});a.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},s.withdraw=function(){if(2==accountState){var e="提现需要绑定快捷通，请点击确定去绑定快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.bind().success(function(e,t,i,a){if(window.device&&window.device.hasNewBrowser){var n=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){s.init()})}else{if(ionic.Platform.isAndroid()){var r=cordova.InAppBrowser.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");r.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){r.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),r.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&r.close()}),r.addEventListener("exit",function(e){s.init()})}else{var n=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));n.addEventListener("exit",function(e){s.init()})}}})}})}else if(3==accountState)s.getCashNow();else if(4==accountState){var e="提现需要实名认证快捷通，请点击确定去认证快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.realName().success(function(e,t,i,a){g.open(u.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){s.init()})})}})}else if(1==accountState){var e="提现需要激活快捷通，请点击确定去激活快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(u.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.activation().success(function(e,t,i,a){g.open(u.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){s.init()})})}})}},s.clickBind=function(){if(!window.device)return void window.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");p.bind().success(function(e,t,i,a){if(window.device&&window.device.hasNewBrowser){var n=ionic.Platform.isAndroid();if(n){var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}else{var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}}else{var n=ionic.Platform.isAndroid();if(n){var c=cordova.InAppBrowser.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");c.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){c.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),c.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&c.close()}),c.addEventListener("exit",function(e){s.init()})}else{var r=g.open(u.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){s.init()})}}})},s.mentionCenterBankNow=function(){r.getCash(s.backGroundOrImg.cardNoShow,"YHK").success(function(e,o,s,i){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var a=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});a.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},s.init=function(){f(s.earningType),i.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?s.iso2o=!0:s.iso2o=!1}),n.doInit().success(function(e){e.success&&(s.hasBindKJT=e.data.isBindKJT,s.hasBindYHK=e.data.isBindYHK,s.backGroundOrImg=e.data.BankCardList,s.backGroundOrKjt=e.data.kjtAccount,s.hasBindYHK&&s.moneyHundred&&(s.matchValue=1))})},s.$on("$ionicView.beforeEnter",function(){s.earningType="B",s.account="",s.backGroundOrImg="",s.backGroundOrKjt="",s.canGetMount="",s.canGetMount=c.canAmount,e.canGetMount=c.canAmount,parseInt(s.canGetMount)>0?s.moneyNoone=!0:s.moneyNoone=!1,parseInt(s.canGetMount)>=1e3?s.moneyHundred=!0:s.moneyHundred=!1,s.hasBindKJT=!1,s.hasBindYHK=!1,s.init()})}]),APP.service("mentionCenterService",["$http","UrlService",function(e,t){this.getCash=function(o,s){var i={kjtAccount:o,paymentType:s};return e.get(t.getUrl("NEW_GETCASH_INIT"),i)}}]),APP.controller("historyTaskController",["$scope","$stateParams","ShareService",function(e,t,o){function s(e){for(var t in e)return!1;return!0}e.history="",e.isHistory=!1,e.loadData=function(){o.myHistoryShare().success(function(t){e.history=t.data,s(e.history)&&(e.isHistory=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.isHistory=!1}),e.$on("$ionicView.enter",function(){e.loadData()})}]),APP.controller("MissionDetailController",["$q","$scope","UrlService","MissionDetailService","PopupService","$rootScope","$stateParams","CreditService","UserService",function(e,t,o,s,i,a,n,r,c){function l(t){var o=e.defer();return s.getQrCodeUrl(t).success(function(e){o.resolve(e.data)}),o.promise}function d(e,i,n){var r=t.missionContent.taskDestWithStatusVOs[0].id,l=c.getUser().mid,d=t.name,p=t.editableContent||t.editContent,u=(t.checkImg,t.imgArr&&t.imgArr.length>0?t.imgArr[0]:null);if(window.umeng){if(window.cordova&&cordova.plugins.clipboard.copy(p),-1==e&&window.umeng.iosPlatformShared(d,p,u,[u],0,n,function(){}),4==t.taskType){var g=t.configData.linkUrl;null==u&&(u="http://www.ehaier.com/mstatic/wd/v2/img/icons/ic_default_avatar.png"),0==e?window.umeng.shareToSina(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,p,u,g,0,null,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,p,u,g,0,null,function(){s.missionShare(t.taskType,"QQ").success(function(){t.init()})}):4==e&&window.umeng.shareToQzone(d,p,u,g,0,null,function(){s.missionShare(t.taskType,"QQ空间").success(function(){t.init()})})}else if(3==t.taskType){var m=t.configData.productTitle||t.configData.productName,f=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+l+"/"+l;0==e?window.umeng.shareToSina(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"QQ").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(t.configData.productName,m,u,f,0,n,function(){s.missionShare(t.taskType,r,"QQ空间").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})})}else 0==e?window.umeng.shareToSina(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"微博").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"微信").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"朋友圈").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,p,u,null,2,n,function(){s.missionShare(t.taskType,r,"QQ").success(function(){a.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(d,p,u,null,2);t.showShare=!1}else alert("umeng undefined 只能在app分享")}t.hasQQ=!1,t.isIOS=ionic.Platform.isIOS(),t.UserTaskStatus=null,t.needTake="",t.hideblackCover=function(){t.showShare=!1},t.savaEditContent=function(e){t.editableContent=e},t.goBack=function(){t.$ionicGoBack()},t.output=function(e){},t.copyLinkUrl=function(){window.cordova?(cordova.plugins.clipboard.copy(t.linkUrl),i.showToastShort("复制成功")):i.showToast("请下载APP执行此操作")},t.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastWithTime("复制成功",2e3)):i.showToast("请下载APP执行此操作")},t.share=function(){if(window.umeng){if(window.cordova&&(cordova.plugins.clipboard.copy(t.editContent),a.hasShowPasteHint||(i.showToastWithTime("请直接粘贴分享文字内容",2e3),a.hasShowPasteHint=!0)),window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else if(window.umeng){if(!t.missionContent)return void t.showPopup("网络连接失败，请稍后分享");var e=t.name,s=t.editContent,n=(t.checkImg,t.imgArr[0]),r=o.getShareLinkHeader()+"missionDetail/"+t.taskId;window.cordova&&cordova.plugins.clipboard.copy(s),window.umeng.share(e,s,n,r,2)}}else i.showAlert("只能在app分享","抱歉，只能在app分享")},t.shareToPlatform=function(e,s){var i=null,a="",n=c.getUser().mid;1==t.configData.qrcodeType||void 0==t.configData.qrcodeType?(i=t.missionContent.resultMap.qrCode,d(e,s,i)):2==t.configData.qrcodeType?(a=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+n+"/"+n,l(escape(a)).then(function(t){i=t,d(e,s,i)})):3==t.configData.qrcodeType?(a=o.getShareLinkHeader()+"register/0/"+t.missionContent.resultMap.promotionCode,l(escape(a)).then(function(t){i=t,d(e,s,i)})):0==t.configData.qrcodeType?d(e,s,null):d(e,s)},t.init=function(){s.getMissionDetail(t.taskId).success(function(e){e.success&&(t.UserTaskStatus=e.data.taskInfoWithStatusVO.userTaskStatus,t.needTake=e.data.taskInfoWithStatusVO.needTake,t.missionContent=e.data,t.xyzTaskDestId=t.missionContent.taskDestWithStatusVOs[0].id,t.name=t.missionContent.taskInfoWithStatusVO.name,t.taskType=t.missionContent.taskInfoWithStatusVO.taskType,t.isFinished=t.missionContent.taskInfoWithStatusVO.isFinished,t.configDataStr=t.missionContent.taskInfoWithStatusVO.configData,t.configData=JSON.parse(t.configDataStr),t.missionTitleArr=["","早安","晚安","分享商品","分享链接","士兵突击","图片分享","晒战绩"],t.missionTitle=t.missionTitleArr[t.taskType],t.time=new Date,t.editContent=t.missionContent.taskInfoWithStatusVO.content,t.taskAwards=t.missionContent.taskInfoWithStatusVO.taskAwards[0],0==t.taskAwards.awardType?t.taskAwardsContent=t.taskAwards.awardNum+"金币":1==t.taskAwards.awardType&&(t.taskAwardsContent=t.taskAwards.awardNum+"积分"),t.configData.imageUrls&&(t.imgArr=t.configData.imageUrls),t.configData.productName&&(t.productName=t.configData.productName),t.configData.linkUrl&&(t.linkUrl=t.configData.linkUrl))}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.taskId=n.taskId,t.checkImgIndex=[],t.checkImh=[],t.init()})}]),APP.service("MissionDetailService",["$http","UrlService","IMService",function(e,t,o){this.getMissionDetail=function(o){var s={taskId:o};return e.get(t.getUrl("MISSION_DETAIL"),s)},this.missionShare=function(s,i,a){var n={taskType:s,taskDestId:i,sharePlatform:a};return o.validateWebSocket(),e.get(t.getUrl("MISSION_SHARE"),n)},this.getQrCodeUrl=function(o){var s={requestUrl:o};return e.get(t.getUrl("GET_QRCODE"),s)}}]),APP.controller("taskShareController",["$scope","$state","ShareService","$rootScope","PopupService","$ionicHistory","UserService",function(e,t,o,s,i,a,n){function r(e){for(var t=[],o=[],s=e.length,i=s-1;i>=0;i--)5==e[i].taskType?o.push(e[i]):e[i].isFinished?t.push(e[i]):t.unshift(e[i]);return o.concat(t)}e.colorStyle1={color:"#030303"},e.colorStyle2={color:"blue"},e.share="";e.loadData=function(){o.myShare(0,100).success(function(t){e.share=r(t.data.rows)}).error(function(){})},e.goBack=function(){e.$ionicGoBack()},e.goShare=function(o,s,i){7==i?t.go("competition",{taskDestId:"",taskType:i,memberId:e.xyzMemberId}):t.go("missionDetail",{taskId:s})},e.shake=function(){alert("lover")},e.$on("$ionicView.enter",function(t,o){"back"==o.direction&&s.shareSucBack?(s.shareSucBack=!1,s.freshMission=!0,s.missionLists=function(){e.loadData()}):e.loadData()}),e.$on("$ionicView.beforeEnter",function(){e.xyzMemberId=n.getUser().mid})}]),APP.service("ShareService",["$http","UrlService",function(e,t){this.myShare=function(o,s){var i={startIndex:o,pageSize:s};return e.get(t.getUrl("SHAER_TASK"),i)},this.myHistoryShare=function(){return e.get(t.getUrl("SHAER_HISTORY_TASK"))}}]),APP.controller("PartnerController",["$ionicHistory","$scope","$state","PartnerService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v){function $(e,o,i,a,n,r,c){s.partnerTeamSearch({memberId:e,cascade:o,pageNumber:i,pageSize:a,sort:n,order:r,noLoading:c}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.pageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}function S(e,o,i,a,n,r,c,l){s.anthenSearch({memberId:e,cascade:o,isAuthenticated:i,pageNumber:a,pageSize:n,sort:r,order:c,noLoading:l}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.authenticatedNum=e.data.authenticatedNum,t.UnAuthenticatedNum=e.data.unAuthenticatedNum,t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.authpageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}t.goBack=function(){t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.arrowState=[u.imgBaseURL+"img/Group@2x.png",u.imgBaseURL+"img/Group1@2x.png",u.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["asc","desc"],"asc","asc"],t.title="partner"==d.title?"合伙人":"团队",t.authenIndex=0,t.hasmore=!1,t.front=d.front,t.shareStoreId=d.shareStoreId,t.isBuyer=m.getRole(),t.userId=r.getUser().mid;t.pagesort="startTime",t.order="asc",t.memberId=d.memberId,t.cascade="partner"!=d.title,t.isAuthenticated=!0,t.init=function(){t.pageNumber=1,t.pageSize=10,$(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!1)},t.authInit=function(){t.authpageNumber=1,t.pageSize=10,S(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!1)},t.$on("$ionicView.beforeEnter",function(e,o){f.scrollTop(),t.chooseIndex=0,t.partnerChildren=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=d.memberId,t.init()}),t.loadMore=function(){1==t.chooseIndex?S(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!0):$(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!0)},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e))if(f.scrollTop(),t.page=2,0==e){t.chooseIndex=e;t.openStoreTime_index;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.partnerChildren=[],t.pagesort="startTime",t.order=1==t.openStoreTime_index?"asc":"desc",t.init()}else 1==e?(t.authenIndex=0,t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.partnerChildren=[],t.order=0==t.openStoreTime_index?"asc":"desc",t.pagesort="isAuthenticated",t.isAuthenticated=!0,t.authInit()):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.partnerChildren=[],t.filterParams="saleDesc",t.order=0==t.openStoreTime_index?"desc":"asc",t.pagesort="teamLevelOrder",t.init())},t.chooseAnthen=function(e){0==e?(t.isAuthenticated=!0,t.pagesort="isAuthenticated",t.authenIndex=0,t.partnerChildren=[],t.authInit()):1==e&&(t.isAuthenticated=!1,t.pagesort="isAuthenticated",t.authenIndex=1,t.partnerChildren=[],t.authInit())}}]),APP.service("PartnerService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p){var u={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p};return e.get(t.getUrl("SEARCHGOODS_INIT"),u)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)},this.partnerTeamSearch=function(o){var s=t.getUrl("GET_PARTNER_TEAM");return e.get(s,o)},this.anthenSearch=function(o){var s=t.getUrl("GET_PARTNER_TEAM");return e.get(s,o)}}]),APP.controller("VisiBroHisController",["$http","$scope","$cacheFactory","VisiBroHisService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","storeTeamOwnerService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){t.chooseIndex=0,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.init=function(){t.memberId=l.getUser().mid,t.userId=27483685,t.userId=i.userId,t.daysType=i.daysType,t.hasmore=!1,s.getVisitorBrowHis(t.userId,t.daysType).success(function(e){1==e.success&&(t.productList=e.data),e.data.productsList}).error(function(e){})},t.goBack=function(){t.$ionicGoBack()},t.showPopup=function(e){var t=d.show({template:e});p(function(){t.close()},1e3)},t.$on("$ionicView.beforeLeave",function(e,o){t.watch()}),t.$on("$ionicView.beforeEnter",function(e,o){t.userInfo=I.visitorInfo,t.init(),t.showComprehensiveSub=!1,t.nowLevel=0,t.nowLevelIndex=[-1,-1,-1,-1],t.finish=!1,t.watch=t.$watch("finish",function(e,o){e&&m.$getByHandle("mainScroll").scrollTo(0,t.provinceTop)}),t.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIos1=!0:t.isIos1=!1,t.storeId=v.get("storeId",g.globalConstant.storeId),t.memberId=l.getUser().mid,t.buttonShow=!1,t.page=1,t.hasmore=!1})}]),APP.service("VisiBroHisService",["$http","UrlService",function(e,t){this.getVisitorBrowHis=function(o,s){var i={userId:o,daysType:s};return e.get(t.getUrl("GET_VISI_BROW_HIS"),i)}}]),APP.controller("AccountMessageController",["$scope","AccountMessageService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u){function g(t){var o=t[0];if(window.FileReader){var s=new FileReader;s.readAsDataURL(o),s.onloadend=function(t){e.$apply(e.iconImage=t.target.result)}}}e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.sexMap=["保密","男","女"],e.accountMessage="",e.accountName="",e.accountEmail="",e.accountSexValue="0",e.accountSex=e.sexMap[e.accountSexValue],e.accountBirthday="",e.accountNumber="",e.iconImage=o.imgBaseURL+"img/ic_login_user.png",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=n.getUser(),e.sexMap=["保密","男","女"],void 0!=e.user.avatarImageFileId&&(e.iconImage=e.user.avatarImageFileId),e.accountMessage=e.user.userName,e.accountName=e.user.nickName,e.accountSexValue=e.user.gender,e.accountSex=e.sexMap[e.accountSexValue],e.accountEmail=e.user.email,e.accountBirthday=e.user.birthday,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,n.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){s.go("guidePage")},e.changeIcon=function(){if("APP"==c.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},s=function(o){function s(o){e.iconImage=o,a(function(){e.iconImage=o},200);var s=function(t){r.hide(),e.showResult("上传成功");var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,n.setUser(e.user)},i=function(t){r.hide(),e.showResult("上传失败")},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),s,i,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function i(e){}function c(o){e.iconImage=o,a(function(){e.iconImage=o},200);var s=function(t){e.showResult("上传成功"),r.hide();var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,n.setUser(e.user)},i=function(t){e.showResult("上传失败"),r.hide()},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),s,i,c);var d={
template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function l(e){}1==o?navigator.camera.getPicture(s,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(c,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,s),a(function(){window.plugins.actionsheet.hide()},5e3)}else{d.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},e.$watch("userInfo.picTempFile",function(){e.userInfo&&e.userInfo.picTempFile&&e.userInfo.picTempFile.length>0&&g(e.userInfo.picTempFile)},!1),e.unload=function(){void 0==e.user.sessionValue?(n.clearUser(),p.setRole(void 0),e.goGuidePage(),window.localStorage.setItem("isLogin",n.isUserLogin()),u.set("storeId","")):t.unloadAccount(e.accountToken,e.accountSessionId,e.accountHeaderKey).success(function(t,o,s,i){if(t.success){n.clearUser(),e.goGuidePage(),p.setRole(void 0);var a="Bearer"+t.data;window.localStorage.setItem("sg_login_token_secret",a),window.localStorage.setItem("isLogin",n.isUserLogin()),u.set("storeId","")}})},e.goToDelete=function(){d.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.unload()})},e.selectDate=function(){if("APP"==c.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){a(function(){var s=o.getDate(),i=o.getMonth()+1,a=o.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s),t.changeMessage(e.accountMessage,a+"-"+i+"-"+s,e.accountSexValue,e.accountName).success(function(t,o,r,c){t.success?(e.accountBirthday=a+"-"+i+"-"+s,e.user.birthday=a+"-"+i+"-"+s,n.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})},200)})}else{var s={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var s=new Date(o).getMonth()+1,i=new Date(o).getDate();s<10&&(s="0"+s),i<10&&(i="0"+i);var a=new Date(o).getFullYear()+"-"+s+"-"+i;t.changeMessage(e.accountMessage,a,e.accountSexValue,e.accountName).success(function(t,o,s,i){t.success?(e.accountBirthday=a,e.user.birthday=a,n.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})}};l.openDatePicker(s)}},o.$on("SELECT_SEX",function(t,o){e.accountSexValue=o,e.accountSex=e.sexMap[e.accountSexValue],e.user.gender=o,n.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_NAME",function(t,o){e.accountName=o,e.user.nickName=o,n.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,n.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){e.$ionicGoBack()},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("AccountMessageService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,s,i){var a=o,n="Bearer "+i+" "+a,r={Authorization:n},c={sessionId:s};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("ChangeEmailController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeEmailService",function(e,t,o,s,i,a,n){e.email={value:t.email},e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName,e.updateResult=!0,e.updateContent="",e.init=function(){e.email={value:t.email},e.gender=t.gender|JSON.parse(window.localStorage.USER_CACHE_KEY).gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){var t=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;return e.email.value?t.exec(e.email.value)?void n.changeEmail(e.userName,e.birthday,e.gender,e.nickName,e.email.value).success(function(t,s,i,n){t.success?(o.$broadcast("CHANGE_EMAIL",e.email.value),a.go("accsafe")):t.message?e.showResult(t.message):e.showResult("未知异常")}):void s.showToast("电子邮箱输入不规范"):void s.showToast("您输入的邮箱不能为空")},e.goBack=function(){a.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeEmailService",["$http","UrlService",function(e,t){this.changeEmail=function(o,s,i,a,n){var r={userName:o,birthday:s,gender:i,nickName:a,email:n};return e({method:"POST",url:t.getUrl("UPDATE_EMAIL"),params:r})}}]),APP.controller("ChangeNameController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeNameService",function(e,t,o,s,i,a,n){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){if(!e.name.value)return void s.showToast("您输入的昵称不能为空");n.changeMessage(e.userName,e.birthday,e.gender,e.name.value).success(function(t,s,i,n){t.success?(o.$broadcast("CHANGE_NAME",e.name.value),a.go("accsetting")):t.message?e.showResult(t.message):e.showResult("未知异常")})},e.goBack=function(){a.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeNameService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("ChangePasswordController",["$scope","ChangePassWordService","PopupService","$timeout","$state","UserService",function(e,t,o,s,i,a){e.user="",e.password={oldWord:"",newWord:"",makeSureWord:""},e.accountMessage="",e.accountToken="",e.updateContent="",e.updateResult=!0,e.init=function(){e.user=a.getUser(),e.accountMessage=e.user.userName,e.accountToken=e.user.token,e.password={oldWord:"",newWord:"",makeSureWord:""}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goLoginPage=function(){i.go("login")},e.doChange=function(){var i=e.globalConstant.passwordRegExp;return e.password.oldWord?e.password.newWord?i.test(e.password.newWord)?e.password.makeSureWord?e.password.makeSureWord!=e.password.newWord?void o.showToast("两次输入的新密码不相同"):void t.doInit(e.accountToken,e.accountMessage,e.password.oldWord,e.password.newWord).success(function(t,o,i,n){t.success?(e.showResult("修改成功"),a.clearUser(),s(function(){e.goLoginPage()},1e3)):e.showResult(t.message)}):void o.showToast("确认密码不能为空"):void o.showToast("新密码不符合规则"):void o.showToast("新密码不能为空"):void o.showToast("原密码不能为空")},e.goBack=function(){i.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangePassWordService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a){var n=o,r={token:n,userName:s,oldPassword:encodeURIComponent(i),password:encodeURIComponent(a)};return e({method:"POST",url:t.getUrl("UPDATEPASSWORD_INIT"),params:r})}}]),APP.controller("SelectSexController",["$scope","$stateParams","$rootScope","$state","SelectSexService","$timeout",function(e,t,o,s,i,a){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doSelect=function(t){e.sex.value=t,i.changeMessage(e.userName,e.birthday,e.sex.value,e.nickName).success(function(s,i,a,n){s.success?(o.$broadcast("SELECT_SEX",t),e.$ionicGoBack()):s.message?e.showResult(s.message):e.showResult("未知异常")})},e.goBack=function(){s.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("SelectSexService",["$http","UrlService",function(e,t){this.changeMessage=function(o,s,i,a){var n={userName:o,birthday:s,gender:i,nickName:a};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:n})}}]),APP.controller("BuyerCenterController",["$scope","AccountMessageService","$state","UserService","LoginService","PopupService","$stateParams","RegisterService","$rootScope",function(e,t,o,s,i,a,n,r,c){e.isBuyer=i.getRole(),e.shareStoreId=n.shareStoreId,e.init=function(t){var o=s.getUser();o.avatarImageFileId?e.avatarImageFileId=o.avatarImageFileId:e.avatarImageFileId=c.imgBaseURL+"img/ic_person.png",e.mid=o.mid,e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.applyShop=function(){0==e.isBuyer?(r.wdApply().success(function(e){e.success?e.data?o.go("shopApply"):o.go("registerForStore"):a.showToast("服务端错误")}).error(function(){alert("网络错误")}),o.go("shopApply")):e.shareStoreId?o.go("myStore",{storeId:e.mid,shareStoreId:e.shareStoreId}):o.go("myStore",{storeId:e.mid})},e.logOut=function(){void 0==e.sessionId?(s.clearUser(),i.setRole(void 0),o.go("guidePage")):t.unloadAccount(e.token,e.sessionId,e.header).success(function(e,t,a,n){if(e.success){s.clearUser(),i.setRole(void 0),o.go("guidePage");var r="Bearer"+e.data;window.localStorage.setItem("sg_login_token_secret",r)}})},e.goBack=function(){o.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.isBuyer=i.getRole(),e.init(0)})}]),APP.controller("BindAccountController",["$scope","EasyConnectBindAccountService",function(e,t){e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,s,i){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("EasyConnectBindAccountService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTACCOUNT_INIT"))}}]),APP.controller("BindResultController",["$scope","EasyConnectBindResultService","$rootScope",function(e,t,o){e.iconImage=o.imgBaseURL+"img/ic_person.png",e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,s,i){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("EasyConnectBindResultService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTRESULT_INIT"))}}]),APP.controller("EasyConnectController",["$localstorage","$scope","EasyConnectService","PopupService","$timeout","$state","InAppBrowserService","UrlService",function(e,t,o,s,i,a,n,r){t.bindData=[],t.account="",t.mobile="",t.updateResult=!0,t.updateContent="",t.init=function(){o.getMessage().success(function(e,o,i,a){e.success?(t.bindData=e.data.kjtAccount,e.data.kjtAccount&&e.data.kjtAccount.status&&"0"==e.data.kjtAccount.status&&(t.account=e.data.kjtAccount.memberRealName,t.mobile=e.data.kjtAccount.memberKjtpayAccount)):e.message?s.showToast(e.message):s.showToast("登录失败！")})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goToAccount=function(){a.go("bindAccount")},t.clickBind=function(){if(!window.device)return void window.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.bind().success(function(o,s,a,c){if(window.device&&window.device.hasNewBrowser){var l=ionic.Platform.isAndroid();if(l){var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}else{var l=ionic.Platform.isAndroid();if(l){var p=cordova.InAppBrowser.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");p.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&i(function(){p.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),p.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&p.close()}),p.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.clickUnBind=function(){if(!window.device)return void window.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.unBlind().success(function(o,s,a,c){var l=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(l){var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var l=ionic.Platform.isAndroid();if(l){var p=cordova.InAppBrowser.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");p.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&i(function(){p.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),p.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&p.close()}),p.addEventListener("exit",function(e){t.init()})}else{var d=n.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,i(function(){t.updateResult=!0},1e3)},t.goBack=function(){a.go("mine")}}]);APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("EasyConnectIframeController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.controller("ClassifyMessageCenterController",["$localstorage","$timeout","$scope","$rootScope","CLASSIFYMESSAGECRNTERService","$state","UserService","InAppBrowserService","UrlService","$http","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.goBack=function(){o.$ionicGoBack()},o.init=function(){i.getMseeageClassify().success(function(e){null==e.data.orderMesagesList?o.orderMessage="":o.orderMessage=e.data.orderMesagesList.content,o.orderNum=e.data.orderNum,null==e.data.platformMesagesList?o.platformMessage="":o.platformMessage=e.data.platformMesagesList.content,o.platformNum=e.data.platformNum,null==e.data.memberMesagesList?o.memberMessage="":o.memberMessage=e.data.memberMesagesList.content,o.memberNum=e.data.memberNum,null==e.data.communityMesagesList?o.communityMessage="":o.communityMessage=e.data.communityMesagesList.content,o.communityNum=e.data.communityNum,o.orderNum>99?o.orderNumClose="99+":o.orderNumClose=o.orderNum,o.platformNum>99?o.platformNumClose="99+":o.platformNumClose=o.platformNum,o.memberNum>99?o.memberNumClose="99+":o.memberNumClose=o.memberNum,o.communityNum>99?o.communityNumClose="99+":o.communityNumClose=o.communityNum})},o.$on("$ionicView.beforeEnter",function(){o.init()}),o.goMessageList=function(e){o.messageType=e,a.go("messageCenter",{messageType:o.messageType})},o.customerServe=function(){if(window.cordova){var s=ionic.Platform.isAndroid(),i=null;i=s?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&t(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+o.kfTocken);return}}]),APP.service("CLASSIFYMESSAGECRNTERService",["$http","UrlService","$rootScope",function(e,t,o){this.getMseeageClassify=function(){var o={messageType:0};return e.get(t.getUrl("MESSAGE_CLASSIFY"),o)},this.getMseeageClassifyNew=function(o){var s={messageType:o};return e.get(t.getUrl("MESSAGE_CLASSIFY"),s)}}]),APP.controller("DetailMessageCenterController",["$scope","$stateParams",function(e,t){e.htmlContent=t.content,e.title=t.title,e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("MessageCenterController",["$ionicScrollDelegate","$timeout","$scope","$rootScope","$stateParams","MESSAGECENTERService","$state","UserService","InAppBrowserService","UrlService","$http",function(e,t,o,s,i,a,n,r,c,l,d){o.messageMap=[],o.breakLine=[],o.mesType=i.messageType,o.messageList="",o.hasmore=!1,o.page=1,o.size=10;var p,u=1,g="";o.goBack=function(){o.$ionicGoBack()},o.init=function(){p=r.getUser(),e.scrollTop(),a.getMessageList(o.mesType,o.page,o.size).success(function(e){1==o.mesType?(o.messageList=e.data.orderMesagesList,o.count=e.data.orderCount):2==o.mesType?(o.messageList=e.data.memberMesagesList,o.count=e.data.memberCount):3==o.mesType?(o.messageList=e.data.platformMesagesList,o.count=e.data.platformCount):4==o.mesType&&(o.messageList=e.data.communityMesagesList,o.count=e.data.communityCount),g=Math.ceil(o.count/o.size),o.hasmore=!(o.page>=g)})},o.loadMore=function(){var e=o.messageList;u+=1;var t={messageType:o.mesType,page:u,size:o.size};d.get(l.getUrl("MESSAGE_CLASSIFY"),t).success(function(t){1==o.mesType?(o.messageList=e.concat(t.data.orderMesagesList),o.count=t.data.orderCount):2==o.mesType?(o.messageList=e.concat(t.data.memberMesagesList),o.count=t.data.memberCount):3==o.mesType?(o.messageList=e.concat(t.data.platformMesagesList),o.count=t.data.platformCount):4==o.mesType&&(o.messageList=e.concat(t.data.communityMesagesList),o.count=t.data.communityCount),o.hasmore=!(o.count<o.messageList.length),o.$broadcast("scroll.infiniteScrollComplete")})},o.goDetail=function(e){var t={id:e.id};a.checkRead(t).success(function(e){a.unreadMessage()});var s=navigator.userAgent;if(1==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(2==e.type)n.go("shopRevenue");else if(3==e.type||51==e.type)n.go("orderDetail",{orderSn:"",cOrderSn:"",cOrderId:e.relationId});else if(4==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(5==e.type)n.go("orderManage",{orderStatus:4});else if(7==e.type)if(-1!=s.indexOf("iPhone")){var i=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);i.addEventListener("exit",function(e){})}else n.go("helpDetail",{helpId:e.relationId,content:e.title});else if(601==e.type)e.relationId?n.go("noteDetails",{noteId:e.relationId,isShortStory:1}):n.go("goldRecord");else if(602==e.type)n.go("noteDetails",{noteId:e.relationId,isShortStory:0});else if(603==e.type)e.relationId?n.go("classNoteDetails",{noteId:e.relationId}):n.go("goldRecord");else if(604==e.type)n.go("myFans");else if(0==e.type){var p=r.getUser().mid;n.go("goldRecord")}else if(-3==e.type)n.go("productRated",{productId:e.relationId});else if(-4==e.type){var u=l.getUrl("ORDER_INFO"),g=$.param({orderId:e.relationId});d({method:"POST",url:u,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.success){var t=e.data.data.ordersn;n.go("orderTracking",{orderSn:t})}},function(e){})}else if(-5==e.type){var p=r.getUser().userId;n.go("refundDetail",{orderProductId:e.relationId,memberId:p})}else-6==e.type?n.go("orderManage"):-12==e.type||-11==e.type?n.go("myCouponsList"):-13==e.type||-15==e.type||-21==e.type?n.go("shopRevenue"):-14==e.type?n.go("walletDiamonds"):o.init()},o.readAll=function(){if(!r.getUser().mid)return void alert("用户id不存在");var t={};a.readAllMessage(t).success(function(t){a.unreadMessage(),e.scrollTop(),u=1,o.init()}).error(function(){alert("全部已读操作失败")})},o.$on("$ionicView.beforeEnter",function(t,s){"back"!=s.direction&&(u=1,o.init(),e.scrollTop())})}]),APP.service("MESSAGECENTERService",["$http","UrlService","$rootScope",function(e,t,o){this.msgCenter=function(o){return e.get(t.getUrl("MSG_CENTER"),o)},this.unreadMessage=function(){return e.get(t.getUrl("UNRED_MESSAGE")).success(function(e){o.unreadMessage=e.data})},this.readAllMessage=function(o){return e.get(t.getUrl("READALL"),o)},this.checkRead=function(o){return e.get(t.getUrl("CHECKREAD"),o)},this.getMessageList=function(o,s,i){var a={messageType:o,page:s,size:i};return e.get(t.getUrl("MESSAGE_CLASSIFY"),a)}}]),APP.controller("MyStoreManageController",["$scope","MyStoreManageService","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","MyStoreService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],e.levelStr="",e.userName="",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.init=function(){f.scrollTop(),e.storeId=window.localStorage.storeId,e.showQQ=!1,e.showWeChat=!1,t.mstore().success(function(t){t.success&&(e.userName=t.data,e.levelStr=e.levelArr[t.data.level],e.myStoreInfo={storeName:e.userName.storeName,qrcode:e.userName.qrCode})}),b.getMyStoreInfo("m","http://m.ehaier.com","http://www.ehaier.com/mstatic","http://m.ehaier.com/v2/mstore/sg/entrance.html",e.storeId).success(function(t){e.myStoreInfo=t.data,e.shareInfo=t.data.share,e.avatarImage=t.data.avatarImageFileId})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showShare=!1,e.myStoreInfo="",e.shareInfo={},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=t);var o=e.avatarImage,s=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?window.umeng.share(t,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",o,s,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=o);var s="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",i=e.avatarImage,a=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?(0==t?window.umeng.shareToSina(o,s,i,a,0,null,T.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,s,i,a,0,null,T.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,s,i,a,0,null,T.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()):4==t&&(window.umeng.shareToQzone(o,s,i,a,0,null,T.shareSuccessCallback),T.qqShare()),5==t?e.copeText(a):T.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),l.fromTemplateUrl("templates/shop/FilterShop.html",{scope:e,animation:"slide-in-left",backdropClickToClose:!1}).then(function(t){e.filterModal=t}),e.openQrcode=function(){e.qrCodemodal.show()},e.backToStore=function(){e.filterModal.hide()},e.closeModal=function(){e.qrCodemodal.hide()},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.filterModal.remove()}),l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),e.saveQrCode=function(){if("undefined"!=typeof cordova){var t="";t=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var o=encodeURI(e.myStoreInfo.qrcode),s={};(new FileTransfer).download(o,t,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();p.showAlert("","图片已经保存至"+t)}else p.showToast("保存成功")},function(e){p.showToast("保存失败！")},!0,s)}}}]),APP.service("MyStoreManageService",["$http","UrlService",function(e,t){this.mstore=function(){return e.get(t.getUrl("MYSTORE"),{})}}]),APP.controller("MyIdCardAuthenController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyIdCardAuthenService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){var t={realName:e.IdCard.realName,identityNo:e.IdCard.identityNo};r.nameAuth(t).success(function(o){o.data?(e.ToMessage=o.message,i.go("myPhoneBind",t,{reload:!0})):e.ToMessage=o.message})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.isSubMint=!1,e.ToMessage="";var A=/(^\d{18}$)|(^\d{17}(\d|X|x)$)/;e.IdCardKeyup=function(){A.test(e.IdCard.identityNo)?e.isSubMint=!0:e.isSubMint=!1},e.goToPhoneBind=function(){if(e.isIdCardAuthen){if(!e.data.identity.realName)return p.showToast("请输入姓名!"),!1;var t={realName:e.data.identity.realName,identityNo:e.IdCard.identityNo};r.realNameCheck(t).success(function(e){e.data?i.go("myPhoneBind",t,{reload:!0}):p.showToast(e.message)})}else{if(!e.IdCard.realName)return p.showToast("请输入姓名!"),!1;b()}},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?(e.data=t.data,t.data.isAuth?(e.isAuth="1",e.isIdCardAuthen=!0):(e.isAuth="0",e.isIdCardAuthen=!1)):(e.isAuth="-1",e.isIdCardAuthen="",p.showToast("获取用户是否认证异常!"))})},e.$on("$ionicView.beforeEnter",function(t,o){f.scrollTop(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.ToMessage="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.FnisAuth()})}]),APP.service("MyIdCardAuthenService",["$http","UrlService",function(e,t){this.realNameAuth=function(o){return e({method:"POST",url:t.getUrl("REALNAMEAUTH"),params:o})},this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.realNameCheck=function(o){return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:o})},this.nameAuth=function(o){return e.get(t.getUrl("GET_NAMEAUTH"),o)}}]),APP.controller("MyPhoneBindController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.mobile="",e.realName="",e.identityNo="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.phone={phone:""},e.goToPhoneBindSuccess=function(){if(!e.realName)return void p.showToast("非法参数姓名！");if(!e.identityNo)return void p.showToast("非法参数证件号");if(!e.globalConstant.mobileNumberRegExp.test(e.phone.phone))return void p.showToast("非法参数手机号");var t={realName:e.realName,identityNo:e.identityNo,mobile:e.phone.phone};r.PhoneAuth(t).success(function(t){t.data?i.go("myPhoneBindNewCode",{mobile:e.phone.phone,realName:e.realName,identityNo:e.identityNo},{reload:!0}):p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.phone.phone="",f.scrollTop(),t.realName&&t.identityNo&&(e.realName=t.realName,e.identityNo=t.identityNo)})}]),APP.service("MyPhoneBindService",["$http","UrlService",function(e,t){this.PhoneAuth=function(o){return e.get(t.getUrl("GET_PHONEAUTH"),o)}}]),
APP.controller("MyPhoneBindNewCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,e.realName=t.realName,e.identityNo=t.identityNo,e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):p.showToast(t.message)})},e.goToIdCard=function(){var t={mobileNum:e.Phone,captcha:e.code.captcha,oldMobileNo:e.oldMobileNo,realName:e.realName,identityNo:e.identityNo};r.changeMobile(t).success(function(t){t.success?i.go("myPhoneBindSuccess",{phone:e.Phone},{reload:!0}):p.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2"),e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):p.showToast(t.message)})})}]),APP.controller("MyPhoneBindSuccessController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindSuccessService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","$localstorage",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.phone="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/myPhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.unload=function(){n.clearUser(),y.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),b.set("storeId",""),i.go("login")},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.phone=t.phone})}]),APP.service("MyPhoneBindSuccessService",["$http","UrlService",function(e,t){}]),APP.controller("MyPhoneCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.opacity=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,e.isAuth="-1",e.userData="",e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.opacity=!0,e.CodePhoneState=2,b()):p.showToast(t.message)})},e.goToIdCard=function(){r.checkMobile(e.code).success(function(t){if(t.success)if(1==e.isAuth){var o={realName:e.userData.identity.realName,identityNo:e.userData.identity.identityNo};i.go("myPhoneBind",o,{reload:!0})}else 0==e.isAuth?i.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):(p.showToast("获取用户是否认证异常!"),e.FnisAuth());else p.showToast(t.message)})},e.MobileIsUnavailable=function(){1==e.isAuth?i.go("myIdCardAuthen",{isAuth:!0},{reload:!0}):0==e.isAuth?i.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):e.FnisAuth()},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?t.data.isAuth?e.isAuth="1":e.isAuth="0":e.isAuth="-1",e.userData=t.data})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.opacity=!1,e.FnisAuth(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2",e.opacity=!0),e.code={captcha:"",mobileNum:e.Phone}})}]),APP.service("MyPhoneCodeService",["$http","UrlService",function(e,t){this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.captchaMobile=function(o){var s={mobileNum:o};return e.get(t.getUrl("CAPTCHAMOBILE"),s)},this.checkMobile=function(o){return e.get(t.getUrl("CHECKMOBILE"),o)},this.changeMobile=function(o){return e({method:"POST",url:t.getUrl("CHANGEMOBILE"),params:o})}}]),APP.controller("MyPhoneManageController",["$ionicPopup","HomePageService","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneManageService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y,T,C,b,A,v){o.$on("$ionicView.beforeEnter",function(){o.isUser=!1,o.isUsers=function(){t.isWdHost().success(function(t){o.isWdHost=t.data.isHost,null==t.data.o2o||1==t.data.o2o?e.show({template:"尊贵的VIP商户，请前往商户中心修改手机号。",buttons:[{text:"好的，我知道了！",onTap:function(){o.$ionicGoBack()}}]}):1==o.isWdHost?n.go("myPhoneCode"):0==o.isWdHost&&(o.isUser=!0)})},o.goUpgrade=function(){n.go("newAuthenticationHome"),o.isUser=!1},o.closePopup=function(){o.isUser=!1},v.scrollTop(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.isIosApp=!0:o.isIosApp=!1,o.GoBackImgUrl=i.imgBaseURL+"img/addressBack@2x.png",o.ResultImgUrl=i.imgBaseURL+"img/PhoneManage@2x.png",o.storeId=window.localStorage.storeId,o.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),o.Phone=o.USER_CACHE_KEY.mobile})}]),APP.service("MyPhoneManageService",["$http","UrlService",function(e,t){}]),APP.controller("ShopAddressController",["$scope","$stateParams","$rootScope","ShopAddressServicee","PopupService","$timeout",function(e,t,o,s,i,a){e.provinceId="",e.cityId="",e.regionId="",e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.textALL="",e.panGoOn=!1,e.address={value:t.default},e.detailAddress={value:t.defaultDetail},e.updateResult=!0,e.updateContent="";var n=t.hrCode,r=t.memberType;e.init=function(){n=t.hrCode;t.memberType;0==e.panGoOn&&(e.address={value:t.default},e.provinceId=t.provinceId,e.cityId=t.cityId,e.regionId=t.regionId),e.detailAddress={value:t.defaultDetail},e.panGoOn=!1},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.address.value&&e.detailAddress.value?e.detailAddress.value.length>50||e.detailAddress.value.length<2?void i.showToast("你输入的地址字符长度应在2-50之间"):void s.doInit(e.address.value,e.detailAddress.value,e.provinceId,e.cityId,e.regionId,n,r).success(function(t,s,i,a){1==t.success?(o.$broadcast("SHOP_ADDRESS",e.address.value),o.$broadcast("SHOP_DETAILADDRESS",e.detailAddress.value),e.$ionicGoBack()):e.showResult("修改失败")}):void i.showToast("您输入的地址不能为空")},o.$on("SHOPADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.provinceId=o["value-1"],e.cityId=o["value-2"],e.regionId=o["value-3"],e.textALL=e.textOne+e.textTwo+e.textThree+e.textFour,e.address={value:e.textALL}}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopAddressServicee",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c){var l={};if("人人服务（服务兵创业）"==c)var l={provinceId:i,cityId:a,regionId:n,regionName:o,address:s,hrCode:r,memberType:10};else var l={provinceId:i,cityId:a,regionId:n,regionName:o,address:s};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:l})}}]),APP.controller("ShopLegendController",["$scope","$stateParams","ShopLegendService","$rootScope","PopupService",function(e,t,o,s,i){e.selectText=t.default;var a=t.provinceId,n=t.cityId,r=t.regionId;e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.goToLegend=!1,e.isHaierCloud=!1,e.init=function(){e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.showAlert=!1,e.showAlertCheck=!1,"海尔云店"!=e.selectText&&(e.isHaierCloud=!1)},e.doChange=function(){e.showAlert=!1,e.showAlertCheck=!1;var t=/^(?!HR|hr|Hr|hr).*$/;if("人人服务（服务兵创业）"==e.selectText&&(e.valueUnion=10,t.exec(e.hrCode.value)||e.hrCode.value.length>20||e.hrCode.value.length<8))return void(e.showAlert=!0);e.hrCodeOld==e.hrCode.value?o.doInit(e.valueUnion,a,n,r,e.hrCode.value).success(function(t,o,a,n){1==t.success?(s.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?i.showToast(t.message):i.showToast("未知异常")}):o.check(e.hrCode.value).success(function(t,c,l,d){t?o.doInit(e.valueUnion,a,n,r,e.hrCode.value).success(function(t,o,a,n){1==t.success?(s.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?i.showToast(t.message):i.showToast("未知异常")}):e.showAlertCheck=!0})},s.$on("SHOP_SELECT_UNION",function(t,o){e.goToLegend=!0,e.textUnion=o.text,e.valueUnion=o.value,e.selectText=e.textUnion,"海尔云店"==e.selectText&&(e.isHaierCloud=!0)}),e.$on("$ionicView.beforeEnter",function(o,s){"forward"==s.direction&&(e.selectText=t.default),e.init()})}]),APP.service("ShopLegendService",["$http","UrlService",function(e,t){this.check=function(o){var s={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),s)},this.doInit=function(o,s,i,a,n){var r={memberType:o,provinceId:s,cityId:i,regionId:a,hrCode:n};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:r})}}]),APP.controller("ShopMessageController",["$scope","ShopMessageService","$rootScope","PopupService",function(e,t,o,s){e.shopMessageID="",e.shopMessageName="",e.shopMessageAddress="",e.shopMessageDetailAddress="",e.shopMessageLegend="",e.provinceId="",e.cityId="",e.regionId="",e.isHaierCloud="",e.hrCode="",e.init=function(){e.isHaierCloud=!1,t.getShopMessage().success(function(t,o,i,a){t.success?(e.shopMessageID=t.data.storeInfo.memberId,e.shopMessageName=t.data.storeInfo.storeName,e.shopMessageAddress=t.data.storeInfo.regionName,e.shopMessageDetailAddress=t.data.storeInfo.address,e.shopMessageLegend=t.data.storeInfo.memberName,e.provinceId=t.data.storeInfo.provinceId,e.cityId=t.data.storeInfo.cityId,e.regionId=t.data.storeInfo.regionId,e.hrCode=t.data.storeInfo.hrCode,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!0)):s.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),o.$on("SHOP_NAME",function(t,o){e.shopMessageName=o}),o.$on("SHOP_LEGEND",function(t,o){e.shopMessageLegend=o,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!1)}),o.$on("SHOP_ADDRESS",function(t,o){e.shopMessageAddress=o}),o.$on("SHOP_DETAILADDRESS",function(t,o){e.shopMessageDetailAddress=o})}]),APP.service("ShopMessageService",["$http","UrlService",function(e,t){this.getShopMessage=function(){return e.get(t.getUrl("SHOPINFO_INIT"))}}]),APP.controller("ShopNameController",["$scope","$stateParams","$rootScope","ShopNameService","PopupService","$timeout",function(e,t,o,s,i,a){e.name={value:t.default},e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.default}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.name.value?/[\ud800-\udbff][\udc00-\udfff]/g.test(e.name.value)?void i.showToast("亲，不可以使用表情喔!"):void s.checkName(e.name.value).success(function(t,o,a,n){t.data?s.changeName(e.name.value).success(function(t,o,s,i){t.success&&e.$ionicGoBack()}):i.showToast("您的名称中含有敏感词,请重新输入")}):void i.showToast("您输入的店铺名称不能为空")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,a(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopNameService",["$http","UrlService",function(e,t){this.checkName=function(o){var s={checkword:o};return e.get(t.getUrl("CHECKSHOPNAME_INIT"),s)},this.changeName=function(o){var s={wdName:o};return e.get(t.getUrl("CHANGESHOPNAME_INIT"),s)}}]),APP.controller("storeTeamOwnerController",["$http","$scope","$cacheFactory","storeTeamOwnerService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","HomePageService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I,w,y){function T(e,o){s.storeInfo({visitType:e,daysType:o}).success(function(e){1==e.success&&(t.storeVisitInfo=e.data.storeVisitInfo,t.commonVisitList=e.data.commonVisitList)})}function C(e){var t=[];for(var o in e)t.push([e[o],o]);t.reverse();for(var s=t.length,e=[],o=0;o<s;o++)e.push({date:t[o][1],act:t[o][0]});return e}t.navtabs=[{title:"店铺数据"},{title:"团队数据"},{title:"个人数据"}],t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.setStorage=function(e,o,i,a,r,c){t.userinfo={img:e,name:o,time:i,where:a},s.visitorInfo=t.userinfo,s.getVisitorBrowHis(r,c).success(function(e){if(e.success){if(t.visiProductList=e.data,0==t.visiProductList.length)return!1;n.go("VisitorBrowHistory",{userId:r,daysType:c})}})},t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,t.partnerTitle="partner",t.teamTitle="team",t.switchType=function(e){t.typeState[e]||(t.typeState=[!1,!1,!1],t.typeState[e]=!0),0==e?(t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,T(t.visitType,t.daysType)):1==e?(t.storeActived=!1,t.teamActived=!0,t.ownerActived=!1,s.teamInfo().success(function(e){1==e.success&&(t.teamDetail=e.data)})):2==e&&(t.storeActived=!1,t.teamActived=!1,t.ownerActived=!0,s.ownerInfo().success(function(e){if(1==e.success){t.ownerDetail=e.data,t.ownerMonthReport=e.data.storeMemberMonthReport,t.ownerteamLevel=e.data.teamLevel,t.items=e.data.map;var o=C(e.data.map);t.lists=o}}),s.ownerCommi().success(function(e){1==e.success&&(t.predictCommi=e.data.newBrokerageAmount,t.totalCommi=e.data.totalBrokerageAmount)})),m.scrollTop()},t.dayType=function(e){t.dayState[e]||(t.dayState=[!1,!1],t.dayState[e]=!0),0==e?(t.rankText="7天访客排行榜",t.daysType="WEEK",T(t.visitType,t.daysType)):1==e&&(t.rankText="30天访客排行榜",t.daysType="MONTH",T(t.visitType,t.daysType))},t.$on("$ionicView.beforeEnter",function(e,o){if("back"==o.direction)return void w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1});t.userMemberId=JSON.parse(localStorage.getItem("USER_CACHE_KEY")).mid||"",t.typeState=[!0,!1,!1],t.dayState=[!0,!1],t.rankText="7天访客排行榜",t.daysType="WEEK",t.visitType="STORE",t.init()}),t.days=[{text:"最近7天"},{text:"最近30天"}],t.items={},t.openHis=function(){var e=d.show({template:"\n          <div class='his-box' scrollbar-y=\"false\">\n            <h3>历史团队活跃度</h3>\n            <h5>最近12个月</h5>\n            <div class='his-nav' flex='main:justify cross:center'>\n              <div>年/月</div>\n              <div>活跃度</div>\n            </div>\n            <div class='his-list'>\n              <div class='his-item' ng-repeat='list in lists' flex='main:justify cross:center'>\n                <div class='his-month'>{{list.date}}</div>\n                <div class='his-act'>{{list.act}}%</div>\n              </div>\n            </div>\n            <div class='his-close'>\n              <div class=\"close-img\" ng-click='closeHis()'>\n                <img ng-src=\"{{imgBaseURL}}img/hisClose@2x.png\" alt=\"关闭\" />\n              </div>\n              <span class='close-bor'></span>\n            </div>\n          </div>\n        ",scope:t});t.closeHis=function(){e.close()}},t.goBack=function(){t.$ionicGoBack()};l.getUser();t.init=function(){T(t.visitType,t.daysType),t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.PercentageCal=function(e,t){var o=parseFloat(e),s=parseFloat(t);return s>o?isNaN(o)||isNaN(s)?"-":s<=0?"0%":Math.round(o/s*1e4)/100+"%":"100%"}}]),APP.service("storeTeamOwnerService",["$http","UrlService",function(e,t){this.storeInfo=function(o){var s=t.getUrl("GET_STORE_DATA");return e.get(s,o)},this.teamInfo=function(o){var s=t.getUrl("GET_TEAM_DATA");return e.get(s,o)},this.ownerInfo=function(o){var s=t.getUrl("GET_OWNER_DATA");return e.get(s,o)},this.ownerCommi=function(o){var s=t.getUrl("REPORT_DETAIL_PLUS");return e.get(s,o)},this.visitorInfo="",this.getVisitorBrowHis=function(o,s){var i={userId:o,daysType:s};return e.get(t.getUrl("GET_VISI_BROW_HIS"),i)}}]),APP.controller("teamProductMsgController",["storeTeamOwnerService","$http","$scope","teamProductMsgService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){function I(){var e=document.getElementById("shopRevenueChart"),t=echarts.init(e);T=t;var s=null;(s={title:{text:A,left:"30%",top:"2%",textStyle:{fontWeight:"normal",fontSize:14,color:"#172434",letterSpacing:0,lineHeight:14}},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"none"}},xAxis:{type:"category",boundaryGap:!1,data:o.statisticDays,axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}},yAxis:[{type:"value",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbolSize:8,areaStyle:{normal:{color:"#cee9f6"}},lineStyle:{color:"#37bfff"},itemStyle:{normal:{color:"#37bfff"}},data:o.data}]})&&"object"==typeof s&&(t.setOption(s,!0),t.setOption(s))}function w(e,t){return 1==e?void(b=t.storeUv):2==e?void(b=t.storePv):3==e?void(b=t.productUv):4==e?void(b=t.productPv):5==e?void(b=t.shareUv):6==e?void(b=t.sharePv):void 0}function y(e,t,s,i){for(var a=0;a<e.length;a++)o.statisticDays.push(e[a].statisticDays),1==s?o.data.push(e[a].storeUv):2==s?o.data.push(e[a].storePv):3==s?o.data.push(e[a].productUv):4==s?o.data.push(e[a].productPv):5==s?o.data.push(e[a].shareUv):6==s&&o.data.push(e[a].sharePv);"WEEK"==t?(w(s,i),C=7,A="最近"+C+"天: "+b+o.titleText):(w(s,i),C=30,A="最近"+C+"天: "+b+o.titleText)}o.data=[],o.statisticDays=[];var T="",C="",b="",A="";o.titleList=["访客数","浏览次数","商品访客数","商品浏览量","分享访问人数","分享访问次数"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.commonFun=function(e,t){s.storeInfo(e,t).success(function(e){e.success&&(o.commonVisitList=e.data.commonVisitList,o.daysType=7==e.data.commonVisitDetail.statisticDays?"WEEK":"MONTH",o.commonVisitDetail=e.data.commonVisitDetail,o.myInComeOut=e.data.commonVisitTendencyList,o.storeVisitInfo=e.data.storeVisitInfo,1==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):2==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):3==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):4==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):5==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()):6==o.num&&(y(o.myInComeOut,t,o.num,o.storeVisitInfo),I()))})},o.init=function(){1!=o.num&&2!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?3!=o.num&&4!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?5!=o.num&&6!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days||(o.share="SHARE",o.commonFun(o.share,o.days)):(o.product="PRODUCT",o.commonFun(o.product,o.days)):(o.store="STORE",o.commonFun(o.store,o.days)),1==o.num||3==o.num||5==o.num?(o.personNum=!0,o.titleText="人"):2!=o.num&&4!=o.num&&6!=o.num||(o.titleText="次")},o.setStorage=function(t,s,i,a,r,c,l){if(3!=t&&4!=t)return!1;o.userinfo={img:s,name:i,time:a,where:r},e.visitorInfo=o.userinfo,e.getVisitorBrowHis(c,l).success(function(e){if(e.success){if(o.visiProductList=e.data,0==o.visiProductList.length)return!1;n.go("VisitorBrowHistory",{userId:c,daysType:l})}})},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){C="",b="",A="",o.num=i.num,o.days=i.type,o.data=[],o.statisticDays=[],o.fsfsafa=!0,o.init()}),o.$on("$ionicView.beforeLeave",function(){T&&T.dispose(),o.fsfsafa=!1})}]),APP.service("teamProductMsgService",["$http","UrlService",function(e,t){this.storeInfo=function(o,s){var i={visitType:o,daysType:s};return e.get(t.getUrl("STORE_PRODUCT"),i)}}]),APP.controller("TeamController",["$ionicHistory","$scope","TeamService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.history=[],t.hShow=!0,t.hShowB=!0;localStorage.getItem("historys");t.arrowState=[p.imgBaseURL+"img/Group@2x.png",p.imgBaseURL+"img/Group1@2x.png",p.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["openTime","openTimeDesc"],"authDesc","leaderDesc"],t.isShowUp=!1,t.isIos=!1,t.screenWidth=window.screen.width,t.front=l.front,t.shareStoreId=l.shareStoreId,t.isBuyer=g.getRole(),t.userId=n.getUser().mid;var v="",$="0";t.brand=!1,t.brandName="全部",t.brandList=[],t.filterParameterArr=["hasStock","all","0"],t.StockStateArr=["all","hasStock"],t.filterParams="",-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.screenWidth<375?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:t.screenWidth<414?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},t.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},t.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),t.clearLocal=function(){localStorage.removeItem("historys"),t.hShow=!1,t.hShowB=!0},t.$on("$ionicView.beforeEnter",function(e,o){m.scrollTop(),t.isBuyer=g.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.topStyle={top:"64px"}:t.topStyle={top:"44px"},t.showTab=!1,t.filterParams="",t.lianXC=!1,t.storeId=d.get("storeId",p.globalConstant.storeId),t.isBuyer=g.getRole(),t.userId=n.getUser().mid,"back"==o.direction?(t.hShow=!1,t.hotWordShow=!1,t.hShowB=!1):(localStorage.getItem("historys")?(t.hShow=!0,t.hShowB=!1):(t.hShow=!1,t.hShowB=!0),t.tabNav="selection",t.hasmore=!1,t.typeChoose="商品",$="0",t.gsPlaceholder="请搜索名字、型号等关键字",t.searchData=null,t.page=2,t.front=l.front,v=l.shareStoreId?l.shareStoreId:n.getUser().mid,t.searchGoodsName={name:""})}),t.loadMore=function(){0==t.front?o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,2,t.filterParams,!0).success(function(e,o,s,i){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}):1==t.front&&o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1,t.filterParams,!0).success(function(e,o,s,i){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)})},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e)){if(m.scrollTop(),t.page=2,0==e){t.chooseIndex=e;var s=1==t.openStoreTime_index?0:1;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.filterParams=tabState[1][s],t.searchData=[]}else 1==e?(t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.searchData=[]):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.filterParams="saleDesc",t.searchData=[]);o.myStoreSearch("1","5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,s,i){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})}},t.closeComprehensiveSub=function(){t.showComprehensiveSub=!t.showComprehensiveSub},t.selectComprehensiveSub=function(e,s){s.stopPropagation(),0==e&&(t.filterParams="isHotDesc"),t.lianXC=!1,t.selectComprehensiveSubIndex=e,t.showComprehensiveSub=!t.showComprehensiveSub,t.chooseIndex=0,t.productList=[],t.comprehensive_index=1,t.commission_index=0,t.price_index=0,t.filter_index=0,o.myStoreSearch("1","5",v,t.searchGoodsName.name,$,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,s,i){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0,t.comprehensive_index=1,t.chooseIndex=0,t.showComprehensiveSub=!1):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})},t.chooseStockState=function(e){t.filterParameterArr[0]=t.StockStateArr[e]},t.$on("$destroy",function(){t.filterModal.remove()})}]),APP.service("TeamService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,s,i,a,n,r,c,l,d,p){var u={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:p};return e.get(t.getUrl("SEARCHGOODS_INIT"),u)},this.myStoreSearch=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pageIndex:o,pageSize:s,memberId:i,keyword:a,searchType:n,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:p,filterData:u,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)}}]),APP.controller("ApplyForWhiteController",["$scope","InAppBrowserService","UrlService","$rootScope","InAppBrowserService","ManageMoneyService","WhiteShowsService","UserService",function(e,t,o,s,t,i,a,n){e.toHelp=function(e,s){-1!=navigator.userAgent.indexOf("iPhone")?t.open(o.getHead()+"mstore/sg/helpDetail.html?id="+e,s):$state.go("helpDetail",{helpId:e,content:s})},e.goBack=function(){e.$ionicGoBack()},e.applyToWihte=function(){a.applyForOpen({backUrl:window.location.href,userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(e){e.success&&a.openApplyWhiteShows(e.data.redirectUrl,"http://m.ehaier.com/#/applyForWhite")})}}]),APP.service("WhiteShowsService",["InAppBrowserService","UrlService","$http",function(e,t,o){this.applyForOpen=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_APPLY"),params:e})},this.queryAvaliAmt=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_QUERY_AVALIAMT"),params:e})},this.payApply=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_PAY"),params:e})},this.queryIousStatus=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_QUERY_STATUS"),params:e})},this.cost=function(e){return o({method:"POST",url:t.getNewUrl("WHITE_SHOWS_COST"),params:e})},this.openApplyWhiteShows=function(e,t){window.cordova?window.emc.presentH5View(e,"顺逛白条"):window.location.href=e}}]),APP.controller("MyWalletController",["$scope","$state","MyWalletService","InAppBrowserService","UrlService","UserService","WhiteShowsService",function(e,t,o,s,i,a,n){function r(){o.getWallet().success(function(t){t.success&&(e.walletInfo=t.data)}).error(function(e){alert("网速较慢，请稍候再试")}),n.queryIousStatus({userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(t){t.success&&(e.whiteShowsState=t.data.applyStatus,1==e.whiteShowsState&&n.queryAvaliAmt({token:a.getUser().accessToken}).success(function(t){t.success&&(e.crdComAmt=t.data.crdComAmt,e.crdComAvailAmt=t.data.crdComAvailAmt)}).error(function(e){alert("网速较慢，请稍候再试")}))}).error(function(e){alert("网速较慢，请稍候再试")})}e.walletInfo=[],e.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,o):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(e,t){r()}),e.toApplyForWhite=function(e){2!=e?n.applyForOpen({backUrl:window.location.href,userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(e){e.success&&n.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):t.go("applyForWhite")}}]),APP.service("MyWalletService",["$http","UrlService",function(e,t){this.getWallet=function(){return e.get(t.getUrl("GET_WALLET"))}}]),APP.controller("walletDiamCtrl",["$scope","$state","$ionicHistory","$interval","walletDiamService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,s,i,a,n,r,c,l,d){e.index=null,e.diamgetlist=[],e.pagenum1=1,e.hasmore=!1,e.usableDiamond="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){a.scrollTop(),d.getWallet().success(function(t){e.usableDiamond=t.data.usableDiamond}).error(function(){}),e.pagenum1=1,e.hasmore=!0,i.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.diamgetlist=t.data.paymentList})},e.changelist=function(t){e.diamgetlist=[],a.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,i.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.diamgetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,i.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.diamgetlist=e.diamgetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.diamgetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletDiamService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,s,i){var a={memberId:o,benefitType:"diamond",transType:i,pageNo:s,pageSize:10},n={memberId:o,benefitType:"diamond",pageNo:s,pageSize:10};return null==i?e.get(t.getUrl("GET_WALLETDETAIL"),n):e.get(t.getUrl("GET_WALLETDETAIL"),a)}}]),APP.controller("walletIntCtrl",["$scope","$state","$ionicHistory","$interval","walletIntService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,s,i,a,n,r,c,l,d){e.index=null,e.integetlist=[],e.pagenum1=1,e.hasmore=!1,e.seashellPoint="",e.seashellPointAmt="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){a.scrollTop(),
d.getWallet().success(function(t){e.seashellPoint=t.data.seashellPoint,e.seashellPointAmt=t.data.seashellPointAmt}).error(function(){}),e.pagenum1=1,e.hasmore=!0,i.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.integetlist=t.data.paymentList})},e.changelist=function(t){e.integetlist=[],a.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,i.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.integetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,i.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.integetlist=e.integetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.integetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletIntService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,s,i){var a={memberId:o,benefitType:"seashell",transType:i,pageNo:s,pageSize:10},n={memberId:o,benefitType:"seashell",pageNo:s,pageSize:10};return null==i?e.get(t.getUrl("GET_WALLETDETAIL"),n):e.get(t.getUrl("GET_WALLETDETAIL"),a)}}]),APP.controller("designDetailController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","designDetailService","$ionicSlideBoxDelegate","PopupService","GoodsService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p){t.shareimg="",t.showShare=!1,t.title="",t.sharedesp="",t.soluteId=e.soluteId,t.hasmore=!0,t.pageIndex=1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.init=function(){t.showQQ=!1,t.showWeChat=!1,t.showShare=!1,t.designerData={},t.pageIndex=1,t.listdata=[],window.cordova?t.isApp=!0:t.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),r.getPageDate(t.soluteId).success(function(e){t.designerData=e.data,t.shareimg=t.designerData.avatar,t.title=t.designerData.name,t.sharedesp=t.designerData.introduction}),t.loadmore=function(){r.gettopicDate(t.pageIndex,4,t.soluteId).success(function(e){0==e.data.length?(t.hasmore=!1,t.listdata=t.listdata.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.listdata=t.listdata.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.goshare=function(){if(!a.getUser().mid)return void n.go("login");t.showShare=!t.showShare},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.title,a=t.sharedesp,n=t.shareimg?t.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=s.getShareLinkHeader()+"designDetail/"+t.soluteId;window.umeng?(0==e?window.umeng.shareToSina(o,a,n,r,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,a,n,r,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,a,n,r,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()),5==e?t.copeText(r):i.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.goback=function(){p.goBack()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("designDetailService",["$http","UrlService",function(e,t){this.getPageDate=function(o){var s={id:o};return e.get(t.getNewUrl("DESIGN_DETAIL"),s)},this.gettopicDate=function(o,s,i){var a={pageIndex:o,pageSize:s,id:i};return e.get(t.getNewUrl("DESIGN_SOLULIST"),a)}}]),APP.controller("exStoreDetailController",["$ionicActionSheet","$scope","$rootScope","UrlService","CreditService","exStoreDetailService","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","BannerThemeService","GoodsService","CommonAddressService","$stateParams",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){t.pageData={},t.name="体验店",t.nearbyId=g.nearbyId,1==o.globalConstant.positionStatus?t.cityId=u.getAddressInfo().cityId+"":t.cityId=173,t.init=function(){t.pageData={},t.name="体验店",a.getstore(t.nearbyId,o.globalConstant.lat,o.globalConstant.lon).success(function(e){t.pageData=e.data,t.name=t.pageData.name,r.update(),r.$getByHandle("exStoreDetail_slide").loop(!0)})},t.callphone=function(){if(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova)return void window.open("tel:"+t.pageData.mobile,"_system");c.confirm({cssClass:"extorecall",template:t.pageData.mobile,cancelText:"取消",okText:"呼叫"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+t.pageData.mobile,"_system"):window.open("tel:"+t.pageData.mobile))})},t.openmap=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.show({buttons:[{text:"高德地图"},{text:"百度地图"},{text:"Apple 地图"}],cancelText:"取消",buttonClicked:function(e){switch(e){case 0:window.emc.presentH5View(encodeURI("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0"),"高德地图");break;case 1:window.emc.presentH5View(encodeURI("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店"),"百度地图");break;case 2:window.location.href=encodeURI("http://maps.apple.com/?q="+t.pageData.name+"&sll="+t.pageData.longitude+","+t.pageData.latitude+"&z=10&t=s")}}}):e.show({buttons:[{text:"高德地图"},{text:"百度地图"}],cancelText:"取消",buttonClicked:function(e){switch(e){case 0:window.cordova?window.emc.presentH5View("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0","高德地图"):window.open("http://uri.amap.com/marker?position="+t.pageData.longitude+","+t.pageData.latitude+"&name="+t.pageData.name+"&coordinate=gaode&callnative=0","_blank","location=yes");break;case 1:window.cordova?window.emc.presentH5View("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店","百度地图"):window.open("http://api.map.baidu.com/geocoder?address="+t.pageData.address+"&output=html&src=顺逛微店","_blank")}}})},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()})}]),APP.service("exStoreDetailService",["$http","UrlService",function(e,t){this.getstore=function(o,s,i){var a={nearbyId:o,latitude:s,longitude:i};return e.get(t.getNewUrl("TEST_STORE_DETAIL"),a)}}]),APP.controller("exportDetailController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","exportDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m){t.exportId=e.exportId,t.pageIndex=1,t.pageSize=4,t.hasmore=!0,t.init=function(){t.pageData={},t.ajanli=[],t.pageIndex=1,t.pageSize=4,r.getPageDate(t.exportId,1,t.pageSize).success(function(e){t.pageData=e.data}),t.loadmore=function(){r.getPageDate(t.exportId,t.pageIndex,t.pageSize).success(function(e){0==e.data.details.length?(t.hasmore=!1,t.ajanli=t.ajanli.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.ajanli=t.ajanli.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("exportDetailService",["$http","UrlService",function(e,t){this.getPageDate=function(o,s,i){var a={channel:1,id:o,pageIndex:s,pageSize:i};return e.get(t.getNewUrl("EXPORT_DETAIL"),a)}}]),APP.controller("fullHouseSolutionController",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","fullHouseSolutionService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicScrollDelegate",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f){t.shareimg=o.smartNav?o.smartNav:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",t.showShare=!1,t.sharedesp="",t.soluteId=e.soluteId,t.hasmore=!0,t.pageIndex=1,t.title="",t.init=function(){t.showQQ=!1,t.showWeChat=!1,t.showShare=!1,t.exportDate=[],t.recommend=[],t.housetopic=[],t.housetopictitle="",t.title="",t.videotag&&t.videotag.pause(),t.pageIndex=1,window.cordova?t.isApp=!0:t.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),r.getPageDate(t.soluteId).success(function(e){t.banners=e.data.banners,t.exportDate=e.data.expert.experts,t.recommend=e.data.recommend.recommends,t.title=e.data.name,t.sharedesp=e.data.name,d.update(),d.$getByHandle("fullHouseSolution_slide").loop(!0)}),t.loadmore=function(){r.gettopicDate(t.pageIndex,6,t.soluteId).success(function(e){t.housetopictitle=e.data.title,0==e.data.storys.length?(t.hasmore=!1,t.housetopic=t.housetopic.concat(e.data.storys),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.housetopic=t.housetopic.concat(e.data.storys),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.playing=function(e){t.clickimg=!0,e.target.style.display="none",t.imgtag=e.target,t.videotag=e.target.nextElementSibling,e.target.nextElementSibling.play(),t.targetv=e.target.nextElementSibling,t.targetv.addEventListener("ended",function(){e.target.style.display="block"})},t.divclick=function(){t.clickimg?t.clickimg=!1:t.videotag&&(t.videotag.pause(),t.imgtag.style.display="block")},t.onScroll=function(){var e=f.getScrollPosition().top;t.$apply(function(){e>=150&&t.imgtag&&"none"==t.imgtag.style.display&&(t.videotag.pause(),t.imgtag.style.display="block")})},t.goshare=function(){if(!a.getUser().mid)return void n.go("login");t.showShare=!t.showShare},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.sharedesp,a=t.sharedesp,n=t.shareimg?t.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=s.getShareLinkHeader()+"fullHouseSolution/"+t.soluteId;window.umeng?(0==e?window.umeng.shareToSina(o,a,n,r,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,a,n,r,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,a,n,r,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone(o,a,n,r,0,null,i.shareSuccessCallback),i.qqShare()),5==e?t.copeText(r):i.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$ionicView.beforeLeave",function(){t.videotag&&t.videotag.pause()}),t.$on("$ionicView.enter",function(e,o){ionic.on("scroll",t.onScroll,t.$$childHead.scrollCtrl.element)}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("fullHouseSolutionService",["$http","UrlService",function(e,t){this.getPageDate=function(o){var s={id:o};return e.get(t.getNewUrl("FULL_SOLUTION"),s)},this.gettopicDate=function(o,s,i){var a={group:2,itemsId:1,pageIndex:o,pageSize:s,programsId:i};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),a)}}]),APP.controller("homeDesignsthController",["$ionicActionSheet","$scope","$rootScope","UrlService","CreditService","homeDesignsthService","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","BannerThemeService","GoodsService","CommonAddressService","$ionicModal",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g){t.filtertag=[],t.all=[],t.anliproIds="",t.pageIndex=1,t.pageSize=3,t.dataList=[],t.hasmore=!0,t.init=function(){t.pageIndex=1,t.pageSize=3,t.dataList=[],t.hasmore=!0,t.anliproIds="",a.getfiltertag().success(function(e){t.filtertag=e.data;for(var o=0;o<t.filtertag.length;o++)t.all[o]=!0}),t.loadmore=function(){a.getdata(t.anliproIds,t.pageIndex,t.pageSize).success(function(e){0==e.data.length?(t.hasmore=!1,t.dataList=t.dataList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.dataList=t.dataList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.openFilterModal=function(){t.filterModal.show()},t.choosetype=function(e,o,s){for(var i=0;i<o.labels.length;i++)o.labels[i].chooseFlag=!1;e.chooseFlag=!0,t.all[s]=!1},t.chooseAll=function(e,o){t.all[e]=!0;for(var s=0;s<o.labels.length;s++)o.labels[s].chooseFlag=!1},t.resetFilter=function(){for(var e=0;e<t.filtertag.length;e++){t.all[e]=!0;for(var o=0;o<t.filtertag[e].labels.length;o++)t.filtertag[e].labels[o].chooseFlag=!1}},t.filterEnsure=function(){t.anliproIds="",t.pageIndex=1,t.dataList=[];for(var e=0;e<t.filtertag.length;e++)for(var o=0;o<t.filtertag[e].labels.length;o++)1==t.filtertag[e].labels[o].chooseFlag&&(t.anliproIds+=t.filtertag[e].labels[o].id+",");t.anliproIds&&(t.anliproIds=t.anliproIds.slice(0,t.anliproIds.length-1)),a.getdata(t.anliproIds,t.pageIndex,t.pageSize).success(function(e){t.dataList=e.data}),t.filterModal.hide()},g.fromTemplateUrl("templates/product/homedesModal.html",{scope:t,animation:"slide-in-left",backdropClickToClose:!0}).then(function(e){t.filterModal=e}),t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$destroy",function(){t.filterModal.remove()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("homeDesignsthService",["$http","UrlService",function(e,t){this.getfiltertag=function(){return e.get(t.getNewUrl("FILTER_TAG"))},this.getdata=function(o,s,i){var a={ids:o,pageIndex:s,pageSize:i};return e.get(t.getNewUrl("FILTER_PRODUCTLIST"),a)}}]),APP.controller("homeDetailController",["CreditService","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","homeDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","GoodsService","$ionicModal","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S,I){var w;s.solutionId=o.solutionId,s.usermes={name:"",mobl:""},s.bacicInfo={},s.designerId=0,s.pid=0,s.cid=0,s.aid=0,s.shareimg="",s.showShare=!1,s.sharedesp="",s.init=function(){s.showQQ=!1,s.showWeChat=!1,s.showShare=!1,window.cordova?s.isApp=!0:s.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){s.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){s.showWeChat=0!=e})),s.$broadcast("scroll.refreshComplete"),s.storeId=p.get("storeId",i.globalConstant.storeId),l.bacicInfo(s.solutionId).success(function(e){s.bacicInfo=e.data,s.shareimg=e.data.imageUrl,s.sharedesp=e.data.name,s.designerId=e.data.designerId})},s.predesgin=function(){w=g.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:s})},s.colsepop=function(){w.close()},s.yuyue=function(){if(0==s.usermes.name.length)m.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test(s.usermes.name))m.showToast("姓名不能包含非法字符");else if(0==s.usermes.mobl.length)m.showToast("请输入手机号");else if(s.globalConstant.mobileNumberRegExp.test(s.usermes.mobl)){switch(s.pid){case 2:s.cityname="北京市";break;case 3:s.cityname="天津市";break;case 10:s.cityname="上海市";break;case 23:s.cityname="重庆市"}l.yuyue(s.cid,s.designerId,2,s.usermes.mobl,s.usermes.name,s.pid,s.aid,s.cityname).success(function(e){e.data&&e.success?(m.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),w.close()):m.showToast(e.message)}).error(function(e){m.showToast("网络错误，检查网络后再试")})}else m.showToast("请输入正确的手机号格式")},s.goshare=function(){if(!n.getUser().mid)return void r.go("login");s.showShare=!s.showShare},s.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),m.showToastShort("复制成功")):m.showToast("请下载APP执行此操作")},s.hideblackCover=function(){s.showShare=!1},s.shareToPlatform=function(t){var o=s.sharedesp,i=s.sharedesp,n=s.shareimg?s.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",r=a.getShareLinkHeader()+"homeDetail/"+s.solutionId;window.umeng?(0==t?window.umeng.shareToSina(o,i,n,r,0,null,e.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,n,r,0,null,e.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,n,r,0,null,e.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,n,r,0,null,e.shareSuccessCallback),e.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,n,r,0,null,e.shareSuccessCallback),e.qqShare()),5==t?s.copeText(r):e.successShare()):alert("umeng undefined 只能在app分享"),s.showShare=!1};var y=window.innerHeight,T=y-373+"px";s.contentHeight={height:T},s.addressTitle="选择地区",s.dataAdd=null,s.flag="PRODUCT_DETAIL_LOCATION",s.defaultValue=null,s.level=0;var C={};s.addressTop=function(){s.addressTipFlag=!1,s.provinceTop=0,s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.addressModal.show(),s.dataAdd=null,s.defaultValue=null,s.selectProvince="",s.selectCity="",s.selectArea="",w.close(),s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},s.addressInit=function(e,t,o,i){if(s.addressTipFlag=!1,v.$getByHandle("mainScroll").scrollTop(),s.addressTitle="选择地区",s.defaultValue=e?JSON.parse(e):{},s.level=i,t){s.dataAdd=JSON.parse(t),s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var a=0;a<s.nowLevelIndex.length;a++)a>s.nowLevel&&(s.nowLevelIndex[a]=-1)}else s.finish=!1,s.dataAdd="",c.get("data/region.json").success(function(e){s.dataAdd=e.data,s.finish=!0,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var t=0;t<s.nowLevelIndex.length;t++)t>s.nowLevel&&(s.nowLevelIndex[t]=-1)}).error(function(e){m.showToast("获取地址信息失败！")})},s.bottomBorder={"border-bottom":"2px solid red"},s.provinceFlag=!1,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.provinceSel=function(){s.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),s.selectCity="",s.selectArea="",s.provinceFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!1,s.areaDis=!1};var b=!1;s.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<s.nowLevelIndex.length;o++)o>s.nowLevel&&(s.nowLevelIndex[o]=-1);s.dataAdd="",s.nowLevelIndex[s.nowLevel]=e;var t=arguments[1],e=arguments[0];if(s.level=s.level-1,s.defaultValue["text"+s.level]=t.text,s.defaultValue["value"+s.level]=t.value,s.level>-2)c.get("data/region.json").success(function(o){-1==s.level?(s.selectProvince=t.text,s.provinceIndex=e,s.dataAdd=o.data[e].children,s.provinceFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.provinceTop=v.$getByHandle("mainScroll").getScrollPosition().top,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel,s.citySel=function(){s.dataAdd="",s.addressInit(i,a,s.flag,-1),s.dataAdd=o.data[e].children,s.selectArea="",s.cityFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,v.$getByHandle("mainScroll").scrollTo(0,s.cityTop)}):s.dataAdd=s.dataAdd[e].children;var i=JSON.stringify(s.defaultValue),a=JSON.stringify(s.dataAdd);s.addressInit(i,a,s.flag,s.level)}).error(function(e){m.showToast("获取地址信息失败！")});else if(s.level>-4)s.selectCity=s.defaultValue["text-2"],s.provinceFlag=!1,s.cityFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,-3==s.level?(s.selectArea=t.text,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0,s.areaTop=v.$getByHandle("mainScroll").getScrollPosition().top):s.cityTop=v.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*s.level,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,$.getLocationList(t.value,ah).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(s.defaultValue),i=JSON.stringify(s.dataAdd);s.addressInit(o,i,s.flag,s.level)}).error(function(e){m.showToast("获取地址信息失败！")}),s.levelArea=s.level,s.levelArea=s.levelArea+1,s.areaSel=function(){s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,s.dataAdd="",s.level=s.levelArea,$.getLocationList(areaValue,2).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1;var t=JSON.stringify(s.defaultValue),o=JSON.stringify(s.dataAdd);s.addressInit(t,o,s.flag,s.level),v.$getByHandle("mainScroll").scrollTo(0,s.areaTop),s.areaFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0}).error(function(e){m.showToast("获取地址信息失败！")})};else{if(b)return;d(function(){b=!1},1500),i.$broadcast(s.flag,s.defaultValue),b=!0,s.closeAddressModal()}},300),s.getPosition=function(){"定位中···"!=i.globalConstant.autoPosition&&(C=S.getAddressInfo(),s.getarr=C.provinceName+C.cityName+C.regionName+C.streetName,s.pid=C.provinceId,s.cid=C.cityId,s.aid=C.areaId,s.cityname=C.cityName,s.addressModal.hide(),s.predesgin())},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:s,animation:"slide-in-up",backdropClickToClose:!1}).then(function(e){s.addressModal=e}),s.closeAddressModal=function(){s.addressModal.hide(),s.defaultValue["text-1"]&&s.defaultValue["text-2"]&&s.defaultValue["text-3"]&&s.defaultValue["text-4"]&&(s.getarr=s.defaultValue["text-1"]+s.defaultValue["text-2"]+s.defaultValue["text-3"]+s.defaultValue["text-4"],s.pid=s.defaultValue["value-1"],s.cid=s.defaultValue["value-2"],s.aid=s.defaultValue["value-3"],s.cityname=s.defaultValue["text-2"]),s.predesgin()},s.$on("$ionicView.beforeEnter",function(e,t){s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceTop=0,s.cityTop=0,s.areaTop=0,s.defaultValue=null,s.dataAdd=null;var o=S.getAddressInfo();s.streetId=o.streetId,s.getarr=o.provinceName+o.cityName+o.regionName+o.streetName,s.pid=o.provinceId,s.cid=o.cityId,s.aid=o.areaId,s.cityname=o.cityName,s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0),s.init()})}]),APP.service("homeDetailService",["$http","UrlService",function(e,t){this.bacicInfo=function(o){var s={id:o};return e.get(t.getNewUrl("HOME_DETAIL"),s)},this.yuyue=function(o,s,i,a,n,r,c,l){var d={channel:1,cityId:o,cityName:l,designerId:s,itemsId:i,mobile:a,name:n,provinceId:r,regionId:c};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:d})}}]),APP.controller("homeMakeController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,homeMakeService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),homeMakeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),homeMakeService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0),void 0===$scope.swpcfurnish1?$timeout(function(){},100):$scope.swpcfurnish1.update()}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last) a").css("color","#000000"),$("div.furnish_xScroll div:eq(0) a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s}),$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if($timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("homeMakeService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("homeMakeActListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeActListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.bottomIF=!1,u.init=function(){u.pageindex=1,r.isWdHost().success(function(e){u.isWdHost=e.data.isHost}),l.getlists(u.pageindex,5).success(function(e){e.data.length<5?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1),u.lists=e.data})},u.loadMore=function(){u.pageindex++,l.getlists(u.pageindex,5).success(function(e){u.lists=u.lists.concat(e.data),0==e.data.length?(u.hasmore=!1,u.bottomIF=!0,u.$broadcast("scroll.infiniteScrollComplete")):(u.hasmore=!0,u.bottomIF=!1,u.$broadcast("scroll.infiniteScrollComplete"))})},u.goBack=ionic.Utils.debounce(function(){e.goBack()},300),u.$on("$ionicView.beforeLeave",function(e,t){}),u.$on("$ionicView.enter",function(e,t){s.scrollTop()}),u.settingsList="",u.$on("$ionicView.beforeEnter",function(e,t){u.storeId=f.getUser().mid,u.init()})}]),APP.service("homeMakeActListService",["$http","UrlService",function(e,t){this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getlists=function(o,s){var i={pageIndex:o,pageSize:s};return e.get(t.getNewUrl("ACT_LIST"),i)}}]),APP.controller("homeMakeListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","homeMakeListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.toNoteDetails=function(e,t,o){m.go("noteDetails",{noteId:e})},u.init=function(){u.pageIndex=1,r.isWdHost().success(function(e){u.isWdHost=e.data.isHost}),0==u.index?l.getTopic(u.index,1,u.pageIndex,6).success(function(e){u.list=e.data.storys,e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)}):l.getTopic(u.index,2,u.pageIndex,6).success(function(e){u.list=e.data.storys,e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)})},u.loadMore=function(){u.pageIndex++,u.index,l.getTopic(u.index,2,u.pageIndex,6).success(function(e){u.list=u.list.concat(e.data.storys),e.data.storys.length<6?(u.hasmore=!1,u.bottomIF=!0):(u.hasmore=!0,u.bottomIF=!1)})},u.goBack=ionic.Utils.debounce(function(){e.goBack()},300),u.$on("$ionicView.beforeLeave",function(e,t){}),u.$on("$ionicView.enter",function(e,t){s.scrollTop()}),u.settingsList="",u.$on("$ionicView.beforeEnter",function(e,t){u.index=g.index,u.hasmore=!1,u.bottomIF=!1,u.storeId=f.getUser().mid,u.init()})}]),APP.service("homeMakeListService",["$http","UrlService",function(e,t){this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)}}]),APP.controller("homeSameController",["$localstorage","$scope","$rootScope","homeSameService","$ionicHistory","$state",function($localstorage,$scope,$rootScope,homeSameService,$ionicHistory,$state,TopicService){function getAddress(){var deferred=$q.defer()
;return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}$scope.locationImgUrl="img/location@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.$on("$ionicView.enter",function(e,t){}),$scope.chooseType=function(e,t){-1!=e&&($scope.ifIndex=e,$("ion-nav-view ion-view").attr("nav-view","cached"),$("div.furnish_xScroll div a").css("color","#000000"),$("div.furnish_xScroll div:eq("+e+") a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.onScroll=function(){var e=$ionicScrollDelegate.getScrollPosition().top,t=Math.round(e/204*100)/100;$scope.$apply(function(){e<10?($scope.changeOpacity={"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0.30), rgba(255,255,255,0.00))"},$scope.changeColor={color:"#ffffff"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.locationImgUrl="img/location@2x.png",$scope.messageImgUrl="img/messageLogo@2x.png"):e<100&&e>=10?($scope.changeOpacity={background:"rgba(255,255,255,"+t+")"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.changeColor={color:"#ffffff"},$scope.locationImgUrl="img/location@2x.png",$scope.messageImgUrl="img/messageLogo@2x.png"):($scope.locationImgUrl="img/location_gray@2x.png",$scope.messageImgUrl="img/message_gray@2x.png",$scope.changeColor={color:"#666666"},$scope.searchBg={background:"#e8e8e8",color:"#ffffff"},$scope.changeOpacity={background:"rgba(255,255,255,"+t+")"})})},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.init=function(){},$scope.$on("$ionicView.beforeEnter",function(){$scope.home="homeSame-smartAppliance",$scope.init()}),$scope.onTabSelected=function(){$rootScope.xiaoxis=!1}}]),APP.service("homeSameService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("houseSolutionDetailController",["$stateParams","$scope","$rootScope","UrlService","UserService","$state","houseSolutionDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","$ionicHistory",function(e,t,o,s,i,a,n,r,c,l,d,p,u){t.allsoluteId=e.solutionId,t.pageIndex=1,t.pageSize=6,t.name="",t.imgUrl=[],t.hasmore=!0,t.frompage=0,t.init=function(){t.frompage=0,u.backView()&&"productDetail"==u.backView().stateName&&(t.frompage=1),t.pageIndex=1,t.pageSize=6,t.listdata=[],n.getPageListDate(t.frompage,t.allsoluteId,t.pageIndex,t.pageSize).success(function(e){e.data.name&&(t.name=e.data.name),e.data.imageUrl&&(t.imgUrl=e.data.imageUrl)}),t.loadmore=function(){n.getPageListDate(t.frompage,t.allsoluteId,t.pageIndex,t.pageSize).success(function(e){0==e.data.details.length?(t.hasmore=!1,t.listdata=t.listdata.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete")):(t.hasmore=!0,t.listdata=t.listdata.concat(e.data.details),t.$broadcast("scroll.infiniteScrollComplete"))}),t.pageIndex++}},t.goBack=function(){u.goBack()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||t.init()}),t.$on("$stateChangeSuccess",function(){t.loadmore()})}]),APP.service("houseSolutionDetailService",["$http","UrlService",function(e,t){this.getPageListDate=function(o,s,i,a){if(1==o){var n={channel:1,productId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("HOUSE_FROM_PRODETAIL"),n)}var n={channel:1,id:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("HOUSE_LISTDETAIL"),n)}}]),APP.controller("itSoluteDetailController",["$q","CreditService","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","itSoluteDetailService","$timeout","$localstorage","$ionicSlideBoxDelegate","$ionicPopup","PopupService","GoodsService","$ionicModal","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService","PersonalCenterService",function($q,CreditService,$cookies,$stateParams,$scope,$rootScope,UrlService,UserService,$state,$http,itSoluteDetailService,$timeout,$localstorage,$ionicSlideBoxDelegate,$ionicPopup,PopupService,GoodsService,$ionicModal,$ionicScrollDelegate,ProductDetailService,CommonAddressService,CartService,PersonalCenterService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}var confirmPopup;$scope.solutionId=$stateParams.solutionId,$scope.soluDetail={},$scope.productIds="",$scope.productList=[],$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,$scope.detailList=[],$scope.obj={},$scope.num=-1,$scope.arr=[],$scope.productListMore=[],$scope.all={isAllChecked:!0},$scope.usermes={name:"",mobl:""},$scope.orderInitParams=null,$scope.pid=0,$scope.cid=0,$scope.aid=0,$scope.shareimg=$rootScope.smartNav?$rootScope.smartNav:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",$scope.showShare=!1,$scope.sharedesp="",$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,$scope.exportDate=[],$scope.recommend=[],$scope.housetopic=[],$scope.housetopictitle="",window.cordova?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),$stateParams.shareId?$scope.storeId=$stateParams.shareId:$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,itSoluteDetailService.soluteDetail($scope.solutionId).success(function(e){$scope.soluDetail=e.data,$scope.sharedesp=e.data.name,$scope.productIds=e.data.productsIds,$scope.obj=e.data.groupProducts;for(var t in $scope.obj)$scope.arr.push($scope.obj[t][0].productId),$scope.detailList.push($scope.obj[t]);itSoluteDetailService.productList($scope.productIds,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productList=e.data;for(var t=0;t<$scope.productList.length;t++)$scope.productTotalprice+=$scope.productList[t].price,$scope.selectcommsion+=$scope.productList[t].commission,$scope.productList[t].checked=!0,$scope.productList[t].isMore=!1,$scope.detailList[t].length>1&&($scope.productList[t].isMore=!0);$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice,$scope.all.isAllChecked=!0})})},$scope.choiceMore=function(e,t){$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.num=e,$scope.StoreMsgModal.show();for(var o="",s=[],i=0;i<$scope.detailList[e].length;i++)s.push($scope.detailList[e][i].productId);o=s.join(","),itSoluteDetailService.productList(o,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productListMore=e.data;for(var o=0;o<$scope.productListMore.length;o++)t==$scope.productListMore[o].id&&($scope.productListMore[o].checked=!0);$scope.selectnumber=$scope.productList.length})},$ionicModal.fromTemplateUrl("templates/common/CommonMoreChoice.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.StoreMsgModal=e}),$scope.closeStoreModal=function(){$scope.StoreMsgModal.hide()},$scope.select=function(e){$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var t=0;t<$scope.productList.length;t++){if(1!=$scope.productList[t].checked){$scope.all.isAllChecked=!1;break}$scope.all.isAllChecked=!0}for(var o=0;o<$scope.productList.length;o++)1==$scope.productList[o].checked&&($scope.selectprice+=$scope.productList[o].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[o].commission)},$scope.choiceSelect=function(e){for(var t="",o=0;o<$scope.productListMore.length;o++)$scope.productListMore[o].checked=!1,e.id==$scope.productListMore[o].id&&($scope.productListMore[o].checked=!0),1==$scope.productListMore[o].checked&&(t=$scope.productListMore[o]);$scope.productList[$scope.num]=t,$scope.productList[$scope.num].isMore=!0,$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var s=0;s<$scope.productList.length;s++)1==$scope.productList[s].checked&&($scope.selectprice+=$scope.productList[s].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[s].commission);$scope.productTotalprice=$scope.selectprice,$scope.StoreMsgModal.hide()},$scope.selectall=function(){if($scope.all.isAllChecked){$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!0,$scope.selectcommsion+=$scope.productList[e].commission}else{$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!1}},$scope.placeorder=function(){if(!UserService.getUser().mid)return void $state.go("login");for(var e=[],t=0;t<$scope.productList.length;t++)$scope.productList[t].checked&&e.push({proId:$scope.productList[t].id,num:1});$scope.orderInitParams={proList:e,street:$scope.streetId},CartService.settlement($scope.orderInitParams).success(function(e,t,o,s){if(0==e.success)PopupService.showToast(e.message);else if(1==e.success&&null!=e.data){var i=new Date;i.setDate(i.getDate()+1),$cookies.put("is_book","",{expires:i,path:"/"}),$state.go("orderConfirm",{orderInitParams:JSON.stringify($scope.orderInitParams)})}else PopupService.showToast("结算失败")})},$scope.predesgin=function(){confirmPopup=$ionicPopup.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:$scope})},$scope.colsepop=function(){confirmPopup.close()},$scope.yuyue=function(){if(0==$scope.usermes.name.length)PopupService.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test($scope.usermes.name))PopupService.showToast("姓名不能包含非法字符");else if(0==$scope.usermes.mobl.length)PopupService.showToast("请输入手机号");else if($scope.globalConstant.mobileNumberRegExp.test($scope.usermes.mobl)){switch($scope.pid){case 2:$scope.cityname="北京市";break;case 3:$scope.cityname="天津市";break;case 10:$scope.cityname="上海市";break;case 23:$scope.cityname="重庆市"}itSoluteDetailService.yuyue($scope.cid,$scope.solutionId,1,$scope.usermes.mobl,$scope.usermes.name,$scope.pid,$scope.aid,$scope.cityname).success(function(e){e.data?(PopupService.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),confirmPopup.close()):PopupService.showToast(e.message)}).error(function(e){PopupService.showToast("网络错误，检查网络后再试")})}else PopupService.showToast("请输入正确的手机号格式")},$scope.goshare=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.sharedesp,o=$scope.soluDetail.introduction,s=$scope.shareimg?$scope.shareimg:"http://cdn09.ehaier.com/shunguang/H5/www/img/share_default.png",i=UrlService.getShareLinkHeader()+"itSoluteDetail/"+$scope.solutionId;window.umeng?(0==e?window.umeng.shareToSina(t,o,s,i,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,s,i,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,s,i,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,s,i,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(i):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1};var screenHeight=window.innerHeight,topHeight=373,topDis=87,contentHeight=screenHeight-topHeight+"px",hig=screenHeight-313+"px",topDisHeight=topDis+"px";$scope.contentHeight={height:contentHeight},$scope.hig={height:hig},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="PRODUCT_DETAIL_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={};$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,ProductDetailService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,ProductDetailService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){"定位中···"!=$rootScope.globalConstant.autoPosition&&(addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName,$scope.addressModal.hide(),$scope.predesgin())},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!1}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.predesgin()},$scope.goProductDetail=function(){$scope.StoreMsgModal.hide()},$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction);else{$scope.detailList=[],$scope.obj={},$scope.num=-1,$scope.arr=[],$scope.productListMore=[],$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.defaultValue=null,$scope.dataAdd=null,$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;var o=CommonAddressService.getAddressInfo();$scope.getarr=o.provinceName+o.cityName+o.regionName+o.streetName,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.cityname=o.cityName,$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0),$scope.init()}})}]),APP.service("itSoluteDetailService",["$http","UrlService",function(e,t){this.soluteDetail=function(o){var s={id:o};return e.get(t.getNewUrl("ITSOLU_DETAIL"),s)},this.productList=function(o,s,i,a,n,r){var c={productsIds:o,streetId:s,storeId:i,cityId:a,provinceId:n,regionId:r};return e.get(t.getNewUrl("ITSOLU_PRODUCTLIST"),c)},this.yuyue=function(o,s,i,a,n,r,c,l){var d={channel:1,cityId:o,cityName:l,detailsId:Number(s),itemsId:i,mobile:a,name:n,provinceId:r,regionId:c};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:d})}}]),APP.controller("lifeController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","lifeService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,lifeService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(){getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId})}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),getFurnishAllData(),lifeService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0)}),lifeService.gethomeMessage().success(function(e){}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.enter",function(e,t){"back"!=$scope.direction&&$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("lifeService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))},this.gethomeMessage=function(){return e.get(t.getNewUrl("LIFE_SERVICES"))}}]),APP.controller("newHomeController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeService","ProductDetailService","newHomeMakeService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeService,ProductDetailService,newHomeMakeService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}$rootScope.scrollNum="";var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.isAdress=!1,$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel
;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.gotoFullhouseSolution=function(e){$state.go("fullHouseSolution",{soluteId:e})},$scope.loadMore=function(){$scope.pageindex1++,newHomeMakeService.getTopic(1,1,$scope.pageindex1,6).success(function(e){$scope.smartLife.storys=$scope.smartLife.storys.concat(e.data.storys),e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)})},$scope.init=function(){function e(e){$scope.lons=e.position.getLng(),$scope.lat=e.position.getLat(),$scope.cityIds=CommonAddressService.getAddressInfo().cityId+"",newHomeService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)})}function t(e){$scope.cityIds=173,newHomeService.getRecently($scope.cityIds,1,36.108883,120.457091,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)})}newHomeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.programtitle=e.data.program.title,$scope.recommend=e.data.recommend.recommends,$scope.recommendtitle=e.data.recommend.title,$scope.recommendId=e.data.recommend.id,$scope.scenes=e.data.scenes,$timeout(function(){new Swiper(".swiper-container",{pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return 0==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[0].name+"</i></span>":1==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[1].name+"</i></span>":2==e?'<span class="'+t+' loopNav"><i>'+$scope.scenes[2].name+"</i></span>":3==e?'<span class="'+t+' loopNav lastNav"><i>'+$scope.scenes[3].name+"</i></span>":void 0}}}).update()},100)}),newHomeMakeService.getTopic(0,1,1,2).success(function(e){$scope.videoFeel=e.data}),$scope.pageindex1=1,newHomeMakeService.getTopic(1,1,$scope.pageindex1,6).success(function(e){$scope.smartLife=e.data,e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)})}),new AMap.Map("").plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation;o.getCurrentPosition(),AMap.event.addListener(o,"complete",e),AMap.event.addListener(o,"error",t)})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.active=function(){$scope.isActive=!1;nomess=void 0},$scope.noMessage=function(){$scope.isNoMessage=!1},$scope.goHD=function(e,t){"1"==e?""==t.storeId?$state.go("productDetail",{fromType:t.fromType,fromUrl:t.fromUrl,o2oType:t.o2oType,productId:t.productId,storeId:$scope.storeId}):$state.go("productDetail",{fromType:t.fromType,fromUrl:t.fromUrl,o2oType:t.o2oType,productId:t.productId,storeId:t.storeId}):"2"==e?t.id?$state.go("couponsDetail",{cId:t.id,userID:$scope.storeId,type:2}):$state.go("getCouponsList"):"3"==e?$state.go("game",{gameId:t.gameId}):"4"==e?"日常活动"==t.activityType?BannerThemeService.getBannerTheme(t.bannerId).success(function(e){$state.go("bannerDaily",{bannerId:t.bannerId,layout:e.data.layout})}):"主题活动"==t.activityType&&$state.go("bannerTheme",{bannerId:t.bannerId}):"5"==e&&$state.go("customizehd",{url:t.url})},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHome"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$scope.toNoteDetails=function(e,t,o){$state.go("noteDetails",{noteId:e})},$scope.meitu=function(e){$state.go("homeMakeList",{index:e})};var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!1,$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1},1e3):(setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)},this.getRecently=function(o,s,i,a,n){var r={cityId:o,itemsId:s,latitude:i,longitude:a,type:n};return e.get(t.getNewUrl("RECENTLY_WORK"),r)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeLifeController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeLifeService","ProductDetailService","HomePageService","WhiteShowsService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeLifeService,ProductDetailService,HomePageService,WhiteShowsService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeLifeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,newHomeLifeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),newHomeLifeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeLifeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,
newHomeLifeService.getLifeDetail($scope.streetId,$scope.areaId,$scope.provinceId,$scope.cityId).success(function(e){for(var t=0;t<e.data.length;t++)0==e.data[t].id?$scope.relaxList=e.data[t].products:1==e.data[t].id&&($scope.onlyList=e.data[t].products)}),newHomeLifeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeLife"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goBranchType=function(){$state.go("branchTypeDetail",{productCateId:"productCateId=3315"})},$scope.goToApplyForCard=function(){newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):$state.go("applyForCard")})},$scope.goToLiving=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isWhatApp="ios":-1!=ionic.Platform.platform().indexOf("android")&&window.cordova?$scope.isWhatApp="android":$scope.isWhatApp="H5",GoodsService.getAddress().success(function(res){if(null==res.data)$scope.value="173";else{var data=eval(res.data)[0];$scope.value=data.cityId}HomePageService.isWdHost().success(function(e){if($rootScope.isWdHost=e.data.isHost,-1==e.data.isHost)$state.go("login");else{var t=UrlService.getLiveingUrl(),o=t+"?flag="+$localstorage.get("sg_login_token_secret")+"&systemType="+$scope.isWhatApp+"&cityId="+$scope.value;window.cordova?window.emc.presentH5View(o,"生活缴费"):window.location.href=o}})})},$scope.toApplyForWhite=function(){if(!UserService.getUser().accessToken)return void PopupService.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&$state.go("login")})),100==e.errorCode&&$state.go("login")})},$scope.goToEmc=function(){$scope.isApp?HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):HomePageService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()});var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeLifeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:6})},this.getTopic=function(){return e.get(t.getNewUrl("NEW_HOME_TOPIC"))},this.getLifeDetail=function(o,s,i,a){var n={streetId:o,regionId:s,provinceId:i,cityId:a};return e.get(t.getNewUrl("LIFE_SERVICES"),n)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeMakeController",["$ionicPlatform","$ionicPopup","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeMakeService","ProductDetailService","WhiteShowsService",function($ionicPlatform,$ionicPopup,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeMakeService,ProductDetailService,WhiteShowsService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeMakeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName;var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1;$scope.usermes={name:"",mobl:""};var locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeMakeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.isOrder&&$scope.predesgin()},$scope.toApplyForWhite=function(){if(!UserService.getUser().accessToken)return void PopupService.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");WhiteShowsService.queryIousStatus({userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?$state.go("applyForWhite"):WhiteShowsService.applyForOpen({backUrl:window.location.href,userId:UserService.getUser().ucId,token:UserService.getUser().accessToken}).success(function(e){e.success&&WhiteShowsService.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&$state.go("login")})),100==e.errorCode&&$state.go("login")})},$scope.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),t=null;t=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),t.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&$timeout(function(){t.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),t.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&t.close()})}else $scope.kfTocken=$localstorage.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$scope.kfTocken);return},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.isOrder&&confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.predesgin=function(){$scope.isOrder=!0,confirmPopup=$ionicPopup.show({cssClass:"xvv-predesgin",template:'<div class="preexdes"><div>预约免费设计<img src="{{imgBaseURL}}img/linshi/xxx@2x.png" ng-click="colsepop()"/></div><div>您的姓名<input type="text" maxlength="10" placeholder="请输入您的姓名" ng-model="usermes.name"/></div><div>手机号码<input type="text" placeholder="请输入手机号码" maxlength="11" ng-model="usermes.mobl"/></div><div ng-click="addressTop()"><img src="{{imgBaseURL}}img/linshi/position@2x.png"/><span>{{getarr}}</span><img src="{{imgBaseURL}}img/linshi/morez@2x.png"/></div><div ng-click="yuyue()">立即预约</div></div>',scope:$scope})},$scope.colsepop=function(){confirmPopup.close()},$scope.yuyue=function(){if(0==$scope.usermes.name.length)PopupService.showToast("请输入您的姓名");else if(/[@#\$%\^&\*]+/g.test($scope.usermes.name))PopupService.showToast("姓名不能包含非法字符");else if(0==$scope.usermes.mobl.length)PopupService.showToast("请输入手机号");else if($scope.globalConstant.mobileNumberRegExp.test($scope.usermes.mobl)){switch($scope.pid){case 2:$scope.cityname="北京市";break;case 3:$scope.cityname="天津市";break;case 10:$scope.cityname="上海市";break;case 23:$scope.cityname="重庆市"}newHomeMakeService.yuyue($scope.cid,$scope.cityname,"","",2,$scope.usermes.mobl,$scope.usermes.name,$scope.pid,$scope.aid).success(function(e){e.data&&e.success?(PopupService.showToast('<div style="height:40px;line-height:40px;">恭喜，预约成功</div>'),confirmPopup.close()):PopupService.showToast(e.message)}).error(function(e){PopupService.showToast("网络错误，检查网络后再试")})}else PopupService.showToast("请输入正确的手机号格式")},$scope.loadMore=function(){$scope.pageIndex1++,newHomeMakeService.getTopic(5,2,$scope.pageIndex1,6).success(function(e){$scope.feelLike=$scope.feelLike.concat(e.data.storys),e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)})},$scope.init=function(){$scope.isOrder=!1,newHomeMakeService.getSmartHome().success(function(e){$scope.recommend=e.data.recommend.recommends}),newHomeMakeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.pageIndex1=1,newHomeMakeService.getTopic(5,2,$scope.pageIndex1,6).success(function(e){$scope.feelLike=e.data.storys,e.data.storys.length<6?($scope.hasmore=!1,$scope.bottomIF=!0):($scope.hasmore=!0,$scope.bottomIF=!1)}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeMakeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeMakeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales()})},$scope.gotoactList=function(){$state.go("homeMakeActList")},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{
storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeMake"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()}),$scope.meitu=function(e){$state.go("homeMakeList",{index:e})};var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!1,$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeMakeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("HOME_MAKE"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:2})},this.getTopic=function(o,s,i,a){var n={group:o,itemsId:s,pageIndex:i,pageSize:a};return e.get(t.getNewUrl("NEW_HOME_TOPIC"),n)},this.yuyue=function(o,s,i,a,n,r,c,l,d){var p={channel:1,cityId:o,cityName:s,designerId:i,detailsId:a,itemsId:n,mobile:r,name:c,provinceId:l,regionId:d};return e({method:"POST",url:t.getNewUrl("HOUSE_YUYUE"),params:p})},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newHomeOrderController",["$ionicPlatform","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeLifeService","ProductDetailService",function($ionicPlatform,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeLifeService,ProductDetailService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),s=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:s}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),newHomeLifeService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.urls="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+$localstorage.get("sg_login_token_secret").substring(6),$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.isActive=!1,$scope.newImg="",$scope.type="",$scope.urlHD="",$scope.isNoMessage=!1,$scope.noMessageImg="",$scope.mtype="",$scope.urlNM="",$scope.oldImgIcon={jydq:"img/jydq@2x.png",jjjz:"img/Fitting@2x.png",bhcs:"img/market@2x.png",xpzc:"img/new@2x.png",wddp:"img/openStore@2x.png",jrlc:"img/jrlc@2x.png",shfw:"img/icon_specialty.png",gd:"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):newHomeLifeService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$(".orderContent").html('<iframe style="width:100%;height:100%;" src='+$scope.urls+"></iframe>"),newHomeLifeService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),newHomeLifeService.getbanner().success(function(e){$scope.banner=e.data}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeLifeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeLifeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeLifeService.getLifeDetail($scope.streetId,$scope.areaId,$scope.provinceId,$scope.cityId).success(function(e){for(var t=0;t<e.data.length;t++)0==e.data[t].id?$scope.relaxList=e.data[t].products:1==e.data[t].id&&($scope.onlyList=e.data[t].products)}),newHomeLifeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.traceId).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"newHomeOrder"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()});var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.urls="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+$localstorage.get("sg_login_token_secret").substring(6),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newHomeLifeService",["$http","UrlService",function(e,t){this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:6})},this.getTopic=function(){return e.get(t.getNewUrl("NEW_HOME_TOPIC"))},this.getLifeDetail=function(o,s,i,a){var n={streetId:o,regionId:s,provinceId:i,cityId:a};return e.get(t.getNewUrl("LIFE_SERVICES"),n)},this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,street:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),n)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,s,i,a){var n={provinceId:o,cityId:s,districtId:i,streetId:a};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),n)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,s,i,a,n,r,c,l,d){var p={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),p)},this.doInitFaxian=function(o,s,i,a,n,r,c){var l={d:o,provinceId:s,cityId:i,districtId:a,streetId:n,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var s={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),s)},this.changeChooseStateJia=function(o,s){var i={productId:o,onShelf:s};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),i)},this.changeChooseStateDui=function(o){var s={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),s)},this.loadMoreProducts=function(o,s,i,a,n,r,c,l,d,p,u,g){var m={pholder:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:p,fromType:u,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,s,i,a,n){var r={provinceId:o,cityId:s,areaId:i,regionName:a,streetId:n,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,s,i,a,n){var r={provinceName:o,cityName:s,regionName:i,streetName:a,gbCode:n,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var s={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),s)},this.getSelectionProducts=function(o,s,i,a,n,r,c,l,d,p,u){var g={memberId:o,provinceId:s,cityId:i,districtId:a,streetId:n,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:p,flag:"",productCateId:"",noLoading:u};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,s){var i={parentId:o,regionType:s};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),i)},this.asyncPrice=function(o){o.noLoading=!0;var s={traceId:o};return e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),params:s})}}]),APP.service("NewPersonService",["$http","UrlService",function(e,t){this.getImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_NEW_PERSON"),o)}}]),APP.controller("newTestingStoreController",["$ionicPlatform","$ionicPopup","$ionicHistory","CLASSIFYMESSAGECRNTERService","UrlService","NewPersonService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","newHomeMakeService","ProductDetailService","WhiteShowsService","newTestingStoreService",function($ionicPlatform,$ionicPopup,$ionicHistory,CLASSIFYMESSAGECRNTERService,UrlService,NewPersonService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,newHomeMakeService,ProductDetailService,WhiteShowsService,newTestingStoreService){function getAddress(){addressMessage=CommonAddressService.getAddressInfo(),$scope.getarr=addressMessage.provinceName+addressMessage.cityName+addressMessage.regionName+addressMessage.streetName,$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.cityname=addressMessage.cityName;var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.banner=[],$scope.types=[],$scope.nearByList=[];var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},
$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide(),$scope.defaultValue["text-1"]&&$scope.defaultValue["text-2"]&&$scope.defaultValue["text-3"]&&$scope.defaultValue["text-4"]&&($scope.getarr=$scope.defaultValue["text-1"]+$scope.defaultValue["text-2"]+$scope.defaultValue["text-3"]+$scope.defaultValue["text-4"],$scope.pid=$scope.defaultValue["value-1"],$scope.cid=$scope.defaultValue["value-2"],$scope.aid=$scope.defaultValue["value-3"],$scope.cityname=$scope.defaultValue["text-2"]),$scope.isOrder&&$scope.predesgin()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.isOrder&&confirmPopup.close(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){function e(e){$scope.lons=e.position.getLng(),$scope.lat=e.position.getLat(),$scope.cityIds=CommonAddressService.getAddressInfo().cityId+"",newTestingStoreService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)}),newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data)):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data)))})}function t(e){$scope.lons=120.45709,$scope.lat=36.108883,$scope.cityIds=173,newTestingStoreService.getRecently($scope.cityIds,1,$scope.lat,$scope.lons,1).success(function(e){e.success&&e.data&&($scope.isAdress=!0,$scope.recently=e.data)}),newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data)):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data)))})}$scope.defaultValue=null,$scope.dataAdd=null,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeMakeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeMakeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId}),newTestingStoreService.getbanner().success(function(e){$scope.banner=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("test_slide_box").loop(!0)}),newTestingStoreService.getNearbyType().success(function(e){$scope.types=e.data}),new AMap.Map("").plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation;o.getCurrentPosition(),AMap.event.addListener(o,"complete",e),AMap.event.addListener(o,"error",t)}),$scope.loadmore=function(){$scope.pageIndex++,newTestingStoreService.getNearbyList($scope.cityIds,1,$scope.lat,$scope.lons,$scope.pageIndex,6,1).success(function(e){e.data&&(0==e.data.length?($scope.hasmore=!1,$scope.nearByList=$scope.nearByList.concat(e.data),$scope.$broadcast("scroll.infiniteScrollComplete")):($scope.hasmore=!0,$scope.nearByList=$scope.nearByList.concat(e.data),$scope.$broadcast("scroll.infiniteScrollComplete")))})}},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(parseInt(e)){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case 2:if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case 4:"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.settingsList="";var nomess;$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.hasmore=!0,$scope.pageIndex=1,$scope.nearByList=[],$scope.bottomIF=!1,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction||(GetSwitchChecked(),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.init())}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)})}]),APP.service("newTestingStoreService",["$http","UrlService",function(e,t){this.getbanner=function(){return e.get(t.getNewUrl("NEW_HOME_BANNER"),{itemsId:7})},this.getNearbyType=function(){return e.get(t.getNewUrl("NEARBY_TYPES"))},this.getRecently=function(o,s,i,a,n){var r={cityId:o,itemsId:s,latitude:i,longitude:a,type:n};return e.get(t.getNewUrl("RECENTLY_WORK"),r)},this.getNearbyList=function(o,s,i,a,n,r,c){var l={cityId:o,itemsId:s,latitude:i,longitude:a,pageIndex:n,pageSize:r,type:c};return e.get(t.getNewUrl("NEARBY_LIST"),l)}}]),APP.controller("newHomesendCtrl",["$stateParams","$scope","$ionicModal","$q","newHomeService","ProductDetailService","GoodsSearchService","ShopService","$http","CalculateStrLength","GoodsService","CLASSIFYMESSAGECRNTERService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService","CommonAddressService",function($stateParams,$scope,$ionicModal,$q,newHomeService,ProductDetailService,GoodsSearchService,ShopService,$http,CalculateStrLength,GoodsService,CLASSIFYMESSAGECRNTERService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService,CommonAddressService){function add(e,t){var o=new Date,s=t,i=o.getTime(),a=$interval(function(){i+=1e3;var e=parseInt((s-i)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),r=e-24*t*60*60-60*n*60,c=parseInt(r/60),l=e-24*t*60*60-60*n*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(n)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(a))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="";var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseType=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))}),$scope.defaultValue=null,$scope.dataAdd=null,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress()}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var i=t.slice(t.lastIndexOf("=")+1),a=/\=(.*?)\&/g,n=t.match(a),r=[],c=0;c<n.length;c++)r.push(n[c].substring(1,n[c].length-1));$state.go("productDetail",{fromType:i,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var p=t.slice(t.indexOf("#/"));window.location.hash=p}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.$on("$ionicView.enter",function(e,t){$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,s,i,a,n){var r={provinceId:o,cityId:s,districtId:i,streetId:a,pageIndex:n};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var s={from:o};return e.get(t.getZCUrl("SUC_ZHONGCHOU"),s)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("smartApplianceController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","smartApplianceService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,smartApplianceService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$ionicScrollDelegate.scrollTop(),smartApplianceService.getSmartHome().success(function(e){$scope.programNav=e.data.program.programs,$scope.recommend=e.data.recommend.recommends}),smartApplianceService.getBanner().success(function(e){$scope.bannerList=e.data,
$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0),void 0===$scope.swpcfurnish1?$timeout(function(){new Swiper(".swiper-container",{pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return 0==e?'<span class="'+t+' loopNav"><i>智慧客厅</i></span>':1==e?'<span class="'+t+' loopNav"><i>智慧厨房</i></span>':2==e?'<span class="'+t+' loopNav"><i>智慧浴室</i></span>':3==e?'<span class="'+t+' loopNav lastNav"><i>智慧卧室</i></span>':void 0}}})},100):$scope.swpcfurnish1.update()}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){var o=$("div.furnish_xScroll div").eq(0).width(),s=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last) a").css("color","#000000"),$("div.furnish_xScroll div:eq(0) a").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:s}),$ionicScrollDelegate.scrollTop()}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if($timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("smartApplianceService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getSmartHome=function(){return e.get(t.getNewUrl("SMART_HOME"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("NewsuperMarketController",["ProductDetailService","newHomeService","GoodsSearchService","$localstorage","$ionicModal","$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function(ProductDetailService,newHomeService,GoodsSearchService,$localstorage,$ionicModal,$ionicHistory,BannerThemeService,CLASSIFYMESSAGECRNTERService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),s=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),s&&!isEmptyObject(s)&&($scope.data=s)}function isEmptyObject(e){for(var t in e)return!1;return!0}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/newvision/location.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/newvision/xiaoxi.png",$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css({color:"#000000","border-left":"0px solid #eee","border-right":"0px solid #eee","border-bottom":"1px solid #EEEEEE"}),$("div.superMarket_xScroll div:eq("+e+")").css({color:"#FF6026","border-left":"1px solid #eee","border-right":"1px solid #eee","border-bottom":"0px solid #eee"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var s=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var i=s[0].slice(s[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:i,storeId:$scope.storeId});break;case"2":if(t){var a=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:a,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var n=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:n});break;case"4":"日常活动"==s[0].slice(s[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(s[1].slice(s[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:s[1].slice(s[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==s[0].slice(s[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:s[1].slice(s[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:s[0].slice(s[0].indexOf("=")+1),isShortStory:s[1].slice(s[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,s){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=s,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var i=0;i<$scope.nowLevelIndex.length;i++)i>$scope.nowLevel&&($scope.nowLevelIndex[i]=-1)}else $scope.finish=!1,$scope.dataAdd="",$http.get("data/region.json").success(function(e){$scope.dataAdd=e.data,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=0;t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)$http.get("data/region.json").success(function(o){locationFlag=!0,-1==$scope.level?($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.dataAdd=o.data[e].children,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel,$scope.citySel=function(){$scope.dataAdd="",$scope.addressInit(s,i,$scope.flag,-1),$scope.dataAdd=o.data[e].children,locationFlag=!0,$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}):$scope.dataAdd=$scope.dataAdd[e].children;var s=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(s,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0});else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),s=JSON.stringify($scope.dataAdd);$scope.addressInit(o,s,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,s){e.success,$scope.init()})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.chooseTypes=function(e,t){-1!=e&&($rootScope.scrollNum=$('ion-view[nav-view="active"] .newHomeScroll .scroll').css("transform"),0==e?$state.go("newHome"):1==e?$state.go("newHomeMake"):2==e?$state.go("newHomeOrder"):3==e?$state.go("newHomeSend"):4==e?$state.go("newsuperMarket"):5==e?$state.go("newHomeLife"):6==e&&$state.go("newTestingStore"))},$scope.init=function(){$scope.navImg=[$rootScope.imgBaseURL+"img/supermarket/super1.png",$rootScope.imgBaseURL+"img/supermarket/super2.png",$rootScope.imgBaseURL+"img/supermarket/super3.png",$rootScope.imgBaseURL+"img/supermarket/super4.png",$rootScope.imgBaseURL+"img/supermarket/super5.png",$rootScope.imgBaseURL+"img/supermarket/super6.png",$rootScope.imgBaseURL+"img/supermarket/super7.png",$rootScope.imgBaseURL+"img/supermarket/super8.png",$rootScope.imgBaseURL+"img/supermarket/super9.png",$rootScope.imgBaseURL+"img/supermarket/super10.png",$rootScope.imgBaseURL+"img/supermarket/super11.png",$rootScope.imgBaseURL+"img/supermarket/super12.png",$rootScope.imgBaseURL+"img/supermarket/super13.png",$rootScope.imgBaseURL+"img/supermarket/super14.png",$rootScope.imgBaseURL+"img/supermarket/super15.png"],$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="newHome",GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),newHomeService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:($scope.flagNum=!1,window.xneng&&window.xneng.NtalkerMessageList(function(e){if(0==e);else for(var t=0;t<e.length;t++)if(0!=e[t].unreadMsgNum){$scope.flagNum=!0;break}},function(e){alert(e)}))}))}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),newHomeService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,newHomeService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)})})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();$("div.superMarket_xScroll div").eq(0).width(),$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css({color:"#000000","border-left":"0px solid #eee","border-right":"0px solid #eee","border-bottom":"1px solid #EEEEEE"}),$("div.superMarket_xScroll div:eq(0)").css({color:"#FF6026","border-left":"1px solid #eee","border-right":"1px solid #eee","border-bottom":"0px solid #eee"}),$(".newHomeScroll .scroll").css("transform",$rootScope.scrollNum)}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:($scope.flagNum=!1,CLASSIFYMESSAGECRNTERService.getMessageList().success(function(e){e.data?$scope.flagNum=!0:$scope.flagNum=!1}))});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,s,i,a,n){var r={parentCateId:o,provinceId:s,cityId:i,districtId:a,streetId:n};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),APP.controller("testingStoreListController",["$ionicHistory","BannerThemeService","CLASSIFYMESSAGECRNTERService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","HomePageService","CalculateStrLength","homeMakeActListService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","newTestingStoreService","CommonAddressService","testingStoreListService",function(e,t,o,s,i,a,n,r,c,l,d,p,u,g,m,f,h,v,$,S){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"105px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"89px"}),p.storetype=function(e){s.scrollTop(),p.nearbyType=e,p.pageIndex=1,p.nolist=!1,S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,p.lat,p.lons,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)})},p.init=function(){p.pageIndex=1,v.getNearbyType().success(function(e){p.types=e.data}),p.lons=h.globalConstant.lon,p.lat=h.globalConstant.lat,h.globalConstant.positionStatus?(p.cityIds=$.getAddressInfo().cityId+"",S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,p.lat,p.lons,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)})):(p.cityIds=173,S.getNearbyList(p.cityIds,1,36.108883,120.45709,p.pageIndex,5,1,p.nearbyType).success(function(e){e.success&&e.data&&(e.data.length<=1&&(p.nolist=!0),e.data.length<5?p.hasmore=!1:p.hasmore=!0,p.lists=e.data)}),S.getRecently(p.cityIds,1,36.108883,120.457091,1,p.nearbyType).success(function(e){e.success&&e.data&&(p.isAdress=!0,p.recently=e.data)}))},p.loadmore=function(){p.pageIndex++,S.getNearbyList(p.cityIds,1,p.lat,p.lons,p.pageIndex,5,1,p.nearbyType).success(function(e){p.lists=p.lists.concat(e.data),0==e.data.length?(p.hasmore=!1,p.$broadcast("scroll.infiniteScrollComplete")):(p.hasmore=!0,p.$broadcast("scroll.infiniteScrollComplete"))})},p.goBack=ionic.Utils.debounce(function(){e.goBack()},300),p.$on("$ionicView.beforeLeave",function(e,t){}),p.settingsList="",p.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction||(p.types=[],p.nolist=!1,p.nearbyType=u.nearbyType,p.storeId=m.getUser().mid,p.init())})}]),APP.service("testingStoreListService",["$http","UrlService",function(e,t){this.getRecently=function(o,s,i,a,n,r){var c={cityId:o,itemsId:s,latitude:i,longitude:a,type:n,nearbyType:r};return e.get(t.getNewUrl("RECENTLY_WORK"),c)},this.getNearbyList=function(o,s,i,a,n,r,c,l){var d={cityId:o,itemsId:s,latitude:i,longitude:a,pageIndex:n,pageSize:r,type:c,nearbyType:l};return e.get(t.getNewUrl("NEARBY_LIST"),d)}}]),APP.controller("zhcjController",["$q","$cookies","$stateParams","$scope","$rootScope","UrlService","UserService","$state","$http","zhcjService","$timeout","$localstorage","PopupService","GoodsService","$ionicScrollDelegate","ProductDetailService","CommonAddressService","CartService","$ionicHistory","PersonalCenterService",function($q,$cookies,$stateParams,$scope,$rootScope,UrlService,UserService,$state,$http,zhcjService,$timeout,$localstorage,PopupService,GoodsService,$ionicScrollDelegate,ProductDetailService,CommonAddressService,CartService,$ionicHistory,PersonalCenterService){function getdatas(e){zhcjService.soluteproduct(e).success(function(e){$scope.tablabels=e.data.labels,$scope.productIds=e.data.productsIds,zhcjService.productList($scope.productIds,$scope.streetId,$scope.storeId,$scope.cid,$scope.pid,$scope.aid).success(function(e){$scope.productList=e.data;for(var t=0;t<$scope.productList.length;t++)$scope.productTotalprice+=$scope.productList[t].price,$scope.selectcommsion+=$scope.productList[t].commission,$scope.productList[t].checked=!0;$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice,$scope.all.isAllChecked=!0})})}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.pid=addressMessage.provinceId,$scope.cid=addressMessage.cityId,$scope.aid=addressMessage.areaId,$scope.streetId=addressMessage.streetId,deferred.resolve(addressMessage);else{var obj={provinceId:"16",cityId:"173",areaId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}var confirmPopup;$scope.solutionId=$stateParams.solutionId,$scope.soluDetail={},$scope.productIds="",$scope.productList=[],$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,$scope.index=0,$scope.showfiltermodel=!1,$scope.showzhezhao=!1,$scope.showcjjsmodel=!1,$scope.showprodetailmodel=!1,$scope.prointion={},$scope.printstyle={},$scope.all={isAllChecked:!0},$scope.orderInitParams=null,$scope.pid=0,$scope.cid=0,$scope.aid=0,$scope.goback=function(){$state.go("newHome")},$scope.openFilterModal=function(){if($scope.showfiltermodel=!0,$scope.showzhezhao=!0,-1!=ionic.Platform.platform().indexOf("ios")){$scope.prostyle={overflow:"hidden"};var e,t=0;$("#zijihuadong_"+$scope.solutionId).on("touchmove",function(o){var s=o.changedTouches[0].pageX;e>s&&(t>=0||(t+=10,$("#wohuadong_"+$scope.solutionId).css("top",t+"px"))),e<s&&(-t>=$("#wohuadong_"+$scope.solutionId).width()-$("#zijihuadong_"+$scope.solutionId).width()||(t-=10,$("#wohuadong_"+$scope.solutionId).css("top",t+"px"))),e=o.changedTouches[0].pageX})}else $scope.prostyle={overflow:"auto"}},$scope.openjieshaoModal=function(){$scope.showzhezhao=!0,$scope.showcjjsmodel=!0},$scope.openpromodel=function(e){$scope.showzhezhao=!0,$scope.showprodetailmodel=!0;for(var t=0;t<$scope.productList.length;t++)$scope.productList[t].id==e&&($scope.prointion=$scope.productList[t])},$scope.closezhezhao=function(){$scope.showzhezhao=!1,1==$scope.showfiltermodel&&($scope.showfiltermodel=!1),1==$scope.showcjjsmodel&&($scope.showcjjsmodel=!1),1==$scope.showprodetailmodel&&($scope.showprodetailmodel=!1)},$scope.init=function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;$scope.clientHeight=e,$scope.clientWidth=t,$scope.printstyle={height:e+"px",width:t+"px",top:(t-e)/2+"px",left:0-(t-e)/2+"px",transform:"rotate(90deg)","transform-origin":"50% 50%"};var o="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(o,function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;e>t?($scope.clientHeight=t,$scope.clientWidth=e,$scope.printstyle={height:t+"px",width:e+"px",top:0,left:0,transform:"none","transform-origin":"50% 50%"}):($scope.clientHeight=e,$scope.clientWidth=t,$scope.printstyle={height:e+"px",width:t+"px",top:(t-e)/2+"px",left:0-(t-e)/2+"px",transform:"rotate(90deg)","transform-origin":"50% 50%"})},!1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),20219251!=$scope.storeId&&""!=$scope.storeId?$scope.isLogin=!0:$scope.isLogin=!1,$scope.index=0,$scope.showfiltermodel=!1,$scope.showzhezhao=!1,$scope.showcjjsmodel=!1,$scope.showprodetailmodel=!1,$scope.zhimgUrl="",$scope.zhintroduction="",zhcjService.soluteDetail($scope.solutionId).success(function(e){e.success&&e.data&&($scope.soluDetail=e.data[0].spaces,$scope.zhimgUrl=$scope.soluDetail[0].imageUrl,$scope.zhintroduction=$scope.soluDetail[0].introduction,getdatas($scope.soluDetail[0].id))})},$scope.chooseTab=function(e,t){$scope.index=e,$scope.zhimgUrl=t.imageUrl,$scope.zhintroduction=t.introduction,$scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getdatas(t.id)},$scope.select=function(e){$scope.selectprice=0,$scope.selectnumber=0,$scope.selectcommsion=0;for(var t=0;t<$scope.productList.length;t++){if(1!=$scope.productList[t].checked){$scope.all.isAllChecked=!1;break}$scope.all.isAllChecked=!0}for(var o=0;o<$scope.productList.length;o++)1==$scope.productList[o].checked&&($scope.selectprice+=$scope.productList[o].price,$scope.selectnumber++,$scope.selectcommsion+=$scope.productList[o].commission)},$scope.selectall=function(){if($scope.all.isAllChecked){$scope.selectnumber=$scope.productList.length,$scope.selectprice=$scope.productTotalprice;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!0,$scope.selectcommsion+=$scope.productList[e].commission}else{$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0;for(var e=0;e<$scope.productList.length;e++)$scope.productList[e].checked=!1}},$scope.placeorder=function(){if(!UserService.getUser().mid)return void $state.go("login");for(var e=[],t=0;t<$scope.productList.length;t++)$scope.productList[t].checked&&e.push({proId:$scope.productList[t].id,num:1});$scope.orderInitParams={proList:e,street:$scope.streetId},CartService.settlement($scope.orderInitParams).success(function(e,t,o,s){if(0==e.success)PopupService.showToast(e.message);else if(1==e.success&&null!=e.data){var i=new Date;i.setDate(i.getDate()+1),$cookies.put("is_book","",{expires:i,path:"/"}),$state.go("orderConfirm",{orderInitParams:JSON.stringify($scope.orderInitParams)})}else PopupService.showToast("结算失败")})},$scope.goBack=function(){$state.go("newHome")},$scope.$on("$ionicView.beforeEnter",function(e,t){if(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&window.emc.configDeviceDriection("1"),"back"==t.direction){"login"==$ionicHistory.viewHistory().forwardView.stateName&&($scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.init())}else $scope.productTotalprice=0,$scope.selectnumber=0,$scope.selectprice=0,$scope.selectcommsion=0,getAddress().then(function(e){$scope.pid=e.provinceId,$scope.cid=e.cityId,$scope.aid=e.areaId,$scope.streetId=e.streetId}),$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&window.emc.configDeviceDriection("2")})}]),APP.service("zhcjService",["$http","UrlService",function(e,t){this.soluteDetail=function(o){var s={channel:1,scenesId:o};return e.get(t.getNewUrl("SMART_SCENES"),s)},this.soluteproduct=function(o){var s={spaceId:o};return e.get(t.getNewUrl("SMART_SPACE"),s)},this.productList=function(o,s,i,a,n,r){var c={productsIds:o,streetId:s,memberId:i,cityId:a,provinceId:n,regionId:r};return e.get(t.getNewUrl("ITSOLU_PRODUCTLIST"),c)}}]),APP.controller("monthRewardController",["$scope","$stateParams","HelpDetailService","UrlService","PlatformService","monthRewardService",function(e,t,o,s,i,a){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.monthList=[];e.init=function(){a.getRevenueList(e.earningType,e.type,"Y",0,10).success(function(t){e.monthList=t.data.rewardY})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("monthRewardService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n){var r={earningType:o,type:s,rewardType:i,page:a,pageSize:n};return e.get(t.getUrl("REVENUE_LIST"),r)}}]),APP.controller("otherRewardController",["$scope","$stateParams","UrlService","PlatformService","monthRewardService",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.total=0,e.otherList=[];e.init=function(){i.getRevenueList(e.earningType,e.type,"OTHER",0,10).success(function(t){
e.total=t.data.rewardO.expectOtherAmount,e.otherList=t.data.rewardOther})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("someRewardController",["$scope","$stateParams","UrlService","$ionicPopup","monthRewardService",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardType=t.rewardType,e.someList=[],e.someDetail={};var a,n;e.init=function(){n="reward"+e.rewardType,i.getRevenueList(e.earningType,e.type,e.rewardType,0,10).success(function(t){t.data[n]instanceof Array?e.someList=t.data[n]:(e.someList=[],e.someList.push(t.data[n]))})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.lookReward=function(t){e.someDetail=t,a=s.show({cssClass:"xvv-popupSome",template:'<div class="xvv-some"><div>抵扣金额</div><p class="radiubox"><i></i><span></span><span></span></p><div class="xvv-overflow"><div class="xvv-det" ng-repeat="item in someDetail.sgDeductionDetails"><div><p>此单抵扣<span>{{item.deductibleAmount|currency:"&yen"}}</span></p><p>抵扣单号<span>{{item.reverseNetSn}}</span></p><p>抵扣类型<span>{{item.deductibleType}}<span></p></div></div></div><div ng-click="closesome()">确定</div></div>',scope:e})},e.closesome=function(){a.close()},e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("yongjinDetailController",["$scope","$stateParams","UrlService","yongjinDetailService","$ionicPopup",function(e,t,o,s,i){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardStart=t.start,e.rewardEnd=t.end,e.hasMoreData=!1,e.tanKdetail={};var a,n,r=0;e.loadData=function(t,o,i,a,n,r,c){s.getRevenueList(t,o,i,a,n,r,c).success(function(t){t.data.list?(e.revenueList=0==a?t.data.list:e.revenueList.concat(t.data.list),e.hasMoreData=t.data.list.length==n,e.$broadcast("scroll.infiniteScrollComplete")):e.hasMoreData=!1})},e.loadMore=function(){r+=1,e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.lookDetail=function(t){e.tanKdetail=t,1==e.type?a=i.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><p>类型</p><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p></div><div><p>{{tanKdetail.rewardTypeStr}}</p><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div ng-click="closeDetail()">确定</div></div>',scope:e}):n=i.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin2"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><div style="width:3.68rem;"><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">抵扣金额</p></div><div><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">{{tanKdetail.deductionAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div class="xvv-yongjinother" ng-repeat="i in tanKdetail.sgDeductionDetails"><div style="color:#7A87A3"><p>抵扣单号<span>{{i.reverseNetSn}}</span></p><p>抵扣类型<span>{{i.deductibleType}}</span></p><p>此单抵扣<span>{{i.deductibleAmount|currency:"&yen"}}</span></p></div></div></div><div ng-click="closeDetail()">确定</div></div>',scope:e})},e.closeDetail=function(){1==e.type?a.close():n.close()},e.init=function(){e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("yongjinDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,s,i,a,n,r,c){var l={earningType:o,type:s,rewardType:i,page:a,pageSize:n,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]);>>>>>>> .r193359
