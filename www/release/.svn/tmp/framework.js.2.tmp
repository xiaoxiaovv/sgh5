var APP=angular.module("starter",["ionic","ngCookies","ionic-datepicker","ngFileUpload","st","ui.router","me-lazyimg","ngAnimate"]),commonConfig=["$ionicConfigProvider",function(e){e.views.maxCache(10),e.scrolling.jsScrolling(!0),e.views.forwardCache(!0),e.views.transition("none"),e.backButton.text(""),e.backButton.icon("ion-ios-arrow-left"),e.backButton.previousTitleText(!1),e.navBar.alignTitle("center"),e.views.swipeBackEnabled(!1)}],interceptors=["$httpProvider","$ionicConfigProvider",function(e,t){e.interceptors.push("LoadingIntercepter"),e.interceptors.push("GetParamIntercepter"),e.interceptors.push("UserIntercepter"),e.interceptors.push("PostParamIntercepter")}];$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("TokenAuthorization",window.localStorage.getItem("sg_login_token_secret"))}}),APP.factory("LoadingIntercepter",["$rootScope","$q",function(e,t){return{request:function(t){return/http:\/\//.exec(t.url)&&((!t.noLoading&&!t.data&&!t.params||t.data&&!t.data.noLoading&&!t.params||t.params&&!t.data&&!t.params.noLoading)&&e.$broadcast("LOADING:SHOW"),t.data&&t.data.noLoading&&delete t.data.noLoading,t.params&&t.params.noLoading&&delete t.params.noLoading),t},response:function(t){var o=/http:\/\//;return(!t||t&&o.exec(t.config.url))&&e.$broadcast("LOADING:HIDE"),t},responseError:function(o){e.$broadcast("http-response:error",o),e.$broadcast("LOADING:HIDE"),t.reject(o)}}}]),APP.factory("UserIntercepter",["UserService","$rootScope","UrlService",function(e,t,o){return{request:function(e){return e.method,e},response:function(e){return e&&e.config&&"GET"==e.config.method?e.data&&e.data.errorCode&&"-100"==e.data.errorCode&&t.$emit("userIntercepted","sessionOut",e):e&&e.config&&"POST"==e.config.method&&e.data&&"-100"==e.data.errorCode&&t.$emit("userIntercepted","sessionOut",e),e},responseError:function(e){}}}]),APP.factory("GetParamIntercepter",["$rootScope","$localstorage",function(e,t){return{request:function(e){if("GET"==e.method){var o=angular.copy(e);delete o.cache,delete o.headers,delete o.method,delete o.paramSerializer,delete o.transformRequest,delete o.transformResponse,delete o.url;var i="";for(var s in o)i?i+="&":i="?",i=i+s+"="+o[s];e.url=e.url+i,e.headers.TokenAuthorization=t.get("sg_login_token_secret")}return e},response:function(t){return-1==t.config.url.indexOf("sg/game/winnerList.json")&&t.data.data&&120==t.data.data.code&&e.$broadcast("tooCrowd",'<div><div style="text-align:center;color:#32BEFF;font-size:14px;margin-bottom:10px;">人数太多,请稍后……</div><div>俗话说：好饭不怕晚，好腰不怕闪，大奖都在后面！<br /></div><div style="text-align:center;"><img style="width:70%;" src="{{imgBaseURL}}img/waitBusy.gif" /></div></div>'),t},responseError:function(e){}}}]),APP.factory("PostParamIntercepter",["$rootScope","$localstorage",function(e,t){return{request:function(e){return"POST"==e.method&&(e.headers.TokenAuthorization=t.get("sg_login_token_secret")),e},response:function(t){return-1==t.config.url.indexOf("sg/game/winnerList.json")&&t.data.data&&120==t.data.data.code&&e.$broadcast("tooCrowd",'<div><div style="text-align:center;color:#32BEFF;font-size:14px;margin-bottom:10px;">人数太多,请稍后……</div><div>俗话说：好饭不怕晚，好腰不怕闪，大奖都在后面！<br /></div><div style="text-align:center;"><img style="width:70%;" src="{{imgBaseURL}}img/waitBusy.gif" /></div></div>'),t},responseError:function(e){}}}]);var route=function(e,t){e.state("mine",{url:"/mine",templateUrl:"templates/mine/Mine.html",controller:"MineController",requiredLogin:!0}).state("accountMessage",{url:"/accountMessage",templateUrl:"templates/mine/account/AccountMessage.html",controller:"AccountMessageController",requiredLogin:!0}).state("changeName",{url:"/changeName/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/ChangeName.html",controller:"ChangeNameController",requiredLogin:!0}).state("changeEmail",{url:"/changeEmail/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/ChangeEmail.html",controller:"ChangeEmailController",requiredLogin:!0}).state("changePassword",{url:"/changePassword",templateUrl:"templates/mine/account/ChangePassword.html",controller:"ChangePasswordController",requiredLogin:!0}).state("selectSex",{url:"/selectSex/:userName/:birthday/:gender/:nickName/:email",templateUrl:"templates/mine/account/SelectSex.html",controller:"SelectSexController",requiredLogin:!0}).state("easyConnectIframe",{url:"/easyConnectIframe/:content",templateUrl:"templates/mine/getCash/EasyConnectIframe.html",controller:"EasyConnectIframeController",requiredLogin:!0}).state("bindResult",{url:"/bindResult",templateUrl:"templates/mine/getCash/BindResult.html",controller:"BindResultController",requiredLogin:!0}).state("bindAccount",{url:"/bindAccount",templateUrl:"templates/mine/getCash/BindAccount.html",controller:"BindAccountController",requiredLogin:!0}).state("shopMessage",{url:"/shopMessage",templateUrl:"templates/mine/shop/ShopMessage.html",controller:"ShopMessageController",requiredLogin:!0}).state("shopName",{url:"/shopName/:default",templateUrl:"templates/mine/shop/ShopName.html",controller:"ShopNameController",requiredLogin:!0}).state("shopLegend",{url:"/shopLegend/:default/:provinceId/:cityId/:regionId/:hrCode",templateUrl:"templates/mine/shop/ShopLegend.html",controller:"ShopLegendController",requiredLogin:!0}).state("shopAddress",{url:"/shopAddress/:default/:defaultDetail/:provinceId/:cityId/:regionId:/:hrCode/:memberType",templateUrl:"templates/mine/shop/ShopAddress.html",controller:"ShopAddressController",requiredLogin:!0}).state("aboutUs",{url:"/aboutUs",templateUrl:"templates/mine/AboutUs.html",controller:"AboutUsController",requiredLogin:!0}).state("address",{url:"/address/:comeFromOrder",templateUrl:"templates/mine/Address/Address.html",controller:"AddressController",requiredLogin:!0}).state("changeAddress",{url:"/changeAddress/:addressData",templateUrl:"templates/mine/Address/ChangeAddress.html",controller:"ChangeAddressController",requiredLogin:!0}).state("addAddress",{url:"/addAddress",templateUrl:"templates/mine/Address/AddAddress.html",controller:"AddAddressController",requiredLogin:!0}).state("AddPrizeAddress",{url:"/AddPrizeAddress/:gameId/:uuid/:prizeId",templateUrl:"templates/mine/Address/AddPrizeAddress.html",controller:"AddPrizeAddressController",requiredLogin:!0}).state("batchDeleteAddress",{url:"/batchDeleteAddress",templateUrl:"templates/mine/Address/BatchDeleteAddress.html",controller:"BatchDeleteAddressController",requiredLogin:!0}).state("shoppingCar",{url:"/shoppingCar",templateUrl:"templates/mine/ShoppingCar.html",controller:"ShoppingCarController",requiredLogin:!0}).state("collection",{url:"/collection",templateUrl:"templates/mine/Collection.html",controller:"CollectionController",requiredLogin:!0}).state("newAuthenticationHome",{url:"/newAuthenticationHome/:promotionCode/:types",templateUrl:"templates/newAuthentication/newAuthenticationHome.html",controller:"newAuthenticationHome"}).state("crowdFunding",{url:"/crowdFunding/:shareId/:type",templateUrl:"templates/crowd_funding/CrowdFunding.html",controller:"CrowdFundingHomeControl"}).state("localSpecialtyHomePage",{url:"/localSpecialtyHomePage/:storeId",templateUrl:"templates/localSpecialty/localSpecialtyHomePage.html",controller:"localSpecialtyHomePageController"}).state("SpecialtyVenueHome",{url:"/SpecialtyVenueHome/:regionId/:streetId/:shareId",templateUrl:"templates/localSpecialty/specialtyVenueHome.html",controller:"SpecialtyVenueHomeController"}).state("secondLevelStore",{url:"/secondLevelStore/:cityId/:shareId",templateUrl:"templates/localSpecialty/secondLevelStore.html",controller:"secondLevelStoreController"}).state("ListOfSpecialtyGoods",{url:"/ListOfSpecialtyGoods/:productCateId/:pageId/:storeId",templateUrl:"templates/localSpecialty/listOfSpecialtyGoods.html",controller:"ListOfSpecialtyGoodsController"}).state("trueAuthentication",{url:"/trueAuthentication/:type",templateUrl:"templates/newAuthentication/trueAuthentication.html",controller:"trueAuthenticationControl"}).state("MechanismDescription",{url:"/MechanismDescription",templateUrl:"templates/newAuthentication/MechanismDescription.html"}).state("trueAuthenticationList",{url:"/trueAuthenticationList",templateUrl:"templates/newAuthentication/trueAuthenticationList.html",controller:"trueAuthenticationListControl"}).state("haierStaff",{url:"/haierStaff",templateUrl:"templates/newAuthentication/haierStaff.html",controller:"haierStaffControl"}).state("bindingBankHome",{url:"/bindingBankHome",templateUrl:"templates/bindingBank/bindingBankHome.html",controller:"bindingBankControl",requiredLogin:!0}).state("verificationCode",{url:"/verificationCode/:ownerName/:identityNo/:cardNo/:mobile/:bankNo/:phoneNumber",templateUrl:"templates/bindingBank/verificationCode.html",controller:"verificationCodeControl",requiredLogin:!0}).state("teamSupervise",{url:"/teamSupervise",templateUrl:"templates/teamSupervise/teamSupervise.html",controller:"teamSuperviseController",requiredLogin:!0}).state("teamMessage",{url:"/teamMessage/:memberId/:type",templateUrl:"templates/teamSupervise/teamMessage.html",controller:"teamMessageController",requiredLogin:!0}).state("userMessage",{url:"/userMessage/:memberId/:name/:mobile/:isTeamNum",templateUrl:"templates/teamSupervise/userMessage.html",controller:"userMessageController",requiredLogin:!0}).state("userSearch",{url:"/userSearch/:selectedIndex",templateUrl:"templates/teamSupervise/userSearch.html",controller:"userSearchController",requiredLogin:!0}).state("crowd_funding_details",{url:"/crowd_funding_details/:zActivityId/:shareId",templateUrl:"templates/crowd_funding/crowd_funding_details/crowd_funding_details.html",controller:"crowd_funding_details_control"}).state("crowd_funding_hot_redound",{url:"/crowd_funding_hot_redound/:zActivityId",templateUrl:"templates/crowd_funding/crowd_funding_hot_redound/crowd_funding_hot_redound.html",controller:"crowd_funding_hot_redound_control"}).state("orderWrite",{url:"/orderWrite/:zStallsId/:number/:shareId",templateUrl:"templates/crowd_funding/mdg-zhongchou/orderWrite.html",controller:"orderWriteController",requiredLogin:!0}).state("myRaiseNo",{url:"/myRaiseNo",templateUrl:"templates/crowd_funding/mdg-zhongchou/MyRaiseNo.html",controller:"MyRaiseNoController"}).state("orderDetails",{url:"/orderDetails/:orderSn/:cOrderSn/:cOrderId",templateUrl:"templates/crowd_funding/mdg-zhongchou/OrderDetails.html",controller:"OrderDetailsController",requiredLogin:!0}).state("RiskDescription",{url:"RiskDescription",templateUrl:"templates/crowd_funding/mdg-zhongchou/RiskDescription.html",controller:"RiskDescriptionController"}).state("SupportersAgreement",{url:"SupportersAgreement",templateUrl:"templates/crowd_funding/mdg-zhongchou/SupportersAgreement.html",controller:"SupportersAgreementController"}).state("messageCenter",{url:"/messageCenter/:messageType",templateUrl:"templates/mine/messageCenter/MessageCenter.html",controller:"MessageCenterController",requiredLogin:!0}).state("ClassifyMessageCenter",{url:"/ClassifyMessageCenter",templateUrl:"templates/mine/messageCenter/ClassifyMessageCenter.html",controller:"ClassifyMessageCenterController",requiredLogin:!0}).state("detailMessageCenter",{url:"/detailMessageCenter/:title/:content",templateUrl:"templates/mine/messageCenter/DetailMessageCenter.html",controller:"DetailMessageCenterController",requiredLogin:!0}).state("buyerCenter",{url:"/buyerCenter/:shareStoreId",templateUrl:"templates/mine/buyerCenter/BuyerCenter.html",controller:"BuyerCenterController",requiredLogin:!0}).state("competition",{url:"/competition/:taskDestId/:taskType/:memberId",templateUrl:"templates/mine/competition.html",controller:"CompetitionController",cache:!1}).state("myWallet",{url:"/myWallet",templateUrl:"templates/mine/wallet/MyWallet.html",controller:"MyWalletController",requiredLogin:!0}).state("walletIntegral",{url:"/walletIntegral",templateUrl:"templates/mine/wallet/walletIntegral.html",controller:"walletIntCtrl",requiredLogin:!0}).state("walletDiamonds",{url:"/walletDiamonds",templateUrl:"templates/mine/wallet/walletDiamonds.html",controller:"walletDiamCtrl",requiredLogin:!0}).state("commonPageView",{url:"/commonPageView/:title/:content",templateUrl:"templates/common/CommonPageView.html",controller:"CommonPageViewController"}).state("commonLocation",{url:"/commonLocation/:flag/:defaultValue/:data/:level/:title",templateUrl:"templates/common/CommonLocation.html",controller:"CommonLocationController"}).state("commonSelect",{url:"/commonSelect/:flag/:defaultValue/:data/:level/:title",templateUrl:"templates/common/CommonSelect.html",controller:"CommonSelectController"}).state("commonUnion",{url:"/commonUnion/:flag/:defaultValue/:data",templateUrl:"templates/common/CommonUnion.html",controller:"CommonUnionController"}).state("productDetail",{url:"/productDetail/:productId/:o2oType/:fromType/:storeId/:shareStoreId",templateUrl:"templates/product/productDetail.html",controller:"ProductDetailController",cache:!1}).state("productEffect",{url:"/productEffect/:vrUrl",templateUrl:"templates/product/productEffect.html",controller:"productEffectController"}).state("productRated",{url:"/productRated/:productId",templateUrl:"templates/product/productRated.html",controller:"ProductRatedController"}).state("myStore",{url:"/myStore/:storeId/:shareStoreId/:token",templateUrl:"templates/shop/MyStore.html",controller:"MyStoreController"}).state("cart",{url:"/cart",templateUrl:"templates/cart/Cart.html",controller:"CartController"}).state("payResultSuccess",{url:"/payResultSuccess",templateUrl:"templates/order/payResultSuccess.html",requiredLogin:!0}).state("payResultFailure",{url:"/payResultFailure",templateUrl:"templates/order/payResultFailure.html",requiredLogin:!0}).state("custom-made",{url:"/custom-made/:customMadeUrl",templateUrl:"templates/mine/custom-made.html",controller:"CustomMadeController",requiredLogin:!0}).state("CustomPage",{url:"/CustomPage/:customPageId",templateUrl:"templates/shop/CustomPage.html",controller:"CustomPageCtrl"}).state("vip",{url:"/vip/:gameId/:msg",templateUrl:"templates/mine/vip.html",controller:"VipController",requiredLogin:!0}).state("goldgame",{url:"/goldgame/:gameId",templateUrl:"templates/mine/goldgame.html",controller:"VipController",requiredLogin:!0}).state("helpStaff",{url:"/helpStaff/:memberId/:gameId/:channel",templateUrl:"templates/game/helpStaff.html",controller:"helpStaffController"}).state("goldRecord",{url:"/goldRecord",templateUrl:"templates/mine/goldRecord.html",controller:"goldRecordController",cache:!1,requiredLogin:!0}).state("vipGame",{url:"/vipGame/:gameId/:shareStoreId/:isAdmin",templateUrl:"templates/game/vipGame.html",controller:"VipGameController",requiredLogin:!0}).state("missionDetail",{url:"/missionDetail/:taskId",templateUrl:"templates/mine/Mission/missionDetail.html",controller:"MissionDetailController",requiredLogin:!0}).state("ccbfenqi",{url:"/ccbfenqi/:orderSn/:whereName",templateUrl:"templates/order/ccbfenqi.html",controller:"CcbFenqiController",requiredLogin:!0}).state("ccbPay",{url:"/ccbPay/:url/:orderSn",templateUrl:"templates/order/ccbPay.html",controller:"CcbPayController",requiredLogin:!0}).state("paymentxyz",{url:"/paymentxyz/:orderSn/:totalAmount",templateUrl:"templates/order/Paymentxyz.html",controller:"PaymentControllerxyz",requiredLogin:!0}).state("orderConfirm",{url:"/orderConfirm/:orderMessage/:couponButton/:Book/:attrValueNames/:skku/:o2oAttrId",templateUrl:"templates/order/orderConfirm.html",controller:"OrderConfirmController",requiredLogin:!0}).state("batchDeleteOrder",{url:"/batchDeleteOrder",templateUrl:"templates/shop/batchDeleteOrder.html",controller:"batchDeleteOrderController",requiredLogin:!0}).state("afterOrderSubmit",{url:"/afterOrderSubmit/:messageData/:paymentCode",templateUrl:"templates/order/afterOrderSubmit.html",controller:"AfterOrderSubmitController",requiredLogin:!0}).state("payment",{url:"/payment/:paymentCode",templateUrl:"templates/order/Payment.html",controller:"PaymentController",requiredLogin:!0}).state("sendGoodsTime",{url:"/sendGoodsTime",templateUrl:"templates/order/SendGoodsTime.html",controller:"SendGoodsTimeController",requiredLogin:!0}).state("homePage",{url:"/homePage",templateUrl:"templates/product/homePage.html",controller:"HomePageController"}).state("seeMore",{url:"/seeMore",templateUrl:"templates/product/seeMore.html",controller:"SeeMoreController"}).state("familytry",{url:"/familytry",templateUrl:"templates/product/familytry.html",controller:"familytryController"}).state("familydetail",{url:"/familydetail/:detailUrl/:title",templateUrl:"templates/product/familydetail.html",controller:"familydetailController",cache:!1}).state("electricalMall",{url:"/electricalMall",templateUrl:"templates/product/electricalMall.html",controller:"ElectricalMallController"}).state("furnish",{url:"/furnish",templateUrl:"templates/product/furnish.html",controller:"furnishController"}).state("superMarket",{url:"/superMarket",templateUrl:"templates/product/superMarket.html",controller:"superMarketController"}).state("goodsSearch",{url:"/goodsSearch/:front/:shareStoreId",templateUrl:"templates/product/GoodsSearch.html",controller:"GoodsSearchController"}).state("CommodityList",{url:"/CommodityList/:couponId",templateUrl:"templates/product/CommodityList.html",controller:"CommodityListController"}).state("imageAndWord",{url:"/imageAndWord/:productId",cache:"false",templateUrl:"templates/product/imageAndWord.html",controller:"ImageAndWordController"}).state("specifications",{url:"/specifications/:productId",templateUrl:"templates/product/Specifications.html",controller:"SpecificationsController"}).state("invoiceSetup",{url:"/invoiceSetup/:invoiceHead/:invoiceType/:enterPage",templateUrl:"templates/invoice/InvoiceSetup.html",controller:"InvoiceSetupController",requiredLogin:!0}).state("branchType",{url:"/branchType",templateUrl:"templates/product/branchType.html",controller:"BranchTypeController"}).state("branchTypeDetail",{url:"/branchTypeDetail/:productCateId",templateUrl:"templates/product/branchTypeDetail.html",controller:"BranchTypeDetailController"}).state("myStoreManage",{url:"/myStoreManage",templateUrl:"templates/mine/myStore/myStoreManage.html",controller:"MyStoreManageController",requiredLogin:!0}).state("customerService",{url:"/customerService",templateUrl:"templates/shop/customerService.html",controller:"CustomerServiceController",requiredLogin:!0}).state("myPhoneManage",{url:"/myPhoneManage",templateUrl:"templates/mine/phone/myPhoneManage.html",controller:"MyPhoneManageController",requiredLogin:!0}).state("myPhoneBindSuccess",{url:"/myPhoneBindSuccess/:phone",templateUrl:"templates/mine/phone/myPhoneBindSuccess.html",controller:"MyPhoneBindSuccessController",requiredLogin:!0}).state("myPhoneCode",{url:"/myPhoneCode",templateUrl:"templates/mine/phone/myPhoneCode.html",controller:"MyPhoneCodeController",requiredLogin:!0}).state("myPhoneBind",{url:"/myPhoneBind/:realName/:identityNo",templateUrl:"templates/mine/phone/myPhoneBind.html",controller:"MyPhoneBindController",requiredLogin:!0}).state("myPhoneBindNewCode",{url:"/myPhoneBindNewCode/:mobile/:realName/:identityNo",templateUrl:"templates/mine/phone/myPhoneBindNewCode.html",controller:"MyPhoneBindNewCodeController",requiredLogin:!0}).state("myIdCardAuthen",{url:"/myIdCardAuthen/:isAuth",templateUrl:"templates/mine/phone/myIdCardAuthen.html",controller:"MyIdCardAuthenController",requiredLogin:!0}).state("shop",{url:"/shop/:token",templateUrl:"templates/shop/Shop.html",controller:"ShopController"}).state("microSchool",{url:"/microSchool",templateUrl:"templates/shop/MicroSchool.html",controller:"MicroSchoolController"}).state("microSchoolDetail",{url:"/microSchoolDetail/:childId/:id/:title",templateUrl:"templates/shop/MicroSchoolDetail.html",controller:"MicroSchoolControllerDetail"}).state("shopRevenue",{url:"/shopRevenue",templateUrl:"templates/shop/ShopRevenue.html",controller:"ShopRevenueController",requiredLogin:!0}).state("revenueDetail",{url:"/revenueDetail/:code/:title/:earningType",templateUrl:"templates/shop/RevenueDetail.html",controller:"RevenueDetailController",requiredLogin:!0}).state("monthReward",{url:"/monthReward/:code/:title/:earningType",templateUrl:"templates/shop/yingshouDetail/monthReward.html",controller:"monthRewardController"}).state("otherReward",{url:"/otherReward/:code/:title/:earningType",templateUrl:"templates/shop/yingshouDetail/otherReward.html",controller:"otherRewardController"}).state("someReward",{url:"/someReward/:code/:title/:earningType/:rewardType",templateUrl:"templates/shop/yingshouDetail/someReward.html",controller:"someRewardController"}).state("yongjinDetail",{url:"/yongjinDetail/:code/:title/:earningType/:start/:end",templateUrl:"templates/shop/yingshouDetail/yongjinDetail.html",controller:"yongjinDetailController"}).state("shopRenovate",{url:"/shopRenovate",templateUrl:"templates/shop/ShopRenovate.html",controller:"ShopRenovateController"}).state("setShopCover",{url:"/setShopCover",templateUrl:"templates/shop/SetShopCover.html",controller:"SetShopCoverController"}).state("chooseShopTemplate",{url:"/chooseShopTemplate",templateUrl:"templates/shop/ChooseShopTemplate.html",controller:"ChooseShopTemplateController"}).state("withdrawSuccess",{url:"/withdrawSuccess/:content",templateUrl:"templates/shop/WithdrawSuccess.html",controller:"WithdrawSuccessController"}).state("newHand",{url:"/newHand",templateUrl:"templates/shop/NewHand.html",controller:"HelpController"}).state("goodsManage",{url:"/goodsManage",templateUrl:"templates/shop/GoodsManage.html",controller:"GoodsManageController",requiredLogin:!0}).state("orderManage",{url:"/orderManage/:orderStatus/:isPayCoupon/:orderType/:orderFlag",templateUrl:"templates/shop/OrderManage.html",controller:"OrderManageController",requiredLogin:!0}).state("orderSearch",{url:"/orderSearch",templateUrl:"templates/order/OrderSearch.html",controller:"OrderSearchController",requiredLogin:!0}).state("orderDetail",{url:"/orderDetail/:orderSn/:cOrderSn/:cOrderId",templateUrl:"templates/shop/OrderDetail.html",controller:"OrderDetailController",requiredLogin:!0}).state("connectionSearch",{url:"/connectionSearch/:searchType",templateUrl:"templates/shop/ConnectionSearch.html",controller:"ConnectionSearchController",requiredLogin:!0}).state("orderTracking",{url:"/orderTracking/:orderSn",templateUrl:"templates/shop/OrderTracking.html",controller:"OrderTrackingController",requiredLogin:!0}).state("carTracking",{url:"/carTracking/:trackUrl",templateUrl:"templates/order/CarTracking.html",controller:"CarTrackController"}).state("refundDetail",{url:"/refundDetail/:orderProductId/:memberId",templateUrl:"templates/shop/RefundDetail.html",controller:"RefundDetailController",requiredLogin:!0}).state("helpDetail",{url:"/helpDetail/:helpId/:content",templateUrl:"templates/shop/HelpDetail.html",controller:"HelpDetailController"}).state("feedback",{url:"/feedback",templateUrl:"templates/shop/Feedback.html",controller:"FeedbackController",requiredLogin:!0}).state("applyRefund",{url:"/applyRefund/:cOrderSn",templateUrl:"templates/shop/ApplyRefund.html",controller:"ApplyRefundController",requiredLogin:!0}).state("publicationEvaluation",{url:"/publicationEvaluation/:cOrderSn",templateUrl:"templates/shop/publicationEvaluation.html",controller:"publicationEvaluationController",requiredLogin:!0}).state("chaseEvaluate",{url:"/chaseEvaluate/:cOrderSn/:isMeorder",templateUrl:"templates/shop/chaseEvaluate.html",controller:"chaseEvaluateController",requiredLogin:!0}).state("criticalSuccess",{url:"/criticalSuccess/:cOrderSn",templateUrl:"templates/shop/criticalSuccess.html",controller:"criticalSuccessController",requiredLogin:!0}).state("evaluationSuccess",{url:"/evaluationSuccess",templateUrl:"templates/shop/evaluationSuccess.html",controller:"evaluationSuccessController"}).state("useExperience",{url:"/useExperience/:cOrderSn",templateUrl:"templates/shop/useExperience.html",controller:"useExperienceController"}).state("lookAssess",{url:"/lookAssess/:orderId/:cOrderSn",templateUrl:"templates/shop/LookAssess.html",controller:"LookAssessController",requiredLogin:!0}).state("confirmReceive",{url:"/confirmReceive/:orderId",templateUrl:"templates/order/ConfirmReceive.html",controller:"ConfirmReceiveController",requiredLogin:!0}).state("VrPage",{url:"/VrPage/:isH5",templateUrl:"templates/shop/VR.html",controller:"VRController",cache:!1}).state("manageMoney",{url:"/manageMoney/:frontState",templateUrl:"templates/shop/ManageMoney.html",controller:"ManageMoneyController",requiredLogin:!0}).state("getCouponsList",{url:"/getCouponsList/:shareStoreId",templateUrl:"templates/coupons/GetCouponsList.html",controller:"GetCouponsListController"}).state("couponsDetail",{url:"/couponsDetail/:cId/:userID/:type/:status/:isUser",templateUrl:"templates/coupons/CouponsDetail.html",controller:"CouponsDetailController"}).state("couponsDetailTwo",{url:"/couponsDetailTwo/:cId/:userID/:type/:status/:couponId/:isUser",templateUrl:"templates/coupons/CouponsDetailTwo.html",controller:"CouponsDetailTwoController"}).state("useCouponsList",{url:"/useCouponsList/:type/:productId/:number/:couponId",templateUrl:"templates/coupons/UseCouponsList.html",controller:"UseCouponsListController"}).state("Retainage",{url:"/Retainage/:relationOrderSn/:relationOrderAmount/:isPayCoupon",templateUrl:"templates/coupons/Retainage.html",controller:"RetainageController"}).state("myCouponsList",{url:"/myCouponsList",templateUrl:"templates/coupons/MyCouponsList.html",controller:"MyCouponsListController"}).state("personnalCenter",{url:"/personnalCenter",templateUrl:"templates/mine/PersonalCenter.html",controller:"PersonalCenterController",requiredLogin:!0}).state("register",{url:"/register/:hasHistory/:promotionCode",templateUrl:"templates/login/Register.html",controller:"RegisterController"}).state("registerForStore",{url:"/registerForStore/:hasHistory",templateUrl:"templates/login/RegisterForStore.html",controller:"RegisterForStoreController"}).state("RegisterForStoreLogin",{url:"/RegisterForStoreLogin/:hasHistory",templateUrl:"templates/login/RegisterForStoreLogin.html",controller:"RegisterForStoreLoginController"}).state("login",{url:"/login",templateUrl:"templates/login/Login.html",controller:"LoginController"}).state("advertisement",{url:"/advertisement/:from",templateUrl:"templates/login/Advertisement.html",controller:"AdvertisementController"}).state("userAgreement",{url:"/userAgreement",templateUrl:"templates/login/UserAgreement.html"}).state("guidePage",{url:"/guidePage/:back",templateUrl:"templates/login/GuidePage.html",controller:"GuidePageController"}).state("shopApplySuccess",{url:"/shopApplySuccess/:totalCommission/:memberCount/:memberRegionCount",templateUrl:"templates/login/ShopApplySuccess.html",controller:"ShopApplySuccessController"}).state("requestPassword",{url:"/requestPassword",templateUrl:"templates/login/RequestPassword.html",controller:"RequestPasswordController"}).state("game",{url:"/game/:gameId/:shareStoreId/:isAdmin",templateUrl:"templates/game/game.html",controller:"GameController"}).state("seckillList",{url:"/seckillList/:shareStoreId",templateUrl:"templates/seckill/seckillList.html",controller:"SeckillListController"}).state("seckillDetail",{url:"/seckillDetail/:productId/:o2oType/:fromType/:storeId/:front/:seckillPrice/:seckillId/:sku/:status/:beginTime/:endTime/:shareStoreId",templateUrl:"templates/seckill/seckillDetail.html",controller:"SeckillDetailController",requiredLogin:!0}).state("orderConfirmSeckill",{url:"/orderConfirmSeckill/:seckillId/:numbers/:productIds/:beginTime/:endTime",templateUrl:"templates/seckill/orderConfirmSeckill.html",controller:"OrderConfirmSeckillController",requiredLogin:!0}).state("bannerTheme",{url:"/bannerTheme/:bannerId/:shareStoreId/:platformType",templateUrl:"templates/shop/BannerTheme.html",controller:"BannerThemeController"}).state("customizehd",{url:"/customizehd/:url",templateUrl:"templates/login/customizehd.html",controller:"CustomizehdController"}).state("bannerDaily",{url:"/bannerDaily/:bannerId/:layout/:shareStoreId/:platformType",templateUrl:"templates/shop/BannerDaily.html",controller:"BannerDailyController"}).state("invoiceHtml",{url:"/invoiceHtml/:invoiceSrc",templateUrl:"templates/common/invoiceHtml.html",controller:"invoiceHtmlController"}).state("Setup",{url:"/Setup",templateUrl:"templates/mine/Setup.html",controller:"SetupController"}).state("taskShare",{url:"/taskShare",templateUrl:"templates/mine/Mission/taskShare.html",controller:"taskShareController",requiredLogin:!0}).state("historyTask",{url:"/historyTask",templateUrl:"templates/mine/Mission/historyTask.html",controller:"historyTaskController",requiredLogin:!0}).state("anAuspiciousStart",{url:"/anAuspiciousStart/:anAuspiciousId",templateUrl:"templates/goodStart/anAuspiciousStart.html",controller:"anAuspiciousStartController",requiredLogin:!0}).state("Customer",{url:"/Customer",templateUrl:"templates/mine/Customer.html"}).state("topic",{url:"/topic",templateUrl:"templates/quanzi/Topic.html",abstract:!0,controller:"TopicController"}).state("qzMessageCenter",{url:"/qzMessageCenter",templateUrl:"templates/quanzi/qzMessageCenter.html",controller:"qzMessageCenterController"}).state("publishEdit",{url:"/publishEdit/:topicId/:noteId/:isShortStory",templateUrl:"templates/quanzi/PublishEdit.html",controller:"PublishEditController"}).state("allCircle",{url:"/allCircle",templateUrl:"templates/quanzi/AllCircle.html",controller:"AllCircleController"}).state("myCirclePages",{url:"/myCirclePages",templateUrl:"templates/quanzi/MyCirclePages.html",controller:"MyCirclePagesController"}).state("myLessones",{url:"/myLessones",templateUrl:"templates/quanzi/MyLessones.html",controller:"MyLessonesController"}).state("applyCircle",{url:"/applyCircle",templateUrl:"templates/quanzi/ApplyCircle.html",controller:"ApplyCircleController"}).state("circlePage",{url:"/circlePage/:circleId",templateUrl:"templates/quanzi/CirclePage.html",controller:"CirclePageController"}).state("signInChart",{url:"/signInChart/:topicId",templateUrl:"templates/quanzi/signInChart.html",controller:"signInChartController"}).state("signDate",{url:"/signDate/:userId/:topicId/:monthFlag",templateUrl:"templates/quanzi/signDate.html",controller:"signDateController"}).state("selectTags",{url:"/selectTags",templateUrl:"templates/quanzi/SelectTags.html",controller:"SelectTagsController"}).state("messageDetails",{url:"/messageDetails",templateUrl:"templates/quanzi/MessageDetails.html",controller:"MessageDetailsController"}).state("publishCircle",{url:"/publishCircle/:identifierCode/:topicId",templateUrl:"templates/quanzi/PublishCircle.html",controller:"PublishCircleController",requiredLogin:!0}).state("allMembers",{url:"/allMembers/:topicId",templateUrl:"templates/quanzi/AllMembers.html",controller:"AllMembersController",cache:!1}).state("selectGoods",{url:"/selectGoods",templateUrl:"templates/quanzi/SelectGoods.html",controller:"SelectGoodsController"}).state("noteDetails",{url:"/noteDetails/:noteId/:isShortStory/:shareStoreId",templateUrl:"templates/quanzi/NoteDetails.html",controller:"NoteDetailsController"}).state("classNoteDetails",{url:"/classNoteDetails/:noteId",templateUrl:"templates/quanzi/ClassNoteDetails.html",controller:"ClassNoteDetailsController"}).state("classesDetails",{url:"/classesDetails",templateUrl:"templates/quanzi/ClassesDetails.html",controller:"ClassesDetailsController"}).state("testPage",{url:"/testPage",templateUrl:"templates/quanzi/TestPage.html",controller:"TestPageController"}).state("testDetails",{url:"/testDetails",templateUrl:"templates/quanzi/TestDetails.html",controller:"TestDetailsController"}).state("questionDetails",{url:"/questionDetails/:wordsId",templateUrl:"templates/quanzi/QuestionDetails.html",controller:"QuestionDetailsController"}).state("topic.qhot",{url:"/qhot",views:{"topic-qhot":{templateUrl:"templates/quanzi/qhot.html",controller:"QhotController"}}}).state("topic.qmine",{url:"/qmine",views:{"topic-qmine":{templateUrl:"templates/quanzi/qmine.html",
controller:"QmineController"}},requiredLogin:!0}).state("topic.qwschool",{url:"/qwschool",views:{"topic-qwschool":{templateUrl:"templates/quanzi/qwschool.html",controller:"QwschoolController"}}}).state("heIssue",{url:"/heIssue/:title/:who/:id",templateUrl:"templates/quanzi/heIssue.html",controller:"heIssueController",requiredLogin:!0}).state("qdatabase",{url:"/qdatabase",templateUrl:"templates/quanzi/qdatabase.html",controller:"QdatabaseController"}).state("topicdetails",{url:"/topicdetails",templateUrl:"templates/quanzi/Topicdetails.html",controller:"TopicdetailsController",params:{huatiid:null}}).state("qSearch",{url:"/qSearch",templateUrl:"templates/quanzi/qSearch.html",controller:"qSearchController"}).state("qSearchTwo",{url:"/qSearchTwo",templateUrl:"templates/quanzi/qSearchTwo.html",controller:"qSearchTwoController",params:{tagIds:null,tagname:null}}).state("qSearchThree",{url:"/qSearchThree",templateUrl:"templates/quanzi/qSearchThree.html",controller:"qSearchThreeController",params:{keywords:null}}).state("qSearchBiao",{url:"/qSearchBiao",templateUrl:"templates/quanzi/qSearchBiao.html",controller:"qSearchBiaoController",params:{keywords:null}}).state("qSearchTie",{url:"/qSearchTie",templateUrl:"templates/quanzi/qSearchTie.html",controller:"qSearchTieController",params:{keywords:null}}).state("qSearchUser",{url:"/qSearchUser",templateUrl:"templates/quanzi/qSearchUser.html",controller:"qSearchUserController",params:{keywords:null}}).state("personalHomepageMe",{url:"/personalHomepageMe",templateUrl:"templates/quanzi/personalHomepageMe.html",controller:"personalHomepageMeCtrl",requiredLogin:!0}).state("personalHomepageHe",{url:"/personalHomePageHe/:othersId",templateUrl:"templates/quanzi/personalHomePageHe.html",controller:"personalHomepageHeCtrl"}).state("myFollow",{url:"/personalHomepageMe/myFollow",templateUrl:"templates/quanzi/myFollow.html",controller:"myFollowCtrl"}).state("myFans",{url:"/personalHomepageMe/myFans",templateUrl:"templates/quanzi/myFans.html",controller:"myFansCtrl"}).state("moreInteresting",{url:"/personalHomepageMe/moreInteresting",templateUrl:"templates/quanzi/moreInteresting.html",controller:"moreInterestingCtrl"}).state("mySettings",{url:"/personalHomepageMe/mySettings",templateUrl:"templates/quanzi/mySettings.html",controller:"mySettingsCtrl"}).state("quanziRecommend",{url:"/quanziRecommend",templateUrl:"templates/quanzi/quanziRecommend.html",controller:"communityRecommendCtrl"}).state("exam",{url:"/exam",templateUrl:"templates/quanzi/exam.html",controller:"examCtrl"}).state("customerConversation",{url:"/customerConversation",templateUrl:"templates/quanzi/CustomerConversation.html",controller:"CustomerConversationController",params:{products:void 0}}).state("serviceConversation",{url:"/serviceConversation/:chatId/:from/:to",templateUrl:"templates/quanzi/ServiceConversation.html",controller:"ServiceConversationController"}).state("groupSetting",{url:"/groupSetting/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("discussionGroup",{url:"/discussionGroup/:groupId/:circleId",templateUrl:"templates/quanzi/DiscussionGroup.html",controller:"GroupSettingController"}).state("bankCard",{url:"/bankCard",templateUrl:"templates/mine/Bank/bankCard.html",controller:"BankCardController"}).state("bankCardDetail",{url:"/bankCardDetail/:cardNoShow/:nameKjt",templateUrl:"templates/mine/Bank/bankCardDetail.html",controller:"bankCardDetailController"}).state("chooseTheBank",{url:"/chooseTheBank",templateUrl:"templates/mine/Bank/chooseTheBank.html",controller:"chooseTheBankController"}).state("bankSupport",{url:"/bankSupport",templateUrl:"templates/mine/Bank/bankSupport.html",controller:"bankSupportController"}).state("mentionCenter",{url:"/mentionCenter/:canAmount",templateUrl:"templates/mine/Bank/mentionCenter.html",controller:"mentionCenterController",requiredLogin:!0}).state("dataAnalysis",{url:"/dataAnalysis/:memberId",templateUrl:"templates/statistics/dataAnalysis.html",controller:"dataAnalysisController"}).state("VisitorBrowHistory",{url:"/VisitorBrowHistory/:userId/:daysType",templateUrl:"templates/mine/VisitorBroHistory/VisitorBrowHistory.html",controller:"VisiBroHisController"}).state("Partner",{url:"/Partner/:title/:memberId",templateUrl:"templates/mine/Partner/Partner.html",controller:"PartnerController"}).state("team",{url:"/team",templateUrl:"templates/mine/teamData/team.html",controller:"TeamController"}).state("storeTeamOwner",{url:"/storeTeamOwner",templateUrl:"templates/mine/storeTeamOwner/storeTeamOwner.html",controller:"storeTeamOwnerController"}).state("teamProductMsg",{url:"/teamProductMsg/:num/:type",templateUrl:"templates/mine/storeTeamOwner/teamProductMsg.html",controller:"teamProductMsgController"}).state("schoolGroupDiscuss",{url:"/schoolGroupDiscuss",templateUrl:"templates/quanzi/SchoolGroupDiscuss.html",controller:"SchoolGroupDiscussController"}).state("circleGroupDiscuss",{url:"/circleGroupDiscuss/:groupId/:circleId",templateUrl:"templates/quanzi/CircleGroupDiscuss.html",controller:"CircleGroupDiscussController"}).state("groupAddMember",{url:"/groupAddMember/:groupId/:circleId",templateUrl:"templates/quanzi/GroupAddMember.html",controller:"GroupAddMemberController"}).state("groupEditMember",{url:"/groupEditMember/:groupId",templateUrl:"templates/quanzi/GroupEditMember.html",controller:"GroupEditMemberController"}).state("groupsToShare",{url:"/groupsToShare",templateUrl:"templates/quanzi/GroupsToShare.html",controller:"GroupsToShareController",params:{shareList:void 0}}).state("shareListPage",{url:"/shareListPage",templateUrl:"templates/quanzi/ShareListPage.html",controller:"ShareListPageController",params:{sl:void 0}}).state("feedbackPlus",{url:"/feedbackPlus",templateUrl:"templates/mine/FeedbackPlus.html",controller:"FeedbackPlusController"}).state("newSend",{url:"/newSend",templateUrl:"templates/newsend/newSend.html",controller:"newsendCtrl",cache:!1}).state("flashsale",{url:"/flashsale/:type",templateUrl:"templates/flashsale/flashsale.html",controller:"flashsaleCtrl",cache:!1}).state("newres",{url:"/newres/:type",templateUrl:"templates/newres/newres.html",controller:"newresCtrl",cache:!1}).state("myAppointment",{url:"/myAppointment",templateUrl:"templates/mine/myAppointment.html",controller:"myAppointmentController"}).state("presell",{url:"/presell",templateUrl:"templates/presell/presell.html",controller:"presellCtrl",cache:!1}).state("accsetting",{url:"/accsetting",templateUrl:"templates/mine/accsetting.html",controller:"accsettingCtrl"}).state("accsafe",{url:"/accsafe",templateUrl:"templates/mine/accsafe.html",controller:"accsafeCtrl"}).state("relatedProduct",{url:"/relatedProduct",templateUrl:"templates/quanzi/relatedProduct.html",controller:"relatedProductController"}).state("topicRewardList",{url:"/topicRewardList/:tipId",templateUrl:"templates/quanzi/topicRewardList.html",controller:"topicRewardListController"}).state("CircleSetAdmin",{url:"/CircleSetAdmin/:topicId",templateUrl:"templates/quanzi/CircleSetAdmin.html",controller:"CircleSetAdminController"}).state("selectAdmin",{url:"/selectAdmin/:topicId",templateUrl:"templates/quanzi/selectAdmin.html",controller:"selectAdminController",cache:!1}).state("manageUser",{url:"/manageUser/:topicId",templateUrl:"templates/quanzi/manageUser.html",controller:"manageUserController",cache:!1}).state("financialMoney",{url:"/financialMoney/:whereId",templateUrl:"templates/shop/financialMoney.html",controller:"FinancialMoneyController"}).state("applyForWhite",{url:"/applyForWhite",templateUrl:"templates/mine/wallet/ApplyForWhite.html",controller:"ApplyForWhiteController"}).state("bankCardChose",{url:"/bankCardChose/:orderSn/:totalAmount",templateUrl:"templates/order/bankCardPaymentList.html",controller:"BankCardChoseController"}).state("debitCardPayment",{url:"/debitCardPayment/:orderSn/:totalAmount/:whereName",templateUrl:"templates/order/debitCardPayment.html",controller:"debitCardPaymentController"}).state("applyForCard",{url:"/applyForCard",templateUrl:"templates/product/applyForCard.html",controller:"applyForCardController"}).state("spendBaiInstallment",{url:"/spendBaiInstallment/:orderSn",templateUrl:"templates/order/spendBaiInstallment.html",controller:"spendBaiInstallmentController"}).state("lifeService",{url:"/lifeService",templateUrl:"templates/product/LifeService.html",controller:"lifeServiceController"}),JSON.parse(window.localStorage.getItem("USER_CACHE_KEY"))?t.otherwise("/homePage"):t.otherwise("/guidePage/:")};route.$inject=["$stateProvider","$urlRouterProvider"],APP.run(["AccountMessageService","trueAuthenticationService","HomePageService","$ionicPlatform","$rootScope","UserService","$state","CacheService","$ionicHistory","$timeout","$ionicLoading","PopupService","$location","$ionicPopup","AreaService","CommonAddressService","LoginService","AdvertisementService","$localstorage","$http","UrlService","CreditService","IMService","ShareService","$interval","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,w,y,T,C,b,A){function P(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function L(){var e=w.getUrl("JINBI_JILU");I.get(e).success(function(e){e.success})}function x(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),i=!1,n=o.length-1;n>=0;n--)if(o[n].id==t)return s.isCommission=o[n].list[0].checked,s.cashSwitch=o[n].list[1].checked,s.goldRainSwitch=o[n].list[2].checked,void(i=!0);if(!i){s.isCommission=!0,s.cashSwitch=!0,s.goldRainSwitch=!0;var a={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(a),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),s.isCommission=!0,s.cashSwitch=!0,s.goldRainSwitch=!0}}function D(){s.missionLists&&(s.missionLists(),s.missionLists=null)}function N(e){s.goldRainSwitch?s.isRaining||(s.isRaining=!0,goldFall(function(){s.isRaining=!1}),processLightMessage(e)):processLightMessage(e)}function _(e){e.levelOrder&&e.levelName&&u.levelUp(e.levelName,e.levelOrder,e.needCreditNum)}function k(){g.confirm({title:"<strong>退出应用</strong>",template:"确定要退出应用吗?",okText:"退出",okType:"button-assertive",cancelText:"取消"}).then(function(e){e&&ionic.Platform.exitApp()})}s.countTime=10,s.tooCrowdToastFlag=!1;var O;window.closeTooCrowdToast=function(){"确定"==$(".popup-body .countToast").html()&&(s.countTime=10,s.tooCrowdToastFlag=!1,O.close())},s.$on("tooCrowd",function(e,t){if(!s.tooCrowdToastFlag){s.tooCrowdToastFlag=!0;var o=b(function(){s.countTime-1<=0?($(".popup-body .countToast").html("确定"),b.cancel(o)):(s.countTime--,$(".popup-body .countToast").html(s.countTime+"s"))},1e3);O=g.show({template:'<div style="color: black;text-align: left;font-size: 12px;text-align:center;padding-bottom:20px;">'+t+'<div class="countToast" style="position: absolute;bottom: 0;left: 0;width: 100%;height: 34px;line-height:34px;border-top: 1px solid #3333" onClick="closeTooCrowdToast();">10s</div></div>',buttons:[]});var i=b(function(){s.tooCrowdToastFlag?"确定"!=$(".popup-body .countToast").html()?$(".popup-body .countToast").css("color","#666666"):$(".popup-body .countToast").css("color","#32BEFF"):b.cancel(i)},200)}}),s.couponXyzType=!1,I.get(w.getUrl("TOKEN_LOGIN_GET")).success(function(e){e.data?S.set("sg_login_token_secret","Bearer"+e.data):S.set("sg_login_token_secret","Bearer"+A.generateUUID())}).error(function(e){S.set("sg_login_token_secret","Bearer"+A.generateUUID())}),s.globalConstant={},s.globalConstant.lon=120.457091,s.globalConstant.lat=36.108883,s.globalConstant.autoPosition="定位中···",s.globalConstant.positionStatus=!0,s.globalConstant.storeId="20219251",s.globalConstant.versionIOS="4.2.5",s.globalConstant.versionANDROID="4.2.5",s.globalConstant.androidDownLoadUrl="http://www.baidu.com",s.globalConstant.iosDownLoadUrl="http://www.baidu.com",s.globalConstant.mobileNumberRegExp=/^1([3578][0-9]|4[01356789]|66|9[89])\d{8}$/,s.globalConstant.passwordRegExp=/^((?=.*?\d)(?=.*?[A-Za-z])|(?=.*?\d)(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~])|(?=.*?[A-Za-z])(?=.*?[\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]))[\dA-Za-z\!\"\#\$\%\&\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\]\^\_\`\{\|\}\~]{6,20}$/,s.imgBaseURL="http://cdn09.ehaier.com/shunguang/H5/www/",s.tabsImg={background:"",wdHover:s.imgBaseURL+"img/tab_ic_user_hover.png",fl:s.imgBaseURL+"img/tab_ic_xuanpin.png",flHover:s.imgBaseURL+"img/tab_ic_xuanpin_hover.png",sgHover:s.imgBaseURL+"img/tab_ic_home_hover.png",gwcHover:s.imgBaseURL+"img/ic_shop_cart_select.png",sq:s.imgBaseURL+"img/tab_ic_shequ.png",sqHover:s.imgBaseURL+"img/tab_ic_shequ_hover.png",wd:s.imgBaseURL+"img/tab_ic_user.png",sg:s.imgBaseURL+"img/tab_ic_home.png",gwc:s.imgBaseURL+"img/ic_shop_cart_gray.png"},s.tabsTextColor={wdHoverFontColor:"#2577e3",flFontColor:"gray",flHoverFontColor:"#2577e3",sgHoverFontColor:"#2577e3",gwcHoverFontColor:"#2577e3",sqFontColor:"gray",sqHoverFontColor:"#2577e3",wdFontColor:"gray",sgFontColor:"gray",gwcFontColor:"gray"};var E=w.getNewUrl("ACTIVITY_ICON_TABS_NEW");I.get(E,{iconType:2}).success(function(e){e.success&&null!==e.data&&(null!==e.data.iconImageConfig&&(s.tabsImg=e.data.iconImageConfig),null!==e.data.iconFontConfig&&(s.tabsTextColor=e.data.iconFontConfig))}),s.appIsPaused=!1,s.invoiceType=2;var M;P("loginId");P("loginId")?M=P("loginId"):(M=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}(),function(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}("loginId",M)),s.loginIsAccord=!1,s.loginIsAuthentication=!1,s.goUpgrade=function(){s.loginIsAccord=!1,a.go("newAuthenticationHome")},s.goAuthentication=function(){n.isUserLogin()?(s.isCloseBtn?s.loginIsAuthentication=!0:s.loginIsAuthentication=!1,a.go("trueAuthenticationList")):a.go("login")},s.goMechanismDescription=function(){s.isCloseBtn?s.loginIsAuthentication=!0:s.loginIsAuthentication=!1,a.go("MechanismDescription")},s.closePopup=function(){s.loginIsAccord=!1,s.loginIsAuthentication=!1,s.loginIsAccord2=!1},s.signOut=function(){if(n.isUserLogin()){s.userCount="",s.password="";void 0==n.getUser().sessionValue?(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId","")):e.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,i){e.success&&(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId",""))})}else a.go("login")},s.goChangePhoneNum=function(){n.isUserLogin()?(s.isCloseBtn?s.loginIsAuthentication=!0:s.loginIsAuthentication=!1,a.go("myPhoneManage")):a.go("login")},i.on("resume",function(){s.appIsPaused=!1,T.validateWebSocket(),n.getUser().mid&&L()}),i.on("pause",function(){s.appIsPaused=!0});var U=d.show,R=d.hide;s.curOrder=0,s.totalOrder=0,d.show=function(e){s.loadingStart=(new Date).getTime(),U(e),e.duration&&l(function(){s.loadingStart=0,s.curMsg=null},e.duration)},d.hide=function(){R(),s.loadingStart=0,s.curMsg=null},window.closeLevelUpPop=function(){d.hide(),s.isLevelUp=!1,processLightMessageQueue()},window.closeGoodCoupon=function(e){e.parentNode.parentNode.remove()},window.gomyCouponsList=function(e){e.parentNode.parentNode.parentNode.remove(),a.go("myCouponsList")},x(n.getUser().mid),s.$on("sessionTimeout",function(){n.clearUser(),a.go("login")});var B=null,F=null,H=!1;s.registOrderSuccessCallback=function(e,t,o){H=!1,F=e,t&&l(function(){!1===H&&o&&o(e,!0,null)},t),B=o},window.processMessage=function(e){if("advertisement"==s.toState||"shopApplySuccess"==s.toState||"trueAuthentication"==s.toState)return void G.unshift(e);var t=e.messageType,o=e.extendData;"ORDER_COMMIT_RESULT"===t?B&&(H=!0,B(F,!1,e)):(s.isLevelUp=s.isLevelUp||o.popupMessage&&null!=o.popupMessage,null==o||$.isEmptyObject(o)||(s.freshMission&&(D(),s.freshMission=!1),"1"==o.goldRain&&N(e.msg),"1"==o.openStoreReward&&u.showGoodCoupon(o.amount),null!=o.voiceMessage&&s.cashSwitch&&j._playAudio(),o.popupMessage&&_(o),o.lightMessage&&processLightMessage(e.msg),o.dynamicMessage&&("productDetail"!=s.toState&&"homePage"!=s.toState||($(".mess-tip").html(e.msg),$(".mess-tip").css("display","block"),setTimeout(function(){$(".mess-tip").css("display","none")},3e3)))))},window.processMessageQueue=function(){for(x(n.getUser().mid);;){var e=G.pop();if(!e)break;processMessage(e)}},window.processLightMessage=function(e){s.isLevelUp?V.unshift(e):u.goldIncrease(e)};var G=[],V=[];s.$on("$stateChangeSuccess",function(i,r,c,d,p){if(s.fromState=d.name,s.toState=r.name,s.xnFromState=d,s.xnToState=r,s.xnFromParams=p,s.xnToParams=c,A.GetUserInfo(r.name,d.name,c),"advertisement"!=s.fromState&&"shopApplySuccess"!=s.fromState||processMessageQueue(),n.getUser().mid&&(gio_userId=n.getUser().mid,gio_userRole="1"==h.getRole()?1:0,window.gio&&(gio("setUserId",gio_userId),gio("people.set",{userRole:gio_userRole+""}))),("RegisterForStoreLogin"==s.fromState||"registerForStore"==s.fromState)&&"login"==s.toState){s.userCount="",s.password="";void 0==n.getUser().sessionValue?(n.clearUser(),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId","")):e.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,i){e.success&&(n.clearUser(),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId",""))})}if(!("login"!=s.fromState&&"RegisterForStoreLogin"!=s.fromState&&"register"!=s.fromState||"homePage"!=s.toState&&"personnalCenter"!=s.toState&&"cart"!=s.toState&&"productDetail"!=s.toState&&"messageCenter"!=s.toState&&"topic"!=s.toState&&"circlePage"!=s.toState&&"noteDetails"!=s.toState&&"allcircle"!=s.toState&&"personalHomePageHe "!=s.toState&&"newres"!=s.toState&&"crowd_funding_details"!=s.toState&&"getCouponsList"!=s.toState)){var m,f;m=S.get("OLDTIMEONE"),f=S.get("loginMemberId"),s.nowTime=(new Date).getDate(),h.checkOpenStore(s.loginMemberId).success(function(i,r,c,d){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){I.get(w.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),i.data?(s.isBuyer=1,h.setRole(s.isBuyer),s.loginIsAccord=!1,s.loginIsAuthentication=!1,o.isWdHost().success(function(o){o.success?(s.o2oMessage=o.message,1==o.data.isHost&&(1==o.data.o2o?s.myPopups=g.show({template:s.o2oMessage,buttons:[{text:"退出",onTap:function(){s.userCount="",s.password="",void 0==n.getUser().sessionValue?(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId","")):e.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,i){e.success&&(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId",""))})}}]}):null==o.data.o2o?s.loginIsAuthentication=!1:t.doInit().success(function(e){e.success&&(e.data.isAuth?(s.loginIsAccord=!1,s.loginIsAuthentication=!1,n.isUserLogin()&&l(function(){u.showToast("登录成功，请继续您的旅程...")},800)):(s.isCloseBtn=e.data.forceAuthFlag,s.isCloseBtn?s.loginIsAuthentication=!0:m==s.nowTime&&s.loginMemberId==f?(s.loginIsAccord=!1,s.loginIsAuthentication=!1):(S.set("OLDTIMEONE",s.nowTime),S.set("loginMemberId",s.loginMemberId),n.isUserLogin()&&(s.loginIsAccord=!1,s.loginIsAuthentication=!0))))}))):u.showToast("获取数据信息失败！")})):(s.isBuyer=0,h.setRole(s.isBuyer),m==s.nowTime&&s.loginMemberId==f?(s.loginIsAccord=!1,s.loginIsAuthentication=!1):(S.set("OLDTIMEONE",s.nowTime),S.set("loginMemberId",s.loginMemberId),n.isUserLogin()&&(s.loginIsAuthentication=!1,window.cordova&&(s.loginIsAccord=!0),s.loginIsAccord=!1)))}).error(function(e){u.showToast("网络连接失败！")})}});var j=new Cash;!function(){var e=function(e,t){return processMessage(e),!0};s.token=null,T.initWebSocket(e)}(),s.$on("REQUIRE_LOGIN",function(){r.get("REQUIRE_LOGIN_SHOW")||(r.set("REQUIRE_LOGIN_SHOW",!0),u.showConfirm("提示","尚未登录，是否去登录？",function(e){e?a.go("login"):n.clearUser(),r.set("REQUIRE_LOGIN_SHOW",!1)},"去登录"))});var z=0;if(s.$on("LOADING:SHOW",function(){if(z++,!s.isLoadShowing){var e={template:'<div style="width:35px;height:35px;background:#666666;border-radius:5px;"><img src="{{imgBaseURL}}img/ic_refresh_02.gif" style="width: 35px;height:35px;"/></div>',duration:7e3};d.show(e)}s.isLoadShowing=!0}),s.$on("LOADING:HIDE",function(){--z<=0&&(s.isLoadShowing=!1,d.hide())}),o.isWdHost().success(function(e){s.isWdHost=e.data.isHost}),v.getAdImage().success(function(e){if(e.data[0]&&e.data[0].image){S.get("bannerId")!=e.data[0].bannerId&&(S.set("openCount",0),S.set("hasAD","noAD"));var t=e.data[0].image;S.set("hasAD",t),S.set("bannerId",e.data[0].bannerId)}else S.set("hasAD","noAD")}).error(function(e){S.set("hasAD","noAD")}),window._czc&&_czc.push(["_setAccount","1259430011"]),s.$on("$stateChangeSuccess",function(e,t,o,i,s){var n=p.$$absUrl.substring(location.origin.length);window._czc&&_czc.push(["_trackPageview",n]),window.doGetData&&doGetData()}),window.sgOnNotificationReceived=function(e){},n.isUserLogin()){var W=n.getUser().mid;h.checkOpenStore(W).success(function(i,r,c,l){i.data?(s.isBuyer=1,h.setRole(s.isBuyer),o.isWdHost().success(function(o){o.success?(s.o2oMessage=o.message,1==o.data.isHost&&(1==o.data.o2o?s.myPopup=g.show({template:s.o2oMessage,buttons:[{text:"退出",onTap:function(){s.userCount="",s.password="",void 0==n.getUser().sessionValue?(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId","")):e.unloadAccount(n.getUser().token,n.getUser().sessionValue,"2e8352919709910328ec6b6b682a74f3").success(function(e,t,o,i){e.success&&(n.clearUser(),a.go("login"),h.setRole(void 0),window.localStorage.setItem("isLogin",n.isUserLogin()),S.set("storeId",""))})}}]}):null==o.data.o2o?s.loginIsAuthentication=!1:t.doInit().success(function(e){e.success&&(e.data.isAuth?(s.loginIsAccord=!1,s.loginIsAuthentication=!1):(s.isCloseBtn=e.data.forceAuthFlag,s.loginIsAccord=!1,s.isCloseBtn&&(s.loginIsAuthentication=!0)))}))):u.showToast("获取数据信息失败！")})):(s.isBuyer=0,h.setRole(s.isBuyer))}).error(function(e){u.showToast("网络连接失败！")})}i.ready(function(){function e(e){l(function(){s.keyboardHeight={bottom:e.keyboardHeight+"px"};var t=e.keyboardHeight+25;s.contentMarginBottom={"margin-bottom":t+"px"}},100)}function t(e){l(function(){s.keyboardHeight={bottom:0},s.contentMarginBottom={"margin-bottom":0}},100)}function o(e){s.globalConstant.lon=e.position.getLng(),s.globalConstant.lat=e.position.getLat(),s.globalConstant.positionStatus=!0,f.addAddressInfo()}function i(e){s.globalConstant.positionStatus=!1,f.addAddressInfo()}navigator.splashscreen&&navigator.splashscreen.hide(),L();var n=w.getUrl("DEVICE_INFO"),r=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";if(window.UmengPush&&(window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken([],function(e){I.get(n+"?device_token="+e+"&device_type="+r)}),window.UmengPush.onReceiveMessage))try{window.UmengPush.onReceiveMessage(function(e){window.UmengPush.onReceiveMessage(arguments.callee,null),e&&y.getGameId(function(t){a.go("vip",{gameId:t,msg:e})})},null)}catch(e){}if(s.hasWechat=!1,window.wechatPay&&window.wechatPay.checkAppInstalled&&window.wechatPay.checkAppInstalled(function(e){s.hasWechat=!!e}),s.hasQQ=!0,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.cordova&&window.cordova.InAppBrowser&&(window.open=window.cordova.InAppBrowser.open),s.isIOS=!!window.cordova&&-1!=ionic.Platform.platform().indexOf("ios"),s.isApp=!!window.cordova||void 0,s.screenThreeWidth={height:(window.screen.width-50)/3+10+"px"},s.screenListThreeWidth={height:(window.screen.width-20)/3+"px"},-1!=ionic.Platform.platform().indexOf("ios")?(window.addEventListener("native.keyboardshow",e),window.addEventListener("native.keyboardhide",t)):l(function(){s.keyboardHeight={bottom:0}},100),!window.cordova){var c=navigator.userAgent,d=c.indexOf("Android")>-1||c.indexOf("Adr")>-1,u=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);s.downAppUrl=u?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":d?"http://app.qq.com/#id=detail&appid=1104761357":""}s.toDownLoad=function(){var e=s.isIOS?s.globalConstant.iosDownLoadUrl:s.globalConstant.androidDownLoadUrl;window.cordova?cordova.InAppBrowser.open(e,"_system"):window.open(e,"_system")},ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(e){s.globalConstant.lat=e.latitude,s.globalConstant.lon=e.longitude,f.addAddressInfo()},function(e){"12"==e.errorCode&&g.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">打开“定位服务”来允许“顺逛”确定您的位置</div><div style="color: #000;font-size: 12px;">顺逛将获取您的位置，为您提供更精准的服务</div>'}),f.addAddressInfo()}):(mapObj=new AMap.Map(""),mapObj.plugin("AMap.Geolocation",function(){var e=new AMap.Geolocation;e.getCurrentPosition(),AMap.event.addListener(e,"complete",o),AMap.event.addListener(e,"error",i)}))}),i.registerBackButtonAction(function(e){if("advertisement"==s.fromState)a.go("homePage");else if("/paymentxyz"==p.path().substring(0,11)){var t=c.viewHistory().backView;"orderManage"==t.stateName?c.goBack(-1):c.goBack(-2)}else if("orderManage"==c.currentStateName())c.backView()?"batchDeleteOrder"==c.viewHistory().backView.stateName?c.goBack(-2):"afterOrderSubmit"==c.backView().stateName?c.goBack(-3):"ccbPay"==c.backView().stateName||"paymentxyz"==c.backView().stateName||"payResultSuccess"==c.viewHistory().backView.stateName||"payResultFailure"==c.viewHistory().backView.stateName?(h.getRole(),a.go("homePage"),c.clearCache()):c.goBack(-1):(a.go("homePage"),c.clearCache());else if("ccbPay"==c.currentStateName())a.go("orderManage");else if("homePage"==c.currentStateName()||"guidePage"==c.currentStateName()||"directPurchase"==c.currentStateName())k();else if("homePage"==c.currentStateName()||"cart"==c.currentStateName()||"personalCenter"==c.currentStateName()||"topic.qhot"==c.currentStateName()||"branchType"==c.currentStateName())a.go("homePage"),c.clearCache();else if("payResultSuccess"==c.currentStateName()||"payResultFailure"==c.currentStateName())a.go("orderManage");else if("shopRevenue"==c.currentStateName()){if(!c.backView()||"mentionCenter"==c.viewHistory().backView.stateName)return void a.go("homePage");c.backView()&&c.backView().url.indexOf("login")>0?c.goBack(-2):c.goBack()}else if("bankCard"==c.currentStateName())null==c.viewHistory().backView?a.go("personnalCenter"):"shopRevenue"==c.viewHistory().backView.stateName||"paymentxyz"==c.viewHistory().backView.stateName?c.goBack():a.go("personnalCenter");else if("criticalSuccess"==c.currentStateName())c.goBack(-2);else if("bankCardDetail"==c.currentStateName())a.go("bankCard");else if("noteDetails"==c.currentStateName())if(s.globalConstant.showvideo){s.$apply(function(){s.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),i=0;i<o.length;i++)o[i].pause();$(".bof").css("display","block")}else s.nextPageBefore="noteDetails",c.goBack();else if("classNoteDetails"==c.currentStateName())s.nextPageBefore="classNoteDetails",c.goBack();else if("publishCircle"==c.currentStateName()||"publishEdit"==c.currentStateName())if(s.backgo="publish",s.globalConstant.showvideo){s.$apply(function(){s.globalConstant.showvideo=!1});for(var o=document.getElementsByTagName("video"),i=0;i<o.length;i++)o[i].pause();$(".pcbf").css("display","block"),$(".pebf").css("display","block")}else c.goBack();else"letterGroupFriend"==c.currentStateName()?(s.nextPageBefore="letterGroupFriend",c.goBack()):"letterSend"==c.currentStateName()?(s.nextPageBefore="letterSend",c.goBack()):"privateLetter"==c.currentStateName()?(s.nextPageBefore="privateLetter",c.goBack()):c.goBack()},101),s.$on("$stateChangeStart",function(e,t,i,c,l){if(("homePage"==t.name||"productDetail"==t.name)&&-1!=window.location.href.indexOf("_aPlatform")&&-1!=window.location.href.indexOf("_aToken")){var d=window.location.href.split("?")[1],u=d.split("&")[0].split("=")[1],p=d.split("&")[1].split("=")[1];window.localStorage._aToken=u,window.localStorage._aPlatform=p,3==p&&o.isAuthoMid(u)}a.get(t.name).requiredLogin&&!n.isUserLogin()&&(e.preventDefault(),n.clearUser(),r.set("toState",t),r.set("toParams",i),a.go("login")),s.$on("userIntercepted",function(e){n.clearUser(),a.go("login")}),(""==c.name&&"homePage"==t.name||"login"==c.name&&"homePage"==t.name||"advertisement"==c.name&&"homePage"==t.name||"guidePage"==c.name&&"homePage"==t.name)&&I.get(w.getGameUrl("IS_KAIMENHONG_AVAILABLE")).success(function(e){!0===e&&a.go("bannerTheme",{bannerId:w.getCPUrl("KMH_ID")})})})}]),APP.service("UrlService",[function(){var e=[{SERVER_DATA:"http://m.ehaier.com/v3/",SERVER_DATA_GAME:"http://m.ehaier.com/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://m.ehaier.com/",SHARELINKHEADER:"http://m.ehaier.com/www/index.html#/",SERVER_DATA_V2:"http://m.ehaier.com/v2/",ZC_SERVER_DATA:"http://m.ehaier.com/",CCB_SERVER_DATA:"http://pay.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://message.ehaier.com:8080/",SEARCH_SERVER_DATA:"http://s.ehaier.com/v3/",ITEM_SERVER_DATA:"http://detail.ehaier.com/v3/",COOPERATE_URL:"OFFICIAL_",PAY_CENTER:"http://pay.ehaier.com/"},{SERVER_DATA:"http://mobiletest.ehaier.com:20306/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:20306/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:20306/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:20306/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:20306/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:20306/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:20306/v3/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:20306/v3/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://mobiletest.ehaier.com:38080/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38080/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38080/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38080/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38080/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38080/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38080/v3/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38080/v3/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/"},{SERVER_DATA:"http://mobiletest.ehaier.com:38081/v3/",SERVER_DATA_GAME:"http://mobiletest.ehaier.com:38081/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://mobiletest.ehaier.com:38081/mstatic",SHARELINKHEADER:"http://mobiletest.ehaier.com:38081/www/index.html#/",SERVER_DATA_V2:"http://mobiletest.ehaier.com:38081/v2/",ZC_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",CCB_SERVER_DATA:"http://mobiletest.ehaier.com:38081/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://stest.ehaier.com:38081/v3/",ITEM_SERVER_DATA:"http://detailtest.ehaier.com:38081/v3/",COOPERATE_URL:"TEST_",PAY_CENTER:"http://mobiletest.ehaier.com:58093/"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://mdev.ehaier.com:81/v4/",
AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http:/mdev.ehaier.com:81/mstatic",SHARELINKHEADER:"http:/mdev.ehaier.com:81/www/index.html#/",SERVER_DATA_V2:"http:/mdev.ehaier.com:81/v2/",ZC_SERVER_DATA:"http://mdev.ehaier.com:81/",CCB_SERVER_DATA:"http://mdev.ehaier.com:81/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://m.pre.ehaier.com/v3/",SERVER_DATA_GAME:"http://m.pre.ehaier.com/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://m.pre.ehaier.com/mstatic",SHARELINKHEADER:"http://m.pre.ehaier.com/www/index.html#/",SERVER_DATA_V2:"http://m.pre.ehaier.com/v2/",ZC_SERVER_DATA:"http://m.pre.ehaier.com/",CCB_SERVER_DATA:"http://m.pre.ehaier.com/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/",SEARCH_SERVER_DATA:"http://s.pre.ehaier.com/v3/",ITEM_SERVER_DATA:"http://detail.pre.ehaier.com/v3/",COOPERATE_URL:"TEST_"},{SERVER_DATA:"http://mdev.ehaier.com:81/v3/",SERVER_DATA_GAME:"http://localhost:8100/v4/",AMAP_SERVER:"http://restapi.amap.com/v3/geocode/regeo",SHAREPICHEADER:"http://localhost:8100/mstatic",SHARELINKHEADER:"http://localhost:8100/www/index.html#/",SERVER_DATA_V2:"http://mdev.ehaier.com:81/v2/",SEARCH_SERVER_DATA:"http://sdev.ehaier.com:81/v3/",ITEM_SERVER_DATA:"http://detaildev.ehaier.com:81/v3/",SERVER_MQ_WEBSOCKET:"ws://mobiletest.ehaier.com:15674/"}],t=e[2].SERVER_DATA,o=e[2].ZC_SERVER_DATA,i=e[2].SERVER_DATA_V2,s=e[2].SERVER_MQ_WEBSOCKET,n=e[2].ZC_SERVER_DATA,a=e[2].CCB_SERVER_DATA,r=e[2].COOPERATE_URL,c=e[2].PAY_CENTER,l={GETTUIGUANGMA:"mstore/sg/store/wdSpreading.html",CHANGEDATA_INIT:"changeData.json",KUNBIND_INIT:"kjt/sg/kjtAccountUnbind.html",KBIND_INIT:"kjt/sg/kjtAccountBind.html",KBIND_ACTIVATION:"kjt/sg/kjtAccountActivation.html",KBIND_REALNAME:"kjt/sg/kjtAccountAuthRealName.html",SETDEFAULT_INIT:"h5/sg/shippingAddress/updateDefaultAddr.html",ADDRESS_INIT:"h5/sg/shippingAddress/toAddrManager.html",COLLECTION_LIST:"mstore/sg/collections.html",DELETECOLLECTION_INIT:"h5/sg/item/cancelProductCollection.json",COLLECTION_INIT:"h5/sg/item/productCollection.json",MESSAGECENTER_INIT:"mstore/sg/msgCenter.html",DETAILMESSAGECENTER_INIT:"detailMessageCenterfalseData.json",EASYCONNECT_INIT:"kjt/sg/withdrawSetting.html",EASYCONNECTRESULT_INIT:"mstore/sg/kjtInfo.html",EASYCONNECTACCOUNT_INIT:"mstore/sg/kjtInfo.html",GETCASH_INIT:"mstore/sg/local/myApply.html",UNLOAD_INIT:"platform/web/member/logout.json",UPDATEMEMBER_INIT:"platform/web/member/updateMember.json",UPDATE_EMAIL:"platform/web/member/updateEmail.json",UPDATEPASSWORD_INIT:"platform/web/member/updatePassword.json",DETELEADDR_INIT:"h5/sg/shippingAddress/delete/",CHANGEADDR_INIT:"h5/sg/shippingAddress/update.html",ADDADDRESS_INIT:"h5/sg/shippingAddress/addSAddr.html",CHECKSHOPNAME_INIT:"mstore/sg/checkSensitiveWords.html",CHANGESHOPNAME_INIT:"mstore/sg/store/changeStoreName.html",CHECKHRCODE_INIT:"mstore/sg/checkHrCode.html",EDITSHOP_INIT:"mstore/sg/wdStoreInfoEdit.html",SHOPINFO_INIT:"mstore/sg/storeInfo.html",SHOPKIND_INIT:"mstore/sg/getMemberType.html",UPLOAD_IMAGE:"platform/web/app/uploadImage",SELECT_INIT:"mstore/sg/wdMarketData.html",FAXIAN_INIT:"mstore/loadFindProductsNew.html",ASYNC_ACCESS_PRICE:"mstore/getPriceByProductList.html",CHANGESUCCESS_INIT:"mstore/sg/addMarketTypeToCookie.html",CHANGECHOOSESTATEDUI_INIT:"mstore/sg/removeProductShelvesSubmit.html",CHANGECHOOSESTATEJIA_INIT:"mstore/sg/updateProductShelvesSubmit.html",SEARCHGOODS_INIT:"mstore/sg/wdMarketSearchItem.html",ADDCART_INIT:"h5/cart/add.json",LOADMOREPRODUCTS_INIT:"mstore/sg/commonLoadItem.html",ADDADDRESSSELECTION_INIT:"mstore/sg/addPositionToCookie.json",GET_POSITION_FROM_COOLIE:"mstore/sg/getPositionFromCookie.json",CHOOSE_ADDR:"h5/sg/shippingAddress/chooseAddr.html",GET_ADDRESS_ID:"mstore/sg/getAddressId.html",GET_SELECTION_IMAGE:"mstore/sg/wdMarket.html",CHECK_NOTICE:"h5/sg/checkOnly.html",ARRIVE_NOTICE:"h5/sg/insertNotice.html",START_NOTICE:"h5/sg/insertActivityNotice.html",MESSAGE_CLASSIFY:"mstore/sg/messageCenter.html",CUSTOMPAGE_MODEL:"activity/page/getCustomPageDetail.json",LOCAL_SPECIALTY:"sg/cms/chara/charaIndex.json",NEW_AND_LIMIT:"sg/cms/flashSales/chara.json",LOCAL_SPECIALTY_LIKE_TYPE:"sg/cms/chara/charaCate.json",LOCAL_SPECIALTY_LIKE_DATA:"sg/cms/chara/charaProducts.json",ALL_SPECIALTY:"sg/cms/chara/charaRegions.json",SPECIALTY_CART_NUM:"h5/cart/num.json",SPECIALY_VENUE_HOME:"/sg/cms/chara/charaPage.json",SPECIALY_PRODUCTS_LIST:"mstore/charaLoadItem.json",STORE_COLLECTIONLIST:"mstore/sg/storeCollection.json",SECONDLEVEL_PRODUCTLIST:"mstore/charaLoadItem.json",SECONDLEVEL_SECTYPELIST:"sg/cms/chara/cityChara.json",ADD_COLLECT:"v3/mstore/sg/collectStore.json",CANCEL_COLLECT:"v3/mstore/sg/collectCancel.json",LOGIN:"platform/web/member/login.json",CAPTCHALOGIN:"platform/web/member/captchaLogin.json",LOGIN_CHECK:"platform/web/widget/login.html",GET_CAPTCHA:"platform/web/member/captcha.json",GET_LOGIN_CAPTCHA:"platform/web/member/getImgCaptchafromUC.html",GET_IMG_CAPTCHA:"platform/web/member/register/getImgCaptcha.html",REGISTER_USER_INFO:"platform/web/member/register.json",GET_PASSWORD_CAPTCHA:"platform/web/member/captchaForFindPaw.json",CAPTCHA_CHECK:"platform/web/member/verifyCaptcha.json",REQUEST_PASSWORD:"platform/web/member/resetPassword.json",OTHER_LOGIN:"platform/web/member/getMember.json",STATISTICS:"mstore/sg/statistics/portal.json",SECOND_MANAGE:"mstore/sg/store/subMembers.html",THIRD_MANAGE:"mstore/sg/store/grandMembers.html",ORDER_AMOUNT:"v3/h5/order/getOrderCount.json",ORDER_MANAGE:"v3/h5/order/getOrderList.json",CANCEL_ORDER:"h5/sg/order/cancelOrder.html",SUBMIT_APPLY_REFUND:"h5/sg/order/submitOrderRepair.html",FEEDBACK:"h5/sg/content/recommend.html",FEEDBACK_PLUS:"h5/sg/content/recommendNew.html",CHECK_REFUND:"h5/sg/order/checkOrderRefund.html",CHECK_TEXT:"mstore/sg/checkSensitiveWords.html",SHOP_APPLY:"mstore/sg/wdApplySubmit.html",REFUND_DETAIL:"h5/sg/order/getOrderRepairsInfo.html",ORDER_TRACKING:"h5/sg/order/orderTrack.html",APPLY_REFUND:"h5/sg/order/orderRefund.html",COMMON_UNION:"mstore/sg/getMemberType.html",ORDER_DETAIL:"h5/order/getOrderDetail.json",THIRD_PARTY_LOGINS:"platform/web/member/thirdLogin.json",CUSTOMER_SERVE:"h5/sg/common/customService.html",SHUNGUANG_HELP:"mstore/sg/shunguangHelp.html",HELP_DETAIL:"mstore/sg/helpDetail.html",WECHAT_PAY:"h5/pay/wxpay.html",PAY_ORDER:"",GET_ALIPAY_INFO:"h5/sg/orderSign.html",UPLOAD_ASSESS_IMG:"h5/sg/upLoadCommentPicture.html",CHECK_ASSESS_TEXT:"h5/sg/comment/checkSensitiveWords.json",UPLOAD_ASSESS_IMG_NEW:"h5/sg/comment/upLoadCommentPicture.json",EVALUCTION_NEW:"h5/sg/comment/commentPage.json",SUBMIT_EVALUCTION_NEW:"h5/sg/comment/submitComment.json",CRITICALSUC:"h5/sg/comment/commentSuccessPage.json",GET_IMG_CAPTCHA_NEW:"h5/sg/comment/getImgCaptcha.html",FAST_LOGIN_CAPTCHA_COMMENT:"h5/sg/comment/userCommentSendSmsCode.json",USER_COMMENT_PAGE:"h5/sg/comment/userCommentPage.json",SUBMIT_BUYER_COMMENT:"h5/sg/comment/submitUserComment.json",PRODUCT_RATED_ASSESS_LIST:"h5/sg/getCommentsByCondition.json",PRODUCT_ASSESS_MARK:"h5/sg//getProductImpressions.json",LOOK_ASSESS_INGO:"h5/sg/comment/getComment.json",ADD_ASSESS_SUBMIT:"h5/sg/comment/submitExperience.json",WINNING_LIST:"mstore/sg/game/winnerList.json",LOTTERY:"mstore/sg/game/luckDraw.json",GAME_INFORMATION:"mstore/sg/game/gameApp.json",GAME_HELLP:"mstore/sg/game/help/powerShare.json",GAME_HELLP_INIT:"mstore/sg/game/help/helpRecord.json",GAME_HAVE_PRIZE:"mstore/sg/game/addAddress.json",IS_KAIMENHONG_AVAILABLE:"mstore/sg/game/needRedirect.json",STORE_INFO:"platform/web/app/app_store_info",APP_HOME_DATA:"platform/web/app/app_home_data",GOODS_LIST:"mstore/sg/wdComManageDataInit.html",DELETE_GOODS:"mstore/sg/removeProductShelvesSubmit.html",UPDATE_GOODS:"mstore/sg/updateProductShelvesSubmit.html",UPDATE_GOODS_BATCH:"mstore/sg/updateStoreProductsBatch.html",DELETE_GOODS_BATCH:"mstore/sg/deleteStoreProductsBatch.html",SEARCH_GOODS:"mstore/sg/wdCommonSearch.html",REVENUE_INFO:"mstore/sg/local/wdRevenue.json",REVENUE_LIST:"mstore/sg/local/myRevenueList.json",MICRO_SCHOOL:"mstore/sg/microSchool.json",PRODUCTS_LIST:"mstore/sg/data/products.html",ACTIVITY_PRODUCTS_LIST:"mstore/sg/data/activityProducts.html",GET_SHOP_TEMPLATES:"mstore/sg/store/wdStyleChoice.html",SET_SHOP_TEMPLATES:"mstore/sg/store/changeStoreStyle.json",GET_SHOP_COVER:"mstore/sg/store/wdShopCover.html",SET_SHOP_COVER:"mstore/sg/store/changeShopCover.json",MY_STORE:"mstore/sg/manage.html",MY_STORE_NEW:"mstore/sg/manage.json",MY_STORE_FILTER_LIST:"myStoreFilter.json",GET_PRODUCTS_LIST:"mstore/sg/commonLoadItemNew.html",GET_FILTER_DATA:"mstore/sg/wdMarketFiltrate.html",GET_ACCOUNT_STATE:"kjt/sg/wdWithdraw.html",GET_BANNER_THEME:"mstore/sg/activity/toActivityPage.html",GET_BANNER_DAILY:"mstore/sg/activity/dailyActivityProducts.json",GET_O2O_NAME:"h5/getO2OStoreInfo.html",IS_HAS_STORE:"platform/web/app/is_has_store",GET_STORE_INFO:"platform/web/app/app_store_info_new",GET_SELECTION_PRODUCTS:"mstore/sg/loadSelectProducts.html",GET_AD_IMAGE:"platform/web/app/app_navigate_banner",DELETE_ORDER:"h5/sg/order/deleteOrder.json",BATCH_DELETE_ORDER:"h5/sg/order/deleteAllOrders.json",GET_MERGE_IMAGE:"h5/sg/getMergeImage.html",CHECK_KJT_LOGIN:"kjt/checkLogin.html",GET_KJT_TOKEN:"kjt/genToken.html",GET_HAIRONGYI_ACTIVITYIFNO:"kjt/queryPromotionActivity.html",GET_PROMOTE_REWARD:"kjt/queryPromoteReward.html",GET_TOTAL_COMMISSION:"kjt/queryPromotionDailyReward.html",GET_REF_CODE:"kjt/queryPromoCode.html",GET_WALLET:"h5/sg/getBenefitMember.json",GET_WALLETDETAIL:"h5/sg/getBenefitDetails.json",GET_GETSGSTOREATTRIBUTE:"h5/sg/item/getSgStoreAttribute.json",GET_GETDETAILATTRIBUTE:"h5/sg/item/getDetailAttribute.json",GET_ISSHOWATTR:"h5/sg/item/isShowAttr.json",GET_CARTNUM:"h5/cart/getCartNum.json",HAS_BANK_LIST_NEW:"kjt/bank/getBankCardList.json",BANK_LIST_DETAIL_NEW:"kjt/bank/getCardDetail.json",BANK_DELETE_NEW:"kjt/bank/unBindCard.json",BANK_DELETE_CAPTCHA:"kjt/bank/getCaptchaForUnbind.json",BANK_HASBINGNUM_NEW:"kjt/bank/bankCardCount.json",SHOP_APPLY_SUCCESS:"mstore/sg/mechanism/openStoreRank.json",DATA_ANALYSIS_UPDATE:"mstore/sg/mechanism/findLastOrderProduct.json",DATA_ANALYSIS_DISTRIBUTION:"mstore/sg/mechanism/getSaleNumByCate.json",DATA_ANALYSIS_ACTIVITY:"mstore/sg/mechanism/getActionAnalysis.json",DATA_ANALYSIS_SALES:"mstore/sg/mechanism/getSaleNumByCity.json",GET_CDK_TOKEN:"h5/sg/cdk/getToken.json",GET_COUPONS_LIST:"mstore/sg/coupons/getCouponsByArea.html",NEW_GET_COUPONS_LIST:"activity/coupons/getCouponsCenter.html",NEW_GET_COUPONS_TYPE:"activity/coupons/getViewCouponCate.html",NEW_SHOP_COUPONS_LIST:"h5/sg/coupons/getCouponsByProductId.html",USE_COUPONS_LIST:"h5/sg/coupons/getProductsByCouponId.html",COUPONS_DETAIL_LIST:"h5/sg/coupons/getCouponDetail.html",PRODUCT_COUPONS_HAS:"activity/coupons/getHasCoupons.html",REMIND_COUPONS_LIST:"h5/sg/coupons/setRemind.html",GET_NEW_COUPONS:"activity/coupons/receiveCoupon.html",COUPONS_DONATION:"h5/sg/coupons/couponForTransferNew.html",COUPONS_GET_MENBERID:"mstore/sg/coupon/getMemberById.html",MY_COUPONS_LIST:"h5/sg/coupon/getCouponsByMemberId.html",MY_COUPONS_LIST_LATE:"h5/sg/coupon/getCouponsByMemberIdOneDay.html",SELECT_GOODS_COUPONS:"h5/sg/coupons/selectCouponNew.html",SELECT_GOODS_COUPONS0:"h5/coupons/selectCouponsForTailOrdersIncludeUnable.html",REDIRECT_URL:"platform/web/member/wxWebLogin.json",CHECK_LOGIN:"platform/web/member/checkLogin.json",STATE_ID:"platform/web/member/saveState.json",SELECT_GOODS_COUPONS1:"h5/sg/order/submitTailCoupon.json",SELECT_PLATFORM_COUPONS:"h5/sg/coupons/selectCouponsForOrderIncludeUnable.html",SELECT_COUPONS:"h5/sg/coupons/selectedCouponNew.html",CARD_COUPONS_USED:"h5/sg/order/checkCardValidate.html","CARD_ CODE_CHECK":"h5/sg/order/checkCaptcha.html",GIFT_CARD_COUPONS_USED:"h5/sg/order/checkGiftCard.json",GIFT_CARD_COUPONS_CANCLE:"h5/sg/order/cancleGiftCard.json",PAY_WAY:"h5/sg/order/toChooseDeliveryWay.html",SUBMIT_PAY_WAY:"h5/sg/order/submitPayway.html",SUBMIT_DELIVE_WAY:"h5/sg/order/submitDeliveryway.html",CART_LIST:"h5/cart/list.html",GOODS_NUMBER:"h5/cart/update.json",DELETE:"h5/cart/delect.json",CONFIRM_ORDER:"h5/order/pageInfo.json",CHECK_PAGE_INFO:"h5/sg/order/checkPageInfo.html",ZC_ORDER_CONFIRM:"activity/zhongchou/order/submitOrder",CONFIRM_ORDER_INFO:"h5/sg/order/orderInfo.html",LOCATION_CHANGE:"h5/item/checkStock.json",PAY_CHECK_STOCK:"h5/sg/item/checkStockForQuickPay.json",PRODUCTDETAIL_LODEDATA:"h5/purchase/",EVALUATE_INFO:"h5/evaluation/",POST_STORE_INFO:"h5/sg/shop/info/",PRODUCTDETAIL_PROMOS:"h5/sg/purchase/promos.html",ORDER_SUBMIT:"h5/sg/order/orderSubmitBenefitMixture.html",GET_COUPONS_DETAIL:"h5/sg/coupon/toListItem.html",RECEIVE_COUPONS:"mstore/sg/coupons/getCouponForMember.html",ORDER_INVOICE:"h5/sg/order/toInvoice.html",ORDER_INVOICE_LIST:"h5/sg/order/getMemberInvoicesListsByMemberId.html",SUBMIT_INVOICE:"h5/sg/order/submitInvoice.html",SUBMIT_INVOICE_SECKILL:"pmt/sg/order/submitInvoice.html",ORDERDETAIL_SPECIFICATIONS:"h5/sg/purchase/specifications.html",GET_CONFIRM_RECEIVE_LIST:"h5/sg/order/confirmList.html",CONFIRM_RECEIVE:"h5/sg/order/confirmOrderProduct.html",GAME_INFO:"mstore/sg/game/oldGameApp.json",GAME_ADD_ADRESS:"mstore/sg/game/addAddress.html",SECKILL_LIST:"pmt/sg/seckill/getSeckillAllRedis.html",SECKILL_SERVICE_TIME:"pmt/sg/getServiceTime.html",CHECK_STOCK:"pmt/sg/item/checkStock.json",SECKILLDETAIL:"h5/sg/purchase/",SECKILLBUY:"pmt/sg/order/pageInfo.html",SECKILL_CONFIRM_ORDER_INFO:"pmt/sg/order/orderSubmit.html",UNRED_MESSAGE:"platform/web/member/unread_message.json",MSG_CENTER:"mstore/sg/msgCenter.html",READALL:"mstore/sg/readAllMessage.json",CHECKREAD:"mstore/sg/checkRead.json",PAY_KJT:"h5/pay/kjtpay/request.json",APP_VERSION:"platform/web/app/appVersion.json",BIND_MOBILE:"platform/web/member/bindMobile.json",WD_APPLY:"mstore/sg/wdApply.html",GETREGIONBYID:"mstore/sg/getRegionByParentId.html",GET_REGION_BY_ID_TYPE:"mstore/sg/getRegionByPIdAndReType.html",ORDER_200PAYCHECK:"h5/sg/orderPayCheckNew.html",PRODUCT_RATED_TOASSESS_LIST:"h5/sg/toAssessList.html",TEST_KQT_ID:200000055141,OFFICIAL_KQT_ID:200000030019,TEST_KMH_ID:758,OFFICIAL_KMH_ID:2668,TEST_WXSQ_ID:"wxb9b3b8793f9c3d7a",OFFICIAL_WXSQ_ID:"wxb03a523baf487993",TEST_WXSQ_URL:"http://mobiletest.ehaier.com/v3/",OFFICIAL_WXSQ_URL:"http://m.ehaier.com/v3/",TEST_KQT_URL:"https://zmgs.kjtpay.com/mgs/common/page.htm",OFFICIAL_KQT_URL:"https://mgs.kjtpay.com/mgs/common/page.htm",TEST_TTQ_URL:"https://zzhuanle-h5.kjtpay.com/shunguang/myttj",OFFICIAL_TTQ_URL:"https://m-ally.hairongyi.com/shunguang/myttj",TEST_SZD_URL:"http://203.187.186.136:8130/haiercms/waterQuality",OFFICIAL_SZD_URL:"http://uhome.haier.net:8280/watercms/waterQuality",TEST_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5test/",OFFICIAL_HRY_URL:"http://cdn09.ehaier.com/shunguang/H5/",TEST_BIG_DATA:"http://jxh.ehaier.com:1188/jslog",OFFICIAL_BIG_DATA:"http://crmxjz.ehaier.com:1188/jslog",TEST_CDK_URL:"http://map.mankaa.com/",OFFICIAL_CDK_URL:"http://map.rrskx.com/",CCB_FENQI:"paycenter/pay/fenqi/cost.html",CCB_FENQI_W:"paycenter/pay/request.html",PAY_TYPE_LIST:"paycenter/pay/payTypeList",HB_COST:"paycenter/pay/hbfenqi/hbCost.html",HB_PAY_APP:"v2/h5/pay/app/Hb/request.json",HB_PAY_H5:"v2/h5/pay/Hb/alipay/request.html",JINBI_JILU:"h5/sg/member/appLoginRecord.json",SHARESUCCESS:"h5/sg/member/getShareSuccess.json",SHUNGUANG_VIP:"mstore/sg/credit/getUserCreditInfo.html",CREDIT_DETAIL:"mstore/sg/credit/findCreditDetail.html",DEVICE_INFO:"platform/web/app/saveDeviceToken.json",ORDER_INFO:"mstore/sg/findOrderInfoByOrderId.json",DINGZHI_ZHONGCHUANGHUI:"mstore/sg/diy/login/request.html",FIND_GAME_ID:"mstore/sg/findLatestGame.json",MISSION_DETAIL:"mstore/sg/task/findTaskDetail.html",MISSION_SHARE:"mstore/sg/task/doTask.html",CONNECTION_INDEX:"mstore/sg/store/getRelationships.html",SPREAD_CONNECTION:"mstore/sg/store/getContacts.html",PARTNER_DETAIL:"mstore/sg/store/getRelationshipsDetial.html",REPORT_DETAIL:"mstore/sg/selfBrokerageReportDetail.html",REPORT_DETAIL_PLUS:"mstore/sg/brokerageSettlement.html",BATCH_DELETE_ADDRESS:"h5/sg/shippingAddress/deleteAddrIds.html",GET_QRCODE:"mstore/sg/task/generalQRCode.html",HOMEPAGE_TOP:"sg/cms/indexTop.json",HOMEPAGE_MIDDLE:"sg/cms/floor.json",HOMEPAGE_ISWDHOST:"sg/cms/isWdHost.json",HOMEPAGE_FALSHSALES:"sg/cms/flashSales/index.json",PERSONAL_CENTER:"v3/mstore/sg/myManage.json",FURNISH_TOP:"sg/cms/adornhome/topRecommendProducts.json",FURNISH_BOTTOM:"sg/cms/adornhome/lowRecommendProducts.json",SUPERMARKET_TOP:"sg/cms/supermarket/topRecommendProducts.json",SUPERMARKET_BOTTOM:"sg/cms/supermarket/lowRecommendProducts.json",MYAPPOINTMENT:"sg/cms/reserve/myReserve.json",FURNISH_BANNER:"sg/cms/adornhome/adornHomeBanner.json",SUPERMARKET_BANNER:"sg/cms/supermarket/supermarketBanner.json",ELECTRICALMALL_TOP:"sg/cms/electricalSecond.json",FAST_LOGIN_CAPTCHA:"platform/web/member/captchaForSmsLogin.json",FAST_LOGIN:"platform/web/member/smsLogin.json",ACTIVITY_ICON_TABS_NEW:"sg/cms/iconConfig.json",ACTIVITY_BG:"sg/cms/middleImageConfig.json",TOKEN_GET:"platform/web/member/queryAccessToken.json",TOKEN_LOGIN_GET:"platform/web/token/getToken.json",VIDEO_ADVERTISEMENT:"platform/web/app/getBannerMovie.html",ADORNHOME_CATES:"sg/cms/adornhome/productCates.json",SUPERMARKET_CATES:"sg/cms/supermarket/productCates.json",TO_ORDER_SUBMIT_SUCCESS:"h5/sg/order/toOrderSubmitSuccess.html",SHAER_TASK:"mstore/sg/task/findTaskList.html",SHAER_HISTORY_TASK:"mstore/sg/task/findHistoryTaskList.html",MEMER_COMPETE:"mstore/sg/credit/findStoreMemberRecord.html",HOT_WORDS:"mstore/sg/search/hotSearch.html",DEFAULTSEARCH_WORDS:"mstore/sg/search/defaultSearch.html",ASSOCIATIONAL_WORDS:"mstore/sg/search/suggestJson.html",GET_MY_COMMENT_LIST:"sgcommunity/story/getMyCommentList.ajax",GET_UCTIP_LIST:"sgcommunity/uctip/getucTipList.ajax",GET_USER_ISSUE_LIST:"sgcommunity/story/getUserStoryList.ajax",GET_USER_JOINTOPIC_LIST:"sgcommunity/getUserJoinTopicList.ajax",GET_USER_CREATETOPIC_LIST:"sgcommunity/getUserCreateTopicList.ajax",GET_USER_PRAISE_LIST:"sgcommunity/story/getUserPraiseStoryList.ajax",GET_USER_COLLECTION_LIST:"sgcommunity/Circle/getUserCllectionStoryList.ajax",CIRCLE_SIGNIN:"sgcommunity/sign.ajax",CIRCLE_SIGN_DATE:"sgcommunity/getSignCalendar.ajax",CIRCLE_SIGN_CHART:"sgcommunity/getRank.ajax",CIRCLE_REPLENISH_SIGN:"sgcommunity/replenishSign.ajax",GET_WECHAT_OPENID:"sgcommunity/Circle/getOpenId.ajax",GET_WECHAT_URL:"sgcommunity/Circle/getWeChatURL.ajax",USER_SIMPLE_INFO_ONE:"sgcommunity/user/userSimpleInfo1.ajax",USER_SIMPLE_INFO_TWO:"sgcommunity/user/userSimpleInfo2.ajax",USER_SIMPLE_INFO_THREE:"sgcommunity/user/userSimpleInfo3.ajax",GETUSERMESSAGECOUNT:"sgcommunity/user/getUserMessageCount.ajax",GETBANNERLIST:"sgcommunity/Circle/getBannerList.ajax",GETHOTTOPICLIST:"sgcommunity/Circle/getHotTopicList.ajax",GETHOTSTORYLIST:"sgcommunity/Circle/getHotStoryList.ajax",GETMYTOPICLIST:"sgcommunity/Circle/getMyTopicList.ajax",EXITTOPIC:"sgcommunity/schoolstory/exitTopic.ajax",GETMYFOLLOWINGSTORYLIST:"sgcommunity/Circle/getMyFreshNewsList.ajax",GETCOURSEINFO:"sgcommunity/Course/getCourseInfo.ajax",GETUPDATELIST:"sgcommunity/schoolstory/getschoolUpdateList.ajax",GETSTORYINFO:"sgcommunity/schoolstory/getStoryInfo.ajax",GETSTORYCOMMENT:"sgcommunity/schoolstory/getSchoolComment.ajax",SUBMITCOMMENT:"sgcommunity/schoolstory/submitComment.ajax",CLASS_DELETE_COMMENT:"sgcommunity/schoolstory/deleteSchoolCommentById.ajax",SCHOOLPRAISESTORY:"sgcommunity/schoolstory/schoolPraiseStory.ajax",SCHOOLCOLLECTION:"sgcommunity/schoolstory/schoolCollectionStory.ajax",SCHOOLCOMMENTPARISE:"sgcommunity/schoolCommentParise.ajax",SCHOOLCOMMENTPARISENUM:"sgcommunity/schoolstory/getCountForSchoolPraise.ajax ",GETTOPICLIST:"sgcommunity/schoolstory/getTopicList.ajax",GET_MY_STORY_LIST:"sgcommunity/story/getMyStoryList.ajax",MYCREATE_TOPIC:"sgcommunity/getMyCreateTopicList.ajax",MYJOINED_TOPIC:"sgcommunity/getMyJoinTopicList.ajax",GET_COLLECTION_STORY_LIST:"sgcommunity/Circle/getCllectionStoryList.ajax",GET_SCHOOL_COLLECTION_STORY_LIST:"sgcommunity/schoolstory/getCllectionStoryList.ajax",GET_LIKE_STORY_LIST:"sgcommunity/story/getLikeStoryList.ajax",SUBMITREPLY:"sgcoummunity/story/submitReply.ajax",FOLLOW:"sgcommunity/user/follow.ajax",GETMYFANS:"sgcoummunity/user/getMyFans.ajax",MY_FANS:"sgcommunity/user/getMyFans.ajax",INTERESTED:"sgcommunity/user/getMyInterested.ajax",MY_FOLLOWS:"sgcommunity/user/getMyFollows.ajax",RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicList.ajax",LAUNGCH_RECOMMEND_LIST:"sgcommunity/Circle/getRecommendTopicListFirstPage.ajax",JOIN_TOPIC:"sgcommunity/schoolstory/joinInTopic.ajax",PLATFORM_INFO:"sgcommunity/user/getPlatformInfo.ajax",SCHOOL_INFO:"sgcommunity/user/getSchoolInfo.ajax",OTHER_INFO:"sgcommunity/user/getOtherInfo.ajax",APPLY_TOPIC:"sgcommunity/schoolstory/entryCreateTopicAndTags.ajax",EXIST_APPLY_TOPIC:"sgcommunity/schoolstory/getEntryTopicStatus.ajax",REVIEW_APPLY_TOPIC:"sgcommunity/searchEntryTopicInfo.ajax",DELETE_APPLY_TOPIC_DRAFT:"sgcommunity/Circle/delCircleTopic.ajax",STORAGE_APPLY_DRAFT:"sgcommunity/schoolstory/entryDraftTopicAndTags.ajax",STORAGE_APPLY_REFUSE:"sgcommunity/schoolstory/UpdateTopicEntryForReback.ajax",TOPIC_TAGS:"sgcommunity/schoolstory/getStoryPraiseAndUnread.ajax",TOPIC_INFO:"sgcommunity/schoolstory/getTopicInfo.ajax",BY_CONDITION:"sgcommunity/Circle/getSensitiveByCondition.ajax",CIRCLE_STORY_INFO:"sgcommunity/Circle/getStoryInfo.ajax",UPDATE_STORY:"sgcommunity/schoolstory/updateStoryNew.ajax",LIST:"sgcommunity/schoolstory/getUpdateList.ajax",TOP_STORY:"sgcommunity/Circle/topStory.ajax",DELETESTORY:"sgcommunity/Circle/deleteStory.ajax",SUBMIT_STORY:"sgcommunity/schoolstory/insertStoryNew.ajax",IS_FOLLOWED:"sgcommunity/user/getIsFollowed.ajax",SELECT_TAGS_BY_TOPICID:"sgcommunity/schoolstory/selectTagsByTopicId.ajax",SHOP_INFO:"mstore/sg/manage.html",SHOP_INFO_LIST:"mstore/sg/commonLoadItem.html",SHOP_ADD_CART:"h5/sg/cart/add.json",HIS_SHARE:"sgcommunity/Circle/getShareList.ajax",GETLISTBYCONDITION:"sgcommunity/Circle/getListByCondition.ajax",GETUSERBYCONDITION:"sgcommunity/Circle/getUserByCondition.ajax",GETSTORYBYCONDITION:"sgcommunity/Circle/getStoryByCondition.ajax",GETTOPICBYCONDITION:"sgcommunity/Circle/getTopicByCondition.ajax",GETSTORYPRAISEANDUNREAD:"sgcommunity/schoolstory/getSchoolStoryPraiseAndUnread.ajax",ADDUSER:"sgcommunity/user/addUser.ajax",GETLISTBYCODE:"sgcommunity/Circle/getListByCode.ajax",SELECT_TAGNAME:"sgcommunity/schoolstory/selectTagsCountByTagName.ajax",PERFECT_INFORMATION:"mstore/sg/checkStoreParam.json",COMMON_COMMENT:"sgcommunity/schoolstory/getStoryComment.ajax",INSERT_COMMON_COMMENT:"sgcommunity/schoolstory/insertStoryComment.ajax",COMMENT_PRAISE:"sgcommunity/story/praiseStory.ajax",COLLECTION_TOPIC:"sgcommunity/Circle/cllectionStory.ajax",TOPIC_PRAISE:"sgcommunity/schoolstory/commentParise.ajax",NOTE_PERSON_TYPE:"sgcommunity/schoolstory/selectStory2.ajax",GET_STORY_PRAISE:"sgcommunity/Circle/getStoryPraiseAndUnread.ajax",COMMENT_STORY_PRAISE:"sgcommunity/schoolstory/getCommentPraise.ajax",DELETE_COMMON_COMMENT:"sgcommunity/schoolstory/deleteComment.ajax",SHARE:"sgcommunity/Circle/share.ajax",APPLY_LECTURER:"sgcommunity/user/applyTeacher.ajax",START_APPLY_LECTURER:"sgcommunity/user/startApplyTeacher.ajax ",ENTRYFORUM:"sgcommunity/Circle/entryForum.ajax",ENLARGE_CONTENT:"sgcommunity/getEntrycapacity.ajax",DISCUSSION_STATE:"sgcommunity/Circle/getDiscussionState.ajax",CONNECT_PROUCT:"sgcommunity/circle/getProductsDetailList.ajax",EXIT_TOPIC:"sgcommunity/schoolstory/exitTopic.ajax",CANCEL_TOP:"sgcommunity/cancelTopStory.ajax",ADD_USER:"sgcommunity/user/addUser.ajax",COURSE_INFO:"sgcommunity/notice/getNoticeCourseyByCourseId.ajax",TEACHED_COURSE:"sgcommunity/story/getTeachCourse.ajax",JOINED_COURSE:"sgcommunity/story/getJoinCourse.ajax",COURSE_ALL_MEMBER:"sgcommunity/notice/getCoursePersonByCourseId.ajax",COURSE_TEACH_LIST:"sgcommunity/notice/selectCourseForTeacher.ajax",MESSAGE_BOARD_LIST:"sgcommunity/schoolstory/getWordsListByCourseID.ajax",CLASSES_LIST:"sgcommunity/course/getCourseMaterials.ajax",CLASSES_TOPIC_LIST:"sgcommunity/schoolstory/getSchoolStoryListByCourse.ajax",GET_QUESTION_DETAILS:"sgcommunity/schoolstory/getAnswersByWordsId.ajax",QUESTION_ANSWER:"sgcommunity/schoolstory/insertWords.ajax",STUDENT_SHARE:"sgcommunity/course/getStudentsShare.ajax",TEST_LIST:"sgcommunity/Circle/startAnswerList.ajax",TEST_ESSENTIAL_INFORMATION:"sgcommunity/Circle/getCourseAnswerInfo.ajax",TEST_CONSULT:"sgcommunity/Circle/getCourseAnswerResult.ajax",REGIST_MESSAGE_TOKEN:"mstore/sg/registMessageToken.html",MESSAGE_WS_URL:"ws",BROKERAGE_SETTLEMENT:"mstore/sg/brokerageSettlement.html",FLASH_TWO:"sg/cms/flashSales/docker.json",GET_BUSINESS:"sgcommunity/schoolstory/getStoryCategory.ajax",GET_RELATEDSHOP:"sgcommunity/product/commonLoadItem.html",GET_AREADYSHOP:"sgcommunity/product/getPaidProductInfo.html",GET_HOLDPRO:"sgcommunity/product/getCollectionList.ajax",SEARCH_GOODS_CIRCLE:"sgcommunity/product/wdCommonSearch.html",SEARCH_HOLDPRO:"sgcommunity/product/searchCollectionList.ajax",CIRCLE_GET_GOLD:"sgcommunity/user/getConsumeCreditNum.ajax",CIRCLE_SHAN_LIST:"sgcommunity/getTipList.ajax",CIRCLE_SHAN_TOPIC:"sgcommunity/story/tipStory.ajax",CIRCLE_SHAN_COMMENT:"sgcommunity/story/tipComment.ajax",CIRCLE_SELECT_SHOP:"sgcommunity/user/isWd.ajax",CIRCLE_GET_CIRCLE_LIST:"sgcommunity/getUcTopicCategoryList.ajax",CIRCLE_GET_SECONDLIST:"sgcommunity/getUcTopicListByCategoryId.ajax",CIRCLE_CIRCLEPERSON:"sgcommunity/Circle/getUserListByTopicId.ajax",CIRCLE_SET_ADMIN:"sgcommunity/Circle/setManager.ajax",CIRCLE_MANAGE_USER:"sgcommunity/Circle/setIsGap.ajax",CIRCLE_DELECT_USER:"sgcommunity/schoolstory/deleteUser.ajax",CIRCLE_CANG_COMMENT:"sgcommunity/schoolstory/updateCommentDisplayStatus.ajax",CIRCLE_CANG_TOPIC:"sgcommunity/hiddenStory.ajax",CIECLE_DEL_CANG_TOPIC:"sgcommunity/cancleHiddenStory.ajax",CIRCLE_TOP_TOPIC:"sgcommunity/setTopStory.ajax",CIRCLE_SPEAK:"sgcommunity/schoolstory/getUserIsGag.ajax",CIRCLE_AGREE:"sgcommunity/story/adoptionComments.ajax",CIRCLE_SELECT_TOPIC:"sgcommunity/Circle/choiceTopicList.ajax",CIRCLE_JING_TOPIC:"sgcommunity/setChoiceStory.ajax",CIRCLE_JING_CANCLE:"sgcommunity/cancelChoiceStory.ajax",ZC_INDEX:"activity/zhongchou/index",ZC_INDEX_ACTIVITY:"activity/zhongchou/indexZActivitys",ZC_ZSTALLS_SINGLE_PAGE:"activity/zhongchou/getZStallsSinglePage",ZC_CHECK:"activity/zhongchou/check",ZC_ORDER_COMMIT:"activity/zhongchou/order/pageInfo",ZC_ACTIVITY_SINGLE_PAGE:"activity/zhongchou/getZActivitySinglePage",ZC_COMMIT_ORDER:"activity/zhongchou/order/submitOrder",GETNAVIGATIONS:"sg/cms/navigation/getNavigations.json",COMMONLOADITEMNEW:"mstore/commonLoadItemNew.html",WDCOMMONSEARCHNEW:"mstore/wdCommonSearchNew.html",MYSTORE:"mstore/sg/myStore.json",ISREALNAMEAUTH:"kjt/bank/isRealNameAuth.json",CAPTCHAMOBILE:"platform/web/member/captchaMobile.json",REALNAMEAUTH:"kjt/bank/realNameAuth.json",REALNAMECHECK:"kjt/bank/realNameCheck.json",CHECKMOBILE:"platform/web/member/checkMobile.json",CHANGEMOBILE:"platform/web/member/changeMobile.json",NEW_SEND:"sg/cms/reserve/index.json",NEW_RES:"sg/cms/reserve/preSale.json",NEW_SLIDE:"sg/cms/secondPageBanner.json",NEW_FLASHSALE:"sg/cms/flashSales/docker.json",SUC_ZHONGCHOU:"activity/zhongchou/successZActivitys",GET_SMSS:"sg/cms/reserve/sendSmsCaptcha.json",SUB_PRESS:"sg/cms/reserve/reserve.json",CHECK_RES:"sg/cms/reserve/checkMemberReserve.json",GET_STORE_DETAIL:"mstore/sg/mechanism/findStoreMemberDetail.json",GET_APPLY_MENGZHU:"mstore/sg/mechanism/getTeamLevelApplyStatus.json",APPLY_MENGZHU:"mstore/sg/mechanism/teamLevelApply.json",APPLY_MENGZHU_NOT:"mstore/sg/mechanism/findTeamLevelApplyDesc.json",GET_VISI_BROW_HIS:"mstore/sg/mechanism/findStoreVisitStatistic.json",GET_STORE_DATA:"mstore/sg/mechanism/findVisitStatistic.json",GET_TEAM_DATA:"mstore/sg/mechanism/statisticalTeamData.json",GET_OWNER_DATA:"mstore/sg/mechanism/statisticalPersonalData.json",GET_PARTNER_TEAM:"mstore/sg/mechanism/pagingChildren.json",TEAM_SUPERVISE:"mstore/sg/mechanism/pagingChildren.json",TEAM_USERINFO:"mstore/sg/mechanism/findStoreMemberDetail.json",ORDER_LIST:"h5/order/getOrderList.json",TEAM_USERS:"mstore/sg/mechanism/findOrderProductUserInfo.json",TEAM_MESSAGE:"mstore/sg/mechanism/findOrderProductUserInfoDetail.json",STORE_PRODUCT:"mstore/sg/mechanism/findVisitStatistic.json",REGISTERS:"mstore/sg/checkRegisterParam.json",GET_HAIER_STAFF_MSG:"kjt/bank/sendSmsForEmp.json",POST_HAIER_STAFF_MSG:"kjt/bank/employerAuth.json",REGISTERS_NEW:"platform/web/member/checkRegisterParam.json",TRUE_REALNAMEAUTH:"kjt/bank/isRealNameAuth.json",POST_USERDATAANDID:"kjt/bank/realNameAuth.json",POST_USERDATA:"kjt/bank/realNameCheckPC.json",GET_NAMEORID:"kjt/bank/realNameCheck.json",SHOP_SUCCESS_APPLY:"mstore/sg/registerNew.json",GET_PHONEAUTH:"kjt/bank/phoneAuth.json",GET_NAMEAUTH:"kjt/bank/nameAuth.json",GET_PROMOTION_CODE:"platform/web/member/findPromotionCodeByRegion.json",NEW_SHOP_STORE:"platform/web/member/registerAndStore.json",SHOP_STORE:"mstore/sg/wdApplySubmit.html",GET_BANKNAME:"kjt/bank/getBankName.json",GET_USORID:"kjt/bank/toBindCard.html",POST_CHECKS:"kjt/bank/bindCardCheck.json",GET_CODEID:"kjt/bank/captcha.json",POST_BANKDATA:"kjt/bank/bindCard.json",GET_learningHaier:"sg/h5/web/auth/mobile/learningHaier.json",GET_homeking:"sg/h5/web/auth/mobile/homeking.json",WHITE_SHOWS_APPLY:"v3/kjt/applyForOpen.json",WHITE_SHOWS_QUERY_AVALIAMT:"v3/kjt/queryAvaliAmt.json",WHITE_SHOWS_PAY:"v3/kjt/payApply.json",WHITE_SHOWS_QUERY_STATUS:"v3/kjt/queryIousStatus.json",WHITE_SHOWS_COST:"v3/kjt/iouc/cost.json"},d=[{username:"message_user_ro",password:"nYXPFND2"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"},{username:"task",password:"task"}],u=[{name:"LOADMOREPRODUCTS_INIT",value:"SEARCH_SERVER_DATA"},{name:"GET_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SHOP_INFO_LIST",value:"SEARCH_SERVER_DATA"},{name:"ACTIVITY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"GET_FILTER_DATA",value:"SEARCH_SERVER_DATA"},{name:"SEARCHGOODS_INIT",value:"SEARCH_SERVER_DATA"},{name:"SEARCH_GOODS",value:"SEARCH_SERVER_DATA"},{name:"HOT_WORDS",value:"SEARCH_SERVER_DATA"},{name:"DEFAULTSEARCH_WORDS",value:"SEARCH_SERVER_DATA"},{name:"ASSOCIATIONAL_WORDS",value:"SEARCH_SERVER_DATA"},{name:"PRODUCTDETAIL_LODEDATA",value:"ITEM_SERVER_DATA"},{name:"PRODUCTDETAIL_PROMOS",value:"ITEM_SERVER_DATA"},{name:"ORDERDETAIL_SPECIFICATIONS",value:"ITEM_SERVER_DATA"},{name:"SECKILLDETAIL",value:"ITEM_SERVER_DATA"},{name:"CHECK_NOTICE",value:"ITEM_SERVER_DATA"},{name:"START_NOTICE",value:"ITEM_SERVER_DATA"},{name:"ARRIVE_NOTICE",value:"ITEM_SERVER_DATA"},{name:"GET_O2O_NAME",value:"ITEM_SERVER_DATA"},{name:"GET_MERGE_IMAGE",value:"ITEM_SERVER_DATA"},{name:"NEW_SHOP_COUPONS_LIST",value:"ITEM_SERVER_DATA"},{name:"PRODUCT_COUPONS_HAS",value:"ITEM_SERVER_DATA"},{name:"POST_STORE_INFO",value:"ITEM_SERVER_DATA"},{name:"LOCATION_CHANGE",value:"ITEM_SERVER_DATA"},{name:"EVALUATE_INFO",value:"ITEM_SERVER_DATA"},{name:"WDCOMMONSEARCHNEW",value:"SEARCH_SERVER_DATA"},{name:"COMMONLOADITEMNEW",value:"SEARCH_SERVER_DATA"},{name:"FAXIAN_INIT",value:"SEARCH_SERVER_DATA"},{name:"ASYNC_ACCESS_PRICE",value:"SEARCH_SERVER_DATA"},{name:"SPECIALY_PRODUCTS_LIST",value:"SEARCH_SERVER_DATA"},{name:"SECONDLEVEL_PRODUCTLIST",value:"SEARCH_SERVER_DATA"},{name:"ADD_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"CANCEL_COLLECT",value:"SEARCH_SERVER_DATA"},{name:"GET_GETSGSTOREATTRIBUTE",value:"ITEM_SERVER_DATA"},{name:"GET_GETDETAILATTRIBUTE",value:"ITEM_SERVER_DATA"},{name:"GET_ISSHOWATTR",value:"ITEM_SERVER_DATA"}];this.getUrl=function(t){for(var o=e[2],i=o.SERVER_DATA,s=0;s<u.length;s++)if(t===u[s].name){o[u[s].value]&&(i=o[u[s].value]);break}return i+l[t]},this.getNewUrl=function(e){return o+l[e]},this.getWSUrl=function(e){return s+l[e]},
this.getCPUrl=function(e){return l[r+e]},this.getMQAuth=function(){return d[2]},this.getAMAPUrl=function(){return e[2].AMAP_SERVER},this.getFakeUrl=function(e){return"./data/"+l[e]},this.getDeteleAddr=function(e,o){return t+l[e]+o+".html"},this.getHead=function(){return t},this.getHeadV2=function(){return i},this.getZCUrl=function(e){return n+l[e]},this.getCcbUrl=function(e){return a+l[e]},this.getPayCenter=function(e){return c+l[e]},this.getEnviroment=function(){return 0},this.getWhiteShowsUrl=function(e){return o+l[e]},this.getSharePicHeader=function(){return e[2].SHAREPICHEADER},this.getShareLinkHeader=function(){return e[2].SHARELINKHEADER},this.getServiceV2=function(t){return e[2].SERVER_DATA_V2+l[t]},this.getGameUrl=function(t){return e[2].SERVER_DATA_GAME+l[t]}}]),APP.controller("bindingBankControl",["UrlService","InAppBrowserService","$ionicPopup","trueAuthenticationService","$ionicHistory","$timeout","$scope","$state","bindingBankService","$stateParams","$rootScope",function(e,t,o,i,s,n,a,r,c,l,d){a.isComplete=!1,a.isPrompts=!1,a.isHasKey=!1,a.isHasVal=!1,a.isPhoneNum=!1,a.isType=!1,a.isOkType=!1,a.isEffective=!1,a.agreement=!1,a.isOther=!1,a.isAccord=!1,a.isReplaces=!1,a.isInputs=!1,a.isIdNumber=!1,a.isShows=!1,a.isOKTel=!1,a.isTrueMsg=!1,a.isNotAuthentication=!1,a.phoneNumber="",a.IDNumber="",a.userName="",a.bankNo="",a.isBankType=!1,a.isBankNum=!0,a.hasChooseBankCode="",a.hasChooseBank="",a.slice=window.slice,a.selectionStart=window.selectionStart,a.selectionEnd=window.selectionEnd,a.$on("$ionicView.beforeEnter",function(e,t){d.$on("haveChooseBank",function(e,t,o,i){a.hasChooseBank=i,a.hasChooseBankCode=o}),a.obj.bankNames=a.hasChooseBank,"back"!=t.direction&&(a.isOkType=!1,a.isEffective=!1,a.isShows=!1,a.isInputs=!1,a.isIdNumber=!1,a.isReplaces=!1,a.isAccord=!1,a.isOther=!1,a.isBankType=!1,a.isComplete=!1,a.asyncs=!1,a.isType=!1,a.isOKTel=!1,a.isBankNum=!0,a.obj.isMyBank="",a.obj.isMyName="",a.obj.isMyIdNumber="",a.obj.phoneNumber="",a.hasChooseBank="",a.obj.bankNames="",a.init())}),a.goBack=function(){s.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(a.paddingtopClass={"margin-top":"16px"},a.paddingtopClasscontent={top:"60px"}):(a.paddingtopClass={"margin-top":"0px"},a.paddingtopClasscontent={top:"44px"}),a.toRules=function(o,i){-1!=navigator.userAgent.indexOf("iPhone")?t.open(e.getHead()+"mstore/sg/helpDetail.html?id="+o,i):r.go("helpDetail",{helpId:o,content:i})},a.obj={isMyName:"",isMyIdNumber:"",isMyBank:"",phoneNumber:"",bankNames:"",agreement:!1},a.init=function(){i.doInit().success(function(e){e.success?(a.isNotAuthentication=e.data.isAuth,a.isNotAuthentication?(a.isTrueMsg=!1,a.isInputs||c.getUsOrId().success(function(e){e.success?(a.IDNumber=e.data.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,i){for(var s="";s.length<o.length;)s+="*";return t+s+i}),a.userName=e.data.realName.replace(/.{1}/,"*"),a.name=e.data.realName,a.ids=e.data.identityNo):(a.message=e.message,a.isAccord=!0)})):a.isTrueMsg=!0):(a.message=e.message,a.isRetry=!0)})},a.goTrueAutThentication=function(){a.isTrueMsg=!1,r.go("trueAuthentication",{type:5})},a.isNoTrue=function(){s.goBack(),a.isTrueMsg=!1},a.isAgreement=function(){a.obj.agreement=!a.obj.agreement},a.retry=function(){a.isOther=!1},a.isClear=function(){a.obj.isMyBank="",a.hasChooseBankCode="",a.hasChooseBank="",a.obj.phoneNumber="",a.isPhoneNum=!1},a.isClearVal=function(){a.obj.phoneNumber=""},a.isMoreInfo=function(){a.isOther=!0},a.phoneClose=function(){a.isAccord=!1},a.isRepl=function(){a.isReplaces=!0},a.replaceInfoOk=function(){a.isInputs=!0,a.isIdNumber=!0,a.isReplaces=!1,a.isType=!1,a.isOkType=!1,a.isOKTel=!1,a.isShows=!0,a.obj.isMyBank="",a.obj.phoneNumber="",a.hasChooseBankCode="",a.hasChooseBank="",a.isPhoneNum=!1,a.isBankNum=!1},a.replaceInfoClose=function(){a.isReplaces=!1,a.isInputs=!1,a.isIdNumber=!1,a.isBankNum=!0},a.mobileFun=function(){d.globalConstant.mobileNumberRegExp.test(a.obj.phoneNumber)?(a.isOKTel=!1,a.obj.agreement||""==a.userName||""==a.IDNumber?a.isComplete=!1:a.isComplete=!0):(a.isComplete=!1,a.obj.phoneNumber.length>=11?a.isOKTel=!0:a.isOKTel=!1)},a.logicFn=function(){9==a.obj.isMyBank.length?(a.bankCodes=a.obj.isMyBank.replace(/\s*/g,""),c.getBankName(a.bankCodes).success(function(e){null==e.data.bankNames?(a.isOkType=!1,a.isType=!0,a.bankNo=a.hasChooseBankCode,a.obj.bankNames=a.hasChooseBank,a.bankPhone=""):1==e.data.bankNames.cardTypeCode?(a.bankPhone=e.data.bankPhone,a.bankNo=e.data.bankNames.bankNo,a.isOkType=!0,a.isType=!1,a.isBankType=!1,a.obj.bankNames=e.data.bankNames.bankName):(a.isPhoneNum=!1,a.isBankType=!0,a.isComplete=!1)})):a.obj.isMyBank.length<9&&(a.isOkType=!1,a.isType=!1),!a.isOkType||23!=a.obj.isMyBank.length&&19!=a.obj.isMyBank.length?(a.isComplete=!1,a.isOKTel=!1,a.isOkType&&(a.isPhoneNum=!1),a.isType&&a.mobileFun()):(a.isEffective=!1,a.isEffectiveOK=!1,a.isPhoneNum=!0,a.mobileFun())},a.async=function(){""!=a.obj.isMyName&&a.obj.isMyIdNumber.length<19&&i.getUsNameOrId(a.obj.isMyName,a.obj.isMyIdNumber).success(function(e){e.data?(a.isBankNum=!0,a.info=e.message,a.isEffective=!0):(a.info=e.message,a.isEffective=!0,a.isBankNum=!1)})};a.$watch("obj",function(){""==a.obj.bankNames||23!=a.obj.isMyBank.length&&19!=a.obj.isMyBank.length?a.isPhoneNum=!1:a.isPhoneNum=!0,a.isShows?/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,15}$/.test(a.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(a.obj.isMyIdNumber)?(a.asyncs||i.getUsNameOrId(a.obj.isMyName,a.obj.isMyIdNumber).success(function(e){a.asyncs=!0,e.data?(a.info=e.message,a.isEffective=!0,a.isBankNum=!0):(a.info=e.message,a.isEffective=!0,a.isBankNum=!1)}),a.logicFn()):(a.isComplete=!1,a.isEffective=!1,a.asyncs=!1,a.isBankNum=!1):a.logicFn(),""!=a.obj.isMyBank?a.isHasKey=!0:a.isHasKey=!1,""!=a.obj.phoneNumber?a.isHasVal=!0:a.isHasVal=!1},!0);a.join=window.join,a.keyFun=function(e){var t=document.getElementById("keyRoom"),o=t.value;if(8==(e||event).keyCode){if(o){for(var i=0;i<o.length;i++)var s=o.replace(/\s$/g,"");t.value=s}}else{for(var i=0;i<o.length;i++){var n=o.split("");(i+1)%5==0&&n.splice(i,0," ")}t.value=n.join("")}},a.commonFun=function(e,t,o,i){c.bankCheck(e,t,o,i).success(function(s){s.success?s.data.isThrough&&(a.isAccord=!1,c.VerificationCode(i).success(function(s){a.message=s.message,s.success?(r.go("verificationCode",{ownerName:e,identityNo:t,cardNo:o,mobile:i,bankNo:a.bankNo,phoneNumber:a.bankPhone}),a.isAccord=!1):a.isAccord=!0})):(a.message=s.message,a.isAccord=!0)})},a.goAuthentication=function(e,t,o,i,s,n){a.bankCodes=a.obj.isMyBank.replace(/\s*/g,""),a.obj.phoneNumber=a.obj.phoneNumber.replace(/\s*/g,""),a.isShows?a.commonFun(a.obj.isMyName,a.obj.isMyIdNumber,a.bankCodes,a.obj.phoneNumber):a.commonFun(a.name,a.ids,a.bankCodes,a.obj.phoneNumber)}}]),APP.service("bindingBankService",["$http","UrlService",function(e,t){this.doInit=function(o,i){var s={userName:o,password:i};return e.get(t.getUrl("HOME_INIT"),s)},this.getBankName=function(o){var i={cardNo:o};return e.get(t.getUrl("GET_BANKNAME"),i)},this.getUsOrId=function(){return e.get(t.getUrl("GET_USORID"))},this.bankCheck=function(o,i,s,n){var a={ownerName:o,identityNo:i,cardNo:s,mobile:n};return e({method:"POST",url:t.getUrl("POST_CHECKS"),params:a})},this.VerificationCode=function(o){var i={mobile:o};return e.get(t.getUrl("GET_CODEID"),i)}}]),APP.controller("verificationCodeControl",["$ionicHistory","PopupService","$interval","$timeout","$scope","$state","verificationCodeService","$stateParams",function(e,t,o,i,s,n,a,r){s.isComplete=!1,s.captchaFlag=!0,s.isOK=!1,s.isBindBackOK=!1,s.paracont="重新获取",s.isAccord=!1,s.obj={numbers:""},s.name=r.ownerName,s.idNum=r.identityNo,s.bankCode=r.cardNo,s.mobile=r.mobile,s.phoneNum=r.mobile.replace(/^(\d{3})\d{4}(\d{4})$/,"$1****$2"),s.bankNo=r.bankNo,s.phoneNumber=r.phoneNumber;var c,l=void 0;s.goBack=function(){e.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"margin-top":"16px"},s.paddingtopClasscontent={top:"60px"}):(s.paddingtopClass={"margin-top":"0px"},s.paddingtopClasscontent={top:"44px"}),s.commonFnCode=function(){c=60,l=o(function(){c<=0?(o.cancel(l),l=void 0,c=60,s.paracont="重新获取",s.captchaFlag=!0):(s.paracont=c-1+"秒后可重发",s.captchaFlag=!1,c--)},1e3,100)},s.init=function(){a.VerificationCode(s.mobile).success(function(e){e.success?s.commonFnCode():t.showToast("获取验证码失败！")})},s.$on("$ionicView.beforeEnter",function(){s.captchaFlag=!0,c=60,s.paracont="重新获取",o.cancel(l),s.commonFnCode(),s.isAccord=!1,s.isOK=!1,s.isBindBackOK=!1,s.obj.numbers=""}),s.goAuthentication=function(){a.bankCheckOK(s.name,s.bankCode,s.bankNo,s.mobile,s.obj.numbers).success(function(e){s.message=e.message,e.success?(s.isBindBackOK=!0,s.isOK=!1,i(function(){s.isBindBackOK=!1,n.go("personnalCenter")},1e3)):(s.isBindBackOK=!1,s.isOK=!0)})},s.phoneClose=function(){s.isAccord=!1},s.Close=function(){s.isOK=!1},s.isReceived=function(){s.isAccord=!0},s.againGet=function(){s.captchaFlag&&s.init()},s.myFun=function(){/^\d{6}$/.test(s.obj.numbers)?s.isComplete=!0:s.isComplete=!1}}]),APP.service("verificationCodeService",["$http","UrlService",function(e,t){this.VerificationCode=function(o){var i={mobile:o};return e.get(t.getUrl("GET_CODEID"),i)},this.bankCheckOK=function(o,i,s,n,a){var r={ownerName:o,cardNo:i,bankNo:s,mobile:n,captcha:a};return e.post(t.getUrl("POST_BANKDATA")+"?ownerName="+r.ownerName+"&cardNo="+r.cardNo+"&bankNo="+r.bankNo+"&mobile="+r.mobile+"&captcha="+r.captcha)}}]),APP.controller("CartController",["$rootScope","HomePageService","$scope","$stateParams","CartService","$state","$ionicPopup","LoginService","$timeout","$cookies","PopupService","ProductDetailService","$ionicScrollDelegate","GetCouponsService","$location","UserService","$localstorage","IMService","UrlService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){o.remindSuccess=!1;var I=1;o.getcoupons=!0,o.hasMoreCoupons=!1;var $=[];o.all={isAllChecked:!0};var w,y;o.logConpous=function(){u.getShopCoupons($[0],$[1],$[2],$[3],I,5,$[4]).success(function(e,t,i,s){e.success?1==I?(I++,o.shopCoupons=e.data,p.$getByHandle("mainScroll").scrollTop(),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(I++,o.shopCoupons=o.shopCoupons.concat(e.data),o.shopCoupons.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasMoreCoupons=!1)})},o.closeCoupons=function(){I=1,$=[],o.getcoupons=!1},o.openCoupons=function(e,t,i,s,n){$[0]=e,$[1]=t,$[2]=i,$[3]=s,$[4]=n,o.logConpous(),o.getcoupons=!0},o.getNewCoupons=function(i){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?n.go("login"):g.doGetNewCoupons(i).success(function(t){t.success?(e.couponXyzType=!0,p.scrollTop(),I=1,o.logConpous()):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(){o.tabNav="cart",o.isShow=!1,o.noGoods=!1,o.cartMessage={},o.cartSelectedMode=[],o.htmlContent=i.content,o.title=i.title,t.isWdHost().success(function(t){e.isWdHost=t.data.isHost}),u.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)}),s.loadCartMessage().success(function(e,t,i,s){o.isShow=!1,0==e.totalCount?o.noGoods=!0:(o.cartMessage=e,o.cartSubTitle="总共"+o.cartMessage.totalCount+"件商品",o.noGoods=!1,o.isShow=!0,o.checkAll(!0))}).error(function(){o.isShow=!1,o.showPopup("查询购物车失败")}),o.all.isAllChecked=!1},o.$on("$ionicView.beforeEnter",function(){o.remindSuccess=!1,o.getcoupons=!1,o.hasMoreCoupons=!1,o.isBuyerForCart=r.getRole(),o.init(),o.footerSubmit={position:"fixed",bottom:"49px"},w=window.navigator.userAgent.toLowerCase(),y="micromessenger"==w.match(/MicroMessenger/i)}),o.htmlContent=i.content,o.title=i.title,o.all.isAllChecked=!1,o.totalMoney=0,o.saveSelectedIndex=function(e,t){var i=o.cartSelectedMode.indexOf(e);t?i<0&&o.cartSelectedMode.push(e):o.cartSelectedMode.splice(i,1)},o.selectedChanged=function(e,t,i){o.saveSelectedIndex(i,t),o.all.isAllChecked=o.cartSelectedMode.length==o.cartMessage.data.carts.length,o.accountTotalMoney()},o.checkAll=function(e){o.all.isAllChecked=e,angular.forEach(o.cartMessage.data.carts,function(t,i){t.isChecked=e,o.saveSelectedIndex(i,e)}),o.accountTotalMoney()},o.deleteProduct=function(e){if(o.cartSelectedMode.splice(e,1),null==o.cartMessage.data.carts[e].skku||"null"==o.cartMessage.data.carts[e].skku)var t=o.cartMessage.data.carts[e].sku;else var t=o.cartMessage.data.carts[e].skku;s.deleteProduct(t,o.cartMessage.data.carts[e].productId).success(function(e,t,i,s){1==e.success?(o.init(),void 0!=o.cartMessage.data&&o.accountTotalMoney()):alert("删除商品失败")})};var T=!1;o.nus=function(t){if(!T)if(o.cartMessage.data.carts[t].number<=1)o.cartMessage.data.carts[t].number=1;else{if(T=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var i=o.cartMessage.data.carts[t].sku;else var i=o.cartMessage.data.carts[t].skku;s.nusplus(i,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number-1).success(function(i,s,n,a){o.cartMessage.data.carts[t].number-=1,o.accountTotalMoney(),T=!1,u.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}};var C=!1;o.plus=function(t){if(!C){if(C=!0,null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var i=o.cartMessage.data.carts[t].sku;else var i=o.cartMessage.data.carts[t].skku;s.nusplus(i,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number+1).success(function(i,n,a,r){if(0==i.success){var c=i.message;if(null==o.cartMessage.data.carts[t].skku||"null"==o.cartMessage.data.carts[t].skku)var l=o.cartMessage.data.carts[t].sku;else var l=o.cartMessage.data.carts[t].skku;s.nusplus(l,o.cartMessage.data.carts[t].productId,o.cartMessage.data.carts[t].number).success(function(e){return d.showToast(c),C=!1,!1})}else o.cartMessage.data.carts[t].number+=1,o.accountTotalMoney(),C=!1;u.getCartNum().success(function(t){t.success&&(e.BottomCartNum=t.data)})})}},o.accountTotalMoney=function(){var e=0;angular.forEach(o.cartMessage.data.carts,function(t,i){o.cartSelectedMode.indexOf(i)>-1&&(e+=t.number*t.price,o.cartSelectedMode.sort(function(e,t){return e>t?1:-1}))}),o.totalMoney=e},o.settlement=function(){if(y)return void s.check_login().success(function(e){if(e.data)if(f.setUser(e.data),v.initWebSocket(),window.localStorage.setItem("isLogin",f.isUserLogin()),e.data.sessionValue?h.set("sg_login_token_secret","Bearer"+e.data.sessionValue):h.set("sg_login_token_secret","Bearer"+GetStatisticInfoService.generateUUID()),o.cartSelectedMode.length>0){for(var t=[],i=[],a=[],r=0;r<o.cartSelectedMode.length;r++)t[r]=o.cartMessage.data.carts[o.cartSelectedMode[r]];angular.forEach(t,function(e,t){i[t]=e.productId,a[t]=e.number}),i=i.join(","),a=a.join(","),s.checkPageInfo(i,a).success(function(e){0==e.success?o.showPopup(e.message):s.settlement(i,a).success(function(e,t,i,s){if(0==e.success)o.showPopup(e.message);else if(1==e.success&&null!=e.data){o.cartSelectedMode=[];var a=new Date;a.setDate(a.getDate()+1),l.put("is_book","",{expires:a,path:"/"}),n.go("orderConfirm")}else o.showPopup("结算失败")})})}else o.showPopup("您未选择任何商品");else{var c=h.get("sg_login_token_secret"),d=m.absUrl(),u=d.indexOf("html?");if(-1!=u)var p=d.indexOf("#",u),g=d.substring(0,u)+"html",I=d.substring(p),$=encodeURIComponent(g+I)+encodeURIComponent("/")+c;else var $=encodeURIComponent(d)+encodeURIComponent("/")+c;s.state_id($).success(function(e){var t=e.data,o=S.getCPUrl("WXSQ_ID"),i=encodeURIComponent(S.getCPUrl("WXSQ_URL")+"platform/web/member/wxWebLogin.json"),s="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+o+"&redirect_uri="+i+"&response_type=code&SCOPE=snsapi_userinfo&state="+t+"#wechat_redirect";document.location.href=s})}});if(-1==e.isWdHost)return void n.go("login");if(o.cartSelectedMode.length>0){for(var t=[],i=[],a=[],r=[],c="",d="",u="",p=0;p<o.cartSelectedMode.length;p++)t[p]=o.cartMessage.data.carts[o.cartSelectedMode[p]];angular.forEach(t,function(e,t){i[t]=e.productId,a[t]=e.number,r[t]=e.productName,null==e.attrValueNames||"null"==e.attrValueNames?c+="null;":c+=e.attrValueNames+";",null==e.skku||"null"==e.skku?d+="null;":d+=e.skku+";",null==e.o2oAttrId||"null"==e.o2oAttrId?u+="null;":u+=e.o2oAttrId+";"}),c=c.substring(0,c.length-1),d=d.substring(0,d.length-1),u=u.substring(0,u.length-1),i=i.join(","),a=a.join(","),r=r.join(","),s.checkPageInfo(i,r).success(function(e){0==e.success?o.showPopup(e.message):s.settlement(i,a,c,d).success(function(e,t,i,s){if(0==e.success)o.showPopup(e.message);else if(1==e.success&&null!=e.data){o.cartSelectedMode=[];var a=new Date;a.setDate(a.getDate()+1),l.put("is_book","",{expires:a,path:"/"}),n.go("orderConfirm",{attrValueNames:c,skku:d,o2oAttrId:u})}else o.showPopup("结算失败")})})}else o.showPopup("您未选择任何商品")},o.showPopup=function(e){var t=a.show({template:e});c(function(){t.close()},1e3)}}]),APP.service("CartService",["$http","UrlService",function(e,t){this.loadCartMessage=function(){return e.get(t.getUrl("CART_LIST"))},this.getNumber=function(){return e.get(t.getUrl("SPECIALTY_CART_NUM"))},this.nusplus=function(o,i,s){var n={sku:o,productId:i,number:s,noLoading:!0};return e.get(t.getUrl("GOODS_NUMBER"),n)},this.deleteProduct=function(o,i){var s={sku:o,productId:i};return e.get(t.getUrl("DELETE"),s)},this.settlement=function(o,i,s,n){var a={productIds:o,numbers:i,attrValueNames:s,skku:n};return e.get(t.getUrl("CONFIRM_ORDER"),a)},this.checkPageInfo=function(o,i){var s={productIds:o,productNames:i};return e.get(t.getUrl("CHECK_PAGE_INFO"),s)},this.check_login=function(){return e.get(t.getUrl("CHECK_LOGIN"))},this.state_id=function(o){var i={data:o};return e.get(t.getUrl("STATE_ID"),i)}}]),APP.controller("CommonLocationController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CommonAddressService","GoodsService","$timeout","PopupService",function(e,t,o,i,s,n,a,r,c){e.addressTitle=o.title,e.data=o.data,e.flag=o.flag,e.defaultValue=o.defaultValue,e.level=o.level;var l={};e.init=function(){e.addressTitle=o.title,o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.level=o.level,o.data?e.data=JSON.parse(o.data):i.getLocationList(0,0).success(function(t){e.data=t.data}).error(function(e){c.showToast("获取地址信息失败！")})};var d=!1;e.goSelect=ionic.Utils.debounce(function(){var o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.level>-4)i.getLocationList(o.value,o.grade).success(function(t){e.data=t.data,s.go("commonLocation",{defaultValue:JSON.stringify(e.defaultValue),data:JSON.stringify(e.data),flag:e.flag,level:e.level})}).error(function(e){c.showToast("获取地址信息失败！")});else{if(d)return;r(function(){d=!1},1500),t.$broadcast(e.flag,e.defaultValue),d=!0,e.$ionicGoBack(e.level)}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){l=n.getAddressInfo();var o=l.regionName+"/"+l.streetName;a.addAddress(l.provinceId,l.cityId,l.areaId,o,l.streetId).success(function(){var o={"text-1":l.provinceName,"text-2":l.cityName,"text-3":l.regionName,"text-4":l.streetName,"value-1":l.provinceId,"value-2":l.cityId,"value-3":l.areaId,"value-4":l.streetId};t.$broadcast(e.flag,o),e.$ionicGoBack(e.level-1)})}},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonLocationService",["$http","UrlService","$timeout",function(e,t,o){this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)}}]),APP.controller("CommonPageViewController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init(),e.htmlContent=t.content})}]),APP.controller("invoiceHtmlController",["$scope","$stateParams","$sce",function(e,t,o){e.deviceHeight=window.innerHeight,e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc),e.init=function(){e.invoiceSrc=o.trustAsResourceUrl(t.invoiceSrc)},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("CommonSelectController",["$http","CommonLocationService","$scope","$rootScope","$stateParams","$state","CacheService","PopupService",function(e,t,o,i,s,n,a,r){o.data=s.data,o.flag=s.flag,o.defaultValue=s.defaultValue,o.level=s.level,o.title=s.title,o.init=function(){o.addressMessage=a.get("addressInfo"),s.defaultValue?o.defaultValue=JSON.parse(s.defaultValue):o.defaultValue={},o.level=s.level,s.data?o.data=JSON.parse(s.data):e.get("data/region.json").success(function(e){o.data=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.goSelect=function(s,a){o.level=o.level-1,"全部"==a.text&&"全国"==a.text||(o.defaultValue["text"+o.level]=a.text,o.defaultValue["value"+o.level]=a.value),o.level>-2?e.get("data/region.json").success(function(e){-1==o.level?o.data=e.data[s].children:o.data=o.data[s].children,n.go("commonSelect",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")}):o.level>-4?(ah=-1*o.level,t.getLocationList(a.value,ah).success(function(e){o.data=e.data,n.go("commonLocation",{defaultValue:JSON.stringify(o.defaultValue),data:JSON.stringify(o.data),flag:o.flag,level:o.level})}).error(function(e){r.showToast("获取地址信息失败！")})):(i.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level))},o.doSelectAll=function(){o.level?o.level:o.defaultValue={"text-1":"","text-2":"","text-3":"","value-1":"","value-2":"","value-3":""},i.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack(o.level-1)},o.doSelectDingWei=function(){o.defaultValue={"text-1":o.addressMessage.provinceName,"text-2":o.addressMessage.cityName,"text-3":o.addressMessage.regionName,"text-4":o.addressMessage.streetName,"value-1":o.addressMessage.provinceId,"value-2":o.addressMessage.cityId,"value-3":o.addressMessage.areaId,"value-4":o.addressMessage.streetId},i.$broadcast(o.flag,o.defaultValue),o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){o.init()})}]),APP.directive("titleType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="tType"/>',link:function(e,t,o){var i=o.titleType;e.tType="templates/common/TitleTemplate"+i+".html"}}}]),APP.directive("listType",["$http","UrlService",function(e,t){return{restrict:"A",template:'<ng:include src="lType"/>',link:function(e,t,o){var i=o.listType;e.lType="templates/common/ListTemplate"+i+".html"}}}]),APP.controller("CommonUnionController",["$scope","$rootScope","$stateParams","CommonUnionService","$timeout","$ionicLoading",function(e,t,o,i,s,n){e.dataUnion=[],e.flag=o.flag,e.defaultValue=o.defaultValue,e.selectSigal=o.data,e.init=function(){o.defaultValue?e.defaultValue=JSON.parse(o.defaultValue):e.defaultValue={},e.dataUnion=[],i.getUnionList().success(function(o){for(var i=void 0,s=0,n=o.data.length;s<n;s++)e.selectSigal==o.data[s].dictionary_display_value&&(i=s),e.dataUnion.push({key:o.data[s].dictionary_db_value,text:o.data[s].dictionary_display_value,imgSelect:t.imgBaseURL+"img/ic_select.png",imgUnselect:t.imgBaseURL+"img/ic_check.png",isSelect:!1});i&&(e.dataUnion[i].isSelect=!0)})},e.goSelect=function(o,i){e.defaultValue.text=o.text,e.defaultValue.value=o.key,angular.forEach(e.dataUnion,function(e){e.isSelect=!1}),e.dataUnion[i].isSelect=!0,t.$broadcast(e.flag,e.defaultValue),e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("CommonUnionService",["$http","UrlService",function(e,t){this.getUnionList=function(){return e.get(t.getUrl("COMMON_UNION"))}}]),APP.service("GetStatisticInfoService",["LoginService","$rootScope","$http","UserService","$localstorage","UrlService",function(e,t,o,i,s,n){function a(e){function t(e){return e>9?e:"0"+e}if(e){var o=new Date;o.setTime(e);var i=o.getFullYear(),s=o.getMonth()+1,n=o.getDate(),a=o.getHours(),r=o.getMinutes(),c=o.getSeconds();return i+"-"+t(s)+"-"+t(n)+" "+t(a)+":"+t(r)+":"+t(c)}}function r(e,t){var o=new Date;o.setTime(o.getTime()+31536e7),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}function c(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}this.GetUserInfo=function(o,l,d){function u(){t.globalConstant.positionStatus?(p=t.globalConstant.lon,g=t.globalConstant.lat):setTimeout(function(){u()},5e3)}var p,g,m,f=window.location.origin,h=f+"/#/"+o,v=f+"/#/"+l,S=document.getElementsByTagName("title")[0].innerHTML,I="",$=window.innerWidth+"*"+window.innerHeight,w=a((new Date).getTime()),y="",T=navigator.language,C=navigator.platform||"",b=i.getUser().mid||"",A=s.get("IsThirdLoginType")||"",P="",L="";m=e.getRole()>0?1:0;var x="",D=t.xnFromState.url.split("/:");if(D.length>0){for(var N=1;N<D.length;N++)x+="/"+t.xnFromParams[D[N]];v=f+"/www/index.html#/"+t.xnFromState.name+x}var _="",k=t.xnToState.url.split("/:");if(k.length>0){for(var N=1;N<k.length;N++)_+="/"+t.xnToParams[k[N]];h=f+"/www/index.html#/"+t.xnToState.name+_}u(),P=-1!=location.href.indexOf("?fs")?"fromShare":"",c("visitorId")?y=c("visitorId"):(y=this.generateUUID(),r("visitorId",y));var O="",E="";d.storeId&&(O=d.storeId),d.productId&&(E=d.productId);var M=navigator.userAgent,U=M.indexOf("Android")>-1||M.indexOf("Adr")>-1;I=!M.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?U?"android":"pc":"ios","micromessenger"==M.toLowerCase().match(/MicroMessenger/i)?L="wx":"weibo"==M.toLowerCase().match(/WeiBo/i)?L="wb":"qq"==M.toLowerCase().match(/QQ/i)&&(L="qq");var R=["sg_h5",I,w,y,b,A,O,E,"",v,h,S,$,"",T,C,"",P,L,m],B=R.join("|");B=B.replace(/,/g,"");var F=n.getCPUrl("BIG_DATA")+"?data="+encodeURIComponent(B);jQuery.getScript(F,function(e){})},this.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})}}]),APP.directive("errSrc",[function(){return{link:function(e,t,o){t.bind("error",function(){o.$set("src",o.errSrc?o.errSrc:"http://cdn09.ehaier.com/shunguang/H5/www/img/errPlaceholder.png")})}}}]);var JSON;JSON||(JSON={}),function(){function str(e,t){var o,i,s,n,a,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(n=c.length,o=0;o<n;o+=1)a[o]=str(o,c)||"null";return s=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]",gap=r,s}if(rep&&"object"==typeof rep)for(n=rep.length,o=0;o<n;o+=1)"string"==typeof rep[o]&&(i=rep[o],(s=str(i,c))&&a.push(quote(i)+(gap?": ":":")+s));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(s=str(i,c))&&a.push(quote(i)+(gap?": ":":")+s);return s=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}",gap=r,s}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var i;if(gap="",indent="","number"==typeof o)for(i=0;i<o;i+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,i,s=e[t];if(s&&"object"==typeof s)for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i=walk(s,o),void 0!==i?s[o]=i:delete s[o]);return reviver.call(e,t,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},i=function(){};i.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var i=this._listeners[e];-1===o.arrIndexOf(i,t)&&i.push(t)},i.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var i=this._listeners[e],s=o.arrIndexOf(i,t);return-1!==s?void(i.length>1?this._listeners[e]=i.slice(0,s).concat(i.slice(s+1)):delete this._listeners[e]):void 0}},i.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,o)};var s=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};s.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var n=function(e){var t=this;t._events=e||[],t._listeners={}};n.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var i=0;i<t._listeners[e].length;i++)t._listeners[e][i].apply(t,o)}},n.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},n.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},n.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var a="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||a.length;var o,i=[];for(o=0;o<e;o++)i.push(a.substr(Math.floor(Math.random()*t),1));return i.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};o.polluteGlobalNamespace=function(){"_jp"in t||(t._jp={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){
return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var i=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=i.protocol+t),0===t.indexOf("/")&&(t=i.protocol+"//"+i.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var i=o.arrIndexOf(e,t);return-1===i?e.slice():e.slice(0,i).concat(e.slice(i+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var r,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},d=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,u=JSON&&JSON.stringify||function(e){return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return l[e]})),'"'+e+'"'},p=function(e){var t,o={},i=[];for(t=0;t<65536;t++)i.push(String.fromCharCode(t));return e.lastIndex=0,i.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=u(e);return d.lastIndex=0,d.test(t)?(r||(r=p(d)),t.replace(d,function(e){return r[e]})):t};var g=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];o.probeProtocols=function(){for(var e={},t=0;t<g.length;t++){var o=g[t];e[o]=w[o]&&w[o].enabled()}return e},o.detectProtocols=function(e,t,o){var i={},s=[];t||(t=g);for(var n=0;n<t.length;n++){var a=t[n];i[a]=e[a]}var r=function(e){var t=e.shift();i[t]?s.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),i["xhr-streaming"]&&!o.null_origin?s.push("xhr-streaming"):!i["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):s.push("xdr-streaming"),i["xhr-polling"]&&!o.null_origin?s.push("xhr-polling"):!i["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):s.push("xdr-polling"),s};var m="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(m in t)){var i={};t[m]=function(e){return e in i||(i[e]={id:e,del:function(){delete i[e]}}),i[e]}}return t[m](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,i){void 0!==t.addEventListener?t.addEventListener(o,i,!1):(e.attachEvent("on"+o,i),t.attachEvent("on"+o,i))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,i){void 0!==t.addEventListener?t.removeEventListener(o,i,!1):(e.detachEvent("on"+o,i),t.detachEvent("on"+o,i))};var f={},h=!1,v=function(){for(var e in f)f[e](),delete f[e]},S=function(){h||(h=!0,v())};o.attachEvent("unload",S),o.unload_add=function(e){var t=o.random_string(8);return f[t]=e,h&&o.delay(v),t},o.unload_del=function(e){e in f&&delete f[e]},o.createIframe=function(t,i){var s,n,a=e.createElement("iframe"),r=function(){clearTimeout(s);try{a.onload=null}catch(e){}a.onerror=null},c=function(){a&&(r(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),o.unload_del(n))},l=function(e){a&&(c(),i(e))},d=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}};return a.src=t,a.style.display="none",a.style.position="absolute",a.onerror=function(){l("onerror")},a.onload=function(){clearTimeout(s),s=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(a),s=setTimeout(function(){l("timeout")},15e3),n=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,i){var s,n,a,r=new ActiveXObject("htmlfile"),c=function(){clearTimeout(s)},l=function(){r&&(c(),o.unload_del(n),a.parentNode.removeChild(a),a=r=null,CollectGarbage())},d=function(e){r&&(l(),i(e))},u=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}};r.open(),r.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),r.close(),r.parentWindow._jp=t._jp;var p=r.createElement("div");return r.body.appendChild(p),a=r.createElement("iframe"),p.appendChild(a),a.src=e,s=setTimeout(function(){d("timeout")},15e3),n=o.unload_add(l),{post:u,cleanup:l,loaded:c}};var I=function(){};I.prototype=new n(["chunk","finish"]),I.prototype._start=function(e,i,s,n){var a=this;try{a.xhr=new XMLHttpRequest}catch(e){}if(!a.xhr)try{a.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=o.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,i,!0)}catch(e){return a.emit("finish",0,""),void a._cleanup()}if(n&&n.no_credentials||(a.xhr.withCredentials="true"),n&&n.headers)for(var r in n.headers)a.xhr.setRequestHeader(r,n.headers[r]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&a.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),a.emit("finish",t,e.responseText),a._cleanup(!1)}}},a.xhr.send(s)},I.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},I.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new I,(o.XHRLocalObject=function(e,t,i){var s=this;o.delay(function(){s._start(e,t,i,{no_credentials:!0})})}).prototype=new I;var $=o.XDRObject=function(e,t,i){var s=this;o.delay(function(){s._start(e,t,i)})};$.prototype=new n(["chunk","finish"]),$.prototype._start=function(e,t,i){var s=this,n=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var a=n.ontimeout=n.onerror=function(){s.emit("finish",0,""),s._cleanup(!1)};n.onprogress=function(){s.emit("chunk",200,n.responseText)},n.onload=function(){s.emit("finish",200,n.responseText),s._cleanup(!1)},s.xdr=n,s.unload_ref=o.unload_add(function(){s._cleanup(!0)});try{s.xdr.open(e,t),s.xdr.send(i)}catch(e){a()}},$.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},$.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:O.enabled()?3:4};var w=function(e,i,s){if(this===t)return new w(e,i,s);var n,a=this;a._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},s&&o.objectExtend(a._options,s),a._base_url=o.amendUrl(e),a._server=a._options.server||o.random_number_string(1e3),a._options.protocols_whitelist&&a._options.protocols_whitelist.length?n=a._options.protocols_whitelist:(n="string"==typeof i&&i.length>0?[i]:o.isArray(i)?i:null)&&a._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),a._protocols=[],a.protocol=null,a.readyState=w.CONNECTING,a._ir=H(a._base_url),a._ir.onfinish=function(e,t){a._ir=null,e?(a._options.info&&(e=o.objectExtend(e,a._options.info)),a._options.rtt&&(t=a._options.rtt),a._applyInfo(e,t,n),a._didClose()):a._didClose(1002,"Can't connect to server",!0)}};w.prototype=new i,w.version="0.3.4",w.CONNECTING=0,w.OPEN=1,w.CLOSING=2,w.CLOSED=3,w.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},w.prototype._dispatchOpen=function(){var e=this;e.readyState===w.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=w.OPEN,e.dispatchEvent(new s("open"))):e._didClose(1006,"Server lost session")},w.prototype._dispatchMessage=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new s("message",{data:e}))},w.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new s("heartbeat",{}))},w.prototype._didClose=function(e,t,i){var n=this;if(n.readyState!==w.CONNECTING&&n.readyState!==w.OPEN&&n.readyState!==w.CLOSING)throw new Error("INVALID_STATE_ERR");n._ir&&(n._ir.nuke(),n._ir=null),n._transport&&(n._transport.doCleanup(),n._transport=null);var a=new s("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&n.readyState===w.CONNECTING&&!i){if(n._try_next_protocol(a))return;a=new s("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:a})}n.readyState=w.CLOSED,o.delay(function(){n.dispatchEvent(a)})},w.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),i=0;i<o.length;i++)t._dispatchMessage(o[i]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},w.prototype._try_next_protocol=function(t){var i=this;for(i.protocol&&(i._debug("Closed transport:",i.protocol,""+t),i.protocol=null),i._transport_tref&&(clearTimeout(i._transport_tref),i._transport_tref=null);;){var s=i.protocol=i._protocols.shift();if(!s)return!1;if(w[s]&&!0===w[s].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return i._protocols.unshift(s),i.protocol="waiting-for-load",o.attachEvent("load",function(){i._try_next_protocol()}),!0;if(w[s]&&w[s].enabled(i._options)){var n=w[s].roundTrips||1,a=(i._options.rto||0)*n||5e3;i._transport_tref=o.delay(a,function(){i.readyState===w.CONNECTING&&i._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=i._base_url+"/"+i._server+"/"+r;return i._debug("Opening transport:",s," url:"+c," RTO:"+i._options.rto),i._transport=new w[s](i,c,i._base_url),!0}i._debug("Skipping transport:",s)}},w.prototype.close=function(e,t){var i=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(i.readyState===w.CONNECTING||i.readyState===w.OPEN)&&(i.readyState=w.CLOSING,i._didClose(e||1e3,t||"Normal closure"),!0)},w.prototype.send=function(e){var t=this;if(t.readyState===w.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===w.OPEN&&t._transport.doSend(o.quote(""+e)),!0},w.prototype._applyInfo=function(t,i,s){var n=this;n._options.info=t,n._options.rtt=i,n._options.rto=o.countRTO(i),n._options.info.null_origin=!e.domain;var a=o.probeProtocols();n._protocols=o.detectProtocols(a,s,t)};var y=w.websocket=function(e,i){var s=this,n=i+"/websocket";n="https"===n.slice(0,5)?"wss"+n.slice(5):"ws"+n.slice(4),s.ri=e,s.url=n;var a=t.WebSocket||t.MozWebSocket;s.ws=new a(s.url),s.ws.onmessage=function(e){s.ri._didMessage(e.data)},s.unload_ref=o.unload_add(function(){s.ws.close()}),s.ws.onclose=function(){s.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};y.prototype.doSend=function(e){this.ws.send("["+e+"]")},y.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},y.enabled=function(){return!(!t.WebSocket&&!t.MozWebSocket)},y.roundTrips=2;var T=function(){};T.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},T.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},T.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},T.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},T.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var C=function(t,i,s){var n=this;if(!("_send_form"in n)){var a=n._send_form=e.createElement("form"),r=n._send_area=e.createElement("textarea");r.name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(r),e.body.appendChild(a)}var a=n._send_form,r=n._send_area,c="a"+o.random_string(8);a.target=c,a.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,a.appendChild(l),l.style.display="none";try{r.value=i}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}a.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",s(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},b=function(e){return function(t,o,i){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){i(200===e||204===e,"http status "+e)},function(e){i(!1,e)}}},A=function(t,i){var s,n,a=e.createElement("script"),r=function(e){n&&(n.parentNode.removeChild(n),n=null),a&&(clearTimeout(s),a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,a=null,i(e),i=null)},c=!1,l=null;if(a.id="a"+o.random_string(8),a.src=t,a.type="text/javascript",a.charset="UTF-8",a.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},a.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},a.onreadystatechange=function(e){if(/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){c=!0;try{a.onclick()}catch(e){}}a&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===a.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))n=e.createElement("script"),n.text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=n.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch(e){}a.async=!0}void 0!==a.async&&(a.async=!0),s=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(a,d.firstChild),n&&d.insertBefore(n,d.firstChild),r},P=w["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var i=this;i.ri=e,i.trans_url=t,i.send_constructor(C),i._schedule_recv()};P.prototype=new T,P.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",A,t)},P.enabled=function(){return!0},P.need_body=!0,P.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(e,i,s){var n="a"+o.random_string(6),a=e+"?c="+escape("_jp."+n),r=0,c=function(e){switch(r){case 0:delete t._jp[n],s(e);break;case 1:s(e),r=2;break;case 2:delete t._jp[n]}},l=i(a,c);return t._jp[n]=l,function(){t._jp[n]&&(r=1,t._jp[n](o.closeFrame(1e3,"JSONP user aborted read")))}},x=function(){};x.prototype=new T,x.prototype.run=function(e,t,o,i,s){var n=this;n.ri=e,n.trans_url=t,n.send_constructor(b(s)),n.poll=new z(e,i,t+o,s)},x.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var D=w["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Y,o.XHRCorsObject)};D.prototype=new x,D.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},D.roundTrips=2,D.need_body=!0;var N=w["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Y,o.XDRObject)};N.prototype=new x,N.enabled=function(){return!!t.XDomainRequest},N.roundTrips=2;var _=w["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,o.XHRCorsObject)};_.prototype=new x,_.enabled=D.enabled,_.roundTrips=2;var k=w["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,o.XDRObject)};k.prototype=new x,k.enabled=N.enabled,k.roundTrips=2;var O=function(){};O.prototype.i_constructor=function(e,t,i){var s=this;s.ri=e,s.origin=o.getOrigin(i),s.base_url=i,s.trans_url=t;var n=i+"/iframe.html";s.ri._options.devel&&(n+="?t="+ +new Date),s.window_id=o.random_string(8),n+="#"+s.window_id,s.iframeObj=o.createIframe(n,function(e){s.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),s.onmessage_cb=o.bind(s.onmessage,s),o.attachMessage(s.onmessage_cb)},O.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},O.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),i=e.data.slice(8,9),s=e.data.slice(9);if(o===t.window_id)switch(i){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([w.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(s)}}},O.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},O.prototype.doSend=function(e){this.postMessage("m",e)},O.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var E,M=function(e,i){parent!==t?parent.postMessage(E+e+(i||""),"*"):o.log("Can't postMessage, no parent window.",e,i)},U=function(){};U.prototype._didClose=function(e,t){M("t",o.closeFrame(e,t))},U.prototype._didMessage=function(e){M("t",e)},U.prototype._doSend=function(e){this._transport.doSend(e)},U.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,w.bootstrap_iframe=function(){var i;E=e.location.hash.slice(1);var s=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var s=e.data.slice(0,8),n=e.data.slice(8,9),a=e.data.slice(9);if(s===E)switch(n){case"s":var r=JSON.parse(a),c=r[0],l=r[1],d=r[2],u=r[3];if(c!==w.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+w.version+'".'),!o.flatUrl(d)||!o.flatUrl(u))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(u))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,u])+")");i=new U,i._transport=new U[l](i,d,u);break;case"m":i._doSend(a);break;case"c":i&&i._doCleanup(),i=null}}};o.attachMessage(s),M("s")};var R=function(e,t){var i=this;o.delay(function(){i.doXhr(e,t)})};R.prototype=new n(["finish"]),R.prototype.doXhr=function(e,t){var i=this,s=(new Date).getTime(),n=new t("GET",e+"/info"),a=o.delay(8e3,function(){n.ontimeout()});n.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var o=(new Date).getTime()-s,n=JSON.parse(t);"object"!=typeof n&&(n={}),i.emit("finish",n,o)}else i.emit("finish")},n.ontimeout=function(){n.close(),i.emit("finish")}};var B=function(t){var i=this,s=function(){var e=new O;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),s=o[0],n=o[1];i.emit("finish",s,n)}else i.emit("finish");e.doCleanup(),e=null},s={_options:{},_didClose:o,_didMessage:o};e.i_constructor(s,t,t)};e.body?s():o.attachEvent("load",s)};B.prototype=new n(["finish"]);var F=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new n(["finish"]);var H=function(e){if(o.isSameOriginUrl(e))return new R(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new R(e,o.XHRLocalObject);case 2:return new R(e,o.XDRObject);case 3:return new B(e);default:return new F}};(U["w-iframe-info-receiver"]=function(e,t,i){new R(i,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var G=w["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};G.prototype=new O,G.enabled=function(){return"EventSource"in t&&O.enabled()},G.need_body=!0,G.roundTrips=3,(U["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",W,o.XHRLocalObject)}).prototype=new x;var V=w["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};V.prototype=new O,V.enabled=function(){return t.XMLHttpRequest&&O.enabled()},V.need_body=!0,V.roundTrips=3,(U["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,o.XHRLocalObject)}).prototype=new x;var j=w["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};j.prototype=new O,j.enabled=function(){return O.enabled()},j.need_body=!0,j.roundTrips=3,(U["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",K,o.XHRLocalObject)}).prototype=new x;var z=function(e,t,o,i){var s=this;s.ri=e,s.Receiver=t,s.recv_url=o,s.AjaxObject=i,s._scheduleRecv()};z.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},z.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var W=function(e){var t=this,i=new EventSource(e);i.onmessage=function(e){t.dispatchEvent(new s("message",{data:unescape(e.data)}))},t.es_close=i.onerror=function(e,n){var a=n?"user":2!==i.readyState?"network":"permanent";t.es_close=i.onmessage=i.onerror=null,i.close(),i=null,o.delay(200,function(){t.dispatchEvent(new s("close",{reason:a}))})}};W.prototype=new i,W.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var q,J=function(){if(void 0===q)if("ActiveXObject"in t)try{q=!!new ActiveXObject("htmlfile")}catch(e){}else q=!1;return q},K=function(e){var i=this;o.polluteGlobalNamespace(),i.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+i.id);var n,a=J()?o.createHtmlfile:o.createIframe;t._jp[i.id]={start:function(){n.loaded()},message:function(e){i.dispatchEvent(new s("message",{data:e}))},stop:function(){i.iframe_close({},"network")}},i.iframe_close=function(e,o){n.cleanup(),i.iframe_close=n=null,delete t._jp[i.id],i.dispatchEvent(new s("close",{reason:o}))},n=a(e,function(e){i.iframe_close({},"permanent")})};K.prototype=new i,K.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var Y=function(e,t){var o=this,i=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var n=t.slice(i),a=n.indexOf("\n");if(-1===a)break;i+=a+1;var r=n.slice(0,a);o.dispatchEvent(new s("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var i=200===e?"network":"permanent";o.dispatchEvent(new s("close",{reason:i}))}};return Y.prototype=new i,Y.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new s("close",{reason:"user"})),e.xo=null)},w.getUtils=function(){return o},w.getIframeTransport=function(){return O},w}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS});var JSON;JSON||(JSON={}),function(){function str(e,t){var o,i,s,n,a,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(n=c.length,o=0;o<n;o+=1)a[o]=str(o,c)||"null";return s=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]",gap=r,s}if(rep&&"object"==typeof rep)for(n=rep.length,o=0;o<n;o+=1)"string"==typeof rep[o]&&(i=rep[o],(s=str(i,c))&&a.push(quote(i)+(gap?": ":":")+s));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(s=str(i,c))&&a.push(quote(i)+(gap?": ":":")+s);return s=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}",gap=r,s}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var i;if(gap="",indent="","number"==typeof o)for(i=0;i<o;i+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,i,s=e[t];if(s&&"object"==typeof s)for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i=walk(s,o),void 0!==i?s[o]=i:delete s[o]);return reviver.call(e,t,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,o={},i=function(){};i.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var i=this._listeners[e];-1===o.arrIndexOf(i,t)&&i.push(t)},i.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var i=this._listeners[e],s=o.arrIndexOf(i,t);return-1!==s?void(i.length>1?this._listeners[e]=i.slice(0,s).concat(i.slice(s+1)):delete this._listeners[e]):void 0}},i.prototype.dispatchEvent=function(e){var t=e.type,o=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,o),this._listeners&&t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,o)};var s=function(e,t){if(this.type=e,void 0!==t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};s.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var o=this[t];"function"==typeof o&&(o="[function]"),e.push(t+"="+o)}return"SimpleEvent("+e.join(", ")+")"};var n=function(e){var t=this;t._events=e||[],t._listeners={}};n.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var o=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,o),e in t._listeners)for(var i=0;i<t._listeners[e].length;i++)t._listeners[e][i].apply(t,o)}},n.prototype.on=function(e,t){var o=this;o._verifyType(e),o._nuked||(e in o._listeners||(o._listeners[e]=[]),o._listeners[e].push(t))},n.prototype._verifyType=function(e){var t=this;-1===o.arrIndexOf(t._events,e)&&o.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},n.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var a="abcdefghijklmnopqrstuvwxyz0123456789_";o.random_string=function(e,t){t=t||a.length;var o,i=[];for(o=0;o<e;o++)i.push(a.substr(Math.floor(Math.random()*t),1));return i.join("")},o.random_number=function(e){return Math.floor(Math.random()*e)},o.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+o.random_number(e)).slice(-t)},o.getOrigin=function(e){return e+="/",e.split("/").slice(0,3).join("/")},o.isSameOriginUrl=function(e,o){return o||(o=t.location.href),e.split("/").slice(0,3).join("/")===o.split("/").slice(0,3).join("/")},o.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},o.objectExtend=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e};var r="_jp";o.polluteGlobalNamespace=function(){r in t||(t[r]={})},o.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},o.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},o.countRTO=function(e){return e>100?3*e:e+200},o.log=function(){t.console&&console.log&&console.log.apply},o.bind=function(e,t){
return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},o.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},o.amendUrl=function(t){var i=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!o.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=i.protocol+t),0===t.indexOf("/")&&(t=i.protocol+"//"+i.host+t),t=t.replace(/[\/]+$/,"")},o.arrIndexOf=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},o.arrSkip=function(e,t){var i=o.arrIndexOf(e,t);return-1===i?e.slice():e.slice(0,i).concat(e.slice(i+1))},o.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},o.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var c,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},u=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return l.lastIndex=0,l.test(e)&&(e=e.replace(l,function(e){return d[e]})),'"'+e+'"'},g=function(e){var t,o={},i=[];for(t=0;t<65536;t++)i.push(String.fromCharCode(t));return e.lastIndex=0,i.join("").replace(e,function(e){return o[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,o};o.quote=function(e){var t=p(e);return u.lastIndex=0,u.test(t)?(c||(c=g(u)),t.replace(u,function(e){return c[e]})):t};var m=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];o.probeProtocols=function(){for(var e={},t=0;t<m.length;t++){var o=m[t];e[o]=y[o]&&y[o].enabled()}return e},o.detectProtocols=function(e,t,o){var i={},s=[];t||(t=m);for(var n=0;n<t.length;n++){var a=t[n];i[a]=e[a]}var r=function(e){var t=e.shift();i[t]?s.push(t):e.length>0&&r(e)};return!1!==o.websocket&&r(["websocket"]),i["xhr-streaming"]&&!o.null_origin?s.push("xhr-streaming"):!i["xdr-streaming"]||o.cookie_needed||o.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):s.push("xdr-streaming"),i["xhr-polling"]&&!o.null_origin?s.push("xhr-polling"):!i["xdr-polling"]||o.cookie_needed||o.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):s.push("xdr-polling"),s};var f="_sockjs_global";o.createHook=function(){var e="a"+o.random_string(8);if(!(f in t)){var i={};t[f]=function(e){return e in i||(i[e]={id:e,del:function(){delete i[e]}}),i[e]}}return t[f](e)},o.attachMessage=function(e){o.attachEvent("message",e)},o.attachEvent=function(o,i){void 0!==t.addEventListener?t.addEventListener(o,i,!1):(e.attachEvent("on"+o,i),t.attachEvent("on"+o,i))},o.detachMessage=function(e){o.detachEvent("message",e)},o.detachEvent=function(o,i){void 0!==t.addEventListener?t.removeEventListener(o,i,!1):(e.detachEvent("on"+o,i),t.detachEvent("on"+o,i))};var h={},v=!1,S=function(){for(var e in h)h[e](),delete h[e]},I=function(){v||(v=!0,S())};o.attachEvent("unload",I),o.unload_add=function(e){var t=o.random_string(8);return h[t]=e,v&&o.delay(S),t},o.unload_del=function(e){e in h&&delete h[e]},o.createIframe=function(t,i){var s,n,a=e.createElement("iframe"),r=function(){clearTimeout(s);try{a.onload=null}catch(e){}a.onerror=null},c=function(){a&&(r(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),o.unload_del(n))},l=function(e){a&&(c(),i(e))},d=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}};return a.src=t,a.style.display="none",a.style.position="absolute",a.onerror=function(){l("onerror")},a.onload=function(){clearTimeout(s),s=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(a),s=setTimeout(function(){l("timeout")},15e3),n=o.unload_add(c),{post:d,cleanup:c,loaded:r}},o.createHtmlfile=function(e,i){var s,n,a,c=new ActiveXObject("htmlfile"),l=function(){clearTimeout(s)},d=function(){c&&(l(),o.unload_del(n),a.parentNode.removeChild(a),a=c=null,CollectGarbage())},u=function(e){c&&(d(),i(e))},p=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}};c.open(),c.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),c.close(),c.parentWindow[r]=t[r];var g=c.createElement("div");return c.body.appendChild(g),a=c.createElement("iframe"),g.appendChild(a),a.src=e,s=setTimeout(function(){u("timeout")},15e3),n=o.unload_add(d),{post:p,cleanup:d,loaded:l}};var $=function(){};$.prototype=new n(["chunk","finish"]),$.prototype._start=function(e,i,s,n){var a=this;try{a.xhr=new XMLHttpRequest}catch(e){}if(!a.xhr)try{a.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=o.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,i,!0)}catch(e){return a.emit("finish",0,""),void a._cleanup()}if(n&&n.no_credentials||(a.xhr.withCredentials="true"),n&&n.headers)for(var r in n.headers)a.xhr.setRequestHeader(r,n.headers[r]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,o=e.responseText}catch(e){}1223===t&&(t=204),o&&o.length>0&&a.emit("chunk",t,o);break;case 4:var t=e.status;1223===t&&(t=204),a.emit("finish",t,e.responseText),a._cleanup(!1)}}},a.xhr.send(s)},$.prototype._cleanup=function(e){var t=this;if(t.xhr){if(o.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},$.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(o.XHRCorsObject=function(){var e=this,t=arguments;o.delay(function(){e._start.apply(e,t)})}).prototype=new $,(o.XHRLocalObject=function(e,t,i){var s=this;o.delay(function(){s._start(e,t,i,{no_credentials:!0})})}).prototype=new $;var w=o.XDRObject=function(e,t,i){var s=this;o.delay(function(){s._start(e,t,i)})};w.prototype=new n(["chunk","finish"]),w.prototype._start=function(e,t,i){var s=this,n=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var a=n.ontimeout=n.onerror=function(){s.emit("finish",0,""),s._cleanup(!1)};n.onprogress=function(){s.emit("chunk",200,n.responseText)},n.onload=function(){s.emit("finish",200,n.responseText),s._cleanup(!1)},s.xdr=n,s.unload_ref=o.unload_add(function(){s._cleanup(!0)});try{s.xdr.open(e,t),s.xdr.send(i)}catch(e){a()}},w.prototype._cleanup=function(e){var t=this;if(t.xdr){if(o.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},w.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},o.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:E.enabled()?3:4};var y=function(e,i,s){if(this===t)return new y(e,i,s);var n,a=this;a._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},s&&o.objectExtend(a._options,s),a._base_url=o.amendUrl(e),a._server=a._options.server||o.random_number_string(1e3),a._options.protocols_whitelist&&a._options.protocols_whitelist.length?n=a._options.protocols_whitelist:(n="string"==typeof i&&i.length>0?[i]:o.isArray(i)?i:null)&&a._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),a._protocols=[],a.protocol=null,a.readyState=y.CONNECTING,a._ir=G(a._base_url),a._ir.onfinish=function(e,t){a._ir=null,e?(a._options.info&&(e=o.objectExtend(e,a._options.info)),a._options.rtt&&(t=a._options.rtt),a._applyInfo(e,t,n),a._didClose()):a._didClose(1002,"Can't connect to server",!0)}};y.prototype=new i,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&o.log.apply(o,arguments)},y.prototype._dispatchOpen=function(){var e=this;e.readyState===y.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=y.OPEN,e.dispatchEvent(new s("open"))):e._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new s("message",{data:e}))},y.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===y.OPEN&&t.dispatchEvent(new s("heartbeat",{}))},y.prototype._didClose=function(e,t,i){var n=this;if(n.readyState!==y.CONNECTING&&n.readyState!==y.OPEN&&n.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");n._ir&&(n._ir.nuke(),n._ir=null),n._transport&&(n._transport.doCleanup(),n._transport=null);var a=new s("close",{code:e,reason:t,wasClean:o.userSetCode(e)});if(!o.userSetCode(e)&&n.readyState===y.CONNECTING&&!i){if(n._try_next_protocol(a))return;a=new s("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:a})}n.readyState=y.CLOSED,o.delay(function(){n.dispatchEvent(a)})},y.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var o=JSON.parse(e.slice(1)||"[]"),i=0;i<o.length;i++)t._dispatchMessage(o[i]);break;case"m":var o=JSON.parse(e.slice(1)||"null");t._dispatchMessage(o);break;case"c":var o=JSON.parse(e.slice(1)||"[]");t._didClose(o[0],o[1]);break;case"h":t._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(t){var i=this;for(i.protocol&&(i._debug("Closed transport:",i.protocol,""+t),i.protocol=null),i._transport_tref&&(clearTimeout(i._transport_tref),i._transport_tref=null);;){var s=i.protocol=i._protocols.shift();if(!s)return!1;if(y[s]&&!0===y[s].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return i._protocols.unshift(s),i.protocol="waiting-for-load",o.attachEvent("load",function(){i._try_next_protocol()}),!0;if(y[s]&&y[s].enabled(i._options)){var n=y[s].roundTrips||1,a=(i._options.rto||0)*n||5e3;i._transport_tref=o.delay(a,function(){i.readyState===y.CONNECTING&&i._didClose(2007,"Transport timeouted")});var r=o.random_string(8),c=i._base_url+"/"+i._server+"/"+r;return i._debug("Opening transport:",s," url:"+c," RTO:"+i._options.rto),i._transport=new y[s](i,c,i._base_url),!0}i._debug("Skipping transport:",s)}},y.prototype.close=function(e,t){var i=this;if(e&&!o.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(i.readyState===y.CONNECTING||i.readyState===y.OPEN)&&(i.readyState=y.CLOSING,i._didClose(e||1e3,t||"Normal closure"),!0)},y.prototype.send=function(e){var t=this;if(t.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===y.OPEN&&t._transport.doSend(o.quote(""+e)),!0},y.prototype._applyInfo=function(t,i,s){var n=this;n._options.info=t,n._options.rtt=i,n._options.rto=o.countRTO(i),n._options.info.null_origin=!e.domain;var a=o.probeProtocols();n._protocols=o.detectProtocols(a,s,t)};var T=y.websocket=function(e,i){var s=this,n=i+"/websocket";n="https"===n.slice(0,5)?"wss"+n.slice(5):"ws"+n.slice(4),s.ri=e,s.url=n;var a=t.WebSocket||t.MozWebSocket;s.ws=new a(s.url),s.ws.onmessage=function(e){s.ri._didMessage(e.data)},s.unload_ref=o.unload_add(function(){s.ws.close()}),s.ws.onclose=function(){s.ri._didMessage(o.closeFrame(1006,"WebSocket connection broken"))}};T.prototype.doSend=function(e){this.ws.send("["+e+"]")},T.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),o.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},T.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},T.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},C.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=o.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,o){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+o):e.send_schedule_wait()}),e.send_buffer=[]}},C.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var b=function(t,i,s){var n=this;if(!("_send_form"in n)){var a=n._send_form=e.createElement("form"),r=n._send_area=e.createElement("textarea");r.name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(r),e.body.appendChild(a)}var a=n._send_form,r=n._send_area,c="a"+o.random_string(8);a.target=c,a.action=t+"/jsonp_send?i="+c;var l;try{l=e.createElement('<iframe name="'+c+'">')}catch(t){l=e.createElement("iframe"),l.name=c}l.id=c,a.appendChild(l),l.style.display="none";try{r.value=i}catch(e){o.log("Your browser is seriously broken. Go home! "+e.message)}a.submit();var d=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,o.delay(500,function(){l.parentNode.removeChild(l),l=null}),r.value="",s(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(e){"complete"==l.readyState&&d()},d},A=function(e){return function(t,o,i){return new e("POST",t+"/xhr_send",o).onfinish=function(e,t){i(200===e||204===e,"http status "+e)},function(e){i(!1,e)}}},P=function(t,i){var s,n,a=e.createElement("script"),r=function(e){n&&(n.parentNode.removeChild(n),n=null),a&&(clearTimeout(s),a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,a=null,i(e),i=null)},c=!1,l=null;if(a.id="a"+o.random_string(8),a.src=t,a.type="text/javascript",a.charset="UTF-8",a.onerror=function(e){l||(l=setTimeout(function(){c||r(o.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},a.onload=function(e){r(o.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},a.onreadystatechange=function(e){if(/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){c=!0;try{a.onclick()}catch(e){}}a&&r(o.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===a.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))n=e.createElement("script"),n.text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=n.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch(e){}a.async=!0}void 0!==a.async&&(a.async=!0),s=setTimeout(function(){r(o.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(a,d.firstChild),n&&d.insertBefore(n,d.firstChild),r},L=y["jsonp-polling"]=function(e,t){o.polluteGlobalNamespace();var i=this;i.ri=e,i.trans_url=t,i.send_constructor(b),i._schedule_recv()};L.prototype=new C,L.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=x(e.trans_url+"/jsonp",P,t)},L.enabled=function(){return!0},L.need_body=!0,L.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var x=function(e,i,s){var n="a"+o.random_string(6),a=e+"?c="+escape(r+"."+n),c=0,l=function(e){switch(c){case 0:delete t[r][n],s(e);break;case 1:s(e),c=2;break;case 2:delete t[r][n]}},d=i(a,l);return t[r][n]=d,function(){t[r][n]&&(c=1,t[r][n](o.closeFrame(1e3,"JSONP user aborted read")))}},D=function(){};D.prototype=new C,D.prototype.run=function(e,t,o,i,s){var n=this;n.ri=e,n.trans_url=t,n.send_constructor(A(s)),n.poll=new W(e,i,t+o,s)},D.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var N=y["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XHRCorsObject)};N.prototype=new D,N.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},N.roundTrips=2,N.need_body=!0;var _=y["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Q,o.XDRObject)};_.prototype=new D,_.enabled=function(){return!!t.XDomainRequest},_.roundTrips=2;var k=y["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRCorsObject)};k.prototype=new D,k.enabled=N.enabled,k.roundTrips=2;var O=y["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XDRObject)};O.prototype=new D,O.enabled=_.enabled,O.roundTrips=2;var E=function(){};E.prototype.i_constructor=function(e,t,i){var s=this;s.ri=e,s.origin=o.getOrigin(i),s.base_url=i,s.trans_url=t;var n=i+"/iframe.html";s.ri._options.devel&&(n+="?t="+ +new Date),s.window_id=o.random_string(8),n+="#"+s.window_id,s.iframeObj=o.createIframe(n,function(e){s.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),s.onmessage_cb=o.bind(s.onmessage,s),o.attachMessage(s.onmessage_cb)},E.prototype.doCleanup=function(){var e=this;if(e.iframeObj){o.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},E.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var o=e.data.slice(0,8),i=e.data.slice(8,9),s=e.data.slice(9);if(o===t.window_id)switch(i){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([y.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(s)}}},E.prototype.postMessage=function(e,t){var o=this;o.iframeObj.post(o.window_id+e+(t||""),o.origin)},E.prototype.doSend=function(e){this.postMessage("m",e)},E.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var M,U=function(e,i){parent!==t?parent.postMessage(M+e+(i||""),"*"):o.log("Can't postMessage, no parent window.",e,i)},R=function(){};R.prototype._didClose=function(e,t){U("t",o.closeFrame(e,t))},R.prototype._didMessage=function(e){U("t",e)},R.prototype._doSend=function(e){this._transport.doSend(e)},R.prototype._doCleanup=function(){this._transport.doCleanup()},o.parent_origin=void 0,y.bootstrap_iframe=function(){var i;M=e.location.hash.slice(1);var s=function(e){if(e.source===parent&&(void 0===o.parent_origin&&(o.parent_origin=e.origin),e.origin===o.parent_origin)){var s=e.data.slice(0,8),n=e.data.slice(8,9),a=e.data.slice(9);if(s===M)switch(n){case"s":var r=JSON.parse(a),c=r[0],l=r[1],d=r[2],u=r[3];if(c!==y.version&&o.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+y.version+'".'),!o.flatUrl(d)||!o.flatUrl(u))return void o.log("Only basic urls are supported in SockJS");if(!o.isSameOriginUrl(d)||!o.isSameOriginUrl(u))return void o.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,d,u])+")");i=new R,i._transport=new R[l](i,d,u);break;case"m":i._doSend(a);break;case"c":i&&i._doCleanup(),i=null}}};o.attachMessage(s),U("s")};var B=function(e,t){var i=this;o.delay(function(){i.doXhr(e,t)})};B.prototype=new n(["finish"]),B.prototype.doXhr=function(e,t){var i=this,s=(new Date).getTime(),n=new t("GET",e+"/info"),a=o.delay(8e3,function(){n.ontimeout()});n.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var o=(new Date).getTime()-s,n=JSON.parse(t);"object"!=typeof n&&(n={}),i.emit("finish",n,o)}else i.emit("finish")},n.ontimeout=function(){n.close(),i.emit("finish")}};var F=function(t){var i=this,s=function(){var e=new E;e.protocol="w-iframe-info-receiver";var o=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var o=JSON.parse(t.substr(1)),s=o[0],n=o[1];i.emit("finish",s,n)}else i.emit("finish");e.doCleanup(),e=null},s={_options:{},_didClose:o,_didMessage:o};e.i_constructor(s,t,t)};e.body?s():o.attachEvent("load",s)};F.prototype=new n(["finish"]);var H=function(){var e=this;o.delay(function(){e.emit("finish",{},2e3)})};H.prototype=new n(["finish"]);var G=function(e){if(o.isSameOriginUrl(e))return new B(e,o.XHRLocalObject);switch(o.isXHRCorsCapable()){case 1:return new B(e,o.XHRLocalObject);case 2:return new B(e,o.XDRObject);case 3:return new F(e);default:return new H}};(R["w-iframe-info-receiver"]=function(e,t,i){new B(i,o.XHRLocalObject).onfinish=function(t,o){e._didMessage("m"+JSON.stringify([t,o])),e._didClose()}}).prototype.doCleanup=function(){};var V=y["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};V.prototype=new E,V.enabled=function(){return"EventSource"in t&&E.enabled()},V.need_body=!0,V.roundTrips=3,(R["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",q,o.XHRLocalObject)}).prototype=new D;var j=y["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};j.prototype=new E,j.enabled=function(){return t.XMLHttpRequest&&E.enabled()},j.need_body=!0,j.roundTrips=3,(R["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Q,o.XHRLocalObject)}).prototype=new D;var z=y["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};z.prototype=new E,z.enabled=function(){return E.enabled()},z.need_body=!0,z.roundTrips=3,(R["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",Y,o.XHRLocalObject)}).prototype=new D;var W=function(e,t,o,i){var s=this;s.ri=e,s.Receiver=t,s.recv_url=o,s.AjaxObject=i,s._scheduleRecv()};W.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),o=0;t.onmessage=function(t){o+=1,e.ri._didMessage(t.data)},t.onclose=function(o){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===o.reason?e.ri._didClose(1006,"Polling error ("+o.reason+")"):e._scheduleRecv())}},W.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var q=function(e){var t=this,i=new EventSource(e);i.onmessage=function(e){t.dispatchEvent(new s("message",{data:unescape(e.data)}))},t.es_close=i.onerror=function(e,n){var a=n?"user":2!==i.readyState?"network":"permanent";t.es_close=i.onmessage=i.onerror=null,i.close(),i=null,o.delay(200,function(){t.dispatchEvent(new s("close",{reason:a}))})}};q.prototype=new i,q.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var J,K=function(){if(void 0===J)if("ActiveXObject"in t)try{J=!!new ActiveXObject("htmlfile")}catch(e){}else J=!1;return J},Y=function(e){var i=this;o.polluteGlobalNamespace(),i.id="a"+o.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(r+"."+i.id);var n,a=K()?o.createHtmlfile:o.createIframe;t[r][i.id]={start:function(){n.loaded()},message:function(e){i.dispatchEvent(new s("message",{data:e}))},stop:function(){i.iframe_close({},"network")}},i.iframe_close=function(e,o){n.cleanup(),i.iframe_close=n=null,delete t[r][i.id],i.dispatchEvent(new s("close",{reason:o}))},n=a(e,function(e){i.iframe_close({},"permanent")})};Y.prototype=new i,Y.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var Q=function(e,t){var o=this,i=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var n=t.slice(i),a=n.indexOf("\n");if(-1===a)break;i+=a+1;var r=n.slice(0,a);o.dispatchEvent(new s("message",{data:r}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var i=200===e?"network":"permanent";o.dispatchEvent(new s("close",{reason:i}))}};return Q.prototype=new i,Q.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new s("close",{reason:"user"})),e.xo=null)},y.getUtils=function(){return o},y.getIframeTransport=function(){return E},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS})(function(){var e,t,o,i,s={}.hasOwnProperty,n=[].slice;e={LF:"\n",NULL:"\0"},o=function(){function t(e,t,o){this.command=e,this.headers=null!=t?t:{},this.body=null!=o?o:""}var o;return t.prototype.toString=function(){var o,i,n,a,r;o=[this.command],n=!1===this.headers["content-length"],n&&delete this.headers["content-length"],r=this.headers;for(i in r)s.call(r,i)&&(a=r[i],o.push(i+":"+a));return this.body&&!n&&o.push("content-length:"+t.sizeOfUTF8(this.body)),o.push(e.LF+this.body),o.join(e.LF)},t.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},o=function(o){var i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I;for(a=o.search(RegExp(""+e.LF+e.LF)),r=o.substring(0,a).split(e.LF),n=r.shift(),c={},m=function(e){return e.replace(/^\s+|\s+$/g,"")},S=r.reverse(),f=0,v=S.length;f<v;f++)p=S[f],d=p.indexOf(":"),c[m(p.substring(0,d))]=m(p.substring(d+1));if(i="",g=a+2,c["content-length"])u=parseInt(c["content-length"]),i=(""+o).substring(g,g+u);else for(s=null,l=h=g,I=o.length;(g<=I?h<I:h>I)&&(s=o.charAt(l))!==e.NULL;l=g<=I?++h:--h)i+=s;return new t(n,c,i)},t.unmarshall=function(t){var i,s,n,a;return s=t.split(RegExp(""+e.NULL+e.LF+"*")),a={frames:[],partial:""},a.frames=function(){var e,t,n,a;for(n=s.slice(0,-1),a=[],e=0,t=n.length;e<t;e++)i=n[e],a.push(o(i));return a}(),n=s.slice(-1)[0],n===e.LF||-1!==n.search(RegExp(""+e.NULL+e.LF+"*$"))?a.frames.push(o(n)):a.partial=n,a},t.marshall=function(o,i,s){var n;return n=new t(o,i,s),n.toString()+e.NULL},t}(),t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var s;return t.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},s=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(e,t,i){var s;for(s=o.marshall(e,t,i),"function"==typeof this.debug&&this.debug(">>> "+s);;){if(!(s.length>this.maxWebSocketFrameSize))return this.ws.send(s);this.ws.send(s.substring(0,this.maxWebSocketFrameSize)),s=s.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+s.length)}},t.prototype._setupHeartbeat=function(t){var o,n,a,r,c,l;if((c=t.version)===i.VERSIONS.V1_1||c===i.VERSIONS.V1_2)return l=function(){var e,o,i,s;for(i=t["heart-beat"].split(","),s=[],e=0,o=i.length;e<o;e++)r=i[e],s.push(parseInt(r));return s}(),n=l[0],o=l[1],0!==this.heartbeat.outgoing&&0!==o&&(a=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+a+"ms"),this.pinger=i.setInterval(a,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==n?(a=Math.max(this.heartbeat.incoming,n),"function"==typeof this.debug&&this.debug("check PONG every "+a+"ms"),this.ponger=i.setInterval(a,function(e){return function(){var t;if((t=s()-e.serverActivity)>2*a)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+t+"ms"),e.ws.close()}}(this))):void 0},t.prototype._parseConnect=function(){var e,t,o,i;switch(e=1<=arguments.length?n.call(arguments,0):[],i={},e.length){case 2:i=e[0],t=e[1];break;case 3:e[1]instanceof Function?(i=e[0],t=e[1],o=e[2]):(i.login=e[0],i.passcode=e[1],t=e[2]);break;case 4:i.login=e[0],i.passcode=e[1],t=e[2],o=e[3];break;default:i.login=e[0],i.passcode=e[1],t=e[2],o=e[3],i.host=e[4]}return[i,t,o]},t.prototype.connect=function(){var t,a,r,c;return t=1<=arguments.length?n.call(arguments,0):[],c=this._parseConnect.apply(this,t),r=c[0],this.connectCallback=c[1],a=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(i){var n,r,c,l,d,u,p,g,m,f,h,v,S;if(l="undefined"!=typeof ArrayBuffer&&i.data instanceof ArrayBuffer?(n=new Uint8Array(i.data),"function"==typeof t.debug&&t.debug("--- got data length: "+n.length),function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)r=n[e],o.push(String.fromCharCode(r));return o}().join("")):i.data,t.serverActivity=s(),l===e.LF)return void("function"==typeof t.debug&&t.debug("<<< PONG"));for("function"==typeof t.debug&&t.debug("<<< "+l),m=o.unmarshall(t.partialData+l),t.partialData=m.partial,v=m.frames,S=[],f=0,h=v.length;f<h;f++)switch(d=v[f],d.command){case"CONNECTED":"function"==typeof t.debug&&t.debug("connected to server "+d.headers.server),t.connected=!0,t._setupHeartbeat(d.headers),S.push("function"==typeof t.connectCallback?t.connectCallback(d):void 0);break;case"MESSAGE":g=d.headers.subscription,p=t.subscriptions[g]||t.onreceive,p?(c=t,u=d.headers["message-id"],d.ack=function(e){return null==e&&(e={}),c.ack(u,g,e)},d.nack=function(e){return null==e&&(e={}),c.nack(u,g,e)},S.push(p(d))):S.push("function"==typeof t.debug?t.debug("Unhandled received MESSAGE: "+d):void 0);break;case"RECEIPT":S.push("function"==typeof t.onreceipt?t.onreceipt(d):void 0);break;case"ERROR":S.push("function"==typeof a?a(d):void 0);break;default:S.push("function"==typeof t.debug?t.debug("Unhandled frame: "+d):void 0)}return S}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof a?a(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),r["accept-version"]=i.VERSIONS.supportedVersions(),r["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",r)}}(this)},t.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger)return i.clearInterval(this.ponger)},t.prototype.send=function(e,t,o){
return null==t&&(t={}),null==o&&(o=""),t.destination=e,this._transmit("SEND",t,o)},t.prototype.subscribe=function(e,t,o){var i;return null==o&&(o={}),o.id||(o.id="sub-"+this.counter++),o.destination=e,this.subscriptions[o.id]=t,this._transmit("SUBSCRIBE",o),i=this,{id:o.id,unsubscribe:function(){return i.unsubscribe(o.id)}}},t.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},t.prototype.begin=function(e){var t,o;return o=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:o}),t=this,{id:o,commit:function(){return t.commit(o)},abort:function(){return t.abort(o)}}},t.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},t.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},t.prototype.ack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("ACK",o)},t.prototype.nack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("NACK",o)},t}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,o){var s,n;return null==o&&(o=["v10.stomp","v11.stomp"]),s=i.WebSocketClass||WebSocket,n=new s(e,o),new t(n)},over:function(e){return new t(e)},Frame:o},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=i),"undefined"!=typeof window&&null!==window?(i.setInterval=function(e,t){return window.setInterval(t,e)},i.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=i):exports||(self.Stomp=i)}).call(this),APP.controller("CouponsDetailController",["$rootScope","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","CouponsDetailNewService","$ionicScrollDelegate","GetCouponsService","$interval",function(e,t,o,i,s,n,a,r,c,l,d,u){function p(){for(var e=0;e<window.screen.availWidth/12;e++)t.divStr[e]=12*e+4}function g(e){return!!/^1[34578]\d{9}$/.test(e)}function m(e){return e=e<10?"0"+e:e}function f(e,o){t.endT=o-e,I=u(function(){t.endTt=m(Math.floor(t.endT/86400)),t.endTh=m(Math.floor((t.endT-86400*t.endTt)/3600)),t.endTm=m(Math.floor((t.endT-86400*t.endTt-3600*t.endTh)/60)),t.endTs=m(t.endT-86400*t.endTt-3600*t.endTh-60*t.endTm),-1==--t.endT&&($state.reload(),u.cancel(I))},1e3)}var h=a.cId,v="",S="";t.data="";var I;t.remindme=!1,t.remindSuccess=!1,t.canSubmit=!1,t.endT="",t.endTt="",t.endTh="",t.endTm="",t.endTs="",t.divStr=[],t.backGroundBlue={background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},t.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},t.openRemindMe=function(e){h=e,t.remindme=!0},t.closeRemindMe=function(){t.remindme=!1},t.telVerification=function(e){11==e.length&&g(e)?(v=e,t.canSubmit=!0):t.canSubmit=!1},t.submitBackstage=function(){d.doRemindCoupons(v,h).success(function(o){t.message=o.message,t.remindme=!1,t.remindSuccess=!0,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500),o.success&&(l.scrollTop(),t.getCouponsData(),e.$broadcast("COUPONS_DETAIL_STATE",S))})},t.progress=function(e){return.9*e},t.getNewCoupons=function(o){d.doGetNewCoupons(o).success(function(o){o.success?(l.scrollTop(),e.$broadcast("COUPONS_DETAIL_STATE",S),startIndex=1,t.getCouponsData()):(t.remindSuccess=!0,t.message=o.message,setTimeout(function(){t.$apply(function(){t.remindSuccess=!1})},1500))})},t.goBack=function(){"advertisement"==e.fromState?$state.go("homePage"):t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.getCouponsData=function(){u.cancel(I),c.getCouponsDataNew(h).success(function(e){t.data=e.data,f(e.data.nowTime,e.data.activityStartTime)})},t.$on("$ionicView.beforeEnter",function(){t.data="",S=a.type,p(),t.getCouponsData()}),t.$on("$ionicView.beforeLeave",function(){u.cancel(I)})}]),APP.service("CouponsDetailNewService",["$http","UrlService",function(e,t){this.getCouponsDataNew=function(o){var i={couponId:o};return e.get(t.getUrl("COUPONS_DETAIL_LIST"),i)}}]),APP.controller("CouponsDetailTwoController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","CouponsDetailTwoService","$timeout","UrlService","$ionicPopup","PopupService","$ionicHistory",function(e,t,o,i,s,n,a,r,c,l,d){e.htmlContent=o.content,e.title=o.title,e.id=o.cId,e.userID=o.userID,e.type=o.type,e.status=o.status,e.couponId=o.couponId,e.isUser=o.isUser,e.$on("$ionicView.beforeEnter",function(){e.data="",e.init()}),e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=c.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(t){t.preventDefault(),null!=e.data.memberId?n.getMemberName(e.data.memberId).success(function(t,i,s,n){1==t.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,e.couponId),e.data.messsage=t.data):(e.findMember=!1,e.data.messsage=t.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){c.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?n.donationCoupons(e.data.memberId,o).success(function(t,o,i,s){1==t.success&&0!=t.result?(d.goBack(),e.data.messsage=t.data):0==t.result&&l.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.init=function(){e.htmlContent=o.content,e.title=o.title,n.initData(e.id,e.userID,e.type,e.couponId).success(function(t,o,i,s){e.data=t.data,e.haveCity=!1,e.haveArea=!1,e.haveStreet=!1;for(var n in e.data.cityNameMap)e.haveCity=!0;for(var a in e.data.areaNameMap)e.haveArea=!0;for(var r in e.data.streetNameMap)e.haveStreet=!0})},e.getCouponSuccess="",e.getCoupon=!1,e.getCoupons=function(){n.receiveCoupons(e.data.coupon.id).success(function(t,o,i,s){e.getCouponSuccess=t.data,e.getCoupon=!e.getCoupon}),a(function(){e.getCouponSuccess=""},5e3),e.share=function(){if(window.umeng){var t=r.getSharePicHeader()+"mstatic/wd/v2/img/sg.png",o=r.getShareLinkHeader()+"mstore/sg/coupon/toList.html?id="+e.id+"&type=0&storeId="+UserService.getUser().mid+"&lastUrl=4";window.umeng.share("顺逛领领券频道,优惠券等您来抢","给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",t,o,0)}}}}]),APP.service("CouponsDetailTwoService",["$http","UrlService",function(e,t){this.donationCoupons=function(o,i){var s={memberId:o,id:i};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:s})},this.getMemberName=function(o){var i={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:i})},this.initData=function(o,i,s,n){var a={id:o,storeId:i,type:s,lastUrl:"",mId:n};return e.get(t.getUrl("GET_COUPONS_DETAIL"),a)},this.receiveCoupons=function(o){var i={couponId:o};return e({method:"POST",url:t.getUrl("RECEIVE_COUPONS"),params:i})}}]),APP.controller("GetCouponsListController",["$rootScope","HomePageService","$scope","$ionicHistory","PopupService","CreditService","UrlService","$stateParams","$http","GetCouponsService","$ionicScrollDelegate","$state","$interval","UserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(){for(var e=0;e<window.screen.availWidth/12;e++)o.divStr[e]=12*e+4}function f(e){return!!/^1[34578]\d{9}$/.test(e)}function h(e){return e=e<10?"0"+e:e}function v(e,t,i){o.endT[i]=t-e,T[i]=p(function(){o.endTt[i]=h(Math.floor(o.endT[i]/86400)),o.endTh[i]=h(Math.floor((o.endT[i]-86400*o.endTt[i])/3600)),o.endTm[i]=h(Math.floor((o.endT[i]-86400*o.endTt[i]-3600*o.endTh[i])/60)),o.endTs[i]=h(o.endT[i]-86400*o.endTt[i]-3600*o.endTh[i]-60*o.endTm[i]),-1==--o.endT[i]&&(u.reload(),p.cancel(T[i]))},1e3)}o.dataList="",o.typeIdDefault="";var S="",I="";o.divStr=[],o.remindme=!1,o.remindSuccess=!1,o.canSubmit=!1;var $=[],w=[],y=[],T=[],C="";o.hasmore=!1,o.isHasCoupons=!1;var b=1;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.endT=[],o.endTt=[],o.endTh=[],o.endTm=[],o.endTs=[],o.goBack=function(){"advertisement"==e.fromState?u.go("homePage"):o.$ionicGoBack()},o.share=function(){if(window.cordova){if(!g.getUser().mid)return void u.go("login");o.showShare=!0}else s.showAlert("只能在app分享","抱歉，只能在app分享")},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"},o.typeClass={top:"59px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"},o.typeClass={top:"43px"}),o.backGroundBlue={background:"url("+e.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},o.backGroundRed={background:"url("+e.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},o.typeAllShow=!1,o.typeDefault=0,o.typeDataList=[],o.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},o.noTypeStyle={color:"rgba(102,102,102,0.87)"},o.isTypeStyleAll={border:"1px solid #2979FF",color:"#2979FF"},o.noTypeStyleAll={color:"rgba(76,76,76,0.87)",border:"1px solid #999"},o.typeButton=function(e,t){o.isHasCoupons=!1,o.typeDefault=e,o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.allTypeButton=function(e,t){if(o.isHasCoupons=!1,e>1){var i=o.typeDataList[e];o.typeDataList.splice(e,1),o.typeDataList.splice(1,0,i),o.typeDefault=1}else o.typeDefault=e;o.typeAllShow=!1,o.typeIdDefault=t,o.init(t),d.scrollTop()},o.cotAllType=function(e){o.typeAllShow=e},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="顺逛领券频道,优惠券等您来抢",i="给您推荐顺逛领券频道,超值优惠券每日限量抢,不可错过哦!",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",r=a.getShareLinkHeader()+"getCouponsList/"+g.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,i,s,r,0,null,n.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,i,s,r,0,null,n.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,i,s,r,0,null,n.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,i,s,r,0,null,n.shareSuccessCallback),n.qqShare()):4==e&&(window.umeng.shareToQzone(t,i,s,r,0,null,n.shareSuccessCallback),n.qqShare()),5==e?o.copeText(r):n.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.openRemindMe=function(e){S=e,o.remindme=!0},o.closeRemindMe=function(){o.remindme=!1},o.telVerification=function(e){11==e.length&&f(e)?(I=e,o.canSubmit=!0):o.canSubmit=!1},o.submitBackstage=function(){l.doRemindCoupons(I,S).success(function(e){o.message=e.message,o.remindme=!1,o.remindSuccess=!0,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500),e.success&&(b=1,o.init(o.typeIdDefault))})},o.progress=function(e){return.9*e},o.getNewCoupons=function(i){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?u.go("login"):l.doGetNewCoupons(i).success(function(t){t.success?(e.couponXyzType=!0,b=1,o.init(o.typeIdDefault)):(o.remindSuccess=!0,o.message=t.message,setTimeout(function(){o.$apply(function(){o.remindSuccess=!1})},1500))})})},o.init=function(e){for(var t=0;t<y.length;t++)p.cancel(T[y[t]]);y=[],o.dataList="",l.doInit(1,5,e).success(function(e,t,i,s){if(e.success)if(null!==e.data){o.dataList=e.data;for(var n=0;n<o.dataList.length;n++)3!=o.dataList[n].displayType&&4!=o.dataList[n].displayType||(y.push(n),$[n]=o.dataList[n].nowTime,w[n]=o.dataList[n].activityStartTime);for(var a=0;a<y.length;a++)v($[y[a]],w[y[a]],y[a]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.isHasCoupons=!0;else o.hasmore=!1})},o.initType=function(){l.doInitType().success(function(e,t,i,n){e.success?(o.typeDataList=e.data,o.typeIdDefault=o.typeDataList[0].id,o.init(o.typeIdDefault)):s.showToast(e.message)})},o.loadMore=function(){b++,l.doInit(b,5).success(function(e,t,i,s){if(e.success){C=y.length,y=[],e.data&&(o.dataList=o.dataList.concat(e.data));for(var n=0;n<o.dataList.length;n++)3!=o.dataList[n].displayType&&4!=o.dataList[n].displayType||(y.push(n),$[n]=o.dataList[n].nowTime,w[n]=o.dataList[n].activityStartTime);for(var a=C;a<y.length;a++)v($[y[a]],w[y[a]],y[a]);o.dataList.length<e.totalCount?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!0):(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)}else o.hasmore=!1})},o.$on("$ionicView.beforeEnter",function(s,n){if("back"==n.direction)return"ClassifyMessageCenter"==i.viewHistory().forwardView.stateName&&t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1}),e.couponXyzType&&(o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})),void(e.couponXyzType=!1);d.scrollTop(),o.typeIdDefault="",o.typeDefault=0,o.typeAllShow=!1,o.isHasCoupons=!1,o.dataList="",b=1,o.hasmore=!1,m(),o.initType(),t.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})}),o.$on("$ionicView.beforeLeave",function(){for(var e=0;e<y.length;e++)p.cancel(T[y[e]])}),e.$on("COUPONS_DETAIL_STATE",function(e,t){o.init(t)})}]),APP.service("GetCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s){var n={startIndex:o,pageSize:i,couponCateId:s};return e.get(t.getNewUrl("NEW_GET_COUPONS_LIST"),n)},this.doInitType=function(){return e.get(t.getNewUrl("NEW_GET_COUPONS_TYPE"))},this.doRemindCoupons=function(o,i){var s={phone:o,couponId:i};return e.get(t.getUrl("REMIND_COUPONS_LIST"),s)},this.doGetNewCoupons=function(o){var i={couponId:o};return e.get(t.getNewUrl("GET_NEW_COUPONS"),i)}}]),APP.controller("MyCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","GoodsService","$state","AreaService","$timeout","MyCouponsListService","$ionicPopup","PopupService","CacheService","UserService","$ionicScrollDelegate","$ionicModal","$http","$ionicHistory",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(){for(var t=0;t<window.screen.availWidth/12;t++)e.divStr[t]=12*t+4}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"},e.typeClass={top:"59px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"},e.typeClass={top:"43px"}),e.typeDefault=0,e.backGroundBlue={background:"url("+t.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+t.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.noTypeStyle={color:"rgba(102,102,102,0.87)"},e.isTypeStyle={"border-bottom":"3px solid #2979FF",color:"#2979FF"},e.toDetail=function(t,o){var i=p.getUser().mid;n.go("couponsDetailTwo",{cId:t,userID:i,type:0,status:e.status,couponId:o})},e.typeButton=function(t){e.typeDefault=t},e.typeThreeData=["未使用","已使用","即将过期"],e.divStr=[],e.goBack=function(){h.goBack()},e.province=null,e.city=null,e.area=null,e.provinceId="",e.cityId="",e.areaId="",e.streetId="",e.status=1,e.$on("$ionicView.beforeEnter",function(o,i){if(v(),"back"==i.direction)return t.couponXyzType&&(e.status=1,e.init()),void(t.couponXyzType=!1);e.status=1,e.init()}),e.init=function(){c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,i,s){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.getCouponsSta=function(t,o){e.data="",e.status=t,0==o&&3==e.status?(e.status=4,c.doGetNewCouponsLate(1,100,1).success(function(t,o,i,s){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})):c.getMyCouponsList(e.status,e.provinceId,e.cityId,e.areaId,e.streetId).success(function(t,o,i,s){t.success?(e.data=t.data,g.resize()):d.showToast(t.message)})},e.donation=function(t){e.data.memberId=null,e.data.messsage=null,e.findMember=!0;var o=l.show({template:'<div class="padding"><span class="text-align-c">请输入你要查找的会员ID</span> <div class="padding-top"><input class="border" style="height: 30px" type="text" ng-model="data.memberId" placeholder=""></div></div><div  ng-if="!findMember"><span class="text-align-c" style="color: red;" ng-bind="data.messsage"></span>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>查询</b>",type:"button-positive",onTap:function(i){i.preventDefault(),null!=e.data.memberId?c.getMemberName(e.data.memberId).success(function(i,s,n,a){1==i.success?(e.findMember=!0,o.close(),e.couponsForTransfer(e.data.memberId,t),e.data.messsage=i.data):(e.findMember=!1,e.data.messsage=i.message)}):e.data.memberId="请输入会员id"}}]})},e.couponsForTransfer=function(t,o){l.show({template:'<div class="margin-top-15"><span class="text-align-c">您确定要将该优惠券转赠给\'<span style="color: red">{{data.messsage}}</span>\'吗？</span></div>',title:"转赠",subTitle:"转赠",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){null!=e.data.memberId?c.donationCoupons(e.data.memberId,o).success(function(t,o,i,s){1==t.success&&0!=t.result?(e.getCouponSuccess=t.message,r(function(){e.getCouponSuccess=""},1e3),e.data.messsage=t.data,e.init(),g.resize()):0==t.result&&d.showAlert("提示",t.message,"")}):e.data.memberId="请输入会员id"}}]})},e.goCouponCenter=function(){n.go("getCouponsList")}}]),APP.service("MyCouponsListService",["$http","UrlService",function(e,t){this.getMyCouponsList=function(o,i,s,n,a){var r={status:o,provinceId:i||"",cityId:s||"",areaId:n||"",streetId:a||"",startIndex:1,pageSize:100};return e({method:"POST",url:t.getUrl("MY_COUPONS_LIST"),params:r})},this.donationCoupons=function(o,i){var s={memberId:o,id:i};return e({method:"POST",url:t.getUrl("COUPONS_DONATION"),params:s})},this.getMemberName=function(o){var i={id:o};return e({method:"POST",url:t.getUrl("COUPONS_GET_MENBERID"),params:i})},this.doGetNewCouponsLate=function(o,i,s){var n={pageSize:o,startIndex:i,status:s};return e.get(t.getUrl("MY_COUPONS_LIST_LATE"),n)}}]),APP.controller("RetainageController",["RetainageService","$scope","$rootScope","$stateParams","$state","PopupService",function(e,t,o,i,s,n){t.relationOrderSn=i.relationOrderSn,t.isChecked=!0,t.couponList="",t.selectCoupon=function(e,o,i){i?angular.forEach(t.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(t.couponList,function(e,t){e.isChecked=!1})},t.init=function(){e.getOrderList(t.relationOrderSn).success(function(e){t.couponList=e.data.couponList})},t.confirm=function(){var e=!1,o=0;angular.forEach(t.couponList,function(t,i){t.isChecked&&(e=!0,o=t.memberCouponId)}),e?t.getCoupons(t.relationOrderSn,o):(o="",t.getCoupons(t.relationOrderSn,o))},t.getCoupons=function(t,o){e.selectCoupons(t,o).success(function(e,o,i,a){if(1==e.success){var r=e.data.price;s.go("paymentxyz",{orderSn:t,totalAmount:r})}else n.showToast(e.message)}).error(function(){alert("使用优惠券失败")})},t.$on("$ionicView.beforeEnter",function(){t.noCanUseStyle={opacity:"0.4"},t.init()})}]),APP.service("RetainageService",["$http","UrlService",function(e,t){this.getOrderList=function(o){var i={relationOrderSn:o};return e.get(t.getUrl("SELECT_GOODS_COUPONS0"),i)},this.selectCoupons=function(o,i){var s={relationOrderSn:o,memberCouponId:i};return e({method:"POST",url:t.getUrl("SELECT_GOODS_COUPONS1"),params:s})}}]),APP.controller("UseCouponsListController",["$scope","$rootScope","$stateParams","CommonLocationService","$state","UseCouponsListService","PopupService","$ionicHistory","UserService",function(e,t,o,i,s,n,a,r,c){e.htmlContent=o.content,e.tabNav="selection",e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,e.couponId=o.couponId,e.isChecked=!0,e.couponButton=void 0,e.isNull,e.green=[!1],e.blue=[!1],e.pink=[!1],e.$on("$ionicView.beforeEnter",function(){e.noCanUseStyle={opacity:"0.4"},e.couponList="",e.init()}),e.selectCoupon=function(t,o,i){i?angular.forEach(e.couponList,function(e,t){t!=o&&(e.isChecked=!1)}):angular.forEach(e.couponList,function(e,t){e.isChecked=!1})},e.init=function(){e.isNull=!1,e.htmlContent=o.content,e.title=o.title,e.type=o.type,e.productId=o.productId,e.number=o.number,1==e.type?n.selectGoodsCoupons(e.productId,e.number).success(function(t,o,i,s){e.couponList=t.data.sgStoreCouponVoList,0==e.couponList.length&&(e.isNull=!0);for(var n=0;n<e.couponList.length;n++)e.couponList[n].isChecked=e.couponId==e.couponList[n].memberCouponId,4!=e.couponList[n].useCondition||e.couponList[n].storeId?4==e.couponList[n].useCondition||e.couponList[n].storeId?e.couponList[n].storeId&&0!=e.couponList[n].storeId&&(e.pink[n]=!0):e.blue[n]=!0:e.green[n]=!0}):2==e.type&&n.selectPlatformCoupons().success(function(t,o,i,s){e.couponList=t.data.sgStoreCouponVoList,0==e.couponList.length&&(e.isNull=!0);for(var n=0;n<e.couponList.length;n++)e.couponList[n].isChecked=e.couponId==e.couponList[n].memberCouponId,4!=e.couponList[n].useCondition||e.couponList[n].storeId?4==e.couponList[n].useCondition||e.couponList[n].storeId||(e.blue[n]=!0):e.green[n]=!0})},e.confirm=function(){var t=!1,o=0;angular.forEach(e.couponList,function(e,i){e.isChecked&&(t=!0,o=e.memberCouponId)}),t?e.getCoupons(o,e.type):(o=null,e.getCoupons(o,e.type))},e.getCoupons=function(t,o){n.selectCoupons(e.productId,t).success(function(e,t,o,i){1==e.success&&r.goBack()}).error(function(){alert("使用优惠券失败")})},e.toDetail=function(e,t){var o=c.getUser().mid;s.go("couponsDetailTwo",{cId:e,userID:o,type:0,isUser:!0,couponId:t})}}]),APP.service("UseCouponsListService",["$http","UrlService",function(e,t){this.selectGoodsCoupons=function(o,i){var s={productId:o,productNum:i};return e.get(t.getUrl("SELECT_GOODS_COUPONS"),s)},this.selectPlatformCoupons=function(){return e.get(t.getUrl("SELECT_PLATFORM_COUPONS"))},this.selectCoupons=function(o,i){var s={productId:o,memberCouponId:i};return e({method:"POST",url:t.getUrl("SELECT_COUPONS"),params:s})}}]),APP.controller("MyRaiseController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseHaveController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("MyRaiseNoController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("OrderDetailsController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher",function(e,t,o,i,s,n,a,r,c,l,d,u){o.orderSnDetail=n.orderSn,o.cOrderSnDetail=n.cOrderSn,o.orderDetailList=[];var p=r.getUser();o.loginMemberId=p.mid,o.uname=p.userName,o.userlevel=0,o.shareStoreId="";var g=n.cOrderId;o.loadData=function(e,t,i){s.getOrderDetail(e,t,i).success(function(e){e.success&&(o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.shareStoreId=e.data.storeDetail.ownerId)})},o.goOrderTrack=function(e){i.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void a.showToast("退款受理中，请稍后刷新查看状态！");s.checkRefund(e).success(function(t){t.success?i.go("applyRefund",{cOrderSn:e}):a.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),a.showToastShort("复制成功")):a.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?i.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):i.go("productDetail",{productId:o.orderDetailList.productDetail.productId,o2oType:o.orderDetailList.productDetail.o2oType,storeId:o.orderDetailList.storeDetail.ownerId})},o.asse=function(e,t,s){s?o.isShowPcTips=!0:i.go("assess",{orderId:e,cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),i=null;i=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,i.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(u.nextDirection("forward"),i.go("orderManage")):a.showToast(e.message)})}a.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,g=n.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.orderSnDetail,o.cOrderSnDetail,g)}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.controller("RiskDescriptionController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("SupportersAgreementController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("crowd_funding_details_control",["$localstorage","LoginService","HomePageService","PopupService","CreditService","UrlService","$sce","$ionicSlideBoxDelegate","$rootScope","$stateParams","$state","$scope","CrowdFundingServerSingle","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(){u.memberId=m.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==u.memberId&&(u.settingsList=e[t].list,!0)}u.productDataId=l.zActivityId,u.productList=[],u.isShowBtn=!1,u.showQQ=!1,u.showWeChat=!1,u.isShowCopyButton=!1,u.showQRimg=!1,u.isSurplus=!1,u.isStarts=!1,u.isError=!1,u.isTrues=!0,u.detailsBanner=[],u.Math=window.Math,u.init=function(e){u.isError=!0,u.isTrues=!0,u.showShare=!1,u.detailsBanner=[],l.shareId&&(c.shareId=l.shareId),p.detailsListZC(e).success(function(e){1==e.success&&(u.productList=e.data,u.detailsBanner=e.data.imageUrls,r.$getByHandle("crowd_funding_details_slider").update(),r.$getByHandle("crowd_funding_details_slider").loop(!0),u.richText=a.trustAsHtml(e.data.activityDetails),u.activityStatus=u.productList.activityStatus,0==u.activityStatus?(u.isStatus="预热中",u.isShowBtn=!0,u.isStarts=!0,u.isSurplus=!1,u.isError=!0,u.isTrues=!0):1==u.activityStatus?(u.isStatus="众筹中",u.isShowBtn=!0,u.isSurplus=!0,u.isStarts=!1,u.isError=!0,u.isTrues=!0):2==u.activityStatus?(u.isStatus="众筹成功",u.isShowBtn=!1,u.isSurplus=!0,u.isError=!0,u.isTrues=!0):3==u.activityStatus?(u.isStatus="众筹失败",u.isSurplus=!0,u.isShowBtn=!1,u.isError=!1,u.isTrues=!1):100==u.activityStatus?(u.isStatus="计算中",u.isShowBtn=!1,u.isSurplus=!0,u.isError=!0,u.isTrues=!0):(u.isStatus="获取失败",u.isError=!0,u.isTrues=!1))})},u.goToSupport=function(e){d.go("crowd_funding_hot_redound",{zActivityId:e})},u.$on("$ionicView.beforeEnter",function(){u.isBuyer=t.getRole(),v(),u.init(u.productDataId)}),u.customerServe=function(){o.isWdHost().success(function(t){if(c.isWdHost=t.data.isHost,-1==c.isWdHost)d.go("login");else{if(window.cordova){var o=ionic.Platform.isAndroid(),i=null;i=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&g(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else u.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+u.productList.id+"&flag="+u.kfTocken);return}})},u.showShare=!1,c.isApp=!!window.cordova||void 0,u.share=function(){if(!m.getUser().mid)return void d.go("login");u.moreShow=!1,window.device&&window.device.hasNewShare&&(u.showShare=!u.showShare)},u.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),i.showToastShort("复制成功"),u.isShowCopyButton=!1):i.showToast("请下载APP执行此操作")},u.hideblackCover=function(){u.showShare=!1},u.shareToPlatform=function(e){var t=u.productList.activityName,o=u.productList.activityDsp||u.productList.activityName,i=u.productList.imageUrls[0],a=n.getShareLinkHeader()+"crowd_funding_details/"+u.productList.id+"/"+m.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina(t,o,i,a,0,null,s.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,a,0,null,s.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,a,0,null,s.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,a,0,null,s.shareSuccessCallback),s.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,a,0,null,s.shareSuccessCallback),s.qqShare()),5==e?u.copeText(a):s.successShare()):alert("umeng undefined 只能在app分享"),u.showShare=!1}}]),APP.service("CrowdFundingServerSingle",["$http","UrlService",function(e,t){this.detailsListZC=function(o){var i={zActivityId:o};return e.get(t.getZCUrl("ZC_ACTIVITY_SINGLE_PAGE"),i)}}]),APP.controller("crowd_funding_hot_redound_control",["$rootScope","HomePageService","$stateParams","$state","$scope","CrowdFundingServer_hot","$timeout","UserService","GoodsService","CommonAddressService","LoginService",function(e,t,o,i,s,n,a,r,c,l,d){function u(){s.memberId=r.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==s.memberId&&(s.settingsList=e[t].list,!0)}s.redoundId=o.zActivityId,s.isHotPopup=!1,s.hotPopupNum=1,s.isExcess=!1,s.isGo=!1,
s.isFull=!1,s.isStatus=!1,s.isStars=!1,s.isEnd=!1,s.isMore=!1,s.isFind=!1,s.isGo=!0,s.notGo=!1,s.settingsList="",s.isBuyer=d.getRole(),s.init=function(e){n.redoundList(e).success(function(e){1==e.success&&(s.isHotPopup=!1,s.hotRedoundList=e.data,s.redound_status=e.data.activityStatus,1==s.redound_status&&(s.isStatus=!0,s.isStars=!1,s.isEnd=!1,s.isFull=!1),0==s.redound_status&&(s.isStars=!0,s.isFull=!0,s.isStatus=!1,s.isEnd=!1),100!=s.redound_status&&2!=s.redound_status&&3!=s.redound_status||(s.isEnd=!0,s.isFull=!0,s.isStatus=!1,s.isStars=!1))})},s.$on("$ionicView.beforeEnter",function(){s.isHotPopup=!1,s.hotPopupNum=1,s.init(s.redoundId),u(),s.isBuyer=d.getRole()}),s.plus=function(){0==s.moreNum?(s.hotPopupNum=1,s.isExcess=!0):s.hotPopupNum>=s.moreNum?(s.isExcess=!0,s.hotPopupNum=s.moreNum):(s.hotPopupNum++,s.isExcess=!1),s.moreNum==s.hotPopupNum&&(s.isExcess=!0)},s.nus=function(){1==s.moreNum?s.isExcess=!0:0==s.moreNum?(s.hotPopupNum=1,s.isExcess=!0):s.isExcess=!1,s.hotPopupNum<=1?s.hotPopupNum=1:s.hotPopupNum--},s.hot_close=function(){s.isHotPopup=!1,s.hotPopupNum=1,s.isExcess=!1},s.goPostData=function(){t.isWdHost().success(function(t){e.isWdHost=t.data.isHost,-1==e.isWdHost?i.go("login"):i.go("orderWrite",{zStallsId:s.goPostId,number:s.hotPopupNum})})},s.goSupport=function(e,t,o,i,n,a,r,c){s.isHotPopup=!1,s.hotImg=o,s.hotAmounts=t,s.goPostId=e,s.returnTime=i,s.freight=n,s.commissionRate=r,s.remainingNum=-1==a?"无限额":a,s.isLottery=c,s.commonFn(e,t,o,i,n,a,r,c)},s.commonFn=function(e,t,o,i,a,r,c,l){("无限额"==s.remainingNum||s.remainingNum>=1)&&(s.isGo=!0,s.isHotPopup=!0,n.redoundNum(e).success(function(e){1==e.success?(s.hotNumber=e.data,s.moreNum=e.data.num,s.hotPopupNum=1,s.isExcess=!1,s.limintNum=e.data.limit,"无限额"==s.limintNum?s.isFind=!0:s.isFind=!1,0==s.moreNum?(s.hotPopupNum=1,s.isExcess=!0,s.isGo=!1,s.notGo=!0):(s.isExcess=!1,s.isGo=!0,s.notGo=!1),s.moreNum,s.hotPopupNum):s.isFind=!0}))}}]),APP.service("CrowdFundingServer_hot",["$http","UrlService",function(e,t){this.redoundList=function(o){var i={zActivityId:o};return e.get(t.getZCUrl("ZC_ZSTALLS_SINGLE_PAGE"),i)},this.redoundNum=function(o){var i={zStallsId:o};return e.get(t.getZCUrl("ZC_CHECK"),i)},this.postProduct=function(o,i){var s={zStallsId:o,num:i};return e.post(t.getZCUrl("ZC_ORDER_COMMIT")+"?zStallsId="+s.zStallsId+"&number="+s.num)}}]),APP.controller("CrowdFundingHomeControl",["$timeout","$ionicScrollDelegate","PopupService","CreditService","UrlService","$ionicSlideBoxDelegate","$rootScope","$scope","CrowdFundingServer","UserService","GoodsService","CommonAddressService","$stateParams","$state","$ionicPopup","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){r.typeNumber=p.type,r.typeNumber=2==r.typeNumber?2:1,r.flagNum=!1;var h=[2,3,1];r.selectedIndex=0,r.isFindTab=!0,r.brandList=[],r.HomeBanner=[],r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,r.moreProduct=!0,r.productList=[],r.newsList=[],r.endList=[],r.soonList=[],r.hasmore=!1,r.page=1,r.isHasData=!1,r.isMoreData=!0,r.Math=window.Math,r.init=function(e,o,i){p.shareId&&(a.shareId=p.shareId),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]}),f.getUnReadMsg().success(function(e){e.data>0?r.flagNum=!0:r.flagNum=!1}),t.scrollTop(),c.bannerList(r.typeNumber).success(function(e){1==e.success?(r.HomeBanner=e.data.zBannerList,r.peopleList=e.data.top3ZActivity,n.$getByHandle("crowd_funding_slider").update(),n.$getByHandle("crowd_funding_slider").loop(!0),0==r.peopleList.length?(r.isHasData=!0,r.isMoreData=!1):(r.isMoreData=!0,r.isHasData=!1)):(r.isHasData=!0,r.isMoreData=!1)}),c.moreData(e,o,r.typeNumber).success(function(e){1==e.success&&(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,1==o?(r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<r.newsNum))}),c.moreData(h[1],r.page,r.typeNumber).success(function(e){1==e.success?r.endList=e.data.zActivitylist:r.endList=[]})},r.calculateWH=function(e,t){var o=new Image;o.src=e,o.width>o.height?$("#img"+t).attr("width","100%"):$("#img"+t).attr("height","100%")},r.$on("$ionicView.beforeEnter",function(){r.page=1,t.scrollTop(),r.init(h[r.selectedIndex],r.page)}),r.showShare=!1,a.isApp=!!window.cordova||void 0,r.share=function(){if(!l.getUser().mid)return void g.go("login");r.moreShow=!1,window.device&&window.device.hasNewShare&&(r.showShare=!r.showShare)},r.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),o.showToastShort("复制成功"),r.isShowCopyButton=!1):o.showToast("请下载APP执行此操作")},r.hideblackCover=function(){r.showShare=!1},r.shareToPlatform=function(e){var t="顺逛众筹为您提供与众不同的品质生活",o="http://m.ehaier.com/www/img/ic_aboutUS_1.png",n=s.getShareLinkHeader()+"crowdFunding/"+l.getUser().mid;window.umeng?(0==e?window.umeng.shareToSina("顺逛众筹",t,o,n,0,null,i.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛众筹",t,o,n,0,null,i.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛众筹",t,o,n,0,null,i.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛众筹",t,o,n,0,null,i.shareSuccessCallback),i.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛众筹",t,o,n,0,null,i.shareSuccessCallback),i.qqShare()),5==e?r.copeText(n):i.successShare()):alert("umeng undefined 只能在app分享"),r.showShare=!1},r.crowdTab=function(e){r.page=1,c.changeSuccess(h[e]).success(function(o,i,s,n){1==o.success&&(r.page=1,r.selectedIndex=e,0==r.selectedIndex?(r.isTab=!0,r.isFind=!0,r.isFindEnd=!1,r.isFindSoon=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.newsNum=e.data.zActivitylistTotalCount,r.newsList=e.data.zActivitylist,r.hasmore=r.newsList.length<r.newsNum):r.newsList=[]})):1==r.selectedIndex?(r.isFindEnd=!0,r.isFindSoon=!1,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.endNum=e.data.zActivitylistTotalCount,r.endList=e.data.zActivitylist,r.hasmore=r.endList.length<r.endNum):r.endList=[]})):2==r.selectedIndex?(r.isFindEnd=!1,r.isFindSoon=!0,r.isFind=!1,c.moreData(h[r.selectedIndex],r.page,r.typeNumber).success(function(e){1==e.success?(t.resize(),r.soonNum=e.data.zActivitylistTotalCount,r.soonList=e.data.zActivitylist,r.hasmore=r.soonList.length<r.soonNum):r.endList=[]})):r.isTab=!1)})},r.loadMore=function(){r.$broadcast("scroll.infiniteScrollComplete"),r.page+=1,r.loadMoreProducts(h[r.selectedIndex],r.page,r.typeNumber)},r.loadMoreProducts=function(e,t,o){c.moreData(e,t,r.typeNumber).success(function(e){1==e.success?(r.isFind?(r.newsList=r.newsList.concat(e.data.zActivitylist),r.hasmore=r.newsList.length<e.data.zActivitylistTotalCount):r.isFindEnd?(r.endList=r.endList.concat(e.data.zActivitylist),r.hasmore=r.endList.length<e.data.zActivitylistTotalCount):r.isFindSoon&&(r.soonList=r.soonList.concat(e.data.zActivitylist),r.hasmore=r.soonList.length<e.data.zActivitylistTotalCount),r.$broadcast("scroll.infiniteScrollComplete")):(r.$broadcast("scroll.infiniteScrollComplete"),r.hasmore=!1)})}}]),APP.service("CrowdFundingServer",["$http","UrlService",function(e,t){this.bannerList=function(o){var i={from:o};return e.get(t.getZCUrl("ZC_INDEX"),i)},this.changeSuccess=function(o){var i={type:o};return e.get(t.getZCUrl("ZC_INDEX"),i)},this.moreData=function(o,i,s){var n={type:o,page:i,from:s};return e.get(t.getZCUrl("ZC_INDEX_ACTIVITY"),n)}}]),APP.controller("crowdfunding_child_end_control",["$scope","CrowdFundingServer_end","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,i,s,n){}]),APP.service("CrowdFundingServer_end",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_new_control",["$state","$scope","CrowdFundingServer_new","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,i,s,n,a){t.goDetails=function(){e.go("crowd_funding_details")}}]),APP.service("CrowdFundingServer_new",["$http","UrlService",function(e,t){}]),APP.controller("crowdfunding_child_soon_control",["$scope","CrowdFundingServer_soon","$timeout","UserService","GoodsService","CommonAddressService",function(e,t,o,i,s,n){e.init=function(){t.bannerList().success(function(t){e.HomeBanner=t.data.zBannerList,e.activityList=t.data.top3ZActivity,e.list=0,e.loadMore=function(){},e.selectTab=function(t){s.changeSuccess(typeList[t]).success(function(o,i,n,a){1==o.success&&(s.getFilterData().success(function(t){t.success&&(e.brandList=t.data.brandList,void 0!=t.data.filterMap?(e.otherList=t.data.filterMap.lstAttributes,e.resetFilter()):(e.otherList=[],e.resetFilter()))}),e.page=1,e.selectedIndex=t)})}})},e.init()}]),APP.service("CrowdFundingServer_soon",["$http","UrlService",function(e,t){this.bannerList=function(){return e.get(t.getZCUrl("ZC_INDEX"))}}]),APP.controller("orderWriteController",["$localstorage","InAppBrowserService","UserService","$scope","$stateParams","$rootScope","$state","orderWriteService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){i.invoiceHead=void 0,i.zzsInvoice=void 0,i.htmlContent=s.content,i.checkStatus=!0,i.list={},i.zStallsId=s.zStallsId,i.number=s.number,i.$on("$ionicView.afterLeave",function(e,t){n.isInvoice=!1}),i.$on("$ionicView.beforeEnter",function(e,t){i.init(i.zStallsId,i.number)}),i.init=function(e,t){r.getZStallsSinglePage(e,t).success(function(e){i.list=e.data})},i.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?t.open(g.getHead()+"mstore/sg/helpDetail.html?id="+e,o):a.go("helpDetail",{helpId:e,content:o})},i.checkInfo=function(e){i.checkStatus=!i.checkStatus},i.toInvoice=function(e){a.go("invoiceSetup",{invoiceHead:i.list.billCompany,invoiceType:e,enterPage:0})},i.toSubmit=function(){if(window.cordova?i.storeId=e.get("storeId",n.globalConstant.storeId):i.storeId=n.shareId?n.shareId:e.get("storeId",n.globalConstant.storeId),i.list.memberAddress)if(i.checkStatus)if(/^[^&<>]+$/.test(i.regAddress))r.commitOrder(i.zStallsId,i.number,i.list.invoiceType,i.storeId).success(function(e,t,o,i){if(1==e.success)a.go("paymentxyz",{orderSn:e.data,totalAmount:e.totalCount});else{c.confirm({template:e.message,okText:"返回上一页",cancelText:"留在此页"}).then(function(e){e&&m.goBack(-1)})}}).error(function(){});else{c.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{c.alert({template:"支持者协议必须选中！",okText:"知道了"})}else{c.alert({template:"收货地址必须填写！",okText:"知道了"})}}}]),APP.service("orderWriteService",["$http","UrlService",function(e,t){this.getZStallsSinglePage=function(o,i){return e({method:"POST",url:t.getZCUrl("ZC_ORDER_COMMIT"),params:{zStallsId:o,number:i}})},this.commitOrder=function(o,i,s,n){return e({method:"POST",url:t.getZCUrl("ZC_COMMIT_ORDER"),params:{zStallsId:o,number:i,invoiceType:s,sharePeopleId:n}})}}]),APP.controller("submitSuccessController",["$scope","UserService",function(e,t){e.storeId=t.getUser().mid,e.$on("$ionicView.beforeEnter",function(){e.storeId=t.getUser().mid})}]),APP.controller("flashsaleCtrl",["$stateParams","$scope","$state","$http","$interval","UrlService","flashService","GoodsService","$rootScope","$localstorage","$ionicSlideBoxDelegate","$ionicHistory","UserService","$ionicScrollDelegate","BannerThemeService",function($stateParams,$scope,$state,$http,$interval,UrlService,flashService,GoodsService,$rootScope,$localstorage,$ionicSlideBoxDelegate,$ionicHistory,UserService,$ionicScrollDelegate,BannerThemeService){function countDown(e,t,o,i){$scope.Tflag[o]=i,$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($interval.cancel(timer[o]),$scope.Tflag[o]=!1,$scope.showdiv[o]=!1)},1e3)}function fashbegin(e,t,o){timerbefore[o]=$interval(function(){(e+=1e3)>=t&&($interval.cancel(timerbefore[o]),$scope.init())},1e3)}function Format(e){return e=e<10?"0"+e:e}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.date=[],$scope.timeflag=[],$scope.Tflag=[],$scope.isWd=!1,$scope.flashInfoTwototal=[],$scope.flashInfoTwo=[],$scope.showtime="",$scope.datenow=0,$scope.datenow1=0,$scope.dateHour=0,$scope.datemonth=0,$scope.datayear=0,$scope.storeId=0;var timer=[],timerbefore=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="";$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.showdiv=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId;for(var i=0;i<remindArray.length;i++)$interval.cancel(timer[remindArray[i]]);remindArray=[],flashService.getFlashone($scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e){timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1;var t={};for(var o in e.data.flashTimeProductMap)t[o]={};for(var i in t)for(var s in e.data.flashTimeProductMap)for(var n in e.data.flashTimeProductMap[s])i==s&&(t[i][new Date(n).getTime()+n]=e.data.flashTimeProductMap[s][n]);$scope.flashInfoTwototal=t,$scope.date=[];for(var a in $scope.flashInfoTwototal)$scope.date.push({time:a.slice(5).replace("/","月")+"日",item:a});$scope.date[0].id=1;var r=[],c=[],l=new Date;$scope.datenow=l.getTime(),$scope.datenow1=[],$scope.dateHour=l.getDate(),$scope.datemonth=Format(l.getMonth()+1).toString(),$scope.datayear=l.getFullYear();for(var d in $scope.flashInfoTwototal[$scope.date[0].item])$scope.datenow>=$scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime&&$scope.datenow<=$scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime?($scope.showdiv.push(!0),$scope.timeflag.push(!0),r.push($scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime)):$scope.datenow<$scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime?($scope.showdiv.push(!0),$scope.timeflag.push(!1),c.push($scope.flashInfoTwototal[$scope.date[0].item][d][0].startTime)):$scope.datenow>$scope.flashInfoTwototal[$scope.date[0].item][d][0].endTime?$scope.showdiv.push(!1):($scope.showdiv.push(!0),$scope.timeflag.push(!1));for(var u=0;u<c.length;u++)$scope.datenow1[u]=l.getTime(),fashbegin((new Date).getTime(),c[u],u);for(var p=0;p<r.length;p++)remindArray.push(p),countDownNowTime[p]=parseInt($scope.datenow/1e3),countDownendTime[p]=parseInt(r[p]/1e3);for(var g=timerLength;g<remindArray.length;g++)countDown(countDownNowTime[remindArray[g]],countDownendTime[remindArray[g]],remindArray[g],$scope.timeflag[g]);$scope.flashInfoTwo=$scope.flashInfoTwototal[$scope.date[0].item]})}),flashService.slidedata().success(function(e){$scope.bannerList=e.data.topBanner,$scope.others=e.data.others,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("flashsale_slide").loop(!0)})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var s=t.slice(t.lastIndexOf("=")+1),n=/\=(.*?)\&/g,a=t.match(n),r=[],c=0;c<a.length;c++)r.push(a[c].substring(1,a[c].length-1));$state.go("productDetail",{fromType:s,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var u=t.slice(t.indexOf("#/"));window.location.hash=u}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.changecolor=function(e,t){$scope.index=e,$scope.date[0].id=0==e?1:2;for(var o in $scope.flashInfoTwototal)o==t&&($scope.flashInfoTwo=$scope.flashInfoTwototal[o]);for(var i in $scope.flashInfoTwo)$scope.datenow>=$scope.flashInfoTwo[i][0].startTime&&$scope.datenow<=$scope.flashInfoTwo[i][0].endTime?($scope.showdiv.push(!0),$scope.timeflag.push(!0)):$scope.datenow<$scope.flashInfoTwo[i][0].startTime?($scope.showdiv.push(!0),$scope.timeflag.push(!1)):$scope.datenow>$scope.flashInfoTwo[i][0].endTime?$scope.showdiv.push(!1):($scope.showdiv.push(!0),$scope.timeflag.push(!1))},$scope.$on("$ionicView.beforeEnter",function(){for(var e=0;e<timerbefore.length;e++)$interval.cancel(timerbefore[e]);for(var t=0;t<timer.length;t++)$interval.cancel(timer[e]);$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){for(var o=0;o<timerbefore.length;o++)$interval.cancel(timerbefore[o]);for(var i=0;i<timer.length;i++)$interval.cancel(timer[o])}),$scope.goback=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("flashService",["$http","UrlService",function(e,t){this.PrefixInteger=function(e){return e<10?"0"+e:e},this.getFlashone=function(o,i,s,n,a){var r={provinceId:o,cityId:i,districtId:s,streetId:n,from:a};return e.get(t.getNewUrl("NEW_FLASHSALE"),r)},this.slidedata=function(){var o={type:2};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.factory("$localstorage",["$window",function(e){return{set:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},setObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")},setArray:function(t,o){e.localStorage[t]=JSON.stringify(o)},getArray:function(t){return JSON.parse(e.localStorage[t]||"[]")}}}]),APP.service("CommonAddressService",["AreaService","GoodsService","CacheService","$rootScope","$localstorage",function(e,t,o,i,s){var n={};return{addAddressInfo:function(){e.getLocalArea().then(function(e){var s=e.regeocode.addressComponent;t.getAddressId(s.province,s.city,s.district,s.township,s.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){var a=e.data,r=s.district+"/"+s.township;t.addAddress(a.provinceId,a.cityId,a.regionId,r,a.streetId).success(function(e){i.dingWeiSuccess=!0,i.globalConstant.positionStatus?i.globalConstant.autoPosition=r:i.globalConstant.autoPosition="定位失败：崂山区/中韩街道",n={provinceId:a.provinceId,cityId:a.cityId,areaId:a.regionId,streetId:a.streetId,provinceName:s.province,cityName:s.city,regionName:s.district,streetName:s.township},setTimeout(function(){i.$broadcast("CACHE_SUCCESS",n)},2e3),o.set("addressInfo",n)},function(e){})}},function(e){})},function(e){n={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"};var i=n.regionName+"/"+n.streetName;t.addAddress(n.provinceId,n.cityId,n.areaId,i,n.streetId).success(function(e){o.set("addressInfo",n)},function(e){})})},getAddressInfo:function(){return o.get("addressInfo")?o.get("addressInfo"):n={provinceId:16,cityId:173,areaId:2450,streetId:12036596,provinceName:"山东",cityName:"青岛",regionName:"崂山区",streetName:"中韩街道"}}}}]),APP.config(commonConfig),APP.config(route),APP.config(interceptors),APP.config(["$httpProvider",function(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"]}]),APP.factory("AreaService",["$rootScope","UrlService","$q","$http",function(e,t,o,i){return{init:function(){var e=o.defer();return navigator.geolocation.getCurrentPosition(function(t){e.resolve(t)},function(t){e.reject(t)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),e.promise},getLocalArea:function(){var t=o.defer();return AMap.plugin("AMap.Geocoder",function(){geocoder=new AMap.Geocoder({city:"010"});var o=[e.globalConstant.lon,e.globalConstant.lat];geocoder.getAddress(o,function(e,o){"complete"===e&&"OK"===o.info?t.resolve(o):t.reject(o)})}),t.promise}}}]),APP.service("CacheService",[function(){var e={};this.get=function(t){return e[t]},this.set=function(t,o){return e[t]=o},this.pop=function(t){var o=e[t];return e[t]="",o}}]),APP.factory("CalculateStrLength",function(){var e={};return e.limitStrLength=function(e,t){for(var o=0,i=0;i<e.length;i++)if(e.charCodeAt(i)>127||94==e.charCodeAt(i)){if((o+=2)>t)return e.substring(0,i-1)+"..."}else if(++o>t)return e.substring(0,i-1)+"...";if(o<=t)return e},e.dealPrice=function(e){if(null!=e&&void 0!=e){var e=e.toString(),t=e.indexOf(".");if(-1==t)return{priceInt:e,priceFloat:"00"};return{priceInt:e.substring(0,t),priceFloat:e.substring(t+1).substring(0,2)}}},e}),APP.service("CreditService",["UrlService","$http","$timeout",function(e,t,o){this.shareSuccessCallback=function(o){var i={};arguments.length>1&&(i=arguments[1]);var s=e.getUrl("SHARESUCCESS"),n=[];for(var a in i)n.push(a+"="+i[a]);t.get(s+"?"+n.join("&")).success(function(e){e.success}).error(function(e,t,o,i){})},this.successShare=function(e){},this.qqShare=function(){};var i=null;this.getGameId=function(o){if(i)o(i);else{var s=e.getUrl("FIND_GAME_ID");t.get(s).success(function(e){e.success?(i=e.data,o(e.data)):o("f265383f0538834f")}).error(function(e,t,i,s){o("f265383f0538834f")})}}}]),APP.service("FileUploadService",["$http","UrlService",function(e,t){if(window.FileTransfer){var o=new FileTransfer;this.upload=function(e,t,i,s,n,a,r,c){var l=new FileUploadOptions;l.fileKey=i||"imageFile",l.fileName=s||e.substr(e.lastIndexOf("/")+1),n&&(l.mimeType="image/jpeg");var d={};d.userName="18560683520",l.params=d,o.upload(e,encodeURI(t),r,c,l)}}}]),APP.filter("ImageFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/ic_haier_2.png"}}]).filter("ImageUserFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/user.jpg"}}]).filter("ImageTopicFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/quanzi/quanzi.png"}}]).filter("scoleFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/scoleimg.png"}}]).filter("bgImgFilter",["$rootScope",function(e){return function(t){return t||e.imgBaseURL+"img/circleIcon/bgImg.png"}}]).filter("Num4Filter",[function(){return function(e){return parseInt(e)>9999&&(e="9999+"),e}}]).filter("Num2Filter",[function(){return function(e){return parseInt(e)>99?e="99+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("BigNumFilter",[function(){return function(e){return parseInt(e)>99999?e="10万+":0!=parseInt(e)&&-1!=parseInt(e)||(e=0),e}}]).filter("bluetext",["$sce","$log",function(e,t){return function(t,o){if(!o)return e.trustAsHtml(t);var i=new RegExp(o,"gi"),s=t.replace(i,'<span style="color: #0076fd">$&</span>');return e.trustAsHtml(s)}}]).filter("cutTwoFilter",[function(){return function(e){return"number"==typeof number&&(e=e.toFixed(2),e=parseFloat(e)),e}}]).filter("formatNumber",function(){return function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}).filter("addImgURLPostfix",[function(){return function(e,t,o){return/cdn[23][0-9].ehaier.com/.test(e)&&(e=e+"@"+t+"_"+o),e}}]).filter("keepInt",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".");return e.toFixed(2).toString().slice(0,t)}return 0}}).filter("keepFloat",function(){return function(e){if(e){var t=e.toFixed(2).toString().indexOf(".");return e.toFixed(2).toString().slice(t)}return".00"}}).filter("encryptPhone",function(){return function(e){return 11==e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):e}}).filter("totext",[function(){return function(e){return"1"==e?"收入":"支出"}}]).filter("chinaDate",function(){return function(e){return e.substring(4,6)+"月"+e.substring(6,8)+"日"}}).filter("FilterRealName",function(){return function(e){if(e.length>=2){for(var t=e.length,o="",i=0;i<t-1;i++)o+="*";return e=o+e.substring(t-1,t)}return e}}).filter("flashsaleDenum",function(){return function(e){return 0==e.substring(0,1)?e=e.substring(1,5):e}}).filter("delLing",function(){return function(e){return"0"==e.substring(0,1)?e=e.substring(1):e}}).filter("collectsFilter",[function(){return function(e){return e<1e4?e:e=e%100>0&&e%100<50?(e/1e4).toFixed(2)+.01:(e/1e4).toFixed(2)}}]).filter("datachange",function(){return function(e){return e=e.replace("年","/").replace("月","/").replace("日","")}}).filter("rewardToword",function(){return function(e){return"YC"==e&&(e="育成奖励"),"BC"==e&&(e="补差奖励"),"ST"==e&&(e="生态奖励"),"JY"==e&&(e="经营奖励"),"FWB"==e&&(e="服务兵奖励"),"PT"==e&&(e="平台奖励"),"PX"==e&&(e="培训奖励"),e}}),APP.service("H5LocationService",[function(){this.getLocation=function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e):alert("Geolocation is not supported by this browser.")}}]),APP.service("IMService",["$rootScope","$ionicPopup","$interval","$ionicLoading","UrlService","UserService",function(e,t,o,i,s,n){function a(){for(var e=[],t="0123456789abcdef",o=0;o<36;o++)e[o]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}var r=null,c=null,l=null,d=this;this.destroyWebSocket=function(e){if(null!=c)try{c.disconnect(function(){if(c=null,null!=l){try{l.close(),l=null}catch(e){}e&&window.setTimeout(e,3e3)}})}catch(e){}},this.validateWebSocket=function(){null!=l&&1!=l.readyState&&this.initWebSocket()},this.initWebSocket=function(t){r&&t||t&&(r=t);try{l=new WebSocket(s.getWSUrl("MESSAGE_WS_URL")),c=Stomp.over(l),c.debug=function(){window.console&&console.log&&console.log.apply};var o=function(){$.ajax({url:s.getUrl("REGIST_MESSAGE_TOKEN"),type:"post",dataType:"json",success:function(t){if(t.success){var o=t.data,i=o;e.token=o;var s="stomp-subscription-"+a();c.subscribe("/exchange/message_topic_exchange/"+i,function(e){r(JSON.parse(e.body))},{"x-queue-name":s});c.subscribe("/exchange/message_fanout_exchange",function(e){r(JSON.parse(e.body))},{"x-queue-name":s})}else d.destroyWebSocket()}})},i=function(){d.destroyWebSocket(d.initWebSocket)};c.connect(s.getMQAuth().username,s.getMQAuth().password,o,i,"/")}catch(e){}}}]),APP.factory("InAppBrowserService",["PopupService","$rootScope",function(e,t){ionic.Platform.isAndroid();return window.device&&window.device.hasNewBrowser?{open:function(t,o){var i=ionic.Platform.isAndroid(),s=null;return s=i?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),s.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&s.close(),i?e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1)||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1?s.showMyButton():s.hideMyButton():e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/bind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/success")>-1||e.url.indexOf("helpDetail")>-1)?(s.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),s.addMyTitle(o))):s.hideMyButton()}),s.addEventListener("loaderror",function(t){setTimeout(function(){s.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),s}}:{open:function(t,o){var i=ionic.Platform.isAndroid(),s=null;return s=i?window.open(t,"_blank","location=no"):window.open(t,"_blank","location=no,toolbar=no"),s.addEventListener("loadstart",function(e){e.url&&(e.url.indexOf("mstore")>-1||e.url.indexOf("order")>-1)&&e.url.indexOf("helpDetail")<=-1&&s.close(),i||(e.url&&(e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/activate")>-1||e.url.indexOf("https://m.kjtpay.com/bindmember/nameauth")>-1||e.url.indexOf("helpDetail")>-1)?(s.showMyButton(),e.url.indexOf("helpDetail")>-1&&(o.length>12&&(o=o.substr(0,11)+"..."),s.addMyTitle(o))):s.hideMyButton())}),s.addEventListener("loaderror",function(t){setTimeout(function(){s.close(),e.showToast("网络错误,请稍后重试.")},1e3)}),s}}}]),APP.directive("inputClear",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,i){return{restrict:"E",replace:!0,scope:{},require:"ngModel",template:'<i class="icon ion-close-circled" ng-show="isShow" style="font-size: 20px ;vertical-align: middle;color: #9b9b99;position: relative;right: 25px;margin-left: -4px;display: inline-block;width: 0"></i>',link:function(e,t,o,s){e.isShow=!1;var n=t[0].previousElementSibling;n.onblur=function(){i(function(){e.isShow=!1})},n.onfocus=function(){i(function(){n.value&&(e.isShow=!0)})},e.$watch(function(){return n.value},function(t,o,i){angular.equals(t,o)||(e.isShow=!!n.value)}),t.on("click",function(o){t[0].focus(),s.$setViewValue(""),e.isShow=!1;var a=n.blur;n.blur=function(){},i(function(){n.blur=a},100)})}}}]),APP.directive("goTop",["$rootScope","$state","$ionicScrollDelegate","$timeout",function(e,t,o,i){return{restrict:"AE",replace:!0,template:'<img ng-src="{{imgBaseURL}}img/icon_toTop.png" style="width: 44px;"  ng-show="showGoTop"/>',link:function(e,t,o){var s=void 0,n=void 0,a=!1;e.showGoTop=!1,i(function(){var i="z-index:10;width:44px;position:fixed;right:10px;bottom:"+(o.offset||20)+"px!important";s=e.$$childHead.scrollCtrl,n=s.element,t[0].setAttribute("style",i)},100);var r=function(){if(s&&s.getScrollPosition()&&!a){var t=s.getScrollPosition().top;e.showGoTop=t>500,a=!0,e.$apply(function(){a=!1},500)}};i(function(){ionic.on("scroll",r,n)},1e3),t.on("click",function(){s.scrollTop(!0),i(function(){e.showGoTop=!1},200)})}}}]),APP.service("MediaService",["$http","UrlService","$ionicPopup","$rootScope",function(e,t,o,i){function s(e){try{e&&e.data&&(d?(c+=e.data.length,r=r.concat(e.data)):(c=e.data.length,r=e.data,d=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function n(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}this.getPicture=function(e,t,o){navigator.camera&&navigator.camera.getPicture&&(0==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==e&&navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}))};var a={},r=[],c=0;window.URL=window.URL||window.webkitURL;var l="",d=!0;this.addAudioEventOnWindow=function(){window.addEventListener("audioinput",s,!1),window.addEventListener("audioinputerror",n,!1)},this.removeAudioEventOnWindow=function(){
window.removeEventListener("audioinput",s),window.removeEventListener("audioinputerror",n)},this.startCapture=function(e,t){try{window.audioinput&&!audioinput.isCapturing()&&(a={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(a))}catch(e){alert("startCapture exception: "+e)}};var u=function(e,t,o){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),c=0;var s=new WavAudioEncoder(a.sampleRate,a.channels);s.encode([r]);var n=s.finish("audio/wav");window.resolveLocalFileSystemURL(i.isIOS?cordova.file.dataDirectory:cordova.file.externalDataDirectory,function(i){var s="temp"+(new Date-0)+".wav";i.getFile(s,{create:!0},function(i){i.createWriter(function(s){s.write(n),setTimeout(function(){l=i.toURL(),document.getElementById(e).src=l,document.getElementById(t).load(),o&&o()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};this.stopCapture=u;var p=function(){window.resolveLocalFileSystemURL(l,function(e){e.remove(function(){d=!1},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};this.deleteMedia=p,this.getAudioUrl=function(){return l}}]),APP.service("PlatformService",[function(){this.getPlatform=function(){return window.cordova?"APP":"WEB"}}]),APP.service("PopupService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService",function(e,t,o,i,s){this.showConfirm=function(e,o,i,s){t.confirm({title:e||"提示",okText:s||"确定",cancelText:"取消",template:o||"默认提示信息"}).then(i)},this.showAlert=function(e,o,i){t.alert({title:e||"提示",okText:"确定",template:o||"默认提示信息"}).then(i)},this.showToast=function(e){var t=e||"默认提示消息";i.show({template:'<div style="background:rgba(0,0,0,0.4);border-radius:4px;padding:8px;">'+t+"</div>",duration:2e3})},this.goldIncrease=function(t){e.curMsg=0,i.show({template:'<div style="width:240px;position:absolute;left:50%;margin-left:-120px;bottom:100px;background:rgba(0,0,0,0.4);border-radius:18px;padding:8px;">'+t+"</div>",duration:2e3,animation:"fade-in",showBackdrop:!1})},this.showGoodCoupon=function(e){$("<div/>").html('<div style="width:100%;height:100%;position:fixed;background: rgba(0,0,0,0.70);z-index:100;top:0;left:0;" flex="cross:center main:center">\n    <div style="width:250px;height:264px;background: #fff url(http://cdn09.ehaier.com/shunguang/H5/www/img/im-quant@2x.png) no-repeat;background-size:100% 185px;border-radius: 8px;position:relative;">\n      <div style="position:absolute;width:24px;height:24px;top:0;right:0;" onclick="closeGoodCoupon(this)">\n        <img style="width:100%;height:100%;padding:5px;" src="http://cdn09.ehaier.com/shunguang/H5/www/img/ic-close@2x.png">\n      </div>\n      <div style="height:185px;padding:32px 24px 0;">\n        <div style="font-size: 12px;color: #fff;text-shadow: 0 1px 1px rgba(111,0,0,0.75);text-align:center;">贵店开张，价值<span style="font-size:20px;color:#FFE447;">'+e+'</span>优惠券大礼包放入你的钱包，供你任性消费！</div>\n      </div>\n      <div style="height:79px;padding-top:17px">\n        <div onclick="gomyCouponsList(this)" style="background: #f40;box-shadow: 0 1px 2px 0 rgba(255,68,0,0.50);border-radius: 78px;height:44px;margin:0 21px;font-size: 16px;color: #fff;text-align:center;line-height:44px;">我的优惠券</div>\n    </div>\n    </div>\n  </div>').appendTo($("body"))},this.levelUp=function(e,t,o){i.show({template:'<div style="width:335px;position:absolute;top:-2px;left:0;bottom:0;right:0;margin: auto;z-index:10;">\n                    <img src="http://cdn09.ehaier.com/shunguang/H5/www/img/levelUp.png" style="width:100%;position:absolute;top:0;left:0;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'<11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage'+t+'.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <img ng-if="'+t+'==11" src="http://cdn09.ehaier.com/shunguang/H5/www/img/HeadImage mengzhu.png" style="width:140px;height:133px;position:absolute;top:-100px;left:13px;bottom:0;right:0;margin: auto;">\n                    <p style="width:82px;height:28px;line-height:28px;font-size:20px;color:#ff3232;letter-spacing:-0.49px;text-align:center;\n                    position: absolute;top:72px;left:10px;bottom:0;right:0;margin: auto;"\n                    >'+e+'</p>\n                    <p ng-if="'+o+'" style="height:20px;position: absolute;top:253px;left:10px;bottom:0;right:0;margin: auto;font-size:14px;color:#4a4a4a;letter-spacing:-0.34px;text-align:center;">距离下一个级别还有'+o+'成长值</p>\n                    <div style="width:24px;height:24px;position: absolute;top:-210px;left:0;bottom:0;right:-220px;margin: auto;"\n                    onclick="closeLevelUpPop()" ></div>\n                </div>\n                <div class="myBackDrop" style="width:100%;height:100%;position:fixed;top:0;left:0;background:rgba(0,0,0,0.3);visibility: visible;"></div>',animation:"fade-in"})},this.dynamic=function(e){i.show({template:'<div style="width:70%;height:35px;line-height:35px;background:#000;opacity:0.5;position:absolute;top:5px;left:8px;z-index:99;border-radius:5px;font-size:12px;">'+e+"</div>",duration:3e3,showBackdrop:!1})},this.showToastShort=function(e){i.show({template:e||"默认提示消息",duration:1e3})},this.showToastWithTime=function(e,t){i.show({template:e||"默认提示消息",duration:t})},this.showImgViewer=function(e,o){var i="";if(!arguments[1]||arguments[1]){var n="default.png";null!=e&&""!=e&&(n=e),i=s.getImageUrlData()+n}else i=e;var a=t.show({template:'<img ng-src="'+i+'">',title:"",subTitle:"",cssClass:"jsh-img-viewer",buttons:[{text:"&#xe642;",type:"jsh-img-viewer-close dhcfont",onTap:function(e){a.close()}}]})}}]),APP.factory("UserService",["$rootScope","$localstorage",function(e,t){var o,i=function(){this.mobile=void 0,this.rankName=void 0,this.cartNumber=void 0,this.sessionKey=void 0,this.userId=void 0,this.token=void 0,this.userName=void 0,this.mid=void 0,this.avatarImageFileId=void 0,this.nickName=void 0,this.gender=void 0,this.email=void 0,this.birthday=void 0,this.sessionValue=void 0,this.loginName=void 0,this.accessToken=void 0,this.ucId=void 0};return{getUser:function(){if(!o){o=new i;var e=t.getObject("USER_CACHE_KEY");e&&(o.mobile=e.mobile,o.rankName=e.rankName,o.cartNumber=e.cartNumber,o.sessionKey=e.sessionKey,o.userId=e.userId,o.token=e.token,o.userName=e.userName,o.mid=e.mid,o.avatarImageFileId=e.avatarImageFileId,o.nickName=e.nickName,o.gender=e.gender,o.email=e.email,o.birthday=e.birthday,o.sessionValue=e.sessionValue,o.loginName=e.loginName,o.accessToken=e.accessToken,o.ucId=e.ucId)}return o},setUser:function(s){o||(o=new i),o.mobile=s.mobile,o.rankName=s.rankName,o.cartNumber=s.cartNumber,o.sessionKey=s.sessionKey,o.userId=s.userId,o.ucId=s.ucId,o.token=s.token,o.userName=s.userName,o.mid=s.mid,o.avatarImageFileId=s.avatarImageFileId,o.nickName=s.nickName,o.gender=s.gender,o.email=s.email,o.birthday=s.birthday,o.sessionValue=s.sessionValue,o.loginName=s.loginName,o.accessToken=s.accessToken,t.setObject("USER_CACHE_KEY",o),e.$broadcast("USER:REFLASH",o)},clearUser:function(){o&&(o.mobile=void 0,o.rankName=void 0,o.cartNumber=void 0,o.sessionKey=void 0,o.userId=void 0,o.token=void 0,o.userName=void 0,o.mid=void 0,o.avatarImageFileId=void 0,o.nickName=void 0,o.gender=void 0,o.email=void 0,o.birthday=void 0,o.sessionValue=void 0,o.accessToken=void 0),t.setObject("USER_CACHE_KEY",null),e.$broadcast("USER:CLEAR")},isUserLogin:function(){return o||(o=this.getUser()),!!o.token}}}]),APP.service("VersionService",["$rootScope","$ionicPopup","$timeout","$ionicLoading","UrlService","$http",function(e,t,o,i,s,n){window.cordova&&ionic.Platform.platform().indexOf("ios");this.checkVersion=function(){return}}]),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".play-sound {\n    padding-top: 5px;\n    padding-bottom: 5px;\n}\n\n.play-sound svg {\n    margin-bottom: -3px\n}\n\n.play-sound :first-child {\n    min-width: 50px;\n    max-width: 180px;\n    text-align: left;\n    ;\n}\n\n.play-sound i {\n    box-shadow: none !important;\n}\n\n.play-sound i::before {\n    transform: rotate(45deg);\n    color: #808080;\n}\n\n.play-sound span {\n    font-size: 8px;\n    color: #9D9D9B;\n    vertical-align: -webkit-baseline-middle;\n}\n\n.play-sound .refresh {\n    padding: 3px;\n    color: #d50000;\n    font-size: 20px;\n}\n\n.play-sound .new {\n    color: #d50000;\n}\n\n.play-sound-right {\n    transform: rotate(180deg);\n}\n\n.play-sound-right :first-child {\n    background-color: #FFFFFF !important;\n}\n\n.play-sound-right span {\n    display: inline-block;\n    transform: rotate(180deg) !important;\n}\n\n.play-sound-right div i::before {\n    color: #DDDDDD !important;\n}"),function(e){try{e=angular.module("play-sound.templates")}catch(t){e=angular.module("play-sound.templates",[])}e.run(["$templateCache",function(e){e.put("play-sound.html",'<div class="play-sound">\n    <div class="button padding-horizontal" style="padding: 0;padding-left: 8px;" ng-disabled="isLoading" ng-click="play()">\n        <img class="" src="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/playaudio.png" ng-show="!isLoading" />\n        <svg width=\'15px\' height=\'15px\' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" ng-show="isLoading"\n             preserveAspectRatio="xMidYMid" class="uil-spin" style="    position: relative;bottom: 12px;">\n            <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>\n            <g transform="translate(50 50)">\n                <g transform="rotate(0) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(45) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.12s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.12s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(90) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.25s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.25s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(135) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.37s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.37s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(180) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.5s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.5s" dur="1s"\n                                          repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(225) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.62s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.62s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(270) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.75s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.75s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n                <g transform="rotate(315) translate(34 0)">\n                    <circle cx="0" cy="0" r="8" fill="#555">\n                        <animate attributeName="opacity" from="1" to="0.1" begin="0.87s" dur="1s"\n                                 repeatCount="indefinite"></animate>\n                        <animateTransform attributeName="transform" type="scale" from="1.1" to="1" begin="0.87s"\n                                          dur="1s" repeatCount="indefinite"></animateTransform>\n                    </circle>\n                </g>\n            </g>\n        </svg>\n    </div>\n    <span ng-bind="dur|DurFilter" ng-if="!isLoading&&!isError"></span>\n    <span class="icon ion-ios-refresh refresh" ng-if="isError" ng-click="reload()"></span>\n    <span class="icon ion-record new" ng-if="isNew && !isLoading&&!isError"></span>\n    <audio preload="auto">\n        <source ng-src="{{url|Trusted}}" type="audio/wav">\n    </audio>\n    <loading ng-include=""></loading>\n</div>\n')}])}(),angular.module("play-sound.directive",[]).directive("playSound",["$state","$timeout","$interval","$rootScope",function(e,t,o,i){return{restrict:"E",replace:!0,scope:{url:"@url",side:"@side",isNew:"@isNew"},templateUrl:"play-sound.html",link:function(e,t,o,s){"right"==e.side&&(t[0].className="play-sound play-sound-right");var n=i.chatScope.targetScope;e.isLoading=!0,e.isError=!1;var a=t[0].getElementsByTagName("audio")[0],r=(t[0].getElementsByTagName("source")[0],t[0].getElementsByClassName("button")[0]);a.addEventListener("loadedmetadata",function(t){e.dur=a.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),a.addEventListener("canplaythrough",function(t){e.dur=a.duration,e.isLoading=!1,e.isError=!1,r.style.width=parseInt(50+6.5*e.dur)+"px"},!1),a.addEventListener("ended",function(){a.pause(),a.currentTime=0},!1),a.addEventListener("error",function(){e.isError=!0},!1),n.$on("play-sound:stop",function(t,o){o.who.$id!=e.$id&&(a.pause(),a.currentTime=0)}),e.$on("$ionicParentView.beforeLeave",function(e,t){a.pause()}),e.play=function(){n.$broadcast("play-sound:stop",{who:e}),a.currentTime?(a.pause(),a.currentTime=0):(a.volume=1,e.isNew=!1,a.pause(),a.currentTime=0,a.play())},e.reload=function(){a.load(),e.isLoading=!0}}}}]),angular.module("play-sound.filter",[]).filter("DurFilter",[function(){return function(e){if(e)return isNaN(e)&&(e="?"),Math.round(e)+'"'}}]).filter("Trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("play-sound",["ionic","play-sound.filter","play-sound.directive","play-sound.templates"]),APP.controller("GameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService","$ionicScrollDelegate","$http","ProductDetailService","CommonAddressService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){function S(e){var t=new Date(e),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+i+"月"+s+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var I="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var $=.22*window.innerWidth;e.gridHeight={height:$+"px"},e.gridHeightMiddle={height:2*$+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var w=330,y=window.innerHeight,T=y-373+"px";e.contentHeight={height:T},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION_GAME",e.defaultValue=null,e.level=0;var C={};e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.goBackFlag=!0,e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init(),e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&m.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=S(1e3*e.game.beginTime),e.endTime=S(1e3*e.game.endTime),u.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):l.showToast(t.message)}).error(function(){l.showMsg("网络错误")})};var b,A,P,L,x=0,D=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,i.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*D+e.endP;b=5,A=4==D?15:10,P=4==D?t-15:t-10,L=4==D?t-10:t-5}},e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=s(function(){if(x++,x>=b?w=100:x>=A?w=60:x>=P?w=100:x>=L&&(w=500),x>12*D&&e.curP===e.endP)return x=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},w))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!p.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!p.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=n.getShareLinkHeader()+"game/"+e.gameId+"/"+p.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||e.goBackFlag&&(e.goBackFlag=!1,d.goBack())},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0)},e.addressInit=function(t,o,i,s){if(e.addressTipFlag=!1,m.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=s,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1)}else e.finish=!1,scope.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var N=!1;e.goSelect=ionic.Utils.debounce(function(o,i){for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var i=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=i.text,e.defaultValue["value"+e.level]=i.value,e.level>-2)-1==e.level&&(e.selectProvince=i.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=m.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(i.value,ah).success(function(t){1==ah&&(areaValueCity=i.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",h.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,m.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=i.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=m.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=m.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,h.getLocationList(i.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=i.value);var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,h.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),m.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else{if(N)return;s(function(){N=!1},1500),t.$broadcast(e.flag,e.defaultValue),N=!0,e.closeAddressModal()}},300),t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){C=v.getAddressInfo();var o=C.regionName+"/"+C.streetName;h.addAddress(C.provinceId,C.cityId,C.areaId,o,C.streetId).success(function(){var o={"text-1":C.provinceName,"text-2":C.cityName,"text-3":C.regionName,"text-4":C.streetName,"value-1":C.provinceId,"value-2":C.cityId,"value-3":C.areaId,"value-4":C.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},u.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",i=I,s=n.getShareLinkHeader()+"game/"+e.gameId+"/"+p.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,i,s,0,null,g.shareSuccessCallback):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,i,s,0,null,g.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,i,s,0,null,g.shareSuccessCallback):3==t?(window.umeng.shareToQQ("顺逛抽奖活动",o,i,s,0,null,g.shareSuccessCallback),g.qqShare()):4==t&&(window.umeng.shareToQzone("顺逛抽奖活动",o,i,s,0,null,g.shareSuccessCallback),g.qqShare()),5==t?e.copeText(s):g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("helpStaffController",["$scope","$state","helpStaffService","$localstorage","$stateParams","$ionicPopup","PopupService",function(e,t,o,i,s,n,a){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.memberId=s.memberId,e.gameId=s.gameId,e.numberInit="";var r;e.init=function(){o.gameHellpInit(e.gameId,e.memberId).success(function(t,o,i,s){1==t.success?(r=t.data.helpNum,e.number=t.data.helpedNum,e.numberInit=t.data,e.number==r?(e.numberColor="34%",e.renshuColor="27.8%"):e.number==2*r?(e.numberColor="66.5%",e.renshuColor="60.3%"):e.number>=3*r?(e.numberColor="100%",e.renshuColor="93.8%"):(e.numberColor=e.number*(100/(3*r))+"%",e.renshuColor=e.number*(100/(3*r))-6.2+"%")):a.showToast(t.message)})},e.zhuli=function(){o.gameHellp(e.gameId,e.memberId,e.channel).success(function(t,o,i,s){1==t.success?(e.showBg=!0,e.codeNum=t.code,e.init()):t.message&&a.showToast(t.message)})},e.closeShow=function(){e.showBg=!1},e.$on("$ionicView.beforeEnter",function(){e.showBg=!1,e.codeNum="",e.memberId=s.memberId,e.gameId=s.gameId,e.channel=s.channel,e.init()})}]),APP.service("helpStaffService",["$http","UrlService",function(e,t){this.gameHellp=function(o,i,s){var n={gameId:o,memberId:i,channel:s};return e.get(t.getGameUrl("GAME_HELLP"),n)},this.gameHellpInit=function(o,i){var s={gameId:o,memberId:i};return e.get(t.getGameUrl("GAME_HELLP_INIT"),s)}}]),APP.controller("VipGameController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(e){var t=new Date(e),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+i+"月"+s+"日"}e.modal=void 0,e.gameId=o.gameId,e.gameTitle,e.gameDesc,e.isShowForm=!1,e.startTime="",e.endTime="",e.hasBkgColor=!0;var f="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";e.isAdmin=o.isAdmin,e.shareStoreId;var h=.22*window.innerWidth;e.gridHeight={height:h+"px"},e.gridHeightMiddle={height:2*h+8+"px"},e.addressInfo={},e.game={},e.prizeList=[],e.startP=0,e.endP=11,e.curP=void 0,e.timer=void 0,e.isRuning=!1;var v=330;e.showShare=!1,e.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topBtnCss4IOS={top:"12px"}),e.$on("$ionicView.beforeEnter",function(){e.shareStoreId=o.shareStoreId,e.isAdmin=o.isAdmin,e.init()}),e.init=function(){e.prizeList=new Array(12),e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.startP=0,e.curP=void 0,c.gameInfo({gameId:e.gameId}).success(function(t){t.success?(e.prizeList=t.data.gameImg,e.game=t.data.game,e.startTime=m(1e3*e.game.beginTime),e.endTime=m(1e3*e.game.endTime),u.fromTemplateUrl("templates/common/CommonGame.html",{scope:e,animation:"slide-in-left"}).then(function(t){e.modal=t}),e.game.backgroundPic||(e.hasBkgColor=!1)):alert(t.message)}).error(function(){l.showMsg("网络错误")})};var S,I,$,w,y=0,T=Math.floor(3*Math.random())+2;e.clickChou=function(){if(!e.isRuning){c.luckDraw({gameId:e.gameId}).success(function(t){if(t.success)e.chouResult=t.result,e.endP=t.result.postion-1,e.start();else if(t.message&&t.message.indexOf("抽奖次数")>-1)r.alert({template:t.message}),e.curP=void 0;else if(t.message&&t.message.indexOf("GAME")>-1)r.alert({template:"对不起，奖品已被抽光"}),e.curP=void 0;else if(t.message&&t.message.indexOf("未登录")>-1)e.curP=void 0,i.go("login");else{if(e.curP=void 0,"-100"==t.errorCode)return;r.alert({template:t.message})}}).error(function(e){l.showToast("网络错误")}),e.curP=0;var t=12*T+e.endP;S=5,I=4==T?15:10,$=4==T?t-15:t-10,w=4==T?t-10:t-5}},e.start=function(){!e.endP||e.endP>11||(e.isRuning=!0,e.timer=s(function(){if(y++,y>=S?v=100:y>=I?v=60:y>=$?v=100:y>=w&&(v=500),y>12*T&&e.curP===e.endP)return y=0,e.isRuning=!1,void e.showForm();e.curP<12?e.curP++:e.curP=0,e.start()},v))},e.openPic=function(){e.modal.show()},e.closePic=function(){e.modal.hide()},e.share=function(){if(window.device&&window.device.hasNewShare){if(e.isAdmin&&1==e.isAdmin)return;if(!p.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;e.showShare=!e.showShare}else{if(e.isAdmin&&1==e.isAdmin)return;if(!p.getUser().mid)return void l.showToast("请先登录,再分享");if(e.isShowForm)return;if(window.umeng){var t=n.getShareLinkHeader()+"game/"+e.gameId+"/"+p.getUser().mid+"/"
;window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t)}}},e.goBack=function(){e.isAdmin&&1==e.isAdmin||e.isShowForm||d.goBack()},e.showForm=function(){e.isShowForm=!0},e.hideForm=function(){e.isShowForm=!1},e.confirmGameInfo=function(){if(!e.chouResult.consignee)return void r.alert({title:"提示",template:"收件人必须填写！"});if(!e.globalConstant.mobileNumberRegExp.test(e.chouResult.mobile))return void r.alert({title:"提示",template:"请输入正确的手机号！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.regionName)return void r.alert({title:"提示",template:"收件地区必须填写！"});if(!e.chouResult.address)return void r.alert({title:"提示",template:"地址必须填写！"});var t={gameId:e.chouResult.gameId,uuid:e.chouResult.uuid,prizeId:e.chouResult.gamePrizeId,consignee:e.chouResult.consignee,mobile:e.chouResult.mobile,address:e.chouResult.address,regionName:e.chouResult.regionName,isDefault:0,provinceId:e.chouResult.provinceId,cityId:e.chouResult.cityId,regionId:e.chouResult.regionId,streetId:e.chouResult.streetId};c.confirmGameInfo(t).success(function(t){t.success?(l.showToast("提交成功"),e.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},e.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},t.$on("CHANGEADDRESS_LOCATION_GAME",function(t,o){e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.chouResult.provinceId=o["value-1"],e.chouResult.cityId=o["value-2"],e.chouResult.regionId=o["value-3"],e.chouResult.streetId=o["value-4"],e.chouResult.regionName=e.textOne+e.textTwo+e.textThree+e.textFour}),e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o="给您推荐顺逛每日抽奖活动,不可错过哦!",i=f,s=n.getShareLinkHeader()+"game/"+e.gameId+"/"+p.getUser().mid+"/";window.umeng?(0==t?window.umeng.shareToSina("顺逛抽奖活动",o,i,s):1==t?window.umeng.shareToWechatSession("顺逛抽奖活动",o,i,s):2==t?window.umeng.shareToWechatTimeline("顺逛抽奖活动",o,i,s):3==t?window.umeng.shareToQQ("顺逛抽奖活动",o,i,s):4==t?window.umeng.shareToQzone("顺逛抽奖活动",o,i,s):5==t&&e.copeText(s),g.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.controller("anAuspiciousStartController",["$scope","anAuspiciousStartService","GameService","$ionicPopup","$timeout","CreditService","UrlService","$http","$ionicHistory","$stateParams","PopupService","UserService","InAppBrowserService","$state","$interval",function(e,t,o,s,n,a,r,c,l,d,u,p,g,m,f){function h(){P=f(e.initWinningList,2e4)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={"padding-top":"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={"padding-top":"44px"});var v=0;e.isShowForm=!1,e.picLists=[],e.surplusChance="",e.gameId=d.anAuspiciousId,e.curP=0;var S="";e.isRuning=!1;var I,w,y,T,C=330,b=0,A=Math.floor(3*Math.random())+2;e.prizeLists=[];var P=null;e.start=function(){e.endP<0||e.endP>11||(e.isRuning=!0,e.timer=n(function(){if(b++,b>=I?C=100:b>=w?C=60:b>=y?C=100:b>=T&&(C=500),b>12*A&&e.curP===e.endP)return b=0,e.isRuning=!1,void(e.isShowForm=!0);e.curP<12?e.curP++:e.curP=0,e.start()},C))},Array.prototype.shuffle||(Array.prototype.shuffle=function(){for(var e,t,o=this.length;o;e=parseInt(Math.random()*o),t=this[--o],this[o]=this[e],this[e]=t);return this}),e.gameButton=function(){if(!e.isRuning){t.drawPrize(e.gameId).success(function(t){if(t.success){if(e.prizeData=t.result,e.surplusChance=t.result.surplusChance,v=t.result.playTimes?t.result.playTimes:v,3!=t.result.prizeType&&-1!=t.result.prizeType){var o={mobile:"",prizeName:""};o.mobile=p.getUser().mobile,o.mobile=o.mobile.substr(0,3)+"****"+o.mobile.substr(7),o.prizeName=t.result.prizeName,e.prizeLists.shuffle(),e.prizeLists.splice(9,0,o)}-1!=t.result.prizeType?(e.endP=t.result.postion-1,e.start()):(e.curP=void 0,u.showToast(t.result.message))}else t.message&&u.showToast(t.message)}).error(function(e){u.showToast("网络错误")});var o=12*A+e.endP;I=5,w=4==A?15:10,y=4==A?o-15:o-10,T=4==A?o-10:o-5}},e.hideForm=function(){e.isShowForm=!1},function(t){t.fn.extend({RollTitle:function(t){if(!t)var t={};var o=this;e.timer=o.timer=null,o.lineH=o.find("p:first").height(),o.line=t.line?parseInt(t.line,15):parseInt(o.height()/o.lineH,10),o.speed=t.speed,o.timespan=t.timespan,0==o.line&&(this.line=1),o.scrollUp=function(){o.animate({marginTop:0},o.speed,function(){for(i=1;i<=o.line;i++)o.find("p:first").appendTo(o);o.css({marginTop:0})})},o.hover(function(){clearInterval(o.timer)},function(){o.timer=setInterval(function(){o.scrollUp()},o.timespan)}).mouseout()}})}(jQuery),e.goBack=function(){l.goBack()},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?g.open(r.getHead()+"mstore/sg/helpDetail.html?id=1034","活动规则").addEventListener("exit",function(e){}):m.go("helpDetail",{helpId:"1034",content:"活动规则"})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},e.isShowShare=function(){if(e.isShowForm=!1,v<e.information.partNum)u.showAlert("分享","每人默认1次抽奖机会，机会用完才可以分享助力哦！");else if(window.cordova){if(!p.getUser().mid)return void m.go("login");e.showShare=!0}else u.showAlert("只能在app分享","抱歉，只能在app分享")},e.chanceShare=function(e){1==e?S="WX":2==e?S="PYQ":3==e?S="QQ":4==e?S="QQKJ":5==e?S="FZLJ":0==e&&(S="WB")},e.shareToPlatform=function(t){e.chanceShare(t);var o=e.information.gameTitle,i="助力可以获得更多的抽奖机会，帮他助个力吧！",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=r.getShareLinkHeader()+"helpStaff/"+e.memberId+"/"+e.gameId+"/"+S;window.umeng?(0==t?window.umeng.shareToSina(o,i,s,n,0,null,null):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,null):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,null):3==t?(window.umeng.shareToQQ(o,i,s,n,0,null,null),a.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,s,n,0,null,null),a.qqShare()),5==t?e.copeText(n):a.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.hideblackCover=function(){e.showShare=!1},e.initWinningList=function(){t.winningList(e.gameId).success(function(t,o,i,s){1==t.success?t.data&&(e.prizeLists=t.data):t.message&&u.showToast(t.message)})},e.initInformation=function(){t.gameInformation(e.gameId).success(function(t,o,i,s){1==t.success?(e.picLists=t.data.gameImgVos,e.information=t.data,e.surplusChance=t.data.surplusChance,v=t.data.playTimes):t.message&&u.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(t){e.showShare=!1,e.memberId=p.getUser().mid,e.gameId=d.anAuspiciousId,e.isShowForm=!1,e.initInformation(),e.initWinningList(),h()}),e.$on("$ionicView.enter",function(e){$(".record_list").RollTitle({line:1,speed:3e3,timespan:600})}),e.$on("$ionicView.beforeLeave",function(){f.cancel(P)})}]),APP.service("anAuspiciousStartService",["$http","UrlService",function(e,t){this.winningList=function(o){var i={gameId:o,noLoading:!0};return e.get(t.getGameUrl("WINNING_LIST"),i)},this.drawPrize=function(o){var i={gameId:o,timeStamp:(new Date).getTime()};return e.get(t.getGameUrl("LOTTERY"),i)},this.gameInformation=function(o){var i={gameId:o};return e.get(t.getGameUrl("GAME_INFORMATION"),i)}}]),APP.controller("HomeController",["$scope","HomeService","H5LocationService",function(e,t,o){e.mine="test mine angularJS",e.fangfa=function(e){o.getLocation(function(e){})},t.doInit().success(function(e,t,o,i){})}]),APP.service("HomeService",["$http","UrlService",function(e,t){this.doInit=function(o,i){var s={userName:o,password:i};return e.get(t.getUrl("HOME_INIT"),s)}}]),APP.controller("TestController",["$scope",function(e){}]),APP.controller("InvoiceSetupController",["$scope","$state","$stateParams","$rootScope","$ionicScrollDelegate","InvoiceService","$ionicPopup","$ionicHistory","$ionicModal","PopupService","ADDADDRESSService","CommonAddressService","$http","$ionicPlatform",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){e.htmlContent=o.content,e.enterPage=o.enterPage,e.title=o.title,e.invoiceModel={},e.addressback="",e.normalInvoiceType=1,e.normalInvoice={TaxpayerNumber:""};var m="",f={invoiceHead:"",TaxpayerNumber:""};e.faPiao={faPiaoTaiTou:"",gongSiMingCheng:"",shiBieHao:"",zhuCeDiZhi:"",zhuCeDianHua:"",kaiHuYinHang:"",kaiHuZhangHao:""},e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.receipt={consignee:"",address:"",zipcode:"",mobile:""},e.isChoose=void 0,e.invoiceType,e.whichActive,e.init=function(){e.addressRegionName="邮寄地址所在地区:",e.addressStreet="街道:",e.invoiceType=o.invoiceType,e.htmlContent=o.content,e.title=o.title,e.faPiao.faPiaoTaiTou=o.invoiceHead,n.loadData().success(function(t,o,i,s){t.success&&(e.payment=t.data.ordersCommitWrapM.order.paymentCode,e.faPiao.gongSiMingCheng=t.data.ordersCommitWrapM.memberInvoices.invoiceTitle,"2"==e.invoiceType?e.normalInvoice.TaxpayerNumber=t.data.ordersCommitWrapM.memberInvoices.taxPayerNumber:"1"==e.invoiceType&&(e.faPiao.shiBieHao=t.data.ordersCommitWrapM.memberInvoices.taxPayerNumber),m=t.data.ordersCommitWrapM.normalInvoiceType,f={invoiceHead:t.data.ordersCommitWrapM.billCompany,TaxpayerNumber:t.data.ordersCommitWrapM.memberInvoices.taxPayerNumber},e.normalInvoiceType=t.data.ordersCommitWrapM.normalInvoiceType,e.faPiao.zhuCeDiZhi=t.data.ordersCommitWrapM.memberInvoices.registerAddress,e.faPiao.zhuCeDianHua=t.data.ordersCommitWrapM.memberInvoices.registerPhone,e.faPiao.kaiHuYinHang=t.data.ordersCommitWrapM.memberInvoices.bankName,e.faPiao.kaiHuZhangHao=t.data.ordersCommitWrapM.memberInvoices.bankCardNumber,e.addressRegionName=t.data.ordersCommitWrapM.receiptAddress?t.data.ordersCommitWrapM.receiptAddress.substring(0,t.data.ordersCommitWrapM.receiptAddress.indexOf(",")):"邮寄地址所在地区:",e.addressStreet=t.data.ordersCommitWrapM.receiptAddress?t.data.ordersCommitWrapM.receiptAddress.substring(t.data.ordersCommitWrapM.receiptAddress.indexOf(",")+1,t.data.ordersCommitWrapM.receiptAddress.lastIndexOf(",")):"街道:",e.receipt.address=t.data.ordersCommitWrapM.receiptAddress?t.data.ordersCommitWrapM.receiptAddress.substring(t.data.ordersCommitWrapM.receiptAddress.lastIndexOf(",")+1):"",e.receipt.consignee=t.data.ordersCommitWrapM.receiptConsignee,e.receipt.zipcode=t.data.ordersCommitWrapM.receiptZipcode,e.receipt.mobile=t.data.ordersCommitWrapM.receiptMobile)}),n.loadList().success(function(t,o,i,s){t.success&&(e.invoiceList=t.data,0==e.invoiceList.length?e.isChoose=!1:e.isChoose=!0)})},e.StreetTop=function(){e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="","邮寄地址所在地区:"!=e.addressRegionName?e.addressModalStreet.show():(l.showToast("请选择所在地"),e.addressStreet="街道:")},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,i,n){if(e.addressTipFlag=!1,s.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=n,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1)}else e.finish=!1,e.dataAdd="",d.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){l.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1},e.goSelectStreet=ionic.Utils.debounce(function(t,o){e.level=e.level-1,e.addressStreet=o.text,e.streetMsg=o.text,e.isChangeOrDefault=3,e.isDef=!0,e.addChangeAddress.regionName=e.addChangeAddress.pca+" "+e.addressStreet,e.addChangeAddress.streetId=o.value,e.positionAddress.streetId=o.value,e.positionAddress.regionName=e.positionAddress.pca+" "+e.addressStreet,e.addressModalStreet.hide(),"街道"==e.addressStreet?e.streetTextColor="color-text-s":e.streetTextColor="color-text-l"});var h=!1;e.goSelect=ionic.Utils.debounce(function(t,o){for(var n=0;n<e.nowLevelIndex.length;n++)n>e.nowLevel&&(e.nowLevelIndex[n]=-1);e.nowLevelIndex[e.nowLevel]=t;var o=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=o.text,e.defaultValue["value"+e.level]=o.value,e.hasChangeArr=e.defaultValue,e.level>-2)-1==e.level&&(e.selectProvince=o.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=s.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){1==ah&&(areaValueCity=o.value),e.dataAdd=t.data,e.addressTipFlag=!1;var i=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(i,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.level=e.levelArea,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",d.getLocationList(areaValueCity,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,s.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){l.showToast("获取地址信息失败！")})};else if(e.level>-4&&-3!=e.level)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,e.selectArea=o.text,e.addressStreet="街道",e.textColor="color-text-l",e.cityTop=s.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,d.getLocationList(o.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(areaValue=o.value);var i=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(i,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.level=e.levelArea,d.getLocationList(areaValue,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),s.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){l.showToast("获取地址信息失败！")})};else if(-3==e.level)e.addressModal.hide(),e.regionTrue=!0,e.isChangeOrDefault=4,e.streetTextColor="color-text-s",e.streetTrue=!0,e.panGoOn=!0,e.panOrgoOn=!0,e.textOne=e.defaultValue["text-1"],e.textTwo=e.defaultValue["text-2"],e.textThree=e.defaultValue["text-3"],e.address.provinceId=e.defaultValue["value-1"],e.address.cityId=e.defaultValue["value-2"],e.address.areaId=e.defaultValue["value-3"],e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addressRegionName=e.textOne+" "+e.textTwo+" "+e.textThree,e.addChangeAddress={provinceId:e.defaultValue["value-1"],cityId:e.defaultValue["value-2"],areaId:e.defaultValue["value-3"],streetId:0,pca:e.textOne+" "+e.textTwo+" "+e.textThree,regionName:""},e.selectArea=o.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=s.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,d.getLocationList(o.value,ah).success(function(t){e.dataAddStreet=t.data,2==ah&&(areaValue=o.value);var i=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(i,s,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1;else{if(h)return;$timeout(function(){h=!1},1500),i.$broadcast(e.flag,e.defaultValue),h=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=i.globalConstant.autoPosition){addressMessage=u.getAddressInfo();var t=addressMessage.regionName+"/"+addressMessage.streetName;d.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,t,addressMessage.streetId).success(function(){var t={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};d.getLocationList(addressMessage.areaId,3).success(function(t){e.dataAddStreet=t.data;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level)}).error(function(e){l.showToast("获取地址信息失败！")}),e.positionAddress={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:0,pca:addressMessage.provinceName+" "+addressMessage.cityName+" "+addressMessage.regionName,regionName:""},e.isPosition=!0,i.$broadcast(e.flag,t),e.streetTextColor="color-text-s",e.addressModal.hide(),e.addressRegionName=e.positionAddress.pca,e.addressStreet="街道:"})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),c.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModalStreet=t}),e.closeAddressModal=function(){e.addressModal.hide(),e.addressModalStreet.hide()},e.preservation=function(){e.positionCommonFun=function(){e.address.provinceId=e.positionAddress.provinceId,e.address.cityId=e.positionAddress.cityId,e.address.areaId=e.positionAddress.areaId,e.address.streetId=e.positionAddress.streetId,e.address.regionName=e.positionAddress.regionName},e.isPosition&&e.positionCommonFun(),d.doInit(e.address).success(function(t,o,s,n){1==t.success&&(e.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},e.addressRegionName="",i.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},i.addressStr=void 0,e.isChangeOrDefault=0,e.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},e.panGoOn=!1,e.fromOrder?e.$ionicGoBack(-2):e.$ionicGoBack())})},e.chooseNormalType=function(t){t!=e.normalInvoiceType&&(e.normalInvoiceType=t,e.normalInvoiceType!=m?(e.faPiao.faPiaoTaiTou="",e.normalInvoice.TaxpayerNumber=""):(e.faPiao.faPiaoTaiTou=f.invoiceHead,e.normalInvoice.TaxpayerNumber=f.TaxpayerNumber))},e.dzClick=function(){e.faPiao.shiBieHao="",e.whichActive=0,e.invoiceType="2"},e.zzClick=function(){e.faPiao.shiBieHao="",e.whichActive=1,e.invoiceType="1"},e.dianZiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.faPiaoTaiTou)?2==e.normalInvoiceType?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.normalInvoice.TaxpayerNumber)?(e.errMessage="",e.toSubmit("cod",e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):(e.errMessage="识别号为15位或18位或20位的数字或字母",s.scrollTop([shouldAnimate=!0])):(e.errMessage=null,e.normalInvoice.TaxpayerNumber="",e.toSubmit("cod",e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.normalInvoice.TaxpayerNumber,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.receipt.address,e.receipt.zipcode,e.receipt.mobile,e.normalInvoiceType)):e.errMessage="发票抬头必填,且不能包含特殊字符"},e.naShuiQueDing=function(){/^.[^&<>]{1,}$/.test(e.faPiao.gongSiMingCheng)&&e.faPiao.gongSiMingCheng?/^[0-9A-Za-z]{18}$|^[0-9A-Za-z]{15}$|^[0-9A-Za-z]{20}$/.test(e.faPiao.shiBieHao)?/^.[^&<>]{4,}$/.test(e.faPiao.zhuCeDiZhi)&&e.faPiao.zhuCeDiZhi?e.faPiao.zhuCeDianHua&&e.faPiao.zhuCeDianHua.length<8||!e.faPiao.zhuCeDianHua?(e.errMessage="注册电话格式：0532-12345678",s.scrollTop([shouldAnimate=!0])):e.faPiao.kaiHuYinHang?e.faPiao.kaiHuZhangHao?"邮寄地址所在地区:"!=e.addressRegionName||"街道:"!=e.addressStreet&&"街道"!=e.addressStreet||e.receipt.address?"邮寄地址所在地区:"==e.addressRegionName?(e.errMessage="请选择所在地区",s.scrollTop([shouldAnimate=!0])):"街道:"==e.addressStreet||"街道"==e.addressStreet?(e.errMessage="请选择所在街道",s.scrollTop([shouldAnimate=!0])):e.receipt.address?(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit("cod",e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="请填写详细地址",s.scrollTop([shouldAnimate=!0])):(e.preservation(),e.errMessage=null,e.receipt.address&&(e.addressback=e.addressRegionName+","+e.addressStreet+","+e.receipt.address),e.toSubmit("cod",e.invoiceType,e.faPiao.faPiaoTaiTou,e.faPiao.gongSiMingCheng,e.faPiao.shiBieHao,e.faPiao.zhuCeDiZhi,e.faPiao.zhuCeDianHua,e.faPiao.kaiHuYinHang,e.faPiao.kaiHuZhangHao,e.receipt.consignee,e.addressback,e.receipt.zipcode,e.receipt.mobile)):(e.errMessage="开户账号为必填",s.scrollTop([shouldAnimate=!0])):(e.errMessage="开户银行为必填",s.scrollTop([shouldAnimate=!0])):(e.errMessage="注册地址至少5个字符，且不能包含特殊字符",s.scrollTop([shouldAnimate=!0])):(e.errMessage="识别号为15位或18位或20位的数字或字母",s.scrollTop([shouldAnimate=!0])):(e.errMessage="公司名称必填,且不能包含特殊字符",s.scrollTop([shouldAnimate=!0]))},e.toSubmit=function(t,o,s,a,c,l,d,u,p,g,m,f,h,v){0==e.enterPage?n.submitInvoice(t,o,s,a,c,l,d,u,p,g,m,f,h,v).success(function(e,t,o,s){e.success&&(i.isInvoice=!0,r.goBack())}):1==e.enterPage&&n.submitInvoiceSeckill(t,o,s,a,c,l,d,u,p,g,m,f,h,v).success(function(e,t,o,i){e.success&&r.goBack()})},e.popMessage=function(){a.alert({templateUrl:"http://www.ehaier.com/mstatic/test/wd/activity/invoiceRule.html",cssClass:""})},e.choose=function(){t.go("invoiceList")},c.fromTemplateUrl("templates/invoice/InvoiceList.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show(),n.loadList().success(function(t,o,i,s){t.success&&(e.invoiceList=t.data)})},e.closeModal=function(){e.modal.hide()},e.listClick=function(t){e.closeModal(),n.loadList().success(function(o,i,s,n){o.success&&(e.invoiceList=o.data,e.faPiao.gongSiMingCheng=e.invoiceList[t].invoiceTitle,e.faPiao.shiBieHao=e.invoiceList[t].taxPayerNumber,e.faPiao.zhuCeDiZhi=e.invoiceList[t].registerAddress,e.faPiao.zhuCeDianHua=e.invoiceList[t].registerPhone,e.faPiao.kaiHuYinHang=e.invoiceList[t].bankName,e.faPiao.kaiHuZhangHao=e.invoiceList[t].bankCardNumber)})},e.note=function(){l.showAlert("",'<div style="text-align:left;color:#666;">普通发票分为电子发票与纸质发票两种，以实际开票为准，不支持更换选择，订单确认后可在订单详情-发票信息模块查看具体信息；<br><br>电子发票是经过国家税务局机关认可的有效凭证,同样具有保修与财务报销的效力。相关内容您可以咨询海尔商城在线客服,或拨打海尔商城服务热线4006 999 999,同时您也可以拨打税务热线12366进行咨询。电子发票相关政策您还可以查看《青岛市国家税务局电子发票管理办法（试行）》,或登录青岛市电子发票服务平台www.chinaeinv.com查询。<br><br>纸质发票是由顺逛官方授权店进行开具。<br><br>增值税专用发票需自行选择，并详细填写公司名称、税号、地址、电话、开户银行和帐号，并注意所填的内容须与纳税信息一致。<br>另外需提供一般纳税人认证资料（营业执照副本、税务登记证副本、一般纳税人资格证书、银行开户许可证复印件）及顺逛订单号发送邮件至fapiao@ehaier.com，我们会根据您提供的资料进行资质审核，审核无误后将在订单完成关闭1-2周左右的时间为您开具发票并安排邮寄。</div>')},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("InvoiceService",["$http","UrlService",function(e,t){this.loadData=function(){return e.get(t.getUrl("ORDER_INVOICE"))},this.loadList=function(o){return o={},e.get(t.getUrl("ORDER_INVOICE_LIST"),o)},this.submitInvoice=function(o,i,s,n,a,r,c,l,d,u,p,g,m,f){var h={payment:o,invoiceType:i,billCompany:s,invoiceTitle:n,taxPayerNumber:a,registerAddress:r,registerPhone:c,bankName:l,bankCardNumber:d,receiptConsignee:u,receiptAddress:p,receiptZipcode:g,receiptMobile:m,normalInvoiceType:f};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE"),params:h})},this.submitInvoiceSeckill=function(o,i,s,n,a,r,c,l,d,u,p,g,m){var f={payment:o,invoiceType:i,billCompany:s,invoiceTitle:n,taxPayerNumber:a,registerAddress:r,registerPhone:c,bankName:l,bankCardNumber:d,receiptConsignee:u,receiptAddress:p,receiptZipcode:g,receiptMobile:m};return e({method:"POST",url:t.getUrl("SUBMIT_INVOICE_SECKILL"),params:f})},this.pageSubmit=function(){var o={isFromInvoices:1};return e.get(t.getUrl("CONFIRM_ORDER"),o)}}]),APP.controller("ListOfSpecialtyGoodsController",["CartService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","ListOfSpecialtyGoodsControllerService","LoginService","HomePageService","CreditService","BannerThemeService","CommonAddressService",function(CartService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,localSpecialtyHomePageService,ListOfSpecialtyGoodsControllerService,LoginService,HomePageService,CreditService,BannerThemeService,CommonAddressService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",$scope.priceArr=[],$scope.showShare=!1,$scope.canLoadMore=!0,$scope.chooseIndex=3,$scope.switch=!0,$scope.filterData="saleDesc",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.pageIndex=1,$scope.midCommList=[],$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.arrowState=[$rootScope.imgBaseURL+"img/ic_sort_state_0.png",$rootScope.imgBaseURL+"img/ic_sort_state_1.png",$rootScope.imgBaseURL+"img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/ic_screen_state_0.png",$rootScope.imgBaseURL+"img/ic_screen_state_1.png"],$scope.filter_index=0,$scope.iSDataLeftRight=!1,$scope.isListNull=!1,$scope.leftDataListIndex=1,$scope.leftDataList=[{navigationName:"全部",id:""}],$scope.rightDataList=[],$scope.listModal=null,$ionicModal.fromTemplateUrl("templates/localSpecialty/specialClassificationSelection.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.listModal=e}),$scope.closeListModal=function(){$scope.listModal.hide(),$scope.leftDataList=[{navigationName:"全部",id:""}]},$scope.getQueryString=function(e,t){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=t.substr(0).match(o);return null!=i?i[2]:""},$scope.backToList=function(e){$scope.midCommList=[],$scope.priceArr=[];var t=$scope.getQueryString("productCateId",e.url),o=$scope.getQueryString("brandId",e.url);$scope.filterData=""!=o?"hasStock@"+o+"@0":"saleDesc",$scope.resetFilter(),$scope.filter_index=0,$scope.chooseIndex=3,$scope.title=e.navigationName,$scope.productCateId=t,$scope.listModal.hide(),$scope.getListData(),$ionicScrollDelegate.scrollTop()};var parentId="0";$scope.getList=function(){ListOfSpecialtyGoodsControllerService.getLeftList($scope.pageId).success(function(e){if(e.success&&e.data.length>0){$scope.leftDataList=[{navigationName:"全部",id:""}];for(var t=0;t<e.data.length;t++)$scope.leftDataList.push(e.data[t]);parentId=e.data[0].id,ListOfSpecialtyGoodsControllerService.getRightList($scope.leftDataList[$scope.leftDataListIndex].id,$scope.pageId).success(function(e){if(e.success){0==e.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var t=[],o=[],i=0;i<e.data.length;i++)e.data[i].parentId==parentId&&2==e.data[i].levels?(e.data[i].children=[],t.push(e.data[i])):1==e.data[i].levels&&o.push(e.data[i]);for(var i=0;i<e.data.length;i++)for(var s=0;s<t.length;s++)e.data[i].parentId==t[s].id&&t[s].children.push(e.data[i]);$scope.rightDataList=t,$scope.slideImage=o,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.$getByHandle("classify_slider").update(),$ionicSlideBoxDelegate.$getByHandle("classify_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("classify_slider").start()})}else $scope.iSDataLeftRight=!0})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.selectTab=function(e,t){if(parentId=e,0==t)return $scope.productCateId=0,$scope.title="全部商品",$scope.listModal.hide(),$scope.commission_index=0,$scope.price_index=0,void $scope.chooseTab(3);t!=$scope.leftDataListIndex&&($scope.leftDataListIndex=t,ListOfSpecialtyGoodsControllerService.getRightList(e,$scope.pageId).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],i=[],s=0;s<t.data.length;s++)t.data[s].parentId==e&&2==t.data[s].levels?(t.data[s].children=[],o.push(t.data[s])):1==t.data[s].levels&&i.push(t.data[s]);for(var s=0;s<t.data.length;s++)for(var n=0;n<o.length;n++)t.data[s].parentId==o[n].id&&"1"!=t.data[s].levels&&o[n].children.push(t.data[s]);$scope.rightDataList=o,$scope.slideImage=i,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}))},$scope.bannerClick=function(e){$scope.listModal.hide();var t=e.bannerId,o=e.url,i=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.memberId});break;case 2:if(o){var n=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:n,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var a=o.split("=")[1];$state.go("game",{gameId:a});break;case 4:
"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"});var provinceId,cityId,districtId,streetId;$scope.$on("$ionicView.beforeEnter",function(event,data){if("back"==data.direction)return $scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),void GetSwitchChecked();$scope.title="全部商品",$scope.chooseIndex=3,$scope.commission_index=0,$scope.filter_index=0,$scope.price_index=0,$scope.pageId=$stateParams.pageId,$scope.productCateId=$stateParams.productCateId,$scope.filterData="saleDesc",ListOfSpecialtyGoodsControllerService.getPositionId().success(function(res){if(res.success){var data=eval(res.data)[0];if(provinceId=data.provinceId,cityId=data.cityId,districtId=data.areaId,streetId=data.streetId,void 0!=provinceId&&void 0!=cityId&&void 0!=districtId&&void 0!=streetId)$scope.getListData();else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}else{var addressData=CommonAddressService.getAddressInfo();provinceId=addressData.provinceId,cityId=addressData.cityId,districtId=addressData.areaId,streetId=addressData.streetId,$scope.getListData()}}),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),$scope.getCartNum(),GetSwitchChecked()}),$scope.settingsList="",$scope.getListData=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.$on("$ionicView.beforeLeave",function(){$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"}),$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!0}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$scope.goClassification=function(){$scope.pageIndex=1,$scope.listModal.show(),$scope.getList(),$scope.leftDataListIndex=1},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),2==e){null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show();var t={productCateId:$scope.productCateId};$scope.getFilterDataLists(t)}else{if($scope.resetFilter(),$ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData=1==o?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var i=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.filterData=1==i?"price":"priceDesc"}$scope.pageIndex=1,$scope.canLoadMore=!1,$scope.ResGetList()}},$scope.ResGetList=function(){ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId).success(function(e){e.success&&($scope.midCommList=e.data.productList,e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.priceArr=e.products)}))})},$scope.getFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].id==$scope.attributeId?(o[t].lstAttributeOptions[s].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}}})},$scope.ResGetFilterDataLists=function(e){ListOfSpecialtyGoodsControllerService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}})},$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var i=o.length-1,s=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var n=0;n<o.length;n++)n>0&&"true"==o[n].active&&(o[0].active="false",s++);if(s==i||0==s){for(var n=0;n<o.length;n++)n>0&&(o[n].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var n=0;n<o.length;n++)n>0&&(o[n].active="false")}},$scope.filterEnsure=function(){if(null!=$scope.productCateId&&""!=$scope.productCateId&&void 0!=$scope.productCateId||($scope.title="全部商品"),$scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var i=0;i<$scope.lstAttributes[t].lstAttributeOptions.length;i++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[i].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[i].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.loadMore=function(){$scope.pageIndex++,ListOfSpecialtyGoodsControllerService.getProductsList($scope.pageIndex,$scope.filterData,$scope.productCateId,provinceId,cityId,districtId,streetId,$scope.pageId).success(function(e){if(e.success){for(var t=0;t<e.data.productList.length;t++)$scope.midCommList.push(e.data.productList[t]);e.data.isCanSyncGetPrice&&ListOfSpecialtyGoodsControllerService.getAsyncPrice(e.data.queryPricePara).success(function(t){if(t.success)for(var o=0;o<t.products.length;o++)$scope.priceArr.push(t.products[o]);e.totalCount>$scope.midCommList.length?$scope.canLoadMore=!0:$scope.canLoadMore=!1,$scope.$broadcast("scroll.infiniteScrollComplete")})}})},$scope.goBack=function(){$scope.pageIndex=1,$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMoreActive.png")},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!1},$scope.toShare=function(){return $scope.isDisplay=!1,$scope.menuImg=$rootScope.imgBaseURL+"img/ic_lookMore.png",window.cordova?UserService.isUserLogin()?($scope.showShare=!0,void(window.device&&($scope.shareToPlatform(),$scope.showShare=!$scope.showShare))):void $state.go("login"):void $scope.showPopup("请下载APP执行此操作")},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t=$localstorage.get("storeId",$rootScope.globalConstant.storeId),o="顺逛•特产惠 汇集全国优质特产",i="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",s=$scope.shareImgUrl,n=UrlService.getShareLinkHeader()+"ListOfSpecialtyGoods/"+$scope.productCateId+"/"+$scope.pageId+"/"+t,a={},r=function(e){CreditService.shareSuccessCallback(e,a)};window.umeng?(0==e?window.umeng.shareToSina(o,i,s,n,0,null,r):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,r):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,r):3==e?(window.umeng.shareToQQ(o,i,s,n,0,null,r),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(o,i,s,n,0,null,r),CreditService.qqShare()),5==e?$scope.copeText(n):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("ListOfSpecialtyGoodsControllerService",["$http","UrlService","UserService",function(e,t,o){this.getProductsList=function(i,s,n,a,r,c,l,d){var u=o.getUser().mid||"20219251",p={storeMemberId:u,pageIndex:i,pageSize:10,filterData:s,productCateId:n,provinceId:a,cityId:r,districtId:c,streetId:l,pageId:d,noLoading:"true"};return e.get(t.getUrl("SPECIALY_PRODUCTS_LIST"),p)},this.getAsyncPrice=function(o){return e.post(t.getUrl("ASYNC_ACCESS_PRICE"),o)},this.getFilterData=function(o){return e.get(t.getUrl("GET_FILTER_DATA"),o)},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getLeftList=function(o){var i={module:2,parentId:0,regionId:o};return e.get(t.getZCUrl("GETNAVIGATIONS"),i)},this.getRightList=function(o,i){var s={module:2,parentId:o,regionId:i};return e.get(t.getZCUrl("GETNAVIGATIONS"),s)}}]),APP.controller("localSpecialtyHomePageController",["CommonAddressService","$ionicLoading","CreditService","CartService","newsendService","$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","BannerThemeService","PopupService","localSpecialtyHomePageService","HomePageService",function(CommonAddressService,$ionicLoading,CreditService,CartService,newsendService,$ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,BannerThemeService,PopupService,localSpecialtyHomePageService,HomePageService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function mainRes(e){localSpecialtyHomePageService.getMaster(e).success(function(e){e.success&&(null!=e.data.topBannerList&&null!=e.data.topBannerList.bannerList?($scope.arrList.bannerList=e.data.topBannerList.bannerList,$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").update(),$ionicSlideBoxDelegate.$getByHandle("crowd_funding_slider").loop(!0)):$scope.arrList.bannerList=[],null!=e.data.regionList&&null!=e.data.regionList.regionList&&(e.data.regionList.regionList.length>3?$scope.arrList.navList=e.data.regionList.regionList.slice(0,3):$scope.arrList.navList=e.data.regionList.regionList),null!=e.data.drinkList&&(null!=e.data.drinkList.bannerList||null!=e.data.drinkList.topBanner?($scope.isDrinkList=!0,$scope.arrList.specialtyListDrink=e.data.drinkList,$scope.drinkList=e.data.drinkList.bannerList):($scope.isDrinkList=!1,$scope.arrList.specialtyListDrink=[],$scope.drinkList=[])),null!=e.data.foodList&&(null!=e.data.foodList.productList||null!=e.data.foodList.topBanner?($scope.isFoodList=!0,$scope.arrList.specialtyListFood=e.data.foodList,$scope.foodList=e.data.foodList.productList):($scope.isFoodList=!1,$scope.arrList.specialtyListFood=[],$scope.foodList=[])),null!=e.data.communityList&&null!=e.data.communityList.bannerList?$scope.arrList.midCommList=e.data.communityList:$scope.arrList.midCommList=null)})}function countTimeNew(e,t,o){$scope.endT[o]=t-e,newTime[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=checkTime(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=checkTime($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&$interval.cancel(newTime[o])},1e3)}function checkTime(e){return e<10&&(e="0"+e),e}function limitCountTimes(e){var t=checkTime(parseInt(e%864e5/36e5)),o=checkTime(parseInt(e%36e5/6e4)),i=checkTime(Math.floor(e%6e4/1e3));$scope.moreCountTime={hours:t,minutes:o,seconds:i}}$scope.allSpecialtyArr=[],$scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.crowdFundingList=!1,$scope.selectedIndex=0,$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png",$scope.showShare=!1,$scope.localSelect=0,$scope.isTimeOver=!1,$scope.flashHour="",$scope.textTime="",$scope.drinkList=[],$scope.foodList=[],$scope.isDrinkList=!1,$scope.isFoodList=!1,$scope.Timetotal=[],$scope.youLikeTypeArr=[],$scope.youLikeDataArr=[],$scope.cateId=0,$scope.dealPrice=CalculateStrLength.dealPrice,$scope.newAndlimit={flashProductList:[],newSendList:[]},$scope.arrList={bannerList:[],navList:[],specialtyListDrink:[],specialtyListFood:[],touristsList:[],midCommList:[]},$scope.addressMsg={provinceId:"",cityId:"",areaId:"",streetId:""},$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[];var newTime=[],addressMessage,remindArray=[],countDownNowTime=[],countDownendTime=[],nowT=(new Date).getTime(),timerLength="";$scope.flashTime="",$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.preheatingTime=0,$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.settingsList="",$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.paddingtopClasscontent={top:"60px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.paddingtopClasscontent={top:"44px"}),$scope.init=function(){$scope.cartTotalNum=0,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.getAddress(),$scope.crowdFundingMsg(2),$scope.youLikeType(),$scope.getUserMsg(),$scope.getCartNum()},$scope.getUserMsg=function(){HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost})},$scope.getCartNum=function(){CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.newProductAndTimeLimit=function(e,t,o,i){localSpecialtyHomePageService.getNewAndLimit(e,t,o,i).success(function(e){if(e.success)if(null!=e.data)if($scope.isWd=e.data.isWd,null==e.data.flash?$scope.showFlashSale=!1:($scope.newAndlimit.flashProductList=e.data.flash.flashProductList,$scope.flashTime=e.data.flash.flashTime,$scope.preheatingTime=e.data.flash.preheatingTime,$scope.timeCount={startTime:e.data.flash.startTime,endTime:e.data.flash.endTime,systemTime:e.data.flash.systemTime},$scope.flashTime&&($scope.flashHour=$scope.flashTime.slice(11,16)+"场"),0==$scope.newAndlimit.flashProductList.length||$scope.timeCount.systemTime-new Date($scope.newAndlimit.flashProductList[0].endTime).getTime()>-1e3||$scope.timeCount.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.timeCount.systemTime-$scope.timeCount.startTime>-1e3?($scope.timer=$interval(function(){$scope.timeCount.endTime-$scope.timeCount.systemTime<1e3&&($interval.cancel($scope.timer),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)),limitCountTimes($scope.timeCount.endTime-$scope.timeCount.systemTime),$scope.timeCount.systemTime+=1e3},1e3),$timeout(function(){$scope.textTime="结束"},1e3)):($scope.timer1=$interval(function(){$scope.timeCount.startTime-$scope.timeCount.systemTime<1e3&&($interval.cancel($scope.timer1),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)),limitCountTimes($scope.timeCount.startTime-$scope.timeCount.systemTime),$scope.timeCount.systemTime+=1e3},1e3),$timeout(function(){$scope.textTime="开始"},1e3)))),null!=e.data.reverse)if(timerLength=remindArray.length,$scope.newAndlimit.newSendList=e.data.reverse.acReserveList,$scope.newAndlimitLength=e.data.reverse.acReserveList.length,0==$scope.newAndlimit.newSendList.length||$scope.newAndlimit.newSendList==[])$scope.showReserveList=!1;else{$scope.showReserveList=!0;for(var t=0;t<$scope.newAndlimit.newSendList.length;t++)remindArray.push(t),countDownNowTime[t]=parseInt(nowT/1e3),countDownendTime[t]=parseInt($scope.newAndlimit.newSendList[t].reserveEndTime/1e3);for(var o=timerLength;o<remindArray.length;o++)countTimeNew(countDownNowTime[remindArray[o]],countDownendTime[remindArray[o]],remindArray[o])}else $scope.showReserveList=!1;else $scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"};else $scope.showFlashSale=!1,$scope.showReserveList=!1,$scope.timeCount={startTime:0,endTime:0,systemTime:0},$scope.moreCountTime={hours:"00",minutes:"00",seconds:"00"}})},$scope.crowdFundingMsg=function(e){newsendService.getcrowold(e).success(function(e){e.success&&(0!=e.data.zActivitySuccessList.length||0!=e.data.zActivityBeginningList.length||0!=e.data.zActivityToBeginList.length)?($scope.crowdFundingList=!0,$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList):($scope.crowdFundingList=!1,$scope.zcold=[],$scope.zcnow=[],$scope.zcpre=[])})},$scope.youLikeType=function(){localSpecialtyHomePageService.getSpecialtyLikeType(3).success(function(e){e.success&&0!=e.data.length?($scope.youLikeTypeArr=e.data,0==$scope.selectedIndex&&($scope.cateId=e.data[0].cId)):$scope.youLikeTypeArr=[]})},$scope.youLikeDataList=function(e,t,o,i,s,n){localSpecialtyHomePageService.getSpecialtyLikeDta(e,t,o,i,s,n).success(function(e){e.success&&null!=e.data?$scope.youLikeDataArr=e.data:$scope.youLikeDataArr=[]})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case 2:if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goBack=function(){for(var e=0;e<=remindArray.length;e++)$interval.cancel(newTime[remindArray[e]]);remindArray=[],$ionicHistory.goBack()},$scope.showMenu=function(){$scope.isDisplay?($scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"):($scope.isDisplay=!0,$scope.menuImg="img/ic_lookMoreActive.png")},$scope.toShare=function(){if(window.cordova){if(!UserService.isUserLogin())return void $state.go("login");$scope.showShare=!0}else PopupService.showToast("请下载APP执行此操作")},$scope.toHomePage=function(){$scope.isDisplay=!1,$state.go("homePage")},$scope.contactCustomer=function(){if($scope.isDisplay=!1,UserService.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")}else $state.go("login")},$scope.shareToPlatform=function(e){if(!UserService.getUser().mid)return void $state.go("login");var t="顺逛·特产汇 汇集全国优质特产",o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的带来",i="http://cdn09.ehaier.com/shunguang/H5/www/img/specialty_share_pic.png",s=UrlService.getShareLinkHeader()+"localSpecialtyHomePage/"+$scope.storeId,n=function(){CreditService.shareSuccessCallback()};window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,n):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,n):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,n):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,n),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,s,0,null,n),CreditService.qqShare()),5==e?$scope.copeText(s):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.cancelShare=function(){$scope.showShare=!1,$scope.isDisplay=!1},$scope.goToSpecialtyVenue=function(e,t){$scope.localSelect=e,$scope.moreSpecialtyModal.hide(),$timeout(function(){$state.go("SpecialtyVenueHome",{regionId:t,streetId:$scope.addressMsg.streetId})},600)},$scope.moreSelectSpecialty=function(){$scope.moreSpecialtyModal.show(),localSpecialtyHomePageService.getAllMsg().success(function(e){e.success&&($scope.allSpecialtyArr=e.data)})},$scope.closeMoreSpecialty=function(){$scope.moreSpecialtyModal.hide()},$scope.getAddressInit=function(){mainRes($scope.addressMsg.streetId),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId),$timeout(function(){$scope.youLikeDataList(3,$scope.cateId,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},800)},$scope.getAddress=function(){localSpecialtyHomePageService.getPositionId().success(function(res){res.success?(addressMessage=eval(res.data)[0],void 0!=addressMessage.provinceId&&void 0!=addressMessage.cityId&&void 0!=addressMessage.areaId&&void 0!=addressMessage.streetId?($scope.addressMsg={provinceId:addressMessage.provinceId,cityId:addressMessage.cityId,areaId:addressMessage.areaId,streetId:addressMessage.streetId},$scope.getAddressInit()):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())):($scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit())}).error(function(){$scope.addressMsg={provinceId:$scope.provinceId,cityId:$scope.cityId,areaId:$scope.districtId,streetId:$scope.streetId},$scope.getAddressInit()})},$rootScope.$on("CACHE_SUCCESS",function(e,t){for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1);var i={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(i),$scope.getAddress()}),$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$ionicModal.fromTemplateUrl("templates/localSpecialty/moreSpecialtyModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.moreSpecialtyModal=e}),$scope.$on("$destroy",function(){$scope.moreSpecialtyModal.remove()}),$scope.goToClassify=function(e,t){$scope.selectedIndex=e,$scope.cateId=t,$scope.youLikeDataList(3,t,$scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)},$scope.toGoSecialtyVenueHome=function(e){$state.go("SpecialtyVenueHome",{regionId:e,streetId:$scope.addressMsg.streetId})},$scope.hideMenu=function(){$scope.isDisplay=!1,$scope.menuImg="img/ic_lookMore.png"},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.isDisplay=!1;for(var o=0;o<=remindArray.length;o++)$interval.cancel(newTime[remindArray[o]]);$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.$on("$ionicView.beforeEnter",function(e,t){$stateParams.storeId&&($rootScope.shareId=$stateParams.storeId),$scope.isDisplay=!1,nowT=(new Date).getTime(),"back"==t.direction?($scope.getCartNum(),$scope.newProductAndTimeLimit($scope.addressMsg.provinceId,$scope.addressMsg.cityId,$scope.addressMsg.areaId,$scope.addressMsg.streetId)):($scope.init(),GetSwitchChecked(),$scope.showShare=!1,$scope.localSelect=0)})}]),APP.service("localSpecialtyHomePageService",["$http","UrlService",function(e,t){this.getAllMsg=function(){return e.get(t.getNewUrl("ALL_SPECIALTY"))},this.getPositionId=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getMaster=function(o){var i={streetId:o,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY"),i)},this.getNewAndLimit=function(o,i,s,n){var a={provinceId:o,cityId:i,districtId:s,streetId:n,noLoading:!0};return e.get(t.getNewUrl("NEW_AND_LIMIT"),a)},this.getSpecialtyLikeType=function(o){var i={type:o};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_TYPE"),i)},this.getSpecialtyLikeDta=function(o,i,s,n,a,r){var c={type:o,cateId:i,pId:s,cId:n,rId:a,sId:r,noLoading:!0};return e.get(t.getNewUrl("LOCAL_SPECIALTY_LIKE_DATA"),c)}}]),
<<<<<<< .mine
APP.controller("secondLevelStoreController",["UrlService","UserService","CreditService","PopupService","$stateParams","secondLevelStoreService","CartService","HomePageService","GoodsService","$q","$localstorage","$scope","$state","LoginService","$rootScope","$ionicModal","BranchTypeDetailService","$ionicScrollDelegate","$ionicHistory",function(UrlService,UserService,CreditService,PopupService,$stateParams,secondLevelStoreService,CartService,HomePageService,GoodsService,$q,$localstorage,$scope,$state,LoginService,$rootScope,$ionicModal,BranchTypeDetailService,$ionicScrollDelegate,$ionicHistory){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function sortById(e,t){return e.sort-t.sort}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function getProductList(){secondLevelStoreService.getSecondLevelProduct($scope.storeId,$scope.pageIndex,$scope.pageSize,$scope.filterData,$scope.productCateId,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.regionId).success(function(e){e.success?(e.data.productList&&($scope.productList=$scope.productList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.tempList=$scope.tempList.concat(e.products),$scope.productList=$scope.tempList)})),6*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1):($scope.productList=[],PopupService.showToast(e.message))})}window.cordova?$scope.isApp=!0:$scope.isApp=!1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.iosAppHeight={height:"64px",paddingTop:"20px"},$scope.iosAppPadding={paddingTop:"64px"}):($scope.iosAppHeight={height:"44px",paddingTop:"2px"},$scope.iosAppPadding={paddingTop:"44px"}),$scope.isBuyer=LoginService.getRole(),$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png",$scope.filterData="isHotDesc",$scope.productCateIdType="0",$scope.switch=!0,$scope.filter_index=0,$scope.pageIndex="1",$scope.pageSize="6",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.hasmore=!1,$scope.settingsList="",$scope.checkedIndex=0,$scope.tempList=[],$scope.productList=[],$scope.arrowState=["img/ic_sort_state_0.png","img/ic_sort_state_1.png","img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/ic_screen_state_0.png","img/ic_screen_state_1.png"],$scope.filter_index=0;var tabState=["",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.filterData="saleDesc",$scope.chooseIndex=3,$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.showMoreInfo=function(){$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!$scope.showShare},$scope.goToShare=function(e){if(e.preventDefault(),e.stopPropagation(),!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.clickSecondLevel=function(e){$scope.checkedIndex=e,$scope.productCateId=$scope.secTypeList[e].cId,$scope.tempList=[],$scope.productList=[],$scope.pageIndex=1,$scope.pageSize=6,getProductList()},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.hideMoreDetail=function(){$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.shareToPlatform=function(e){var t=$scope.secTitle,o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的到来~",i=$scope.sPic,s=UrlService.getShareLinkHeader()+"secondLevelStore/"+$stateParams.cityId+"/"+$scope.storeId;window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(s):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.customerServe=function(){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.openFilterModal();else{if($scope.resetFilter(),$scope.page=2,1==e){$scope.chooseIndex=e;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData=1==t?"commission":"commissionDesc"}else if(3==e)$scope.chooseIndex=e,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData="saleDesc";else if(4==e){$scope.chooseIndex=e;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.searchData=[],$scope.filterData=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList()}},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var i=o.length-1,s=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var n=0;n<o.length;n++)n>0&&"true"==o[n].active&&(o[0].active="false",s++);if(s==i||0==s){for(var n=0;n<o.length;n++)n>0&&(o[n].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var n=0;n<o.length;n++)n>0&&(o[n].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var i=0;i<$scope.lstAttributes[t].lstAttributeOptions.length;i++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[i].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[i].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].id==$scope.attributeId?(o[t].lstAttributeOptions[s].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,i=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&"true"==t.lstAttributeOptions[s].active&&(t.lstAttributeOptions[0].active="false",i++);if(i==o||0==i){for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false")}},$scope.init=function(){var e=$q.defer(),t=$q.defer(),o=$q.all([e.promise,t.promise]);$scope.tempList=[],$scope.productList=[],$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),$scope.cartTotalNum=0,$scope.filterParams="",$scope.regionId=$stateParams.cityId,$scope.pageIndex=1,$scope.pageSize=6,$scope.checkedIndex=0,$scope.chooseIndex=3,secondLevelStoreService.getSecTypeList($scope.regionId).success(function(t){t.success&&($scope.secTitle=t.data.pathName,$scope.sPic=t.data.sPic,$scope.secTypeList=JSON.parse(t.data.classify).sort(sortById),$scope.productCateId=$scope.secTypeList[0].cId,e.resolve())}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,$scope.page=1,t.resolve()}),o.then(function(){$scope.filterData="saleDesc",getProductList()}),CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.loadMore=function(){$scope.pageIndex=$scope.pageIndex+1,getProductList()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.hideMoreDetail()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0});$stateParams.shareId&&($rootScope.shareId=$stateParams.shareId),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.init()})}]),APP.service("secondLevelStoreService",["$http","UrlService",function(e,t){this.getSecondLevelProduct=function(o,i,s,n,a,r,c,l,d,u){var p={storeMemberId:o,pageIndex:i,pageSize:s,filterData:n,productCateId:a,provinceId:r,cityId:c,districtId:l,streetId:d,pageId:u};return e.get(t.getUrl("SECONDLEVEL_PRODUCTLIST"),p)},this.getSecTypeList=function(o){var i={regionId:o};return e.get(t.getNewUrl("SECONDLEVEL_SECTYPELIST"),i)}}]),APP.controller("SpecialtyVenueHomeController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","specialtyVenueHomeControllerService","$ionicPopup","CartService","LoginService","HomePageService","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,P,L,x,D,N){function _(){m.memberId=S.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==m.memberId&&(m.settingsList=e[t].list,!0)}m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png",m.pageTitle="",m.collects=0,m.topImgSrc="",m.topBanners=[],m.recommendations=[],m.communities=[],m.competitiveProducts=[],m.recommendProducts=[],m.hotProducts=[],m.cities=[],m.showShare=!1,m.shareImgUrl="",m.isCollected=0,m.dealPrice=u.dealPrice,m.regionId=f.regionId,m.streetId=f.streetId,m.storeId=s.get("storeId",$.globalConstant.storeId),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_1.png",m.isBuyer=parseInt(x.getRole()),m.flashProductList=[],m.midActivtyList=[],m.midCommList=[],m.getCollected=function(){return m.isCollected?"已收藏":"收藏"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(m.paddingtopClass={"margin-top":"16px"},m.paddingtopClasscontent={top:"64px"}):(m.paddingtopClass={"margin-top":"0px"},m.paddingtopClasscontent={top:"44px"}),m.$on("$ionicView.beforeEnter",function(e,t){if(f.shareId&&($.shareId=f.shareId),"back"==t.direction)return m.getCartNum(),D.isWdHost().success(function(e){$.isWdHost=e.data.isHost}),void _();A.getAllProducts(m.regionId,m.streetId).success(function(e){e.success&&(m.topImgSrc=e.data.topImageUrl,m.shareImgUrl=e.data.simplePicUrl,m.cities=e.data.cities,m.topBanners=e.data.topBanners,m.isCollected=e.data.isCollected,m.isCollected&&(m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_0.png"),m.recommendations=e.data.recommendations,m.hotProducts=e.data.hotProducts,m.communities=e.data.communities,m.competitiveProducts=e.data.competitiveProducts,m.pageTitle=e.data.pageTitle,m.collects=e.data.collects,m.recommendProducts=e.data.recommendProducts,h.$getByHandle("sepcialty_top_banner").update(),h.$getByHandle("sepcialty_top_banner").loop(!0),h.$getByHandle("specialty_recommond_banner").update(),h.$getByHandle("specialty_recommond_banner").loop(!0),null!=m.hotProducts&&(m.hotProdcutTitle=m.hotProducts[0].moudleTitle),null!=m.recommendations&&(m.curatorOfRecommendedTitle=m.recommendations[0][0].moduleTitle),null!=m.competitiveProducts&&(m.boutiqueTitle=m.competitiveProducts[0].moudleTitle))}),m.getCartNum(),D.isWdHost().success(function(e){$.isWdHost=e.data.isHost}),_()}),m.settingsList="",m.getCartNum=function(){L.getNumber().success(function(e){e.success?m.cartTotalNum=e.data:m.cartTotalNum=0})},m.$on("$ionicView.beforeLeave",function(){m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"}),m.goBack=function(){t.goBack()},m.showPopup=function(e){var t=P.show({template:e});I(function(){t.close()},1e3)},m.collected=function(){m.isCollected?A.cancelCollect(m.regionId).success(function(e){e.success&&(m.isCollected=0,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)-1+""),m.showPopup("取消成功"),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_1.png")}):A.addCollect(m.regionId).success(function(e){e.success&&(m.isCollected=1,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)+1+""),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_0.png",m.showPopup("收藏成功"))})},m.goToListOfSpecialtyGoods=function(){v.go("ListOfSpecialtyGoods",{pageId:m.regionId,productCateId:0})},m.showMenu=function(){m.isDisplay?(m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"):(m.isDisplay=!0,m.menuImg=$.imgBaseURL+"img/ic_lookMoreActive.png")},m.hideMenu=function(){m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"},m.cancelShare=function(){m.showShare=!1},m.goSecondLevelStore=function(e){v.go("secondLevelStore",{cityId:e})},m.goProductDetail=function(){v.go("")},m.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:T.getBannerTheme(o).success(function(e){v.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:v.go("bannerTheme",{bannerId:o});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:m.storeId});break;case 2:if(t){var n=t.slice(t.indexOf("=")+1);v.go("couponsDetail",{cId:n,userID:m.storeId,type:2})}else v.go("getCouponsList");break;case 3:var a=t.slice(t.indexOf("=")+1);v.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?T.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){v.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&v.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:v.go("crowdFunding");break;case 7:t?v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:m.storeId}):v.go("newSend");break;case 8:t?v.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):v.go("topic.qhot")}},m.toShare=function(){return m.isDisplay=!1,window.cordova?(m.menuImg=$.imgBaseURL+"img/ic_lookMore.png",S.isUserLogin()?(m.showShare=!0,void(window.device&&(m.shareToPlatform(),m.showShare=!m.showShare))):void v.go("login")):void m.showPopup("请下载APP执行此操作")},m.toHomePage=function(){m.isDisplay=!1,v.go("homePage")},m.contactCustomer=function(){if(m.isDisplay=!1,S.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+s.get("sg_login_token_secret").substring(6),"_blank","location=no")}else v.go("login")},m.shareToPlatform=function(e){if(!S.getUser().mid)return void v.go("login");var t=s.get("storeId",$.globalConstant.storeId),i=m.pageTitle,n="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",a=m.shareImgUrl,r=o.getShareLinkHeader()+"SpecialtyVenueHome/"+m.regionId+"/"+m.streetId+"/"+t,c={},l=function(e){N.shareSuccessCallback(e,c)};window.umeng?(0==e?window.umeng.shareToSina(i,n,a,r,0,null,l):1==e?window.umeng.shareToWechatSession(i,n,a,r,0,null,l):2==e?window.umeng.shareToWechatTimeline(i,n,a,r,0,null,l):3==e?(window.umeng.shareToQQ(i,n,a,r,0,null,l),N.qqShare()):4==e&&(window.umeng.shareToQzone(i,n,a,r,0,null,l),N.qqShare()),5==e?m.copeText(r):N.successShare()):alert("umeng undefined 只能在app分享"),m.showShare=!1},m.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),C.showToastShort("复制成功"),m.isShowCopyButton=!1):C.showToast("请下载APP执行此操作")}}]),APP.service("specialtyVenueHomeControllerService",["$http","UrlService",function(e,t){this.getAllProducts=function(o,i){var s={regionId:o,streetId:i};return e.get(t.getZCUrl("SPECIALY_VENUE_HOME"),s)},this.addCollect=function(o){var i={type:2,collectId:o};return e.get(t.getZCUrl("ADD_COLLECT"),i)},this.cancelCollect=function(o){var i={type:2,collectId:o};return e.get(t.getZCUrl("CANCEL_COLLECT"),i)}}]),APP.controller("AdvertisementController",["$scope","$rootScope","$timeout","$state","$interval","$stateParams","AdvertisementService","PopupService",function(e,t,o,i,s,n,a,r){function c(){var t=window.localStorage.getItem("hasAD");"noAD"!=t?(e.imgUrl=t,l=s(function(){e.second<=1?e.skipAd():e.second--},1e3)):i.go(d)}var l,d=n.from;e.imgUrl="",e.second=9,e.skipAd=function(){s.cancel(l),i.go(d)},e.$on("$ionicView.beforeEnter",function(){d=n.from,e.second=9,c()})}]),APP.service("AdvertisementService",["$http","UrlService",function(e,t){this.getAdImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_AD_IMAGE"),o)}}]),APP.controller("DirectPurchaseController",["$scope","UserService","AccountMessageService","$state","LoginService","RegisterService","PopupService","$ionicPopup",function(e,t,o,i,s,n,a,r){e.topPlus={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topPlus={"padding-top":"42px"}),e.init=function(){var o=t.getUser();e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.userLogOut=function(){e.sessionId?o.unloadAccount(e.token,e.sessionId,e.header).success(function(e,o,n,a){e.success&&(t.clearUser(),s.setRole(void 0),i.go("guidePage"))}):(t.clearUser(),s.setRole(void 0),i.go("guidePage"))},e.goToDelete=function(){r.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.userLogOut()})},e.goShopApply=function(){n.wdApply().success(function(e){e.success?e.data?i.go("newAuthenticationHome"):i.go("registerForStore"):a.showToast("服务端错误")}).error(function(){alert("网络错误")})},e.goSelection=function(){i.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("GuidePageController",["$scope","UserService","$state","LoginService","$localstorage",function(e,t,o,i,s){e.$on("$ionicView.beforeEnter",function(){s.set("ROLE_INFO","undefined")})}]),APP.controller("LoginController",["$timeout","HomePageService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,n=o.length-1;n>=0;n--)if(o[n].id==t)return i.isCommission=o[n].list[0].checked,i.cashSwitch=o[n].list[1].checked,i.goldRainSwitch=o[n].list[2].checked,void(s=!0);if(!s){i.isCommission=!0,i.cashSwitch=!0,i.goldRainSwitch=!0;var a={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(a),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),i.isCommission=!0,i.cashSwitch=!0,i.goldRainSwitch=!0}}function w(e){n.set("IsThirdLoginType",e),y++;var t={qq:4,sina:6,wechat:7};window.umeng.login(e,function(o){o=JSON.parse(o);var d={uid:o.uid,source:t[e],nickName:o.name,headerPic:o.profile_image_url?o.profile_image_url:o.headimgurl,openid:o.openid,unionid:o.unionid};if(d.uid){var h={userId:d.uid,userName:d.nickName,loginType:t[e],icon:d.headerPic,openid:d.openid,unionid:d.unionid};a.loginThird(h).success(function(e){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.success){c.setUser(e.data),S.initWebSocket();var t=e.data.mid;i.loginMemberId=e.data.mid,$(t),a.checkOpenStore(t).success(function(e){e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",t)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))}),c.setUser(e.data),e.data.sessionValue?n.set("sg_login_token_secret","Bearer"+e.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),g.wdApply().success(function(e){e.success?e.data?(c.setUser(e.data),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(i.loginGoNum=1,p.goBack(-1)):(i.loginGoNum=0,r.go("homePage"))):r.go("RegisterForStoreLogin",{hasHistory:1}):u.showToast("服务端错误")})}else e.message?u.showToast(e.message):u.showToast("登录失败！")}).error(function(e){l.alert({title:"提示",template:"网络连接失败！"})})}else y>3?u.showToast("授权失败，请稍后再试"):w(e)},function(e){l.alert({title:"提示",template:"第三方登录失败！"})})}s.isBuyer="1",s.isFocusShow=!0,s.identifyCodeImg="",s.showCaptcha=!1,s.showCaptchaForPhone=!1,s.eyeIndex=0,s.loginIndex=0,s.showVC=!1,s.canGetVcode=!0,s.VCodeTips="获取验证码",s.eyeArr=[i.imgBaseURL+"img/eye_close@2x.png",i.imgBaseURL+"img/eye_open@2x.png"],s.pwdArr=["password","text"],s.loginTypeArr=["短信验证码登录","账号密码登录"],s.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var y=0,T=p.viewHistory().backView,C=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";s.leftArrow={},s.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(s.leftArrow={"margin-top":"36px"},s.rightButton={top:"36px"});s.xyzloginName=c.getUser().loginName,s.userInfo={userName:s.xyzloginName,mobile:c.getUser().mobile,password:"",captcha:"",verificationCode:""},s.VCodeStyle={color:"#2979FF"},s.showVCode=function(){s.showVC=!s.showVC,s.identifyCodeImg="",s.userInfo.captcha="",1==s.loginIndex?(s.loginIndex=0,s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!1):(s.loginIndex=1,s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!0)},s.getVCode=function(){s.canGetVcode&&(s.userInfo.mobile&&0!=s.userInfo.mobile.length?s.globalConstant.mobileNumberRegExp.test(s.userInfo.mobile)?0==s.userInfo.captcha.length&&1==s.showCaptchaForPhone?u.showToast("请输入图形验证码"):a.fastLoginCaptcha(s.userInfo.mobile,s.userInfo.captcha,s.showCaptchaForPhone).success(function(e){if(e.data)if(-1==e.data&&0==s.userInfo.captcha.length)s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!0,u.showToast("请输入图形验证码");else{s.canGetVcode=!s.canGetVcode;var t=60;s.timer=o(function(){t-1<0?(s.VCodeTips="获取验证码",s.VCodeStyle={color:"#2979FF"},o.cancel(s.timer),s.canGetVcode=!0):(s.VCodeStyle={color:"#666666"},t--,s.VCodeTips="重发 "+t+"s")},1e3)}else u.showToast(e.message)}):u.showToast("请输入正确的手机号格式"):u.showToast("请输入手机号"))},s.toggleEye=function(){s.eyeIndex=(s.eyeIndex+1)%2},s.setImgCaptcha=function(){s.identifyCodeImg=a.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+n.get("sg_login_token_secret").substring(6)},s.setImgCaptchaForPhone=function(){s.identifyCodeImg=g.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+n.get("sg_login_token_secret").substring(6)},s.canClickLoginOrNot=function(){0!=s.userInfo.mobile.length&&0!=s.userInfo.verificationCode.length?s.canClickLogin=!0:s.canClickLogin=!1},s.toRegister=function(){T&&"guidePage"!=T.stateName?r.go("register",{hasHistory:1}):r.go("register",{hasHistory:0})},s.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&s.loginSG()},s.loginSG=function(){n.set("IsThirdLoginType","PT"),1==s.loginIndex?0==s.userInfo.mobile.length?u.showToast("请输入手机号"):s.globalConstant.mobileNumberRegExp.test(s.userInfo.mobile)?0==s.userInfo.verificationCode.length?u.showToast("请输入短信验证码"):s.userInfo.verificationCode.length>0&&s.userInfo.verificationCode.length<6||s.userInfo.verificationCode.length>6?u.showToast("短信验证码长度必须是6位"):a.fastLogin(s.userInfo.mobile,s.userInfo.verificationCode).success(function(e){if(e.data){var t=e.data.mid;$(t),i.loginMemberId=e.data.mid,c.setUser(e.data),S.initWebSocket(),i.userCount=s.userInfo.mobile,i.password="",window.localStorage.setItem("isLogin",c.isUserLogin()),u.showToast("登录成功"),e.data.sessionValue?n.set("sg_login_token_secret","Bearer"+e.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?p.goBack(-1):r.go("homePage"),window.cordova&&(i.gio.setUserId(t.toString()),i.gio.people.set({name:c.getUser().userName,mobile:c.getUser().mobile,email:c.getUser().email,gender:c.getUser().gender,birthday:c.getUser().birthday})),setTimeout(function(){window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var o={member_id:t,device_type:i.isIOS?"ios":"android",device_token:e};a.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){})},0),a.checkOpenStore(t).success(function(e,o,i,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",t)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))})}else u.showToast(e.message)}):u.showToast("请输入正确的手机号格式"):0==s.userInfo.userName.length?u.showToast("请输入用户名"):0==s.userInfo.password.length?u.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==s.userInfo.captcha.length&&1==s.showCaptcha?u.showToast("请输入验证码"):a.loginUserInfoCAPTCHA(s.userInfo.userName,s.userInfo.password,s.userInfo.captcha).success(function(o){if(o.success){var l=o.data.mid;$(l),i.loginMemberId=o.data.mid,c.setUser(o.data),S.initWebSocket(),i.userCount=s.userInfo.userName,i.password=s.userInfo.password,window.localStorage.setItem("isLogin",c.isUserLogin()),u.showToast("登录成功"),o.data.sessionValue?n.set("sg_login_token_secret","Bearer"+o.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),window.cordova&&(i.gio.setUserId(l.toString()),i.gio.people.set({name:c.getUser().userName,mobile:c.getUser().mobile,email:c.getUser().email,gender:c.getUser().gender,birthday:c.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var t={member_id:l,device_type:i.isIOS?"ios":"android",device_token:e};a.saveDeviceToken(t).success(function(e){e.success}).error(function(e){})},function(e){}),g.wdApply().success(function(e){
e.success?e.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(p.goBack(-1),i.loginGoNum=1):(i.loginGoNum=0,r.go("homePage")):t.isWdHost().success(function(e){e.success?(s.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o||null==e.data.o2o)?r.go("homePage"):r.go("RegisterForStoreLogin",{hasHistory:1})):u.showToast("获取数据信息失败！")}):u.showToast("服务端错误")}),a.checkOpenStore(l).success(function(e){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",l)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))})}else o.message?"forget_password"==o.errorCode?(u.showToast(o.message),e(function(){r.go("requestPassword")},2e3)):-1==o.data?(u.showToast(o.message),s.showCaptcha=!0,s.setImgCaptcha()):u.showToast(o.message):u.showToast("登录失败")})},s.isHideFooter=function(){s.isFocusShow=!1},s.isShowFooter=function(){s.isFocusShow=!0},s.thirdLogin=function(e){if(y=0,!window.umeng)return void alert("umeng 插件 未加载");w(e)},s.goBack=function(){p.goBack()},s.$on("$ionicView.beforeEnter",function(){s.showCaptcha=!1,s.showCaptchaForPhone=!1,s.setImgCaptchaForPhone(),a.checkLogin().success(function(e,t,o,i){s.setImgCaptcha(),s.setImgCaptchaForPhone()}),T=p.viewHistory().backView})}]),APP.service("LoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,i,s){var n={userName:o,password:encodeURIComponent(i),captcha:s,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),n)},this.loginUserInfo=function(o,i){var s={userName:o,password:i,noLoading:!0};return e.get(t.getUrl("LOGIN"),s)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var i={memberId:o};else i={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),i)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,i,s){if(s){var n={mobile:o,imgCaptcha:i};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:n,headers:{Authorization:"open the gate"}})}return n={mobile:o},e.get(t.getUrl("FAST_LOGIN_CAPTCHA"),n)},this.fastLogin=function(o,i){var s={mobile:o,captcha:i};return e.post(t.getUrl("FAST_LOGIN")+"?mobile="+s.mobile+"&captcha="+s.captcha)}}]),APP.controller("RegisterController",["$rootScope","$localstorage","$scope","$http","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){function w(t){var o=t;if(localStorage.getItem("setSwitch")){for(var i=JSON.parse(localStorage.getItem("setSwitch")),s=!1,n=i.length-1;n>=0;n--)if(i[n].id==o)return e.isCommission=i[n].list[0].checked,e.cashSwitch=i[n].list[1].checked,e.goldRainSwitch=i[n].list[2].checked,void(s=!0);if(!s){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var a={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};i.push(a),localStorage.setItem("setSwitch",JSON.stringify(i))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=[e.imgBaseURL+"img/eye_close@2x.png",e.imgBaseURL+"img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=e.imgBaseURL+"img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var y=h.hasHistory,T=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=a(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},a.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else n.showToast(e.message)}):n.showToast("请输入正确的手机号格式"):n.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?n.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?n.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?n.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(s){if(s.data){var a=s.data.mid;w(a),e.loginMemberId=s.data.mid,l.setUser(s.data),v.initWebSocket(),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),n.showToast("登录成功"),s.data.sessionValue?t.set("sg_login_token_secret","Bearer"+s.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?f.goBack(-1):r.go("homePage"),window.cordova&&(e.gio.setUserId(a.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:a,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(a).success(function(e,s,n,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){i.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",a)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else n.showToast(s.message)}):n.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?n.showToast("请输入用户名"):0==o.loginInfo.password.length?n.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?n.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(i){if(i.success){var a=i.data.mid;w(a),e.loginMemberId=i.data.mid,l.setUser(i.data),v.initWebSocket(),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),n.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),window.cordova&&(e.gio.setUserId(a.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:a,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),s.wdApply().success(function(t){t.success?t.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("homePage")):r.go("RegisterForStoreLogin",{hasHistory:1}):n.showToast("服务端错误")}),c.checkOpenStore(a).success(function(e){e.data?t.set("storeId",a):t.set("storeId",20219251)})}else i.message?(n.showToast(i.message),-1==i.data&&(o.showCaptcha=!0),o.setImgCaptcha()):n.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=s.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)};var C=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?n.showToast("请输入验证码！"):s.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;C=a(function(){t<=0?(a.cancel(C),C=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?n.showToast("该手机号已经注册过顺逛用户，请直接登录。"):e.message?n.showToast(e.message):n.showToast("获取验证码失败！")}):n.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?n.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?n.showToast("请输入短信验证码！"):0==o.xychecked?n.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》！"):s.newAddRegisterUserInfo(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(e.data.isCanRegister){var i={mobileNum:o.userInfo.mobileNum,password:o.userInfo.password,captcha:o.userInfo.captcha,imgCaptcha:o.userInfo.captchaImg};t.setObject("register_obj",i),m(function(){r.go("newAuthenticationHome",{promotionCode:o.promotionCode,types:100})},0)}}else n.showToast(e.message)}):n.showToast("密码不符合规则！"):n.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=!1,c.checkLogin().success(function(e,t,i,s){o.setImgCatpcha()}),y=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?$.open(S.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e}}]),APP.service("RegisterService",["$http","UrlService",function(e,t){this.addRegisterUserInfo=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:s,imgCaptcha:n},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:a})},this.newAddRegisterUserInfo=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(s),imgCaptcha:n},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:a})},this.getCaptcha=function(o,i){var s={mobileNum:o,captcha:i};return e.get(t.getUrl("GET_CAPTCHA"),s)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(assword),imgCaptcha:n,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:a})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RegisterForStoreController",["$localstorage","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","$rootScope","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){t.captchaFlag=!0,t.isAgreeConsent=!1,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.iconImage=f.imgBaseURL+"img/ic_photo.png";var S=m.hasHistory;t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.agreeConsent=function(){t.isAgreeConsent=!t.isAgreeConsent};var I=void 0;t.getIdentifyCode=function(){t.captchaFlag&&(t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?i.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e){if(e.success){var o=60;I=s(function(){o<=0?(s.cancel(I),I=void 0,o=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=o+"秒后可重发",t.captchaFlag=!1,o--)},1e3,100)}else"1102"==e.errorCode?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！"))},t.registerUserInfo=function(){var e=t.globalConstant.passwordRegExp;t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.password.length?i.showToast("请输入密码！"):e.test(t.userInfo.password)?0==t.userInfo.captcha.length?i.showToast("请输入短信验证码！"):t.isAgreeConsent?i.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):o.bindMobile(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void i.showToast(e.message);r.getUser();r.getUser().mobile=t.userInfo.mobileNum,n.go("newAuthenticationHome")}else"该手机已被注册！"==e.message?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("注册失败！")}):i.showToast("密码不符合规则！"):i.showToast("请输入在正确的手机号！")},t.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})},t.setHeaderImg=function(){return},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha(),S=m.hasHistory})}]),APP.controller("RegisterForStoreLoginController",["$localstorage","$rootScope","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){o.captchaFlag=!0,o.isAgreeConsent=!1,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=t.imgBaseURL+"img/ic_photo.png";var S=f.hasHistory;o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.agreeConsent=function(){o.isAgreeConsent=!o.isAgreeConsent},o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})};var I=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?s.showToast("请输入验证码！"):i.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;I=n(function(){t<=0?(n.cancel(I),I=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?s.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?s.showToast("请输入短信验证码！"):o.isAgreeConsent?s.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):i.bindMobile(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void s.showToast(e.message);c.getUser();c.getUser().mobile=o.userInfo.mobileNum,0==t.loginGoNum?a.go("homePage"):m.goBack(-2)}else"该手机已被注册！"==e.message?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("注册失败！")}):s.showToast("密码不符合规则！"):s.showToast("请输入在正确的手机号！")},o.setHeaderImg=function(){return},o.$on("$ionicView.beforeEnter",function(){o.setImgCatpcha(),S=f.hasHistory})}]),APP.controller("RequestPasswordController",["$localstorage","$scope","RequestPasswordService","PopupService","$interval","$state","$timeout",function(e,t,o,i,s,n,a){t.captchaFlag=!0,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.getIdentifyCode=function(){t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?i.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e,o,n,a){if(e.success){var r=60,c=void 0;c=s(function(){r<=0?(s.cancel(c),c=void 0,r=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=r+"秒后可重发",t.captchaFlag=!1,r--)},1e3,100)}else e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！")},t.passwordSubmit=function(){0==t.userInfo.mobileNum.length?i.showToast("请输入您的手机号！"):t.globalConstant.passwordRegExp.test(t.userInfo.password)?0==t.userInfo.captcha.length?i.showToast("获取验证码失败！"):o.requestPassword(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e,o,s,r){e.success?(i.showToast("修改成功"),a(function(){n.go("login")},1e3)):e.message?(i.showToast(e.message),t.setImgCatpcha()):(i.showToast("提交失败！"),t.setImgCatpcha())}):i.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)")},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha()})}]),APP.service("RequestPasswordService",["$http","UrlService",function(e,t){this.requestPassword=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(s),imgCaptcha:n};return e({method:"POST",url:t.getUrl("REQUEST_PASSWORD"),params:a})},this.getCaptcha=function(o,i){var s={mobileNum:o,captcha:i};return e.get(t.getUrl("GET_PASSWORD_CAPTCHA"),s)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")}}]),APP.controller("ShopApplyController",["$scope","$rootScope","$state","ShopApplyService","MyStoreService","GoodsService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){e.addressName="",e.goToAddress=!1,e.categoryData=[],e.selectText="",e.selectKey="";var S=window.innerHeight,I=S-373+"px";e.contentHeight={height:I},e.addressTitle="配送至",e.dataAdd=null,e.flag="SHOP_APPLY_ADDRESS",e.defaultValue=null,e.level=0;var $,w,y={};e.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:""},e.mid=l.getUser().mid,e.promotionCode=u.promotionCode,e.init=function(){e.showAlert=!1,e.goToAddress?e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour:e.addressName="",e.selectText=e.textUnion,e.selectValue=e.valueUnion,e.mid=l.getUser().mid,u.promotionCode&&(e.applyInfo.promotionCode=u.promotionCode),e.mid&&d.getStoreInfo(e.mid).success(function(t,o,i,s){t.success&&(e.storeCode=t.data.storeCode,e.storeType=t.data.storeType)})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)},e.addressInit=function(t,o,i,s){if(e.addressTipFlag=!1,f.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=s,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",n.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var T=!1;e.goSelect=ionic.Utils.debounce(function(o,i){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var i=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=i.text,e.defaultValue["value"+e.level]=i.value,e.level>-2)-1==e.level&&(e.selectProvince=i.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=f.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){1==ah&&(w=i.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(w,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,f.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=i.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=f.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=f.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,s.getLocationList(i.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&($=i.value);var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,s.getLocationList($,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),f.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else{if(T)return;g(function(){T=!1},1500),t.$broadcast(e.flag,e.defaultValue),T=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){y=a.getAddressInfo();var o=y.regionName+"/"+y.streetName;s.addAddress(y.provinceId,y.cityId,y.areaId,o,y.streetId).success(function(){var o={"text-1":y.provinceName,"text-2":y.cityName,"text-3":y.regionName,"text-4":y.streetName,"value-1":y.provinceId,"value-2":y.cityId,"value-3":y.areaId,"value-4":y.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.$on("$destroy",function(){e.addressModal.remove()}),t.$on("SHOP_APPLY_ADDRESS",function(t,o){e.goToAddress=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.adrProvinceId=o["value-1"],e.adrCityId=o["value-2"],e.adrAreaId=o["value-3"],e.adrStreetId=o["value-4"],e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour}),t.$on("SHOP_APPLY_UNION",function(t,o){e.textUnion=o.text,e.valueUnion=o.value}),e.checkChange=function(t,o){i.checkText(t).success(function(i){i.data||""==t||("-100"!=i.errorCode&&r.showToast("请不要使用违禁词！"),1==o?e.applyInfo.ownerName="":e.applyInfo.storeName="")})},e.shopApplySubmit=function(){return e.applyInfo.ownerName?e.applyInfo.address?e.applyInfo.storeName?(e.showAlert=!1,void(/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.ownerName)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{2,50}$/.test(e.applyInfo.address)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.storeName)?/^(HR|hr|Hr|hR).{6,18}$/.test(e.applyInfo.hrCode)||"10"!=e.selectValue?0==e.addressName.length?r.showToast("请选择所在地区！"):e.selectText?"10"!=e.selectValue?(e.showAlertCheck=!1,e.showAlert=!1,e.applyInfo.hrCode="",i.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:Math.round(t.data.totalCommission),memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):(t.errorCode="-100")?(p.show({template:"您尚未登录或登录失效,请先登录",duration:3500}),o.go("login")):r.showToast(t.message)})):(e.showAlertCheck=!1,e.showAlert=!1,i.check(e.applyInfo.hrCode).success(function(t,s,n,a){t?i.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:t.data.totalCommission,memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):r.showToast(t.message)}):e.showAlertCheck=!0})):r.showToast("请选择联盟分类！"):e.showAlert=!0:r.showToast("店铺名字为1～20的常用字符！"):r.showToast("详细地址为2～50的常用字符！"):r.showToast("店主姓名为1～20的常用字符！"))):void r.showToast("店铺名称必须填写！"):void r.showToast("详细地址必须填写！"):void r.showToast("店主姓名必须填写！")},e.clearInput=function(){e.applyInfo.ownerName=void 0,e.applyInfo.address=void 0,e.applyInfo.storeName=void 0,e.promotionCode||(e.applyInfo.promotionCode=""),e.addressName="",e.applyInfo.hrCode=void 0,e.selectText=void 0},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(t,i){if(e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&f.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.promotionCode=u.promotionCode,l.isUserLogin()){if(1==c.getRole())return p.show({template:"您已经是店主了,进店看看吧",duration:2500}),void g(function(){},2e3).then(function(){o.go("shop")});e.init()}else e.init();"back"==i.direction||e.clearInput(),e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.controller("ShopApplySuccessController",["trueAuthenticationService","$scope","$stateParams","ShopApplySuccessService","$ionicHistory","$state",function(e,t,o,i,s,n){t.$on("$ionicView.beforeEnter",function(){var o=s.viewHistory().histories.root;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),i.getShopData().success(function(e){e.success?(t.memberCount=e.data.openStoreRank,"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr2","ownerregist","1"])):t.memberCount=888888}),t.isOrNoGoHomePage=function(){"register"==o.stack[o.stack.length-3].stateName?n.go("homePage"):s.goBack(-2)},e.doInit().success(function(e){e.success?t.isNotAuthentication=e.data.isAuth:t.isNotAuthentication=!0}),t.goToAuthentication=function(){n.go("trueAuthenticationList",{type:2})}})}]),APP.service("ShopApplySuccessService",["$http","UrlService",function(e,t){this.getShopData=function(){return e.post(t.getUrl("SHOP_APPLY_SUCCESS"))}}]),APP.controller("CustomizehdController",["$scope","$stateParams","$ionicHistory","$rootScope","$state",function(e,t,o,i,s){e.imgUrl=t.url,e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},e.goBack=function(){"advertisement"==i.fromState?s.go("homePage"):e.goBackFlag&&(e.goBackFlag=!1,o.goBack())},e.$on("$ionicView.beforeEnter",function(o,i){e.goBackFlag=!0,e.imgUrl=t.url})}]),APP.controller("haierStaffControl",["trueAuthenticationService","$interval","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","haierStaffService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){g.captchaFlag=!0,g.paracont="获取验证码",g.isStaff=!1,g.isBtnShow=!1,g.isActiveTimer=!1,g.staffId="",g.obj={staffId:"",verification:""},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(g.paddingtopClass={"margin-top":"16px"},g.paddingtopClasscontent={top:"60px"}):(g.paddingtopClass={"margin-top":"0px"},g.paddingtopClasscontent={top:"44px"}),g.init=function(){e.doInit().success(function(e){e.success?null!=e.data.empInfo?(g.isStaff=!0,g.staffId=e.data.empInfo.empNo,f.getActiveIsStart().success(function(e){g.isActiveTimer=!!e})):(g.isStaff=!1,g.isActiveTimer=!1):o.showToast(e.message)})};g.$watch("obj",function(){/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)&&/^[0-9]{6}$/.test(g.obj.verification)?g.isBtnShow=!0:g.isBtnShow=!1},!0);g.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?a.open(n.getHead()+"mstore/sg/helpDetail.html?id="+e,t):m.go("helpDetail",{helpId:e,content:t})},g.goBack=function(){c.goBack()},g.submitStaffMsg=function(){var e=g.obj.staffId.toLowerCase();f.postStaffMsg(e,g.obj.verification).success(function(e){e.success&&null!=e.data?(o.showToast("海尔员工认证成功!"),f.getActiveIsStart().success(function(e){e?(g.init(),g.isActiveTimer=!0):(g.isActiveTimer=!1,m.go("trueAuthenticationList"))})):o.showToast(e.message)})};var S,I=void 0;g.getIdentifyCode=function(){if(g.captchaFlag)if(/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)){var e=g.obj.staffId.toLowerCase()
;f.doInit(e).success(function(e){e.success?(S=60,I=t(function(){S<=0?(t.cancel(I),I=void 0,S=60,g.paracont="重发验证码",g.captchaFlag=!0):(g.paracont=S+"秒后可重发",g.captchaFlag=!1,S--)},1e3,100)):o.showToast(e.message)})}else o.showToast("请输入正确的员工编号！")},g.goNewYearActive=function(){m.go("bannerTheme",{bannerId:n.getCPUrl("KMH_ID")})},g.$on("$ionicView.beforeEnter",function(){g.obj={staffId:"",verification:""},g.staffId="",g.captchaFlag=!0,S=60,g.paracont="获取验证码",t.cancel(I),g.init()})}]),APP.service("haierStaffService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={empNo:o};return e.get(t.getUrl("GET_HAIER_STAFF_MSG"),i)},this.postStaffMsg=function(o,i){var s={empNo:o,captcha:i};return e({method:"POST",url:t.getUrl("POST_HAIER_STAFF_MSG"),params:s})},this.getActiveIsStart=function(){return e.get(t.getGameUrl("IS_KAIMENHONG_AVAILABLE"))}}]),APP.controller("newAuthenticationHome",["GetStatisticInfoService","HomePageService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","ShopApplyService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y){a.localStorage=window.localStorage,a.addressName="请选择",a.goToAddress=!1,a.categoryData=[],a.selectText="",a.selectKey="",a.isComplete=!1,a.isHasKey=!1,a.hrCodes=!1,a.promotionCode="",a.avatarImage="img/registerSuccess.png",a.userInfo={picTempFile:""};var T=window.innerHeight,C=T-373+"px";a.contentHeight={height:C},a.addressTitle="配送至",a.dataAdd=null,a.flag="SHOP_APPLY_ADDRESS",a.defaultValue=null,a.level=0;var b={};a.user={},a.mid=m.getUser().mid,a.init=function(){a.user=m.getUser(),void 0!=a.user.avatarImageFileId&&(a.avatarImage=a.user.avatarImageFileId),a.addressName="请选择",a.showAlert=!1,a.goToAddress?a.addressName=a.textOne+a.textTwo+a.textThree:a.addressName="",a.selectText=a.textUnion,a.applyInfo.category=a.selectText,a.selectText&&(a.infos=a.selectText.substring(0,4),"人人服务"==a.infos?a.hrCodes=!0:a.hrCodes=!1),a.selectValue=a.valueUnion,a.mid=m.getUser().mid,a.mid&&f.getStoreInfo(a.mid).success(function(e,t,o,i){e.success&&(a.storeCode=e.data.storeCode,a.storeType=e.data.storeType)})},a.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)},a.addressInit=function(e,t,o,i){if(a.addressTipFlag=!1,$.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=e?JSON.parse(e):{},a.level=i,t){a.dataAdd=JSON.parse(t),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.arr=a.nowLevelIndex;for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1)}else a.finish=!1,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",d.getLocationList("",0).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel;for(var t=(JSON.stringify(a.defaultValue),JSON.stringify(a.dataAdd),0);t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var A=!1;a.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<a.nowLevelIndex.length;o++)o>a.nowLevel&&(a.nowLevelIndex[o]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=e;var t=arguments[1],e=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=t.text,a.defaultValue["value"+a.level]=t.value,a.level>-2)-1==a.level&&(a.selectProvince=t.text,a.provinceIndex=e,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=$.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel),ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,d.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),a.dataAdd=e.data,a.addressTipFlag=!1;var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.citySel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",d.getLocationList(areaValueCity,1).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,-1),a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,$.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}).error(function(e){p.showToast("获取地址信息失败！")})};else if(a.level>-4&&-3!=a.level)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,a.cityTop=$.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,i.getLocationList(t.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",a.level=a.levelArea,i.getLocationList(areaValue,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),$.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else if(-3==a.level)a.addressModal.hide(),a.regionTrue=!0,a.textOne=a.defaultValue["text-1"],a.textTwo=a.defaultValue["text-2"],a.textThree=a.defaultValue["text-3"],a.adrProvinceId=a.defaultValue["value-1"],a.adrCityId=a.defaultValue["value-2"],a.adrAreaId=a.defaultValue["value-3"],a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree,a.selectArea=t.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=$.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,i.getLocationList(t.value,ah).success(function(e){a.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1;else{if(A)return;S(function(){A=!1},1500),r.$broadcast(a.flag,a.defaultValue),A=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=r.globalConstant.autoPosition){b=u.getAddressInfo();var e=b.regionName+"/"+b.streetName;d.addAddress(b.provinceId,b.cityId,b.areaId,e,b.streetId).success(function(){var e={"text-1":b.provinceName,"text-2":b.cityName,"text-3":b.regionName,"value-1":b.provinceId,"value-2":b.cityId,"value-3":b.areaId};r.$broadcast(a.flag,e),a.addressModal.hide()})}},w.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},a.$on("$destroy",function(){a.addressModal.remove()}),r.$on("SHOP_APPLY_ADDRESS",function(e,t){a.goToAddress=!0,a.textOne=t["text-1"],a.textTwo=t["text-2"],a.textThree=t["text-3"],a.adrProvinceId=t["value-1"],a.adrCityId=t["value-2"],a.adrAreaId=t["value-3"],a.addressName=a.textOne+a.textTwo+a.textThree}),r.$on("SHOP_APPLY_UNION",function(e,t){a.textUnion=t.text,a.valueUnion=t.value}),a.checkChange=function(e,t){l.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&p.showToast("请不要使用违禁词！"),1==t?a.applyInfo.ownerName="":a.applyInfo.storeName="")})},a.goCommonUnion=function(){"请选择"==a.addressName?p.showToast("请选择所在地区！"):c.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};a.$watch("applyInfo",function(){a.applyInfo.storeName&&a.applyInfo.category?0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length?a.isComplete=!1:a.isComplete=!0:a.isComplete=!1},!0);a.goAuthentication=function(){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(a.showAlert=!1,a.applyInfo.storeName.length<=1)p.showToast("店铺名字为2～20的常用字符！");else if(/[\ud800-\udbff][\udc00-\udfff]/g.test(a.applyInfo.storeName))p.showToast("亲，不可以使用表情喔!");else if(t.test(a.applyInfo.storeName))p.showToast("店铺名称不能包含特殊字符!");else if(0==a.addressName.length)p.showToast("请选择所在地区！");else if(a.selectText)if(/^(HR|hr|Hr|hR).{6,18}$/.test(a.applyInfo.hrCode)||"10"!=a.selectValue)if(0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length)p.showToast("请填写推荐码!");else{a.xyzPromotionCode=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;var i={storeName:a.applyInfo.storeName,memberType:a.selectValue,provinceId:a.adrProvinceId,cityId:a.adrCityId,regionId:a.adrAreaId,regionName:a.addressName,address:a.applyInfo.address,promotionCode:a.applyInfo.promotionCode,hrCode:a.applyInfo.hrCode,isPromotionCode:a.promotionCode};n.setObject("newAuthentication_obj",i);var s=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;a.register_obj=n.getObject("register_obj"),a.register_obj.mobileNum!=a.iphoneNumber&&100==a.types?l.newShop(a.applyInfo.storeName,a.selectValue,s,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address,a.register_obj.mobileNum,a.register_obj.password,a.register_obj.captcha,a.register_obj.imgCaptcha).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?n.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):n.set("sg_login_token_secret","Bearer"+e.generateUUID())),o.initWebSocket(),S(function(){c.go("shopApplySuccess")},100)):p.showToast(t.message)}):l.applySubmitStore(a.memberId,a.applyInfo.storeName,a.selectValue,s,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?n.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):n.set("sg_login_token_secret","Bearer"+e.generateUUID())),S(function(){c.go("shopApplySuccess")},100)):p.showToast(t.message)})}else p.showToast("上岗证号必须为HR开头，总长度8-20位！");else p.showToast("请选择类别！")},a.getPromotionCode=function(){if(!(a.adrAreaId||"请选择"!=a.addressName||a.adrCityId||a.adrProvinceId))return void p.showToast("请选择地址");0!=a.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):0!=a.applyInfo.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):l.getPromotion(a.adrAreaId).success(function(e){e.success?null!=e.data&&(a.applyInfo.promotionCode=e.data):p.showToast(e.message)})},a.isFocus=function(){a.isHasKey=!0},a.isBlur=function(){a.isHasKey=!1},a.isClear=function(){a.applyInfo.address="",a.isHasKey=!1},a.clearInput=function(){a.applyInfo.ownerName=void 0,a.applyInfo.address=void 0,a.applyInfo.storeName=void 0,a.addressName="请选择",a.applyInfo.hrCode=void 0,a.selectText="请选择"},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(e,t){if(a.memberId=m.getUser().mid,a.iphoneNumber=m.getUser().mobile,a.dataAdd=null,a.defaultValue=null,a.hrCodes=!1,a.promotionCode=h.promotionCode,a.types=h.types,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&$.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),m.isUserLogin()){if(10==g.getRole())return v.show({template:"您已经是店主了,进店看看吧",duration:2500}),void S(function(){},2e3).then(function(){c.go("homePage")});a.init()}else a.init();"back"==t.direction?(void 0==a.selectValue&&(a.selectText="请选择"),a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree):(a.clearInput(),a.applyInfo.storeName="",a.applyInfo.category="",a.applyInfo.promotionCode="",a.addressName="请选择",a.selectText="请选择"),a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("ShopApplyService",["$http","UrlService","$window",function(e,t,o){this.applySubmit=function(o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){var S={memberId:o,storeName:i,memberRealName:s,provinceId:n,cityId:a,regionId:r,streetId:c,regionName:l,address:d,memberType:u,memberName:p,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:S})},this.checkPerfectInformation=function(o,i,s,n,a,r,c,l,d,u){var p={storeName:o,memberType:i,promotionCode:s,hrCode:n,provinceId:a,cityId:r,regionId:c,streetId:l,regionName:d,address:u};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:p})},this.checkText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),i)},this.check=function(o){var i={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),i)},this.getPromotion=function(o){var i={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:i})},this.newShop=function(o,i,s,n,a,r,c,l,d,u,p,g,m){var f={storeName:o,memberType:i,promotionCode:s,hrCode:n,provinceId:a,cityId:r,regionId:c,regionName:l,address:d,mobileNum:u,password:encodeURIComponent(p),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,i,s,n,a,r,c,l,d,u){var p={memberId:o,storeName:i,memberType:s,promotionCode:n,hrCode:a,provinceId:r,cityId:c,regionId:l,regionName:d,address:u};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:p})}}]),APP.controller("trueAuthenticationControl",["PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){u.isMake=!1,u.isMatching=!1,u.isPrompts=!1,u.isPopup=!1,u.isRetry=!1,u.isOther=!1,u.isTrueMsg=!1,u.isAgain=!1,u.userType=l.type,u.IDNumber="",u.userName="",u.storeCode=0,u.storeType=0,u.channal="APP",u.obj={isMyName:"",isMyIdNumber:""},u.init=function(){u.promotionCodeRouter?u.phoneNumber=u.register_obj.mobileNum:u.memberId?g.doInit().success(function(e){e.success?(u.isNotAuthentication=e.data.isAuth,null!=e.data.identity&&u.isNotAuthentication?(u.isOkAuthentication={color:"#999"},u.IDNumber=e.data.identity.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,i){for(var s="";s.length<o.length;)s+="*";return t+s+i}),u.userName=e.data.identity.realName.replace(/.{1}/,"*"),u.obj.isMyName=e.data.identity.realName,u.obj.isMyIdNumber=e.data.identity.identityNo,u.phoneNumber=e.data.identity.mobile):(u.isOkAuthentication={color:"#000"},u.isNotAuthentication=!1,u.phoneNumber=n.getUser().mobile,u.isPopup=!1,u.isMake=!1,u.isMatching=!1,u.isPrompts=!1)):(u.message=e.message,u.isRetry=!0)}):u.phoneNumber=u.register_obj.mobileNum},u.retry=function(){u.isRetry=!1},u.IwantETC=function(){u.isTrueMsg=!1},u.commonFunctions=function(){u.isPopup=!0,d(function(){u.isPopup=!1,p.go("homePage")},1e3)},u.clickOk=function(){t.checkOpenStore(u.memberId).success(function(e,t,s,n){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){f.get(i.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?u.isTrueMsg=!0:(u.isTrueMsg=!1,g.postUserMsg(u.obj.isMyName,u.obj.isMyIdNumber,u.phoneNumber,u.channal).success(function(e){e.data?(u.message=e.message,o.loginIsAuthentication=!1,u.isPopup=!0,u.isMatching=!1,u.isRetry=!1,u.isOther=!1,d(function(){u.isPopup=!1,p.go("homePage")},1e3)):(u.message=e.message,u.isRetry=!0,u.isMatching=!0,u.isPrompts=!1,u.isPopup=!1)}))}).error(function(t){e.showToast("网络连接失败！")})},u.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,t):p.go("helpDetail",{helpId:e,content:t})},u.isSubmit=function(){u.isTrueMsg=!1,g.postUserMsg(u.obj.isMyName,u.obj.isMyIdNumber,u.phoneNumber,u.channal).success(function(e){e.data?(u.message=e.message,u.isMatching=!1,u.isRetry=!1,u.isOther=!1,u.isPopup=!0,u.isPrompts=!1,o.loginIsAuthentication=!1,u.mentionCenterNum=o.canGetMount,d(function(){u.isPopup=!1,5==u.userType?p.go("bankCard"):2==u.userType?p.go("homePage"):8==u.userType?p.go("mentionCenter",{canAmount:u.mentionCenterNum}):p.go("personnalCenter")},600)):(u.message=e.message,u.isRetry=!0,u.isMatching=!0,u.isPrompts=!1,u.isPopup=!1)})},u.retry=function(){u.isRetry=!1};u.$watch("obj",function(){/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/.test(u.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(u.obj.isMyIdNumber)?g.getUsNameOrId(u.obj.isMyName,u.obj.isMyIdNumber).success(function(e){e.data?(u.message=e.message,u.isPrompts=!0,u.isMake=!0,u.isMatching=!1,u.isRetry=!1):(u.message=e.message,u.isMake=!1,u.isPrompts=!1,u.isMatching=!0,u.isRetry=!1)}):(u.isMake=!1,u.isPrompts=!1,u.isMatching=!1)},!0);u.goBack=function(){a.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.$on("$ionicView.beforeEnter",function(){u.memberId=n.getUser().mid,u.isPopup=!1,u.isRetry=!1,u.isMake=!1,u.isMatching=!1,u.isPrompts=!1,u.newAuthentication_obj=r.getObject("newAuthentication_obj"),u.register_obj=r.getObject("register_obj"),u.promotionCodeRouter=u.newAuthentication_obj.isPromotionCode,u.promotionCodeRouter&&(u.phoneNumber=u.register_obj.mobileNum),u.memberId&&u.promotionCodeRouter&&(u.phoneNumber=u.register_obj.mobileNum),u.init(),u.obj.isMyName="",u.obj.isMyIdNumber=""})}]),APP.service("trueAuthenticationService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("TRUE_REALNAMEAUTH"))},this.getUsNameOrId=function(o,i){var s={realName:o,identityNo:i};return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:s})},this.postUserMsg=function(o,i,s,n){var a={realName:o,identityNo:i,mobile:s,channal:n};return e({method:"POST",url:t.getUrl("POST_USERDATAANDID"),params:a})},this.postUserInfoPC=function(o,i,s){var n={realName:o,identityNo:i,mobile:s};return e({method:"POST",url:t.getUrl("POST_USERDATA"),params:n})}}]),APP.controller("trueAuthenticationListControl",["trueAuthenticationService","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationListService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){p.isTrueAuthentication=!1,p.isStaff=!1,p.init=function(){e.doInit().success(function(e){e.success?(null!=e.data.identity?p.isTrueAuthentication=!0:p.isTrueAuthentication=!1,null!=e.data.empInfo?p.isStaff=!0:p.isStaff=!1):t.showToast(e.message)})},p.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?n.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,t):g.go("helpDetail",{helpId:e,content:t})},p.goBack=function(){r.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"60px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"44px"}),p.$on("$ionicView.beforeEnter",function(){p.init()})}]),APP.service("trueAuthenticationListService",["$http","UrlService",function(e,t){}]),APP.controller("AboutUsController",["$scope","$rootScope",function(e,t){var o=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=o?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.softwareUpdate=function(){}}]),APP.controller("CollectionController",["$rootScope","$scope","CollectionService","$timeout","UserService","GoodsService","CommonAddressService","HomePageService",function($rootScope,$scope,CollectionService,$timeout,UserService,GoodsService,CommonAddressService,HomePageService){function getCollectionProduct(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,CollectionService.showCollection(provinceId,cityId,districtId,streetId).success(function(e,t,o,i){e.success&&($scope.items=e.data.productsList)})}else alert("获取收藏失败")}).error(function(e){var t=CommonAddressService.getAddressInfo();CollectionService.showCollection(t.provinceId,t.cityId,t.areaId,t.streetId).success(function(e,t,o,i){e.success&&($scope.items=e.data.productsList)})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}function getCollectionStoreList(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,$scope.streetId=streetId,CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,i){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})}else alert("获取收藏失败")}).error(function(e){CommonAddressService.getAddressInfo();CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,i){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})})}$scope.items=[],$scope.typeArr=["商品","店铺/场馆"],$scope.updateResult=!0,$scope.updateContent="",$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.init=function(){$scope.collectionType="product",$scope.storePage=1,$scope.storePageSize=5,$scope.hasMore=!1,$scope.items=[],getCollectionProduct()},$scope.loadMore=function(){$scope.storePage+=1,getCollectionStoreList()},$scope.checkType=function(e){0==e?($scope.collectionType="product",getCollectionProduct(),$(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px")):($scope.collectionType="store",$scope.items=[],getCollectionStoreList(),$(".collection_type>div:nth-child(2)").css("color","#2979FF"),$(".collection_type>div:nth-child(2) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(1)").css("color","#666666"),$(".collection_type>div:nth-child(1) div").css("borderBottom","0px"))},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction?$scope.direction="back":($scope.storeId=UserService.getUser().mid,$scope.direction="forword",$scope.init())}),$scope.$on("$ionicView.enter",function(){"back"==$scope.direction||($(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px"))}),$scope.delete=function(e){CollectionService.deleteCollection($scope.items[e].productId).success(function(e,t,o,i){e.success?($scope.showResult("删除成功"),$scope.init()):$scope.showResult("删除失败")})},$scope.showResult=function(e){$scope.updateContent=e,$scope.updateResult=!1,$timeout(function(){$scope.updateResult=!0},1e3)}}]),APP.service("CollectionService",["$http","UrlService",function(e,t){this.showCollection=function(o,i,s,n){var a={provinceId:o,cityId:i,districtId:s,streetId:n};return e.get(t.getUrl("COLLECTION_LIST"),a)},this.deleteCollection=function(o){var i={productId:o};return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),params:i})},this.getStoreCollection=function(o,i){var s={page:o,pageSize:i};return e.get(t.getUrl("STORE_COLLECTIONLIST"),s)}}]),APP.controller("FeedbackPlusController",["$scope","$state","FeedbackPlusService","PopupService","$ionicActionSheet","AssessService","UserService",function(e,t,o,i,s,n,a){function r(){e.feedbackType=6,e.canCommit=!1,e.feedback={content:"",phoneNumber:""},e.imageCount=0;for(var t=0;t<3;t++)e.imageList[t]="",d[t]=""}function c(t){e.$apply(function(){for(var o=0;o<3;o++)if(!e.imageList[o]){e.imageList[o]=t;break}e.imageCount++});var o=function(e){for(var t=JSON.parse(e.response),o=0;o<3;o++)if(!d[o]){d[o]=t.urls;break}},i=function(e){},s=new FileUploadOptions,r=new Date,c=r.getTime();s.fileKey="imageFile",s.fileName=a.getUser.userName+c,s.mimeType="image/jpeg",(new FileTransfer).upload(t,encodeURI(n.uploadImage()),o,i,s)}function l(e){}e.feedback={content:"",phoneNumber:""},e.feedbackType=6,e.imageCount=0,e.imageList=["","",""];var d=["","",""];e.canCommit=!1,e.checkLength=function(){setTimeout(function(){e.$apply(function(){e.feedback.content.length>=500&&(e.feedback.content=e.feedback.content.substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)},e.changeType=function(t){e.feedbackType=t},e.addImage=function(){window.cordova&&s.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),d.splice(t,1),e.imageCount--},e.phoneCheck=function(){},e.submitFeedback=function(){if(e.feedback.phoneNumber&&!e.globalConstant.mobileNumberRegExp.test(e.feedback.phoneNumber))return void i.showToast("请输入正确的手机号码！");var s={site:"mstore",type:e.feedbackType,content:e.feedback.content,contact:e.feedback.phoneNumber,file:d[0]?d[0]:"",file1:d[1]?d[1]:"",file2:d[2]?d[2]:""};o.commitFeedback(s).success(function(e){e.success&&(i.showToast("提交成功！"),setTimeout(function(){t.go("Setup")},2017))})},e.$watch("feedback.content",function(t,o){setTimeout(function(){e.$apply(function(){t.length>=500&&(e.feedback.content=t.toString().substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)}),e.$on("$ionicView.beforeEnter",function(){r()})}]),APP.service("FeedbackPlusService",["$http","UrlService",function(e,t){this.commitFeedback=function(o){return e({method:"POST",url:t.getUrl("FEEDBACK_PLUS"),params:o})}}]),APP.controller("MineController",["$scope","$timeout","UserService","ShopService","PlatformService","MESSAGECENTERService","CreditService","$state",function(e,t,o,i,s,n,a,r){e.tabNav="mine",e.account="",e.flagNum=!1,e.goMemberCenter=function(){a.getGameId(function(e){r.go("vip",{gameId:e})})},e.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},e.init=function(){i.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1});for(var t=[],s=0;s<o.getUser().userName.length;s++)t[s]=s>=3&&s<=6?"*":o.getUser().userName[s];e.account="";for(var n=0;n<t.length;n++)e.account=e.account+t[n];e.account.length>20&&(e.account=e.account.slice(0,20)+"..."),e.accreditation="海尔官方认证"},e.$on("$ionicView.beforeEnter",function(){e.init(),n.unreadMessage()})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){}]),APP.controller("PersonalCenterController",["trueAuthenticationService","$localstorage","$rootScope","RegisterService","HomePageService","OrderManageService","$http","UrlService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","PersonalCenterService","$state","WhiteShowsService","PopupService","ProductDetailService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){u.storeId=g.getUser().mid,u.flagNum=!1,u.user=g.getUser(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?u.isIosApp=!0:u.isIosApp=!1,u.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],u.gotoSecondPage=function(e,t){f.go("orderManage",{orderFlag:e,orderType:t})},u.goOrderManage=function(e,t){f.go("orderManage",{orderFlag:e,orderStatus:t})},u.goMemberCenter=function(){l.getGameId(function(e){f.go("vip",{gameId:e})})},u.goToMyStore=function(){1==u.isHost&&f.go("myStore",{storeId:u.storeId})},u.goLearningHaier=function(){m.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else f.go("login")})},u.goToManageMoney=function(e){1==e?f.go("financialMoney",{whereId:"personnalCenter"}):0==e?i.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):v.showToast("服务端错误")}).error(function(){alert("网络错误")}):f.go("login")},u.toApplyForWhite=function(){h.queryIousStatus({userId:g.getUser().ucId,token:g.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?f.go("applyForWhite"):h.applyForOpen({backUrl:window.location.href,userId:g.getUser().ucId,token:g.getUser().accessToken}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}))})},u.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),o=null;o=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&p(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else u.kfTocken=t.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+u.kfTocken);return},u.goNewHand=function(){var e=r.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},u.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},t=function(e){function t(e){
u.avatarImage=e,p(function(){u.avatarImage=e},200);var t=function(e){$ionicLoading.hide(),v.showToast("上传成功");var t=JSON.parse(e.response);u.avatarImage=t.data.avatarImageFileId,u.user.avatarImageFileId=u.avatarImage,g.setUser(u.user)},o=function(e){$ionicLoading.hide(),v.showToast("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=u.avatarImage.substr(u.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var s={};i.params=s,(new FileTransfer).upload(u.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,i);var n={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(n)}function o(e){}function i(e){u.avatarImage=e,p(function(){u.avatarImage=e},200);var t=function(e){v.showToast("上传成功"),$ionicLoading.hide();var t=JSON.parse(e.response);u.avatarImage=t.data.avatarImageFileId,u.user.avatarImageFileId=u.avatarImage,g.setUser(u.user)},o=function(e){v.showToast("上传失败"),$ionicLoading.hide()},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=u.avatarImage.substr(u.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var s={};i.params=s,(new FileTransfer).upload(u.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,i);var n={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(n)}function s(e){}1==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,t),p(function(){window.plugins.actionsheet.hide()},5e3)}else $ionicPopup.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},u.checkPhoneNumber=function(){i.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):v.showToast("服务端错误")}).error(function(){alert("网络错误")})},u.init=function(){e.doInit().success(function(e){e.success&&(e.data.isAuthByOne?u.changeOpacity={opacity:"1"}:u.changeOpacity={opacity:"0.5"})}),S.getCartNum().success(function(e){e.success&&(o.BottomCartNum=e.data)}),s.isWdHost().success(function(e){o.isWdHost=e.data.isHost,null==e.data.o2o||1==e.data.o2o?u.iso2o=!0:u.iso2o=!1}),s.getUnReadMsg().success(function(e){e.data>0?u.flagNum=!0:u.flagNum=!1}),m.personalInit().success(function(e){u.isHost=e.data.isHost,u.storeName=e.data.storeName,u.card=e.data.card,u.level=e.data.level,u.nowLevelName=u.levelArr[u.level-1],11!=u.level&&(u.nextLevelName=u.levelArr[u.level]),u.revenue=e.data.revenue,u.coupon=e.data.coupon,u.gold=e.data.gold,u.card=e.data.card}),n.getOrderAmount().success(function(e){e.success&&(u.orderAmountData=e.data)}),l.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),o={gameId:e,withLevelPath:!0};a.get(t,o).success(function(e){if(e.success){u.order=e.data.userCreditWithLevel.order,u.levelGrowArr=e.data.levels;u.levelGrowArr[e.data.userCreditWithLevel.order]&&(u.levelUpExp=u.levelGrowArr[e.data.userCreditWithLevel.order].creditNum-e.data.userCreditWithLevel.totalCreditNum,u.levelUpExp<0&&(u.levelUpExp=0)),u.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,u.creditNum=e.data.userCreditWithLevel.totalCreditNum}})}),m.personalApply().success(function(e){e.success&&(e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2),u.applyName=e.data.name,u.applyStatus=e.data.status)}),d.getMessage().success(function(e){e.success&&(m.userMemberId=e.data.memberId)})},u.$on("$ionicView.beforeEnter",function(){u.avatarImage=g.getUser().avatarImageFileId,u.storeId=g.getUser().mid,u.user=g.getUser(),u.tabNav="personnalCenter",u.init()})}]),APP.service("PersonalCenterService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.personalApply=function(o){var i=t.getUrl("GET_APPLY_MENGZHU");return e.get(i,o)},this.userMemberId="",this.learningHaier=function(){return e.get(t.getNewUrl("GET_learningHaier"))}}]),APP.controller("SetupController",["$ionicPopup","AccountMessageService","$rootScope","$scope","PlatformService","LoginService","UserService","$state","$localstorage","IMService",function(e,t,o,i,s,n,a,r,c,l){i.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==s.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==s.getPlatform()?cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==s.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},i.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},i.switchOff={background:"#fff","border-color":"#e6e6e6"},i.borderBottom={"margin-bottom":"3px"},i.switchState=function(e){i.settingsList[e].checked=!i.settingsList[e].checked;for(var t=JSON.parse(localStorage.getItem("setSwitch")),s=t.length-1;s>=0;s--)i.memberId==t[s].id&&(t[s].list[e].checked=i.settingsList[e].checked,localStorage.setItem("setSwitch",JSON.stringify(t)));switch(e){case 0:o.isCommission=i.settingsList[e].checked;break;case 1:o.cashSwitch=i.settingsList[e].checked;break;case 2:o.goldRainSwitch=i.settingsList[e].checked}},i.init=function(){i.memberId=a.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==i.memberId&&(i.settingsList=e[t].list,!0)},i.goGuidePage=function(){r.go("guidePage")},i.user=a.getUser(),i.accountToken=i.user.token,i.accountSessionId=i.user.sessionValue,i.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",i.unload=function(){l.destroyWebSocket(),void 0==i.user.sessionValue?(a.clearUser(),i.goGuidePage(),n.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),c.set("storeId","")):t.unloadAccount(i.accountToken,i.accountSessionId,i.accountHeaderKey).success(function(e,t,o,s){e.success&&(a.clearUser(),i.goGuidePage(),n.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),c.set("storeId",""))})},i.goToDelete=function(){e.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&i.unload()})},i.$on("$ionicView.enter",function(){i.init()})}]),APP.controller("ShoppingCarController",["$scope",function(e){}]),APP.controller("accsafeCtrl",["$scope","accsafeService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.accountMessage="",e.accountEmail="",e.accountNumber="",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=a.getUser(),e.accountMessage=e.user.userName,e.accountEmail=e.user.email,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,a.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){i.go("guidePage")},o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,a.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){i.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("accsafeService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("accsettingCtrl",["AccountMessageService","$scope","accsettingService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(e){var o=e[0];if(window.FileReader){var i=new FileReader;i.readAsDataURL(o),i.onloadend=function(e){t.$apply(t.iconImage=e.target.result)}}}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.isPhone=!!window.cordova,t.userInfo={picTempFile:""},t.user={},t.sexMap=["保密","男","女"],t.accountMessage="",t.accountName="",t.accountSexValue="0",t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday="",t.iconImage=i.imgBaseURL+"img/ic_login_user.png",t.accountToken="",t.accountSessionId="",t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.updateResult=!0,t.updateContent="",t.init=function(){t.user=r.getUser(),t.sexMap=["保密","男","女"],void 0!=t.user.avatarImageFileId&&(t.iconImage=t.user.avatarImageFileId),t.accountMessage=t.user.userName,t.accountName=t.user.nickName,t.accountSexValue=t.user.gender,t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday=t.user.birthday,t.accountToken=t.user.token,t.accountSessionId=t.user.sessionValue,t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(t.accountNumber)||(t.showMobile=!1)},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goGuidePage=function(){s.go("guidePage")},t.changeIcon=function(){if("APP"==l.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(o){function i(o){t.iconImage=o,a(function(){t.iconImage=o},200);var i=function(e){c.hide(),t.showResult("上传成功");var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,r.setUser(t.user)},s=function(e){c.hide(),t.showResult("上传失败")},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var l={};n.params=l,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),i,s,n);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};c.show(d)}function s(e){}function n(o){t.iconImage=o,a(function(){t.iconImage=o},200);var i=function(e){t.showResult("上传成功"),c.hide();var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,r.setUser(t.user)},s=function(e){t.showResult("上传失败"),c.hide()},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var l={};n.params=l,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),i,s,n);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};c.show(d)}function l(e){}1==o?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(n,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,i),a(function(){window.plugins.actionsheet.hide()},5e3)}else{u.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},t.$watch("userInfo.picTempFile",function(){t.userInfo&&t.userInfo.picTempFile&&t.userInfo.picTempFile.length>0&&m(t.userInfo.picTempFile)},!1),t.unload=function(){void 0==t.user.sessionValue?(r.clearUser(),t.goGuidePage(),p.setRole(void 0),window.localStorage.setItem("isLogin",r.isUserLogin()),g.set("storeId","")):e.unloadAccount(t.accountToken,t.accountSessionId,t.accountHeaderKey).success(function(e,o,i,s){e.success&&(r.clearUser(),t.goGuidePage(),p.setRole(void 0),window.localStorage.setItem("isLogin",r.isUserLogin()),g.set("storeId",""))})},t.goToDelete=function(){u.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&t.unload()})},t.selectDate=function(){if("APP"==l.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){a(function(){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),e.changeMessage(t.accountMessage,n+"-"+s+"-"+i,t.accountSexValue,t.accountName).success(function(e,o,a,c){e.success?(t.accountBirthday=n+"-"+s+"-"+i,t.user.birthday=n+"-"+s+"-"+i,r.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s);var n=new Date(o).getFullYear()+"-"+i+"-"+s;e.changeMessage(t.accountMessage,n,t.accountSexValue,t.accountName).success(function(e,o,i,s){e.success?(t.accountBirthday=n,t.user.birthday=n,r.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})}};d.openDatePicker(i)}},i.$on("SELECT_SEX",function(e,o){t.accountSexValue=o,t.accountSex=t.sexMap[t.accountSexValue],t.user.gender=o,r.setUser(t.user),t.showResult("修改成功")}),i.$on("CHANGE_NAME",function(e,o){t.accountName=o,t.user.nickName=o,r.setUser(t.user),t.showResult("修改成功")}),t.goBack=function(){s.go("personnalCenter")},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,a(function(){t.updateResult=!0},1e3)}}]),APP.service("accsettingService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,i,s){var n=o,a="Bearer "+s+" "+n,r={Authorization:a},c={sessionId:i};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("CompetitionController",["$scope","$ionicHistory","MemberCompleteService","PopupService","CreditService","UrlService","$state","$stateParams","$http","InAppBrowserService","$ionicSlideBoxDelegate","$location","$rootScope",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(e,t,o,i){for(;;){var s,n=!1;s=i?(e+(t-e-e)*Math.random()).toFixed(2):Math.ceil(e+(t-e-e)*Math.random());for(var a=0;a<o.length;a++)if(s===o[a]){n=!0;break}if(n||o.push(s),o.length===S)break}}function m(e,t){for(var o,i,s=e.slice(0),n=e.length,a=n-t;n-- >a;)i=Math.floor((n+1)*Math.random()),o=s[i],s[i]=s[n],s[n]=o;return s.slice(a)}var f=r.taskDestId;e.taskType=r.taskType,e.xyzMemberId=r.memberId;var h=["赵","钱","孙","李","周","吴","郑","王","冯","陈","褚","卫","蒋","沈","韩","杨","朱","秦","尤","许","何","吕","施","张","孔","曹","严","华","金","魏","陶","姜","戚","谢","邹","喻","柏","水","窦","章","苏","潘","葛","奚","范","彭","郎","鲁","韦","昌","马","苗","凤","花","方","俞","任","袁","柳","酆","鲍","史","唐","费","廉","岑","薛","雷","贺","倪","汤","滕","殷","罗","毕","郝","邬","安","常","乐","于","时","傅","皮","卞","齐","康","伍","余","元","卜","顾","孟","平","黄","和","穆","萧","尹","姚","邵","湛","汪","祁","毛","禹","狄","米","贝","明","臧","计","伏","成","戴","谈","宋","茅","庞","熊","纪","舒","屈","项","祝","董","梁","杜","阮","蓝","闵","席","季","麻","强","贾","路","娄","危","江","童","颜","郭","梅","盛","林","刁","钟","徐","邱","骆","高","夏","蔡","田","樊","胡","凌","霍","虞","万","支","柯","昝","管","卢","莫","经","房","裘","缪","干","解","应","宗","丁","宣","贲","邓","郁","单","杭","洪","包","诸","左","石","崔","吉","钮","龚","程","嵇","邢","滑","裴","陆","荣","翁","荀","羊","於","惠","甄","麴","家","封","芮","羿","储","靳","汲","邴","糜","松","井","段","富","巫","乌","焦","巴","弓","牧","隗","山","谷","车","侯","宓","蓬","全","郗","班","仰","秋","仲","伊","宫","宁","仇","栾","暴","甘","钭","厉","戎","祖","武","符","刘","景","詹","束","龙","叶","幸","司","韶","郜","黎","蓟","薄","印","宿","白","怀","蒲","邰","从","鄂","索","咸","籍","赖","卓","蔺","屠","蒙","池","乔","阴","郁","胥","能","苍","双","闻","莘","党","翟","谭","贡","劳","逄","姬","申","扶","堵","冉","宰","郦","雍","舄","璩","桑","桂","濮","牛","寿","通","边","扈","燕","冀","郏","浦","尚","农","温","别","庄","晏","柴","瞿","阎","充","慕","连","茹","习","宦","艾","鱼","容","向","古","易","慎","戈","廖","庾","终","暨","居","衡","步","都","耿","满","弘","匡","国","文","寇","广","禄","阙","东","殴","殳","沃","利","蔚","越","夔","隆","师","巩","厍","聂","晁","勾","敖","融","冷","訾","辛","阚","那","简","饶","空","曾","毋","沙","乜","养","鞠","须","丰","巢","关","蒯","相","查","後","荆","红","游","竺","权","逯","盖","益","桓","公","万",,"俟","司马","上官","欧阳","夏侯","诸葛","闻人","东方","赫连","皇甫","尉迟","公羊","澹台","公冶","宗政","濮阳","淳于","单于","太叔","申屠","公孙","仲孙","轩辕","令狐","钟离","宇文","长孙","慕容","鲜于","闾丘","司徒","司空","亓官","司寇","仉","督","子车","颛孙","端木","巫马","公西","漆雕","乐正","壤驷","公良","拓跋","夹谷","宰父","谷梁","晋","楚","闫","法","汝","鄢","涂","钦","段干","百里","东郭","南门","呼延","归","海","羊舌","微生","岳","帅","缑","亢","况","后","有","琴","梁丘","左丘","东门","西门","商","牟","佘","佴","伯","赏","南宫","墨","哈","谯","笪","年","爱","阳","佟","第五","言","福"],v=["奕柯","消沉","天乐","维妙","峻","哲","晓培","益申","莹莹","占宇","雨","凌昕","婉婷","建雄","小文","小冉","子安","老杰","胖胖","文","剑","霖","锰","克谦","小仙","帅帅","逸","旭梅","萍","元雪","晓莉","明燕","九庆","留强","汝彬","台铭","帆","昆仑","万里","中锋","志伟","明汉","琴","珍美","明君","涛","文武","艳艳","小刚","霞","浩","志豪","军林","叶东","远青","伟军","明浩","佑军","盛露","少青","发祥","钟森","永发","运瑞","自珍","家宝","建联","迪","慧","盛锦","素素","生平","海峰","喧喧","文宏","景翔","子博","炳良","保胜","希玮","莱","宇佳","博飞","文诺","宸萧","萍","利","墨语","宇凡","方丰","景宝","乐新","康帅","睿继","温雁","呈远","运","恩","叶","涵琰","文文","杰宪","迪勋","颜悦","杭","彬","信","帅鸿","庭达","然","睿进","锦远","康飞","茂轩"];e.indexNum=0;var S=10;e.moneyRandoms=[],g(50,3e3,e.moneyRandoms,!0);e.timeRandoms=[],g(1,60,e.timeRandoms,!1);e.userImg=[],g(0,198,e.userImg,!1),e.userList=[],e.firstName=m(h,S),e.lastName=m(v,S),e.allName=[],function(t,o){for(var i=0;i<S;i++)e.allName.push(t[i]+""+o[i]);e.allName}(e.firstName,e.lastName);for(var I=0;I<S;I++)e.userList.push({src:p.imgBaseURL+"img/userImg/"+e.userImg[I]+".jpg",money:e.moneyRandoms[I],allName:e.allName[I],time:e.timeRandoms[I]});e.goBack=function(){t.goBack()},e.share=function(){window.cordova?e.showShare=!0:i.showAlert("只能在app分享","抱歉，只能在app分享")},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?l.open(n.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):a.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"22px",height:"66px"}:e.paddingtopClass={"padding-top":"6px",height:"50px"},e.copeText=function(t){window.cordova?(cordova.plugins.clipboard.copy(t),i.showToastShort("复制成功"),e.isShowCopyButton=!1):i.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var i=e.competition.storeName+"的综合竞争力指数",a="综合竞争力指数全球排名"+e.competition.userRank+"位颤抖吧人类",r=e.competition.avatarImageFileId,c=n.getShareLinkHeader()+"competition//"+e.taskType+"/"+e.xyzMemberId;window.umeng?0==t?window.umeng.shareToSina(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"微博").success(function(){}),s.shareSuccessCallback("微博")}):1==t?window.umeng.shareToWechatSession(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"微信").success(function(){}),s.shareSuccessCallback("微信")}):2==t?window.umeng.shareToWechatTimeline(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("朋友圈")}):3==t?window.umeng.shareToQQ(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("QQ")}):4==t?window.umeng.shareToQzone(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("QQ空间")}):5==t&&e.copeText(c):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){f=r.taskDestId,e.taskType=r.taskType,e.competition="",e.showShare=!1,e.xyzMemberId=r.memberId,e.gameId=r.gameId,e.storeId="";var t=(new Date).getTime();o.myComplete(e.xyzMemberId).success(function(o){e.competition=o.data,void 0==e.competition.myInCome&&(t=(new Date).getTime(),$.ajax({url:n.getUrl("BROKERAGE_SETTLEMENT"),data:{memberId:e.xyzMemberId},type:"post",dataType:"json",success:function(t){t.success&&t.data&&(e.competition.myInCome=t.data.totalBrokerageAmount,e.$apply())},error:function(){}})),e.storeId=o.data.memberId,e.userCurrentLevelId=o.data.order;for(var i=[[248,46,91],[172,123,171],[88,234,231],[217,226,109],[253,181,70],[248,115,60]],s=[["店铺单数",e.competition.ordersCount/1],["招募结识了",e.competition.partner/2],["进行评价",e.competition.accessCount/1],["分享",e.competition.sharesCount/50],["登录",e.competition.loginsCount/50],["社区互动",e.competition.comunityCount/30]],a=1,r=0;r<s.length;r++)s[r][1]>a&&(a=s[r][1]);var c=s.length,l=document.getElementById("radarMap"),d=document.getElementById("radarMapCanvas");null==d&&(d=document.createElement("canvas"),d.id="radarMapCanvas",l.appendChild(d));var u=.49*$(document).width(),p=402*u/370;d.style="position:relative;position: absolute;z-index: -1",d.width=u,d.height=p;var g=d.getContext("2d"),m=u,f=p,h=m/2,v=f/2,S=h-3,I=2*Math.PI/c;!function(e){e.save();for(var t=S/3,o=0;o<3;o++){e.beginPath();for(var s=t*(o+1),n=[],a=0;a<c;a++){var r=h+s*Math.cos(I*a-I/2),l=v+s*Math.sin(I*a-I/2);n.push([r,l])}for(var a=0;a<n.length;a++){e.beginPath(),e.moveTo(n[a][0],n[a][1]),e.lineTo(n[(a+1)%n.length][0],n[(a+1)%n.length][1]),e.closePath();var d=e.createLinearGradient(n[a][0],n[a][1],n[(a+1)%n.length][0],n[(a+1)%n.length][1]);d.addColorStop("0.2","rgba("+i[a].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+i[(a+1)%n.length].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.beginPath(),e.moveTo(n[n.length-1][0],n[n.length-1][1]),e.lineTo(n[0][0],n[0][1]),e.closePath();var d=e.createLinearGradient(n[n.length-1][0],n[n.length-1][1],n[0][0],n[0][1]);d.addColorStop("0.2","rgba("+i[n.length-1].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+i[0].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2),s=v+S*Math.sin(I*t-I/2);e.beginPath(),e.moveTo(h,v),e.lineTo(o,s);var n=e.createLinearGradient(o,s,h,v);n.addColorStop("0","rgba("+i[t].join(",")+",1)"),n.addColorStop("0.8","rgba("+i[t].join(",")+",0.2)"),e.strokeStyle=n,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save(),e.beginPath();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2)*s[t][1]*(100/a)/100,i=v+S*Math.sin(I*t-I/2)*s[t][1]*(100/a)/100;e.lineTo(o,i)}e.closePath(),e.lineWidth=.5,e.strokeStyle="rgba(167,241,224,1)",e.stroke(),e.fillStyle="rgba(255, 0, 0, 0.2)",e.fill(),e.restore()}(g)}).error(function(e){}),o.storeDetail(e.gameId).success(function(t){1==t.success&&(e.storeCreditWithLevel=t.data.storeCreditWithLevel,e.storeCreditWithLevel&&(e.storeCurrentLevelId=t.data.storeCreditWithLevel.order,e.starName=t.data.storeCreditWithLevel.name,e.levelArray=[],e.storeCurrentLevelId<=3?e.levelArray=[p.imgBaseURL+"img/StarLevel@2x.png"]:e.levelArray=[p.imgBaseURL+"img/Diamond@2x.png"]))}),d.update(),d.loop(!0),d.enableSlide(!1)}),e.foots=[{src:p.imgBaseURL+"img/touxiang@2x.png",name:"aaa",money:"1",time:10},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"bbb",money:"2",time:20},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"ccc",money:"3",time:30},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"ddd",money:"4",time:40},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"eee",money:"5",time:50}]}]),APP.service("MemberCompleteService",["$http","UrlService",function(e,t){this.myComplete=function(o){var i={ownerId:o};return e.get(t.getUrl("MEMER_COMPETE"),i)},this.missionShare=function(o,i,s){var n={taskType:o,taskDestId:i,sharePlatform:s};return e.get(t.getUrl("MISSION_SHARE"),n)},this.storeDetail=function(o){var i=t.getUrl("SHUNGUANG_VIP");return e.get(i,o)}}]),APP.controller("CustomMadeController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,i,s,n,a){e.customMadeUrl=o.trustAsResourceUrl(t.customMadeUrl),e.close=function(){a.go("shop")}}]),APP.controller("goldRecordController",["$rootScope","$localstorage","$scope","$stateParams","$state","$ionicPopup","$timeout","$http","UrlService",function(e,t,o,i,s,n,a,r,c){function l(e){r.get(c.getUrl("CREDIT_DETAIL"),e).success(function(t){u=1,0==e.searchType?(o.name1=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore1=!1):o.hasmore1=!0):1==e.searchType?(o.name2=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore2=!1:o.hasmore2=!0):2==e.searchType&&(o.name3=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore3=!1:o.hasmore3=!0)}).error(function(e){})}o.hasmore1=!1,o.hasmore2=!1,o.hasmore3=!1,o.name1="",o.name2="",o.name3="",o.flag=!1,o.a=!1,o.b=!0;var d=0,u=1,p=1,g=1,m=1,f="",h={searchType:d,startIndex:u,pageSize:9};o.storeId=t.get("storeId",e.globalConstant.storeId),l(h),o.loadMore1=function(){var e=o.name1;p+=1;var t={searchType:d,startIndex:p,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){0==t.searchType&&(o.name1=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore1=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){o.$broadcast("scroll.infiniteScrollComplete")})},o.loadMore2=function(){var e=o.name2;g+=1;var t={searchType:d,startIndex:g,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){1==t.searchType&&(o.name2=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore2=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.loadMore3=function(){var e=o.name3;m+=1;var t={searchType:d,startIndex:m,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){2==t.searchType&&(o.name3=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore3=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.goBack=function(){o.$ionicGoBack()},o.show=function(){o.flag=!o.flag},o.showfalse=function(){o.flag=!1},o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={},o.$on("$ionicView.beforeEnter",function(){o.flag=!1}),o.showFlag1=function(){d=0,p=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={}},o.showFlag2=function(){d=1,g=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag2=!0,o.flag1=!1,o.flag3=!1,o.myObj2={background:"#2196F3",color:"#fff"},o.myObj1={},o.myObj3={}},o.showFlag3=function(){d=2,m=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag3=!0,o.flag1=!1,o.flag2=!1,o.myObj3={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj1={}}}]),APP.controller("myAppointmentController",["$ionicScrollDelegate","$interval","myAppointmentService","CalculateStrLength","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","HomePageService",function(e,t,o,i,t,s,n,a,r,c,l,d,u,p){function g(e,o){var i=o,s=t(function(){if(i)var o=n.data[e].purchaseEndTime-(new Date).getTime();else var o=n.data[e].purchaseStartTime-(new Date).getTime();if(o<0)if(i){n.data[e].hasOver=!0;for(var a=0,r=0;a<n.data.length&&n.data[a].hasOver;a++)r++;r==n.data.length&&(n.noData=!0),t.cancel(s)}else i=!0,n.data[e].hasBegan=!0,n.data[e].days=0,n.data[e].hours=0,n.data[e].minutes=0,n.data[e].seconds=0;else n.data[e].days=parseInt(o/864e5),n.data[e].hours=parseInt(o%864e5/36e5),n.data[e].minutes=parseInt(o%36e5/6e4),n.data[e].seconds=Math.floor(o%6e4/1e3)},1e3);n.intervalArr.push(s)}function m(e){for(var t=(new Date).getTime(),o=e.length,i=0;i<o;i++)e[i].hasOver=!1,e[i].purchaseStartTime>t?(e[i].hasBegan=!1,g(i,!1)):e[i].purchaseStartTime<(new Date).getTime()&&t<e[i].purchaseEndTime&&(e[i].hasBegan=!0,g(i,!0))}n.pageIndex=1,n.hasMore=!1,n.data=[],n.storeId=c.getUser().mid,n.flagNum=!1,n.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",n.goProductDetail=function(e){r.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:n.storeId})},n.init=function(){n.noData=!1,n.data=[],o.getMyAppointment(n.pageIndex).success(function(e){5==e.data.length?(n.hasMore=!0,n.data=n.data.concat(e.data),m(n.data)):e.data.length<5&&0!=e.data.length?(n.hasMore=!1,n.data=n.data.concat(e.data),m(n.data)):e.data&&0!=e.data.length||(n.noData=!0)}),p.getUnReadMsg().success(function(e){e.data>0?n.flagNum=!0:n.flagNum=!1})},n.loadMore=function(){n.pageIndex++,o.getMyAppointment(n.pageIndex).success(function(e){5==e.data.length?(n.hasMore=!0,m(e.data),n.data=n.data.concat(e.data)):e.data.length<5&&0!=e.data.length?(n.hasMore=!1,m(e.data),n.data=n.data.concat(e.data)):n.hasMore=!1})},n.$on("$ionicView.beforeLeave",function(e,o){for(var i=0,s=n.intervalArr.length;i<s;i++)t.cancel(n.intervalArr[i])}),n.$on("$ionicView.beforeEnter",function(t,o){e.scrollTop(),n.pageIndex=1,n.intervalArr=[],n.init()})}]),APP.service("myAppointmentService",["$http","UrlService",function(e,t){this.getMyAppointment=function(o){var i={pageIndex:o};return e.get(t.getNewUrl("MYAPPOINTMENT"),i)}}]),APP.controller("VipController",["CommonAddressService","ProductDetailService","$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","$http","CreditService","InAppBrowserService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){function I(e){var t=new Date(e),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+i+"月"+s+"日"}function w(){d.getapplyDuozhu().success(function(e){if(e.success){o.memberId=e.data.memberId,o.teamLevelId=e.data.teamLevelId,o.applyName=e.data.name,o.teamName=e.data.name,o.applyTeamName=e.data.name,o.applyStatus=e.data.status,e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2);var t={"舵主":"duozhu@2x.png","盟主":"mengzhu@2x.png"},s=t[o.teamName],n={"-3":{text:"未通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("未通过","您本月不能申请！")}},"-2":{text:"申请",icon:i.imgBaseURL+"img/apply"+s,handler:function(){function e(e){var t=/[\ud800-\udbff][\udc00-\udfff]/g;return e=e.replace(t,"")}var t=o.applyDialog();o.fnClosePopup=function(){t.close()},o.mailIsError=!1,o.reasonIsError=!1,o.checkEmail=function(e){var t=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,i=t.test(e);o.mailIsError=!i},o.checkReason=function(t){t=e(t),o.reasonIsError=!t,o.reasonIsError&&(o.data.input2="")},o.fnExchangeGoods=function(){if(o.checkEmail(o.data.input1),!o.mailIsError){if(o.checkReason(o.data.input2),o.reasonIsError)return void(o.data.input2="");d.applyDuozhu({email:o.data.input1,applyReason:o.data.input2,teamLevelId:o.teamLevelId}).success(function(e,o,i,s){1==e.success?e.data&&u.showAlert("盟主舵主权益","申请成功"):u.showAlert("盟主舵主权益",e.message),t.close(),w()})}},o.lookLeaderRights=function(){u.showAlert("盟主舵主权益",o.LeaderRights)}}},"-1":{text:"未通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("未通过","您本月的申请被拒绝，下月继续努力！")}},0:{text:"已申请",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("已申请","您本月的申请已经提交，请等待工作人员审批！")}},1:{text:"已通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("已通过","您已经是"+e.data.name+"了！")}},2:{text:"不可申请",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("盟主舵主权益",o.LeaderRights)}},3:{text:"盟主",icon:i.imgBaseURL+"img/meng@2x.png",handler:function(){u.showAlert("已通过","您已经是"+e.data.name+"了！")}}};o.applyText=n[""+e.data.status].text,
o.applyIcon=n[""+e.data.status].icon,o.handler=n[""+e.data.status].handler}})}o.isShowMore=!1,o.isShowRule=!1,o.closeAll=function(){o.isShowMore=!1,o.isShowRule=!1},o.showMore=function(){o.isShowMore=!o.isShowMore},o.showRule=function(){o.isShowRule=!o.isShowRule},o.closeRule=function(){o.isShowRule=!1},o.applyDialog=function(){return l.show({cssclass:"leader-popup",template:"\n        <div class='apply-list popup-form'>\n          <div class = 'form-title' ng-show='teamName==\"盟主\"'>恭喜您获得申请盟主的资格！</div>\n          <div class = 'form-title' ng-show='teamName==\"舵主\"'>恭喜您获得申请舵主的资格！</div>\n          <div class='form-content'>\n           <div class='sub-title'>请填写申请理由，我们会尽快跟你联系</div>\n           <p class='input-name'>联系邮箱<span class='error' ng-show='mailIsError'>请填写正确邮箱</span></p>\n           <div class='input-area'><input type='text' placeholder='填写你的邮箱(必填)' ng-model='data.input1' ng-blur='checkEmail(data.input1)'></div>\n          </div>\n          <div class='form-content'>\n          <p class='input-name'>申请理由<span class='error' ng-show='reasonIsError'>请填写申请理由</span></p>\n           <div class='input-area'><textarea rows='3' ng-blur=\"checkReason(data.input2)\" cols='20' placeholder='填写你的申请理由(必填，不支持特殊字符、表情)' ng-model='data.input2'></textarea></div>\n          </div>\n          <div class='form-info'>\n            <span  ng-click='lookLeaderRights()'>点击查看更多舵主盟主权益</span>\n          </div>\n          <div class='form-button'>\n           <span class='left-btn' ng-click='fnClosePopup()' >再想想</span>\n           <span class='right-btn' ng-click='fnExchangeGoods()' >提交申请</span>\n          </div>\n        </div>\n      ",scope:o})},o.levelUp=function(e){l.alert({template:'<div style="font-size: 17px;color: #030303;letter-spacing: -0.41px;line-height: 26px;">'+e+"</div>",okText:"我知道啦"})},o.modal=void 0,o.gameId=s.gameId,o.levelMsg=s.msg,o.gameTitle,o.gameDesc,o.isShowForm=!1,o.startTime="",o.endTime="",o.hasBkgColor=!0;var y="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";o.isAdmin=s.isAdmin,o.shareStoreId;var T=.2*window.innerWidth;o.gridHeight={height:T+"px"},o.gridHeightMiddle={height:2*T+8+"px"};var C=window.innerHeight,b=C-373+"px";o.contentHeight={height:b},o.addressTitle="配送至",o.dataAdd=null,o.flag="CHANGEADDRESS_LOCATION_GAME",o.defaultValue=null,o.level=0;var A={};o.addressInfo={},o.game={},o.prizeList=[],o.startP=0,o.endP=11,o.curP=void 0,o.timer=void 0,o.isRuning=!1;var P=330;o.showShare=!1,o.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.topBtnCss4IOS={top:"12px"}),o.$on("$ionicView.beforeEnter",function(){o.isShowMore=!1,o.isShowRule=!1,o.xyzMemberId=m.getUser().mid,o.shareStoreId=s.shareStoreId,o.isAdmin=s.isAdmin,o.memberId=m.getUser().mid,S.$getByHandle("gradeScroll").scrollBy(0,0),o.dataAdd=null,o.defaultValue=null,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.watch=o.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),o.$on("$destroy",function(){o.addressModal.remove()}),o.init()}),o.init=function(){w(),o.prizeList=new Array(12),o.applyName="盟主",h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),s={gameId:e,withLevelPath:!0};-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},f.get(t,s).success(function(e){if(o.levelMsg&&o.levelUp(o.levelMsg),e.success){o.name=e.data.userCreditWithLevel.name,o.avatarImageFileId=m.getUser().avatarImageFileId?m.getUser().avatarImageFileId:e.data.avatarImageFileId,o.userCurrentLevelId=e.data.userCreditWithLevel.order,o.order=e.data.userCreditWithLevel.order,o.levelGrowArr=e.data.levels,o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,o.creditNum=e.data.userCreditWithLevel.totalCreditNum,o.userRank=e.data.userCreditWithLevel.userRank,o.congratulationMsg="有"+o.userRank+"个小伙伴超过了你",0==o.userRank&&(o.congratulationMsg="恭喜你，你已经是天下第一了，继续保持哦！"),o.storeCreditWithLevel=e.data.storeCreditWithLevel,o.storeCreditWithLevel&&(o.storeCurrentLevelId=e.data.storeCreditWithLevel.order,o.storeName=e.data.storeCreditWithLevel.name,o.levelArray=[],o.storeCurrentLevelId<=3?o.levelArray=[i.imgBaseURL+"img/StarLevel@2x.png"]:o.levelArray=[i.imgBaseURL+"img/Diamond@2x.png"]),$("canvas:not('#radarMapCanvas')").remove(),$(".cur"+o.order).radialIndicator({barColor:"#8FB8FF",barWidth:2,initValue:0,roundCorner:!0,percentage:!1,displayNumber:!1});$(".cur"+o.order).data("radialIndicator").animate(100),o.scrollMainToTop()}})}),d.storeDetailInfo({memberId:o.memberId}).success(function(e){1==e.success&&(o.storeVipName=e.data.storeName,o.teamLevelName=e.data.teamLevelName,o.storeId=e.data.memberId)}),o.showQQ=!1,o.showWeChat=!1,window.umeng&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.startP=0,o.curP=void 0,d.gameInfo({gameId:o.gameId}).success(function(e){e.success?(o.prizeList=e.data.gameImg,o.partNum=e.data.partNum,o.game=e.data.game,o.chouCount=e.data.playTimes,o.startTime=I(1e3*o.game.beginTime),o.endTime=I(1e3*o.game.endTime),g.fromTemplateUrl("templates/common/CommonGame.html",{scope:o,animation:"slide-in-left"}).then(function(e){o.modal=e}),o.game.backgroundPic||(o.hasBkgColor=!1)):alert(e.message)}).error(function(){u.showMsg("网络错误")}),d.notapplyDuozhu().success(function(e){1==e.success&&(o.LeaderRights=e.data.description)})},o.scrollMainToTop=function(){o.order<8||8==o.order?S.$getByHandle("gradeScroll").scrollTo(133*(o.order-1),0):S.$getByHandle("gradeScroll").scrollTo(931,0)};var L,x,D,N,_=0,k=Math.floor(3*Math.random())+2;o.clickChou=function(){if(!o.isRuning){d.luckDraw({gameId:o.gameId,timeStamp:(new Date).getTime()}).success(function(e){if(e.success)o.chouResult=e.result,o.endP=e.result.postion-1,o.start(),h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),i={gameId:e};f.get(t,i).success(function(e){e.success&&(o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum)})}),o.chouCount++;else if(e.message&&e.message.indexOf("抽奖次数")>-1)l.alert({template:e.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("GAME")>-1)l.alert({template:"对不起，奖品已被抽光"}),o.curP=void 0;else if(e.message&&e.message.indexOf("未登录")>-1)o.curP=void 0,n.go("login");else{if(o.curP=void 0,"-100"==e.errorCode)return;l.alert({template:e.message})}}).error(function(e){u.showToast("网络错误")}),o.curP=0;var e=12*k+o.endP;L=5,x=4==k?15:10,D=4==k?e-15:e-10,N=4==k?e-10:e-5}},o.starsList=[{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"}],o.starsListLimit=6,o.showPopup=function(){o.data={input1:"",input2:""},o.handler&&o.handler.call()},o.start=function(){o.endP<0||o.endP>11||(o.isRuning=!0,o.timer=a(function(){if(_++,_>=L?P=100:_>=x?P=60:_>=D?P=100:_>=N&&(P=500),_>12*k&&o.curP===o.endP)return _=0,o.isRuning=!1,void o.showForm();o.curP<12?o.curP++:o.curP=0,o.start()},P))},o.openPic=function(){o.modal.show()},o.closePic=function(){o.modal.hide()},o.share=function(){if(window.device&&window.device.hasNewShare){if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void u.showToast("请先登录,再分享");if(o.isShowForm)return;o.showShare=!o.showShare}else{if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void u.showToast("请先登录,再分享");if(o.isShowForm)return;if(window.umeng){var e=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}},o.goBack=function(){o.isAdmin&&1==o.isAdmin||o.isShowForm||("advertisement"==i.fromState?n.go("homePage"):o.$ionicGoBack())},o.showForm=function(){o.isShowForm=!0},o.hideForm=function(){o.isShowForm=!1},o.confirmGameInfo=function(){if(!o.chouResult.consignee)return void l.alert({title:"提示",template:"收件人必须填写！"});if(!o.globalConstant.mobileNumberRegExp.test(o.chouResult.mobile))return void l.alert({title:"提示",template:"请输入正确的手机号！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.address)return void l.alert({title:"提示",template:"地址必须填写！"});var e={gameId:o.chouResult.gameId,uuid:o.chouResult.uuid,prizeId:o.chouResult.gamePrizeId,consignee:o.chouResult.consignee,mobile:o.chouResult.mobile,address:o.chouResult.address,regionName:o.chouResult.regionName,isDefault:0,provinceId:o.chouResult.provinceId,cityId:o.chouResult.cityId,regionId:o.chouResult.regionId,streetId:o.chouResult.streetId};d.confirmGameInfo(e).success(function(e){e.success?(u.showToast("提交成功"),o.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},o.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},o.addressInit=function(e,i,s,n){if(o.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=n,i){o.dataAdd=JSON.parse(i),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",t.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){u.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1};var O=!1;o.goSelect=ionic.Utils.debounce(function(e,s){for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var s=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=s.text,o.defaultValue["value"+o.level]=s.value,o.level>-2){-1==o.level&&(o.selectProvince=s.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel);var r=-1*o.level;o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(s.value,r).success(function(e){if(1==r){s.value}o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){u.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){u.showToast("获取地址信息失败！")})}}else if(o.level>-4)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,-3==o.level?(o.selectArea=s.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top):o.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,r=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(s.value,r).success(function(e){if(o.dataAdd=e.data,o.addressTipFlag=!1,2==r){s.value}var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){u.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),S.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){u.showToast("获取地址信息失败！")})};else{if(O)return;a(function(){O=!1},1500),i.$broadcast(o.flag,o.defaultValue),O=!0,o.closeAddressModal()}},300),i.$on("CHANGEADDRESS_LOCATION_GAME",function(e,t){o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.chouResult.provinceId=t["value-1"],o.chouResult.cityId=t["value-2"],o.chouResult.regionId=t["value-3"],o.chouResult.streetId=t["value-4"],o.chouResult.regionName=o.textOne+o.textTwo+o.textThree+o.textFour}),o.getPosition=function(){if("定位中···"!=i.globalConstant.autoPosition){A=e.getAddressInfo();var s=A.regionName+"/"+A.streetName;t.addAddress(A.provinceId,A.cityId,A.areaId,s,A.streetId).success(function(){var e={"text-1":A.provinceName,"text-2":A.cityName,"text-3":A.regionName,"text-4":A.streetName,"value-1":A.provinceId,"value-2":A.cityId,"value-3":A.areaId,"value-4":A.streetId};i.$broadcast(o.flag,e),o.addressModal.hide()})}},g.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),o.closeAddressModal=function(){o.addressModal.hide()},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="给您推荐顺逛每日抽奖活动,不可错过哦!",i=y,s=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng?(0==e?window.umeng.shareToSina("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback),h.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback),h.qqShare()),5==e?o.copeText(s):h.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?v.open(r.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):n.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})}}]),APP.service("GameService",["$http","UrlService",function(e,t){this.gameInfo=function(o){var i=t.getGameUrl("GAME_INFO");return e.get(i,o)},this.luckDraw=function(o){var i=t.getGameUrl("LOTTERY");return e.get(i,o)},this.confirmGameInfo=function(o){var i=t.getGameUrl("GAME_HAVE_PRIZE"),s="gameId="+o.gameId+"&uuid="+o.uuid+"&prizeId="+o.prizeId+"&consignee="+o.consignee+"&mobile="+o.mobile+"&address="+o.address+"&regionName="+o.regionName+"&isDefault="+o.isDefault+"&provinceId="+o.provinceId+"&cityId="+o.cityId+"&regionId="+o.regionId+"&streetId="+o.streetId;return e({method:"POST",url:i,data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.storeDetailInfo=function(o){var i=t.getUrl("GET_STORE_DETAIL");return e.get(i,o)},this.getapplyDuozhu=function(o){var i=t.getUrl("GET_APPLY_MENGZHU");return e.get(i,o)},this.applyDuozhu=function(o){var i=t.getUrl("APPLY_MENGZHU");return e({method:"POST",url:i,params:o})},this.notapplyDuozhu=function(o){var i=t.getUrl("APPLY_MENGZHU_NOT");return e.get(i,o)}}]),APP.controller("newresCtrl",["$stateParams","$scope","flashService","$state","$ionicHistory","$interval","newresService","$ionicScrollDelegate","$rootScope","$localstorage","GoodsService","UserService","$ionicLoading","HomePageService",function($stateParams,$scope,flashService,$state,$ionicHistory,$interval,newresService,$ionicScrollDelegate,$rootScope,$localstorage,GoodsService,UserService,$ionicLoading,HomePageService){function Format(e){return e=e<10?"0"+e:e}function countDown(e,t,o){$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($state.reload(),$interval.cancel(timer[o]))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.showtime=0,$scope.pageIndex=1,$scope.newprodlist=[],$scope.hasmore=!0,$scope.isWd=!1,$scope.storeId=0,$scope.flag=!1,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png";var timer=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="",nowT=(new Date).getTime();$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){$scope.flag=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprodlist=e.data.acReserveList;for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var i=timerLength;i<remindArray.length;i++)countDown(countDownNowTime[remindArray[i]],countDownendTime[remindArray[i]],remindArray[i])})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.loadMore=function(){$scope.pageIndex++,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){if($scope.flag=!0,0==e.data.acReserveList.length)$scope.hasmore=!1,$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList),$scope.$broadcast("scroll.infiniteScrollComplete");else{if($scope.hasmore=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd)$scope.isWd=!0,$scope.storeId=UserService.getUser().mid;else{$scope.storeId=$localstorage.get("storeId",20219251),$scope.isWd=!1}$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList);for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var i=timerLength;i<remindArray.length;i++)countDown(countDownNowTime[remindArray[i]],countDownendTime[remindArray[i]],remindArray[i]);$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.$on("$ionicView.beforeEnter",function(){$scope.init()}),$scope.goBack=function(){for(var e=0;e<remindArray.length;e++)$interval.cancel(timer[remindArray[e]]);remindArray=[],$ionicHistory.goBack()}}]),APP.service("newresService",["$http","UrlService","flashService","$interval",function(e,t,o,i){this.getnewProd=function(o,i,s,n,a,r){var c={provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:o,from:r};return e.get(t.getNewUrl("NEW_SEND"),c)}}]),APP.controller("newsendCtrl",["$stateParams","$scope","GoodsService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService",function($stateParams,$scope,GoodsService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService){function add(e,t){var o=new Date,i=t,s=o.getTime(),n=$interval(function(){s+=1e3;var e=parseInt((i-s)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,a=parseInt(o/3600),r=e-24*t*60*60-60*a*60,c=parseInt(r/60),l=e-24*t*60*60-60*a*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(a)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(n))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var s=t.slice(t.lastIndexOf("=")+1),n=/\=(.*?)\&/g,a=t.match(n),r=[],c=0;c<a.length;c++)r.push(a[c].substring(1,a[c].length-1));$state.go("productDetail",{fromType:s,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var u=t.slice(t.indexOf("#/"));window.location.hash=u}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,i,s,n,a){var r={provinceId:o,cityId:i,districtId:s,streetId:n,pageIndex:a};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var i={from:o};return e.get(t.getZCUrl("SUC_ZHONGCHOU"),i)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("presellCtrl",["$scope","flashService","$state","$ionicHistory","$interval","presellService","$ionicScrollDelegate","$rootScope","$localstorage","UserService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d){e.pageIndex=1,e.hasmore=!0,e.preselllist=[],e.storeId=0,e.flag=!1,e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.goBack=function(){i.goBack()},e.init=function(){e.storeId=c.get("storeId",r.globalConstant.storeId),e.loadMore=function(){n.getpres(e.pageIndex).success(function(t){0==t.data.length?(e.hasmore=!1,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasmore=!0,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"))}),e.pageIndex++},d.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.$on("$stateChangeSuccess",function(){e.loadMore()})}]),APP.service("presellService",["$http","UrlService","flashService","$interval",function(e,t,o,i){this.getpres=function(o){var i={pageIndex:o,pageSize:4};return e.get(t.getNewUrl("NEW_RES"),i)}}]),APP.controller("CarTrackController",["$scope","$stateParams","$sce",function(e,t,o){e.trackUrl=o.trustAsResourceUrl(t.trackUrl)}]),APP.controller("ConfirmReceiveController",["$scope","PopupService","$stateParams","ConfirmReceiveService","$ionicViewSwitcher","$state",function(e,t,o,i,s,n){function a(){i.getConfirmList(e.orderId).success(function(t){t.success&&(e.confirmCount=t.data.numberCount,e.confirmReceivelist=t.data.orderProductList)})}e.orderId="",e.confirmCount="",e.confirmReceivelist=[],e.confirmReceive=function(e){function o(o){o&&i.confirmReceive(e).success(function(e){e.success?a():t.showToast(e.message)})}t.showConfirm("",'"确认收货"将代表您已收到所购商品！',o,"确认")},e.goOrderManage=function(){s.nextDirection("forward"),n.go("orderManage")},e.$on("$ionicView.beforeEnter",function(t,i){e.orderId=o.orderId,a()})}]),APP.service("ConfirmReceiveService",["$http","UrlService",function(e,t){this.getConfirmList=function(o){var i={orderId:o};return e.get(t.getUrl("GET_CONFIRM_RECEIVE_LIST"),i)},this.confirmReceive=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CONFIRM_RECEIVE"),i)}}]),APP.controller("SendGoodsTimeController",["$scope","$stateParams","$rootScope","$state","$ionicActionSheet","SendGoodsTimeService","PopupService",function(e,t,o,i,s,n,a){e.htmlContent=t.content,e.title=t.title,e.data={time:[{text:"9:00-13:00"},{text:"13:00-18:00"},{text:"18:00-21:00"}]},e.zfb_checked=!0,e.huod_checked=!1,e.kjt_checked=!1,e.init=function(){e.htmlContent=t.content,e.title=t.title,e.dateTimes=[],e.datas={},n.getSendGoodsDates().success(function(t,o,i,s){e.storeInfo=t.data.resShippingList;for(var n=0;n<t.data.resShippingList.length;n++)e.datas={text:t.data.resShippingList[n].weekDay},e.dateTimes.push(e.datas)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.chooseDate=function(){s.show({buttons:e.dateTimes,cancel:function(){},buttonClicked:function(t){return e.dateChoose=e.dateTimes[t].text,!0},cssClass:"limitScrollHeight"})},e.chooseTime=function(){s.show({buttons:e.data.time,cancel:function(){},buttonClicked:function(t){return e.timeChoose=e.data.time[t].text,!0}})},e.confirm=function(){if(!e.dateChoose||!e.timeChoose)return void a.showToast("请填写配送时间");e.dateChoose=e.dateChoose.substr(0,10),n.confirmSendGoodsDates(1,e.dateChoose,e.timeChoose).success(function(e,t,o,s){1==e.success&&i.go("orderConfirm")})}}]),APP.service("SendGoodsTimeService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){var o={toUrl:2};return e.get(t.getUrl("PAY_WAY"),o)},this.confirmSendGoodsDates=function(o,i,s){var n={delivery:o,yuyueDay:i,yuyueTime:s};return e({method:"POST",url:t.getUrl("SUBMIT_DELIVE_WAY"),params:n})}}]),APP.controller("AfterOrderSubmitController",["$scope","$stateParams","$rootScope","$ionicLoading","PaymentService","$ionicHistory","PopupService","InAppBrowserService","$state","EasyConnectService","$ionicPopup","AfterOrderSubmitService",function(e,t,o,i,s,n,a,r,c,l,d,u){e.htmlContent=t.content,e.title=t.title,e.payment="",e.showPay=!0,e.isToStore=!1;var p="";e.paymentCode=t.paymentCode;var g,m,f;e.init=function(){e.htmlContent=t.content,e.title=t.title,e.messageData=t.messageData,e.data=JSON.parse(e.messageData),g=e.data.orderSn,m=e.data.paymentCode,f=e.data.orderAmount,e.payment=e.data.paymentName},e.payTest=function(e,t,o){return void c.go("paymentxyz",{orderSn:e,totalAmount:o})},e.goToStore=function(){c.go("myStore",{storeId:p,shareStoreId:p})},e.goBack=function(){n.goBack(-2)},e.$on("$ionicView.beforeEnter",function(){e.init();var t=n.viewHistory().histories.root.stack,o=t.length;t[o-3]&&"productDetail"==t[o-3].stateName?p=t[o-3].stateParams.shareStoreId:t[o-4]&&"productDetail"==t[o-4].stateName&&(p=t[o-4].stateParams.shareStoreId),p&&(e.isToStore=!0)})}]),APP.service("AfterOrderSubmitService",["$http","UrlService",function(e,t){this.getAliPayInfo=function(o,i,s){var n={tradeNo:o,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+o,price:i,notifyUrl:s};return e({method:"POST",url:t.getUrl("GET_ALIPAY_INFO"),params:n})}}]),APP.controller("BankCardChoseController",["bankCardPaymentListService","$scope","$stateParams","$state","$ionicHistory","PopupService","$ionicPopup","$http","UrlService","UserService",function(e,t,o,i,s,n,a,r,c,l,d){t.orderSn=o.orderSn,t.totalAmount=o.totalAmount,t.cardsArr=[],t.goCart=function(){i.go("orderManage")},t.toPay=function(e){var o={orderSn:t.orderSn,totalAmount:t.totalAmount,whereName:e};switch(e){case"ccb_credit":i.go("debitCardPayment",o);break;case"ccb_fenqi":i.go("ccbfenqi",o);break;case"ceb_credit":i.go("debitCardPayment",o);break;case"ceb_fenqi":i.go("ccbfenqi",o)}},t.goBack=function(){t.$ionicGoBack()},t.$on("$ionicView.beforeEnter",function(){e.getCcbCost("sg").success(function(e){e.success&&(t.cardsArr=e.data)})})}]),APP.service("bankCardPaymentListService",["$http","UrlService",function(e,t){this.getCcbCost=function(o){var i=t.getPayCenter("PAY_TYPE_LIST")+"?callback=JSON_CALLBACK&channel="+o+"&category=1";return e.jsonp(i)}}]),APP.controller("CcbPayController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,i,s,n,a){e.ccbUrl=o.trustAsResourceUrl(t.url),window.screen.width<=320?e.height="50%":e.height="80%";t.orderSn;e.goBack=function(){a.go("orderManage")}}]),
=======
APP.controller("secondLevelStoreController",["UrlService","UserService","CreditService","PopupService","$stateParams","secondLevelStoreService","CartService","HomePageService","GoodsService","$q","$localstorage","$scope","$state","LoginService","$rootScope","$ionicModal","BranchTypeDetailService","$ionicScrollDelegate","$ionicHistory",function(UrlService,UserService,CreditService,PopupService,$stateParams,secondLevelStoreService,CartService,HomePageService,GoodsService,$q,$localstorage,$scope,$state,LoginService,$rootScope,$ionicModal,BranchTypeDetailService,$ionicScrollDelegate,$ionicHistory){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function sortById(e,t){return e.sort-t.sort}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function getProductList(){secondLevelStoreService.getSecondLevelProduct($scope.storeId,$scope.pageIndex,$scope.pageSize,$scope.filterData,$scope.productCateId,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.regionId).success(function(e){e.success?(e.data.productList&&($scope.productList=$scope.productList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.tempList=$scope.tempList.concat(e.products),$scope.productList=$scope.tempList)})),6*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1):($scope.productList=[],PopupService.showToast(e.message))})}window.cordova?$scope.isApp=!0:$scope.isApp=!1,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.iosAppHeight={height:"64px",paddingTop:"20px"},$scope.iosAppPadding={paddingTop:"64px"}):($scope.iosAppHeight={height:"44px",paddingTop:"2px"},$scope.iosAppPadding={paddingTop:"44px"}),$scope.isBuyer=LoginService.getRole(),$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png",$scope.filterData="isHotDesc",$scope.productCateIdType="0",$scope.switch=!0,$scope.filter_index=0,$scope.pageIndex="1",$scope.pageSize="6",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.hasmore=!1,$scope.settingsList="",$scope.checkedIndex=0,$scope.tempList=[],$scope.productList=[],$scope.arrowState=["img/ic_sort_state_0.png","img/ic_sort_state_1.png","img/ic_sort_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/ic_screen_state_0.png","img/ic_screen_state_1.png"],$scope.filter_index=0;var tabState=["",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.filterData="saleDesc",$scope.chooseIndex=3,$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.lstAttributes=[],$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.showMoreInfo=function(){$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.cancelShare=function(){$scope.showShare=!$scope.showShare},$scope.goToShare=function(e){if(e.preventDefault(),e.stopPropagation(),!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.isShowMoreInfo=!$scope.isShowMoreInfo,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.clickSecondLevel=function(e){$scope.checkedIndex=e,$scope.productCateId=$scope.secTypeList[e].cId,$scope.tempList=[],$scope.productList=[],$scope.pageIndex=1,$scope.pageSize=6,getProductList()},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.hideMoreDetail=function(){$scope.isShowMoreInfo=!1,$scope.lookMoreImg=$scope.isShowMoreInfo?"ic_lookMoreActive.png":"ic_lookMore.png"},$scope.shareToPlatform=function(e){var t=$scope.secTitle,o="找特产，来顺逛，质量更可靠，价格更亲民，特产汇欢迎您的到来~",i=$scope.sPic,s=UrlService.getShareLinkHeader()+"secondLevelStore/"+$stateParams.cityId+"/"+$scope.storeId;window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(s):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功"),$scope.isShowCopyButton=!1):PopupService.showToast("请下载APP执行此操作")},$scope.customerServe=function(){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+$localstorage.get("sg_login_token_secret").substring(6),"_blank","location=no")},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.openFilterModal();else{if($scope.resetFilter(),$scope.page=2,1==e){$scope.chooseIndex=e;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData=1==t?"commission":"commissionDesc"}else if(3==e)$scope.chooseIndex=e,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData="saleDesc";else if(4==e){$scope.chooseIndex=e;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.searchData=[],$scope.filterData=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList()}},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var i=o.length-1,s=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var n=0;n<o.length;n++)n>0&&"true"==o[n].active&&(o[0].active="false",s++);if(s==i||0==s){for(var n=0;n<o.length;n++)n>0&&(o[n].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var n=0;n<o.length;n++)n>0&&(o[n].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var i=0;i<$scope.lstAttributes[t].lstAttributeOptions.length;i++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[i].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[i].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.tempList=[],$scope.productList=[],getProductList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].id==$scope.attributeId?(o[t].lstAttributeOptions[s].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,i=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&"true"==t.lstAttributeOptions[s].active&&(t.lstAttributeOptions[0].active="false",i++);if(i==o||0==i){for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false")}},$scope.init=function(){var e=$q.defer(),t=$q.defer(),o=$q.all([e.promise,t.promise]);$scope.tempList=[],$scope.productList=[],$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),$scope.cartTotalNum=0,$scope.filterParams="",$scope.regionId=$stateParams.cityId,$scope.pageIndex=1,$scope.pageSize=6,$scope.checkedIndex=0,$scope.chooseIndex=3,secondLevelStoreService.getSecTypeList($scope.regionId).success(function(t){t.success&&($scope.secTitle=t.data.pathName,$scope.sPic=t.data.sPic,$scope.secTypeList=JSON.parse(t.data.classify).sort(sortById),$scope.productCateId=$scope.secTypeList[0].cId,e.resolve())}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,$scope.page=1,t.resolve()}),o.then(function(){$scope.filterData="saleDesc",getProductList()}),CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0})},$scope.loadMore=function(){$scope.pageIndex=$scope.pageIndex+1,getProductList()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.hideMoreDetail()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void CartService.getNumber().success(function(e){e.success?$scope.cartTotalNum=e.data:$scope.cartTotalNum=0});$stateParams.shareId&&($rootScope.shareId=$stateParams.shareId),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.init()})}]),APP.service("secondLevelStoreService",["$http","UrlService",function(e,t){this.getSecondLevelProduct=function(o,i,s,n,a,r,c,l,d,u){var p={storeMemberId:o,pageIndex:i,pageSize:s,filterData:n,productCateId:a,provinceId:r,cityId:c,districtId:l,streetId:d,pageId:u};return e.get(t.getUrl("SECONDLEVEL_PRODUCTLIST"),p)},this.getSecTypeList=function(o){var i={regionId:o};return e.get(t.getNewUrl("SECONDLEVEL_SECTYPELIST"),i)}}]),APP.controller("SpecialtyVenueHomeController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","localSpecialtyHomePageService","specialtyVenueHomeControllerService","$ionicPopup","CartService","LoginService","HomePageService","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,P,L,x,D,N){function _(){m.memberId=S.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==m.memberId&&(m.settingsList=e[t].list,!0)}m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png",m.pageTitle="",m.collects=0,m.topImgSrc="",m.topBanners=[],m.recommendations=[],m.communities=[],m.competitiveProducts=[],m.recommendProducts=[],m.hotProducts=[],m.cities=[],m.showShare=!1,m.shareImgUrl="",m.isCollected=0,m.dealPrice=u.dealPrice,m.regionId=f.regionId,m.streetId=f.streetId,m.storeId=s.get("storeId",$.globalConstant.storeId),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_1.png",m.isBuyer=parseInt(x.getRole()),m.flashProductList=[],m.midActivtyList=[],m.midCommList=[],m.getCollected=function(){return m.isCollected?"已收藏":"收藏"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(m.paddingtopClass={"margin-top":"16px"},m.paddingtopClasscontent={top:"64px"}):(m.paddingtopClass={"margin-top":"0px"},m.paddingtopClasscontent={top:"44px"}),m.$on("$ionicView.beforeEnter",function(e,t){if(f.shareId&&($.shareId=f.shareId),"back"==t.direction)return m.getCartNum(),D.isWdHost().success(function(e){$.isWdHost=e.data.isHost}),void _();A.getAllProducts(m.regionId,m.streetId).success(function(e){e.success&&(m.topImgSrc=e.data.topImageUrl,m.shareImgUrl=e.data.simplePicUrl,m.cities=e.data.cities,m.topBanners=e.data.topBanners,m.isCollected=e.data.isCollected,m.isCollected&&(m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_0.png"),m.recommendations=e.data.recommendations,m.hotProducts=e.data.hotProducts,m.communities=e.data.communities,m.competitiveProducts=e.data.competitiveProducts,m.pageTitle=e.data.pageTitle,m.collects=e.data.collects,m.recommendProducts=e.data.recommendProducts,h.$getByHandle("sepcialty_top_banner").update(),h.$getByHandle("sepcialty_top_banner").loop(!0),h.$getByHandle("specialty_recommond_banner").update(),h.$getByHandle("specialty_recommond_banner").loop(!0),null!=m.hotProducts&&(m.hotProdcutTitle=m.hotProducts[0].moudleTitle),null!=m.recommendations&&(m.curatorOfRecommendedTitle=m.recommendations[0][0].moduleTitle),null!=m.competitiveProducts&&(m.boutiqueTitle=m.competitiveProducts[0].moudleTitle))}),m.getCartNum(),D.isWdHost().success(function(e){$.isWdHost=e.data.isHost}),_()}),m.settingsList="",m.getCartNum=function(){L.getNumber().success(function(e){e.success?m.cartTotalNum=e.data:m.cartTotalNum=0})},m.$on("$ionicView.beforeLeave",function(){m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"}),m.goBack=function(){t.goBack()},m.showPopup=function(e){var t=P.show({template:e});I(function(){t.close()},1e3)},m.collected=function(){m.isCollected?A.cancelCollect(m.regionId).success(function(e){e.success&&(m.isCollected=0,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)-1+""),m.showPopup("取消成功"),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_1.png")}):A.addCollect(m.regionId).success(function(e){e.success&&(m.isCollected=1,m.collects.indexOf("万")<0&&(m.collects=parseInt(m.collects)+1+""),m.collectImgSrc=$.imgBaseURL+"img/ic_shoucang_0.png",m.showPopup("收藏成功"))})},m.goToListOfSpecialtyGoods=function(){v.go("ListOfSpecialtyGoods",{pageId:m.regionId,productCateId:0})},m.showMenu=function(){m.isDisplay?(m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"):(m.isDisplay=!0,m.menuImg=$.imgBaseURL+"img/ic_lookMoreActive.png")},m.hideMenu=function(){m.isDisplay=!1,m.menuImg=$.imgBaseURL+"img/ic_lookMore.png"},m.cancelShare=function(){m.showShare=!1},m.goSecondLevelStore=function(e){v.go("secondLevelStore",{cityId:e})},m.goProductDetail=function(){v.go("")},m.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:T.getBannerTheme(o).success(function(e){v.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:v.go("bannerTheme",{bannerId:o});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:m.storeId});break;case 2:if(t){var n=t.slice(t.indexOf("=")+1);v.go("couponsDetail",{cId:n,userID:m.storeId,type:2})}else v.go("getCouponsList");break;case 3:var a=t.slice(t.indexOf("=")+1);v.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?T.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){v.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&v.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:v.go("crowdFunding");break;case 7:t?v.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:m.storeId}):v.go("newSend");break;case 8:t?v.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):v.go("topic.qhot")}},m.toShare=function(){return m.isDisplay=!1,window.cordova?(m.menuImg=$.imgBaseURL+"img/ic_lookMore.png",S.isUserLogin()?(m.showShare=!0,void(window.device&&(m.shareToPlatform(),m.showShare=!m.showShare))):void v.go("login")):void m.showPopup("请下载APP执行此操作")},m.toHomePage=function(){m.isDisplay=!1,v.go("homePage")},m.contactCustomer=function(){if(m.isDisplay=!1,S.isUserLogin()){var e={goods_id:"-1",clientGoods_type:"1",appGoods_type:"0"};window.xneng?window.xneng.NTalkerStartChat("hg_1000_1508927913371","普通客服组",e,function(e){},function(e){}):window.open("http://m.ehaier.com/v2/h5/sg/common/customService.html?flag="+s.get("sg_login_token_secret").substring(6),"_blank","location=no")}else v.go("login")},m.shareToPlatform=function(e){if(!S.getUser().mid)return void v.go("login");var t=s.get("storeId",$.globalConstant.storeId),i=m.pageTitle,n="找特产，来顺逛，质量可靠价格亲民，特产惠欢迎您的到来～",a=m.shareImgUrl,r=o.getShareLinkHeader()+"SpecialtyVenueHome/"+m.regionId+"/"+m.streetId+"/"+t,c={},l=function(e){N.shareSuccessCallback(e,c)};window.umeng?(0==e?window.umeng.shareToSina(i,n,a,r,0,null,l):1==e?window.umeng.shareToWechatSession(i,n,a,r,0,null,l):2==e?window.umeng.shareToWechatTimeline(i,n,a,r,0,null,l):3==e?(window.umeng.shareToQQ(i,n,a,r,0,null,l),N.qqShare()):4==e&&(window.umeng.shareToQzone(i,n,a,r,0,null,l),N.qqShare()),5==e?m.copeText(r):N.successShare()):alert("umeng undefined 只能在app分享"),m.showShare=!1},m.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),C.showToastShort("复制成功"),m.isShowCopyButton=!1):C.showToast("请下载APP执行此操作")}}]),APP.service("specialtyVenueHomeControllerService",["$http","UrlService",function(e,t){this.getAllProducts=function(o,i){var s={regionId:o,streetId:i};return e.get(t.getZCUrl("SPECIALY_VENUE_HOME"),s)},this.addCollect=function(o){var i={type:2,collectId:o};return e.get(t.getZCUrl("ADD_COLLECT"),i)},this.cancelCollect=function(o){var i={type:2,collectId:o};return e.get(t.getZCUrl("CANCEL_COLLECT"),i)}}]),APP.controller("AdvertisementController",["$scope","$rootScope","$timeout","$state","$interval","$stateParams","AdvertisementService","PopupService",function(e,t,o,i,s,n,a,r){function c(){var t=window.localStorage.getItem("hasAD");"noAD"!=t?(e.imgUrl=t,l=s(function(){e.second<=1?e.skipAd():e.second--},1e3)):i.go(d)}var l,d=n.from;e.imgUrl="",e.second=9,e.skipAd=function(){s.cancel(l),i.go(d)},e.$on("$ionicView.beforeEnter",function(){d=n.from,e.second=9,c()})}]),APP.service("AdvertisementService",["$http","UrlService",function(e,t){this.getAdImage=function(){var o={noLoading:!0};return e.get(t.getUrl("GET_AD_IMAGE"),o)}}]),APP.controller("DirectPurchaseController",["$scope","UserService","AccountMessageService","$state","LoginService","RegisterService","PopupService","$ionicPopup",function(e,t,o,i,s,n,a,r){e.topPlus={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.topPlus={"padding-top":"42px"}),e.init=function(){var o=t.getUser();e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.userLogOut=function(){e.sessionId?o.unloadAccount(e.token,e.sessionId,e.header).success(function(e,o,n,a){e.success&&(t.clearUser(),s.setRole(void 0),i.go("guidePage"))}):(t.clearUser(),s.setRole(void 0),i.go("guidePage"))},e.goToDelete=function(){r.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.userLogOut()})},e.goShopApply=function(){n.wdApply().success(function(e){e.success?e.data?i.go("newAuthenticationHome"):i.go("registerForStore"):a.showToast("服务端错误")}).error(function(){alert("网络错误")})},e.goSelection=function(){i.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("GuidePageController",["$scope","UserService","$state","LoginService","$localstorage",function(e,t,o,i,s){e.$on("$ionicView.beforeEnter",function(){s.set("ROLE_INFO","undefined")})}]),APP.controller("LoginController",["$timeout","HomePageService","$interval","$rootScope","$scope","$localstorage","LoginService","$state","UserService","$ionicPopup","PaymentService","PopupService","$ionicHistory","RegisterService","$http","UrlService","ServiceConversationService","GroupSettingService","IMService","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),s=!1,n=o.length-1;n>=0;n--)if(o[n].id==t)return i.isCommission=o[n].list[0].checked,i.cashSwitch=o[n].list[1].checked,i.goldRainSwitch=o[n].list[2].checked,void(s=!0);if(!s){i.isCommission=!0,i.cashSwitch=!0,i.goldRainSwitch=!0;var a={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(a),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var r=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),i.isCommission=!0,i.cashSwitch=!0,i.goldRainSwitch=!0}}function w(e){n.set("IsThirdLoginType",e),y++;var t={qq:4,sina:6,wechat:7};window.umeng.login(e,function(o){o=JSON.parse(o);var d={uid:o.uid,source:t[e],nickName:o.name,headerPic:o.profile_image_url?o.profile_image_url:o.headimgurl,openid:o.openid,unionid:o.unionid};if(d.uid){var h={userId:d.uid,userName:d.nickName,loginType:t[e],icon:d.headerPic,openid:d.openid,unionid:d.unionid};a.loginThird(h).success(function(e){if(window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.success){c.setUser(e.data),S.initWebSocket();var t=e.data.mid;i.loginMemberId=e.data.mid,$(t),a.checkOpenStore(t).success(function(e){e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",t)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))}),c.setUser(e.data),e.data.sessionValue?n.set("sg_login_token_secret","Bearer"+e.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),g.wdApply().success(function(e){e.success?e.data?(c.setUser(e.data),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(i.loginGoNum=1,p.goBack(-1)):(i.loginGoNum=0,r.go("homePage"))):r.go("RegisterForStoreLogin",{hasHistory:1}):u.showToast("服务端错误")})}else e.message?u.showToast(e.message):u.showToast("登录失败！")}).error(function(e){l.alert({title:"提示",template:"网络连接失败！"})})}else y>3?u.showToast("授权失败，请稍后再试"):w(e)},function(e){l.alert({title:"提示",template:"第三方登录失败！"})})}s.isBuyer="1",s.isFocusShow=!0,s.identifyCodeImg="",s.showCaptcha=!1,s.showCaptchaForPhone=!1,s.eyeIndex=0,s.loginIndex=0,s.showVC=!1,s.canGetVcode=!0,s.VCodeTips="获取验证码",s.eyeArr=[i.imgBaseURL+"img/eye_close@2x.png",i.imgBaseURL+"img/eye_open@2x.png"],s.pwdArr=["password","text"],s.loginTypeArr=["短信验证码登录","账号密码登录"],s.loginTypeArrGrowingIo=["账号密码登录","短信验证码登录"];var y=0,T=p.viewHistory().backView,C=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":"unknown";s.leftArrow={},s.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(s.leftArrow={"margin-top":"36px"},s.rightButton={top:"36px"});s.xyzloginName=c.getUser().loginName,s.userInfo={userName:s.xyzloginName,mobile:c.getUser().mobile,password:"",captcha:"",verificationCode:""},s.VCodeStyle={color:"#2979FF"},s.showVCode=function(){s.showVC=!s.showVC,s.identifyCodeImg="",s.userInfo.captcha="",1==s.loginIndex?(s.loginIndex=0,s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!1):(s.loginIndex=1,s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!0)},s.getVCode=function(){s.canGetVcode&&(s.userInfo.mobile&&0!=s.userInfo.mobile.length?s.globalConstant.mobileNumberRegExp.test(s.userInfo.mobile)?0==s.userInfo.captcha.length&&1==s.showCaptchaForPhone?u.showToast("请输入图形验证码"):a.fastLoginCaptcha(s.userInfo.mobile,s.userInfo.captcha,s.showCaptchaForPhone).success(function(e){if(e.data)if(-1==e.data&&0==s.userInfo.captcha.length)s.setImgCaptchaForPhone(),s.showCaptchaForPhone=!0,u.showToast("请输入图形验证码");else{s.canGetVcode=!s.canGetVcode;var t=60;s.timer=o(function(){t-1<0?(s.VCodeTips="获取验证码",s.VCodeStyle={color:"#2979FF"},o.cancel(s.timer),s.canGetVcode=!0):(s.VCodeStyle={color:"#666666"},t--,s.VCodeTips="重发 "+t+"s")},1e3)}else u.showToast(e.message)}):u.showToast("请输入正确的手机号格式"):u.showToast("请输入手机号"))},s.toggleEye=function(){s.eyeIndex=(s.eyeIndex+1)%2},s.setImgCaptcha=function(){s.identifyCodeImg=a.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+n.get("sg_login_token_secret").substring(6)},s.setImgCaptchaForPhone=function(){s.identifyCodeImg=g.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+n.get("sg_login_token_secret").substring(6)},s.canClickLoginOrNot=function(){0!=s.userInfo.mobile.length&&0!=s.userInfo.verificationCode.length?s.canClickLogin=!0:s.canClickLogin=!1},s.toRegister=function(){T&&"guidePage"!=T.stateName?r.go("register",{hasHistory:1}):r.go("register",{hasHistory:0})},s.directLogin=function(e){13==(window.event?e.keyCode:e.which)&&s.loginSG()},s.loginSG=function(){n.set("IsThirdLoginType","PT"),1==s.loginIndex?0==s.userInfo.mobile.length?u.showToast("请输入手机号"):s.globalConstant.mobileNumberRegExp.test(s.userInfo.mobile)?0==s.userInfo.verificationCode.length?u.showToast("请输入短信验证码"):s.userInfo.verificationCode.length>0&&s.userInfo.verificationCode.length<6||s.userInfo.verificationCode.length>6?u.showToast("短信验证码长度必须是6位"):a.fastLogin(s.userInfo.mobile,s.userInfo.verificationCode).success(function(e){if(e.data){var t=e.data.mid;$(t),i.loginMemberId=e.data.mid,c.setUser(e.data),S.initWebSocket(),i.userCount=s.userInfo.mobile,i.password="",window.localStorage.setItem("isLogin",c.isUserLogin()),u.showToast("登录成功"),e.data.sessionValue?n.set("sg_login_token_secret","Bearer"+e.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?p.goBack(-1):r.go("homePage"),window.cordova&&(i.gio.setUserId(t.toString()),i.gio.people.set({name:c.getUser().userName,mobile:c.getUser().mobile,email:c.getUser().email,gender:c.getUser().gender,birthday:c.getUser().birthday})),setTimeout(function(){window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var o={member_id:t,device_type:i.isIOS?"ios":"android",device_token:e};a.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){})},0),a.checkOpenStore(t).success(function(e,o,i,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",t)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))})}else u.showToast(e.message)}):u.showToast("请输入正确的手机号格式"):0==s.userInfo.userName.length?u.showToast("请输入用户名"):0==s.userInfo.password.length?u.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==s.userInfo.captcha.length&&1==s.showCaptcha?u.showToast("请输入验证码"):a.loginUserInfoCAPTCHA(s.userInfo.userName,s.userInfo.password,s.userInfo.captcha).success(function(o){if(o.success){var l=o.data.mid;$(l),i.loginMemberId=o.data.mid,c.setUser(o.data),S.initWebSocket(),i.userCount=s.userInfo.userName,i.password=s.userInfo.password,window.localStorage.setItem("isLogin",c.isUserLogin()),u.showToast("登录成功"),o.data.sessionValue?n.set("sg_login_token_secret","Bearer"+o.data.sessionValue):n.set("sg_login_token_secret","Bearer"+I.generateUUID()),window.cordova&&(i.gio.setUserId(l.toString()),i.gio.people.set({name:c.getUser().userName,mobile:c.getUser().mobile,email:c.getUser().email,gender:c.getUser().gender,birthday:c.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(e){var t={member_id:l,device_type:i.isIOS?"ios":"android",device_token:e};a.saveDeviceToken(t).success(function(e){e.success}).error(function(e){})},function(e){}),g.wdApply().success(function(e){
e.success?e.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(p.goBack(-1),i.loginGoNum=1):(i.loginGoNum=0,r.go("homePage")):t.isWdHost().success(function(e){e.success?(s.o2oMessage=e.message,1==e.data.isHost&&(1==e.data.o2o||null==e.data.o2o)?r.go("homePage"):r.go("RegisterForStoreLogin",{hasHistory:1})):u.showToast("获取数据信息失败！")}):u.showToast("服务端错误")}),a.checkOpenStore(l).success(function(e){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){m.get(f.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+C)}),e.data?(s.isBuyer="1",a.setRole(s.isBuyer),n.set("storeId",l)):(s.isBuyer="0",a.setRole(s.isBuyer),n.set("storeId",20219251))})}else o.message?"forget_password"==o.errorCode?(u.showToast(o.message),e(function(){r.go("requestPassword")},2e3)):-1==o.data?(u.showToast(o.message),s.showCaptcha=!0,s.setImgCaptcha()):u.showToast(o.message):u.showToast("登录失败")})},s.isHideFooter=function(){s.isFocusShow=!1},s.isShowFooter=function(){s.isFocusShow=!0},s.thirdLogin=function(e){if(y=0,!window.umeng)return void alert("umeng 插件 未加载");w(e)},s.goBack=function(){p.goBack()},s.$on("$ionicView.beforeEnter",function(){s.showCaptcha=!1,s.showCaptchaForPhone=!1,s.setImgCaptchaForPhone(),a.checkLogin().success(function(e,t,o,i){s.setImgCaptcha(),s.setImgCaptchaForPhone()}),T=p.viewHistory().backView})}]),APP.service("LoginService",["$http","UrlService","$localstorage",function(e,t,o){this.loginUserInfoCAPTCHA=function(o,i,s){var n={userName:o,password:encodeURIComponent(i),captcha:s,isNew:1,noLoading:!0};return e.get(t.getUrl("CAPTCHALOGIN"),n)},this.loginUserInfo=function(o,i){var s={userName:o,password:i,noLoading:!0};return e.get(t.getUrl("LOGIN"),s)},this.loginThird=function(o){return e.get(t.getUrl("THIRD_PARTY_LOGINS"),o)},this.setRole=function(e){return o.set("ROLE_INFO",e)},this.getRole=function(){return o.get("ROLE_INFO",void 0)},this.checkLogin=function(){var o={noLoading:!0};return e.get(t.getUrl("LOGIN_CHECK"),o)},this.checkOpenStore=function(o){if(o)var i={memberId:o};else i={memberId:""};return e.get(t.getUrl("IS_HAS_STORE"),i)},this.saveDeviceToken=function(o){return e.get(t.getUrl("SAVE_DEVICE_TOKEN"),o)},this.getLoginCaptcha=function(){return t.getUrl("GET_LOGIN_CAPTCHA")},this.fastLoginCaptcha=function(o,i,s){if(s){var n={mobile:o,imgCaptcha:i};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA"),params:n,headers:{Authorization:"open the gate"}})}return n={mobile:o},e.get(t.getUrl("FAST_LOGIN_CAPTCHA"),n)},this.fastLogin=function(o,i){var s={mobile:o,captcha:i};return e.post(t.getUrl("FAST_LOGIN")+"?mobile="+s.mobile+"&captcha="+s.captcha)}}]),APP.controller("RegisterController",["$rootScope","$localstorage","$scope","$http","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","IMService","UrlService","GetStatisticInfoService","InAppBrowserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){function w(t){var o=t;if(localStorage.getItem("setSwitch")){for(var i=JSON.parse(localStorage.getItem("setSwitch")),s=!1,n=i.length-1;n>=0;n--)if(i[n].id==o)return e.isCommission=i[n].list[0].checked,e.cashSwitch=i[n].list[1].checked,e.goldRainSwitch=i[n].list[2].checked,void(s=!0);if(!s){e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0;var a={id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};i.push(a),localStorage.setItem("setSwitch",JSON.stringify(i))}}else{var r=[{id:o,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(r)),e.isCommission=!0,e.cashSwitch=!0,e.goldRainSwitch=!0}}o.eyeIndex=0,o.xychecked=!1,o.loginIndex=0,o.showVC=!1,o.canGetVcode=!0,o.VCodeTips="获取验证码",o.eyeArr=[e.imgBaseURL+"img/eye_close@2x.png",e.imgBaseURL+"img/eye_open@2x.png"],o.pwdArr=["password","text"],o.loginTypeArr=["短信验证码登录","账号密码登录"],o.captchaFlag=!0,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=e.imgBaseURL+"img/ic_photo.png",o.showCaptcha=!1,o.isShowsBtn=!1;var y=h.hasHistory,T=f.viewHistory().backView;o.loginInfo={userName:"",password:"",captcha:"",verificationCode:""},o.VCodeStyle={color:"#2979FF"},o.showVCode=function(){o.showVC=!o.showVC,o.loginIndex=(o.loginIndex+1)%2},o.getVCode=function(){o.canGetVcode&&(o.loginInfo.userName&&0!=o.loginInfo.userName.length?o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?c.fastLoginCaptcha(o.loginInfo.userName).success(function(e){if(e.data){o.canGetVcode=!o.canGetVcode;var t=60;o.timer=a(function(){t-1<0?(o.VCodeTips="获取验证码",o.VCodeStyle={color:"#2979FF"},a.cancel(o.timer),o.canGetVcode=!0):(o.VCodeStyle={color:"#666666"},t--,o.VCodeTips="重发 "+t+"s")},1e3)}else n.showToast(e.message)}):n.showToast("请输入正确的手机号格式"):n.showToast("请输入手机号"))},o.toggleEye=function(){o.eyeIndex=(o.eyeIndex+1)%2},o.leftArrow={},o.rightButton={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.leftArrow={"margin-top":"36px"},o.rightButton={top:"36px"}),o.promotionCode=h.promotionCode,o.isShowLogin=!1,o.switch=function(){o.isShowLogin?o.setImgCatpcha():o.setLoginImgCaptcha(),o.promotionCode?o.isShowLogin=!o.isShowLogin:r.go("login")},o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.loginInRegister=function(){1==o.loginIndex?0==o.loginInfo.userName.length?n.showToast("请输入手机号"):o.globalConstant.mobileNumberRegExp.test(o.loginInfo.userName)?0==o.loginInfo.verificationCode.length?n.showToast("请输入短信验证码"):o.loginInfo.verificationCode.length>0&&o.loginInfo.verificationCode.length<6||o.loginInfo.verificationCode.length>6?n.showToast("短信验证码长度必须是6位"):c.fastLogin(o.loginInfo.userName,o.loginInfo.verificationCode).success(function(s){if(s.data){var a=s.data.mid;w(a),e.loginMemberId=s.data.mid,l.setUser(s.data),v.initWebSocket(),e.userCount=o.loginInfo.mobile,e.password="",window.localStorage.setItem("isLogin",l.isUserLogin()),n.showToast("登录成功"),s.data.sessionValue?t.set("sg_login_token_secret","Bearer"+s.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?f.goBack(-1):r.go("homePage"),window.cordova&&(e.gio.setUserId(a.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:a,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),c.checkOpenStore(a).success(function(e,s,n,r){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){i.get(S.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?(o.isBuyer="1",c.setRole(o.isBuyer),t.set("storeId",a)):(o.isBuyer="0",c.setRole(o.isBuyer),t.set("storeId",20219251))})}else n.showToast(s.message)}):n.showToast("请输入正确的手机号格式"):0==o.loginInfo.userName.length?n.showToast("请输入用户名"):0==o.loginInfo.password.length?n.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)"):0==o.loginInfo.captcha.length&&1==o.showCaptcha?n.showToast("请输入验证码"):c.loginUserInfoCAPTCHA(o.loginInfo.userName,o.loginInfo.password,o.loginInfo.captcha).success(function(i){if(i.success){var a=i.data.mid;w(a),e.loginMemberId=i.data.mid,l.setUser(i.data),v.initWebSocket(),e.userCount=o.loginInfo.userName,e.password=o.loginInfo.password,window.localStorage.setItem("isLogin",l.isUserLogin()),n.showToast("登录成功"),i.data.sessionValue?t.set("sg_login_token_secret","Bearer"+i.data.sessionValue):t.set("sg_login_token_secret","Bearer"+I.generateUUID()),window.cordova&&(e.gio.setUserId(a.toString()),e.gio.people.set({name:l.getUser().userName,mobile:l.getUser().mobile,email:l.getUser().email,gender:l.getUser().gender,birthday:l.getUser().birthday})),window.cordova&&window.UmengPush&&window.UmengPush.getDeviceToken&&window.UmengPush.getDeviceToken({},function(t){var o={member_id:a,device_type:e.isIOS?"ios":"android",device_token:t};c.saveDeviceToken(o).success(function(e){e.success}).error(function(e){})},function(e){}),s.wdApply().success(function(t){t.success?t.data?T&&"guidePage"!=T.stateName&&"register"!=T.stateName&&"changePassword"!=T.stateName&&"myPhoneBindSuccess"!=T.stateName?(f.goBack(-1),e.loginGoNum=1):(e.loginGoNum=0,r.go("homePage")):r.go("RegisterForStoreLogin",{hasHistory:1}):n.showToast("服务端错误")}),c.checkOpenStore(a).success(function(e){e.data?t.set("storeId",a):t.set("storeId",20219251)})}else i.message?(n.showToast(i.message),-1==i.data&&(o.showCaptcha=!0),o.setImgCaptcha()):n.showToast("登录失败")})},o.setImgCatpcha=function(){o.identifyCodeImg=s.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.setLoginImgCaptcha=function(){o.loginIdentifyCodeImg=c.getLoginCaptcha()+"?rnd="+Math.random()+"&flag="+t.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)};var C=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?n.showToast("请输入验证码！"):s.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;C=a(function(){t<=0?(a.cancel(C),C=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?n.showToast("该手机号已经注册过顺逛用户，请直接登录。"):e.message?n.showToast(e.message):n.showToast("获取验证码失败！")}):n.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?n.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?n.showToast("请输入短信验证码！"):0==o.xychecked?n.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》！"):s.newAddRegisterUserInfo(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(e.data.isCanRegister){var i={mobileNum:o.userInfo.mobileNum,password:o.userInfo.password,captcha:o.userInfo.captcha,imgCaptcha:o.userInfo.captchaImg};t.setObject("register_obj",i),m(function(){r.go("newAuthenticationHome",{promotionCode:o.promotionCode,types:100})},0)}}else n.showToast(e.message)}):n.showToast("密码不符合规则！"):n.showToast("请输入正确的手机号！")},o.setHeaderImg=function(){return},o.goBack=function(){f.goBack()},o.$on("$ionicView.beforeEnter",function(){o.showCaptcha=!1,c.checkLogin().success(function(e,t,i,s){o.setImgCatpcha()}),y=h.hasHistory,o.promotionCode=h.promotionCode;f.viewHistory().backView}),o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?$.open(S.getHead()+"mstore/sg/helpDetail.html?id="+e,t):r.go("helpDetail",{helpId:e,content:t})},o.selectedChanged=function(e){o.xychecked=e}}]),APP.service("RegisterService",["$http","UrlService",function(e,t){this.addRegisterUserInfo=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:s,imgCaptcha:n},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS"),headers:r,params:a})},this.newAddRegisterUserInfo=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(s),imgCaptcha:n},r={Authorization:"open the gate"};return e({method:"POST",url:t.getUrl("REGISTERS_NEW"),headers:r,params:a})},this.getCaptcha=function(o,i){var s={mobileNum:o,captcha:i};return e.get(t.getUrl("GET_CAPTCHA"),s)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")},this.bindMobile=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(assword),imgCaptcha:n,isNew:1};return e({method:"POST",url:t.getUrl("BIND_MOBILE"),params:a})},this.wdApply=function(){return e.get(t.getUrl("WD_APPLY"))}}]),APP.controller("RegisterForStoreController",["$localstorage","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","$rootScope","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){t.captchaFlag=!0,t.isAgreeConsent=!1,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.iconImage=f.imgBaseURL+"img/ic_photo.png";var S=m.hasHistory;t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.agreeConsent=function(){t.isAgreeConsent=!t.isAgreeConsent};var I=void 0;t.getIdentifyCode=function(){t.captchaFlag&&(t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?i.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e){if(e.success){var o=60;I=s(function(){o<=0?(s.cancel(I),I=void 0,o=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=o+"秒后可重发",t.captchaFlag=!1,o--)},1e3,100)}else"1102"==e.errorCode?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！"))},t.registerUserInfo=function(){var e=t.globalConstant.passwordRegExp;t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.password.length?i.showToast("请输入密码！"):e.test(t.userInfo.password)?0==t.userInfo.captcha.length?i.showToast("请输入短信验证码！"):t.isAgreeConsent?i.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):o.bindMobile(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void i.showToast(e.message);r.getUser();r.getUser().mobile=t.userInfo.mobileNum,n.go("newAuthenticationHome")}else"该手机已被注册！"==e.message?i.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?i.showToast(e.message):i.showToast("注册失败！")}):i.showToast("密码不符合规则！"):i.showToast("请输入在正确的手机号！")},t.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):n.go("helpDetail",{helpId:e,content:t})},t.setHeaderImg=function(){return},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha(),S=m.hasHistory})}]),APP.controller("RegisterForStoreLoginController",["$localstorage","$rootScope","$scope","RegisterService","PopupService","$interval","$state","LoginService","UserService","ShopService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","$ionicHistory","$stateParams","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){o.captchaFlag=!0,o.isAgreeConsent=!1,o.isClearText=!1,o.isClearPassword="password",o.paracont="获取验证码",o.iconImage=t.imgBaseURL+"img/ic_photo.png";var S=f.hasHistory;o.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},o.setImgCatpcha=function(){o.identifyCodeImg=i.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},o.clearText=function(){o.isClearText?(o.isClearPassword="password",o.isClearText=!o.isClearText):(o.isClearPassword="text",o.isClearText=!o.isClearText)},o.agreeConsent=function(){o.isAgreeConsent=!o.isAgreeConsent},o.toRegisterRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?h.open(v.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})};var I=void 0;o.getIdentifyCode=function(){o.captchaFlag&&(o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.captchaImg.length?s.showToast("请输入验证码！"):i.getCaptcha(o.userInfo.mobileNum,o.userInfo.captchaImg).success(function(e){if(e.success){var t=60;I=n(function(){t<=0?(n.cancel(I),I=void 0,t=60,o.paracont="重发验证码",o.captchaFlag=!0):(o.paracont=t+"秒后可重发",o.captchaFlag=!1,t--)},1e3,100)}else"1102"==e.errorCode?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("获取验证码失败！")}):s.showToast("请输入正确的手机号码！"))},o.registerUserInfo=function(){var e=o.globalConstant.passwordRegExp;o.globalConstant.mobileNumberRegExp.test(o.userInfo.mobileNum)?0==o.userInfo.password.length?s.showToast("请输入密码！"):e.test(o.userInfo.password)?0==o.userInfo.captcha.length?s.showToast("请输入短信验证码！"):o.isAgreeConsent?s.showToast("请选择同意《顺逛微店注册协议》及《快捷通服务协议》!"):i.bindMobile(o.userInfo.mobileNum,o.userInfo.captcha,o.userInfo.password,o.userInfo.captchaImg).success(function(e){if(e.success){if(!e.data)return void s.showToast(e.message);c.getUser();c.getUser().mobile=o.userInfo.mobileNum,0==t.loginGoNum?a.go("homePage"):m.goBack(-2)}else"该手机已被注册！"==e.message?s.showToast("亲，此手机号已注册过顺逛账户，请改用其他手机号。"):e.message?s.showToast(e.message):s.showToast("注册失败！")}):s.showToast("密码不符合规则！"):s.showToast("请输入在正确的手机号！")},o.setHeaderImg=function(){return},o.$on("$ionicView.beforeEnter",function(){o.setImgCatpcha(),S=f.hasHistory})}]),APP.controller("RequestPasswordController",["$localstorage","$scope","RequestPasswordService","PopupService","$interval","$state","$timeout",function(e,t,o,i,s,n,a){t.captchaFlag=!0,t.isClearText=!1,t.isClearPassword="password",t.paracont="获取验证码",t.userInfo={mobileNum:"",password:"",captcha:"",captchaImg:""},t.clearText=function(){t.isClearText?(t.isClearPassword="password",t.isClearText=!t.isClearText):(t.isClearPassword="text",t.isClearText=!t.isClearText)},t.setImgCatpcha=function(){t.identifyCodeImg=o.getImgCaptcha()+"?rnd="+Math.random()+"&flag="+e.get("sg_login_token_secret").substring(6)},t.getIdentifyCode=function(){t.globalConstant.mobileNumberRegExp.test(t.userInfo.mobileNum)?0==t.userInfo.captchaImg.length?i.showToast("请输入验证码！"):o.getCaptcha(t.userInfo.mobileNum,t.userInfo.captchaImg).success(function(e,o,n,a){if(e.success){var r=60,c=void 0;c=s(function(){r<=0?(s.cancel(c),c=void 0,r=60,t.paracont="重发验证码",t.captchaFlag=!0):(t.paracont=r+"秒后可重发",t.captchaFlag=!1,r--)},1e3,100)}else e.message?i.showToast(e.message):i.showToast("获取验证码失败！")}):i.showToast("请输入正确的手机号码！")},t.passwordSubmit=function(){0==t.userInfo.mobileNum.length?i.showToast("请输入您的手机号！"):t.globalConstant.passwordRegExp.test(t.userInfo.password)?0==t.userInfo.captcha.length?i.showToast("获取验证码失败！"):o.requestPassword(t.userInfo.mobileNum,t.userInfo.captcha,t.userInfo.password,t.userInfo.captchaImg).success(function(e,o,s,r){e.success?(i.showToast("修改成功"),a(function(){n.go("login")},1e3)):e.message?(i.showToast(e.message),t.setImgCatpcha()):(i.showToast("提交失败！"),t.setImgCatpcha())}):i.showToast("密码为数字、字母、特殊符号中的两种组合，长度6位~20位(字母区分大小写)")},t.$on("$ionicView.beforeEnter",function(){t.setImgCatpcha()})}]),APP.service("RequestPasswordService",["$http","UrlService",function(e,t){this.requestPassword=function(o,i,s,n){var a={mobileNum:o,captcha:i,password:encodeURIComponent(s),imgCaptcha:n};return e({method:"POST",url:t.getUrl("REQUEST_PASSWORD"),params:a})},this.getCaptcha=function(o,i){var s={mobileNum:o,captcha:i};return e.get(t.getUrl("GET_PASSWORD_CAPTCHA"),s)},this.getImgCaptcha=function(){return t.getUrl("GET_IMG_CAPTCHA")}}]),APP.controller("ShopApplyController",["$scope","$rootScope","$state","ShopApplyService","MyStoreService","GoodsService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){e.addressName="",e.goToAddress=!1,e.categoryData=[],e.selectText="",e.selectKey="";var S=window.innerHeight,I=S-373+"px";e.contentHeight={height:I},e.addressTitle="配送至",e.dataAdd=null,e.flag="SHOP_APPLY_ADDRESS",e.defaultValue=null,e.level=0;var $,w,y={};e.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:""},e.mid=l.getUser().mid,e.promotionCode=u.promotionCode,e.init=function(){e.showAlert=!1,e.goToAddress?e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour:e.addressName="",e.selectText=e.textUnion,e.selectValue=e.valueUnion,e.mid=l.getUser().mid,u.promotionCode&&(e.applyInfo.promotionCode=u.promotionCode),e.mid&&d.getStoreInfo(e.mid).success(function(t,o,i,s){t.success&&(e.storeCode=t.data.storeCode,e.storeType=t.data.storeType)})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)},e.addressInit=function(t,o,i,s){if(e.addressTipFlag=!1,f.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=s,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",n.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var T=!1;e.goSelect=ionic.Utils.debounce(function(o,i){for(var a=0;a<e.nowLevelIndex.length;a++)a>e.nowLevel&&(e.nowLevelIndex[a]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=o;var i=arguments[1],o=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=i.text,e.defaultValue["value"+e.level]=i.value,e.level>-2)-1==e.level&&(e.selectProvince=i.text,e.provinceIndex=o,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=f.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){1==ah&&(w=i.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(w,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,f.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=i.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=f.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=f.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,s.getLocationList(i.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&($=i.value);var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){r.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,s.getLocationList($,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),f.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else{if(T)return;g(function(){T=!1},1500),t.$broadcast(e.flag,e.defaultValue),T=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=t.globalConstant.autoPosition){y=a.getAddressInfo();var o=y.regionName+"/"+y.streetName;s.addAddress(y.provinceId,y.cityId,y.areaId,o,y.streetId).success(function(){var o={"text-1":y.provinceName,"text-2":y.cityName,"text-3":y.regionName,"text-4":y.streetName,"value-1":y.provinceId,"value-2":y.cityId,"value-3":y.areaId,"value-4":y.streetId};t.$broadcast(e.flag,o),e.addressModal.hide()})}},h.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.$on("$destroy",function(){e.addressModal.remove()}),t.$on("SHOP_APPLY_ADDRESS",function(t,o){e.goToAddress=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.adrProvinceId=o["value-1"],e.adrCityId=o["value-2"],e.adrAreaId=o["value-3"],e.adrStreetId=o["value-4"],e.addressName=e.textOne+e.textTwo+e.textThree+e.textFour}),t.$on("SHOP_APPLY_UNION",function(t,o){e.textUnion=o.text,e.valueUnion=o.value}),e.checkChange=function(t,o){i.checkText(t).success(function(i){i.data||""==t||("-100"!=i.errorCode&&r.showToast("请不要使用违禁词！"),1==o?e.applyInfo.ownerName="":e.applyInfo.storeName="")})},e.shopApplySubmit=function(){return e.applyInfo.ownerName?e.applyInfo.address?e.applyInfo.storeName?(e.showAlert=!1,void(/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.ownerName)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{2,50}$/.test(e.applyInfo.address)?/^[\u4E00-\u9FA50-9a-zA-Z!@#$%^&*\(\)\_+\-=\[\]{}|\\:;\"'\~`\?<>,. t]{1,20}$/.test(e.applyInfo.storeName)?/^(HR|hr|Hr|hR).{6,18}$/.test(e.applyInfo.hrCode)||"10"!=e.selectValue?0==e.addressName.length?r.showToast("请选择所在地区！"):e.selectText?"10"!=e.selectValue?(e.showAlertCheck=!1,e.showAlert=!1,e.applyInfo.hrCode="",i.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:Math.round(t.data.totalCommission),memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):(t.errorCode="-100")?(p.show({template:"您尚未登录或登录失效,请先登录",duration:3500}),o.go("login")):r.showToast(t.message)})):(e.showAlertCheck=!1,e.showAlert=!1,i.check(e.applyInfo.hrCode).success(function(t,s,n,a){t?i.applySubmit(e.mid,e.applyInfo.storeName,e.applyInfo.ownerName,e.adrProvinceId,e.adrCityId,e.adrAreaId,e.adrStreetId,e.addressName,e.applyInfo.address,e.selectValue,e.selectText,e.applyInfo.promotionCode,!1,e.storeCode,e.storeType,e.applyInfo.hrCode).success(function(t){t.success?(e.isBuyer=1,c.setRole(e.isBuyer),o.go("shopApplySuccess",{totalCommission:t.data.totalCommission,memberCount:t.data.memberCount,memberRegionCount:t.data.memberRegionCount})):r.showToast(t.message)}):e.showAlertCheck=!0})):r.showToast("请选择联盟分类！"):e.showAlert=!0:r.showToast("店铺名字为1～20的常用字符！"):r.showToast("详细地址为2～50的常用字符！"):r.showToast("店主姓名为1～20的常用字符！"))):void r.showToast("店铺名称必须填写！"):void r.showToast("详细地址必须填写！"):void r.showToast("店主姓名必须填写！")},e.clearInput=function(){e.applyInfo.ownerName=void 0,e.applyInfo.address=void 0,e.applyInfo.storeName=void 0,e.promotionCode||(e.applyInfo.promotionCode=""),e.addressName="",e.applyInfo.hrCode=void 0,e.selectText=void 0},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(t,i){if(e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&f.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.promotionCode=u.promotionCode,l.isUserLogin()){if(1==c.getRole())return p.show({template:"您已经是店主了,进店看看吧",duration:2500}),void g(function(){},2e3).then(function(){o.go("shop")});e.init()}else e.init();"back"==i.direction||e.clearInput(),e.addressInit(e.dataAdd,e.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.controller("ShopApplySuccessController",["trueAuthenticationService","$scope","$stateParams","ShopApplySuccessService","$ionicHistory","$state",function(e,t,o,i,s,n){t.$on("$ionicView.beforeEnter",function(){var o=s.viewHistory().histories.root;-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),i.getShopData().success(function(e){e.success?(t.memberCount=e.data.openStoreRank,"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr2","ownerregist","1"])):t.memberCount=888888}),t.isOrNoGoHomePage=function(){"register"==o.stack[o.stack.length-3].stateName?n.go("homePage"):s.goBack(-2)},e.doInit().success(function(e){e.success?t.isNotAuthentication=e.data.isAuth:t.isNotAuthentication=!0}),t.goToAuthentication=function(){n.go("trueAuthenticationList",{type:2})}})}]),APP.service("ShopApplySuccessService",["$http","UrlService",function(e,t){this.getShopData=function(){return e.post(t.getUrl("SHOP_APPLY_SUCCESS"))}}]),APP.controller("CustomizehdController",["$scope","$stateParams","$ionicHistory","$rootScope","$state",function(e,t,o,i,s){e.imgUrl=t.url,e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},e.goBack=function(){"advertisement"==i.fromState?s.go("homePage"):e.goBackFlag&&(e.goBackFlag=!1,o.goBack())},e.$on("$ionicView.beforeEnter",function(o,i){e.goBackFlag=!0,e.imgUrl=t.url})}]),APP.controller("AboutUsController",["$scope","$rootScope",function(e,t){var o=window.cordova&&-1!=ionic.Platform.platform().indexOf("ios");e.versionShow=o?"版本V"+t.globalConstant.versionIOS:"版本V"+t.globalConstant.versionANDROID,e.softwareUpdate=function(){}}]),APP.controller("CollectionController",["$rootScope","$scope","CollectionService","$timeout","UserService","GoodsService","CommonAddressService","HomePageService",function($rootScope,$scope,CollectionService,$timeout,UserService,GoodsService,CommonAddressService,HomePageService){function getCollectionProduct(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,CollectionService.showCollection(provinceId,cityId,districtId,streetId).success(function(e,t,o,i){e.success&&($scope.items=e.data.productsList)})}else alert("获取收藏失败")}).error(function(e){var t=CommonAddressService.getAddressInfo();CollectionService.showCollection(t.provinceId,t.cityId,t.areaId,t.streetId).success(function(e,t,o,i){e.success&&($scope.items=e.data.productsList)})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}function getCollectionStoreList(){GoodsService.getAddress().success(function(response){if(response.success){var addr=eval(response.data);provinceId=addr[0].provinceId,cityId=addr[0].cityId,districtId=addr[0].areaId,streetId=addr[0].streetId,$scope.streetId=streetId,CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,i){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})
}else alert("获取收藏失败")}).error(function(e){CommonAddressService.getAddressInfo();CollectionService.getStoreCollection($scope.storePage,$scope.storePageSize).success(function(e,t,o,i){e.success&&($scope.items=$scope.items.concat(e.data),$scope.items.length<e.totalCount?$scope.hasMore=!0:$scope.hasMore=!1)})})}$scope.items=[],$scope.typeArr=["商品","店铺/场馆"],$scope.updateResult=!0,$scope.updateContent="",$scope.storeId=UserService.getUser().mid,$scope.flagNum=!1,$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png";var provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.init=function(){$scope.collectionType="product",$scope.storePage=1,$scope.storePageSize=5,$scope.hasMore=!1,$scope.items=[],getCollectionProduct()},$scope.loadMore=function(){$scope.storePage+=1,getCollectionStoreList()},$scope.checkType=function(e){0==e?($scope.collectionType="product",getCollectionProduct(),$(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px")):($scope.collectionType="store",$scope.items=[],getCollectionStoreList(),$(".collection_type>div:nth-child(2)").css("color","#2979FF"),$(".collection_type>div:nth-child(2) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(1)").css("color","#666666"),$(".collection_type>div:nth-child(1) div").css("borderBottom","0px"))},$scope.$on("$ionicView.beforeEnter",function(e,t){"back"==t.direction?$scope.direction="back":($scope.storeId=UserService.getUser().mid,$scope.direction="forword",$scope.init())}),$scope.$on("$ionicView.enter",function(){"back"==$scope.direction||($(".collection_type>div:nth-child(1)").css("color","#2979FF"),$(".collection_type>div:nth-child(1) div").css("borderBottom","2px solid #2979FF"),$(".collection_type>div:nth-child(2)").css("color","#666666"),$(".collection_type>div:nth-child(2) div").css("borderBottom","0px"))}),$scope.delete=function(e){CollectionService.deleteCollection($scope.items[e].productId).success(function(e,t,o,i){e.success?($scope.showResult("删除成功"),$scope.init()):$scope.showResult("删除失败")})},$scope.showResult=function(e){$scope.updateContent=e,$scope.updateResult=!1,$timeout(function(){$scope.updateResult=!0},1e3)}}]),APP.service("CollectionService",["$http","UrlService",function(e,t){this.showCollection=function(o,i,s,n){var a={provinceId:o,cityId:i,districtId:s,streetId:n};return e.get(t.getUrl("COLLECTION_LIST"),a)},this.deleteCollection=function(o){var i={productId:o};return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),params:i})},this.getStoreCollection=function(o,i){var s={page:o,pageSize:i};return e.get(t.getUrl("STORE_COLLECTIONLIST"),s)}}]),APP.controller("FeedbackPlusController",["$scope","$state","FeedbackPlusService","PopupService","$ionicActionSheet","AssessService","UserService",function(e,t,o,i,s,n,a){function r(){e.feedbackType=6,e.canCommit=!1,e.feedback={content:"",phoneNumber:""},e.imageCount=0;for(var t=0;t<3;t++)e.imageList[t]="",d[t]=""}function c(t){e.$apply(function(){for(var o=0;o<3;o++)if(!e.imageList[o]){e.imageList[o]=t;break}e.imageCount++});var o=function(e){for(var t=JSON.parse(e.response),o=0;o<3;o++)if(!d[o]){d[o]=t.urls;break}},i=function(e){},s=new FileUploadOptions,r=new Date,c=r.getTime();s.fileKey="imageFile",s.fileName=a.getUser.userName+c,s.mimeType="image/jpeg",(new FileTransfer).upload(t,encodeURI(n.uploadImage()),o,i,s)}function l(e){}e.feedback={content:"",phoneNumber:""},e.feedbackType=6,e.imageCount=0,e.imageList=["","",""];var d=["","",""];e.canCommit=!1,e.checkLength=function(){setTimeout(function(){e.$apply(function(){e.feedback.content.length>=500&&(e.feedback.content=e.feedback.content.substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)},e.changeType=function(t){e.feedbackType=t},e.addImage=function(){window.cordova&&s.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(c,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),d.splice(t,1),e.imageCount--},e.phoneCheck=function(){},e.submitFeedback=function(){if(e.feedback.phoneNumber&&!e.globalConstant.mobileNumberRegExp.test(e.feedback.phoneNumber))return void i.showToast("请输入正确的手机号码！");var s={site:"mstore",type:e.feedbackType,content:e.feedback.content,contact:e.feedback.phoneNumber,file:d[0]?d[0]:"",file1:d[1]?d[1]:"",file2:d[2]?d[2]:""};o.commitFeedback(s).success(function(e){e.success&&(i.showToast("提交成功！"),setTimeout(function(){t.go("Setup")},2017))})},e.$watch("feedback.content",function(t,o){setTimeout(function(){e.$apply(function(){t.length>=500&&(e.feedback.content=t.toString().substr(0,500)),e.canCommit=e.feedback.content.length>0})},0)}),e.$on("$ionicView.beforeEnter",function(){r()})}]),APP.service("FeedbackPlusService",["$http","UrlService",function(e,t){this.commitFeedback=function(o){return e({method:"POST",url:t.getUrl("FEEDBACK_PLUS"),params:o})}}]),APP.controller("MineController",["$scope","$timeout","UserService","ShopService","PlatformService","MESSAGECENTERService","CreditService","$state",function(e,t,o,i,s,n,a,r){e.tabNav="mine",e.account="",e.flagNum=!1,e.goMemberCenter=function(){a.getGameId(function(e){r.go("vip",{gameId:e})})},e.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==s.getPlatform()?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},e.init=function(){i.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1});for(var t=[],s=0;s<o.getUser().userName.length;s++)t[s]=s>=3&&s<=6?"*":o.getUser().userName[s];e.account="";for(var n=0;n<t.length;n++)e.account=e.account+t[n];e.account.length>20&&(e.account=e.account.slice(0,20)+"..."),e.accreditation="海尔官方认证"},e.$on("$ionicView.beforeEnter",function(){e.init(),n.unreadMessage()})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){}]),APP.controller("PersonalCenterController",["trueAuthenticationService","$localstorage","$rootScope","RegisterService","HomePageService","OrderManageService","$http","UrlService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","PersonalCenterService","$state","WhiteShowsService","PopupService","ProductDetailService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){u.storeId=g.getUser().mid,u.flagNum=!1,u.user=g.getUser(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?u.isIosApp=!0:u.isIosApp=!1,u.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],u.gotoSecondPage=function(e,t){f.go("orderManage",{orderFlag:e,orderType:t})},u.goOrderManage=function(e,t){f.go("orderManage",{orderFlag:e,orderStatus:t})},u.goMemberCenter=function(){l.getGameId(function(e){f.go("vip",{gameId:e})})},u.goToMyStore=function(){1==u.isHost&&f.go("myStore",{storeId:u.storeId})},u.goLearningHaier=function(){m.learningHaier().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"海尔大学"):window.location.href=t}else f.go("login")})},u.goToManageMoney=function(e){1==e?f.go("financialMoney",{whereId:"personnalCenter"}):0==e?i.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):v.showToast("服务端错误")}).error(function(){alert("网络错误")}):f.go("login")},u.toApplyForWhite=function(){h.queryIousStatus({userId:g.getUser().ucId,token:g.getUser().accessToken}).success(function(e){e.success&&(2==e.data.applyStatus||3==e.data.applyStatus?f.go("applyForWhite"):h.applyForOpen({backUrl:window.location.href,userId:g.getUser().ucId,token:g.getUser().accessToken}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}))})},u.customerServe=function(){if(window.cordova){var e=ionic.Platform.isAndroid(),o=null;o=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&p(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else u.kfTocken=t.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+u.kfTocken);return},u.goNewHand=function(){var e=r.getHead()+"mstore/sg/helpDetail.html?id=613";window.emc?window.emc.presentH5View(e,"新手必读"):window.location.href=e},u.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},t=function(e){function t(e){u.avatarImage=e,p(function(){u.avatarImage=e},200);var t=function(e){$ionicLoading.hide(),v.showToast("上传成功");var t=JSON.parse(e.response);u.avatarImage=t.data.avatarImageFileId,u.user.avatarImageFileId=u.avatarImage,g.setUser(u.user)},o=function(e){$ionicLoading.hide(),v.showToast("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=u.avatarImage.substr(u.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var s={};i.params=s,(new FileTransfer).upload(u.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,i);var n={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(n)}function o(e){}function i(e){u.avatarImage=e,p(function(){u.avatarImage=e},200);var t=function(e){v.showToast("上传成功"),$ionicLoading.hide();var t=JSON.parse(e.response);u.avatarImage=t.data.avatarImageFileId,u.user.avatarImageFileId=u.avatarImage,g.setUser(u.user)},o=function(e){v.showToast("上传失败"),$ionicLoading.hide()},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName=u.avatarImage.substr(u.avatarImage.lastIndexOf("/")+1),i.mimeType="image/jpeg";var s={};i.params=s,(new FileTransfer).upload(u.avatarImage,encodeURI(AccountMessageService.uploadImage()),t,o,i);var n={template:'<div style="background:#fff;border-radius:4px;"><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};$ionicLoading.show(n)}function s(e){}1==e?navigator.camera.getPicture(t,o,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,t),p(function(){window.plugins.actionsheet.hide()},5e3)}else $ionicPopup.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},u.checkPhoneNumber=function(){i.wdApply().success(function(e){e.success?e.data?f.go("newAuthenticationHome"):f.go("registerForStore",{hasHistory:1}):v.showToast("服务端错误")}).error(function(){alert("网络错误")})},u.init=function(){e.doInit().success(function(e){e.success&&(e.data.isAuthByOne?u.changeOpacity={opacity:"1"}:u.changeOpacity={opacity:"0.5"})}),S.getCartNum().success(function(e){e.success&&(o.BottomCartNum=e.data)}),s.isWdHost().success(function(e){o.isWdHost=e.data.isHost,null==e.data.o2o||1==e.data.o2o?u.iso2o=!0:u.iso2o=!1}),s.getUnReadMsg().success(function(e){e.data>0?u.flagNum=!0:u.flagNum=!1}),m.personalInit().success(function(e){u.isHost=e.data.isHost,u.storeName=e.data.storeName,u.card=e.data.card,u.level=e.data.level,u.nowLevelName=u.levelArr[u.level-1],11!=u.level&&(u.nextLevelName=u.levelArr[u.level]),u.revenue=e.data.revenue,u.coupon=e.data.coupon,u.gold=e.data.gold,u.card=e.data.card}),n.getOrderAmount().success(function(e){e.success&&(u.orderAmountData=e.data)}),l.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),o={gameId:e,withLevelPath:!0};a.get(t,o).success(function(e){if(e.success){u.order=e.data.userCreditWithLevel.order,u.levelGrowArr=e.data.levels;u.levelGrowArr[e.data.userCreditWithLevel.order]&&(u.levelUpExp=u.levelGrowArr[e.data.userCreditWithLevel.order].creditNum-e.data.userCreditWithLevel.totalCreditNum,u.levelUpExp<0&&(u.levelUpExp=0)),u.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,u.creditNum=e.data.userCreditWithLevel.totalCreditNum}})}),m.personalApply().success(function(e){e.success&&(e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2),u.applyName=e.data.name,u.applyStatus=e.data.status)}),d.getMessage().success(function(e){e.success&&(m.userMemberId=e.data.memberId)})},u.$on("$ionicView.beforeEnter",function(){u.avatarImage=g.getUser().avatarImageFileId,u.storeId=g.getUser().mid,u.user=g.getUser(),u.tabNav="personnalCenter",u.init()})}]),APP.service("PersonalCenterService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.personalApply=function(o){var i=t.getUrl("GET_APPLY_MENGZHU");return e.get(i,o)},this.userMemberId="",this.learningHaier=function(){return e.get(t.getNewUrl("GET_learningHaier"))}}]),APP.controller("SetupController",["$ionicPopup","AccountMessageService","$rootScope","$scope","PlatformService","LoginService","UserService","$state","$localstorage","IMService",function(e,t,o,i,s,n,a,r,c,l){i.goToScore=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"APP"==s.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357"):e.indexOf("iPhone")>-1?"APP"==s.getPlatform()?cordova.InAppBrowser.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8","_system","location=yes"):window.open("https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8"):"APP"==s.getPlatform()?cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"):window.open("http://app.qq.com/#id=detail&appid=1104761357")},i.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},i.switchOff={background:"#fff","border-color":"#e6e6e6"},i.borderBottom={"margin-bottom":"3px"},i.switchState=function(e){i.settingsList[e].checked=!i.settingsList[e].checked;for(var t=JSON.parse(localStorage.getItem("setSwitch")),s=t.length-1;s>=0;s--)i.memberId==t[s].id&&(t[s].list[e].checked=i.settingsList[e].checked,localStorage.setItem("setSwitch",JSON.stringify(t)));switch(e){case 0:o.isCommission=i.settingsList[e].checked;break;case 1:o.cashSwitch=i.settingsList[e].checked;break;case 2:o.goldRainSwitch=i.settingsList[e].checked}},i.init=function(){i.memberId=a.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==i.memberId&&(i.settingsList=e[t].list,!0)},i.goGuidePage=function(){r.go("guidePage")},i.user=a.getUser(),i.accountToken=i.user.token,i.accountSessionId=i.user.sessionValue,i.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",i.unload=function(){l.destroyWebSocket(),void 0==i.user.sessionValue?(a.clearUser(),i.goGuidePage(),n.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),c.set("storeId","")):t.unloadAccount(i.accountToken,i.accountSessionId,i.accountHeaderKey).success(function(e,t,o,s){e.success&&(a.clearUser(),i.goGuidePage(),n.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),c.set("storeId",""))})},i.goToDelete=function(){e.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&i.unload()})},i.$on("$ionicView.enter",function(){i.init()})}]),APP.controller("ShoppingCarController",["$scope",function(e){}]),APP.controller("accsafeCtrl",["$scope","accsafeService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.accountMessage="",e.accountEmail="",e.accountNumber="",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=a.getUser(),e.accountMessage=e.user.userName,e.accountEmail=e.user.email,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,a.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){i.go("guidePage")},o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,a.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){i.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("accsafeService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("accsettingCtrl",["AccountMessageService","$scope","accsettingService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(e){var o=e[0];if(window.FileReader){var i=new FileReader;i.readAsDataURL(o),i.onloadend=function(e){t.$apply(t.iconImage=e.target.result)}}}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIosApp=!0:t.isIosApp=!1,t.isPhone=!!window.cordova,t.userInfo={picTempFile:""},t.user={},t.sexMap=["保密","男","女"],t.accountMessage="",t.accountName="",t.accountSexValue="0",t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday="",t.iconImage=i.imgBaseURL+"img/ic_login_user.png",t.accountToken="",t.accountSessionId="",t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.updateResult=!0,t.updateContent="",t.init=function(){t.user=r.getUser(),t.sexMap=["保密","男","女"],void 0!=t.user.avatarImageFileId&&(t.iconImage=t.user.avatarImageFileId),t.accountMessage=t.user.userName,t.accountName=t.user.nickName,t.accountSexValue=t.user.gender,t.accountSex=t.sexMap[t.accountSexValue],t.accountBirthday=t.user.birthday,t.accountToken=t.user.token,t.accountSessionId=t.user.sessionValue,t.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",t.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(t.accountNumber)||(t.showMobile=!1)},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goGuidePage=function(){s.go("guidePage")},t.changeIcon=function(){if("APP"==l.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(o){function i(o){t.iconImage=o,a(function(){t.iconImage=o},200);var i=function(e){c.hide(),t.showResult("上传成功");var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,r.setUser(t.user)},s=function(e){c.hide(),t.showResult("上传失败")},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var l={};n.params=l,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),i,s,n);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};c.show(d)}function s(e){}function n(o){t.iconImage=o,a(function(){t.iconImage=o},200);var i=function(e){t.showResult("上传成功"),c.hide();var o=JSON.parse(e.response);t.iconImage=o.data.avatarImageFileId,t.user.avatarImageFileId=t.iconImage,r.setUser(t.user)},s=function(e){t.showResult("上传失败"),c.hide()},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.iconImage.substr(t.iconImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var l={};n.params=l,(new FileTransfer).upload(t.iconImage,encodeURI(e.uploadImage()),i,s,n);var d={template:'<div><img src="img/ic_refresh_01.gif" style="width: 65px;"/></div>'};c.show(d)}function l(e){}1==o?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(n,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,i),a(function(){window.plugins.actionsheet.hide()},5e3)}else{u.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},t.$watch("userInfo.picTempFile",function(){t.userInfo&&t.userInfo.picTempFile&&t.userInfo.picTempFile.length>0&&m(t.userInfo.picTempFile)},!1),t.unload=function(){void 0==t.user.sessionValue?(r.clearUser(),t.goGuidePage(),p.setRole(void 0),window.localStorage.setItem("isLogin",r.isUserLogin()),g.set("storeId","")):e.unloadAccount(t.accountToken,t.accountSessionId,t.accountHeaderKey).success(function(e,o,i,s){e.success&&(r.clearUser(),t.goGuidePage(),p.setRole(void 0),window.localStorage.setItem("isLogin",r.isUserLogin()),g.set("storeId",""))})},t.goToDelete=function(){u.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(e){e&&t.unload()})},t.selectDate=function(){if("APP"==l.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){a(function(){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),e.changeMessage(t.accountMessage,n+"-"+s+"-"+i,t.accountSexValue,t.accountName).success(function(e,o,a,c){e.success?(t.accountBirthday=n+"-"+s+"-"+i,t.user.birthday=n+"-"+s+"-"+i,r.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s);var n=new Date(o).getFullYear()+"-"+i+"-"+s;e.changeMessage(t.accountMessage,n,t.accountSexValue,t.accountName).success(function(e,o,i,s){e.success?(t.accountBirthday=n,t.user.birthday=n,r.setUser(t.user),t.showResult("修改成功")):t.showResult("修改失败")})}};d.openDatePicker(i)}},i.$on("SELECT_SEX",function(e,o){t.accountSexValue=o,t.accountSex=t.sexMap[t.accountSexValue],t.user.gender=o,r.setUser(t.user),t.showResult("修改成功")}),i.$on("CHANGE_NAME",function(e,o){t.accountName=o,t.user.nickName=o,r.setUser(t.user),t.showResult("修改成功")}),t.goBack=function(){s.go("personnalCenter")},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,a(function(){t.updateResult=!0},1e3)}}]),APP.service("accsettingService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,i,s){var n=o,a="Bearer "+s+" "+n,r={Authorization:a},c={sessionId:i};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("CompetitionController",["$scope","$ionicHistory","MemberCompleteService","PopupService","CreditService","UrlService","$state","$stateParams","$http","InAppBrowserService","$ionicSlideBoxDelegate","$location","$rootScope",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(e,t,o,i){for(;;){var s,n=!1;s=i?(e+(t-e-e)*Math.random()).toFixed(2):Math.ceil(e+(t-e-e)*Math.random());for(var a=0;a<o.length;a++)if(s===o[a]){n=!0;break}if(n||o.push(s),o.length===S)break}}function m(e,t){for(var o,i,s=e.slice(0),n=e.length,a=n-t;n-- >a;)i=Math.floor((n+1)*Math.random()),o=s[i],s[i]=s[n],s[n]=o;return s.slice(a)}var f=r.taskDestId;e.taskType=r.taskType,e.xyzMemberId=r.memberId;var h=["赵","钱","孙","李","周","吴","郑","王","冯","陈","褚","卫","蒋","沈","韩","杨","朱","秦","尤","许","何","吕","施","张","孔","曹","严","华","金","魏","陶","姜","戚","谢","邹","喻","柏","水","窦","章","苏","潘","葛","奚","范","彭","郎","鲁","韦","昌","马","苗","凤","花","方","俞","任","袁","柳","酆","鲍","史","唐","费","廉","岑","薛","雷","贺","倪","汤","滕","殷","罗","毕","郝","邬","安","常","乐","于","时","傅","皮","卞","齐","康","伍","余","元","卜","顾","孟","平","黄","和","穆","萧","尹","姚","邵","湛","汪","祁","毛","禹","狄","米","贝","明","臧","计","伏","成","戴","谈","宋","茅","庞","熊","纪","舒","屈","项","祝","董","梁","杜","阮","蓝","闵","席","季","麻","强","贾","路","娄","危","江","童","颜","郭","梅","盛","林","刁","钟","徐","邱","骆","高","夏","蔡","田","樊","胡","凌","霍","虞","万","支","柯","昝","管","卢","莫","经","房","裘","缪","干","解","应","宗","丁","宣","贲","邓","郁","单","杭","洪","包","诸","左","石","崔","吉","钮","龚","程","嵇","邢","滑","裴","陆","荣","翁","荀","羊","於","惠","甄","麴","家","封","芮","羿","储","靳","汲","邴","糜","松","井","段","富","巫","乌","焦","巴","弓","牧","隗","山","谷","车","侯","宓","蓬","全","郗","班","仰","秋","仲","伊","宫","宁","仇","栾","暴","甘","钭","厉","戎","祖","武","符","刘","景","詹","束","龙","叶","幸","司","韶","郜","黎","蓟","薄","印","宿","白","怀","蒲","邰","从","鄂","索","咸","籍","赖","卓","蔺","屠","蒙","池","乔","阴","郁","胥","能","苍","双","闻","莘","党","翟","谭","贡","劳","逄","姬","申","扶","堵","冉","宰","郦","雍","舄","璩","桑","桂","濮","牛","寿","通","边","扈","燕","冀","郏","浦","尚","农","温","别","庄","晏","柴","瞿","阎","充","慕","连","茹","习","宦","艾","鱼","容","向","古","易","慎","戈","廖","庾","终","暨","居","衡","步","都","耿","满","弘","匡","国","文","寇","广","禄","阙","东","殴","殳","沃","利","蔚","越","夔","隆","师","巩","厍","聂","晁","勾","敖","融","冷","訾","辛","阚","那","简","饶","空","曾","毋","沙","乜","养","鞠","须","丰","巢","关","蒯","相","查","後","荆","红","游","竺","权","逯","盖","益","桓","公","万",,"俟","司马","上官","欧阳","夏侯","诸葛","闻人","东方","赫连","皇甫","尉迟","公羊","澹台","公冶","宗政","濮阳","淳于","单于","太叔","申屠","公孙","仲孙","轩辕","令狐","钟离","宇文","长孙","慕容","鲜于","闾丘","司徒","司空","亓官","司寇","仉","督","子车","颛孙","端木","巫马","公西","漆雕","乐正","壤驷","公良","拓跋","夹谷","宰父","谷梁","晋","楚","闫","法","汝","鄢","涂","钦","段干","百里","东郭","南门","呼延","归","海","羊舌","微生","岳","帅","缑","亢","况","后","有","琴","梁丘","左丘","东门","西门","商","牟","佘","佴","伯","赏","南宫","墨","哈","谯","笪","年","爱","阳","佟","第五","言","福"],v=["奕柯","消沉","天乐","维妙","峻","哲","晓培","益申","莹莹","占宇","雨","凌昕","婉婷","建雄","小文","小冉","子安","老杰","胖胖","文","剑","霖","锰","克谦","小仙","帅帅","逸","旭梅","萍","元雪","晓莉","明燕","九庆","留强","汝彬","台铭","帆","昆仑","万里","中锋","志伟","明汉","琴","珍美","明君","涛","文武","艳艳","小刚","霞","浩","志豪","军林","叶东","远青","伟军","明浩","佑军","盛露","少青","发祥","钟森","永发","运瑞","自珍","家宝","建联","迪","慧","盛锦","素素","生平","海峰","喧喧","文宏","景翔","子博","炳良","保胜","希玮","莱","宇佳","博飞","文诺","宸萧","萍","利","墨语","宇凡","方丰","景宝","乐新","康帅","睿继","温雁","呈远","运","恩","叶","涵琰","文文","杰宪","迪勋","颜悦","杭","彬","信","帅鸿","庭达","然","睿进","锦远","康飞","茂轩"];e.indexNum=0;var S=10;e.moneyRandoms=[],g(50,3e3,e.moneyRandoms,!0);e.timeRandoms=[],g(1,60,e.timeRandoms,!1);e.userImg=[],g(0,198,e.userImg,!1),e.userList=[],e.firstName=m(h,S),e.lastName=m(v,S),e.allName=[],function(t,o){for(var i=0;i<S;i++)e.allName.push(t[i]+""+o[i]);e.allName}(e.firstName,e.lastName);for(var I=0;I<S;I++)e.userList.push({src:p.imgBaseURL+"img/userImg/"+e.userImg[I]+".jpg",money:e.moneyRandoms[I],allName:e.allName[I],time:e.timeRandoms[I]});e.goBack=function(){t.goBack()},e.share=function(){window.cordova?e.showShare=!0:i.showAlert("只能在app分享","抱歉，只能在app分享")},e.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?l.open(n.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):a.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"22px",height:"66px"}:e.paddingtopClass={"padding-top":"6px",height:"50px"},e.copeText=function(t){window.cordova?(cordova.plugins.clipboard.copy(t),i.showToastShort("复制成功"),e.isShowCopyButton=!1):i.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var i=e.competition.storeName+"的综合竞争力指数",a="综合竞争力指数全球排名"+e.competition.userRank+"位颤抖吧人类",r=e.competition.avatarImageFileId,c=n.getShareLinkHeader()+"competition//"+e.taskType+"/"+e.xyzMemberId;window.umeng?0==t?window.umeng.shareToSina(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"微博").success(function(){}),s.shareSuccessCallback("微博")}):1==t?window.umeng.shareToWechatSession(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"微信").success(function(){}),s.shareSuccessCallback("微信")}):2==t?window.umeng.shareToWechatTimeline(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("朋友圈")}):3==t?window.umeng.shareToQQ(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("QQ")}):4==t?window.umeng.shareToQzone(i,a,r,c,0,null,function(){o.missionShare(e.taskType,f,"朋友圈").success(function(){}),s.shareSuccessCallback("QQ空间")}):5==t&&e.copeText(c):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){f=r.taskDestId,e.taskType=r.taskType,e.competition="",e.showShare=!1,e.xyzMemberId=r.memberId,e.gameId=r.gameId,e.storeId="";var t=(new Date).getTime();o.myComplete(e.xyzMemberId).success(function(o){e.competition=o.data,void 0==e.competition.myInCome&&(t=(new Date).getTime(),$.ajax({url:n.getUrl("BROKERAGE_SETTLEMENT"),data:{memberId:e.xyzMemberId},type:"post",dataType:"json",success:function(t){t.success&&t.data&&(e.competition.myInCome=t.data.totalBrokerageAmount,e.$apply())},error:function(){}})),e.storeId=o.data.memberId,e.userCurrentLevelId=o.data.order;for(var i=[[248,46,91],[172,123,171],[88,234,231],[217,226,109],[253,181,70],[248,115,60]],s=[["店铺单数",e.competition.ordersCount/1],["招募结识了",e.competition.partner/2],["进行评价",e.competition.accessCount/1],["分享",e.competition.sharesCount/50],["登录",e.competition.loginsCount/50],["社区互动",e.competition.comunityCount/30]],a=1,r=0;r<s.length;r++)s[r][1]>a&&(a=s[r][1]);var c=s.length,l=document.getElementById("radarMap"),d=document.getElementById("radarMapCanvas");null==d&&(d=document.createElement("canvas"),d.id="radarMapCanvas",l.appendChild(d));var u=.49*$(document).width(),p=402*u/370;d.style="position:relative;position: absolute;z-index: -1",d.width=u,d.height=p;var g=d.getContext("2d"),m=u,f=p,h=m/2,v=f/2,S=h-3,I=2*Math.PI/c;!function(e){e.save();for(var t=S/3,o=0;o<3;o++){e.beginPath();for(var s=t*(o+1),n=[],a=0;a<c;a++){var r=h+s*Math.cos(I*a-I/2),l=v+s*Math.sin(I*a-I/2);n.push([r,l])}for(var a=0;a<n.length;a++){e.beginPath(),e.moveTo(n[a][0],n[a][1]),e.lineTo(n[(a+1)%n.length][0],n[(a+1)%n.length][1]),e.closePath()
;var d=e.createLinearGradient(n[a][0],n[a][1],n[(a+1)%n.length][0],n[(a+1)%n.length][1]);d.addColorStop("0.2","rgba("+i[a].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+i[(a+1)%n.length].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.beginPath(),e.moveTo(n[n.length-1][0],n[n.length-1][1]),e.lineTo(n[0][0],n[0][1]),e.closePath();var d=e.createLinearGradient(n[n.length-1][0],n[n.length-1][1],n[0][0],n[0][1]);d.addColorStop("0.2","rgba("+i[n.length-1].join(",")+","+(o+1)*(1/3)+")"),d.addColorStop("0.8","rgba("+i[0].join(",")+","+(o+1)*(1/3)+")"),e.strokeStyle=d,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2),s=v+S*Math.sin(I*t-I/2);e.beginPath(),e.moveTo(h,v),e.lineTo(o,s);var n=e.createLinearGradient(o,s,h,v);n.addColorStop("0","rgba("+i[t].join(",")+",1)"),n.addColorStop("0.8","rgba("+i[t].join(",")+",0.2)"),e.strokeStyle=n,e.lineWidth=.5,e.stroke()}e.restore()}(g),function(e){e.save(),e.beginPath();for(var t=0;t<c;t++){var o=h+S*Math.cos(I*t-I/2)*s[t][1]*(100/a)/100,i=v+S*Math.sin(I*t-I/2)*s[t][1]*(100/a)/100;e.lineTo(o,i)}e.closePath(),e.lineWidth=.5,e.strokeStyle="rgba(167,241,224,1)",e.stroke(),e.fillStyle="rgba(255, 0, 0, 0.2)",e.fill(),e.restore()}(g)}).error(function(e){}),o.storeDetail(e.gameId).success(function(t){1==t.success&&(e.storeCreditWithLevel=t.data.storeCreditWithLevel,e.storeCreditWithLevel&&(e.storeCurrentLevelId=t.data.storeCreditWithLevel.order,e.starName=t.data.storeCreditWithLevel.name,e.levelArray=[],e.storeCurrentLevelId<=3?e.levelArray=[p.imgBaseURL+"img/StarLevel@2x.png"]:e.levelArray=[p.imgBaseURL+"img/Diamond@2x.png"]))}),d.update(),d.loop(!0),d.enableSlide(!1)}),e.foots=[{src:p.imgBaseURL+"img/touxiang@2x.png",name:"aaa",money:"1",time:10},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"bbb",money:"2",time:20},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"ccc",money:"3",time:30},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"ddd",money:"4",time:40},{src:p.imgBaseURL+"img/touxiang@2x.png",name:"eee",money:"5",time:50}]}]),APP.service("MemberCompleteService",["$http","UrlService",function(e,t){this.myComplete=function(o){var i={ownerId:o};return e.get(t.getUrl("MEMER_COMPETE"),i)},this.missionShare=function(o,i,s){var n={taskType:o,taskDestId:i,sharePlatform:s};return e.get(t.getUrl("MISSION_SHARE"),n)},this.storeDetail=function(o){var i=t.getUrl("SHUNGUANG_VIP");return e.get(i,o)}}]),APP.controller("CustomMadeController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,i,s,n,a){e.customMadeUrl=o.trustAsResourceUrl(t.customMadeUrl),e.close=function(){a.go("shop")}}]),APP.controller("goldRecordController",["$rootScope","$localstorage","$scope","$stateParams","$state","$ionicPopup","$timeout","$http","UrlService",function(e,t,o,i,s,n,a,r,c){function l(e){r.get(c.getUrl("CREDIT_DETAIL"),e).success(function(t){u=1,0==e.searchType?(o.name1=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore1=!1):o.hasmore1=!0):1==e.searchType?(o.name2=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore2=!1:o.hasmore2=!0):2==e.searchType&&(o.name3=t.data.rows,f=Math.ceil(t.data.total/t.data.pageSize),e.startIndex>=f?o.hasmore3=!1:o.hasmore3=!0)}).error(function(e){})}o.hasmore1=!1,o.hasmore2=!1,o.hasmore3=!1,o.name1="",o.name2="",o.name3="",o.flag=!1,o.a=!1,o.b=!0;var d=0,u=1,p=1,g=1,m=1,f="",h={searchType:d,startIndex:u,pageSize:9};o.storeId=t.get("storeId",e.globalConstant.storeId),l(h),o.loadMore1=function(){var e=o.name1;p+=1;var t={searchType:d,startIndex:p,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){0==t.searchType&&(o.name1=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore1=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){o.$broadcast("scroll.infiniteScrollComplete")})},o.loadMore2=function(){var e=o.name2;g+=1;var t={searchType:d,startIndex:g,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){1==t.searchType&&(o.name2=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore2=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.loadMore3=function(){var e=o.name3;m+=1;var t={searchType:d,startIndex:m,pageSize:9};r.get(c.getUrl("CREDIT_DETAIL"),t).success(function(i){2==t.searchType&&(o.name3=e.concat(i.data.rows),f=Math.ceil(i.data.total/i.data.pageSize),o.hasmore3=!(t.startIndex>=f),o.$broadcast("scroll.infiniteScrollComplete"))}).error(function(e){})},o.goBack=function(){o.$ionicGoBack()},o.show=function(){o.flag=!o.flag},o.showfalse=function(){o.flag=!1},o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={},o.$on("$ionicView.beforeEnter",function(){o.flag=!1}),o.showFlag1=function(){d=0,p=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag1=!0,o.flag2=!1,o.flag3=!1,o.myObj1={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj3={}},o.showFlag2=function(){d=1,g=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag2=!0,o.flag1=!1,o.flag3=!1,o.myObj2={background:"#2196F3",color:"#fff"},o.myObj1={},o.myObj3={}},o.showFlag3=function(){d=2,m=1,h={searchType:d,startIndex:u,pageSize:9},l(h),o.flag3=!0,o.flag1=!1,o.flag2=!1,o.myObj3={background:"#2196F3",color:"#fff"},o.myObj2={},o.myObj1={}}}]),APP.controller("myAppointmentController",["$ionicScrollDelegate","$interval","myAppointmentService","CalculateStrLength","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","HomePageService",function(e,t,o,i,t,s,n,a,r,c,l,d,u,p){function g(e,o){var i=o,s=t(function(){if(i)var o=n.data[e].purchaseEndTime-(new Date).getTime();else var o=n.data[e].purchaseStartTime-(new Date).getTime();if(o<0)if(i){n.data[e].hasOver=!0;for(var a=0,r=0;a<n.data.length&&n.data[a].hasOver;a++)r++;r==n.data.length&&(n.noData=!0),t.cancel(s)}else i=!0,n.data[e].hasBegan=!0,n.data[e].days=0,n.data[e].hours=0,n.data[e].minutes=0,n.data[e].seconds=0;else n.data[e].days=parseInt(o/864e5),n.data[e].hours=parseInt(o%864e5/36e5),n.data[e].minutes=parseInt(o%36e5/6e4),n.data[e].seconds=Math.floor(o%6e4/1e3)},1e3);n.intervalArr.push(s)}function m(e){for(var t=(new Date).getTime(),o=e.length,i=0;i<o;i++)e[i].hasOver=!1,e[i].purchaseStartTime>t?(e[i].hasBegan=!1,g(i,!1)):e[i].purchaseStartTime<(new Date).getTime()&&t<e[i].purchaseEndTime&&(e[i].hasBegan=!0,g(i,!0))}n.pageIndex=1,n.hasMore=!1,n.data=[],n.storeId=c.getUser().mid,n.flagNum=!1,n.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",n.goProductDetail=function(e){r.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:n.storeId})},n.init=function(){n.noData=!1,n.data=[],o.getMyAppointment(n.pageIndex).success(function(e){5==e.data.length?(n.hasMore=!0,n.data=n.data.concat(e.data),m(n.data)):e.data.length<5&&0!=e.data.length?(n.hasMore=!1,n.data=n.data.concat(e.data),m(n.data)):e.data&&0!=e.data.length||(n.noData=!0)}),p.getUnReadMsg().success(function(e){e.data>0?n.flagNum=!0:n.flagNum=!1})},n.loadMore=function(){n.pageIndex++,o.getMyAppointment(n.pageIndex).success(function(e){5==e.data.length?(n.hasMore=!0,m(e.data),n.data=n.data.concat(e.data)):e.data.length<5&&0!=e.data.length?(n.hasMore=!1,m(e.data),n.data=n.data.concat(e.data)):n.hasMore=!1})},n.$on("$ionicView.beforeLeave",function(e,o){for(var i=0,s=n.intervalArr.length;i<s;i++)t.cancel(n.intervalArr[i])}),n.$on("$ionicView.beforeEnter",function(t,o){e.scrollTop(),n.pageIndex=1,n.intervalArr=[],n.init()})}]),APP.service("myAppointmentService",["$http","UrlService",function(e,t){this.getMyAppointment=function(o){var i={pageIndex:o};return e.get(t.getNewUrl("MYAPPOINTMENT"),i)}}]),APP.controller("VipController",["CommonAddressService","ProductDetailService","$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","$ionicPopup","GameService","PopupService","$ionicHistory","$ionicModal","UserService","$http","CreditService","InAppBrowserService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){function I(e){var t=new Date(e),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();t.getHours(),t.getMinutes(),t.getSeconds();return o+"年"+i+"月"+s+"日"}function w(){d.getapplyDuozhu().success(function(e){if(e.success){o.memberId=e.data.memberId,o.teamLevelId=e.data.teamLevelId,o.applyName=e.data.name,o.teamName=e.data.name,o.applyTeamName=e.data.name,o.applyStatus=e.data.status,e.data.isVacancy?e.data.status=e.data.levelDownMonth==e.data.applyMonth?-3:2:void 0==e.data.status&&(e.data.status=-2);var t={"舵主":"duozhu@2x.png","盟主":"mengzhu@2x.png"},s=t[o.teamName],n={"-3":{text:"未通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("未通过","您本月不能申请！")}},"-2":{text:"申请",icon:i.imgBaseURL+"img/apply"+s,handler:function(){function e(e){var t=/[\ud800-\udbff][\udc00-\udfff]/g;return e=e.replace(t,"")}var t=o.applyDialog();o.fnClosePopup=function(){t.close()},o.mailIsError=!1,o.reasonIsError=!1,o.checkEmail=function(e){var t=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,i=t.test(e);o.mailIsError=!i},o.checkReason=function(t){t=e(t),o.reasonIsError=!t,o.reasonIsError&&(o.data.input2="")},o.fnExchangeGoods=function(){if(o.checkEmail(o.data.input1),!o.mailIsError){if(o.checkReason(o.data.input2),o.reasonIsError)return void(o.data.input2="");d.applyDuozhu({email:o.data.input1,applyReason:o.data.input2,teamLevelId:o.teamLevelId}).success(function(e,o,i,s){1==e.success?e.data&&u.showAlert("盟主舵主权益","申请成功"):u.showAlert("盟主舵主权益",e.message),t.close(),w()})}},o.lookLeaderRights=function(){u.showAlert("盟主舵主权益",o.LeaderRights)}}},"-1":{text:"未通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("未通过","您本月的申请被拒绝，下月继续努力！")}},0:{text:"已申请",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("已申请","您本月的申请已经提交，请等待工作人员审批！")}},1:{text:"已通过",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("已通过","您已经是"+e.data.name+"了！")}},2:{text:"不可申请",icon:i.imgBaseURL+"img/dis"+s,handler:function(){u.showAlert("盟主舵主权益",o.LeaderRights)}},3:{text:"盟主",icon:i.imgBaseURL+"img/meng@2x.png",handler:function(){u.showAlert("已通过","您已经是"+e.data.name+"了！")}}};o.applyText=n[""+e.data.status].text,o.applyIcon=n[""+e.data.status].icon,o.handler=n[""+e.data.status].handler}})}o.isShowMore=!1,o.isShowRule=!1,o.closeAll=function(){o.isShowMore=!1,o.isShowRule=!1},o.showMore=function(){o.isShowMore=!o.isShowMore},o.showRule=function(){o.isShowRule=!o.isShowRule},o.closeRule=function(){o.isShowRule=!1},o.applyDialog=function(){return l.show({cssclass:"leader-popup",template:"\n        <div class='apply-list popup-form'>\n          <div class = 'form-title' ng-show='teamName==\"盟主\"'>恭喜您获得申请盟主的资格！</div>\n          <div class = 'form-title' ng-show='teamName==\"舵主\"'>恭喜您获得申请舵主的资格！</div>\n          <div class='form-content'>\n           <div class='sub-title'>请填写申请理由，我们会尽快跟你联系</div>\n           <p class='input-name'>联系邮箱<span class='error' ng-show='mailIsError'>请填写正确邮箱</span></p>\n           <div class='input-area'><input type='text' placeholder='填写你的邮箱(必填)' ng-model='data.input1' ng-blur='checkEmail(data.input1)'></div>\n          </div>\n          <div class='form-content'>\n          <p class='input-name'>申请理由<span class='error' ng-show='reasonIsError'>请填写申请理由</span></p>\n           <div class='input-area'><textarea rows='3' ng-blur=\"checkReason(data.input2)\" cols='20' placeholder='填写你的申请理由(必填，不支持特殊字符、表情)' ng-model='data.input2'></textarea></div>\n          </div>\n          <div class='form-info'>\n            <span  ng-click='lookLeaderRights()'>点击查看更多舵主盟主权益</span>\n          </div>\n          <div class='form-button'>\n           <span class='left-btn' ng-click='fnClosePopup()' >再想想</span>\n           <span class='right-btn' ng-click='fnExchangeGoods()' >提交申请</span>\n          </div>\n        </div>\n      ",scope:o})},o.levelUp=function(e){l.alert({template:'<div style="font-size: 17px;color: #030303;letter-spacing: -0.41px;line-height: 26px;">'+e+"</div>",okText:"我知道啦"})},o.modal=void 0,o.gameId=s.gameId,o.levelMsg=s.msg,o.gameTitle,o.gameDesc,o.isShowForm=!1,o.startTime="",o.endTime="",o.hasBkgColor=!0;var y="http://www.ehaier.com/mstatic/wd/v2/img/sg.png";o.isAdmin=s.isAdmin,o.shareStoreId;var T=.2*window.innerWidth;o.gridHeight={height:T+"px"},o.gridHeightMiddle={height:2*T+8+"px"};var C=window.innerHeight,b=C-373+"px";o.contentHeight={height:b},o.addressTitle="配送至",o.dataAdd=null,o.flag="CHANGEADDRESS_LOCATION_GAME",o.defaultValue=null,o.level=0;var A={};o.addressInfo={},o.game={},o.prizeList=[],o.startP=0,o.endP=11,o.curP=void 0,o.timer=void 0,o.isRuning=!1;var P=330;o.showShare=!1,o.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(o.topBtnCss4IOS={top:"12px"}),o.$on("$ionicView.beforeEnter",function(){o.isShowMore=!1,o.isShowRule=!1,o.xyzMemberId=m.getUser().mid,o.shareStoreId=s.shareStoreId,o.isAdmin=s.isAdmin,o.memberId=m.getUser().mid,S.$getByHandle("gradeScroll").scrollBy(0,0),o.dataAdd=null,o.defaultValue=null,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.watch=o.$watch("finish",function(e,t){e&&S.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION_GAME",0),o.$on("$destroy",function(){o.addressModal.remove()}),o.init()}),o.init=function(){w(),o.prizeList=new Array(12),o.applyName="盟主",h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),s={gameId:e,withLevelPath:!0};-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},f.get(t,s).success(function(e){if(o.levelMsg&&o.levelUp(o.levelMsg),e.success){o.name=e.data.userCreditWithLevel.name,o.avatarImageFileId=m.getUser().avatarImageFileId?m.getUser().avatarImageFileId:e.data.avatarImageFileId,o.userCurrentLevelId=e.data.userCreditWithLevel.order,o.order=e.data.userCreditWithLevel.order,o.levelGrowArr=e.data.levels,o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum,o.creditNum=e.data.userCreditWithLevel.totalCreditNum,o.userRank=e.data.userCreditWithLevel.userRank,o.congratulationMsg="有"+o.userRank+"个小伙伴超过了你",0==o.userRank&&(o.congratulationMsg="恭喜你，你已经是天下第一了，继续保持哦！"),o.storeCreditWithLevel=e.data.storeCreditWithLevel,o.storeCreditWithLevel&&(o.storeCurrentLevelId=e.data.storeCreditWithLevel.order,o.storeName=e.data.storeCreditWithLevel.name,o.levelArray=[],o.storeCurrentLevelId<=3?o.levelArray=[i.imgBaseURL+"img/StarLevel@2x.png"]:o.levelArray=[i.imgBaseURL+"img/Diamond@2x.png"]),$("canvas:not('#radarMapCanvas')").remove(),$(".cur"+o.order).radialIndicator({barColor:"#8FB8FF",barWidth:2,initValue:0,roundCorner:!0,percentage:!1,displayNumber:!1});$(".cur"+o.order).data("radialIndicator").animate(100),o.scrollMainToTop()}})}),d.storeDetailInfo({memberId:o.memberId}).success(function(e){1==e.success&&(o.storeVipName=e.data.storeName,o.teamLevelName=e.data.teamLevelName,o.storeId=e.data.memberId)}),o.showQQ=!1,o.showWeChat=!1,window.umeng&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.startP=0,o.curP=void 0,d.gameInfo({gameId:o.gameId}).success(function(e){e.success?(o.prizeList=e.data.gameImg,o.partNum=e.data.partNum,o.game=e.data.game,o.chouCount=e.data.playTimes,o.startTime=I(1e3*o.game.beginTime),o.endTime=I(1e3*o.game.endTime),g.fromTemplateUrl("templates/common/CommonGame.html",{scope:o,animation:"slide-in-left"}).then(function(e){o.modal=e}),o.game.backgroundPic||(o.hasBkgColor=!1)):alert(e.message)}).error(function(){u.showMsg("网络错误")}),d.notapplyDuozhu().success(function(e){1==e.success&&(o.LeaderRights=e.data.description)})},o.scrollMainToTop=function(){o.order<8||8==o.order?S.$getByHandle("gradeScroll").scrollTo(133*(o.order-1),0):S.$getByHandle("gradeScroll").scrollTo(931,0)};var L,x,D,N,_=0,k=Math.floor(3*Math.random())+2;o.clickChou=function(){if(!o.isRuning){d.luckDraw({gameId:o.gameId,timeStamp:(new Date).getTime()}).success(function(e){if(e.success)o.chouResult=e.result,o.endP=e.result.postion-1,o.start(),h.getGameId(function(e){var t=r.getUrl("SHUNGUANG_VIP"),i={gameId:e};f.get(t,i).success(function(e){e.success&&(o.totalCreditNum=e.data.userCreditWithLevel.consumeCreditNum)})}),o.chouCount++;else if(e.message&&e.message.indexOf("抽奖次数")>-1)l.alert({template:e.message}),o.curP=void 0;else if(e.message&&e.message.indexOf("GAME")>-1)l.alert({template:"对不起，奖品已被抽光"}),o.curP=void 0;else if(e.message&&e.message.indexOf("未登录")>-1)o.curP=void 0,n.go("login");else{if(o.curP=void 0,"-100"==e.errorCode)return;l.alert({template:e.message})}}).error(function(e){u.showToast("网络错误")}),o.curP=0;var e=12*k+o.endP;L=5,x=4==k?15:10,D=4==k?e-15:e-10,N=4==k?e-10:e-5}},o.starsList=[{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"},{src:i.imgBaseURL+"img/whiteStar-Grade@2x.png"}],o.starsListLimit=6,o.showPopup=function(){o.data={input1:"",input2:""},o.handler&&o.handler.call()},o.start=function(){o.endP<0||o.endP>11||(o.isRuning=!0,o.timer=a(function(){if(_++,_>=L?P=100:_>=x?P=60:_>=D?P=100:_>=N&&(P=500),_>12*k&&o.curP===o.endP)return _=0,o.isRuning=!1,void o.showForm();o.curP<12?o.curP++:o.curP=0,o.start()},P))},o.openPic=function(){o.modal.show()},o.closePic=function(){o.modal.hide()},o.share=function(){if(window.device&&window.device.hasNewShare){if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void u.showToast("请先登录,再分享");if(o.isShowForm)return;o.showShare=!o.showShare}else{if(o.isAdmin&&1==o.isAdmin)return;if(!m.getUser().mid)return void u.showToast("请先登录,再分享");if(o.isShowForm)return;if(window.umeng){var e=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng.share("顺逛抽奖活动","给您推荐顺逛每日抽奖活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}},o.goBack=function(){o.isAdmin&&1==o.isAdmin||o.isShowForm||("advertisement"==i.fromState?n.go("homePage"):o.$ionicGoBack())},o.showForm=function(){o.isShowForm=!0},o.hideForm=function(){o.isShowForm=!1},o.confirmGameInfo=function(){if(!o.chouResult.consignee)return void l.alert({title:"提示",template:"收件人必须填写！"});if(!o.globalConstant.mobileNumberRegExp.test(o.chouResult.mobile))return void l.alert({title:"提示",template:"请输入正确的手机号！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.regionName)return void l.alert({title:"提示",template:"收件地区必须填写！"});if(!o.chouResult.address)return void l.alert({title:"提示",template:"地址必须填写！"});var e={gameId:o.chouResult.gameId,uuid:o.chouResult.uuid,prizeId:o.chouResult.gamePrizeId,consignee:o.chouResult.consignee,mobile:o.chouResult.mobile,address:o.chouResult.address,regionName:o.chouResult.regionName,isDefault:0,provinceId:o.chouResult.provinceId,cityId:o.chouResult.cityId,regionId:o.chouResult.regionId,streetId:o.chouResult.streetId};d.confirmGameInfo(e).success(function(e){e.success?(u.showToast("提交成功"),o.hideForm()):alert("提交失败")}).error(function(e){alert("网络错误")})},o.chouResult={gameId:189,backgroundPic:null,titleHidden:1,gameTitle:"游戏主题",activityPic:null,timeHidden:1,beginTime:1468208908,endTime:1469677709,activityDescHidden:1,activityDesc:"活动说明",image:"",winnerListId:292,prizeType:1,address:"1234575666",mobile:"13698541258",consignee:"哈哈哈",prizeName:"苹果7",regionName:"山东青岛城阳区",provinceId:16,cityId:173,regionId:2444,isClick:!0,postion:1},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},o.addressInit=function(e,i,s,n){if(o.addressTipFlag=!1,S.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=n,i){o.dataAdd=JSON.parse(i),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",t.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){u.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION_GAME",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1};var O=!1;o.goSelect=ionic.Utils.debounce(function(e,s){for(var n=0;n<o.nowLevelIndex.length;n++)n>o.nowLevel&&(o.nowLevelIndex[n]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var s=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=s.text,o.defaultValue["value"+o.level]=s.value,o.level>-2){-1==o.level&&(o.selectProvince=s.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=S.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel);var r=-1*o.level;o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(s.value,r).success(function(e){if(1==r){s.value}o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){u.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,S.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){u.showToast("获取地址信息失败！")})}}else if(o.level>-4)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,-3==o.level?(o.selectArea=s.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=S.$getByHandle("mainScroll").getScrollPosition().top):o.cityTop=S.$getByHandle("mainScroll").getScrollPosition().top,r=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,t.getLocationList(s.value,r).success(function(e){if(o.dataAdd=e.data,o.addressTipFlag=!1,2==r){s.value}var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){u.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,t.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),S.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){u.showToast("获取地址信息失败！")})};else{if(O)return;a(function(){O=!1},1500),i.$broadcast(o.flag,o.defaultValue),O=!0,o.closeAddressModal()}},300),i.$on("CHANGEADDRESS_LOCATION_GAME",function(e,t){o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.chouResult.provinceId=t["value-1"],o.chouResult.cityId=t["value-2"],o.chouResult.regionId=t["value-3"],o.chouResult.streetId=t["value-4"],o.chouResult.regionName=o.textOne+o.textTwo+o.textThree+o.textFour}),o.getPosition=function(){if("定位中···"!=i.globalConstant.autoPosition){A=e.getAddressInfo();var s=A.regionName+"/"+A.streetName;t.addAddress(A.provinceId,A.cityId,A.areaId,s,A.streetId).success(function(){var e={"text-1":A.provinceName,"text-2":A.cityName,"text-3":A.regionName,"text-4":A.streetName,"value-1":A.provinceId,"value-2":A.cityId,"value-3":A.areaId,"value-4":A.streetId};i.$broadcast(o.flag,e),o.addressModal.hide()})}},g.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),o.closeAddressModal=function(){o.addressModal.hide()},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t="给您推荐顺逛每日抽奖活动,不可错过哦!",i=y,s=r.getShareLinkHeader()+"game/"+o.gameId+"/"+m.getUser().mid+"/";window.umeng?(0==e?window.umeng.shareToSina("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback),h.qqShare()):4==e&&(window.umeng.shareToQzone("顺逛抽奖活动",t,i,s,0,null,h.shareSuccessCallback),h.qqShare()),5==e?o.copeText(s):h.successShare()):alert("umeng undefined 只能在app分享"),o.showShare=!1},o.toRules=function(){-1!=navigator.userAgent.indexOf("iPhone")?v.open(r.getHead()+"mstore/sg/helpDetail.html?id=609","金币（积分）说明").addEventListener("exit",function(e){}):n.go("helpDetail",{helpId:"609",content:"金币（积分）说明"})}}]),APP.service("GameService",["$http","UrlService",function(e,t){this.gameInfo=function(o){var i=t.getGameUrl("GAME_INFO");return e.get(i,o)},this.luckDraw=function(o){var i=t.getGameUrl("LOTTERY");return e.get(i,o)},this.confirmGameInfo=function(o){var i=t.getGameUrl("GAME_HAVE_PRIZE"),s="gameId="+o.gameId+"&uuid="+o.uuid+"&prizeId="+o.prizeId+"&consignee="+o.consignee+"&mobile="+o.mobile+"&address="+o.address+"&regionName="+o.regionName+"&isDefault="+o.isDefault+"&provinceId="+o.provinceId+"&cityId="+o.cityId+"&regionId="+o.regionId+"&streetId="+o.streetId;return e({method:"POST",url:i,data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.storeDetailInfo=function(o){var i=t.getUrl("GET_STORE_DETAIL");return e.get(i,o)},this.getapplyDuozhu=function(o){var i=t.getUrl("GET_APPLY_MENGZHU");return e.get(i,o)},this.applyDuozhu=function(o){var i=t.getUrl("APPLY_MENGZHU");return e({method:"POST",url:i,params:o})},this.notapplyDuozhu=function(o){var i=t.getUrl("APPLY_MENGZHU_NOT");return e.get(i,o)}}]),APP.controller("haierStaffControl",["trueAuthenticationService","$interval","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","haierStaffService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){g.captchaFlag=!0,g.paracont="获取验证码",g.isStaff=!1,g.isBtnShow=!1,g.isActiveTimer=!1,g.staffId="",g.obj={staffId:"",verification:""},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(g.paddingtopClass={"margin-top":"16px"},g.paddingtopClasscontent={top:"60px"}):(g.paddingtopClass={"margin-top":"0px"},g.paddingtopClasscontent={top:"44px"}),g.init=function(){e.doInit().success(function(e){e.success?null!=e.data.empInfo?(g.isStaff=!0,g.staffId=e.data.empInfo.empNo,f.getActiveIsStart().success(function(e){g.isActiveTimer=!!e})):(g.isStaff=!1,g.isActiveTimer=!1):o.showToast(e.message)})};g.$watch("obj",function(){/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)&&/^[0-9]{6}$/.test(g.obj.verification)?g.isBtnShow=!0:g.isBtnShow=!1},!0);g.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?a.open(n.getHead()+"mstore/sg/helpDetail.html?id="+e,t):m.go("helpDetail",{helpId:e,content:t})},g.goBack=function(){c.goBack()},g.submitStaffMsg=function(){var e=g.obj.staffId.toLowerCase();f.postStaffMsg(e,g.obj.verification).success(function(e){e.success&&null!=e.data?(o.showToast("海尔员工认证成功!"),f.getActiveIsStart().success(function(e){e?(g.init(),g.isActiveTimer=!0):(g.isActiveTimer=!1,m.go("trueAuthenticationList"))})):o.showToast(e.message)})};var S,I=void 0;g.getIdentifyCode=function(){if(g.captchaFlag)if(/^[a-zA-Z0-9]{8}$/.test(g.obj.staffId)){var e=g.obj.staffId.toLowerCase();f.doInit(e).success(function(e){e.success?(S=60,I=t(function(){S<=0?(t.cancel(I),I=void 0,S=60,g.paracont="重发验证码",g.captchaFlag=!0):(g.paracont=S+"秒后可重发",g.captchaFlag=!1,S--)},1e3,100)):o.showToast(e.message)})}else o.showToast("请输入正确的员工编号！")},g.goNewYearActive=function(){m.go("bannerTheme",{bannerId:n.getCPUrl("KMH_ID")})},g.$on("$ionicView.beforeEnter",function(){g.obj={staffId:"",verification:""},g.staffId="",g.captchaFlag=!0,S=60,g.paracont="获取验证码",t.cancel(I),g.init()})}]),APP.service("haierStaffService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={empNo:o};return e.get(t.getUrl("GET_HAIER_STAFF_MSG"),i)},this.postStaffMsg=function(o,i){var s={empNo:o,captcha:i};return e({method:"POST",url:t.getUrl("POST_HAIER_STAFF_MSG"),params:s})},this.getActiveIsStart=function(){return e.get(t.getGameUrl("IS_KAIMENHONG_AVAILABLE"))}}]),APP.controller("newAuthenticationHome",["GetStatisticInfoService","HomePageService","IMService","ADDADDRESSService","AccountMessageService","$localstorage","$scope","$rootScope","$state","ShopApplyService","MyStoreService","CommonAddressService","PopupService","LoginService","UserService","ShopService","$stateParams","$ionicLoading","$timeout","$ionicPopup","$ionicScrollDelegate","$ionicModal","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y){a.localStorage=window.localStorage,a.addressName="请选择",a.goToAddress=!1,a.categoryData=[],a.selectText="",a.selectKey="",a.isComplete=!1,a.isHasKey=!1,a.hrCodes=!1,a.promotionCode="",a.avatarImage="img/registerSuccess.png",a.userInfo={picTempFile:""};var T=window.innerHeight,C=T-373+"px";a.contentHeight={height:C},a.addressTitle="配送至",a.dataAdd=null,a.flag="SHOP_APPLY_ADDRESS",a.defaultValue=null,a.level=0;var b={};a.user={},a.mid=m.getUser().mid,a.init=function(){a.user=m.getUser(),void 0!=a.user.avatarImageFileId&&(a.avatarImage=a.user.avatarImageFileId),a.addressName="请选择",a.showAlert=!1,a.goToAddress?a.addressName=a.textOne+a.textTwo+a.textThree:a.addressName="",a.selectText=a.textUnion,a.applyInfo.category=a.selectText,a.selectText&&(a.infos=a.selectText.substring(0,4),"人人服务"==a.infos?a.hrCodes=!0:a.hrCodes=!1),a.selectValue=a.valueUnion,a.mid=m.getUser().mid,a.mid&&f.getStoreInfo(a.mid).success(function(e,t,o,i){e.success&&(a.storeCode=e.data.storeCode,a.storeType=e.data.storeType)})},a.applyInfo={ownerName:"",address:"",promotionCode:"",storeName:"",hrCode:"",num:0,arr:[],category:""},a.addressTop=function(){a.addressTipFlag=!1,a.provinceTop=0,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.addressModal.show(),a.dataAdd=null,a.defaultValue=null,a.selectProvince="",a.selectCity="",a.selectArea="",a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)},a.addressInit=function(e,t,o,i){if(a.addressTipFlag=!1,$.$getByHandle("mainScroll").scrollTop(),a.addressTitle="配送至",a.defaultValue=e?JSON.parse(e):{},a.level=i,t){a.dataAdd=JSON.parse(t),a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.arr=a.nowLevelIndex;for(var s=0;s<a.nowLevelIndex.length;s++)s>a.nowLevel&&(a.nowLevelIndex[s]=-1)}else a.finish=!1,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",d.getLocationList("",0).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,a.finish=!0,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel,a.applyInfo.num=a.nowLevel;for(var t=(JSON.stringify(a.defaultValue),JSON.stringify(a.dataAdd),
0);t<a.nowLevelIndex.length;t++)t>a.nowLevel&&(a.nowLevelIndex[t]=-1)}).error(function(e){p.showToast("获取地址信息失败！")})},a.bottomBorder={"border-bottom":"2px solid red"},a.provinceFlag=!1,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!1,a.cityDis=!1,a.areaDis=!1,a.provinceSel=function(){a.addressInit(null,null,"SHOP_APPLY_ADDRESS",0),a.selectCity="",a.selectArea="",a.provinceFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!1,a.areaDis=!1};var A=!1;a.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<a.nowLevelIndex.length;o++)o>a.nowLevel&&(a.nowLevelIndex[o]=-1);a.dataAdd="",a.nowLevelIndex[a.nowLevel]=e;var t=arguments[1],e=arguments[0];if(a.level=a.level-1,a.defaultValue["text"+a.level]=t.text,a.defaultValue["value"+a.level]=t.value,a.level>-2)-1==a.level&&(a.selectProvince=t.text,a.provinceIndex=e,a.provinceFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.provinceTop=$.$getByHandle("mainScroll").getScrollPosition().top,a.nowLevel=a.level,a.nowLevel=-1*a.nowLevel),ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,d.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),a.dataAdd=e.data,a.addressTipFlag=!1;var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.citySel=function(){a.level=a.levelArea,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",d.getLocationList(areaValueCity,1).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,-1),a.selectArea="",a.cityFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,$.$getByHandle("mainScroll").scrollTo(0,a.cityTop)}).error(function(e){p.showToast("获取地址信息失败！")})};else if(a.level>-4&&-3!=a.level)a.selectCity=a.defaultValue["text-2"],a.provinceFlag=!1,a.cityFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!1,a.cityTop=$.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,i.getLocationList(t.value,ah).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1,a.areaSel=function(){a.addressTip="正在获取地址信息...",a.addressTipFlag=!0,a.dataAdd="",a.level=a.levelArea,i.getLocationList(areaValue,2).success(function(e){a.dataAdd=e.data,a.addressTipFlag=!1;var t=JSON.stringify(a.defaultValue),o=JSON.stringify(a.dataAdd);a.addressInit(t,o,a.flag,a.level),$.$getByHandle("mainScroll").scrollTo(0,a.areaTop),a.areaFlag=!0,a.selectFlag=!1,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0}).error(function(e){p.showToast("获取地址信息失败！")})};else if(-3==a.level)a.addressModal.hide(),a.regionTrue=!0,a.textOne=a.defaultValue["text-1"],a.textTwo=a.defaultValue["text-2"],a.textThree=a.defaultValue["text-3"],a.adrProvinceId=a.defaultValue["value-1"],a.adrCityId=a.defaultValue["value-2"],a.adrAreaId=a.defaultValue["value-3"],a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree,a.selectArea=t.text,a.cityFlag=!1,a.areaFlag=!1,a.selectFlag=!0,a.provinceDis=!0,a.cityDis=!0,a.areaDis=!0,a.areaTop=$.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*a.level,i.getLocationList(t.value,ah).success(function(e){a.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var o=JSON.stringify(a.defaultValue),i=JSON.stringify(a.dataAdd);a.addressInit(o,i,a.flag,a.level)}).error(function(e){p.showToast("获取地址信息失败！")}),a.levelArea=a.level,a.levelArea=a.levelArea+1;else{if(A)return;S(function(){A=!1},1500),r.$broadcast(a.flag,a.defaultValue),A=!0,a.closeAddressModal()}},300),a.getPosition=function(){if("定位中···"!=r.globalConstant.autoPosition){b=u.getAddressInfo();var e=b.regionName+"/"+b.streetName;d.addAddress(b.provinceId,b.cityId,b.areaId,e,b.streetId).success(function(){var e={"text-1":b.provinceName,"text-2":b.cityName,"text-3":b.regionName,"value-1":b.provinceId,"value-2":b.cityId,"value-3":b.areaId};r.$broadcast(a.flag,e),a.addressModal.hide()})}},w.fromTemplateUrl("templates/common/CommonLocation.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.addressModal=e}),a.closeAddressModal=function(){a.addressModal.hide()},a.$on("$destroy",function(){a.addressModal.remove()}),r.$on("SHOP_APPLY_ADDRESS",function(e,t){a.goToAddress=!0,a.textOne=t["text-1"],a.textTwo=t["text-2"],a.textThree=t["text-3"],a.adrProvinceId=t["value-1"],a.adrCityId=t["value-2"],a.adrAreaId=t["value-3"],a.addressName=a.textOne+a.textTwo+a.textThree}),r.$on("SHOP_APPLY_UNION",function(e,t){a.textUnion=t.text,a.valueUnion=t.value}),a.checkChange=function(e,t){l.checkText(e).success(function(o){o.data||""==e||("-100"!=o.errorCode&&p.showToast("请不要使用违禁词！"),1==t?a.applyInfo.ownerName="":a.applyInfo.storeName="")})},a.goCommonUnion=function(){"请选择"==a.addressName?p.showToast("请选择所在地区！"):c.go("commonUnion",{flag:"SHOP_APPLY_UNION"})};a.$watch("applyInfo",function(){a.applyInfo.storeName&&a.applyInfo.category?0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length?a.isComplete=!1:a.isComplete=!0:a.isComplete=!1},!0);a.goAuthentication=function(){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？%+_]");if(a.showAlert=!1,a.applyInfo.storeName.length<=1)p.showToast("店铺名字为2～20的常用字符！");else if(/[\ud800-\udbff][\udc00-\udfff]/g.test(a.applyInfo.storeName))p.showToast("亲，不可以使用表情喔!");else if(t.test(a.applyInfo.storeName))p.showToast("店铺名称不能包含特殊字符!");else if(0==a.addressName.length)p.showToast("请选择所在地区！");else if(a.selectText)if(/^(HR|hr|Hr|hR).{6,18}$/.test(a.applyInfo.hrCode)||"10"!=a.selectValue)if(0==a.promotionCode.length&&0==a.applyInfo.promotionCode.length)p.showToast("请填写推荐码!");else{a.xyzPromotionCode=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;var i={storeName:a.applyInfo.storeName,memberType:a.selectValue,provinceId:a.adrProvinceId,cityId:a.adrCityId,regionId:a.adrAreaId,regionName:a.addressName,address:a.applyInfo.address,promotionCode:a.applyInfo.promotionCode,hrCode:a.applyInfo.hrCode,isPromotionCode:a.promotionCode};n.setObject("newAuthentication_obj",i);var s=0==a.promotionCode.length?a.applyInfo.promotionCode:a.promotionCode;a.register_obj=n.getObject("register_obj"),a.register_obj.mobileNum!=a.iphoneNumber&&100==a.types?l.newShop(a.applyInfo.storeName,a.selectValue,s,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address,a.register_obj.mobileNum,a.register_obj.password,a.register_obj.captcha,a.register_obj.imgCaptcha).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?n.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):n.set("sg_login_token_secret","Bearer"+e.generateUUID())),o.initWebSocket(),S(function(){c.go("shopApplySuccess")},100)):p.showToast(t.message)}):l.applySubmitStore(a.memberId,a.applyInfo.storeName,a.selectValue,s,a.applyInfo.hrCode,a.adrProvinceId,a.adrCityId,a.adrAreaId,a.addressName,a.applyInfo.address).success(function(t){t.success?(null!=t.data.member&&(m.setUser(t.data.member),t.data.member.sessionValue?n.set("sg_login_token_secret","Bearer"+t.data.member.sessionValue):n.set("sg_login_token_secret","Bearer"+e.generateUUID())),S(function(){c.go("shopApplySuccess")},100)):p.showToast(t.message)})}else p.showToast("上岗证号必须为HR开头，总长度8-20位！");else p.showToast("请选择类别！")},a.getPromotionCode=function(){if(!(a.adrAreaId||"请选择"!=a.addressName||a.adrCityId||a.adrProvinceId))return void p.showToast("请选择地址");0!=a.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):0!=a.applyInfo.promotionCode.length?p.showToast("您已有推荐码，快快完成注册吧。"):l.getPromotion(a.adrAreaId).success(function(e){e.success?null!=e.data&&(a.applyInfo.promotionCode=e.data):p.showToast(e.message)})},a.isFocus=function(){a.isHasKey=!0},a.isBlur=function(){a.isHasKey=!1},a.isClear=function(){a.applyInfo.address="",a.isHasKey=!1},a.clearInput=function(){a.applyInfo.ownerName=void 0,a.applyInfo.address=void 0,a.applyInfo.storeName=void 0,a.addressName="请选择",a.applyInfo.hrCode=void 0,a.selectText="请选择"},a.$on("$ionicView.beforeLeave",function(e,t){a.watch()}),a.$on("$ionicView.beforeEnter",function(e,t){if(a.memberId=m.getUser().mid,a.iphoneNumber=m.getUser().mobile,a.dataAdd=null,a.defaultValue=null,a.hrCodes=!1,a.promotionCode=h.promotionCode,a.types=h.types,a.nowLevel=0,a.nowLevelIndex=[-1,-1,-1,-1],a.provinceTop=0,a.cityTop=0,a.areaTop=0,a.finish=!1,a.watch=a.$watch("finish",function(e,t){e&&$.$getByHandle("mainScroll").scrollTo(0,a.provinceTop)}),m.isUserLogin()){if(10==g.getRole())return v.show({template:"您已经是店主了,进店看看吧",duration:2500}),void S(function(){},2e3).then(function(){c.go("homePage")});a.init()}else a.init();"back"==t.direction?(void 0==a.selectValue&&(a.selectText="请选择"),a.addressName=a.textOne+" "+a.textTwo+" "+a.textThree):(a.clearInput(),a.applyInfo.storeName="",a.applyInfo.category="",a.applyInfo.promotionCode="",a.addressName="请选择",a.selectText="请选择"),a.addressInit(a.dataAdd,a.defaultValue,"SHOP_APPLY_ADDRESS",0)})}]),APP.service("ShopApplyService",["$http","UrlService","$window",function(e,t,o){this.applySubmit=function(o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){var S={memberId:o,storeName:i,memberRealName:s,provinceId:n,cityId:a,regionId:r,streetId:c,regionName:l,address:d,memberType:u,memberName:p,promotionCode:g,isReApply:m,storeCode:f,storeType:h,hrCode:v};return e({method:"POST",url:t.getUrl("SHOP_APPLY"),params:S})},this.checkPerfectInformation=function(o,i,s,n,a,r,c,l,d,u){var p={storeName:o,memberType:i,promotionCode:s,hrCode:n,provinceId:a,cityId:r,regionId:c,streetId:l,regionName:d,address:u};return e({method:"POST",url:t.getUrl("PERFECT_INFORMATION"),params:p})},this.checkText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_TEXT"),i)},this.check=function(o){var i={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),i)},this.getPromotion=function(o){var i={regionId:o};return e({method:"POST",url:t.getUrl("GET_PROMOTION_CODE"),params:i})},this.newShop=function(o,i,s,n,a,r,c,l,d,u,p,g,m){var f={storeName:o,memberType:i,promotionCode:s,hrCode:n,provinceId:a,cityId:r,regionId:c,regionName:l,address:d,mobileNum:u,password:encodeURIComponent(p),captcha:g,imgCaptcha:m};return e({method:"POST",url:t.getUrl("NEW_SHOP_STORE"),params:f})},this.applySubmitStore=function(o,i,s,n,a,r,c,l,d,u){var p={memberId:o,storeName:i,memberType:s,promotionCode:n,hrCode:a,provinceId:r,cityId:c,regionId:l,regionName:d,address:u};return e({method:"POST",url:t.getUrl("SHOP_STORE"),params:p})}}]),APP.controller("trueAuthenticationControl",["PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){u.isMake=!1,u.isMatching=!1,u.isPrompts=!1,u.isPopup=!1,u.isRetry=!1,u.isOther=!1,u.isTrueMsg=!1,u.isAgain=!1,u.userType=l.type,u.IDNumber="",u.userName="",u.storeCode=0,u.storeType=0,u.channal="APP",u.obj={isMyName:"",isMyIdNumber:""},u.init=function(){u.promotionCodeRouter?u.phoneNumber=u.register_obj.mobileNum:u.memberId?g.doInit().success(function(e){e.success?(u.isNotAuthentication=e.data.isAuth,null!=e.data.identity&&u.isNotAuthentication?(u.isOkAuthentication={color:"#999"},u.IDNumber=e.data.identity.identityNo.replace(/(\d{6})(\d+)(\d{2})/,function(e,t,o,i){for(var s="";s.length<o.length;)s+="*";return t+s+i}),u.userName=e.data.identity.realName.replace(/.{1}/,"*"),u.obj.isMyName=e.data.identity.realName,u.obj.isMyIdNumber=e.data.identity.identityNo,u.phoneNumber=e.data.identity.mobile):(u.isOkAuthentication={color:"#000"},u.isNotAuthentication=!1,u.phoneNumber=n.getUser().mobile,u.isPopup=!1,u.isMake=!1,u.isMatching=!1,u.isPrompts=!1)):(u.message=e.message,u.isRetry=!0)}):u.phoneNumber=u.register_obj.mobileNum},u.retry=function(){u.isRetry=!1},u.IwantETC=function(){u.isTrueMsg=!1},u.commonFunctions=function(){u.isPopup=!0,d(function(){u.isPopup=!1,p.go("homePage")},1e3)},u.clickOk=function(){t.checkOpenStore(u.memberId).success(function(e,t,s,n){window.UmengPush&&window.UmengPush.getDeviceToken([],function(e){f.get(i.getUrl("DEVICE_INFO")+"?device_token="+e+"&device_type="+deviceInfo)}),e.data?u.isTrueMsg=!0:(u.isTrueMsg=!1,g.postUserMsg(u.obj.isMyName,u.obj.isMyIdNumber,u.phoneNumber,u.channal).success(function(e){e.data?(u.message=e.message,o.loginIsAuthentication=!1,u.isPopup=!0,u.isMatching=!1,u.isRetry=!1,u.isOther=!1,d(function(){u.isPopup=!1,p.go("homePage")},1e3)):(u.message=e.message,u.isRetry=!0,u.isMatching=!0,u.isPrompts=!1,u.isPopup=!1)}))}).error(function(t){e.showToast("网络连接失败！")})},u.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?s.open(i.getHead()+"mstore/sg/helpDetail.html?id="+e,t):p.go("helpDetail",{helpId:e,content:t})},u.isSubmit=function(){u.isTrueMsg=!1,g.postUserMsg(u.obj.isMyName,u.obj.isMyIdNumber,u.phoneNumber,u.channal).success(function(e){e.data?(u.message=e.message,u.isMatching=!1,u.isRetry=!1,u.isOther=!1,u.isPopup=!0,u.isPrompts=!1,o.loginIsAuthentication=!1,u.mentionCenterNum=o.canGetMount,d(function(){u.isPopup=!1,5==u.userType?p.go("bankCard"):2==u.userType?p.go("homePage"):8==u.userType?p.go("mentionCenter",{canAmount:u.mentionCenterNum}):p.go("personnalCenter")},600)):(u.message=e.message,u.isRetry=!0,u.isMatching=!0,u.isPrompts=!1,u.isPopup=!1)})},u.retry=function(){u.isRetry=!1};u.$watch("obj",function(){/^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/.test(u.obj.isMyName)&&/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(u.obj.isMyIdNumber)?g.getUsNameOrId(u.obj.isMyName,u.obj.isMyIdNumber).success(function(e){e.data?(u.message=e.message,u.isPrompts=!0,u.isMake=!0,u.isMatching=!1,u.isRetry=!1):(u.message=e.message,u.isMake=!1,u.isPrompts=!1,u.isMatching=!0,u.isRetry=!1)}):(u.isMake=!1,u.isPrompts=!1,u.isMatching=!1)},!0);u.goBack=function(){a.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(u.paddingtopClass={"margin-top":"16px"},u.paddingtopClasscontent={top:"60px"}):(u.paddingtopClass={"margin-top":"0px"},u.paddingtopClasscontent={top:"44px"}),u.$on("$ionicView.beforeEnter",function(){u.memberId=n.getUser().mid,u.isPopup=!1,u.isRetry=!1,u.isMake=!1,u.isMatching=!1,u.isPrompts=!1,u.newAuthentication_obj=r.getObject("newAuthentication_obj"),u.register_obj=r.getObject("register_obj"),u.promotionCodeRouter=u.newAuthentication_obj.isPromotionCode,u.promotionCodeRouter&&(u.phoneNumber=u.register_obj.mobileNum),u.memberId&&u.promotionCodeRouter&&(u.phoneNumber=u.register_obj.mobileNum),u.init(),u.obj.isMyName="",u.obj.isMyIdNumber=""})}]),APP.service("trueAuthenticationService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("TRUE_REALNAMEAUTH"))},this.getUsNameOrId=function(o,i){var s={realName:o,identityNo:i};return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:s})},this.postUserMsg=function(o,i,s,n){var a={realName:o,identityNo:i,mobile:s,channal:n};return e({method:"POST",url:t.getUrl("POST_USERDATAANDID"),params:a})},this.postUserInfoPC=function(o,i,s){var n={realName:o,identityNo:i,mobile:s};return e({method:"POST",url:t.getUrl("POST_USERDATA"),params:n})}}]),APP.controller("trueAuthenticationListControl",["trueAuthenticationService","PopupService","LoginService","$rootScope","UrlService","InAppBrowserService","UserService","$ionicHistory","$localstorage","ShopApplyService","$stateParams","$timeout","$scope","$state","trueAuthenticationListService","IMService","$http",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){p.isTrueAuthentication=!1,p.isStaff=!1,p.init=function(){e.doInit().success(function(e){e.success?(null!=e.data.identity?p.isTrueAuthentication=!0:p.isTrueAuthentication=!1,null!=e.data.empInfo?p.isStaff=!0:p.isStaff=!1):t.showToast(e.message)})},p.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?n.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,t):g.go("helpDetail",{helpId:e,content:t})},p.goBack=function(){r.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(p.paddingtopClass={"margin-top":"16px"},p.paddingtopClasscontent={top:"60px"}):(p.paddingtopClass={"margin-top":"0px"},p.paddingtopClasscontent={top:"44px"}),p.$on("$ionicView.beforeEnter",function(){p.init()})}]),APP.service("trueAuthenticationListService",["$http","UrlService",function(e,t){}]),APP.controller("newresCtrl",["$stateParams","$scope","flashService","$state","$ionicHistory","$interval","newresService","$ionicScrollDelegate","$rootScope","$localstorage","GoodsService","UserService","$ionicLoading","HomePageService",function($stateParams,$scope,flashService,$state,$ionicHistory,$interval,newresService,$ionicScrollDelegate,$rootScope,$localstorage,GoodsService,UserService,$ionicLoading,HomePageService){function Format(e){return e=e<10?"0"+e:e}function countDown(e,t,o){$scope.endT[o]=t-e,timer[o]=$interval(function(){$scope.endTt[o]=Math.floor($scope.endT[o]/86400),$scope.endTh[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o])/3600)),$scope.endTm[o]=Format(Math.floor(($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o])/60)),$scope.endTs[o]=Format($scope.endT[o]-86400*$scope.endTt[o]-3600*$scope.endTh[o]-60*$scope.endTm[o]),$scope.endT[o]--,$scope.Timetotal[o]=$scope.endTt[o]+"天"+$scope.endTh[o]+":"+$scope.endTm[o]+":"+$scope.endTs[o],-1==$scope.endT[o]&&($state.reload(),$interval.cancel(timer[o]))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.showtime=0,$scope.pageIndex=1,$scope.newprodlist=[],$scope.hasmore=!0,$scope.isWd=!1,$scope.storeId=0,$scope.flag=!1,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png";var timer=[],remindArray=[],countDownNowTime=[],countDownendTime=[],timerLength="",nowT=(new Date).getTime();$scope.endT=[],$scope.endTt=[],$scope.endTh=[],$scope.endTm=[],$scope.endTs=[],$scope.Timetotal=[],$scope.provinceId=0,$scope.cityId=0,$scope.districtId=0,$scope.streetId=0,$scope.isCommission=$rootScope.isCommission,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.districtId=obj[0].areaId,$scope.streetId=obj[0].streetId,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){$scope.flag=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprodlist=e.data.acReserveList;for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var i=timerLength;i<remindArray.length;i++)countDown(countDownNowTime[remindArray[i]],countDownendTime[remindArray[i]],remindArray[i])})}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.loadMore=function(){$scope.pageIndex++,newresService.getnewProd($scope.pageIndex,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.typeNumber).success(function(e,t){if($scope.flag=!0,0==e.data.acReserveList.length)$scope.hasmore=!1,$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList),$scope.$broadcast("scroll.infiniteScrollComplete");else{if($scope.hasmore=!0,timerLength=remindArray.length,remindArray=[],1==e.data.isWd)$scope.isWd=!0,$scope.storeId=UserService.getUser().mid;else{$scope.storeId=$localstorage.get("storeId",20219251),$scope.isWd=!1}$scope.newprodlist=$scope.newprodlist.concat(e.data.acReserveList);for(var o=0;o<$scope.newprodlist.length;o++)remindArray.push(o),countDownNowTime[o]=parseInt(nowT/1e3),countDownendTime[o]=parseInt($scope.newprodlist[o].reserveEndTime/1e3);for(var i=timerLength;i<remindArray.length;i++)countDown(countDownNowTime[remindArray[i]],countDownendTime[remindArray[i]],remindArray[i]);$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.$on("$ionicView.beforeEnter",function(){$scope.init()}),$scope.goBack=function(){for(var e=0;e<remindArray.length;e++)$interval.cancel(timer[remindArray[e]]);remindArray=[],$ionicHistory.goBack()}}]),APP.service("newresService",["$http","UrlService","flashService","$interval",function(e,t,o,i){this.getnewProd=function(o,i,s,n,a,r){var c={provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:o,from:r};return e.get(t.getNewUrl("NEW_SEND"),c)}}]),APP.controller("newsendCtrl",["$stateParams","$scope","GoodsService","flashService","$state","$ionicHistory","$interval","$timeout","newsendService","$rootScope","$localstorage","$ionicSlideBoxDelegate","UserService","$ionicScrollDelegate","BannerThemeService","HomePageService",function($stateParams,$scope,GoodsService,flashService,$state,$ionicHistory,$interval,$timeout,newsendService,$rootScope,$localstorage,$ionicSlideBoxDelegate,UserService,$ionicScrollDelegate,BannerThemeService,HomePageService){function add(e,t){var o=new Date,i=t,s=o.getTime(),n=$interval(function(){s+=1e3;var e=parseInt((i-s)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,a=parseInt(o/3600),r=e-24*t*60*60-60*a*60,c=parseInt(r/60),l=e-24*t*60*60-60*a*60-60*c;$scope.showtime=t+"天"+flashService.PrefixInteger(a)+":"+flashService.PrefixInteger(c)+":"+flashService.PrefixInteger(parseInt(l)),-1==e&&($state.reload(),$interval.cancel(n))},1e3)}$scope.typeNumber=$stateParams.type,$scope.typeNumber=2==$scope.typeNumber?2:1,$scope.isWd=!1,$scope.newprod=[],$scope.showtime="",$scope.presell=[],$scope.zcnow=[],$scope.zcpre=[],$scope.zcold=[],$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),newsendService.slidedata().success(function(e){$scope.bannerList=[],$scope.others=[],$scope.bannerList=e.data.topBanner,$scope.others=e.data.others.slice(0,2),$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("newsend_slide").loop(!0),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})}),GoodsService.getAddress().success(function(response){var obj=eval(response.data);newsendService.getnewProd(obj[0].provinceId,obj[0].cityId,obj[0].areaId,obj[0].streetId,1).success(function(e){1==e.data.isWd?$scope.isWd=!0:$scope.isWd=!1,$scope.newprod=e.data.acReserveList[0],$scope.newprod&&add(e.data.acReserveList[0].reserveStartTime,e.data.acReserveList[0].reserveEndTime)})}),newsendService.getpres().success(function(e){$scope.presell=e.data.slice(0,3)}),newsendService.getcrowold($scope.typeNumber).success(function(e){$scope.zcold=e.data.zActivitySuccessList,$scope.zcnow=e.data.zActivityBeginningList,$scope.zcpre=e.data.zActivityToBeginList})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":for(var s=t.slice(t.lastIndexOf("=")+1),n=/\=(.*?)\&/g,a=t.match(n),r=[],c=0;c<a.length;c++)r.push(a[c].substring(1,a[c].length-1));$state.go("productDetail",{fromType:s,fromUrl:r[3],o2oType:r[2],productId:r[0],storeId:r[1]});break;case"2":if(t){var l=t.slice(t.indexOf("=1"));$state.go("couponsDetail",{cId:l,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var d=t.slice(t.indexOf("=1"));$state.go("game",{gameId:d});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var u=t.slice(t.indexOf("#/"));window.location.hash=u}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(){$scope.init(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200)}),$scope.goBack=function(){$ionicScrollDelegate.scrollTop(),$ionicHistory.goBack()}}]),APP.service("newsendService",["$http","UrlService",function(e,t){this.getnewProd=function(o,i,s,n,a){var r={provinceId:o,cityId:i,districtId:s,streetId:n,pageIndex:a};return e.get(t.getNewUrl("NEW_SEND"),r)},this.getpres=function(){var o={pageIndex:1,pageSize:3};return e.get(t.getNewUrl("NEW_RES"),o)},this.getcrowold=function(o){var i={from:o};return e.get(t.getZCUrl("SUC_ZHONGCHOU"),i)},this.slidedata=function(){var o={type:1};return e.get(t.getNewUrl("NEW_SLIDE"),o)}}]),APP.controller("presellCtrl",["$scope","flashService","$state","$ionicHistory","$interval","presellService","$ionicScrollDelegate","$rootScope","$localstorage","UserService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d){e.pageIndex=1,e.hasmore=!0,e.preselllist=[],e.storeId=0,e.flag=!1,e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.goBack=function(){i.goBack()},e.init=function(){e.storeId=c.get("storeId",r.globalConstant.storeId),e.loadMore=function(){n.getpres(e.pageIndex).success(function(t){0==t.data.length?(e.hasmore=!1,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasmore=!0,e.preselllist=e.preselllist.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"))}),e.pageIndex++},d.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.$on("$stateChangeSuccess",function(){e.loadMore()})}]),APP.service("presellService",["$http","UrlService","flashService","$interval",function(e,t,o,i){this.getpres=function(o){var i={pageIndex:o,pageSize:4};return e.get(t.getNewUrl("NEW_RES"),i)}}]),APP.controller("CarTrackController",["$scope","$stateParams","$sce",function(e,t,o){e.trackUrl=o.trustAsResourceUrl(t.trackUrl)}]),APP.controller("ConfirmReceiveController",["$scope","PopupService","$stateParams","ConfirmReceiveService","$ionicViewSwitcher","$state",function(e,t,o,i,s,n){function a(){i.getConfirmList(e.orderId).success(function(t){t.success&&(e.confirmCount=t.data.numberCount,e.confirmReceivelist=t.data.orderProductList)})}e.orderId="",e.confirmCount="",e.confirmReceivelist=[],e.confirmReceive=function(e){function o(o){o&&i.confirmReceive(e).success(function(e){e.success?a():t.showToast(e.message)})}t.showConfirm("",'"确认收货"将代表您已收到所购商品！',o,"确认")},e.goOrderManage=function(){s.nextDirection("forward"),n.go("orderManage")},e.$on("$ionicView.beforeEnter",function(t,i){e.orderId=o.orderId,a()})}]),APP.service("ConfirmReceiveService",["$http","UrlService",function(e,t){this.getConfirmList=function(o){var i={orderId:o};return e.get(t.getUrl("GET_CONFIRM_RECEIVE_LIST"),i)},this.confirmReceive=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CONFIRM_RECEIVE"),i)}}]),APP.controller("SendGoodsTimeController",["$scope","$stateParams","$rootScope","$state","$ionicActionSheet","SendGoodsTimeService","PopupService",function(e,t,o,i,s,n,a){e.htmlContent=t.content,e.title=t.title,e.data={time:[{text:"9:00-13:00"},{text:"13:00-18:00"},{text:"18:00-21:00"}]},e.zfb_checked=!0,e.huod_checked=!1,e.kjt_checked=!1,e.init=function(){e.htmlContent=t.content,e.title=t.title,e.dateTimes=[],e.datas={},n.getSendGoodsDates().success(function(t,o,i,s){e.storeInfo=t.data.resShippingList;for(var n=0;n<t.data.resShippingList.length;n++)e.datas={text:t.data.resShippingList[n].weekDay},e.dateTimes.push(e.datas)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.chooseDate=function(){s.show({buttons:e.dateTimes,cancel:function(){},buttonClicked:function(t){return e.dateChoose=e.dateTimes[t].text,!0},cssClass:"limitScrollHeight"})},e.chooseTime=function(){s.show({buttons:e.data.time,cancel:function(){},buttonClicked:function(t){return e.timeChoose=e.data.time[t].text,!0}})},e.confirm=function(){if(!e.dateChoose||!e.timeChoose)return void a.showToast("请填写配送时间");e.dateChoose=e.dateChoose.substr(0,10),n.confirmSendGoodsDates(1,e.dateChoose,e.timeChoose).success(function(e,t,o,s){1==e.success&&i.go("orderConfirm")})}}]),APP.service("SendGoodsTimeService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){var o={toUrl:2};return e.get(t.getUrl("PAY_WAY"),o)},this.confirmSendGoodsDates=function(o,i,s){var n={delivery:o,yuyueDay:i,yuyueTime:s};return e({method:"POST",url:t.getUrl("SUBMIT_DELIVE_WAY"),params:n})}}]),APP.controller("AfterOrderSubmitController",["$scope","$stateParams","$rootScope","$ionicLoading","PaymentService","$ionicHistory","PopupService","InAppBrowserService","$state","EasyConnectService","$ionicPopup","AfterOrderSubmitService",function(e,t,o,i,s,n,a,r,c,l,d,u){e.htmlContent=t.content,e.title=t.title,e.payment="",e.showPay=!0,e.isToStore=!1;var p="";e.paymentCode=t.paymentCode;var g,m,f;e.init=function(){e.htmlContent=t.content,e.title=t.title,e.messageData=t.messageData,e.data=JSON.parse(e.messageData),g=e.data.orderSn,m=e.data.paymentCode,f=e.data.orderAmount,e.payment=e.data.paymentName},e.payTest=function(e,t,o){return void c.go("paymentxyz",{orderSn:e,totalAmount:o})},e.goToStore=function(){c.go("myStore",{storeId:p,shareStoreId:p})},e.goBack=function(){n.goBack(-2)},e.$on("$ionicView.beforeEnter",function(){e.init();var t=n.viewHistory().histories.root.stack,o=t.length;t[o-3]&&"productDetail"==t[o-3].stateName?p=t[o-3].stateParams.shareStoreId:t[o-4]&&"productDetail"==t[o-4].stateName&&(p=t[o-4].stateParams.shareStoreId),p&&(e.isToStore=!0)})}]),APP.service("AfterOrderSubmitService",["$http","UrlService",function(e,t){this.getAliPayInfo=function(o,i,s){var n={tradeNo:o,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+o,price:i,notifyUrl:s};return e({method:"POST",url:t.getUrl("GET_ALIPAY_INFO"),params:n})}}]),APP.controller("BankCardChoseController",["bankCardPaymentListService","$scope","$stateParams","$state","$ionicHistory","PopupService","$ionicPopup","$http","UrlService","UserService",function(e,t,o,i,s,n,a,r,c,l,d){t.orderSn=o.orderSn,t.totalAmount=o.totalAmount,t.cardsArr=[],t.goCart=function(){i.go("orderManage")},t.toPay=function(e){var o={orderSn:t.orderSn,totalAmount:t.totalAmount,whereName:e};switch(e){case"ccb_credit":i.go("debitCardPayment",o);break;case"ccb_fenqi":i.go("ccbfenqi",o);break;case"ceb_credit":i.go("debitCardPayment",o);break;case"ceb_fenqi":i.go("ccbfenqi",o)}},t.goBack=function(){t.$ionicGoBack()},t.$on("$ionicView.beforeEnter",function(){e.getCcbCost("sg").success(function(e){e.success&&(t.cardsArr=e.data)})})}]),APP.service("bankCardPaymentListService",["$http","UrlService",function(e,t){this.getCcbCost=function(o){var i=t.getPayCenter("PAY_TYPE_LIST")+"?callback=JSON_CALLBACK&channel="+o+"&category=1";return e.jsonp(i)}}]),APP.controller("CcbPayController",["$scope","$stateParams","$sce","$http","$ionicPopup","$rootScope","$state",function(e,t,o,i,s,n,a){e.ccbUrl=o.trustAsResourceUrl(t.url),window.screen.width<=320?e.height="50%":e.height="80%";t.orderSn;e.goBack=function(){a.go("orderManage")}}]),
>>>>>>> .r181827
APP.controller("CcbFenqiController",["$q","CcbFenqiService","$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","InAppBrowserService","UrlService","PaymentService","UserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){function h(o){var i=e.defer();return t.payRequest(o).success(function(e){i.resolve(e)}),i.promise}function v(e){var t="";if("ceb_fenqi"==i.whereName)t=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var a="";e.data.ccbfenqi.INSTALLNUM&&(a="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),t=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+a+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}if(s.isIOS){var r=null;r=cordova.InAppBrowser.open(t,"_blank","location=no,shownativetitlebar=yes,titlebartitlestr="+o.title+"分期"),r.addEventListener("exit",function(e){n.go("orderManage")}),r.addEventListener("loadstart",function(e){-1!=e.url.indexOf("orderManage")&&(r.close(),n.go("orderManage"))})}else n.go("ccbPay",{url:t,orderSn:o.orderSn})}o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/CCB.png",o.title="建行信用卡",i.whereName.indexOf("ceb")>=0&&(o.imgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/12CEB.png",o.title="光大信用卡"),o.whereName=i.whereName,o.$on("$ionicView.beforeEnter",function(){o.isAndroid=ionic.Platform.isAndroid(),o.isAndroid?o.androidOrIosStyle={right:"5px"}:o.androidOrIosStyle={left:"70px"},o.isShowDet=!1,o.isChooseFenqi=!1,o.orderSn=i.orderSn,t.getCcbCost(o.orderSn,"sg",i.whereName).success(function(e){o.payList=e.data.costInfo,o.totalFee=e.data.totalFee,o.benefitFee=e.data.benefitFee,o.payFee=e.data.payFee,o.cfgMark=e.data.cfgMark,o.feeInfo=null!=e.data.feeInfo&&e.data.feeInfo;for(var t=o.payList.length,i=0;i<t;i++)o.payList[i].fenqiNum=!1;o.payList[0].fenqiNum=!0,o.number=o.payList[0].number;for(var i=t-1;i>=0;i--)1==o.payList[i].isFree?o.payList[i].isFree=!0:o.payList[i].isFree=!1})}),o.showDetail=function(){o.isShowDet=!o.isShowDet},o.changeFenqiNum=function(e){o.isChooseFenqi=!0;for(var t=o.payList.length,i=0;i<t;i++)o.payList[i].number==e?(o.payList[i].fenqiNum=!0,o.number=e):o.payList[i].fenqiNum=!1},o.toPay=function(){if(!o.number)return void l.showToast("请选择一种分期方式");if(window.cordova){var e={orderSn:o.orderSn};m.orderPayCheck(e).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:i.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){13!=e.errorCode&&e.success?v(e):13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){e.success&&v(e)})):n.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}else{var t={orderSn:o.orderSn};m.orderPayCheck(t).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else{var t={orderSn:o.orderSn,num:o.number,channel:"sg",payType:i.whereName,cfgMark:o.cfgMark,memberId:f.getUser().mid};h(t).then(function(e){if(13!=e.errorCode&&e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var i="";e.data.ccbfenqi.INSTALLNUM&&(i="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM),o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+i+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}else 13!=e.errorCode||e.success||l.showConfirm("提示","由于优惠活动已结束，支付金额将按照应付金额进行支付",function(e){e?(t.joinActivity=1,h(t).then(function(e){if(e.success){var o=null;if("ceb_fenqi"==t.payType)o=e.data.cebfenqi.actionUrl+"?Plain="+e.data.cebfenqi.plain+"&Signature="+e.data.cebfenqi.sign;else{var i="";e.data.ccbfenqi.INSTALLNUM&&(i="&INSTALLNUM="+e.data.ccbfenqi.INSTALLNUM);var o=e.data.ccbfenqi.actionUrl+"&REMARK1="+e.data.ccbfenqi.REMARK1+"&CLIENTIP="+e.data.ccbfenqi.CLIENTIP+"&BRANCHID="+e.data.ccbfenqi.BRANCHID+"&REMARK2="+e.data.ccbfenqi.REMARK2+"&TXCODE="+e.data.ccbfenqi.TXCODE+"&REGINFO="+e.data.ccbfenqi.REGINFO+"&CURCODE="+e.data.ccbfenqi.CURCODE+"&GATEWAY="+e.data.ccbfenqi.GATEWAY+"&PROINFO="+e.data.ccbfenqi.PROINFO+"&MERCHANTID="+e.data.ccbfenqi.MERCHANTID+i+"&ORDERID="+e.data.ccbfenqi.ORDERID+"&POSID="+e.data.ccbfenqi.POSID+"&PAYMENT="+e.data.ccbfenqi.PAYMENT+"&MAC="+e.data.ccbfenqi.MAC+"&TYPE="+e.data.ccbfenqi.TYPE+"&TIMEOUT="+e.data.ccbfenqi.TIMEOUT}window.location.href=o}})):n.go("orderManage",{orderStatus:1,orderFlag:1})})})}})}}}]),APP.service("CcbFenqiService",["$http","UrlService","UserService",function(e,t,o){this.getCcbCost=function(i,s,n){var a=t.getPayCenter("CCB_FENQI")+"?callback=JSON_CALLBACK&orderSn="+i+"&channel="+s+"&payType="+n+"&version=1&memberId="+o.getUser().mid;return e.jsonp(a)},this.payRequest=function(o,i){var s="";if(o.joinActivity)var s="&joinActivity=1";var n=t.getPayCenter("CCB_FENQI_W")+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+s;return e.jsonp(n)},this.payRequestWithGuangDaTest=function(o){var i="";if(o.joinActivity)var i="&joinActivity=1";var s=t.getGuangDaTestPay()+"?callback=JSON_CALLBACK&orderSn="+o.orderSn+"&num="+o.num+"&channel="+o.channel+"&payType="+o.payType+"&callbackUrl=v3/h5/pay/callback.html&memberId="+o.memberId+"&cfgMark="+o.cfgMark+i;return e.jsonp(s)}}]),APP.controller("debitCardPaymentController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){o.totalAmount,o.orderSn;t.whereName=o.whereName,t.goBack=function(){c.goBack()}}]),APP.controller("OrderConfirmController",["$scope","$stateParams","$rootScope","$state","orderConfirmService","$ionicPopup","$timeout","PopupService","LoginService","$http","UrlService","$ionicHistory","$ionicScrollDelegate","$ionicLoading",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(){e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.couponsPrice=0,e.couponAmount=0,e.allPrice=0,e.newPrice=0,e.orderData={},e.htmlContent=t.content,e.title=t.title,e.searchGoodsName.name=null,e.searchGoodsName.giftName=null,e.codFlag=!1,e.couponsDiscount=null,e.buttonDisabled=[!0,!0,!0],I=[]}function f(t){I=[],p.resize(),e.seashellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0;for(var o=t.length,i=0;i<o;i++){var s=null,n=null;s=h(S,t[i].quota),s>e.newPrice&&(s=e.newPrice),n=Math.floor(h(s,t[i].proportion)),s=n/t[i].proportion,n>e.pointsList[i].count&&(n=e.pointsList[i].count,s=n/t[i].proportion),e.pointsList[i].pointDiscount=s,e.pointsList[i].canUsePoint=n,e.pointsChecked[i]=!1,v[i]=!1,e.pointsList[i].canUsePoint>0&&(e.buttonDisabled[i]=!1)}}function h(e,t){var o=0,i=e.toString(),s=t.toString();try{o+=i.split(".")[1].length}catch(e){}try{o+=s.split(".")[1].length}catch(e){}return Number(i.replace(".",""))*Number(s.replace(".",""))/Math.pow(10,o)}e.o2oTypeMap={},e.htmlContent=t.content,e.title=t.title,e.tabNav="selection",e.couponsPrice=0,e.couponAmount=0,e.smallPrice=[],e.snewPrice=[],e.allPrice=0,e.newPrice=0,e.isBook=t.Book,e.attrValueNames=t.attrValueNames||"",e.skku=t.skku||"",e.disableSubmitBtn=!1,e.searchGoodsName={name:"",giftName:""},e.invoiceHead=void 0,e.zzsInvoice=void 0,e.searchButton=!1,e.giftSearchButton=!1,e.canUseGiftCard=void 0,e.item={isChecked:!1,isGiftChecked:!1},e.data={memberId:""},e.deliMap={"9:0000":"9:00-13:00",130000:"13:00-18:00",180000:"18:00-21:00"},e.pointsChecked=[!1,!1,!1];var v=[!1,!1,!1];e.couponsDiscount=null,e.seaShellDiscount=0,e.diamondDiscount=0,e.insuranceDiscount=0,e.pointsList=null;var S=null,I=[];e.buttonDisabled=[!0,!0,!0],e.init=function(o){e.o2oAttrId=t.o2oAttrId,m(),s.doInit(o,e.attrValueNames,e.skku,e.o2oAttrId).success(function(t,o,s,n){if("1001"==t.code)return c.getRole(),void i.go("homePage");for(var a=0;a<t.data.ordersCommitWrapM.orderProductList.length;a++)if("null"==t.data.ordersCommitWrapM.orderProductList[a].attrValueName||null==t.data.ordersCommitWrapM.orderProductList[a].attrValueName){var r=[];t.data.ordersCommitWrapM.orderProductList[a].attrValueName=r}else{var l=t.data.ordersCommitWrapM.orderProductList[a].attrValueName,r=l.split(",");t.data.ordersCommitWrapM.orderProductList[a].attrValueName=r}e.orderConfirmMessage=t.data,e.pointsList=t.data.benefit?t.data.benefit:null,e.canUseGiftCard=e.orderConfirmMessage.canUseGiftCard,e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.o2oTypeMap=e.orderConfirmMessage.o2oTypeMap,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle,e.isBooking=e.orderConfirmMessage.isBooking1?1:0,e.proNumberTotal=0;for(var a=0,d=e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;a<d;a++)e.proNumberTotal+=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].number;1==e.isBook&&(e.isBooking=1),e.paymentType=e.orderConfirmMessage.ordersCommitWrapM.payList,e.paymentCode=e.paymentType[0].paymentCode,e.codFlag=!1,2==e.orderConfirmMessage.ordersCommitWrapM.payList.length&&(e.codFlag=!0),e.isOnlinePay[0]?e.choosePayType(0):e.codFlag&&e.proNumberTotal<=2?e.choosePayType(1):e.choosePayType(0),e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue||(e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue=0);for(var a=0;a<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;a++){e.smallPrice[a]=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].productAmount,e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue?e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue:0,e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount?e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount:0,0==e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount?e.smallPrice[a]-e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue>0?(e.snewPrice[a]=e.smallPrice[a]-e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue,e.couponsDiscount=e.couponsDiscount+e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue):e.snewPrice[a]=.01:0!=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount&&(e.smallPrice[a]-e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount>0?e.snewPrice[a]=e.smallPrice[a]-e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponAmount:e.snewPrice[a]=.01),e.couponsPrice+=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].couponCodeValue,0!=e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue&&(e.couponsPrice=0,e.couponsPrice=e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue);for(var u in e.o2oTypeMap)u==e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].productId&&(e.orderConfirmMessage.ordersCommitWrapM.orderProductList[a].o2oTypeMapValue=e.o2oTypeMap[u]);e.allPrice=e.allPrice+e.smallPrice[a],S=e.allPrice,0==e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue&&(e.newPrice=e.newPrice+e.snewPrice[a],e.newPrice<0&&(e.newPrice=.01),S=e.newPrice)}0!=e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue&&(e.newPrice=e.allPrice-e.couponsPrice,S=e.newPrice,e.newPrice<0&&(e.newPrice=.01),e.couponsDiscount=e.couponsDiscount+e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue),e.orderConfirmMessage.benefit&&f(e.orderConfirmMessage.benefit)}).error(function(e,t,o,i){})},e.isOnlinePay=[!0,!1],e.choosePayType=function(t){if(0==t){e.paymentCode=e.paymentType[0].paymentCode;var o={payWay:e.paymentCode};l({method:"POST",url:d.getUrl("SUBMIT_PAY_WAY"),params:o}).success(function(t){1==t.success&&(e.isOnlinePay=[!0,!1])})}else e.paymentCode=e.paymentType[1].paymentCode,o={payWay:e.paymentCode},l({method:"POST",url:d.getUrl("SUBMIT_PAY_WAY"),params:o}).success(function(t){1==t.success&&(e.isOnlinePay=[!1,!0])})},e.$on("$ionicView.beforeEnter",function(t,i){e.init(o.isInvoice),e.isBuyerForOrder=c.getRole(),0==e.isBuyerForOrder?e.footerSubmit={position:"fixed",bottom:"0px"}:e.footerSubmit={position:"fixed",bottom:"49px"}}),e.$on("$ionicView.afterLeave",function(e,t){o.isInvoice=!1}),e.$watch("searchGoodsName.name",function(t,o){t?e.searchButton=!0:(e.searchButton=!1,e.item.isChecked=!1)}),e.$watch("searchGoodsName.giftName",function(t,o){t?e.giftSearchButton=!0:(e.giftSearchButton=!1,e.item.isGiftChecked=!1)}),e.toInvoice=function(t){i.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:0})},e.toSubmit=function(){if(!0!==e.disableSubmitBtn)if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))e.disableSubmitBtn=!0,s.toSubmit(e.isBooking,I).success(function(t,s,a,r){if(!0===t.success){e.disableSubmitBtn=!1,g.hide(),window.cordova&&o.gio.track("SubmitOrder",{paymentMethod:e.paymentCode,totalPrice:e.allPrice!=e.newPrice?e.newPrice:e.allPrice,productCount:e.proNumberTotal});var c=t;if(!0===c.success&&c.data&&c.data.order){"undefined"!=typeof pubsage_conv&&pubsage_conv.push(["setOrderInfo",[[c.data.order.orderSn,"","",c.data.order.orderAmount]]]),"undefined"!=typeof _taq&&_taq.push({convert_id:"66993687926",event_type:"shopping"});var l=c.data.order,d=e.paymentCode;if(101==c.data.order.paymentStatus)return void i.go("orderManage");"online"==d?(e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue>0&&(o.couponXyzType=!0),i.go("paymentxyz",{orderSn:l.orderSn,totalAmount:l.orderAmount})):i.go("afterOrderSubmit",{messageData:JSON.stringify(l),paymentCode:d})}else{var p=n.confirm({template:c.message?c.message:"创建订单失败",okText:"返回上一页",cancelText:"留在此页"});p.then(function(e){e&&u.goBack(-1)})}}else{e.disableSubmitBtn=!1,g.hide();var p=n.confirm({template:t.message,okText:"返回上一页",cancelText:"留在此页"});p.then(function(e){e&&u.goBack(-1)})}}).error(function(t){e.disableSubmitBtn=!1,g.hide()});else{n.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{n.alert({template:"收货地址必须填写！",okText:"知道了"})}},e.toPayment=function(e){i.go("payment",{paymentCode:e})},e.tosendGoodsTime=function(){i.go("sendGoodsTime")},e.showPopup=function(e){var t=n.show({template:e});a(function(){t.close()},1e3)},e.useGiftCard=function(t,o,i,n){t&&s.useGiftCard(t,o,i,n).success(function(t,o,i,s){1==t.success?"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):(e.item.isGiftChecked=!0,e.init()):r.showAlert("提示","验证优惠券失败","")})},e.cancleGiftCard=function(t){n.confirm({title:"提示",template:"是否确认取消优惠?",okText:"确定",cancelText:"取消"}).then(function(o){o&&s.cancleGiftCard(t).success(function(t,o,i,s){1==t.result?(r.showAlert("提示","取消成功",""),e.init()):e.showPopup("取消失败")})})},e.useCard=function(t,o,i,n){t&&s.useCard(t,o,i,n).success(function(t,o,i,s){1==t.success?"N"==t.result.flag?r.showAlert("提示",t.result.failedReason,""):e.couponsForTransfer():r.showAlert("提示","验证优惠券失败","")})};var $;e.couponsForTransfer=function(){function t(){e.expiredSecond=e.expiredSecond-1,e.expiredSecond>0?(e.searchButton=!1,$=a(function(){t()},1e3)):(e.searchButton=!0,o.close())}e.expiredSecond=121,$&&a.cancel($),t();var o=n.show({template:'<div class="row padding-0"><span class="col-30 text-align-c">验证码</span> <input class="col-60 border text-align-c" style="border-color: #32BEFF !important;height: 20px" type="number" ng-model="data.memberId" placeholder="请输入验证码"></div><div> 验证码将在<span class="color-text-red" ng-bind="expiredSecond"></span>秒后过期</div>',title:"请输入验证码",subTitle:"请输入验证码",scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){e.data.memberId?s.cardCheck(e.data.memberId).success(function(t,i,s,n){1==t.success?(r.showAlert("提示","使用成功",""),e.init(),o.close()):r.showAlert("提示",t.message,"")}):r.showAlert("提示","请输入验证码",""),t.preventDefault()}}]})},e.goCard=function(){if(e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue){n.alert({template:w,okText:"知道了"})}else{for(var t=0;t<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;t++)if(e.orderConfirmMessage.ordersCommitWrapM.orderProductList[t].couponCodeValue)return void n.alert({template:w,okText:"知道了"});if(1==e.giftSearchButton||1==e.orderConfirmMessage.useGiftCard)return void n.alert({template:w,okText:"知道了"});if(!e.regAddress){n.alert({template:"收货地址必须填写！",okText:"知道了"})}}},e.goGiftCard=function(){if(e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue)return void n.alert({template:w,okText:"知道了"});for(var t=0;t<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;t++)if(e.orderConfirmMessage.ordersCommitWrapM.orderProductList[t].couponCodeValue){n.alert({template:w,okText:"知道了"});return}for(var t=0;t<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;t++)if(1==e.searchButton||0!=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[t].couponAmount)return void n.alert({template:w,okText:"知道了"})},e.goUseCouponList=function(t){if(1==t.type){if(e.orderConfirmMessage.ordersCommitWrapM.order.couponCodeValue){n.alert({template:w,okText:"知道了"});return}for(var o=0;o<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;o++)if(1==e.searchButton||0!=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[o].couponAmount)return void n.alert({template:w,okText:"知道了"});if(1==e.giftSearchButton||1==e.orderConfirmMessage.useGiftCard)return void n.alert({template:w,okText:"知道了"})}else if(2==t.type){for(var o=0;o<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;o++)if(e.orderConfirmMessage.ordersCommitWrapM.orderProductList[o].couponCodeValue)return void n.alert({template:w,okText:"知道了"});for(var o=0;o<e.orderConfirmMessage.ordersCommitWrapM.orderProductList.length;o++)if(1==e.searchButton||0!=e.orderConfirmMessage.ordersCommitWrapM.orderProductList[o].couponAmount)return void n.alert({template:w,okText:"知道了"});if(1==e.giftSearchButton||1==e.orderConfirmMessage.useGiftCard)return void n.alert({template:w,okText:"知道了"})}if(e.regAddress)i.go("useCouponsList",t);else{n.alert({template:"收货地址必须填写！",okText:"知道了"})}};var w="礼品券不可与优惠券/卡券同时使用，请核对要使用的优惠券";e.countPoint=function(t,o){if(0!=e.pointsList[t].canUsePoint){if(e.pointsChecked[t]=!e.pointsChecked[t],1==v[t]&&0==e.pointsChecked[t])return e.newPrice=e.newPrice+e.diamondDiscount+e.seashellDiscount+e.insuranceDiscount,f(e.orderConfirmMessage.benefit),void(v[t]=e.pointsChecked[t]);if(0==v[t]&&1==e.pointsChecked[t]){var i,s;switch(i=h(S,e.pointsList[t].quota),i>e.newPrice&&(i=e.newPrice),s=Math.floor(h(i,e.pointsList[t].proportion)),i=s/e.pointsList[t].proportion,s>e.pointsList[t].count&&(s=e.pointsList[t].count,i=s/e.pointsList[t].proportion),e.pointsList[t].pointDiscount=i,e.pointsList[t].canUsePoint=s,e.newPrice=e.newPrice-i,o){case"diamond":e.diamondDiscount=i;break;case"seashell":e.seashellDiscount=i;break;case"insurance":e.insuranceDiscount=i}I.push({benefitType:o,count:s,amt:i});for(var n=0;n<e.pointsList.length;n++)if(0==e.pointsChecked[n]&&n!=t){var a,r;a=h(S,e.pointsList[n].quota),a>e.newPrice&&(a=e.newPrice),r=Math.floor(h(a,e.pointsList[n].proportion)),a=r/e.pointsList[n].proportion,0==r&&(e.buttonDisabled[n]=!0),r>e.pointsList[n].count&&(r=e.pointsList[n].count,a=r/e.pointsList[n].proportion),e.pointsList[n].pointDiscount=a,e.pointsList[n].canUsePoint=r}v[t]=e.pointsChecked[t]}p.resize()}},e.switchOn={background:"#4fa7ec","border-color":"#4fa7ec"},e.switchOff={background:"#fff","border-color":"#e6e6e6"}}]),APP.service("orderConfirmService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n){if(null!=s&&null!=i)var a={isFromInvoices:o?1:0,version:1,attrValueNames:i,skku:s,o2oAttrId:n};else var a={isFromInvoices:o?1:0,version:1};return e.get(t.getUrl("CONFIRM_ORDER"),a)},this.toSubmit=function(o,i){var s={remark:"",isBooking:o,benefitList:i};return e({method:"POST",url:t.getUrl("ORDER_SUBMIT"),data:s})},this.useCard=function(o,i,s,n){var a={cardCode:o,productId:i,number:s,storeCode:n};return e({method:"POST",url:t.getUrl("CARD_COUPONS_USED"),params:a})},this.cardCheck=function(o){var i={captcha:o};return e.get(t.getUrl("CARD_ CODE_CHECK"),i)},this.useGiftCard=function(o,i,s,n){var a={cardCode:o,number:i,amount:s,customId:n};return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_USED"),params:a})},this.cancleGiftCard=function(o){var i={couponCode:o};return e({method:"POST",url:t.getUrl("GIFT_CARD_COUPONS_CANCLE"),params:i})}}]),APP.controller("OrderSearchController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){function I(e){e?a.deleteOrder(w).success(function(e){e.success?(t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()):(g.showToastShort(e.message),w="")}).error(function(e){g.showToastShort("删除失败！"),w=""}):w=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus="",t.isIos=!1;var $="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId;var w="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.orderStatus=o.orderStatus?o.orderStatus:"","0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1)},t.initSearch=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.availableToTop(),t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,t.orderStatus,0,5,t.search.keyWord,!0)},t.loadOrderList=function(e,o,i,s,n,c,l){a.getOrderList(o,i,s,n,c).success(function(o){o.success&&(e?l?t.searchOrderList=t.searchOrderList.concat(o.data.orders):t.orderList=t.orderList.concat(o.data.orders):l?(t.searchOrderList=o.data.orders,0==t.searchOrderList.length?t.noOrders=!0:t.noOrders=!1):t.orderList=o.data.orders,l?t.hasMoreDataSearch=o.data.orderProductSize:t.hasMoreData=o.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length),e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,i){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var n=e,a="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?S.getAliPayInfo(n,i,a).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");$=e.result,window.alipay.pay({payInfo:$},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:n,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+n,price:i,notifyUrl:a},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};u.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,i,n,a){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};u.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+i+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,i,n){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){s.go("paymentxyz",{orderSn:e})},t.Pamentxyz=function(t,o,i){e.getOrderList(t).success(function(e){couponLists=e.data.couponList,couponLists.length>0&&i?s.go("Retainage",{relationOrderSn:t}):s.go("paymentxyz",{orderSn:t})})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),s.go("orderTracking",{orderSn:e})},t.goOrderDetails=function(e,o,i,n,a,r){t.memberId==a&&(r&&t.closeSearchModal(),i?s.go("refundDetail",{orderProductId:n,memberId:a}):s.go("orderDetail",{orderSn:e,cOrderSn:o}))},t.goAssess=function(e){s.go("assess",{orderId:e})},t.goLookAssess=function(e){s.go("lookAssess",{orderId:e})},t.orderCancel=function(e){a.cancelOrder(e,"mstore").success(function(e){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.initSearch()})},t.availableToTop=function(){r.$getByHandle("searchOrderHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||(t.init(),t.noOrders=!1)}),n.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){t.searchModal.show(),t.searchOrderList=[],t.pageIndexSearch=0,t.hasMoreDataSearch=!1},t.closeSearchModal=function(){m.goBack()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndexSearch=0,t.loadOrderList(!1,0,"",t.pageIndexSearch,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){w=e,g.showConfirm("","确认删除此订单？",I,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("assessed")})}]),APP.controller("PaymentController",["$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService",function(e,t,o,i,s,n){e.htmlContent=t.content,e.title=t.title,e.payWay="alipaymobile",e.zfb_checked=!0,e.huod_checked=!1,e.kjt_checked=!1,e.alipayText=null,e.codText=null,e.kjtpayText=null,e.wxpay_checked=!1,e.wxpayText=null,e.paymentCode=t.paymentCode,e.payWayList=[],e.payWayMap={alipaymobile:"支付宝",cod:"货到付款",kjtpay:"快捷通",wxpay:"微信支付"},e.init=function(){e.htmlContent=t.content,e.title=t.title,e.paymentCode=t.paymentCode,n.getSendGoodsDates().success(function(t,o,i,s){e.payWayList=t.data.payWayList;for(var n=0;n<t.data.payWayList.length;n++)"alipaymobile"==t.data.payWayList[n].paymentCode?e.alipayText=t.data.payWayList[n].paymentName:"cod"==t.data.payWayList[n].paymentCode?e.codText=t.data.payWayList[n].paymentName:"kjtpay"==t.data.payWayList[n].paymentCode&&(e.kjtpayText=t.data.payWayList[n].paymentName)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.checkedpay=function(t){e.paymentCode=t},e.pushPayWay=function(){if(!e.paymentCode)return void alert("请选择一个支付方式");n.submitSendGoodsDates(e.paymentCode).success(function(t,o,i,s){1==t.success?e.$ionicGoBack():alert(t.message)})}}]),APP.service("PaymentService",["$http","UrlService",function(e,t){this.getSendGoodsDates=function(){var o={toUrl:"1"};return e.get(t.getUrl("PAY_WAY"),o)},this.submitSendGoodsDates=function(o){var i={payWay:o};return e({method:"POST",url:t.getUrl("SUBMIT_PAY_WAY"),params:i})},this.wPay=function(o){return e.get(t.getUrl("WECHAT_PAY"),o)},this.kjtPay=function(o){return e.get(t.getUrl("PAY_KJT"),o)},this.orderPayCheck=function(o){return e.get(t.getUrl("ORDER_200PAYCHECK"),o)}}]),APP.controller("PaymentControllerxyz",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","UserService","WhiteShowsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){t.orderSn=o.orderSn,t.priceinit="500.00",t.alipaymobile=[],t.alipaymobiles=!1,t.kjtpay=[],t.kjtpays=!1,t.wxpay=[],t.wxpays=!1,t.canClick=!0,t.showIous=!0,t.canPayWhiticos=!1,t.icosImg=i.imgBaseURL+"img/baitiao-paylist.png",t.iousStatus=-1,t.htmlContent=o.content,t.title=o.title,t.payWay="alipaymobile",t.totalAmount=o.totalAmount,t.paymentCode="",t.payWayList=[],t.payment="",t.showPay=!0,t.isToStore=!1;var v="";t.isRed=!1,t.urlImg="http://m.ehaier.com/www/img/jh.png",t.canClick=!0,t.showCcb=!0;var S="",I={orderSn:t.orderSn};t.toPay=function(){var e={totalAmount:t.price,orderSn:t.orderSn};s.go("bankCardChose",e)},t.init=function(){g.get(m.getUrl("TO_ORDER_SUBMIT_SUCCESS"),I).success(function(e){t.price=e.data.orders.orderAmount,t.price>=600?(t.canPayWhiticos=!0,t.icosImg=i.imgBaseURL+"img/baitiao-paylist.png"):(t.canPayWhiticos=!1,t.icosImg=i.imgBaseURL+"img/baitiao-paylist-1.png");for(var o=e.data.paywayList,s=0;s<o.length;s++)"alipaymobile"==o[s].paymentCode?(t.alipaymobile=o[s],t.alipaymobiles=!0):"kjtpay"==o[s].paymentCode?(t.kjtpay=o[s],t.kjtpays=!0):"wxpay"==o[s].paymentCode&&(t.wxpay=o[s],t.wxpays=!0);!0!==e.data.isSupportLk?t.showCcb=!1:1==e.data.isSupportLk&&1==e.data.islk?(t.isRed=!0,
t.urlImg="http://m.ehaier.com/www/img/ic-ccb.png",t.canClick=!0):1==e.data.isSupportLk&&!0!==e.data.islk&&(t.canClick=!1),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackOrder",{oid:t.orderSn,otp:t.price+""},[]])})},t.$on("$ionicView.beforeEnter",function(){t.init(),S=c.viewHistory().backView,i.paySuccess&&p.alert({template:"此订单已经支付",okText:"确定"}).then(function(e){t.goList()})}),t.goList=function(){S?"orderManage"==S.stateName||"orderSearch"==S.stateName?c.goBack(-1):"Retainage"==S.stateName?s.go("orderManage"):c.goBack(-2):s.go("orderManage")},t.toSpendBai=function(){var e={orderSn:o.orderSn};s.go("spendBaiInstallment",e)},t.goCart=function(){s.go("orderManage")};var $,w;t.payWayMap={alipaymobile:"支付宝",paymentName:"建行信用卡分期",kjtpay:"快捷通",wxpay:"微信支付"},t.iousPay=function(){h.queryIousStatus({userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){if(e.success){if(t.iousStatus=e.data.applyStatus,!t.canPayWhiticos)return;2==t.iousStatus||3==t.iousStatus?s.go("applyForWhite"):0==t.iousStatus?h.applyForOpen({resultUrl:"http://m.ehaier.com/www/index.html",userId:f.getUser().ucId,token:f.getUser().accessToken}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):1==t.iousStatus&&a.orderPayCheck(I).success(function(e){-200==e.errorCode?l.showAlert("提示",e.message,function(){}):h.payApply({userId:f.getUser().ucId,token:f.getUser().accessToken,orderSn:o.orderSn,resultUrl:"http:www.baidu.com"}).success(function(e){e.success&&h.openApplyWhiteShows(e.data.redirectUrl,window.location.href)})})}})},t.checkedpay=function(e){t.paymentCode=e,$=o.orderSn,w=t.price,t.payTest($,t.paymentCode,w)},t.payTest=function(o,i,n){if(!window.cordova){var r={orderSn:o};return void a.orderPayCheck(r).success(function(e){if(-200==e.errorCode)l.showAlert("提示",e.message,function(){});else if("alipaymobile"==i)window.location.href=m.getHeadV2()+"h5/pay/alipay/request.html?orderSn="+o;else if("wxpay"==i){var t=window.navigator.userAgent;if(!t||-1==t.indexOf("MicroMessenger"))return void l.showToast("请使用与定金相同的支付方式-微信支付，登录顺逛微店公众号付款。");if(t.substring(t.indexOf("MicroMessenger")+15,t.indexOf("MicroMessenger")+16)<5)return void l.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href=m.getHeadV2()+"h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+o+"&orderAmount="+n+".00"}else"kjtpay"==i&&u.getMessage().success(function(e,t,i,n){e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount?window.location.href=m.getHeadV2()+"h5/pay/kjtpay/request.html?orderSn="+o+"&kjtAcount="+e.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("bankCard")})}).error(function(){alert("网络失败")})})}if("alipaymobile"==i)if(window.alipay){var c=o,g=m.getHeadV2()+"h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?e.getAliPayInfo(c,n,g).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});v=e.result,window.alipay.pay({payInfo:v},function(e){t.showPay=!1,s.go("payResultSuccess")},function(e){s.go("payResultFailure")})}).error(function(e){}):window.alipay.pay({tradeNo:c,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+c,price:n,notifyUrl:g},function(e){s.go("payResultSuccess")},function(e){s.go("payResultFailure")})}else alert("支付宝 插件不存在");else if("wxpay"==i){window.wechatPay||alert("微信支付插件未加载 ");var f={orderSn:o};a.wPay(f).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){t.showPay=!1,s.go("payResultSuccess")},function(e){s.go("payResultFailure")})}else alert("网络连接错误")}).error(function(e){alert(e)})}else"kjtpay"==i&&u.getMessage().success(function(e,t,i,n){if(e.data.kjtAccount&&e.data.kjtAccount.memberKjtpayAccount){var r={orderSn:o,kjtAmount:e.data.kjtAccount.memberKjtpayAccount};a.kjtPay(r).success(function(e){if(-200==e.errorCode)return void l.showAlert("提示",e.message,function(){});if(e.success){d.open(e.data).addEventListener("exit",function(e){s.go("orderManage")})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("bankCard")})}).error(function(){alert("网络失败")})}}]),APP.controller("spendBaiInstallmentController",["$scope","$state","$ionicHistory","spendBaiInstallmentService","$stateParams","UrlService","AfterOrderSubmitService","PopupService","PaymentService","$ionicLoading",function(e,t,o,i,s,n,a,r,c,l){e.isShowDet=!1,e.payList=[],e.totalFee=null,e.number=3,e.goBack=function(){e.$ionicGoBack()},e.showDetail=function(){e.isShowDet=!e.isShowDet},e.changeFenqiNum=function(t){e.number=t},e.toPay=function(){if(!e.number)return void r.showAlert("提示","请选择期数后付款",function(){});n.getHeadV2();c.orderPayCheck({orderSn:s.orderSn}).success(function(o){if(-200==o.errorCode)return void r.showAlert("提示",o.message,function(){});window.cordova?i.sendToPayApp(s.orderSn,e.number).success(function(e){if(e.success){var o=e.data.orderInfo;window.alipay.pay({payInfo:o},function(e){t.go("payResultSuccess")},function(e){t.go("payResultFailure")})}}):window.location.href=n.getZCUrl("HB_PAY_H5")+"?orderSn="+s.orderSn+"&number="+e.number})},e.$on("$ionicView.beforeEnter",function(){i.getHBCost(s.orderSn).success(function(t){t.success&&(e.payList=t.data.payList,e.totalFee=t.data.totalFee)}),e.number=3})}]),APP.service("spendBaiInstallmentService",["$http","UrlService",function(e,t){this.getHBCost=function(o){var i=t.getPayCenter("HB_COST")+"?callback=JSON_CALLBACK&orderSn="+o;return e.jsonp(i)},this.sendToPayApp=function(o,i){var s=t.getZCUrl("HB_PAY_APP")+"?orderSn="+o+"&number="+i;return e.get(s)}}]),APP.controller("CommodityListController",["$scope","$localstorage","$rootScope","UseCouponsService","$stateParams","$ionicScrollDelegate","PopupService",function(e,t,o,i,s,n,a){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.backGroundBlue={background:"url("+o.imgBaseURL+"img/couponblue.png) no-repeat","background-size":"100% 118px"},e.backGroundRed={background:"url("+o.imgBaseURL+"img/coupon.png) no-repeat","background-size":"100% 118px"},e.goBack=function(){e.$ionicGoBack()},e.productList=[],e.couponList=[];var r=s.couponId;e.hasmore=!1;var c=1;e.getShopData=function(){i.doInit(r,1,5).success(function(t){t.success?(t.coupon&&(e.couponList=t.coupon),t.productsList&&(e.productList=t.productsList),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)):a.showToast(t.message)})},e.loadMore=function(){c++,i.doInit(r,c,5).success(function(t,o,i,s){t.productsList&&(e.productList=e.productList.concat(t.productsList)),e.productList.length<t.storeItemsCounts?(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!0):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)})},e.$on("$ionicView.beforeEnter",function(){e.hasmore=!1,c=1,e.getShopData()})}]),APP.service("UseCouponsService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s){var n={couponId:o,startIndex:i,pageSize:s};return e.get(t.getUrl("USE_COUPONS_LIST"),n)}}]),APP.controller("GoodsSearchController",["$ionicHistory","$scope","GoodsSearchService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function($ionicHistory,$scope,GoodsSearchService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}function historyOldUse(){if(jl=localStorage.getItem("historys")){var e=jl.split("$$"),t=unique(e);t.length>10?(t.length=10,$scope.history=t):$scope.history=t}else $scope.hShow=!1,$scope.hShowB=!0}function searchStartNew(){$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.wdCommonSearchNew("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1).success(function(e,t,o,i){e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1).success(function(e,t,o,i){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))})}function searchStart(){window.cordova&&$rootScope.gio.evar.set({source:"Search",value:$scope.searchGoodsName.name}),$scope.searchValue=$scope.searchGoodsName.name,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.page=2,$ionicScrollDelegate.scrollTop(),0==$scope.front?GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!1).success(function(e,t,o,i){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))}):1==$scope.front&&GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!1).success(function(e,t,o,i){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1,$scope.filterParams=""):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))})}var Focus=document.querySelector("#focus");$scope.history=[],$scope.hShow=!0,$scope.hShowB=!0;var bv="",bvv="aicxyz",jl=localStorage.getItem("historys");$scope.hotWords="",$scope.lianXiWords="",$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.comprehensive=["img/comprehensive_black.png","img/comprehensive_white.png"],$scope.comprehensive_index=0,$scope.arrowState=["img/arrow_state_0.png","img/arrow_state_1.png","img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=["img/filter_state_0.png","img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commissionDesc","commission"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.switch=!0,$scope.productIds="",$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.front=$stateParams.front,$scope.shareStoreId=$stateParams.shareStoreId,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="",searchType="0",provinceId=16,cityId=173,districtId=2450,streetId=12036596;$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="全部",$scope.brandList=[],$scope.filterParameterArr=["all","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="";var u=navigator.userAgent;$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.settingsList="",-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.alWs=function(e){e?($scope.hotWordShow=!1,$scope.hShowB=!1,$scope.emptySearch=!1,$scope.hShow=!1,$scope.lianXC=!0,$scope.searchData=null,$scope.xyzShData=null,GoodsSearchService.associationalWords(e).success(function(e){$scope.lianXiWords=e.data})):($ionicScrollDelegate.scrollTop(),$scope.searchData=null,$scope.xyzShData=null,$scope.hShow=!0,$scope.hShowB=!1,historyOldUse(),$scope.emptySearch=!1,$scope.hotWordShow=!0,$scope.lianXC=!1,$scope.showTab=!1)},$scope.$on("$ionicView.enter",function(){"back"==bvv?($scope.showTab=!0,Focus.blur()):($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,setTimeout(function(){try{Focus.focus()}catch(e){}},200))}),$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.hotWordShow=!0,GoodsSearchService.hotWords().success(function(e){$scope.hotWords=e.data,$scope.hotWords||($scope.hotWordShow=!1)}),GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),bv=$ionicHistory.viewHistory().backView,bvv=t.direction,$scope.emptySearch=!1,$scope.isShowUp=!1,historyOldUse(),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,"back"==t.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{localStorage.getItem("historys")?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",searchType="0",$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.front=$stateParams.front,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,$scope.searchGoodsName={name:""}}}),$scope.sGoods=function(h){$scope.resetFilter(),$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.filterParams="",$scope.lianXC=!1,$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,$scope.searchGoodsName.name=h;var oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name;if(oldRecord){var Record=newRecord+"$$"+oldRecord;localStorage.setItem("historys",Record)}else localStorage.setItem("historys",newRecord);historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()})},$scope.searchGoods=function(){return $scope.resetFilter(),$scope.searchData="",$scope.xyzShData="",$scope.filterParams="",$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.chooseIndex=0,$scope.lianXC=!1,$scope.isShowUp=!1,""!=$scope.searchGoodsName.name||$scope.gsPlaceholder?$scope.gsPlaceholder&&""==$scope.searchGoodsName.name?void $scope.sGoods($scope.gsPlaceholder):void(""!=$scope.searchGoodsName.name&&(oldRecord=localStorage.getItem("historys"),newRecord=$scope.searchGoodsName.name,oldRecord?(Record=newRecord+"$$"+oldRecord,localStorage.setItem("historys",Record)):localStorage.setItem("historys",newRecord),historyOldUse(),MyStoreService.getPositionFromCookie().success(function(response){if(response.success)if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,searchStart()}else{var addressMessage=CommonAddressService.getAddressInfo();addressMessage?(provinceId=addressMessage.provinceId,cityId=addressMessage.cityId,districtId=addressMessage.areaId,streetId=addressMessage.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}}).error(function(e){var t=CommonAddressService.getAddressInfo();t?(provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId):(provinceId=16,cityId=17,districtId=2450,streetId=12036596),searchStart()}))):void PopupService.showToast("请填写搜索内容")},$scope.todoSomething=function(e){13==e.keyCode&&($scope.searchGoods(),Focus.blur())},$scope.changeState=function(e,t,o){1==t?GoodsSearchService.changeChooseStateJia(e,"1").success(function(e,t,i,s){1==e.success&&($scope.searchData[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):GoodsSearchService.changeChooseStateDui(e).success(function(e,t,i,s){1==e.success&&($scope.searchData[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.loadMore=function(){0==$scope.front?GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,2,$scope.filterParams,!0).success(function(e,t,o,i){0!=e.data.productList.length?($scope.searchData=$scope.searchData.concat(e.data.productList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=$scope.xyzShData.concat(e.products),$scope.searchData=$scope.xyzShData)})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)}):1==$scope.front&&GoodsSearchService.myStoreSearch($scope.page,"5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1,$scope.filterParams,!0).success(function(e,t,o,i){0!=e.data.productList.length?($scope.searchData=$scope.searchData.concat(e.data.productList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.page+=1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=$scope.xyzShData.concat(e.products),$scope.searchData=$scope.xyzShData)})):($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1)})},$scope.type={choose:[{text:"商品"},{text:"店名"},{text:"店铺码"}],typeId:["0","1","2"]};var placeholderList=["请填入名字或型号等关键字","请搜索店铺名称关键字","请搜索店铺码"];$scope.chooseType=function(e){$scope.isShowUp=!$scope.isShowUp,(e||0==e)&&($scope.searchGoodsName={name:""},$scope.hasmore=!1,$scope.searchData=null,$scope.xyzShData=null,$scope.page=2,$scope.typeChoose=$scope.type.choose[e].text,searchType=$scope.type.typeId[e],$scope.gsPlaceholder=placeholderList[e])},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($scope.resetFilter(),$ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[]}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.xyzShData=[];else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.xyzShData=[]}GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1).success(function(e,t,o,i){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))})}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,GoodsSearchService.myStoreSearch("1","5",memberId,$scope.searchGoodsName.name,searchType,provinceId,cityId,districtId,streetId,1==$scope.front?1:2,$scope.filterParams,!1).success(function(e,t,o,i){$scope.productIds=e.data.productCateIds?e.data.productCateIds:"",e.data.productList.length<=0?($scope.emptySearch=!0,$scope.hShow=!0,$scope.hotWordShow=!0,$scope.hShowB=!1,$scope.showTab=!1):($scope.emptySearch=!1,$scope.searchData=e.data.productList,$scope.showTab=!0,$scope.hasmore=!0,$scope.comprehensive_index=1,$scope.chooseIndex=0,$scope.showComprehensiveSub=!1,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.xyzShData=e.products,$scope.searchData=$scope.xyzShData)}))})},$ionicModal.fromTemplateUrl("templates/product/SearchFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t){var o=0,i=$scope.brandList.length;if("全部"==t.brandName){$scope.brandList[0].isActive=!0;for(var s=1;s<$scope.brandList.length;s++)$scope.brandList[s].isActive=!1}else{t.isActive=!t.isActive;for(var s=1;s<$scope.brandList.length;s++)$scope.brandList[s].isActive?o++:$scope.brandList[0].isActive=!1;if(0==o&&($scope.brandList[0].isActive=!0),o==i-1){$scope.brandList[0].isActive=!0;for(var s=1;s<$scope.brandList.length;s++)$scope.brandList[s].isActive=!1}}if($scope.brandList[0].isActive)$scope.filterParameterArr[1]="all";else{for(var n="",s=1;s<$scope.brandList.length;s++)$scope.brandList[s].isActive&&(n+=$scope.brandList[s].id+";");n=n.substring(0,n.length-1),$scope.filterParameterArr[1]=n}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.searchData=null,$scope.xyzShData=null,$scope.filterModal.hide(),$scope.lianXC=!1,searchStartNew(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){for(var e=0;e<$scope.brandList.length;e++)$scope.brandList[e].isActive=0==e;$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["all","all","0"],$scope.filterPrice={min:null,max:null},$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){$scope.filterModal.show(),GoodsService.getFilterData($scope.productIds).success(function(e){if(e.success){for(var t=e.data.brandList,o=0;o<t.length;o++)t[o].isActive=0==o;$scope.brandList=t}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()})}]),APP.service("GoodsSearchService",["$http","UrlService",function(e,t){this.wdCommonSearchNew=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),m)},this.selectionSearch=function(o,i,s,n,a,r,c,l,d,u){var p={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:u};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),p)},this.myStoreSearch=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("WDCOMMONSEARCHNEW"),m)},this.changeChooseStateJia=function(o,i){var s={productId:o,onShelf:i,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),s)},this.changeChooseStateDui=function(o){var i={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),i)},this.hotWords=function(){var o={platform:3};return e.get(t.getUrl("HOT_WORDS"),o)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.associationalWords=function(o){var i={searchKey:o,platform:3};return e.get(t.getUrl("ASSOCIATIONAL_WORDS"),i)}}]),APP.controller("SelectionController",["GoodsSearchService","$http","$scope","GoodsService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService",function(GoodsSearchService,$http,$scope,GoodsService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService){function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),getProductList($scope.memberId,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,1,"saleDesc","all",!1)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,i,s,n,a,r,c,l,d){GoodsService.getSelectionProducts(e,t,o,i,s,n,a,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}$scope.rightC={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"11px",right:"8px"},$scope.rightCd={position:"absolute",content:" ",height:"8px",width:"8px","border-radius":"100%","background-color":"red",top:"31px",right:"8px"},$scope.iosCss={width:"52px"};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},
$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"],$scope.filter_index=0;var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["priceDesc","price"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.gsPlaceholder="请搜索名字、型号等关键字",$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.slideImage=[];var typeList=["faxian","all","bx","xyj","kt","cd","rsq","cfdq","bg","zncp","shjd","sjd","bbjg","jtbj","sykt","sgch","jkqc","sm","shfw"];$scope.data={},$scope.tabNav="selection",$scope.productList=[],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[[!0],[!0]],$scope.selectedIndex=0,$scope.isFind=!0,$scope.hasFindData=!1,$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.isFindTab=!0,$scope.filterParameterArr=["hasStock","all","0"],$scope.filterOtherPatam=[],$scope.filterArray="",$scope.filterPrice={min:"",max:""},$scope.toggleLeft=function(){$ionicSideMenuDelegate.toggleLeft()},$scope.brand=!0,$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePriceRange=function(){$scope.priceRange=!$scope.priceRange},$scope.changeOther=function(e){$ionicScrollDelegate.resize(),$scope.otherState[e]=!$scope.otherState[e]},$scope.StockStateArr=["all","hasStock"],$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.chooseBrand=function(e){$scope.isBrand=[!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.isBrand[e]=!0,$scope.filterParameterArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName},$scope.isPriceRange=[!0,!1,!1,!1,!1,!1,!1],$scope.choosePriceRange=function(e){switch($scope.isPriceRange=[!1,!1,!1,!1,!1,!1,!1],$scope.isPriceRange[e]=!0,$scope.filterParameterArr[2]=e,e){case 0:$scope.priceName="全部";break;case 1:$scope.priceName="0～1000";break;case 2:$scope.priceName="1001～2000";break;case 3:$scope.priceName="2001～3000";break;case 4:$scope.priceName="3001～4000";break;case 5:$scope.priceName="4001～5000";break;case 6:$scope.priceName="5000以上"}},$scope.chooseOtherItem=function(e,t,o){for(var i=0;i<o;i++)$scope.isCurrent[e][i]=i===t;$scope.filterOtherPatam[e]=$scope.otherList[e].lstAttributeOptions[t].id,$scope.otherName[e]=$scope.otherList[e].lstAttributeOptions[t].optionValue},$scope.filterEnsure=function(){if($scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,""==$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(""==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&""==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max&&""!=$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e=$scope.filterParameterArr.join("@"),t=$scope.filterOtherPatam.join(";");$scope.filterArray=e+"@"+t,tabState[2]=$scope.filterArray,$scope.chooseIndex=2,$scope.page=1,$scope.filterModal.hide(),$scope.productList=[],$scope.init()},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:"",max:""},$scope.otherState=[!1,!1];for(var e=$scope.otherList.length,t=0;t<e;t++)$scope.filterOtherPatam[t]=0,$scope.isCurrent[t]=[!0,!1];$ionicScrollDelegate.resize()},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.changeStateFind=function(e,t,o){1==t?GoodsService.changeChooseStateJia($scope.memberId,e,"1").success(function(e,t,i,s){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺上架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺上架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui($scope.memberId,e).success(function(e,t,i,s){1==e.success?0==o?($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup("从店铺下架")):($scope.data.secondList[o-1].onShelf=!$scope.data.secondList[o-1].onShelf,$scope.showPopup("从店铺下架")):($scope.data.firstVo.onShelf=!$scope.data.firstVo.onShelf,$scope.showPopup(e.message))})},$scope.changeStateFindNormal=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,i,s){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺上架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))}):GoodsService.changeChooseStateDui(e).success(function(e,t,i,s){1==e.success?($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup("从店铺下架")):($scope.data.normalList[o].onShelf=!$scope.data.normalList[o].onShelf,$scope.showPopup(e.message))})},$scope.showSlideImage=!0,$scope.changeState=function(e,t,o){1==t?GoodsService.changeChooseStateJia(e,"1").success(function(e,t,i,s){1==e.success&&($scope.productList[o].onShelf=!0)}):GoodsService.changeChooseStateDui(e).success(function(e,t,i,s){1==e.success&&($scope.productList[o].onShelf=!1)})},$scope.selectTab=function(e){GoodsService.changeSuccess(typeList[e]).success(function(t,o,i,s){1==t.success&&(GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?($scope.otherList=e.data.filterMap.lstAttributes,$scope.resetFilter()):($scope.otherList=[],$scope.resetFilter()))}),$scope.page=1,$scope.selectedIndex=e,0!=$scope.selectedIndex?($scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.comprehensive_index=1,$scope.isFind=!1,$scope.isTab=!0,$scope.productList=[],$scope.requestParam="isHotDesc",$scope.init()):($scope.isFind=!0,$scope.isTab=!1,$scope.findInit()))})},$scope.toggleRight=function(){$ionicSideMenuDelegate.toggleRight()},$scope.chooseIndex=0,$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.filterModal.show(),GoodsService.getFilterData().success(function(e){e.success&&($scope.brandList=e.data.brandList,void 0!=e.data.filterMap?$scope.otherList=e.data.filterMap.lstAttributes:$scope.otherList=[])});else{if($scope.page=1,$scope.resetFilter(),0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-278+"px",top:"291px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"271px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"291px"}:$scope.comprehensiveSubHeight={height:"auto",top:"271px"});if(1==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=2==$scope.commission_index?1:2,$scope.requestParam=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.productList=[]}else if(3==e)$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.requestParam="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.productList=[];else if(4==e){$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.requestParam=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.productList=[]}$scope.init()}},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.page=1,$scope.loadMore=function(){0==$scope.selectedIndex?$scope.$broadcast("scroll.infiniteScrollComplete"):($scope.page+=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!0))},$scope.loadMoreProducts=function(e,t,o,i,s,n,a,r,c,l,d,u){GoodsService.loadMoreProducts(e,t,o,i,s,n,a,r,c,l,d,u).success(function(e,t,o,i){if(null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=$scope.productList.concat(e.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var s=$scope.productList.length;$scope.hasmore=!(s===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})},$scope.findInit=function(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!1).success(function(e,t,o,i){$scope.data={},$scope.hasFindData=!0,$scope.data=e,$scope.$broadcast("scroll.infiniteScrollComplete")})},$scope.init=function(){$scope.hasmore=!1,$scope.page=1,$scope.loadMoreProducts("1",$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5,typeList[$scope.selectedIndex],$scope.memberId,2==$scope.chooseIndex?$scope.filterArray:$scope.requestParam,1,!1)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getSlideImage=function(){GoodsService.getSlideImage().success(function(e,t,o,i){$scope.slideImage=[{},{},{}],$scope.slideImage=e.data.bannersList,$scope.memberId=e.data.memberId,$scope.storeId=e.data.storeId,$ionicSlideBoxDelegate.$getByHandle("selection_slider").update()})},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$scope.getAddress=function(){GoodsService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$ionicModal.fromTemplateUrl("templates/product/SelectionFilterModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,i){e.success&&$scope.selectTab($scope.selectedIndex)})}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.requestParam="isHotDesc"),$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.init()},$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.showComprehensiveSub=!1,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,GoodsSearchService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),ShopService.getMessage().success(function(e){e.data.count>0?$scope.flagNum=!0:$scope.flagNum=!1}),"back"!=t.direction&&($scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.getSlideImage(),initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0))}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.controller("SpecificationsController",["$scope","spacificationsService","$stateParams","$ionicPopup","$rootScope",function(e,t,o,i,s){e.$on("$ionicView.beforeEnter",function(){e.flag=!1,e.tabNav="selection",e.productId=o.productId,t.doInit(e.productId).success(function(t,o,i,s){null==t.data?e.flag=!0:(e.flag=!1,e.data=t.data.productAttrs)})})}]),APP.service("spacificationsService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={productId:o};return e.get(t.getUrl("ORDERDETAIL_SPECIFICATIONS"),i)}}]),APP.controller("applyForCardController",["AfterOrderSubmitService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","PaymentService","$ionicLoading","$ionicHistory","PopupService","InAppBrowserService","EasyConnectService","$ionicPopup","$http","UrlService","WhiteShowsService","UserService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.toApplyForCard=function(e){var t=null;1==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11753&pro_code=FHTG107707SJ01HESG":2==e?t="https://xyk.cebbank.com/cebmms/apply/ps/card-index.htm?req_card_id=11754&pro_code=FHTG107707SJ01HESG":3==e&&(t="https://xyk.cebbank.com/cebalipay/apply/fz/card-app-status.htm"),window.cordova?3==e?window.emc.presentH5View(t,"查询联名卡进度"):window.emc.presentH5View(t,"联名卡申请"):window.location.href=t}}]),APP.controller("BranchTypeController",["HomePageService","$http","$scope","BranchTypeService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","CommonAddressService","BannerThemeService","$localstorage","VersionService","PopupService","ShopService","ProductDetailService",function(HomePageService,$http,$scope,BranchTypeService,$stateParams,$ionicSlideBoxDelegate,$state,$ionicSideMenuDelegate,$cookieStore,UserService,$ionicPopup,$timeout,LoginService,$rootScope,$ionicScrollDelegate,$ionicModal,CommonAddressService,BannerThemeService,$localstorage,VersionService,PopupService,ShopService,ProductDetailService){function getThreeTwoCategory(e){$ionicSlideBoxDelegate.slide(0),BranchTypeService.GetLeftDataList(e).success(function(t){if(t.success){0==t.data.length?$scope.isListNull=!0:$scope.isListNull=!1;for(var o=[],i=[],s=0;s<t.data.length;s++)t.data[s].parentId==e&&2==t.data[s].levels?(t.data[s].children=[],o.push(t.data[s])):1==t.data[s].levels&&i.push(t.data[s]);for(var s=0;s<t.data.length;s++)for(var n=0;n<o.length;n++)t.data[s].parentId==o[n].id&&o[n].children.push(t.data[s]);$scope.rightDataList=o,$scope.slideImage=i,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()}else $scope.isListNull=!0,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start()})}function initNew(){$scope.selectedIndex=0,$scope.hasmore=!1,$scope.isFind=!0,$scope.isTab=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),BranchTypeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex)})}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?($scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.regionId=e.areaId,$scope.streetId=e.streetId,$scope.region=e.regionName):($scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId="2450",$scope.streetId="12036596")}function getProductList(e,t,o,i,s,n,a,r,c,l,d){BranchTypeService.getSelectionProducts(e,t,o,i,s,n,a,r,c,l,d).success(function(e){if(e.data.is_show_find)$scope.isFind=!0,$scope.isTab=!1,$scope.isFindTab=!0,$scope.hasmore=!1,$scope.hasFindData=!0,$scope.selectedIndex=0,$ionicScrollDelegate.scrollTop(),$scope.data=e.data;else if($scope.isFind=!1,$scope.isTab=!0,$scope.isFindTab=!1,$scope.hasmore=!1,$scope.selectedIndex=1,$scope.chooseIndex=0,null!=e.data.productsList&&void 0!=e.data.productsList&&0!=e.data.productsList.length){$scope.productList=e.data.productsList,$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.data.storeItemsCounts)}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,$scope.productList=[]})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.flagNum=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.leftDataList="",$scope.rightDataList="",$scope.leftDataListIndex="0",$scope.ParentParentId="0",$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.iSDataLeftRight=!1,$scope.inntDataList=function(){ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),BranchTypeService.GetLeftDataList($scope.ParentParentId).success(function(e){e.success&&e.data.length>0?($scope.leftDataList=e.data,getThreeTwoCategory(e.data[$scope.leftDataListIndex].id)):($scope.leftDataList="",$scope.rightDataList="",$scope.iSDataLeftRight=!0)})},BranchTypeService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),$scope.$watch("slideImage",function(){$ionicSlideBoxDelegate.update()}),$scope.learnRsq=function(){window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.showSlideImage=!0,$scope.slideImage=[],$scope.bannerClick=function(e){var t=e.bannerId,o=e.url,i=o.split("&");switch(e.linkType){case-1:BannerThemeService.getBannerTheme(t).success(function(e){$state.go("bannerDaily",{bannerId:t,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:t});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.memberId});break;case 2:if(o){var n=o.slice(o.indexOf("=1"));$state.go("couponsDetail",{cId:n,userID:$scope.memberId,type:2})}else $state.go("getCouponsList");break;case 3:var a=o.split("=")[1];$state.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=o.indexOf("m.ehaier.com/www/index.html")){var r=o.slice(o.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(o,"");else window.open(o,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:o?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:o,storeId:$scope.memberId}):$state.go("newSend");break;case 8:o?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.isFindTab=!0,$scope.selectTab=function(e,t){$scope.leftDataListIndex=t,getThreeTwoCategory(e),$ionicScrollDelegate.$getByHandle("branchtype-right-scroll").scrollTop()},$scope.brenchToChild=function(e){$state.go("branchTypeDetail")};var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.memberId="";var sgWeidianMid=20219251;$scope.storeId=$localstorage.get("storeId",sgWeidianMid),$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.panAddressSel=!1,$scope.hasmore=!1,$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue;$scope.data={},$scope.tabNav="branchType",$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1
;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,BranchTypeService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",BranchTypeService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;BranchTypeService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.getAddress=function(){BranchTypeService.getAddress().success(function(response,status,headers,config){if(null==response.data)getCurrentPosition(),$scope.findInit();else{var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId;var regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),$scope.findInit()}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.closeModal=function(){$scope.filterModal.hide()},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,BranchTypeService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,i){e.success})}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.inntDataList(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").update(),$ionicSlideBoxDelegate.$getByHandle("selection_slider").loop(!0),$ionicSlideBoxDelegate.$getByHandle("selection_slider").start(),$scope.showComprehensiveSub=!1,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIos1=!0:$scope.isIos1=!1,"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.memberId=UserService.getUser().mid,$scope.buttonShow=!1,$scope.page=1,$scope.hasmore=!1,$scope.buttonBuyerShow=!1,$scope.isBuyer=LoginService.getRole(),$scope.isWdHost=$scope.isBuyer,$scope.dataAdd=null,$scope.defaultValue=null,initNew(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0)}),$scope.$on("$destroy",function(){$scope.filterModal&&$scope.filterModal.remove(),$scope.addressModal&&$scope.addressModal.remove()})}]),APP.service("BranchTypeService",["$http","UrlService",function(e,t){this.changeSuccess=function(o){var i={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),i)},this.GetLeftDataList=function(o){var i={parentId:o,timer:(new Date).getTime()};return e.get(t.getZCUrl("GETNAVIGATIONS"),i)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,i,s,n,a){var r={provinceName:o,cityName:i,regionName:s,streetName:n,gbCode:a,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getSelectionProducts=function(o,i,s,n,a,r,c,l,d,u,p){var g={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:u,flag:"",productCateId:"",noLoading:p};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)}}]),APP.controller("BranchTypeDetailController",["HomePageService","$ionicHistory","$scope","BranchTypeDetailService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(HomePageService,$ionicHistory,$scope,BranchTypeDetailService,$ionicPopup,$timeout,$ionicActionSheet,UserService,MyStoreService,CommonAddressService,$stateParams,$localstorage,$rootScope,PopupService,LoginService,$ionicScrollDelegate,$ionicModal,GoodsService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function unique(e){for(var t=[],o=0;o<e.length;o++)-1==t.indexOf(e[o])&&t.push(e[o]);return t}if($scope.attributeId="",$scope.brandId="",$scope.productCateId="",$scope.productCateIdType="0",$scope.filterData="",$scope.switch=!0,$scope.isListNull=!1,$scope.gsPlaceholder="",$scope.storeId="",BranchTypeDetailService.defaultSearch().success(function(e){$scope.gsPlaceholder=e.data.hot_word}),-1!=$stateParams.productCateId.indexOf("brandId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.brandId=arr[0].split("=")[1],$scope.productCateIdType="1",$scope.filterData="hasStock@"+$scope.brandId+"@0",$scope.productCateId=arr[1].split("=")[1]}else if(-1!=$stateParams.productCateId.indexOf("&productCateId")){$scope.chooseIndex="2",$scope.filter_index=1;var arr=$stateParams.productCateId.split("&");$scope.productCateId=arr[1].split("=")[1],$scope.attributeId=arr[0].split("=")[1],$scope.productCateIdType="2",$scope.filterData="hasStock@all@0@"+$scope.attributeId}else $scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateId=$stateParams.productCateId.split("=")[1],$scope.productCateIdType="0",$scope.filterData="isHotDesc";$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.pageIndex="1",$scope.pageSize="5",$scope.memberId=UserService.getUser().mid,$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.locationImgUrltransform90={transform:"rotate(90deg)"},$scope.changeColor={"font-size":"17px"},$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.isShowUp=!1,$scope.isIos=!1,$scope.screenWidth=window.screen.width,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="";var u=navigator.userAgent;-1!=u.indexOf("iPhone")?$scope.isIos=!0:$scope.isIos=!1,$scope.screenWidth<375?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:$scope.screenWidth<414?$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:$scope.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},$scope.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},$scope.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),$scope.changePadding=function(){Focus.value.length>0?$scope.inputPadding={"padding-right":"30px"}:$scope.inputPadding={"padding-right":"0px"}},$scope.clearLocal=function(){localStorage.removeItem("historys"),$scope.hShow=!1,$scope.hShowB=!0},$scope.$on("$ionicView.beforeEnter",function(e,v){if(GetSwitchChecked(),$scope.isBuyer=LoginService.getRole(),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost}),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.topStyle={top:"64px"}:$scope.topStyle={top:"44px"},$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.userId=UserService.getUser().mid,"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1;else{var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,$scope.searchGoodsName={name:""},BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.streetId=obj[0].streetId,$scope.districtId=obj[0].areaId}$scope.pageIndex=1,$scope.ResGetList()})}if(0==$scope.isBuyer?$scope.storeId=$localstorage.get("storeId","20219251"):$scope.storeId=$scope.userId,$scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}$scope.hasmore=!0}),$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.contentDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=e.products,$scope.contentDataList=$scope.contentDataListxyz)})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=$scope.contentDataListxyz.concat(e.products),$scope.contentDataList=$scope.contentDataListxyz)})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($ionicScrollDelegate.scrollTop(),$scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($scope.resetFilter(),$ionicScrollDelegate.scrollTop(),$scope.page=2,0==e)return $scope.showComprehensiveSub=!$scope.showComprehensiveSub,void($scope.showComprehensiveSub?-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"108px"}:$scope.comprehensiveSubHeight={height:window.innerHeight-44+"px",top:"88px"}:-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.comprehensiveSubHeight={height:"auto",top:"108px"}:$scope.comprehensiveSubHeight={height:"auto",top:"88px"});if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.filterData=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.filterData="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var i=o.length-1,s=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var n=0;n<o.length;n++)n>0&&"true"==o[n].active&&(o[0].active="false",s++);if(s==i||0==s){for(var n=0;n<o.length;n++)n>0&&(o[n].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var n=0;n<o.length;n++)n>0&&(o[n].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if($ionicScrollDelegate.scrollTop(),null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var i=0;i<$scope.lstAttributes[t].lstAttributeOptions.length;i++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[i].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[i].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.contentDataList=[],$scope.contentDataListxyz=[],$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$ionicScrollDelegate.scrollTop(),$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].id==$scope.attributeId?(o[t].lstAttributeOptions[s].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,i=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&"true"==t.lstAttributeOptions[s].active&&(t.lstAttributeOptions[0].active="false",i++);if(i==o||0==i){for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,i,s){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,i,s){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})}}]),APP.service("BranchTypeDetailService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,i,s,n,a,r,c,l,d,u){if(d)var p={pholder:o,provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:r,pageSize:c,productCateId:l,memberId:d,filterData:u,fromType:"1",noLoading:!0};else var p={pholder:o,provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:r,pageSize:c,productCateId:l,filterData:u,fromType:"1",noLoading:!0,memberId:void 0};return e.get(t.getUrl("COMMONLOADITEMNEW"),p)},this.getFilterData=function(o){var i={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),i)},this.changeChooseStateJia=function(o,i){var s={productId:o,onShelf:i,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),s)},this.changeChooseStateDui=function(o){var i={productId:o,noLoading:!0};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),i)},this.defaultSearch=function(){var o={platform:3};return e.get(t.getUrl("DEFAULTSEARCH_WORDS"),o)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))}}]),APP.controller("ElectricalMallController",["BannerThemeService","$ionicHistory","$interval","ElectricalMallService","$ionicSlideBoxDelegate","$ionicScrollDelegate","HomePageService","GoodsService","BranchTypeDetailService","$q","$ionicModal","CalculateStrLength","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","LoginService","$localstorage","$rootScope","$stateParams","$ionicPopup","PopupService",function(BannerThemeService,$ionicHistory,$interval,ElectricalMallService,$ionicSlideBoxDelegate,$ionicScrollDelegate,HomePageService,GoodsService,BranchTypeDetailService,$q,$ionicModal,CalculateStrLength,InAppBrowserService,CreditService,ShopService,$scope,$timeout,UserService,$state,LoginService,$localstorage,$rootScope,$stateParams,$ionicPopup,PopupService){function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),i=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:i}}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}$scope.productCateId="2723",$scope.filterData="",$scope.switch=!0,$scope.isListNull=!1,$scope.chooseIndex="0",$scope.filter_index=0,$scope.productCateIdType="0",$scope.filterData="isHotDesc",$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.pageIndex="1",$scope.pageSize="5",$scope.pholder="1",$scope.provinceId="16",$scope.cityId="173",$scope.districtId="2450",$scope.streetId="12036596",$scope.flashHour="",$scope.flashText="",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.memberId=UserService.getUser().mid,$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid;var memberId="";$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.noLoading="false",$scope.lstAttributes=[],$scope.hasmore=!1,$scope.settingsList="",$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.comprehensive=[$rootScope.imgBaseURL+"img/comprehensive_black.png",$rootScope.imgBaseURL+"img/comprehensive_white.png"],$scope.comprehensive_index=1,$scope.arrowState=[$rootScope.imgBaseURL+"img/arrow_state_0.png",$rootScope.imgBaseURL+"img/arrow_state_1.png",$rootScope.imgBaseURL+"img/arrow_state_2.png"],$scope.commission_index=0,$scope.price_index=0,$scope.filterState=[$rootScope.imgBaseURL+"img/filter_state_0.png",$rootScope.imgBaseURL+"img/filter_state_1.png"];var tabState=["isHotDesc",["commission","commissionDesc"],"","saleDesc",["price","priceDesc"]];$scope.comprehensiveSub=["人气优先"],$scope.selectComprehensiveSubIndex=0,$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.iSPrice=!0,$scope.brand=!0,$scope.brandName="",$scope.brandList=[],$scope.filterParameterArr=["hasStock","all","0"],$scope.StockStateArr=["all","hasStock"],$scope.filterPrice={min:null,max:null},$scope.filterParams="",$scope.datatypeNameArr=[{productCateId:"2723",name:"冰箱"},{productCateId:"2725",name:"洗衣机"},{productCateId:"2729",name:"空调"},{productCateId:"2743",name:"彩电"},{productCateId:"2741",name:"热水器"},{productCateId:"2742",name:"厨房电器"},{productCateId:"2726",name:"冷柜"},{productCateId:"2973",name:"智能产品"},{productCateId:"2737",name:"生活家电"},{productCateId:"2774",name:"水家电"},{productCateId:"2736",name:"家庭医疗"},{productCateId:"2811",name:"家用中央空调"}],$scope.storeId=UserService.getUser().mid,$scope.countTime={},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.selectedIndex=0,$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.goToSearch=function(){$state.go("goodsSearch",{front:1})},$scope.loadMore=function(){$scope.pageIndex=1*$scope.pageIndex+1,$scope.getListInit()},$scope.ResGetList=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=t,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.conDataListxyz=e.products,$scope.contentDataList=$scope.conDataListxyz)})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message;PopupService.showToast(o)}})},$scope.getListInit=function(){BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData).success(function(e){if(e.success){if("list获取商品数据为空"==e.message&&1==$scope.pageIndex?$scope.isListNull=!0:$scope.isListNull=!1,e.data.productList){var t=e.data.productList;$scope.contentDataList=$scope.contentDataList.concat(t),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.conDataListxyz=$scope.conDataListxyz.concat(e.products),$scope.contentDataList=$scope.conDataListxyz)})}5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1}else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var o=e.message
;PopupService.showToast(o)}})},$scope.showPopup=function(e){var t=$ionicPopup.show({template:e});$timeout(function(){t.close()},1e3)},$scope.chooseTab=function(e){if($scope.chooseIndex!=e||3!=e)if(2==e)$scope.filter_index=1,$scope.chooseIndex=e,$scope.comprehensive_index=0,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=1,$scope.showComprehensiveSub=!1,$scope.openFilterModal();else{if($scope.resetFilter(),$scope.page=2,0==e)return void($scope.showComprehensiveSub=!$scope.showComprehensiveSub);if(1==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var t=1==$scope.commission_index?0:1;$scope.commission_index=1==$scope.commission_index?2:1,$scope.filterParams=tabState[1][t],$scope.comprehensive_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData=1==t?"commission":"commissionDesc"}else if(3==e)$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1,$scope.filterParams="saleDesc",$scope.price_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.filter_index=0,$scope.searchData=[],$scope.filterData="saleDesc";else if(4==e){$scope.lianXC=!1,$scope.chooseIndex=e,$scope.showComprehensiveSub=!1;var o=1==$scope.price_index?0:1;$scope.price_index=1==$scope.price_index?2:1,$scope.filterParams=tabState[4][o],$scope.filter_index=0,$scope.commission_index=0,$scope.comprehensive_index=0,$scope.searchData=[],$scope.filterData=1==o?"price":"priceDesc"}$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()}},$scope.closeComprehensiveSub=function(){$scope.showComprehensiveSub=!$scope.showComprehensiveSub},$scope.selectComprehensiveSub=function(e,t){t.stopPropagation(),0==e&&($scope.filterParams="isHotDesc",$scope.filterData="isHotDesc"),$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=e,$scope.showComprehensiveSub=!$scope.showComprehensiveSub,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList()},$ionicModal.fromTemplateUrl("templates/product/branchTypeDetailModal.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.changeBrand=function(){$scope.brand=!$scope.brand},$scope.changePrice=function(){$scope.iSPrice=!$scope.iSPrice},$scope.chooseStockState=function(e){$scope.filterParameterArr[0]=$scope.StockStateArr[e]},$scope.chooseBrand=function(e,t,o){var i=o.length-1,s=0;if(0!=t.id){"false"==t.active?t.active="true":t.active="false";for(var n=0;n<o.length;n++)n>0&&"true"==o[n].active&&(o[0].active="false",s++);if(s==i||0==s){for(var n=0;n<o.length;n++)n>0&&(o[n].active="false");o[0].active="true"}}else if("false"==t.active){t.active="true";for(var n=0;n<o.length;n++)n>0&&(o[n].active="false")}},$scope.filterEnsure=function(){if($scope.filterPrice.min<0||$scope.filterPrice.max<0)return void PopupService.showToast("价格不能为负数");if(isNaN($scope.filterPrice.min)||isNaN($scope.filterPrice.max))return void PopupService.showToast("价格为数字");if(null==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]="0";else if(null==$scope.filterPrice.min&&""!=$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(null==$scope.filterPrice.min&&"0"==$scope.filterPrice.max)$scope.filterParameterArr[2]="Undefined;"+$scope.filterPrice.max;else if(""!=$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else if("0"==$scope.filterPrice.min&&null==$scope.filterPrice.max)$scope.filterParameterArr[2]=$scope.filterPrice.min+";Undefined";else{if($scope.filterPrice.min>$scope.filterPrice.max)return void PopupService.showToast("最低价不能高于最高价");$scope.filterParameterArr[2]=$scope.filterPrice.min+";"+$scope.filterPrice.max}var e="";if("true"==$scope.brandList[0].active)e="all;";else for(var t=1;t<$scope.brandList.length;t++)"true"==$scope.brandList[t].active&&(e+=$scope.brandList[t].id+";");e=e.substring(0,e.length-1),$scope.filterParameterArr[1]=e;for(var o="",t=0;t<$scope.lstAttributes.length;t++){for(var i=0;i<$scope.lstAttributes[t].lstAttributeOptions.length;i++){if("true"==$scope.lstAttributes[t].lstAttributeOptions[0].active){o+="0;";break}"true"==$scope.lstAttributes[t].lstAttributeOptions[i].active&&(o+=$scope.lstAttributes[t].lstAttributeOptions[i].id+";")}o+=","}o=o.replace(/;,/g,","),$scope.filterParams=$scope.filterParameterArr.join("@"),$scope.filterParams=$scope.filterParams+"@"+o,$scope.filterData=$scope.filterParams,$scope.searchData=null,$scope.filterModal.hide(),$scope.lianXC=!1,$scope.pageIndex=1,$scope.hasmore=!1,$scope.ResGetList(),$scope.chooseIndex=2,$scope.filter_index=1},$scope.resetFilter=function(){$scope.brand=!0,$scope.brandName="全部",$scope.isBrand=[!0,!1,!1,!1,!1,!1,!1,!1,!1],$scope.filterParameterArr=["hasStock","all","0"],$scope.filterPrice={min:null,max:null};var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.ResGetFilterDataLists(e),$ionicScrollDelegate.resize()},$scope.closeModal=function(){$scope.filterModal.hide()},$scope.openFilterModal=function(){var e="";1!=$scope.productCateIdType&&(e=$scope.productCateId),$scope.filterModal.show(),$scope.switch&&($scope.switch=!1,$scope.getFilterDataLists(e))},$scope.getFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){if($scope.brandId)for(var t=0;t<e.data.brandList.length;t++)$scope.brandId==e.data.brandList[t].id?e.data.brandList[t].active="true":e.data.brandList[t].active="false";else for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap){if(0==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}if(2==$scope.productCateIdType){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].id==$scope.attributeId?(o[t].lstAttributeOptions[s].active="true",o[t].lstAttributeOptions[0].active="false"):o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}}})},$scope.ResGetFilterDataLists=function(e){BranchTypeDetailService.getFilterData(e).success(function(e){if(e.success){for(var t=0;t<e.data.brandList.length;t++)e.data.brandList[t].active=0==t?"true":"false";if($scope.brandList=e.data.brandList,null!=e.data.filterMap&&($scope.productCateIdType,!0)){for(var o=e.data.filterMap.lstAttributes,i=[],t=0;t<o.length;t++)if(null!=o[t]&&o[t].lstAttributeOptions.length){o[t].down="true";for(var s=0;s<o[t].lstAttributeOptions.length;s++)o[t].lstAttributeOptions[s].active=0==s?"true":"false";i.push(o[t])}$scope.lstAttributes=i}}})},$scope.changeDown=function(e){e.down=!e.down},$scope.ClickAttributes=function(e,t){var o=t.lstAttributeOptions.length-1,i=0;if(0!=e.id){"false"==e.active?e.active="true":e.active="false";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&"true"==t.lstAttributeOptions[s].active&&(t.lstAttributeOptions[0].active="false",i++);if(i==o||0==i){for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false");t.lstAttributeOptions[0].active="true"}}else if("false"==e.active){e.active="true";for(var s=0;s<t.lstAttributeOptions.length;s++)s>0&&(t.lstAttributeOptions[s].active="false")}},$scope.changeState=function(e,t,o){1==t?BranchTypeDetailService.changeChooseStateJia(e,"1").success(function(e,t,i,s){1==e.success&&($scope.contentDataList[o].onShelf=!0,$scope.showPopup("从店铺上架"))}):BranchTypeDetailService.changeChooseStateDui(e).success(function(e,t,i,s){1==e.success&&($scope.contentDataList[o].onShelf=!1,$scope.showPopup("从店铺下架"))})},$scope.$on("$destroy",function(){$scope.filterModal.remove()}),$scope.selectTab=function(e){$scope.filterParams="isHotDesc",$scope.filterData="isHotDesc",$scope.lianXC=!1,$scope.selectComprehensiveSubIndex=0,$scope.showComprehensiveSub=!1,$scope.chooseIndex=0,$scope.productList=[],$scope.comprehensive_index=1,$scope.commission_index=0,$scope.price_index=0,$scope.filter_index=0,$scope.pageIndex=1,$scope.hasmore=!1,$scope.pageIndex="1",$scope.selectedIndex=e,$scope.productCateId=$scope.datatypeNameArr[e].productCateId,$scope.resetFilter(),BranchTypeDetailService.loadMoreProducts($scope.pholder,$scope.provinceId,$scope.cityId,$scope.districtId,$scope.streetId,$scope.pageIndex,$scope.pageSize,$scope.productCateId,$scope.memberId,$scope.filterData).success(function(e){if(e.success)"list获取商品数据为空"==e.message&&1==$scope.pageIndex?($scope.isListNull=!0,$scope.contentDataList=[],$scope.conDataListxyz=[]):$scope.isListNull=!1,e.data.productList&&($scope.contentDataList=e.data.productList,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.conDataListxyz=e.products,$scope.contentDataList=$scope.conDataListxyz)})),5*$scope.pageIndex<=e.totalCount?($scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!0):$scope.hasmore=!1;else{$scope.contentDataList=[],$scope.conDataListxyz=[],$scope.isListNull=!0;var t=e.message;PopupService.showToast(t)}})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case 2:if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.init=function(){$scope.hasmore=!1,ElectricalMallService.getTopMsg().success(function(e){$scope.bannerList=e.data.topBannerList,$scope.midActivtyList=e.data.midActivtyList,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.districtId=e.areaId,$scope.streetId=e.streetId,getFlashSales(),ElectricalMallService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId,1).success(function(e){$scope.floors=e.data.floors,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),$scope.page=1,$scope.getListInit()}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.backToTop=function(){$ionicScrollDelegate.scrollTo(0,$scope.scrollFixedTop,!0)},$scope.onScroll=function(){$scope.scrollTop=$ionicScrollDelegate.getScrollPosition().top,$scope.scrollFixedTop=$(".scrollFixed")[0].offsetTop,$scope.$apply(function(){$scope.showBackToTopImg=$scope.scrollTop>$scope.scrollFixedTop})},$scope.$on("$ionicView.enter",function(e,t){$(".backToTop").attr("totop",$(".scrollFixed")[0].offsetTop),$("go-top").attr("totop",$(".scrollFixed")[0].offsetTop),ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeEnter",function(e,v){if($scope.showBackToTopImg=!1,GetSwitchChecked(),$scope.showTab=!1,$scope.filterParams="",$scope.lianXC=!1,$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==v.direction)$scope.hShow=!1,$scope.hotWordShow=!1,$scope.hShowB=!1,HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});else{$scope.showFlashSale=!1;var lll=localStorage.getItem("historys");lll?($scope.hShow=!0,$scope.hShowB=!1):($scope.hShow=!1,$scope.hShowB=!0),$scope.tabNav="selection",$scope.hasmore=!1,$scope.typeChoose="商品",$scope.page=2,memberId=$stateParams.shareStoreId?$stateParams.shareStoreId:UserService.getUser().mid,BranchTypeDetailService.getAddress().success(function(res){if(null!=res.data){var obj=eval(res.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.areaId=obj[0].areaId}}),$scope.init(),$ionicScrollDelegate.scrollTop()}if($scope.contentDataList.length>0){var obj=$scope.contentDataList[0];1==LoginService.getRole()&&void 0==obj.commission&&$scope.ResGetList()}}),$scope.$on("$ionicView.beforeLeave",function(e,t){$interval.cancel($scope.timer),$interval.cancel($scope.timer1)})}]),APP.service("ElectricalMallService",["$http","UrlService",function(e,t){this.getTopMsg=function(){return e.get(t.getNewUrl("ELECTRICALMALL_TOP"))},this.getMiddleMsg=function(o,i,s,n,a){var r={provinceId:o,cityId:i,districtId:s,street:n,position:a};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),r)}}]),APP.controller("familydetailController",["$scope","$stateParams","$sce",function(e,t,o){e.detailUrl=o.trustAsResourceUrl(t.detailUrl),e.title=t.title,e.goBack=function(){$("#iframecontainer").remove(),e.$ionicGoBack()}}]),APP.controller("familytryController",["$scope","$state",function(e,t){e.gotojianyue=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/",title:"简约风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/82eb468ac50d11e7af3000163e127a92/","_blank","location=yes")},e.gototianyuan=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/",title:"田园风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/882f1e94cd0c11e79de600163e127a92/","_blank","location=yes")},e.gotohunda=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/",title:"混搭风格"}):window.open("http://3d.haier.net/ifuwo/pano/design/0cc5660c771f11e7b94b00163e127a92/","_blank","location=yes")},e.gotocity=function(){window.cordova?t.go("familydetail",{detailUrl:"http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/",title:"城市智慧生活"}):window.open("http://3d.fuwo.com/pano/series/ecfb1b94e17911e78c1e00163e0018da/","_blank","location=yes")}}]),APP.controller("furnishController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","$q","GoodsService","HomePageService","CalculateStrLength","furnishService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,$q,GoodsService,HomePageService,CalculateStrLength,furnishService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,furnishService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),furnishService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishTypeId=[3347,3379,3461,3453,3465,2832,3467,3477],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.dealPrice=CalculateStrLength.dealPrice,$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.AdornhomeCates[e].id),$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case"2":if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),furnishService.getAdornhomeCates().success(function(e){$scope.AdornhomeCates=e.data,getFurnishAllData($scope.AdornhomeCates[0].id)}),furnishService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("furnish_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.furnish_xScroll div").eq(0).width(),i=$("div.furnish_xScroll div:eq(0)")[0].offsetLeft;$("div.furnish_xScroll div:not(:last)").css("color","#000000"),$("div.furnish_xScroll div:eq(0)").css("color","#2979FF"),$("div.furnish_xScroll div.runningBox").css({width:o,left:i})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="forword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("furnishService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("FURNISH_BANNER"))},this.getFurnishTop=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("FURNISH_TOP"),r)},this.getFurnishBottom=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("FURNISH_BOTTOM"),r)},this.getAdornhomeCates=function(){return e.get(t.getNewUrl("ADORNHOME_CATES"))}}]),APP.controller("HomePageController",["$ionicPlatform","$ionicHistory","UrlService","trueAuthenticationService","$localstorage","GoodsSearchService","RegisterService","$ionicModal","ShopService","$q","GoodsService","CalculateStrLength","$interval","$http","$scope","$stateParams","$ionicSlideBoxDelegate","$state","UserService","$timeout","$rootScope","$ionicScrollDelegate","CommonAddressService","BannerThemeService","PopupService","HomePageService","ProductDetailService",function($ionicPlatform,$ionicHistory,UrlService,trueAuthenticationService,$localstorage,GoodsSearchService,RegisterService,$ionicModal,ShopService,$q,GoodsService,CalculateStrLength,$interval,$http,$scope,$stateParams,$ionicSlideBoxDelegate,$state,UserService,$timeout,$rootScope,$ionicScrollDelegate,CommonAddressService,BannerThemeService,PopupService,HomePageService,ProductDetailService){function renderCountDown(e){$scope.countTime={};var t=parseInt(e%864e5/36e5),o=parseInt(e%36e5/6e4),i=Math.floor(e%6e4/1e3);$scope.countTime={hours:t,minutes:o,seconds:i}}function confetti(){$.each($(".sg_notice_content"),function(){for(var e=$(this).width()/50*10,t=0;t<=e;t++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')})}function getFlashSales(){$interval.cancel($scope.timer),$interval.cancel($scope.timer1),HomePageService.getFlashSales($scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){if(e.data.flashProductList){$scope.flashProductList=e.data.flashProductList,$scope.isWd=e.data.isWd,$scope.flashTime=e.data.flashTime,$scope.systemTime=e.data.systemTime,$scope.preheatingTime=e.data.preheatingTime;var t=new Date($scope.flashTime).getMinutes().toString();$scope.flashHour="0"==t?new Date($scope.flashTime).getHours()+"点场":new Date($scope.flashTime).getHours()+"点半场",0==$scope.flashProductList.length||$scope.systemTime-new Date($scope.flashProductList[0].endTime).getTime()>-1e3||$scope.systemTime<$scope.preheatingTime?$scope.showFlashSale=!1:($scope.showFlashSale=!0,$scope.systemTime-new Date($scope.flashTime).getTime()>-1e3?($scope.timer=$interval(function(){new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer),getFlashSales()),renderCountDown(new Date($scope.flashProductList[0].endTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="结束"},1e3)):($scope.timer1=$interval(function(){new Date($scope.flashTime).getTime()-$scope.systemTime<1e3&&($interval.cancel($scope.timer1),getFlashSales()),renderCountDown(new Date($scope.flashTime).getTime()-$scope.systemTime),$scope.systemTime+=1e3},1e3),$timeout(function(){$scope.flashText="开始"},1e3)))}else $scope.showFlashSale=!1})}function Format(e){return e=e<10?"0"+e:e}function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){if(null==res.data){var addressMessage=CommonAddressService.getAddressInfo();if(addressMessage)$scope.region=addressMessage.regionName,deferred.resolve(addressMessage);else{$scope.region="崂山区";var obj={provinceId:"16",cityId:"173",regionId:"2450",streetId:"12036596"};deferred.resolve(obj)}}else{var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}}),deferred.promise}function readCache(){var e=$localstorage.get("homepage_hot_word"),t=$localstorage.getObject("homepage_topMsg"),o=$localstorage.getObject("homepage_middleMsg"),i=($localstorage.getObject("homepage_flash"),$localstorage.getObject("homepage_find"));"null"!=$localstorage.get("activity_icon")&&($scope.nowImgIcon=$localstorage.getObject("activity_icon")),"null"!=$localstorage.get("activity_bg")&&($scope.homePageActivityBg=$localstorage.getObject("activity_bg")),e&&"undefined"!=e&&($scope.hot_word=e),t&&!isEmptyObject(t)&&($scope.good=t.data.good,$scope.askEvery=t.data.askEvery,$scope.mustBuy=t.data.mustBuy,$scope.wiki=t.data.wiki,$scope.midCommList=t.data.midCommList,$scope.crowdFunding=t.data.crowdFunding,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("homePage_slider").loop(!0)),o&&!isEmptyObject(o)&&($scope.floors=o.data.floors,$scope.fCommunity=o.data.fCommunity),i&&!isEmptyObject(i)&&($scope.data=i)}function isEmptyObject(e){for(var t in e)return!1;return!0}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}var isGoing=!1,locationFlag=!0;$scope.flagNum=!1,$scope.flashHour="",$scope.flashText="",$scope.oldImgIcon={jydq:$rootScope.imgBaseURL+"img/jydq@2x.png",jjjz:$rootScope.imgBaseURL+"img/Fitting@2x.png",bhcs:$rootScope.imgBaseURL+"img/market@2x.png",xpzc:$rootScope.imgBaseURL+"img/new@2x.png",wddp:$rootScope.imgBaseURL+"img/openStore@2x.png",jrlc:$rootScope.imgBaseURL+"img/jrlc@2x.png",shfw:$rootScope.imgBaseURL+"img/icon_specialty.png",gd:$rootScope.imgBaseURL+"img/gd@2x.png"},$scope.definedHeight1={height:window.innerWidth/(750/408)+"px"||auto},$scope.activityColorOld={jydqFontColor:"#666666",jrlcFontColor:"#666666",wddpFontColor:"#666666",bhcsFontColor:"#666666",shfwFontColor:"#666666",jjjzFontColor:"#666666",xpzcFontColor:"#666666",gdFontColor:"#666666"},$scope.activityColor={},$scope.nowImgIcon=$scope.oldImgIcon,$scope.homePageActivityBg2={background:"ffffff"};var hasHistory=$stateParams.hasHistory,screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.provinceId="16",$scope.cityId="173",$scope.region="崂山区",$scope.regionId=2450,$scope.streetId=12036596,$scope.addressTitle="选择地区",$scope.defaultValue=null,$scope.dataAdd=null,$scope.flag="SELECTION_LOCATION",$scope.level=0;var addressMessage={},areaValue;$scope.dealPrice=CalculateStrLength.dealPrice,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png",$scope.countTime={},jQuery.rnd=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},confetti(),$scope.goToEmc=function(){$scope.isApp?HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,-1==e.data.isHost?$state.go("login"):HomePageService.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(UrlService.getEnviroment(),t,""):PopupService.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):PopupService.showToast("请去顺逛App查看此服务")},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){locationFlag=!0,$scope.addressInit(null,null,"SELECTION_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){locationFlag=!0,$scope.addressModal.hide()},$scope.goSelect=ionic.Utils.debounce(function(e,t){if(locationFlag){locationFlag=!1;for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)locationFlag=!0,-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,locationFlag=!0;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",
$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){locationFlag=!0,$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);locationFlag=!0,$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！"),locationFlag=!0})};else{if(locationFlag=!0,isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}}},300),$rootScope.$on("SELECTION_LOCATION",function(e,t){$scope.region=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.region+"/"+$scope.streetName;$scope.provinceId=t["value-1"],$scope.cityId=t["value-2"],$scope.regionId=t["value-3"],$scope.streetId=t["value-4"],$scope.panAddressSel=!0,$scope.page=1,GoodsService.addAddress($scope.provinceId,$scope.cityId,$scope.regionId,o,$scope.streetId).success(function(e,t,o,i){e.success}),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.queryPricePara).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})}),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}).error(function(){}),$scope.addressModal.hide()}},$scope.onScroll=function(){var e=$ionicScrollDelegate.getScrollPosition().top,t=Math.round(e/204*100)/100;$scope.$apply(function(){e<10?($scope.changeOpacity={"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0.30), rgba(255,255,255,0.00))"},$scope.changeColor={color:"#ffffff"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):e<100&&e>=10?($scope.changeOpacity={background:"rgba(255,255,255,"+t+")"},$scope.searchBg={background:"#ffffff",color:"#666666"},$scope.changeColor={color:"#ffffff"},$scope.locationImgUrl=$rootScope.imgBaseURL+"img/location@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/messageLogo@2x.png"):($scope.locationImgUrl=$rootScope.imgBaseURL+"img/location_gray@2x.png",$scope.messageImgUrl=$rootScope.imgBaseURL+"img/message_gray@2x.png",$scope.changeColor={color:"#666666"},$scope.searchBg={background:"#e8e8e8",color:"#ffffff"},$scope.changeOpacity={background:"rgba(255,255,255,"+t+")"})})},$scope.init=function(){$scope.defaultValue=null,$scope.dataAdd=null,$interval.cancel($scope.timer),$interval.cancel($scope.timer1),$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.tabNav="homePage",HomePageService.getActivityIcon().success(function(e){e.data?($localstorage.setObject("activity_icon",e.data.iconImageConfig),$scope.nowImgIcon=e.data.iconImageConfig,e.data.iconFontConfig?($scope.activityColor={},$scope.activityColor=e.data.iconFontConfig):$scope.activityColor=$scope.activityColorOld):($localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld)}).error(function(){$localstorage.set("activity_icon","null"),$scope.nowImgIcon=$scope.oldImgIcon,$scope.activityColor=$scope.activityColorOld}),HomePageService.getActivityBg().success(function(e){e.data?($scope.homePageActivityBg=e.data,$localstorage.setObject("activity_bg",e.data),e.data.middleImagePart3?$(".sg_notice").removeClass("noActiveBorderTop"):$(".sg_notice").addClass("noActiveBorderTop"),$scope.homePageActivityBg1=$scope.homePageActivityBg.middleImagePart1,e.data.middleImagePart2?($scope.homePageActivityBg2=$scope.homePageActivityBg.middleImagePart2,$scope.homePageActivityBg2Img={background:"url('"+$scope.homePageActivityBg.middleImagePart2.pic+"') left top/100% no-repeat"}):$scope.homePageActivityBg2Img={background:"#ffffff"},$scope.homePageActivityBg3=$scope.homePageActivityBg.middleImagePart3):($(".sg_notice").addClass("noActiveBorderTop"),$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"})}).error(function(){$localstorage.setObject("activity_bg","null"),$scope.homePageActivityBg1=null,$scope.homePageActivityBg3=null,$scope.homePageActivityBg2Img={background:"#ffffff"}}),GoodsSearchService.defaultSearch().success(function(e){$scope.hot_word=e.data.hot_word,$localstorage.set("homepage_hot_word",$scope.hot_word)}),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"SELECTION_LOCATION",0),ShopService.getMessage().success(function(e){$scope.msg=e.data.list[0].content}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1}),ProductDetailService.getCartNum().success(function(e){e.success&&($rootScope.BottomCartNum=e.data)}),HomePageService.getTopMsg().success(function(e){$localstorage.setObject("homepage_topMsg",e),$scope.bannerList=e.data.topBannerList,$scope.good=e.data.good,$scope.askEvery=e.data.askEvery,$scope.mustBuy=e.data.mustBuy,$scope.wiki=e.data.wiki;var t=e.data.midCommList;$scope.midCommList=t?t.slice(0,2):null,$scope.midActivtyList=e.data.midActivtyList,$scope.midBannerList=e.data.midBannerList,$scope.crowdFunding=e.data.crowdFunding,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200),$scope.$broadcast("scroll.refreshComplete"),$scope.refreshing=!1}),HomePageService.isWdHost().success(function(e){$rootScope.isWdHost=e.data.isHost,1==e.data.isHost?$localstorage.set("storeId",e.data.storeMemberId):$localstorage.set("storeId",20219251)}),getAddress().then(function(e){$scope.provinceId=e.provinceId,$scope.cityId=e.cityId,$scope.areaId=e.areaId,$scope.streetId=e.streetId,HomePageService.getMiddleMsg(e.provinceId,e.cityId,e.areaId,e.streetId).success(function(e){$localstorage.setObject("homepage_middleMsg",e),$scope.floors=e.data.floors,$scope.fCommunity=e.data.fCommunity,$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}),getFlashSales(),GoodsService.doInitFaxian(1,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId,$scope.storeId,!0).success(function(e){$scope.data=e,$localstorage.setObject("homepage_find",e),e.isCanSyncGetPrice&&GoodsService.asyncPrice(e.queryPricePara).success(function(e){e.success&&($scope.data=e,$localstorage.setObject("homepage_find",e))})})})},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case 1:var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case 2:if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case 3:var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case 4:"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case 5:if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case 6:$state.go("crowdFunding");break;case 7:t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case 8:t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.gotoMyStore=function(e){1==e?$state.go("myStore",{storeId:$rootScope.loginMemberId?$rootScope.loginMemberId:$scope.storeId}):0==e?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.goNoteDetail=function(e){$state.go("noteDetails",{noteId:123,isShortStory:231})},$scope.goPersonalHome=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.goToManageMoney=function(){1==$rootScope.isWdHost?$state.go("financialMoney",{whereId:"homePage"}):0==$rootScope.isWdHost?RegisterService.wdApply().success(function(e){e.success?e.data?$state.go("newAuthenticationHome"):$state.go("registerForStore",{hasHistory:1}):PopupService.showToast("服务端错误")}).error(function(){alert("网络错误")}):$state.go("login")},$scope.$on("$ionicView.enter",function(e,t){ionic.on("scroll",$scope.onScroll,$scope.$$childHead.scrollCtrl.element)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch(),$interval.cancel($scope.timer),$interval.cancel($scope.timer1)}),$scope.settingsList="",$scope.refreshData=function(){$scope.refreshing=!0,GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},$ionicPlatform.on("pause",function(){"homePage"==$ionicHistory.currentStateName()&&($interval.cancel($scope.timer),$interval.cancel($scope.timer1))}),$ionicPlatform.on("resume",function(){"homePage"==$ionicHistory.currentStateName()&&getFlashSales()}),$scope.$on("$ionicView.beforeEnter",function(e,t){GetSwitchChecked(),setTimeout(function(){readCache()},0),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction?$timeout(function(){GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init()},1e3):(GetSwitchChecked(),setTimeout(function(){readCache()},0),window.cordova?$scope.isApp=!0:$scope.isApp=!1,$scope.showHomePageTipImg=$localstorage.get("homePageTipImg"),$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.showFlashSale=!1,$scope.init())})}]),APP.service("HomePageService",["$http","UrlService","MyStoreService","LoginService","$localstorage","UserService",function(e,t,o,i,s,n){this.getTopMsg=function(){return e.get(t.getNewUrl("HOMEPAGE_TOP"))},this.getMiddleMsg=function(o,i,s,n){var a={provinceId:o,cityId:i,districtId:s,street:n};return e.get(t.getNewUrl("HOMEPAGE_MIDDLE"),a)},this.isWdHost=function(){return e.get(t.getNewUrl("HOMEPAGE_ISWDHOST"))},this.getFlashSales=function(o,i,s,n){var a={provinceId:o,cityId:i,districtId:s,streetId:n};return e.get(t.getNewUrl("HOMEPAGE_FALSHSALES"),a)},this.getUnReadMsg=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getActivityIcon=function(){return e.get(t.getNewUrl("ACTIVITY_ICON_TABS_NEW"),{iconType:1})},this.getActivityBg=function(){return e.get(t.getNewUrl("ACTIVITY_BG"))},this.token_get=function(){return e.post(t.getUrl("TOKEN_GET"))},this.isAuthoMid=function(e){o.login(e).success(function(e){n.setUser(e.data),s.set("sg_login_token_secret","Bearer"+e.data.sessionValue),memberId=n.getUser().mid,i.checkOpenStore(memberId).success(function(e){e.data?(i.setRole(1),s.set("storeId",memberId)):(i.setRole(0),s.set("storeId",20219251))})})}}]),APP.service("GoodsService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n,a,r,c,l,d){var u={pholder:o,provinceId:i,cityId:s,districtId:n,streetId:a,storeId:r,productCateStr:c,sortColumn:l,areaId:d};return e.get(t.getUrl("SELECT_INIT"),u)},this.doInitFaxian=function(o,i,s,n,a,r,c){var l={d:o,provinceId:i,cityId:s,districtId:n,streetId:a,storeId:r,noLoading:c};return e.get(t.getUrl("FAXIAN_INIT"),l)},this.changeSuccess=function(o){var i={type:o};return e.get(t.getUrl("CHANGESUCCESS_INIT"),i)},this.changeChooseStateJia=function(o,i){var s={productId:o,onShelf:i};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),s)},this.changeChooseStateDui=function(o){var i={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),i)},this.loadMoreProducts=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pholder:o,provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:r,pageSize:c,productCateStr:l,memberId:d,filterData:u,fromType:p,noLoading:g};return e.get(t.getUrl("LOADMOREPRODUCTS_INIT"),m)},this.getSlideImage=function(){var o={page:"app_home",isBack:0};return e.get(t.getUrl("GET_SELECTION_IMAGE"),o)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getAddressId=function(o,i,s,n,a){var r={provinceName:o,cityName:i,regionName:s,streetName:n,gbCode:a,noLoading:!0};return e.get(t.getUrl("GET_ADDRESS_ID"),r)},this.getFilterData=function(o){var i={productCateId:o||""};return e.get(t.getUrl("GET_FILTER_DATA"),i)},this.getSelectionProducts=function(o,i,s,n,a,r,c,l,d,u,p){var g={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,pageIndex:r,pageSize:c,fromType:l,filterData:d,productCateStr:u,flag:"",productCateId:"",noLoading:p};return e.get(t.getUrl("GET_SELECTION_PRODUCTS"),g)},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.asyncPrice=function(o){return o.noLoading=!0,e({method:"POST",url:t.getUrl("ASYNC_ACCESS_PRICE"),data:o})}}]),APP.controller("ImageAndWordController",["$sce","$scope","imageAndWordService","$stateParams","$ionicPopup","$rootScope","$ionicScrollDelegate","$http","$interval",function(e,t,o,i,s,n,a,r,c){t.scrollToTop=function(){a.scrollTop([shouldAnimate=!0])},t.Mp42="",t.Png42="",t.flagMp4=!1,t.$on("$ionicView.beforeEnter",function(){t.productId=i.productId,t.tabNav="selection",t.flag=!1,o.doInit(t.productId).success(function(o,i,s,n){if(o.data.mp4FileId2){t.flagMp4=!0;var a=JSON.parse(o.data.mp4FileId2);t.Mp42=e.trustAsResourceUrl(a.video),t.Png42=a.img}else t.flagMp4=!1;if(o.success)if(null==o.data.detailImgs||0!=o.data.detailImgs.length){t.imagesUrl=e.trustAsHtml(o.data.detailImgs);var r=0,l=0,d=c(function(){if($("div#image-and-word").find("img").length)if(r=$("div#image-and-word").find("img").length,l==r)new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d);else{l=0;for(var e=0;e<r;e++)$("div#image-and-word").find("img")[e].width&&l++;l==r&&(new RTP.PinchZoom($("div#image-and-word"),{tapZoomFactor:1}),c.cancel(d))}},200);t.flag=!1}else t.flag=!0;else t.flag=!0})}),n.$on("$stateChangeStart",function(e,t,o,i,s){if("imageAndWord"==i.name)for(var n=document.getElementsByTagName("video"),a=0;a<n.length;a++)n[a].pause()})}]),APP.service("imageAndWordService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={productId:o};return e.get(t.getUrl("PRODUCTDETAIL_PROMOS"),i)}}]),APP.controller("lifeServiceController",["$scope","$ionicHistory","HomePageService","$rootScope","$state","UrlService","PopupService",function(e,t,o,i,s,n,a){e.goToLivingCost=function(){},e.goToEMC=function(){e.isApp?o.isWdHost().success(function(e){if(i.isWdHost=e.data.isHost,-1==e.data.isHost)s.go("login");else{var t=UserService.getUser().accessToken;t?window.emc.presentEmcView(n.getEnviroment(),t,""):a.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")}}):a.showToast("请去顺逛App查看此服务")},e.goBack=function(){t.goBack()}}]),APP.controller("ProductDetailController",["GoodsService","$localstorage","HomePageService","$interval","$scope","$sce","$stateParams","$rootScope","ProductDetailService","CommonAddressService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","PopupService","$cookies","LoginService","ShopService","$ionicHistory","CreditService","$ionicModal","$http","$ionicScrollDelegate","GetCouponsService","flashService","WhiteShowsService","CartService","$location","IMService","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,w,y,T,C,b,A,P,L,x,D,N,_){function k(){for(var e=0;e<s.choosedActiveObj.length;e++){for(var t=[],o=0;o<s.choosedActiveObj.length;o++)if(e!=o)for(var i=0;i<s.choosedActiveObj[o].length;i++)1==s.choosedActiveObj[o][i].active&&t.push(s.choosedActiveObj[o][i].sgAttribute.id);for(var n=[],a=0;a<s.sgStoreAttribute.length;a++){for(var r=s.sgStoreAttribute[a].attrValueIds.split(","),c=0,l=0;l<r.length;l++)for(var d=0;d<t.length;d++)t[d]==r[l]&&c++;c==t.length&&(n=n.concat(r))}for(var u=[],p=0;p<n.length;p++){var g=!0;if(0==u.length)u.push(n[p]);else{for(var m=0;m<u.length;m++)u[m]==n[p]&&(g=!1);g&&u.push(n[p])}}for(name in s.StoreAttribute)for(var a=0;a<s.StoreAttribute[name].length;a++){var f=s.StoreAttribute[name];if(f[0].attrName==s.choosedActiveObj[e][0].attrName&&1!=f[a].active){for(var h=!0,v=0;v<u.length;v++)if(f[a].sgAttribute.id==u[v]){h=!1;break}f[a].active=h?2:0}}}}function O(){for(var e=[],t=0;t<s.sgStoreAttribute.length;t++){for(var o=s.sgStoreAttribute[t].attrValueIds.split(","),i=0,n=0;n<o.length;n++)for(var a=0;a<s.attrValueIds.length;a++)s.attrValueIds[a]==o[n]&&i++;i==s.attrValueIds.length&&(e=e.concat(o))}for(var r=[],c=0;c<e.length;c++){var l=!0;if(0==r.length)r.push(e[c]);else{for(var d=0;d<r.length;d++)r[d]==e[c]&&(l=!1);l&&r.push(e[c])}}for(name in s.StoreAttribute)for(var t=0;t<s.StoreAttribute[name].length;t++){for(var u=s.StoreAttribute[name],p=!1,g=0;g<s.NoActiveObj.length;g++)u[t].attrName==s.NoActiveObj[g][0].attrName&&(p=!0);if(p){for(var m=!0,f=0;f<r.length;f++)if(u[t].sgAttribute.id==r[f]){m=!1;break}u[t].active=m?2:0}}}function E(){for(name in s.StoreAttribute){for(var e=!1,t=0;t<s.StoreAttribute[name].length;t++){var o=s.StoreAttribute[name];1==o[t].active&&(e=!0,s.StoreAttributeActiveList.push(o[t].sgAttribute.attrValueName),s.attrValueIds.push(o[t].sgAttribute.id),s.attrValueNames.push(o[t].sgAttribute.attrValueName))}e&&s.choosedActiveObj.push(s.StoreAttribute[name])}var i=!0;for(name in s.StoreAttribute){for(var t=0;t<s.StoreAttribute[name].length;t++){var o=s.StoreAttribute[name];if(1==o[t].active){i=!1;break}i=!0}i&&s.NoActiveObj.push(s.StoreAttribute[name])}}function M(){for(var e=0;e<8;e++)s.divStrl[e]=12*e+1}function U(){for(var e=0;e<8;e++)s.divStrm[e]=12*e+1}function R(){for(var e=0;e<2;e++)s.divStrt[e]=90*e-8}function B(){c.evalute(s.productId).success(function(e){s.positiveRate=e.data.positiveRate,s.totalNum=e.data.totalNum})}s.noFresh=!1,s.remindSuccess=!1,s.hasMoreCoupons=!1;var F,H=1;s.expectTime="",s.commission=null,s.finMoreAct=!1,s.finalPrice="",s.actualPrice="",s.bigActivity=!1,s.getcoupons=!1;var G=0;s.IsShowAttribute="",s.StoreAttribute=null,s.StoreAttributePrice=0,s.StoreAttributNumber="有货",s.StoreAttributeActiveList=[],s.attrValueIds=[],s.attrValueIdsBefore=[],s.attrValueNames=[],s.NoActiveObj=[],s.skku=null,s.openSpecNumberType=null,s.isOpenBottom=!1,s.BottomCartNum="0",s.picAttr="",s.sgStoreAttribute=[],s.AttrswiperImgs=[],s.isAllAttr=!1,s.isAllAttrpic=!1,s.isShowAttrLeftArrow=!1,s.tabNav="selection",s.isBuyer=S.getRole(),s.shareStoreId=a.shareStoreId,s.O2OStoreName="",s.isFromBanner=!1;var V=w.viewHistory().backView;s.userId=m.getUser().mid,s.showShare=!1,s.moreShow=!1,s.isShowBigPic=!1,s.activeSlide=0,s.nowActiveSlide=0,s.isShowLeftArrow=!1,s.isShowService=!1,s.canGetVcode=!0,s.VCodeTips="获取验证码",s.VCodeStyle={color:"#2979FF"},s.Mp41="",s.Png41="",s.flagMp4=!1,s.a=1,s.b=1,s.isPackage=!1,s.message="",s.endT="",s.endTt="",s.endTh="",s.endTm="",s.endTs="",s.startT="",s.startTt="",s.startTh="",s.startTm="",s.startTs="";var j,z,W,q;s.isShowCopyButton=!1,s.couponList=[],s.giftInfo="",s.stockNumber=null,s.o2oStoreId=null,s.whiteShowsState=1,s.whiteShowsCount=0,s.costInfo=[],s.isWhiteShows=!1,s.whiteShowsMsg="查看更多",s.whiteShowsTit="顺逛白条",s.showWhiteShows=function(){if(!m.getUser().accessToken)return void h.showToast("您的当前帐号暂时无法访问此服务,请使用关联手机号登录");var e=null;e=s.productModel.isActivityProduct?s.finalPrice:s.actualPrice,L.cost({token:m.getUser().accessToken,payAmt:e,proGroup:s.productModel.product.department,sku:s.productModel.product.sku}).success(function(e){e.success&&(s.whiteShowsMsg=e.data.feeInfo,s.whiteShowsTit=e.data.feeInfo,s.whiteShowsState=e.data.applyStatus,s.costInfo=e.data.costInfo,1==s.whiteShowsState&&(s.whiteShowsCount=e.data.crdComAvailAmt),s.isWhiteShows=!0),100==e.errorCode&&g.go("login")})},s.hideWhiteShows=function(){s.isWhiteShows=!1},s.clickWhiteShows=function(){2==s.whiteShowsState||3==s.whiteShowsState?g.go("applyForWhite"):0==s.whiteShowsState&&L.applyForOpen({backUrl:window.location.href,userId:m.getUser().ucId,token:m.getUser().accessToken}).success(function(e){e.success&&L.openApplyWhiteShows(e.data.redirectUrl,window.location.href),100==e.errorCode&&g.go("login")})},s.OpenAndClose="modal-Spec-Closes",s.SpecNumberActive=function(e,t){s.StoreAttributeActiveList=[],s.attrValueIds=[],s.attrValueNames=[],s.NoActiveObj=[],s.choosedActiveObj=[];if(0==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=1}else if(1==e.active){for(var o=0;o<t.length;o++)1==t[o].active&&(t[o].active=0);e.active=0}else if(2==e.active)return;if(E(),k(),O(),s.attrValueIds.length>0)if(function(e){var t=0;for(var o in e)t++;return t}(s.StoreAttribute)==s.attrValueIds.length)for(var o=0;o<s.sgStoreAttribute.length;o++)s.sgStoreAttribute[o].attrValueIds==s.attrValueIds.join()&&(s.StoreAttributePrice=s.sgStoreAttribute[o].price,s.StoreAttributNumber="库存"+s.sgStoreAttribute[o].num,s.skku=s.sgStoreAttribute[o].skku,s.picAttr=s.sgStoreAttribute[o].pic);else s.StoreAttributePrice=s.actualPrice,s.StoreAttributNumber=s.hasStock?"有货":"无货",s.skku=null,s.picAttr=s.productModel.swiperImgs[0];else s.StoreAttributePrice=s.actualPrice,s.StoreAttributNumber=s.hasStock?"有货":"无货",s.skku=null,s.picAttr=s.productModel.swiperImgs[0];0==s.NoActiveObj.length?s.isAllAttr=!0:s.isAllAttr=!1},s.openSpecNumber=function(e){s.IsShowAttribute&&0==s.NoActiveObj.length&&0!=s.StoreAttributeActiveList.length&&null!=s.skku&&e>1?2==e?(s.openSpecNumberType=2,s.addToCart()):3==e?(s.openSpecNumberType=3,s.buyNow()):4==e?(s.openSpecNumberType=4,s.buyNow()):5==e?(s.openSpecNumberType=5,s.buyNow(1)):6==e?(s.openSpecNumberType=6,s.toNotice()):7==e?(s.openSpecNumberType=7,s.startNotice()):8==e?(s.openSpecNumberType=8,s.nowOrder()):9==e&&(s.openSpecNumberType=9,s.buyNow()):s.IsShowAttribute?(s.isOpenBottom=1==e,1==e?s.openSpecNumberType=1:2==e?s.openSpecNumberType=2:3==e?s.openSpecNumberType=3:4==e?s.openSpecNumberType=4:5==e?s.openSpecNumberType=5:6==e?s.openSpecNumberType=6:7==e?s.openSpecNumberType=7:8==e?s.openSpecNumberType=8:9==e&&(s.openSpecNumberType=9),null==s.StoreAttribute&&c.getSgStoreAttribute(s.productId,s.o2oStoreId,s.productModel.product.sku).success(function(e){if(e.success){for(var t=e.data.sgAttribute,o=e.data.sgStoreAttribute,i=0;i<o.length;i++)s.AttrswiperImgs.push(o[i].pic);for(name in t){G++;for(var i=0;i<t[name].length;i++){t[name][i].active=0}}if(1==G)for(key in t)for(var i=0;i<t[key].length;i++)for(var n=t[key],a=0;a<o.length;a++)n[i].sgAttribute.id==o[a].attrValueIds&&0==o[a].num&&(n[i].active=2);s.StoreAttribute=t;for(var i=0;i<o.length;i++)o[i].num>0&&s.sgStoreAttribute.push(o[i]);E(),O()}}),s.OpenAndClose="modal-Spec-opens",E(),O()):2==e?s.addToCart():3==e?s.buyNow():4==e?s.buyNow():5==e?s.buyNow(1):6==e?s.toNotice():7==e?s.startNotice():8==e?s.nowOrder():9==e&&s.buyNow()},s.closeConfirmModel=function(){if(1!=s.openSpecNumberType&&(null==s.skku||0!=s.NoActiveObj.length||0==s.StoreAttributeActiveList.length)){for(var e="",t=0;t<s.NoActiveObj.length;t++)e+="&nbsp;&nbsp;"+s.NoActiveObj[t][0].attrName;return void h.showToast("请选择"+e)}2==s.openSpecNumberType?s.addToCart():3==s.openSpecNumberType?s.buyNow():4==s.openSpecNumberType?s.buyNow():5==s.openSpecNumberType?s.buyNow(1):6==s.openSpecNumberType?s.toNotice():7==s.openSpecNumberType?s.startNotice():8==s.openSpecNumberType?s.nowOrder():9==s.openSpecNumberType&&s.buyNow(),s.closeSpecNumber()},s.closeSpecNumber=function(){s.OpenAndClose="modal-Spec-Closes"},s.getCartNumFn=function(e){c.getCartNum().success(function(t){t.success&&(s.BottomCartNum=t.data,1==e&&u(function(){h.showToast("加入购物车成功")},200))})};var J=window.innerHeight,K=J-373+"px";s.contentHeight={height:K},s.addressTitle="配送至",s.dataAdd=null,s.flag="PRODUCT_DETAIL_LOCATION",s.defaultValue=null,s.level=0;var Y,Q,X={};s.divStrl=[],s.divStrm=[],s.divStrt=[],s.init=function(){s.showQQ=!1,s.showWeChat=!1,s.isShowCopyButton=!1,s.positiveRate=0,s.totalNum=0,s.skku=null,s.user=m.getUser(),s.iscompleteLoad=!1,s.productId=a.productId,B(),window.cordova?t.get("storeId",r.globalConstant.storeId)==a.storeId?s.storeId=a.storeId:s.storeId=t.get("storeId",r.globalConstant.storeId):a.shareStoreId?(r.shareId=a.shareStoreId,s.storeId=r.shareId):s.storeId=r.shareId?r.shareId:a.storeId,s.o2oType=a.o2oType,s.fromType=a.fromType,0==s.noFresh&&c.loadData(s.productId,s.storeId,s.o2oType,s.fromUrl,s.fromType).success(function(e,t,o,a){function l(e){return e=e<10?"0"+e:e}if(s.iscompleteLoad=!0,s.productModel=e.data,s.picAttr=s.productModel.swiperImgs[0],r.addressDefaultMsg={provinceId:s.productModel.provinceId,cityId:s.productModel.cityId,regionId:s.productModel.regionId,streetId:s.productModel.streetId,provinceName:s.productModel.provinceName,cityName:s.productModel.cityName,pcrName:s.productModel.pcrName},r.addressDefMsg=JSON.stringify(r.addressDefaultMsg),window.cordova&&r.gio.track("ProdView",{productId:s.productId,productFirstName:"",productSecondName:"",o2oType:s.o2oType,storeId:s.storeId}),s.copyText=s.productModel.product.productFullName+s.productModel.product.productTitle+f.getShareLinkHeader()+"productDetail/"+s.productId+"/"+s.o2oType+"/"+s.fromType+"/"+s.productModel.storeId+"/"+s.productModel.storeId+"?fs",e.data.mp4FileId1){var d=JSON.parse(e.data.mp4FileId1);s.flagMp4=!0,s.Mp41=n.trustAsResourceUrl(d.video),s.Png41=d.img,s.a=1,s.b=1}else s.a=0,s.b=1,s.flagMp4=!1;c.getO2OName(s.productModel.product.sku,s.productModel.provinceId,s.productModel.cityId,s.productModel.regionId,s.productModel.streetId).success(function(e){if($.isEmptyObject(e.data)?s.showO2OMsg=!1:(s.showO2OMsg=!0,s.O2OStoreName=e.data.O2OStoreName,s.avatarImageFileId=e.data.avatarImageFileId,s.o2oStoreId=e.data.o2oStoreId,s.O2Omobile=e.data.mobile,s.O2Omobile?s.showPhoneCall=!0:s.showPhoneCall=!1,s.serviceGrade=e.data.serviceGrade,s.productGrade=e.data.productGrade,s.logisticalGrade=e.data.logisticalGrade),c.getProductCouponsHas(s.productModel.product.sku,s.productModel.product.productId,1,s.actualPrice,s.productModel.storeId,s.o2oStoreId).success(function(e){e.success&&(s.couponListNew=e.data.couponList)}),null==s.o2oStoreId||"null"==s.o2oStoreId)var t="";else var t=s.o2oStoreId;c.getIsShowAttr(s.productId,t).success(function(e){e.result?s.IsShowAttribute=!0:s.IsShowAttribute=!1})}),s.endT=s.productModel.activityEndTime-s.productModel.activityNowTime,j=i(function(){s.endTt=Math.floor(s.endT/86400),s.endTh=l(Math.floor((s.endT-86400*s.endTt)/3600)),s.endTm=l(Math.floor((s.endT-86400*s.endTt-3600*s.endTh)/60)),s.endTs=l(s.endT-86400*s.endTt-3600*s.endTh-60*s.endTm),-1==--s.endT&&(g.reload(),i.cancel(j),i.cancel(z))},1e3),s.startT=s.productModel.activityStartTime-s.productModel.activityNowTime,z=i(function(){s.startTt=Math.floor(s.startT/86400),s.startTh=l(Math.floor((s.startT-86400*s.startTt)/3600)),s.startTm=l(Math.floor((s.startT-86400*s.startTt-3600*s.startTh)/60)),s.startTs=l(s.startT-86400*s.startTt-3600*s.startTh-60*s.startTm),-1==--s.startT&&(g.reload(),i.cancel(z),i.cancel(j))},1e3),s.productCount=1,s.productModel.subProductImagesList||(s.productModel.subProductImagesList=[]),s.actualPrice=s.productModel.actualPrice,s.StoreAttributePrice=s.actualPrice,s.productModel.isActivityProduct?s.finalPrice=s.productModel.finalPrice:(s.productModel.finalPrice-s.productModel.actualPrice>0&&(s.finMoreAct=!0),s.finalPrice=s.productModel.finalPrice),c.locationChange(s.productModel.product.sku,s.productModel.product.productId,s.productModel.regionId,1,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(e,t,o,n){if(s.hasStock=e.data.hasStock,s.isSupportCOD=e.data.isSupportCOD,s.expectTime=e.data.expectTime,s.commission=e.data.commission,s.commissionRate=e.data.commissionRate,s.finalPrice=e.data.finalPrice,s.actualPrice=e.data.actualPrice,s.StoreAttributePrice=s.actualPrice,s.finMoreAct=s.finalPrice-s.actualPrice>0,s.bigActivity=e.data.bigActivity,s.freeOrder=e.data.freeOrder,s.halfDay=e.data.halfDay,s.oneDay=e.data.oneDay,s.isPackage=e.data.isPackage,s.couponList=e.data.sgStoreCouponVoList,s.giftInfo=e.data.giftInfo,s.stockNumber=e.data.stockNum,s.StoreAttributNumber=s.hasStock?"有货":"无货",s.isFlashsales=e.data.isFlashsales,s.flashsalesEndTime=e.data.flashsalesEndTime,s.flashsalesEndTime<(new Date).getTime()&&(s.isFlashsales=!1),window.cordova&&r.gio.track("stockInfo",{productId:s.productModel.product.productId,productFirstName:"",hasStock:s.hasStock,ReceivingProvince:s.productModel.provinceName,ReceivingCity:s.productModel.cityName,
ReceivingDistrict:s.productModel.regionName?s.productModel.regionName.substring(0,s.productModel.regionName.indexOf("/")):"",ReceivingStreet:s.productModel.regionName?s.productModel.regionName.substring(s.productModel.regionName.indexOf("/")+1):""}),"undefined"!=typeof gio&&gio("track","getAddress",{productId:s.productModel.product.productId,productFirstName:"",hasStock:s.hasStock?"有货":"无货",ReceivingProvince:s.productModel.provinceName,ReceivingCity:s.productModel.cityName,ReceivingDistrict:s.productModel.regionName?s.productModel.regionName.substring(0,s.productModel.regionName.indexOf("/")):"",ReceivingStreet:s.productModel.regionName?s.productModel.regionName.substring(s.productModel.regionName.indexOf("/")+1):""}),1==s.isFlashsales){s.state=!0;var a=new Date,c=s.flashsalesEndTime,l=a.getTime();if(c<l)s.state=!1;else var d=i(function(){l+=1e3;var e=parseInt((c-l)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),a=e-24*t*60*60-60*n*60,r=parseInt(a/60),u=e-24*t*60*60-60*n*60-60*r;s.showtime1=t+"天"+P.PrefixInteger(n)+":"+P.PrefixInteger(r)+":"+P.PrefixInteger(parseInt(u)),e<=-1&&(s.state=!1,i.cancel(d),g.reload())},1e3)}s.originalPrice=e.data.originalPrice,s.isAcReserve=e.data.isAcReserve,s.acReserveType=e.data.acReserveType,s.acReserveId=e.data.acReserveId,s.acReserveEndTime=e.data.acReserveEndTime,s.state1=!0;var u=new Date,p=s.acReserveEndTime,m=u.getTime(),f=i(function(){m+=1e3;var e=parseInt((p-m)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),a=e-24*t*60*60-60*n*60,r=parseInt(a/60),c=e-24*t*60*60-60*n*60-60*r;s.showtime=t+"天"+P.PrefixInteger(n)+":"+P.PrefixInteger(r)+":"+P.PrefixInteger(parseInt(c)),-1==e&&(F.close(),g.reload(),i.cancel(f),s.state1=!1)},1e3);1==s.isAcReserve&&(1==s.acReserveType&&(s.repur="预约",s.repurNum=e.data.acReserveNum),2==s.acReserveType&&(s.repur="抢购",s.repurNum=e.data.acPurchaseNum))}),p.update()}).error(function(e,t,o,i){h.showToast(e.message)})},s.nus=function(){s.productCount-=1,s.productCount<1?s.productCount=1:c.locationChange(s.productModel.product.sku,s.productModel.product.productId,s.productModel.regionId,s.productCount,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(e,t,o,i){s.hasStock=e.data.hasStock,s.isSupportCOD=e.data.isSupportCOD,s.couponList=e.data.sgStoreCouponVoList})},s.plus=function(){c.locationChange(s.productModel.product.sku,s.productModel.product.productId,s.productModel.regionId,s.productCount+1,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(e,t,o,i){0==e.success?h.showToast(e.message):(s.productCount+=1,s.hasStock=e.data.hasStock,s.isSupportCOD=e.data.isSupportCOD,s.couponList=e.data.sgStoreCouponVoList)})},s.makeACall=function(){d.confirm({template:s.O2Omobile,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+s.O2Omobile,"_system"):window.open("tel:"+s.O2Omobile))})},r.$on("$stateChangeStart",function(e,t,o,i,s){if("productDetail"==i.name)for(var n=document.getElementsByTagName("video"),a=0;a<n.length;a++)n[a].pause()}),s.slideHasChanged=function(e){for(var t=document.getElementsByTagName("video"),o=0;o<t.length;o++)t[o].pause()},s.seeBigPic=function(e){"attr"==e?(s.isShowAttrLeftArrow=!0,s.isAllAttrpic=!0,s.activeSlide=0,setTimeout(function(){for(var e=s.AttrswiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500)):(s.isShowBigPic=!0,s.isShowLeftArrow=!0,s.flagMp4?s.activeSlide=e:s.activeSlide=e-1,setTimeout(function(){for(var e=s.productModel.swiperImgs.length-1;e>=0;e--)new RTP.PinchZoom($("div#pinchZoomBigPic-"+e),{})},500))},s.showBigPic=function(e){s.isShowBigPic=!1,s.isShowLeftArrow=!1},s.showBigPicAttr=function(){s.isShowAttrLeftArrow=!1,s.isAllAttrpic=!1},s.addressTop=function(){s.addressTipFlag=!1,s.provinceTop=0,s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.addressModal.show(),s.dataAdd=null,s.defaultValue=null,s.selectProvince="",s.selectCity="",s.selectArea="",s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0)},s.addressInit=function(t,o,i,n){if(s.addressTipFlag=!1,b.$getByHandle("mainScroll").scrollTop(),s.addressTitle="配送至",s.defaultValue=t?JSON.parse(t):{},s.level=n,o){s.dataAdd=JSON.parse(o),s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var a=0;a<s.nowLevelIndex.length;a++)a>s.nowLevel&&(s.nowLevelIndex[a]=-1)}else s.finish=!1,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,s.dataAdd="",e.getLocationList("",0).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1,s.finish=!0,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel;for(var t=(JSON.stringify(s.defaultValue),JSON.stringify(s.dataAdd),0);t<s.nowLevelIndex.length;t++)t>s.nowLevel&&(s.nowLevelIndex[t]=-1)}).error(function(e){h.showToast("获取地址信息失败！")})},s.bottomBorder={"border-bottom":"2px solid red"},s.provinceFlag=!1,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!1,s.cityDis=!1,s.areaDis=!1,s.provinceSel=function(){s.addressInit(null,null,"PRODUCT_DETAIL_LOCATION",0),s.selectCity="",s.selectArea="",s.provinceFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!1,s.areaDis=!1};var Z=!1;s.goSelect=ionic.Utils.debounce(function(t,o){for(var i=0;i<s.nowLevelIndex.length;i++)i>s.nowLevel&&(s.nowLevelIndex[i]=-1);s.dataAdd="",s.nowLevelIndex[s.nowLevel]=t;var o=arguments[1],t=arguments[0];if(s.level=s.level-1,s.defaultValue["text"+s.level]=o.text,s.defaultValue["value"+s.level]=o.value,s.level>-2)-1==s.level&&(s.selectProvince=o.text,s.provinceIndex=t,s.provinceFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.provinceTop=b.$getByHandle("mainScroll").getScrollPosition().top,s.nowLevel=s.level,s.nowLevel=-1*s.nowLevel),ah=-1*s.level,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,e.getLocationList(o.value,ah).success(function(e){1==ah&&(Q=o.value),s.dataAdd=e.data,s.addressTipFlag=!1;var t=JSON.stringify(s.defaultValue),i=JSON.stringify(s.dataAdd);s.addressInit(t,i,s.flag,s.level)}).error(function(e){h.showToast("获取地址信息失败！")}),s.levelArea=s.level,s.levelArea=s.levelArea+1,s.citySel=function(){s.level=s.levelArea,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,s.dataAdd="",e.getLocationList(Q,1).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1;var t=JSON.stringify(s.defaultValue),o=JSON.stringify(s.dataAdd);s.addressInit(t,o,s.flag,-1),s.selectArea="",s.cityFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,b.$getByHandle("mainScroll").scrollTo(0,s.cityTop)}).error(function(e){h.showToast("获取地址信息失败！")})};else if(s.level>-4)s.selectCity=s.defaultValue["text-2"],s.provinceFlag=!1,s.cityFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!1,-3==s.level?(s.selectArea=o.text,s.cityFlag=!1,s.areaFlag=!1,s.selectFlag=!0,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0,s.areaTop=b.$getByHandle("mainScroll").getScrollPosition().top):s.cityTop=b.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*s.level,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,c.getLocationList(o.value,ah).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1,2==ah&&(Y=o.value);var t=JSON.stringify(s.defaultValue),i=JSON.stringify(s.dataAdd);s.addressInit(t,i,s.flag,s.level)}).error(function(e){h.showToast("获取地址信息失败！")}),s.levelArea=s.level,s.levelArea=s.levelArea+1,s.areaSel=function(){s.level=s.levelArea,s.addressTip="正在获取地址信息...",s.addressTipFlag=!0,s.dataAdd="",c.getLocationList(Y,2).success(function(e){s.dataAdd=e.data,s.addressTipFlag=!1;var t=JSON.stringify(s.defaultValue),o=JSON.stringify(s.dataAdd);s.addressInit(t,o,s.flag,s.level),b.$getByHandle("mainScroll").scrollTo(0,s.areaTop),s.areaFlag=!0,s.selectFlag=!1,s.provinceDis=!0,s.cityDis=!0,s.areaDis=!0}).error(function(e){h.showToast("获取地址信息失败！")})};else{if(Z)return;u(function(){Z=!1},1500),r.$broadcast(s.flag,s.defaultValue),Z=!0,s.closeAddressModal()}},300),s.getPosition=function(){if("定位中···"!=r.globalConstant.autoPosition){X=l.getAddressInfo();var e=X.regionName+"/"+X.streetName;c.addAddress(X.provinceId,X.cityId,X.areaId,e,X.streetId).success(function(){var e={"text-1":X.provinceName,"text-2":X.cityName,"text-3":X.regionName,"text-4":X.streetName,"value-1":X.provinceId,"value-2":X.cityId,"value-3":X.areaId,"value-4":X.streetId};r.$broadcast(s.flag,e),s.addressModal.hide()})}},T.fromTemplateUrl("templates/common/CommonLocation.html",{scope:s,animation:"slide-in-up"}).then(function(e){s.addressModal=e}),s.closeAddressModal=function(){s.addressModal.hide()};var ee=r.$on("PRODUCT_DETAIL_LOCATION",function(e,t){s.noFresh=!0,s.productModel.pcrName=t["text-1"]+" "+t["text-2"]+" "+t["text-3"]+"/"+t["text-4"],s.productModel.provinceId=t["value-1"],s.productModel.cityId=t["value-2"],s.productModel.regionId=t["value-3"],s.productModel.streetId=t["value-4"],r.addressStr=JSON.stringify(t),c.getO2OName(s.productModel.product.sku,s.productModel.provinceId,s.productModel.cityId,s.productModel.regionId,s.productModel.streetId).success(function(e){$.isEmptyObject(e.data)?s.showO2OMsg=!1:(s.showO2OMsg=!0,s.O2OStoreName=e.data.O2OStoreName,s.avatarImageFileId=e.data.avatarImageFileId,s.o2oStoreId=e.data.o2oStoreId,s.O2Omobile=e.data.mobile,s.O2Omobile?s.showPhoneCall=!0:s.showPhoneCall=!1,s.serviceGrade=e.data.serviceGrade,s.productGrade=e.data.productGrade,s.logisticalGrade=e.data.logisticalGrade);var t=s.showO2OMsg?s.o2oStoreId:"";c.getIsShowAttr(s.productId,t).success(function(e){e.result?s.IsShowAttribute=!0:s.IsShowAttribute=!1})}),s.productModel.pcrName&&s.noFresh&&c.locationChange(s.productModel.product.sku,s.productModel.product.productId,s.productModel.regionId,s.productCount,t["value-1"],t["value-2"],s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(e,o,n,a){if(s.hasStock=e.data.hasStock,s.isSupportCOD=e.data.isSupportCOD,s.expectTime=e.data.expectTime,s.commission=e.data.commission,s.commissionRate=e.data.commissionRate,s.finalPrice=e.data.finalPrice,s.actualPrice=e.data.actualPrice,s.StoreAttributePrice=s.actualPrice,s.noFresh=!1,s.iscompleteLoad=!0,s.finMoreAct=s.finalPrice-s.actualPrice>0,s.bigActivity=e.data.bigActivity,s.freeOrder=e.data.freeOrder,s.halfDay=e.data.halfDay,s.oneDay=e.data.oneDay,s.isPackage=e.data.isPackage,s.couponList=e.data.sgStoreCouponVoList,s.giftInfo=e.data.giftInfo,s.stockNumber=e.data.stockNum,s.StoreAttributNumber=s.hasStock?"有货":"无货",s.isFlashsales=e.data.isFlashsales,s.flashsalesEndTime=e.data.flashsalesEndTime,s.flashsalesEndTime<(new Date).getTime()&&(s.isFlashsales=!1),window.cordova&&r.gio.track("stockInfo",{productId:s.productModel.product.productId,productFirstName:"",hasStock:s.hasStock,ReceivingProvince:t["text-1"],ReceivingCity:t["text-2"],ReceivingDistrict:t["text-3"],ReceivingStreet:t["text-4"]}),"undefined"!=typeof gio&&gio("track","getAddress",{productId:s.productModel.product.productId,productFirstName:"",hasStock:s.hasStock?"有货":"无货",ReceivingProvince:t["text-1"],ReceivingCity:t["text-2"],ReceivingDistrict:t["text-3"],ReceivingStreet:t["text-4"]}),1==s.isFlashsales){s.state=!0;var c=new Date,l=s.flashsalesEndTime,d=c.getTime();if(l<d)s.state=!1;else var u=i(function(){d+=1e3;var e=parseInt((l-d)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),a=e-24*t*60*60-60*n*60,r=parseInt(a/60),c=e-24*t*60*60-60*n*60-60*r;s.showtime1=t+"天"+P.PrefixInteger(n)+":"+P.PrefixInteger(r)+":"+P.PrefixInteger(parseInt(c)),e<=-1&&(s.state=!1,i.cancel(u),g.reload())},1e3)}s.originalPrice=e.data.originalPrice,s.isAcReserve=e.data.isAcReserve,s.acReserveType=e.data.acReserveType,s.acReserveId=e.data.acReserveId,s.acReserveEndTime=e.data.acReserveEndTime,s.state1=!0;var p=new Date,m=s.acReserveEndTime,f=p.getTime(),h=i(function(){f+=1e3;var e=parseInt((m-f)/1e3),t=parseInt(e/86400),o=e-24*t*60*60,n=parseInt(o/3600),a=e-24*t*60*60-60*n*60,r=parseInt(a/60),c=e-24*t*60*60-60*n*60-60*r;s.showtime=t+"天"+P.PrefixInteger(n)+":"+P.PrefixInteger(r)+":"+P.PrefixInteger(parseInt(c)),-1==e&&(F.close(),g.reload(),s.state=!1,i.cancel(h))},1e3);1==s.isAcReserve&&(1==s.acReserveType&&(s.repur="预约",s.repurNum=e.data.acReserveNum),2==s.acReserveType&&(s.repur="抢购",s.repurNum=e.data.acPurchaseNum))})});s.$on("$destroy",function(){ee(),ee=null}),s.openMore=function(){s.moreShow=!s.moreShow},s.closeCoupons=function(){s.getcoupons=!1,H=1},s.logConpous=function(){c.getShopCoupons(s.productModel.product.productId,s.productModel.product.brandId,s.productModel.product.productCateId,s.productModel.actualPrice,H,5,s.o2oStoreId).success(function(e,t,o,i){e.success?1==H?(H++,s.shopCoupons=e.data,b.$getByHandle("mainScroll").scrollTop(),s.shopCoupons.length<e.totalCount?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMoreCoupons=!0):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMoreCoupons=!1)):(H++,s.shopCoupons=s.shopCoupons.concat(e.data),s.shopCoupons.length<e.totalCount?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMoreCoupons=!0):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMoreCoupons=!1)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasMoreCoupons=!1)})},s.openCoupons=function(){s.logConpous(),s.getcoupons=!0},s.getNewCoupons=function(e){o.isWdHost().success(function(t){r.isWdHost=t.data.isHost,-1==r.isWdHost?g.go("login"):A.doGetNewCoupons(e).success(function(e){e.success?(r.couponXyzType=!0,b.scrollTop(),H=1,s.logConpous()):(s.remindSuccess=!0,s.message=e.message,setTimeout(function(){s.$apply(function(){s.remindSuccess=!1})},1500))})})},s.goMessageCenter=function(){s.moreShow=!1,g.go("messageCenter")},s.goBack=function(){"advertisement"==r.fromState?g.go("homePage"):s.goBackFlag&&(s.goBackFlag=!1,w.goBack())},s.showCopyButton=function(){window.cordova&&(s.isShowCopyButton=!0)},s.$on("$ionicView.beforeLeave",function(e,t){s.watch()}),s.$on("$ionicView.beforeEnter",function(){s.isShowBigPic=!1,s.remindSuccess=!1,s.isWhiteShows=!1,H=1,s.getcoupons=!1,conjs=document.getElementsByClassName("container"),M(),U(),R(),s.goBackFlag=!0,s.nowLevel=0,s.nowLevelIndex=[-1,-1,-1,-1],s.provinceTop=0,s.cityTop=0,s.areaTop=0,s.finish=!1,s.watch=s.$watch("finish",function(e,t){e&&b.$getByHandle("mainScroll").scrollTo(0,s.provinceTop)}),s.isIos=!!ionic.Platform.isIOS(),r.isApp=!!window.cordova||void 0,s.shareStoreId=a.shareStoreId,s.userId=m.getUser().mid,s.isBuyer=S.getRole(),s.init(),s.addressInit(s.dataAdd,s.defaultValue,"PRODUCT_DETAIL_LOCATION",0),w.viewHistory().backView&&(V=w.viewHistory().backView,"bannerTheme"!=V.stateName&&"bannerDaily"!=V.stateName||(s.isFromBanner=!0)),s.$on("$destroy",function(){s.addressModal.remove()}),r.addressStr=void 0,W=window.navigator.userAgent.toLowerCase(),q="micromessenger"==W.match(/MicroMessenger/i),s.getCartNumFn(0)}),s.$on("$ionicView.afterLeave",function(){i.cancel(j),i.cancel(z)}),s.changeState=function(e){"orderDetail"==V.stateName&&0==s.isBuyer||(1==e?c.changeChooseStateJia(s.productModel.product.productId,"1").success(function(e,t,o,i){s.productModel.onShelf=!s.productModel.onShelf}):c.changeChooseStateDui(s.productModel.product.productId).success(function(e,t,o,i){s.productModel.onShelf=!s.productModel.onShelf}))},s.addToCart=function(){1==s.isFlashsales&&1!=s.productCount?h.showToast("限时抢购商品，一次只能购买一个"):x.loadCartMessage().success(function(e){if(1==s.isFlashsales&&e.data.carts)for(var t=0;t<e.data.carts.length;t++)if(e.data.carts[t].productId==s.productId)return h.showToast("限时抢购商品，一次只能购买一个"),!1;c.checkStockForPay(s.skku,s.productModel.product.productId,s.productModel.regionId,s.productCount,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(e,t,o,i){if(!e.data.hasStock)return s.showPopup("库存不足！"),!1;c.addToCart(s.productModel.product.sku,s.productModel.product.productId,s.productCount,"",s.productModel.product.productId,s.skku,s.attrValueNames,s.o2oStoreId).success(function(e,t,o,i){1==e.success?(window.cordova&&r.gio.track("ScAdd",{productId:s.productId,productFirstName:"",productSecondName:"",o2oType:s.o2oType,storeId:s.storeId,skku:s.skku,attrValueNames:s.attrValueNames}),"undefined"!=typeof _fxcmd&&_fxcmd.push(["trackEvent","event","cvr3","addcart","1"]),s.getCartNumFn(1)):h.showToast("加入购物车失败")})})})},s.buyNow=function(e){if(q)return void x.check_login().success(function(o){if(o.data)m.setUser(o.data),N.initWebSocket(),window.localStorage.setItem("isLogin",m.isUserLogin()),o.data.sessionValue?t.set("sg_login_token_secret","Bearer"+o.data.sessionValue):t.set("sg_login_token_secret","Bearer"+_.generateUUID()),c.checkStockForPay(s.skku,s.productModel.product.productId,s.productModel.regionId,s.productCount,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(t,o,i,n){if(!t.data.hasStock&&"1"!=e)return c.loadData(s.productId,s.storeId,s.o2oType,s.fromUrl,s.fromType).success(function(t){if(t.data.product.bookable){d.show({template:'<div style="color: black;text-align: center;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>库存不足，是否去预订?</span></div>',scope:s,buttons:[{text:"否"},{text:"<b>是</b>",type:"button-positive",onTap:function(t){c.buyNow(s.productModel.product.productId,s.productCount,e,s.attrValueNames,s.skku).success(function(e,t,o,i){if(e.success&&e.data){var n=new Date;n.setDate(n.getDate()+1),s.IsShowAttribute?g.go("orderConfirm",{Book:1,attrValueNames:s.attrValueNames,skku:s.skku,o2oAttrId:s.o2oStoreId}):g.go("orderConfirm",{Book:1})}else s.showPopup("操作失败！")}).error(function(e,t,o,i){s.showPopup("操作失败！")})}}]})}else s.showPopup("库存不足！")}),!1;c.buyNow(s.productModel.product.productId,s.productCount,e,s.attrValueNames,s.skku).success(function(e,t,o,i){if(e.success&&e.data){window.cordova&&r.gio.track("BuyNow",{productId:s.productId,productFirstName:"",productSecondName:"",o2oType:s.o2oType,storeId:s.storeId});var n=new Date;n.setDate(n.getDate()+1),s.IsShowAttribute?g.go("orderConfirm",{Book:0,attrValueNames:s.attrValueNames,skku:s.skku,o2oAttrId:s.o2oStoreId}):g.go("orderConfirm",{Book:0})}else"1001"==e.code&&e.success,s.showPopup(e.message)}).error(function(e,t,o,i){s.showPopup("操作失败！")})});else{var i=t.get("sg_login_token_secret"),n=D.absUrl(),a=n.indexOf("html?");if(-1!=a)var l=n.indexOf("#",a),u=n.substring(0,a)+"html",p=n.substring(l),h=encodeURIComponent(u+p)+encodeURIComponent("/")+i;else var h=encodeURIComponent(n)+encodeURIComponent("/")+i;x.state_id(h).success(function(e){var t=e.data,o=f.getCPUrl("WXSQ_ID"),i=encodeURIComponent(f.getCPUrl("WXSQ_URL")+"platform/web/member/wxWebLogin.json"),s="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+o+"&redirect_uri="+i+"&response_type=code&SCOPE=snsapi_userinfo&state="+t+"#wechat_redirect";document.location.href=s})}});o.isWdHost().success(function(t){r.isWdHost=t.data.isHost,-1==r.isWdHost?g.go("login"):c.checkStockForPay(s.skku,s.productModel.product.productId,s.productModel.regionId,s.productCount,s.productModel.provinceId,s.productModel.cityId,s.productModel.pcrName,s.productModel.storeId,s.productModel.streetId).success(function(t,o,i,n){if(!t.data.hasStock&&"1"!=e)return c.loadData(s.productId,s.storeId,s.o2oType,s.fromUrl,s.fromType).success(function(t){if(t.data.product.bookable){d.show({template:'<div style="color: black;text-align: center;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>库存不足，是否去预订?</span></div>',scope:s,buttons:[{text:"否"},{text:"<b>是</b>",type:"button-positive",onTap:function(t){c.buyNow(s.productModel.product.productId,s.productCount,e,s.attrValueNames,s.skku).success(function(e,t,o,i){if(e.success&&e.data){var n=new Date;n.setDate(n.getDate()+1),s.IsShowAttribute?g.go("orderConfirm",{Book:1,attrValueNames:s.attrValueNames,skku:s.skku,o2oAttrId:s.o2oStoreId}):g.go("orderConfirm",{Book:1})}else s.showPopup("操作失败")}).error(function(e,t,o,i){s.showPopup("操作失败！")})}}]})}else s.showPopup("库存不足！")}),!1;c.buyNow(s.productModel.product.productId,s.productCount,e,s.attrValueNames,s.skku).success(function(e,t,o,i){if(e.success&&e.data){window.cordova&&r.gio.track("BuyNow",{productId:s.productId,productFirstName:"",productSecondName:"",o2oType:s.o2oType,storeId:s.storeId});var n=new Date;n.setDate(n.getDate()+1),s.IsShowAttribute?g.go("orderConfirm",{Book:0,attrValueNames:s.attrValueNames,skku:s.skku,o2oAttrId:s.o2oStoreId}):g.go("orderConfirm",{Book:0})}else"1001"==e.code&&e.success,s.showPopup(e.message)}).error(function(e,t,o,i){s.showPopup("操作失败！")})})})},s.toNotice=function(){d.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"><span>商品名称：</span><span ng-bind="productModel.product.productFullName"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:s,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!s.globalConstant.mobileNumberRegExp.test(s.user.mobile))return void h.showToast("请输入正确的手机号码！");c.checkNotice(s.productId,s.user.mobile,s.productModel.provinceId,s.productModel.cityId,s.productModel.regionId,s.productModel.streetId).success(function(e){if(e.success)if(0===e.result)c.arriveNotice(s.productId,s.user.mobile,s.productModel.provinceId,s.productModel.cityId,s.productModel.regionId,s.productModel.streetId,s.productModel.product.sku,s.productModel.product.productFullName,s.productModel.provinceName,s.productModel.cityName,s.productModel.regionName,s.o2oStoreId).success(function(e){if(e.success){h.showAlert("","您的资料已经提交，到货后我们会第一时间通知您！")}});else{h.showAlert("","该手机号在该地区已经申请到货通知，不能重复申请！")}})}}]})},s.startNotice=function(){d.show({template:'<div style="color: black;text-align: left;font-size: 12px;overflow: hidden;white-space:nowrap; text-overflow:ellipsis;"></span></div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div>',scope:s,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){if(!s.globalConstant.mobileNumberRegExp.test(s.user.mobile))return void h.showToast("请输入正确的手机号码！");c.startNotice(s.productId,s.user.mobile).success(function(e){h.showToast("提交成功！")})}}]})},s.tianJiaShouCang=function(){o.isWdHost().success(function(e){r.isWdHost=e.data.isHost,-1==r.isWdHost?g.go("login"):c.addShouCang(s.productId,s.productModel.product.productName,s.productModel.product.defaultImageUrl,s.productModel.product.sku,s.productModel.pcrName).success(function(e){s.showPopup("收藏成功"),s.productModel.isCollected=!s.productModel.isCollected})})},s.quXiaoShouCang=function(){c.cancelShouCang(s.productId).success(function(e){s.showPopup("取消成功"),s.productModel.isCollected=!s.productModel.isCollected})},s.showPopup=function(e){var t=d.show({template:e});u(function(){t.close()},1e3)},s.customerServe=function(){if(m.isUserLogin())if(window.cordova){var e=ionic.Platform.isAndroid(),o=null;o=e?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&u(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else s.kfTocken=t.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?itemid="+s.productId+"&storeId="+s.storeId+"&flag="+s.kfTocken);else g.go("login")},s.share=function(){if(!m.getUser().mid)return void g.go("login");if(s.moreShow=!1,window.device&&window.device.hasNewShare){if(!s.productModel)return void s.showPopup("网络连接失败，请稍后分享");s.showShare=!s.showShare}else if(window.umeng){if(!s.productModel)return void s.showPopup("网络连接失败，请稍后分享");var e=s.productModel.product.productFullName,t=s.productModel.product.productTitle||s.productModel.product.productFullName,o=s.productModel.product.defaultImageUrl,i=f.getShareLinkHeader()+"productDetail/"+s.productId+"/"+s.o2oType+"/"+s.fromType+"/"+s.productModel.storeId+"/"+s.productModel.storeId+"?fs";window.umeng.share(e,t,o,i,0)}},s.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),h.showToastShort("复制成功"),s.isShowCopyButton=!1):h.showToast("请下载APP执行此操作")},s.hideblackCover=function(){s.showShare=!1},s.shareToPlatform=function(e){if(!m.getUser().mid)return void g.go("login");var t=s.productModel.product.productFullName,o=s.productModel.product.productTitle||s.productModel.product.productFullName,i=s.productModel.product.defaultImageUrl,n=f.getShareLinkHeader()+"productDetail/"+s.productId+"/"+s.o2oType+"/"+s.fromType+"/"+s.userId+"/"+s.userId+"?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,i,n,0,null,y.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,n,0,null,y.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,n,0,null,y.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,n,0,null,y.shareSuccessCallback),y.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,n,0,null,y.shareSuccessCallback),y.qqShare()),5==e?s.copeText(n):y.successShare()):alert("umeng undefined 只能在app分享"),s.showShare=!1},s.closeRule=function(){s.isShowService=!1},s.openRule=function(){s.isShowService=!0},s.open3d=function(){var e=s.productModel.product.vrUrl;window.cordova?r.isIOS?window.emc.presentH5View(e,"3D体验"):g.go("c",{vrUrl:s.productModel.product.vrUrl}):window.open(e)},s.nowOrder=function(){o.isWdHost().success(function(e){r.isWdHost=e.data.isHost,-1==r.isWdHost?g.go("login"):c.checkRes(s.acReserveId,s.productId).success(function(e){if(0==e.success)h.showToast(e.message);else var t=d.show({template:'<div style="text-align: center;color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;">预约信息确认</div><div style="text-align: left;color: black;font-size: 12px"><span>手机号：</span><input type="tel" ng-model="user.mobile" style="display: inline;width: 70%;border: solid 1px #ddd;"/></div><div style="text-align: left;color: black;font-size: 12px"><span>验证码：</span><input type="text" ng-model="user.message" style="display: inline;width: 35%;border: solid 1px #ddd;"/><span style="margin-left:8px;padding:4px;background:#d6d7d9" ng-click="getSms()" ng-style="VCodeStyle">{{VCodeTips}}</span></div><div style="text-align: left;color: #666666;font-size: 12px"><p>温馨提示:</p><p>1.我们会向此手机号发送抢购信息通知,请认真填写;</p><p>2.提交后信息不可修改</p><p>3.预约成功不代表购买成功</p></div>',scope:s,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(e){return e.preventDefault(),s.globalConstant.mobileNumberRegExp.test(s.user.mobile)?void 0==s.user.message||""==s.user.message?void h.showToast("请输入验证码!"):void c.checkRes(s.acReserveId,s.productId).success(function(e){0==e.success&&h.showToast(e.message),1==e.success&&1==e.data?c.sendRes(s.acReserveId,s.productId,s.user.mobile,s.user.message,s.productModel.provinceId,s.productModel.cityId,s.productModel.regionId,s.productModel.streetId).success(function(e){0==e.success&&h.showToast(e.message),1==e.success&&1==e.data?(h.showToast('<div style="position:relative;"><img src="img/u93.png"/><span class="myduigou">√</span></div><p>商品预约成功</p><p>可在<b>个人中心-我的预约</b>中查看预约商品</p>'),t.close()):1==e.success&&0==e.data&&h.showToast("预约人数太多,稍后重试")}):1==e.success&&0==e.data&&h.showToast("预约人数太多,稍后重试"),s.user.message=""}):void h.showToast("请输入正确的手机号码！")}}]})})})},s.getSms=function(){if(s.canGetVcode){if(!s.globalConstant.mobileNumberRegExp.test(s.user.mobile))return void h.showToast("请输入正确的手机号码！");c.sendSms(s.user.mobile).success(function(e){if(0==e.success)h.showToast(e.message);else{s.canGetVcode=!s.canGetVcode;var t=60;s.timersms=i(function(){t-1<0?(s.VCodeTips="获取验证码",s.VCodeStyle={color:"#2979FF"},i.cancel(s.timersms),s.canGetVcode=!0):(s.VCodeStyle={color:"#666666"},t--,s.VCodeTips="重发 "+t+"s")},1e3)}})}}}]),APP.service("ProductDetailService",["$http","UrlService",function(e,t){this.locationChange=function(o,i,s,n,a,r,c,l,d){var u={sku:o,prodId:i,regionId:s,number:n,provinceId:a,cityId:r,pcrName:c,memberId:l,streetId:d};return e.get(t.getUrl("LOCATION_CHANGE"),u)},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)},this.loadData=function(o,i,s,n,a){var r={storeId:i,o2oType:s,fromUrl:n,fromType:a,type:1};return e.get(t.getUrl("PRODUCTDETAIL_LODEDATA")+o+".html",r)},this.changeChooseStateJia=function(o,i){var s={productId:o,onShelf:i};return e.get(t.getUrl("CHANGECHOOSESTATEJIA_INIT"),s)},this.changeChooseStateDui=function(o){var i={productId:o};return e.get(t.getUrl("CHANGECHOOSESTATEDUI_INIT"),i)},this.addToCart=function(o,i,s,n,a,r,c,l){if(0==c.length)var c="",r="";var d={sku:o,productId:i,number:s,o2oStoreName:n,o2omap:a,skku:r,attrValueNames:c,o2oAttrId:l};return e.get(t.getUrl("ADDCART_INIT"),d)},this.buyNow=function(o,i,s,n,a){if(0==n.length)var n="",a="";else var n=n.join();var r={productIds:o,numbers:i,isBooking:s,version:1,skku:a,attrValueNames:n};return e.get(t.getUrl("CONFIRM_ORDER"),r)},this.addShouCang=function(o,i,s,n,a){var r="productId="+o+"&productName="+i+"&imageUrl="+s+"&sku="+n+"&PCGName="+a;return e({method:"POST",url:t.getUrl("COLLECTION_INIT"),data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.cancelShouCang=function(o){var i="productId="+o;return e({method:"POST",url:t.getUrl("DELETECOLLECTION_INIT"),data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.checkNotice=function(o,i,s,n,a,r){var c={productId:o,mobile:i,provinceId:s,cityId:n,areaId:a,streetId:r};return e.get(t.getUrl("CHECK_NOTICE"),c)},this.startNotice=function(o,i){var s={productId:o,mobile:i};return e.get(t.getUrl("START_NOTICE"),s)},this.arriveNotice=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={productId:o,mobile:i,provinceId:s,cityId:n,areaId:a,streetId:r,sku:c,productName:l,provinceName:d,cityName:u,areaName:p,o2oStoreId:g};return e.get(t.getUrl("ARRIVE_NOTICE"),m)},this.getO2OName=function(o,i,s,n,a){var r={sku:o,provinceId:i,cityId:s,regionId:n,streetId:a};return e.get(t.getUrl("GET_O2O_NAME"),r)},this.getMergeImage=function(o,i){var s={productId:o,storeId:i};return e.get(t.getUrl("GET_MERGE_IMAGE"),s)},this.sendSms=function(o){var i={mobile:o};return e.get(t.getNewUrl("GET_SMSS"),i)},this.getShopCoupons=function(o,i,s,n,a,r,c){var l={productId:o,brandId:i,cateId:s,price:n,startIndex:a,pageSize:r,o2oStoreId:c};return e.get(t.getUrl("NEW_SHOP_COUPONS_LIST"),l)},this.getProductCouponsHas=function(o,i,s,n,a,r){var c={sku:o,prodId:i,number:s,finalPrice:n,memberId:a,o2oStoreId:r};return e.get(t.getNewUrl("PRODUCT_COUPONS_HAS"),c)},this.sendRes=function(o,i,s,n,a,r,c,l){var d={acReserveId:o,productId:i,mobile:s,mobileCode:n,provinceId:a,cityId:r,districtId:c,streetId:l};return e.get(t.getNewUrl("SUB_PRESS"),d)},this.checkRes=function(o,i){var s={acReserveId:o,productId:i};return e.get(t.getNewUrl("CHECK_RES"),s)},this.evalute=function(o){return e.get(t.getUrl("EVALUATE_INFO")+o+".html")},this.checkStockForPay=function(o,i,s,n,a,r,c,l,d){var u={sku:o,prodId:i,regionId:s,number:n,provinceId:a,cityId:r,
<<<<<<< .mine
pcrName:c,memberId:l,streetId:d};return e.get(t.getUrl("PAY_CHECK_STOCK"),u)},this.getSgStoreAttribute=function(o,i,s){var n={productId:o,storeId:i,sku:s};return e.get(t.getUrl("GET_GETSGSTOREATTRIBUTE"),n)},this.getDetailAttribute=function(o,i,s,n){var a={productId:o,storeId:i,attrValueIds:s,attrIds:n};return e.get(t.getUrl("GET_GETDETAILATTRIBUTE"),a)},this.getIsShowAttr=function(o,i){var s={productId:o,storeId:i};return e.get(t.getUrl("GET_ISSHOWATTR"),s)},this.getCartNum=function(){return e.get(t.getUrl("GET_CARTNUM"))}}]),APP.controller("productEffectController",["$scope","$stateParams","$sce",function(e,t,o){e.vrUrl=o.trustAsResourceUrl(t.vrUrl)}]),APP.controller("ProductRatedController",["$scope","$stateParams","$rootScope","ProductRatedService","$ionicPopup","$timeout","$ionicScrollDelegate","$state","UserService","UrlService",function(e,t,o,i,s,n,a,r,c,l){function d(t){i.loadData(e.productId,e.pageIndex,e.pageSize,e.assessLevel,t).success(function(t,o,i,s){if(null!=t.data&&0!=t.data.length||1!=e.pageIndex){e.isHasData=!0,e.assessList=e.assessList.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"),e.hasMore=5==t.data.length;for(var n=0;n<e.assessList.length;n++)if(null!=e.assessList[n].experienceTime){var a=e.assessList[n].experienceTime,r=e.assessList[n].createTime,c=(a-r)/1e3,l=parseInt(c/86400);e.assessList[n].dayTime=l>0?l:0}else e.assessList[n].dayTime=0}else e.isHasData=!1})}e.allComment=!0,e.goodComment=!1,e.neutralComment=!1,e.negativeComment=!1,e.havePicComment=!1,e.productId=t.productId,e.assessLevel="all",e.hasPic="",e.pageSize=5,e.pageIndex=1,e.assessList=[],e.assessListDay=[],e.isHasData=!0,e.hasMore=!1,e.productRatedSub={top:"43px"},e.productRatedContent={top:"128px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.productRatedSub={top:"63px"},e.productRatedContent={top:"148px"}),e.isCheckStyle={color:"#fff",background:"#fd4f00"},e.noCheckStyle={color:"#000",background:"#fdebeb"},e.initData=function(){i.getData(e.productId).success(function(t,o,i,s){e.assessData=t.data}),i.getTabData(e.productId).success(function(t,o,i,s){e.markData=t.data}),e.pageIndex=1,e.assessList=[],d(!1)},e.loadMore=function(){e.pageIndex=e.pageIndex+1,d(!0)},e.goBack=function(){e.$ionicGoBack()},e.clickCommentType=function(t){a.scrollTop(),e.allComment="all"==t,e.goodComment="praise"==t,e.neutralComment="neutral"==t,e.negativeComment="poor"==t,e.havePicComment="image"==t,e.assessLevel=t,e.hasPic="",e.pageIndex=1,e.assessList=[],d(!1)},e.showLarge=function(t){e.showBigImage=!0,e.largeImg=t},e.closeImg=function(){e.showBigImage=!1},e.$on("$ionicView.beforeEnter",function(){a.scrollTop(),e.isHasData=!0,e.initData()})}]),APP.service("ProductRatedService",["$http","UrlService",function(e,t){this.getData=function(o){var i={productId:o};return e.get(t.getUrl("PRODUCT_RATED_TOASSESS_LIST"),i)},this.getTabData=function(o){var i={productId:o};return e.get(t.getUrl("PRODUCT_ASSESS_MARK"),i)},this.loadData=function(o,i,s,n,a){var r={productId:o,pageIndex:i,pageSize:s,commentType:n,noLoading:a};return e.get(t.getUrl("PRODUCT_RATED_ASSESS_LIST"),r)}}]),APP.controller("SeeMoreController",["$sce","HomePageService","PopupService","$ionicPopup","UrlService","$q","$rootScope","CommonAddressService","AreaService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","SeeMoreService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(){var e=n.defer();return ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(t){a.globalConstant.lat=t.latitude,a.globalConstant.lon=t.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),a.globalConstant.positionStatus=!0},function(e){"12"==e.errorCode&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),a.globalConstant.positionStatus=!1}):c.init().then(function(t){a.globalConstant.lat=t.coords.latitude,a.globalConstant.lon=t.coords.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),a.globalConstant.positionStatus=!0},function(e){"1"==e.code&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),a.globalConstant.positionStatus=!1}),e.promise}p.toHomeking=function(){h.homeking().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"好慷在家"):window.location.href=t}else f.go("login")})},p.goToEmc=function(){p.isApp?t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):t.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(s.getEnviroment(),t,""):o.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):o.showToast("请去顺逛App查看此服务")},p.openCC=function(e,i){switch(e){case 1:t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):v().then(function(e){var t=s.getCPUrl("SZD_URL"),o=t+"?token="+m.getUser().token+"&alt="+a.globalConstant.lat+"&lng="+a.globalConstant.lon+"&cityCode="+e;window.cordova?window.emc.presentH5View(o,"水之道"):window.open(o,"_blank","location=yes")})});break;case 2:window.cordova?window.emc.presentH5View(i,"游戏头条"):window.open(i,"_blank","location=yes");break;case 3:t.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else{var t="http://m.ehaier.com/v3/mstore/sg/diy/login/request.html?flag="+$localstorage.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=t);window.emc.presentH5View(t,"海尔交互定制平台")}});break;case 4:t.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else if(window.cordova){var t=m.getUser().accessToken;window.emc.presentWashView(a.userAccount,a.password,t)}else o.showToast("请去顺逛App查看此服务")});break;case 5:;window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes");break;case 6:var n="http://uhome.haier.net:8470/acbizCms/aircircle/indexAirCircle.do";window.cordova?window.emc.presentH5View(n,"好空气"):window.open(n,"_blank","location=yes");break;case 7:var r="http://linkcook.cn/quanquan/ulist.html";window.cordova?window.emc.presentH5View(r,"馨小厨"):window.open(r,"_blank","location=yes");break;case 8:var c="http://jiuzhidao.com/wap/";window.cordova?window.emc.presentH5View(c,"酒知道"):window.open(c,"_blank","location=yes");break;case 9:var l="http://b2b.haier.com/mobiles/index.html";window.cordova?window.emc.presentH5View(l,"海尔企业购"):window.open(l,"_blank","location=yes");break;case 10:var d="http://www.saywash.com/saywash/WashCallWx/page/index.html";window.cordova?window.emc.presentH5View(d,"社区洗"):window.open(d,"_blank","location=yes")}},p.$on("$ionicView.beforeEnter",function(){window.cordova?p.isApp=!0:p.isApp=!1}),p.goToApplyForCard=function(){t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):f.go("applyForCard")})}}]),APP.service("SeeMoreService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.homeking=function(){return e.get(t.getNewUrl("GET_homeking"))}}]),APP.controller("superMarketController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case"2":if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.superMarket_xScroll div").eq(0).width(),i=$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq(0)").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").css({width:o,left:i})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),APP.controller("OrderConfirmSeckillController",["$scope","SeckillService","$stateParams","$rootScope","$state","OrderConfirmSeckillService","$ionicPopup","$timeout","PopupService","CacheService","SeckillDetailService","$interval",function(e,t,o,i,s,n,a,r,c,l,d,u){e.htmlContent=o.content,e.title=o.title,e.tabNav="selection",e.searchGoodsName={name:""},e.seckillId,e.numbers,e.productIds,e.invoiceHead=void 0,e.zzsInvoice=void 0,e.isEnd=!1,e.unSale,e.init=function(){if(e.isEnd=!1,t.getServerTime().then(function(t){var i=t.data.data,s=o.beginTime,n=o.endTime,a=u(function(){(i+=1)<s||i>=s&&i<=n||i==s||i>n&&(e.isEnd=!0,u.cancel(a))},1e3)}),e.orderData={},e.htmlContent=o.content,e.title=o.title,e.seckillId=o.seckillId,e.numbers=o.numbers,e.productIds=o.productIds,e.orderConfirmMessage=l.get("seckillOrderInfo"),!e.orderConfirmMessage)throw new Error("订单生成失败,fatal---error");e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle},e.$on("$ionicView.beforeEnter",function(t,o){if("back"==o.direction){var i={isFromInvoices:1};d.seckillBuy(i).success(function(t){1==t.success&&null!=t.data?(e.orderConfirmMessage=t.data,e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle):e.showPopup("订单查询失败 ")}).error(function(e){alert("网络错误")})}else e.init()}),e.toInvoice=function(t){s.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:1})},e.toSubmit=function(){if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))n.toSubmit(e.seckillId).success(function(t,o,i,n){if(1==t.success){var a=JSON.stringify(t.data.order);s.go("afterOrderSubmit",{messageData:a})}else 0==t.success&&e.showPopup(t.message)}).error(function(){alert("网络失败")});else{a.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}},e.toPayment=function(){s.go("payment")},e.tosendGoodsTime=function(){s.go("sendGoodsTime")},e.showPopup=function(e){var t=a.show({template:e});r(function(){t.close()},1e3)}}]),APP.service("OrderConfirmSeckillService",["$http","UrlService",function(e,t){this.toSubmit=function(o){var i={remark:"",seckillId:o};return e({method:"POST",url:t.getUrl("SECKILL_CONFIRM_ORDER_INFO"),params:i})}}]),APP.controller("SeckillDetailController",["$scope","$stateParams","$rootScope","ProductDetailService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","SeckillDetailService","CacheService","CommonAddressService","SeckillService","$interval","countdownService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){e.noFresh=!1,e.tabNav="selection",e.isButton=!0,e.countDownMsg="",e.seckillList=[],e.isEnd=!1,e.productId=t.productId,e.message,e.beginTime=t.beginTime,e.endTime=t.endTime,e.unSale,e.init=function(){e.isEnd=!1,g.getServerTime().then(function(t){var o=t.data.data,i=e.beginTime,s=e.endTime,n="",a=m(function(){o+=1,o<i?(n=f.getTime(f.getTimeDif(1e3*i,1e3*o)),e.countDownMsg="距开始"+n):o>=i&&o<=s||o==i?e.countDownMsg="秒杀":o>s&&(e.isEnd=!0,e.countDownMsg="秒杀活动已结束",m.cancel(a))},1e3)}),e.user=c.getUser(),e.iscompleteLoad=!1,e.storeId=t.storeId,e.o2oType=t.o2oType,e.status=t.status,e.fromType=t.fromType,e.front=t.front,e.sku=t.sku,e.seckillId=t.seckillId,e.hasStock=!0,e.memberId="",e.seckillPrice=t.seckillPrice,e.actualPrice,e.pcPrice,e.O2OStoreName,e.hasStock,e.productCount=1,e.swiperImgs=[],e.user&&e.user.mid&&(e.memberId=e.user.mid);var o=p.getAddressInfo(),i={sku:e.sku,prodId:e.productId,regionId:o.areaId,number:1,provinceId:o.provinceId,cityId:o.cityId,pcrName:o.provinceName+" "+o.cityName+" "+o.regionName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId},s={productId:e.productId,storeId:e.storeId,fromUrl:"seckillList",seckillId:e.seckillId,ts:new Date-0};d.seckillDetail(s).success(function(t){0==t.success?e.unSale=!0:(e.productModel=t.data.product,e.productModel.pcrName=t.data.pcrName,e.iscompleteLoad=!0,e.swiperImgs=t.data.swiperImgs,e.actualPrice=t.data.actualPrice,e.pcPrice=t.data.finalPrice,e.O2OStoreName=t.data.O2OStoreName,d.checkStock(i).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1}))}).error(function(e){alert("网络错误")})},o.$on("SECKILL_LOCATION_"+e.productId,function(t,o){if(e.noFresh=!0,e.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+" "+o["text-4"],e.productModel.pcrName){var i={sku:e.sku,prodId:e.productId,regionId:o["value-3"],number:1,provinceId:o["value-1"],streetId:o["value-4"],cityId:o["value-2"],pcrName:e.productModel.pcrName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId};d.checkStock(i).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1})}}),e.goBack=function(){1==e.front?r.go("myStore"):e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()}),e.changeState=function(t){1==t?i.changeChooseStateJia(e.productModel.product.sku,"1").success(function(t,o,i,s){e.productModel.product.onShelf=!e.productModel.product.onShelf}):i.changeChooseStateDui(e.productModel.product.sku).success(function(t,o,i,s){e.productModel.product.onShelf=!e.productModel.product.onShelf})},e.changeArea=function(){r.go("commonLocation",{flag:"SECKILL_LOCATION_"+e.productId})},e.seckillBuy=function(){var t={productIds:e.productId,numbers:1,seckillId:e.seckillId,COOKIE_DOMAIN:"mk",DOMAIN_URL:"http://172.24.1.22",POM_STATIC_DOMAIN_NAME:"http://172.24.1.22/mstatic"};d.seckillBuy(t).success(function(o){1==o.success&&null!=o.data?(u.set("seckillOrderInfo",o.data),r.go("orderConfirmSeckill",{seckillId:t.seckillId,numbers:t.numbers,productIds:t.productIds,beginTime:e.beginTime,endTime:e.endTime})):0==o.success?(e.unSale=!0,e.init()):e.showPopup("立即购买失败")}).error(function(e){alert("网络错误")})},e.tianJiaShouCang=function(){i.addShouCang(e.productId,e.productModel.product.productName,e.productModel.product.defaultImageUrl,e.productModel.product.sku,e.productModel.pcrName).success(function(t){e.showPopup("收藏成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.quXiaoShouCang=function(){i.cancelShouCang(e.productId).success(function(t){e.showPopup("取消成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.showPopup=function(e){var t=s.show({template:e});n(function(){t.close()},1e3)},e.customerServe=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_blank","location=yes"):(e.indexOf("iPhone"),window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"))},e.share=function(){if(!c.getUser().mid)return void h.showToast("请先登录,再分享");if(window.umeng){var t=l.getShareLinkHeader()+"seckillDetail/"+e.productId+"/"+e.o2oType+"/"+e.fromType+"/"+e.storeId+"/"+e.front+"/"+e.seckillPrice+"/"+e.seckillId+"/"+e.sku+"/"+e.status+"/"+e.beginTime+"/"+e.endTime+"/"+c.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀商品,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}}]),APP.service("SeckillDetailService",["$http","UrlService",function(e,t){this.checkStock=function(o){var i=t.getUrl("CHECK_STOCK");return e.get(i,o)},this.seckillDetail=function(o){if(!o.productId)return void alert("无productId error");var i=t.getUrl("SECKILLDETAIL")+o.productId+".html";return e.get(i,o)},this.seckillBuy=function(o){var i=t.getUrl("SECKILLBUY");return e.get(i,o)}}]),APP.controller("SeckillListController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","SeckillService","$localstorage","UserService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d){function u(e){var t=new Date(e),o=(t.getFullYear(),t.getMonth()+1);o=o<10?"0"+o:o;var i=t.getDate();i=i<10?"0"+i:i;var s=t.getHours();s=s<10?"0"+s:s;var n=t.getMinutes();n=n<10?"0"+n:n;var a=t.getSeconds();return a=a<10?"0"+a:a,o+"月"+i+"日"+s+":"+n+":"+a}e.storeId,e.seckillStatus=0,e.seckillList=[],e.timer=void 0,e.curTime,e.timeDiff,e.isNull;e.init=function(){e.isNull=!1,e.seckillList=[];var o=c.get("storeId",t.globalConstant.storeId);e.storeId=o,r.getServerTime().error(function(){alert("网络失败")}).then(function(t){var o=t.data.data;e.serverMs=1e3*o;new Date(e.serverMs);return r.getSeckillList()}).then(function(t){function o(e,t){return e-t}if(!t)return e.ponitList=[],void alert("网络失败");e.seckillList=t.data.data,0==e.seckillList.size&&(e.isNull=!0),e.ponitList=[],angular.forEach(e.seckillList,function(t,o){t.beginStr=u(1e3*t.beginTime),t.endStr=u(1e3*t.endTime),t.status=void 0,e.serverMs<1e3*t.beginTime?(t.status=1,e.ponitList.push(1e3*t.beginTime-e.serverMs)):e.serverMs>=1e3*t.beginTime&&e.serverMs<=1e3*t.endTime?(e.ponitList.push(1e3*t.endTime-e.serverMs),t.status=2):e.serverMs>1e3*t.endTime&&(t.status=3),angular.forEach(t.sgSeckillItemFormList,function(e,o){e.beginTime=t.beginTime,e.endTime=t.endTime})}),e.ponitList.sort(o),e.ponitList[0]&&(e.timer=s(function(){e.init()},e.ponitList[0]>36e5?36e5:e.ponitList[0]))},function(t){alert("网络失败"),e.isNull=!0})},e.toDetail=function(e,t){i.go("seckillDetail",{productId:e.productId,o2oType:0,fromType:4,storeId:o.storeId,front:0,sku:e.sku,seckillPrice:e.seckillPrice,seckillId:e.seckillId,status:t,beginTime:e.beginTime,endTime:e.endTime})},e.$on("$ionicView.beforeEnter",function(t,o){e.init()}),e.$on("$ionicView.beforeLeave",function(t,o){s.cancel(e.timer)}),e.doRefresh=function(){s(function(){e.init(),e.$broadcast("scroll.refreshComplete")},1e3)},e.share=function(){if(!l.getUser().mid)return void d.showToast("请先登录,再分享");if(window.umeng){var e=n.getShareLinkHeader()+"seckillList/"+l.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}}]),APP.service("SeckillService",["$http","UrlService",function(e,t){this.getSeckillList=function(){var o=t.getUrl("SECKILL_LIST");return e.post(o)},this.getSeckillDetail=function(e){t.getUrl("SECKILL_LIST",e)},this.getServerTime=function(o){var i=t.getUrl("SECKILL_SERVICE_TIME",o);return e.get(i)}}]),APP.directive("countdown",["$timeout","countdownService",function(e,t){return{restrict:"E",template:"<i>{{time.dd}}</i> <span>天</span> <i>{{time.hh}}</i>{{type}}<i>{{time.mm}}</i>{{type}}<i>{{time.ss}}</i>",link:function(o,i,s){function n(i){if(a>0&&i>0){var d=new Date-0+r,i=c-d;o.time=t.changeMs2Time(i),l=e(function(){n(i)},1e3)}else s.callback?(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o[s.callback](s.callbackparam)):(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o.callback())}o.type=s.type||":";var a,r,c,l=void 0;Math.random();if(!s.endtime)return!1;s.endtime&&s.curtime&&(c=t.formatTime2Ms(s.endtime),s.curtime?(a=t.getTimeDif(s.endtime,s.curtime),r=s.curtime-new Date-0,n(1)):t.getCurrTime().then(function(e){s.curtime=e.data,a=t.getTimeDif(s.endtime,s.curtime),r=s.curtime-new Date-0,n(1)}))},controller:["$scope",function(e){e.callback=function(){},e.$on("$destroy",function(){})}]}}]),APP.factory("countdownService",["$http",function(e){return{getTimeDif:function(e,t){return this.formatTime2Ms(e)-this.formatTime2Ms(t||new Date)},formatTime2Ms:function(e){return e?Date.parse(e.toString().replace(/-/g,"/"))||e:0},changeMs2Time:function(e){if(!e||parseInt(e)<0)return{dd:"00",hh:"00",mm:"00",ss:"00"};var t=parseInt(e/864e5),o=t<10?"0"+t:t;e=parseInt(e%864e5);var i=parseInt(e/36e5),s=i<10?"0"+i:i;e-=36e5*i;var n=parseInt(e/6e4),a=n<10?"0"+n:n;e-=6e4*n;var r=parseInt(e/1e3);return{dd:o,hh:s,mm:a,ss:r<10?"0"+r:r}},getTime:function(e,t){var o=this.changeMs2Time(e);return t=t||":",":"==t?o.dd+"天"+o.hh+":"+o.mm+":"+o.ss:o.dd+"天"+o.hh+"时"+o.mm+"分"+o.ss+"秒"},getCurrTime:function(){return e.post("/currTime")}}}]),APP.controller("dataAnalysisController",["$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","dataAnalysisService",function(e,t,o,i,s,n){function a(){e.byStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function r(){e.byStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyleActive={color:"#666","border-bottom":"0 solid #2979FF"}}function c(){e.cityByStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityLgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function l(){p=[{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""}],g=[]}function d(){var e=document.getElementById("container"),t=echarts.init(e);f=t;var o=null;(o={graphic:{type:"text",left:"center",top:"center",z:99,zLevel:100,style:{text:v,x:100,y:100,width:30,height:30}},legend:{selectedMode:!1,x:"center",y:"bottom",data:g,itemHeight:9,itemWidth:9},clickable:!1,series:[{name:"半径模式",type:"pie",radius:[15,75],center:["50%","50%"],roseType:"area",x:"50%",max:40,sort:"ascending",clickable:!1,label:{normal:{formatter:"{d}%",textStyle:{fontWeight:"normal",fontSize:12}}},itemStyle:{normal:{color:function(e){return["#FB497C","#FFBB41","#6FE621","#4FCCFF","#4D7BF3"][e.dataIndex]}}},data:p}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}function u(){var e=document.getElementById("activeContenter"),t=echarts.init(e);h=t;var o=null;(o={title:{subtext:"单位：次"},calculable:!0,xAxis:[{type:"category",axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#dedede"}},data:[{value:"分享\n店铺",textStyle:{fontSize:"12",color:"#37394C"}},{value:"分享\n商品",textStyle:{fontSize:"12",color:"#37394C"}},{value:"任务\n完成",textStyle:{fontSize:"12",color:"#37394C"}},{value:"社区\n互动",textStyle:{fontSize:"12",color:"#37394C"}},{value:"评价\n次数",textStyle:{fontSize:"12",color:"#37394C"}},{value:"登录\n次数",textStyle:{fontSize:"12",color:"#37394C"}}]}],yAxis:[{axisLabel:{textStyle:{fontSize:"12",color:"#37394C"}},type:"value",splitNumber:2,axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"完成了",type:"bar",itemStyle:{normal:{color:function(e){return["#67AAF9"][0]}}},barWidth:"7",data:m}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.PercentageCal=function(e,t){return num=parseFloat(e),total=parseFloat(t),isNaN(num)||isNaN(total)?"-":total<=0?"0%":Math.round(num/total*1e4)/100+"%"};var p,g,m,f,h,v="本月",S="";e.isHasData=!1,e.init=function(){n.doInit(S).success(function(t){t.success&&(e.dataUpdate=t.data,t.data&&(e.dataUpdateAddTime=1e3*parseInt(t.data.addTime)))})},e.disbuBL=function(t){n.distributionBL(t,S).success(function(t){if(t.success){if(t.data.length<=0)return void(e.isHasData=!0);e.isHasData=!1;for(var o=0;o<t.data.length;o++)p[o].value=t.data[o].mySaleNum,p[o].name=t.data[o].cateName,g[o]=t.data[o].cateName,o==t.data.length-1&&(p.length=t.data.length,d());0==t.data.length&&d()}})},e.actyBL=function(t){n.activityBL(t,S).success(function(t){t.success&&(e.dataActivity=t.data,m[0]=t.data.STORE_SHARE,m[1]=t.data.PRODUCT_SHARE,m[2]=t.data.TASK,m[3]=t.data.COMMUNITY,m[4]=t.data.ASSESS,m[5]=t.data.LOGIN,u())})},e.salesCity=function(t){n.salesCity(t,S).success(function(t){t.success&&(t.data.length>0?e.dataRegional=t.data:e.dataRegional=null)})},e.chooseCityDate=function(t){"BY"==t?(e.salesCity(!0),c()):(e.salesCity(!1),e.cityLgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityByStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseDate=function(t){l(),f&&f.dispose(),"BY"==t?(v="本月",e.disbuBL("true"),a()):(v="累计",e.disbuBL("false"),e.lgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseActive=function(t){h&&h.dispose(),m=[],"BY"==t?(e.actyBL(!0),r()):(e.actyBL(!1),e.lgStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyleActive={color:"#666","border-bottom":"0 solid #2979FF"})},e.$on("$ionicView.beforeEnter",function(){e.containerPic=!0,e.activeContenterPic=!0,e.isHasData=!1,v="本月",S="",S=s.memberId,a(),r(),c(),l(),m=[],i.scrollTop(),e.dataUpdate=null,e.dataUpdateAddTime=null,e.dataActivity="",e.dataRegional=null,e.init(),e.disbuBL(!0),e.actyBL(!0),e.salesCity(!0)}),e.$on("$ionicView.beforeLeave",function(){f&&f.dispose(),h&&h.dispose(),e.containerPic=!1,e.activeContenterPic=!1})}]),APP.service("dataAnalysisService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={memberId:o};return e.get(t.getUrl("DATA_ANALYSIS_UPDATE"),i)},this.distributionBL=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_DISTRIBUTION"),s)},this.activityBL=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_ACTIVITY"),s)},this.salesCity=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_SALES"),s)}}]),APP.controller("teamMessageController",["$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","teamMessageService","UserService","UrlService","PopupService","CreditService","$state",function(e,t,o,i,s,n,a,r,c,l){i.isBasics=!1,i.userId=e.memberId,i.selectedIndex=0,i.orderFlag=3,i.orderStatus=0,i.pageIndex=0,i.pageSize=10,i.typeTeam=e.type,i.goBack=function(){t.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingtopClasscontent={
top:"276px"}):(i.androidClass={"line-height":"44px"},i.paddingtopClasscontent={top:"260px"}),i.switchCheck=function(e){o.scrollTop(),i.isBasics=0!=e,1==e&&(i.selectedIndex=0,i.orderInit(i.selectedIndex)),1==i.checkArr[e]||(i.hasMore=!0,i.pageIndex=0,i.checkArr=[!1,!1],i.checkArr[e]=!i.checkArr[e],i.relationshipType=0==e?1:2,i.init())},i.backToLastView=function(){l.go("teamSupervise"),t.clearCache()},i.gotoPartnerDetail=function(e,t){1==t?l.go("partnerDetail",{ownerId:e}):l.go("connectionDetail",{ownerId:e})},i.gotoSpreadConnection=function(e){l.go("spreadConnection",{partnerId:e})},i.init=function(){s.getConnectionMsg(i.userId).success(function(e){e.success&&(i.productList=e.data,i.firstOrderTime=i.productList.firstOrderTime)})},i.orderInit=function(e){s.getOrderList(i.orderFlag,e,i.userId,i.pageIndex,i.pageSize).success(function(e){e.success&&(i.orders=e.data.orders,i.hasMore=e.data.orders.length<e.data.countResult)})},i.orderByList=function(e){i.selectedIndex=e,i.pageIndex=0,o.scrollTop(),i.orderInit(i.selectedIndex)},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.loadMore=function(){i.pageIndex++,s.getOrderList(i.orderFlag,i.selectedIndex,i.userId,i.pageIndex,i.pageSize).success(function(e){e.success&&(e.data.orders.length<e.data.countResult?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasMore=!0,i.orders=i.orders.concat(e.data.orders)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasMore=!1))})},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void o.scrollTop();o.scrollTop(),i.relationshipType=1,i.checkArr=[!0,!1],i.hasMore=!0,i.init(i.userID),i.orderFlag=3,i.orderStatus=0,i.pageIndex=0,i.pageSize=10})}]),APP.service("teamMessageService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o){var i={memberId:o};return e.get(t.getUrl("TEAM_USERINFO"),i)},this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,queryMemberId:s,pageIndex:n,pageSize:a,noLoading:!0};return e.get(t.getUrl("ORDER_LIST"),r)}}]),APP.controller("teamSuperviseController",["$ionicPopup","$state","UserService","$scope","CLASSIFYMESSAGECRNTERService","$localstorage","$rootScope","teamSuperviseService","$stateParams","$ionicScrollDelegate","UrlService","CreditService","PopupService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){i.productList=[],i.childrenList=[],i.rowsList=[],i.isFindTab=!0,i.selectedIndex=0,i.isUserShow=!1,i.isTeamInfo=!1,i.isUser=!1,i.page=1,i.cascade=!1,i.isTeam=!0,i.sortIndex=0,i.sortInd=0,i.sortNum=2,i.pageSize=10,i.userpageSize=10,i.orderOrTeams=!1,i.sortsIndex=1,i.messageImgFlag=!0,i.flagNum=!1,i.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png",i.arrowState=[a.imgBaseURL+"img/sortT.png",a.imgBaseURL+"img/sortF.png"],i.Math=window.Math;var m=["startTime","isAuthenticated","teamLevelOrder","isActive"],f=["shopKeepers","purchasedNum","recentBuyingTime"];i.memberId=o.getUser().mid,i.substring=window.substring,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingContentClass={top:"0px"}):(i.paddingtopClass={"padding-top":"0"},i.paddingContentClass={top:"0px"}),i.init=function(){g.getUnReadMsg().success(function(e){e.data>0?i.flagNum=!0:i.flagNum=!1})},i.share=function(){if(window.device&&window.device.hasNewShare)i.showShare=!i.showShare;else{var e=o.getUser().avatarImageFileId,t=d.getShareLinkHeader()+"register/0/"+i.productList.owner.promotionCode;window.umeng?window.umeng.share("我正在使用顺逛APP，推荐给你哦","时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",e,t,0):alert("只能在app分享,请下载app！")}},i.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastWithTime("复制成功",2e3)):p.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){var t="我正在使用顺逛APP，推荐给你哦",s="时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",n=o.getUser().avatarImageFileId,a=d.getShareLinkHeader()+"register/0/"+i.productList.owner.promotionCode;window.umeng?(0==e?window.umeng.shareToSina(t,s,n,a,0,null,u.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,s,n,a,0,null,u.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,s,n,a,0,null,u.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,s,n,a,0,null,u.shareSuccessCallback),u.qqShare()):4==e&&(window.umeng.shareToQzone(t,s,n,a,0,null,u.shareSuccessCallback),u.qqShare()),5==e?i.copyText(a):u.successShare()):alert("umeng undefined 只能在app分享"),i.showShare=!1},i.lookreferee=function(){var t=e.show({template:'<div style="color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;margin-top:-12px">推荐人信息</div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">我的推荐人 : <b>{{myheader.realName}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">ID : <b>{{myheader.memberId}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:-5px;position:relative;">手机号 : <b>{{myheader.mobile}}</b>&nbsp;&nbsp;<img ng-src="{{imgBaseURL}}img/headerphone.png" width="20" heihgt="20" style="position:absolute;top:-2px;" ng-click="cellphone()"/></div>',scope:i,buttons:[{text:"<b>确定</b>",type:"button-positive",onTap:function(e){e.preventDefault(),t.close()}}]})},i.cellphone=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+i.myheader.mobile,"_system"):window.open("tel:"+i.myheader.mobile)},i.userM=function(){r.userData(i.memberId,i.page,i.pageSize,f[2],i.orderIndex).success(function(e){e.success&&(i.usersNumber=e.data.total)})},i.goMemberCenter=function(){u.getGameId(function(e){t.go("vip",{gameId:e})})},i.commontFun=function(e){l.scrollTop(),0==i.selectedIndex?(i.orderOrTeams=!1,i.info=0):1==i.selectedIndex&&(i.orderOrTeams=!0,i.info=1),r.doInit(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[e],i.orderIndex,i.active,i.store).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.usercomFun=function(e){r.userData(i.memberId,i.page,i.userpageSize,f[e],i.orderIndex).success(function(e){e.success&&(i.rowsList=e.data.rows,i.hasmore=i.rowsList.length<e.data.total)})},i.teamClickFun=function(e){l.scrollTop(),i.sortInd=e,i.page=1,0==i.sortsIndex?(i.sortsIndex=1,i.orderIndex="desc",i.commontFun(i.sortInd,i.orderIndex)):1==i.sortsIndex&&(i.sortsIndex=0,i.orderIndex="asc",i.commontFun(i.sortInd,i.orderIndex))},i.teamTrueAttestation=function(e){l.scrollTop(),i.sortInd=e,i.isAuthenticated=2,i.orderIndex="desc",i.page=1,i.childrenList=[],i.commontFun(i.sortInd)},i.teamLevel=function(e){i.childrenList=[],i.sortInd=e,i.orderIndex="desc",i.page=1,i.commontFun(i.sortInd)},i.teamActive=function(e){i.sortInd=e,i.isActiveNum=2,i.isAuthenticated=2,i.orderIndex="desc",i.page=1,i.childrenList=[],i.commontFun(i.sortInd)},i.userClickFun=function(e){i.sortNum=e,i.orderIndex="desc",i.page=1,i.usercomFun(i.sortNum)},i.userNumber=function(e){i.sortNum=e,i.orderIndex="desc",i.page=1,i.usercomFun(i.sortNum)},i.userTime=function(e){i.sortNum=e,i.page=1,0==i.sortsIndex?(i.sortsIndex=1,i.orderIndex="desc",i.usercomFun(i.sortNum,i.orderIndex)):1==i.sortsIndex&&(i.sortsIndex=0,i.orderIndex="asc",i.usercomFun(i.sortNum,i.orderIndex))},i.goBack=function(){i.$ionicGoBack()},i.getShopData=function(){r.doInit(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[i.sortIndex],i.orderIndex).success(function(e){e.success&&(e.data.parent?(i.hasparent=!0,i.myheader=e.data.parent):i.hasparent=!1,i.productList=e.data,i.childrenList=e.data.children,i.unauthenticatedNum=Math.floor(e.data.total-e.data.authenticatedNum),i.unactiveNum=Math.floor(e.data.total-e.data.unActiveNum),i.hasmore=i.childrenList.length<e.data.total)})},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.Reps=function(e){if(e)return e.substring(0,1)},i.teamTab=function(e){i.selectedIndex=e,i.sortInd=0,i.page=1,i.orderIndex="desc",i.childrenList=[],i.rowsList=[],l.scrollTop(),0==i.selectedIndex?(i.sortsIndex=1,i.orderIndex="desc",i.isTeam=!0,i.isTeamInfo=!1,i.isUserShow=!1,i.isUser=!1,i.isAuthenticated=2,i.isActiveNum=2,i.commontFun(i.sortInd,i.orderIndex)):1==i.selectedIndex?(i.isTeam=!0,i.isUserShow=!1,i.isTeamInfo=!1,i.isUser=!1,i.sortsIndex=1,i.orderIndex="desc",i.isAuthenticated=2,i.isActiveNum=2,i.commontFun(i.sortInd,i.orderIndex)):2==i.selectedIndex&&(i.isTeam=!1,i.isTeamInfo=!0,i.isUserShow=!0,i.isUser=!0,i.sortNum=2,i.orderIndex="desc",i.sortsIndex=1,i.usercomFun(i.sortNum,i.orderIndex))},i.storeFun=function(e){r.newStore(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[1],i.orderIndex,e).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.storeMoreFn=function(e,t){r.storeMore(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex,t).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.Authenticated=function(e){i.isAuthenticated=e,0==e?(i.page=1,i.store=!1,i.storeFun(i.store)):1==e&&(i.page=1,i.store=!0,i.storeFun(i.store))},i.activeFun=function(e){r.newActive(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[3],i.orderIndex,e).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.activeMoreFn=function(e,t){r.activeMore(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex,t).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.isActive=function(e){l.scrollTop(),i.isActiveNum=e,0==e?(i.page=1,i.active=!1,i.activeFun(i.active)):1==e&&(i.page=1,i.active=!0,i.activeFun(i.active))},i.userLoadMore=function(e){r.userData(i.memberId,e,i.userpageSize,f[i.sortNum],i.orderIndex).success(function(e){e.success&&(i.rowsList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.rowsList=i.rowsList.concat(e.data.rows)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.teamLoadMore=function(e){r.doInit(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.loadMore=function(){0==i.sortInd&&(0==i.selectedIndex||1==i.selectedIndex)||2==i.sortNum&&2==i.selectedIndex?0==i.sortsIndex?i.orderIndex="asc":1==i.sortsIndex&&(i.orderIndex="desc"):i.orderIndex="desc",0==i.selectedIndex&&(0==i.sortInd||2==i.sortInd)||1==i.selectedIndex&&(0==i.sortInd||2==i.sortInd)?(i.page++,i.teamLoadMore(i.page)):(0!=i.selectedIndex||1!=i.sortInd&&3!=i.sortInd)&&(1!=i.selectedIndex||1!=i.sortInd&&3!=i.sortInd)||(0==i.isActiveNum?(i.active=!1,i.page++,i.activeMoreFn(i.page,i.active)):1==i.isActiveNum?(i.active=!0,i.page++,i.activeMoreFn(i.page,i.active)):0==i.isAuthenticated?(i.store=!1,i.page++,i.storeMoreFn(i.page,i.store)):1==i.isAuthenticated?(i.store=!0,i.page++,i.storeMoreFn(i.page,i.store)):(i.page++,i.teamLoadMore(i.page))),2==i.selectedIndex&&(i.page++,i.userLoadMore(i.page))},i.commonFn=function(){l.scrollTop(),i.rowsList=[],i.productList=[],i.childrenList=[],i.selectedIndex=0,i.sortInd=0,i.sortNum=2,i.page=1,i.memberId=o.getUser().mid,i.store=!0,i.active=!0,i.isTeam=!0,i.isUser=!1,i.isUserShow=!1,i.isTeamInfo=!1,i.orderIndex="desc",i.hasmore=!0,i.sortIndex=0,i.getShopData()},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void g.getUnReadMsg().success(function(e){e.data>0?i.flagNum=!0:i.flagNum=!1});i.commonFn(),i.userM(),i.init()})}]),APP.service("teamSuperviseService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n,a,r,c,l){var d={withParent:!0,memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r};return e.get(t.getUrl("TEAM_SUPERVISE"),d)},this.storeMore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.activeMore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newStore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newActive=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.userData=function(o,i,s,n,a){var r={memberId:o,pageNumber:i,pageSize:s,sort:n,order:a};return e.get(t.getUrl("TEAM_USERS"),r)}}]),APP.controller("userMessageController",["$state","$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","userMessageService","$rootScope",function(e,t,o,i,s,n,a){s.userId=t.memberId,s.name=t.name,s.mobile=t.mobile,s.isTeamNum=t.isTeamNum,s.page=1,s.pageSize=20,s.sortsIndex=2,s.arrowState=[a.imgBaseURL+"img/sortT.png",a.imgBaseURL+"img/sortF.png",a.imgBaseURL+"img/sort2.png"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingtopClasscontent={top:"246px"},s.teamInfos={top:"46%"}):(s.paddingtopClass={"padding-top":"0"},s.paddingtopClasscontent={top:"220px"},s.teamInfos={top:"36%"}),s.init=function(){n.getConnectionMsg(s.mobile,s.page,s.pageSize).success(function(e){e.success&&(s.productList=e.data,s.userList=e.data.rows,s.hasmore=s.userList.length<e.data.total)})},s.priceRange=function(e){var t=Math.floor(e/1e3);return t>=20?1e3*t+"~":1e3*t+"~"+(1e3*t+1e3)},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.goBack=function(){s.$ionicGoBack()},s.goBackMsg=function(){e.go("teamMessage",{memberId:s.userId})},s.userLoadMore=function(e){n.getConnectionMsg(s.userId,e,s.pageSize).success(function(e){e.success&&(s.userList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.userList=s.userList.concat(e.data.rows)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.loadMore=function(){s.page++,s.userLoadMore(s.page)},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void i.scrollTop();i.scrollTop(),s.page=1,s.pageSize=20,s.hasMore=!0,s.init(s.userId,s.page,s.pageSize)})}]),APP.service("userMessageService",["$http","UrlService",function(e,t){this.getConnectionMsg=function(o,i,s){var n={mobile:o,pageNumber:i,pageSize:s,noLoading:!0};return e.get(t.getUrl("TEAM_MESSAGE"),n)}}]),APP.controller("userSearchController",["$rootScope","$scope","userSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,i,s,n,a,r){t.memberId=i.getUser().mid,t.page=1,t.pageSize=20,t.pageNum=10,t.searchValue="",t.selectedIndex=r.selectedIndex,t.Reps=function(e){if(e)return e.substring(0,1)},t.backToLastView=function(){t.$ionicGoBack()};var c=document.querySelector("#focus");t.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},t.commonFun=function(e){o.teamSearch(t.memberId,t.searchValue,e,t.page,t.pageNum).success(function(e){e.success&&(t.searchResults=e.data.children,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.searchConnection=function(){if(""==t.searchValue)return void n.showToast("请填写搜索内容");0==t.selectedIndex&&(t.cascade=!1,t.commonFun(t.cascade)),1==t.selectedIndex&&(t.cascade=!0,t.commonFun(t.cascade)),2==t.selectedIndex&&o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults=e.data.rows,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.loadMore=function(){t.page++,o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults.length<e.data.total?(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!0,t.searchResults=t.searchResults.concat(e.data.rows)):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!1))})},t.$on("$ionicView.enter",function(){"back"==t.direction?c.blur():(t.searchValue="",t.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),t.$on("$ionicView.beforeEnter",function(e,o){t.direction=o.direction,t.page=1,t.pageSize=20,t.pageNum=10,t.hasMore=!0,t.placeHolder="请输入用户名称"})}]),APP.service("userSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,i,s,n){var a={memberId:o,pageNumber:i,pageSize:s,userName:n,noLoading:!0};return e.get(t.getUrl("TEAM_USERS"),a)},this.teamSearch=function(o,i,s,n,a){var r={memberId:o,keyword:i,cascade:s,pageNumber:n,pageSize:a,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),r)}}]),APP.controller("ApplyRefundController",["$scope","$ionicActionSheet","ApplyRefundService","PopupService","$timeout","$stateParams","$ionicHistory","$timeout","$rootScope",function(e,t,o,i,s,n,a,s,r){e.cOrderSnDetail=n.cOrderSn,e.refundData=[],e.description=8,e.typeActual=0,e.applyRefund={reason:""},e.init=function(){e.applyRefundType="请选择退款原因",o.applyRefund(e.cOrderSnDetail).success(function(t){t.success&&(e.refundData=t.data,e.typeActual=t.data.orderType,1==e.typeActual?e.repairType="退货退款":e.repairType="退货不退款")})},e.openSelect=function(){var o=t.show({buttons:[{text:"七天无理由"},{text:"大小尺寸"},{text:"颜色款式"},{text:"质量问题"},{text:"配送问题"},{text:"库存问题"},{text:"地址问题"},{text:"其他"}],titleText:"请选择退款原因",buttonClicked:function(t){switch(t){case 0:e.applyRefundType="七天无理由";break;case 1:e.applyRefundType="大小尺寸";break;case 2:e.applyRefundType="颜色款式";break;case 3:e.applyRefundType="质量问题";break;case 4:e.applyRefundType="配送问题";break;case 5:e.applyRefundType="库存问题";break;case 6:e.applyRefundType="地址问题";break;case 7:e.applyRefundType="其他"}return o(),e.description=t,!0}});s(function(){o()},1e4)},e.submitRefund=function(){8==e.description?i.showToast("请选择退款原因"):o.setApplyRefund(e.cOrderSnDetail,e.typeActual,e.applyRefund.reason,e.applyRefundType).success(function(e){"S"==e.data.state?(r.$broadcast("ORDER_RETURN_BACK"),i.showToast("提交成功！"),s(function(){a.goBack()},2e3)):e.data.message?(i.showToast(e.data.message),s(function(){a.goBack()},2e3)):i.showToast("提交失败！")})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ApplyRefundService",["$http","UrlService",function(e,t){this.setApplyRefund=function(o,i,s,n){var a={cOrderSn:o,typeActual:i,description:s,reason:n};return e.get(t.getUrl("SUBMIT_APPLY_REFUND"),a)},this.applyRefund=function(o){var i={cOrderSn:o};return e.get(t.getUrl("APPLY_REFUND"),i)}}]),APP.controller("AssessController",["$scope","AssessService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope",function(e,t,o,i,s,n,a,r,c,l){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.assessData=[],e.parameter=[],e.isAssessed=!1,e.cOrderSnData=[],e.value=[],e.click=[],e.fileIds=[],e.click[0]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.iconImageData=[],e.iconImageData[0]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""},e.value[0]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.init=function(o,i){e.show=!1,t.getAssess(o,i).success(function(t,o,i,s){if(t.success){e.isAssessed=!t.data.products||0==t.data.products.length,e.assessDataLength=t.data.products.length,e.assessData=t.data.products;for(var n=0;n<e.assessDataLength;n++)e.cOrderSnData.push({cOrderSn:t.data.products[n].cOrderSn}),e.click[n]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.value[n]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.iconImageData[n]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""};e.addTime=t.data.addTime,e.ckCode=t.data.ckCode,e.consignee=t.data.consignee,e.memberId=t.data.memberId,e.memberName=t.data.memberName,e.mobile=t.data.mobile}else e.isAssessed=!0}).error(function(){e.isAssessed=!0})},e.assessType=function(t,o){0==t?(e.click[o].isClickGood=!e.click[o].isClickGood,e.click[o].isClickMiddle=!1,e.click[o].isClickBad=!1):1==t?(e.click[o].isClickMiddle=!e.click[o].isClickMiddle,e.click[o].isClickGood=!1,e.click[o].isClickBad=!1):2==t&&(e.click[o].isClickBad=!e.click[o].isClickBad,e.click[o].isClickMiddle=!1,e.click[o].isClickGood=!1),angular.forEach(e.click,function(t,o,i){t.isClickGood?e.value[o].evalution=1:t.isClickMiddle?e.value[o].evalution=2:t.isClickBad&&(e.value[o].evalution=3)})},e.setParams=function(){e.parameter=[];for(var t=0;t<e.assessDataLength;t++)e.parameter.push({addTime:e.addTime,assString:e.value[t].comment,cOrderSn:e.cOrderSnData[t].cOrderSn,ckCode:e.ckCode,consignee:e.consignee,evalution:e.value[t].evalution,memberId:e.memberId,memberName:e.memberName,mobile:e.mobile,productScore:e.value[t].value1,serviceScore:e.value[t].value3,shippingScore:e.value[t].value2,fileUrl1:e.iconImageData[t].imgUrl1,fileUrl2:e.iconImageData[t].imgUrl2,fileUrl3:e.iconImageData[t].imgUrl3,fileUrl4:e.iconImageData[t].imgUrl4,fileUrl5:e.iconImageData[t].imgUrl5})},e.submitAssess=function(){for(var o=0;o<e.assessDataLength;o++){if(!/^.{5,300}$/.test(e.value[o].comment))return void(1==e.assessDataLength?a.showToast("请输入5～300字的评价！"):a.showToast("请于第"+(o+1)+"件商品输入5～300字的评价！"));if(0==e.value[o].evalution)return void(1==e.assessDataLength?a.showToast("请选择评价！"):a.showToast("请于第"+(o+1)+"件商品选择评价！"));if(0==e.value[o].value1)return void(1==e.assessDataLength?a.showToast("请选择商品评分！"):a.showToast("请于第"+(o+1)+"件商品选择商品评分！"));if(0==e.value[o].value2)return void(1==e.assessDataLength?a.showToast("请选择物流评分！"):a.showToast("请于第"+(o+1)+"件商品选择物流评分！"));if(0==e.value[o].value3)return void(1==e.assessDataLength?a.showToast("请选择服务评分！"):a.showToast("请于第"+(o+1)+"件商品选择服务评分！"))}for(var s="",n=0;n<e.assessDataLength;n++)s+=e.value[n].comment;t.checkAssessText(s).success(function(o){o?(a.showToast("成功"),e.setParams(),t.submitAssessInfo(e.parameter,e.fileIds).success(function(e){e.success?(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),c.goBack()},1e3)):e.message?a.showToast(e.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.uploadImg=function(o){if("APP"==s.getPlatform()){var r={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},c=function(s){function r(s){e.iconImage=s,i(function(){e.iconImage=s},200);var r=function(t){n.hide(),a.showToast("上传成功");for(var i=JSON.parse(t.response),s=i.fileIds,r=0;r<s.length;r++)e.fileIds.push(s[r]);var c=i.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:a.showToast("最多只能输入5张照片！")},c=function(e){n.hide(),a.showToast("上传失败")},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var u={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};n.show(u)}function c(e){}function l(s){e.iconImage=s,i(function(){e.iconImage=s},200);var r=function(t){n.hide(),a.showToast("上传成功");for(var i=JSON.parse(t.response),s=i.fileIds,r=0;r<s.length;r++)e.fileIds.push(s[r]);var c=i.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:a.showToast("最多只能输入5张照片！")},c=function(e){a.showToast("上传失败"),n.hide()},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var u={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};n.show(u)}function d(e){}1==s?navigator.camera.getPicture(r,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}):2==s&&navigator.camera.getPicture(l,d,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0})};window.plugins.actionsheet.show(r,c)}else a.showToast("请下载客户端实现上传图片功能")},e.$on("$ionicView.beforeEnter",function(){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.init(e.orderId,e.cOrderSn)}),e.showLarge=function(t){e.show=!0,e.largeImg=t},e.closeImg=function(){e.show=!1},e.deleteImg=function(){e.show=!1;for(var t=0,o=0;o<e.assessDataLength;o++){if(e.largeImg==e.iconImageData[o].imgUrl1){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl2){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl3){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl4){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl5){t=o;break}}e.largeImg==e.iconImageData[t].imgUrl1?(e.iconImageData[t].imgUrl1=e.iconImageData[t].imgUrl2,e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl2?(e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl3?(e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl4?(e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl5&&(e.iconImageData[t].imgUrl5="")},e.goBack=function(){for(var t=!1,o=0;o<e.assessDataLength;o++)if(""!=e.iconImageData[o].imgUrl1||0!=e.value[o].value1||0!=e.value[o].value2||0!=e.value[o].value3||""!=e.value[o].comment||0!=e.value[o].evalution){var t=!0;break}if(t){a.showConfirm("","您的评价未完成，您确定离开吗？",function(e){e&&c.goBack()})}else c.goBack()}}]),APP.service("AssessService",["$http","UrlService",function(e,t){this.getAssess=function(o,i){var s={orderId:o,cOrderSn:i};return e.get(t.getUrl("GET_ASSESS"),s)},this.checkAssessText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),i)},this.submitAssessInfo=function(o,i){i=i.join();var s={assessList:JSON.stringify(o),fileIds:i};return e({method:"POST",url:t.getUrl("SUBMIT_ASSESS"),params:s})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.directive("commentBar",[function(){return{restrict:"E",template:'<div class="col padding-top-bottom-0"><img class="padding-left-10" width="20%" ng-click="comment(0)" ng-src="{{commentValue>=1?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(1)" ng-src="{{commentValue>=2?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(2)" ng-src="{{commentValue>=3?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(3)" ng-src="{{commentValue>=4?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(4)" ng-src="{{commentValue>=5?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"></div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("BannerDailyController",["$scope","BannerDailyService","$stateParams","$rootScope","$http","$state","UserService","CommonAddressService","GoodsService","$ionicHistory","PopupService","UrlService","$localstorage","$ionicLoading","BannerThemeService","CreditService","$ionicScrollDelegate","$ionicModal","$timeout",function($scope,BannerDailyService,$stateParams,$rootScope,$http,$state,UserService,CommonAddressService,GoodsService,$ionicHistory,PopupService,UrlService,$localstorage,$ionicLoading,BannerThemeService,CreditService,$ionicScrollDelegate,$ionicModal,$timeout){function getBannerDailyProducts(e,t,o,i,s,n,a,r){BannerDailyService.getBannerDaily(e,t,o,i,s,n,a,r).success(function(e){$scope.activityProductList=[],$scope.activityProductList=e.productsList,$ionicLoading.hide()})}function getShareInfo(e,t){BannerThemeService.getBannerTheme(e,t).success(function(e){shareInfo=e.data})}$scope.shareStoreId=$stateParams.shareStoreId;var bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,provinceId="",cityId="",areaId="",streetId="";$scope.storeId="",$scope.layout=$stateParams.layout,$scope.layout="layout-colum2",$scope.activityProductList=[],$scope.districtName="";var sharePic="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",shareInfo={},screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="DAILY_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.showShare=!1,$scope.dayliTitleStyle={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.dayliTitleStyle={top:"18px"}),$rootScope.isApp?$scope.BannerTopopType={right:"50px"}:$scope.BannerTopopType={right:"10px"},$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,GoodsService.getAddress().success(function(response){if(void 0!=response.data&&response.data&&0!=response.data.length){var addressInfo=eval(response.data),regionIndex=addressInfo[0].regionName.indexOf("/");$scope.districtName=addressInfo[0].regionName.substr(0,regionIndex),getBannerDailyProducts(memberId,addressInfo[0].provinceId,addressInfo[0].cityId,addressInfo[0].areaId,addressInfo[0].streetId,addressInfo.regionName,bannerId,platformType)}else{var defaultAddressInfo=CommonAddressService.getAddressInfo();$scope.districtName=defaultAddressInfo.regionName,getBannerDailyProducts(memberId,defaultAddressInfo.provinceId,defaultAddressInfo.cityId,defaultAddressInfo.areaId,defaultAddressInfo.streetId,defaultAddressInfo.regionName,bannerId,platformType)}}).error(function(e){var t=CommonAddressService.getAddressInfo();$scope.districtName=t.regionName,getBannerDailyProducts(memberId,t.provinceId,t.cityId,t.areaId,t.streetId,t.regionName,bannerId,platformType)}),getShareInfo(bannerId,platformType)},$rootScope.$on("DAILY_LOCATION",function(e,t){$scope.districtName=t["text-3"],$scope.streetName=t["text-4"]
;var o=$scope.districtName+"/"+$scope.streetName;provinceId=t["value-1"],cityId=t["value-2"],areaId=t["value-3"],streetId=t["value-4"],GoodsService.addAddress(provinceId,cityId,areaId,o,streetId).success(function(e,t,o,i){e.success&&getBannerDailyProducts(memberId,provinceId,cityId,areaId,streetId,$scope.districtName,bannerId)})}),$scope.goBack=function(){$ionicHistory.goBack()},$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.dataAdd=null,$scope.defaultValue=null,$scope.goBackFlag=!0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"DAILY_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})}),$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"COUPONSLIST",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"COUPONSLIST",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):($scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.share=function(){if(window.device&&window.device.hasNewShare){if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");$scope.showShare=!$scope.showShare}else{if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");if(window.umeng){var e=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid;window.umeng.share(shareInfo.title,shareInfo.content,shareInfo.imgUrl,e,0)}}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid,o=shareInfo.title,i=shareInfo.imgUrl,s=shareInfo.content;window.umeng?(0==e?window.umeng.shareToSina(o,s,i,t,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,t,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,t,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,s,i,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(o,s,i,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(t),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1}}]),APP.service("BannerDailyService",["$http","UrlService",function(e,t){this.getBannerDaily=function(o,i,s,n,a,r,c,l){var d={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,provinceName:void 0,cityName:void 0,districtName:r,bannerId:c,platformType:l};return e.get(t.getUrl("GET_BANNER_DAILY"),d)}}]),APP.controller("BannerThemeController",["$scope","BannerThemeService","$stateParams","$state","$ionicHistory","$localstorage","UserService","PopupService","UrlService","CreditService","InAppBrowserService","$rootScope",function(e,t,o,i,s,n,a,r,c,l,d,u){function p(o,i){t.getBannerTheme(o,i).success(function(t){e.activityImageList=t.data.productList,h=t.data})}var g=o.bannerId,m=n.get("storeId","20219251"),f=o.platformType;e.activityImageList=[];e.shareStoreId=o.shareStoreId;var h={};e.showShare=!1,e.leftArrow={},e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},window.cordova&&ionic.Platform.isIOS,e.leftShare={top:"16px",position:"absolute",right:"8px","z-index":"10",width:"32px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.leftArrow={top:"14px"}),e.goDetail=function(t){var o=e.activityImageList[t];if(o.productId)i.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:"",storeId:m,shareStoreId:e.shareStoreId});else if(o.activityUrl)if(-1!=o.activityUrl.indexOf("VRshop")){var s=null,n=c.getHead().replace("v3","www"),a=n+"index.html#/VrPage/";s=d.open(a),s.addEventListener("loadstart",function(e){-1!=e.url.indexOf("backToApp")&&s.close()})}else if(-1!=o.activityUrl.indexOf("coupon/toList"))i.go("getCouponsList",{shareStoreId:e.shareStoreId});else if(-1!=o.activityUrl.indexOf("m.ehaier.com/www/index.html")){var r=o.activityUrl.slice(o.activityUrl.indexOf("#/"));window.location.hash=r}else window.cordova?u.isIOS?cordova.InAppBrowser.open(o.activityUrl,"_system","location=yes"):cordova.InAppBrowser.open(o.activityUrl,"_blank","location=yes"):window.open(o.activityUrl,"_blank","location=yes")},e.goBack=function(){s.backView()?s.goBack():i.go("homePage")},e.init=function(){e.showQQ=!1,e.showWeChat=!1,g=o.bannerId,f=o.platformType,p(g,f)},e.$on("$ionicView.beforeEnter",function(t,i){m=o.shareStoreId?o.shareStoreId:n.get("storeId","20219251"),e.shareStoreId=o.shareStoreId,"back"==i.direction||e.init()}),e.share=function(){if(window.device&&window.device.hasNewShare){if(!a.getUser().mid)return void r.showToast("请先登录,再分享");e.showShare=!e.showShare}else{if(!a.getUser().mid)return void r.showToast("请先登录,再分享");if(window.umeng){var t=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+a.getUser().mid;window.umeng.share(h.title,h.content,h.imgUrl,t,0)}}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),r.showToastShort("复制成功")):r.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+a.getUser().mid,i=h.title,s=h.imgUrl,n=h.content;window.umeng?(0==t?window.umeng.shareToSina(i,n,s,o,0,null,l.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(i,n,s,o,0,null,l.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(i,n,s,o,0,null,l.shareSuccessCallback):3==t?(window.umeng.shareToQQ(i,n,s,o,0,null,l.shareSuccessCallback),l.qqShare()):4==t?(window.umeng.shareToQzone(i,n,s,o,0,null,l.shareSuccessCallback),l.qqShare()):5==t&&e.copeText(o),l.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("BannerThemeService",["$http","UrlService",function(e,t){this.getBannerTheme=function(o,i){if(i)var s={bannerId:o,isHost:"1",backUrl:"",platformType:i};else s={bannerId:o,isHost:"1",backUrl:""};return e.get(t.getUrl("GET_BANNER_THEME"),s)}}]),APP.controller("ChooseShopTemplateController",["$rootScope","$scope","$ionicModal","ChooseShopTemplateService","UserService",function(e,t,o,i,s){t.titleTemplateArray=[],t.listTemplateArray=[],t.titleId="",t.listId="",t.previewImgIndex="",t.storeId=s.getUser().mid,t.init=function(){t.storeId=s.getUser().mid,t.getTemplate(t.storeId)},t.getTemplate=function(e){i.getShopTemplates(e).success(function(e,o,i,s){t.titleTemplateArray=e.data.titleTemplate,t.listTemplateArray=e.data.listTemplate,angular.forEach(t.titleTemplateArray,function(e){1==e.selected&&(t.titleId=e.tit)}),angular.forEach(t.listTemplateArray,function(e){1==e.selected&&(t.listId=e.layout)})}).error(function(e){})},t.setTemplate=function(e){i.setShopTemplate(e).success(function(e,o,i,s){t.getTemplate(t.storeId)})},t.chooseTitleTemplate=function(e){t.titleId=t.titleTemplateArray[e].tit;var o=t.titleId+"-"+t.listId;t.setTemplate(o)},t.chooseListTemplate=function(e){t.listId=t.listTemplateArray[e].layout;var o=t.titleId+"-"+t.listId;t.titleId,t.listId;t.setTemplate(o)},o.fromTemplateUrl("my-preview-modal.html",{scope:t,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){t.modal=e}),t.preview=function(){switch(t.listId+t.titleId){case"layout-dftit-df":t.previewImgIndex="01";break;case"layout-dftit-bp":t.previewImgIndex="02";break;case"layout-dftit-colum2":t.previewImgIndex="03";break;case"layout-bptit-df":t.previewImgIndex="04";break;case"layout-bptit-bp":t.previewImgIndex="05";break;case"layout-bptit-colum2":t.previewImgIndex="06";break;case"layout-colum2tit-df":t.previewImgIndex="07";break;case"layout-colum2tit-bp":t.previewImgIndex="08";break;case"layout-colum2tit-colum2":t.previewImgIndex="09"}t.modal.show()},t.closeModal=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.$on("$ionicView.beforeEnter",function(){t.init()})}]),APP.service("ChooseShopTemplateService",["$http","UrlService",function(e,t){this.getShopTemplates=function(o){var i={storeId:o,noLoading:!0};return e.get(t.getUrl("GET_SHOP_TEMPLATES"),i)},this.setShopTemplate=function(o){var i={templateId:o,noLoading:!0};return e({method:"POST",url:t.getUrl("SET_SHOP_TEMPLATES"),params:i})}}]),APP.service("ConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o,i,s){var n={relationshipType:o,pageIndex:i,pageSize:s};return e.get(t.getUrl("CONNECTION_INDEX"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.service("ConnectionDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("ConnectionSearchController",["$scope","ConnectionSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,i,s,n,a){function r(e,o){for(var i in e)e[i].storeName=t.limitStrLength(e[i].storeName,o)}e.backToLastView=function(){e.$ionicGoBack()};var c=document.querySelector("#focus");e.gotoPartnerDetail=function(e,t){1==t?n.go("partnerDetail",{ownerId:e}):n.go("connectionDetail",{ownerId:e})},e.searchConnection=function(){if(""==e.searchValue)return void s.showToast("请填写搜索内容");t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){e.searchResults=t.data.partners,r(e.searchResults,e.storeNameListLength),0==e.searchResults.length?e.noSearchResults=!0:e.noSearchResults=!1})},e.loadMore=function(){e.pageIndex++,t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){t.success&&(t.data.partners.length<e.pageNum?(e.hasMore=!1,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasMore=!0,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")))})},e.$on("$ionicView.enter",function(){"back"==e.direction?c.blur():(e.searchValue="",e.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),e.$on("$ionicView.beforeEnter",function(t,o){e.direction=o.direction,e.searchType=a.searchType,e.storeNameListLength=Math.floor((window.innerWidth-82)/17*2-1),e.pageIndex=0,e.pageNum=10,e.hasMore=!0,1==e.searchType?e.placeHolder="请输入合伙人信息":e.placeHolder="请输入人脉信息"})}]),APP.service("ConnectionSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,i,s,n){var a={relationshipType:o,keyword:i,pageIndex:s,pageSize:n};return e.get(t.getUrl("CONNECTION_INDEX"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("CustomPageCtrl",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","CustomPageService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicLoading",function($stateParams,$scope,$rootScope,UrlService,CreditService,UserService,$state,CustomPageService,$timeout,$localstorage,$ionicSlideBoxDelegate,GetCouponsService,PopupService,BannerThemeService,GoodsService,$ionicLoading){$scope.customPageId=$stateParams.customPageId?$stateParams.customPageId:"",$scope.showShare=!1,$scope.shareimg="",$scope.storeId=0,$scope.hashtitle="",$scope.sharedesp="",$scope.moduleList=[],$scope.skuMap={},$scope.couponMap={},$scope.index=[],$scope.showjuanyz=!1,$scope.juanlist=[],$scope.juankeling={},$scope.juanqiangwan={},$scope.streetId=12036596,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,window.cordova?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),GoodsService.getAddress().success(function(response){if(response.success&&response.data){var addressMessage=eval(response.data)[0];void 0!=addressMessage.streetId&&($scope.streetId=addressMessage.streetId)}CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(e){if(1==e.success){$scope.hashtitle=e.data.name,$scope.moduleList=e.data.modualList,$scope.skuMap=e.data.skuMap,$scope.couponMap=e.data.couponMap,$scope.sharedesp=e.data.description;for(var t in $scope.moduleList)if("SWITCH"==$scope.moduleList[t].modualType){$scope.shareimg=$scope.moduleList[t].imageList[0].imageUrl;break}for(var o=0;o<$scope.moduleList.length;o++)$scope.moduleList[o].tabList&&($scope.index[o]=0);for(var i in e.data.couponMap)e.data.couponMap[i].totalGetNum>=e.data.couponMap[i].totalLimitNum?($scope.juankeling[i]=!0,$scope.juanqiangwan[i]=!0):(e.data.couponMap[i].getNum<e.data.couponMap[i].personLimitNum&&($scope.juankeling[i]=!0,$scope.juanqiangwan[i]=!1),e.data.couponMap[i].getNum>=e.data.couponMap[i].personLimitNum&&($scope.juankeling[i]=!1,$scope.juanqiangwan[i]=!1));$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}else PopupService.showToast(e.message)})})},$rootScope.$on("CACHE_SUCCESS",function(e,t){var o={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(o),$scope.init()}),$scope.changestyle=function(e,t){$scope.index[t]=e},$scope.getjuan=function(e,t){1!=$scope.juanqiangwan[e]&&0!=$scope.juankeling[e]&&(UserService.getUser().mid?GetCouponsService.doGetNewCoupons(e).success(function(t){t.success?CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(o){var i=o.data.couponMap[e].getNum,s=o.data.couponMap[e].personLimitNum;if(o.data.couponMap[e].totalGetNum>=o.data.couponMap[e].totalLimitNum)return $scope.juankeling[e]=!0,void($scope.juanqiangwan[e]=!0);i<s&&($scope.juankeling[e]=!0,$scope.juanqiangwan[e]=!1),i>=s&&($scope.juankeling[e]=!1,$scope.juanqiangwan[e]=!1),PopupService.showToast(t.message)}):PopupService.showToast(t.message)}):$state.go("login"))},$scope.goshare=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.hashtitle,o=$scope.sharedesp,i=$scope.shareimg,s=UrlService.getShareLinkHeader()+"CustomPage";window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(s):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case"2":if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.init()})}]),APP.service("CustomPageService",["$http","UrlService",function(e,t){this.getdata=function(o,i){if(""==o)var s={streetId:i};else var s={customPageId:o,streetId:i};return e.get(t.getNewUrl("CUSTOMPAGE_MODEL"),s)}}]),APP.controller("CustomerServiceController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","CustomerServiceService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(){a.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),i(function(){t.availableToTop(),t.pageIndex=0,t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,""),t.loadOrderAmount(t.orderFlag)},1e3)}function w(e){e?a.deleteOrder(C).success(function(e){e.success?t.init():(g.showToastShort(e.message),C="")}).error(function(e){g.showToastShort("删除失败！"),C=""}):C=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=5,t.isIos=!1,t.BDO=!1;var y,T="";t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderAmountData=[],t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var C="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.loadOrderAmount(0),t.loadOrderList(!1,0,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),t.pageIndex=0},t.batchDeleteOrder=function(){s.go("batchDeleteOrder")},t.loadOrderList=function(e,o,i,s,n,c,l,d){a.getOrderList(o,i,s,n,c,d).success(function(s){if(s.success){if("closed"==i?(y=s.data.canDeleteAll,s.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(y=!1,t.BDO=!1),t.emptySearch=!1,s.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(s.data.orders);else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=t.orderList.concat(s.data.orders);else if(l)t.searchOrderList=s.data.orders;else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=s.data.orders;l?t.hasMoreDataSearch=s.data.orderProductSize:t.hasMoreData=s.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadOrderAmount=function(e){a.getOrderAmount(e).success(function(e){e.success&&(t.orderAmountData=e.data)})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"",!0)},t.payTest=function(e,o,i){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var n=e,a="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?S.getAliPayInfo(n,i,a).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");T=e.result,window.alipay.pay({payInfo:T},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:n,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+n,price:i,notifyUrl:a},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};u.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,i,n,a){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};u.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+i+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,i,n){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};u.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):s.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,i){e.getOrderList(t).success(function(e){couponLists=e.data.couponList,couponLists.length>0&&i?s.go("Retainage",{relationOrderSn:t}):s.go("paymentxyz",{orderSn:t})})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),s.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){s.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,i,n,a,r){r&&t.closeSearchModal(),s.go("orderDetail",{orderSn:e,cOrderSn:o})},t.goAssess=function(e,t,o){o?s.go("assess",{orderId:e,cOrderSn:t}):s.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?s.go("lookAssess",{orderId:e,cOrderSn:t}):s.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",$,"确定")},t.confirmReceive=function(e,o,i){function n(e){e&&I.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',n,"确认"):s.go("confirmReceive",{orderId:i})},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.raiseStatusOne={background:"red",color:"#ffffff"},t.raiseStatusTwo={background:"red",color:"#ffffff"},t.raiseStatusThree={background:"red",color:"#ffffff"},t.raiseStatusFour={background:"red",color:"#ffffff"},t.orderFlag=0,t.BDO=!!y,"back"==o.direction||t.init()}),t.deleteOrder=function(e){C=e,g.showConfirm("","确认删除此订单？",w,"删除")},d.$on("AFTER_COMMIT",function(e){t.loadOrderAmount(0)})}]),APP.service("CustomerServiceService",["$http","UrlService",function(e,t){this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,pageIndex:s,pageSize:n,keyword:a};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(o){var i={chooseOrder:o};return e.get(t.getNewUrl("ORDER_AMOUNT"),i)},this.cancelOrder=function(o,i){var s={orderId:o,cancelFlag:i};return e.get(t.getUrl("CANCEL_ORDER"),s)},this.payOrder=function(o){var i={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),i)},this.deleteOrder=function(o){var i={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),i)}}]),APP.filter("cut",function(){return function(e,t,o,i){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var s=e.lastIndexOf("");-1!=s&&(e=e.substr(0,s))}return e+(i||"…")}}),
APP.controller("FeedbackController",["$scope","$ionicActionSheet","FeedbackService","PopupService","$timeout",function(e,t,o,i,s){e.userInfo={type:6,content:"",contact:""},e.init=function(){e.feedbackType="请选择"},e.openSelect=function(){var o=t.show({buttons:[{text:"功能意见"},{text:"界面意见"},{text:"您的新需求"},{text:"操作意见"},{text:"流量问题"},{text:"其他"}],titleText:"请选择",buttonClicked:function(t){switch(t){case 0:e.feedbackType="功能意见";break;case 1:e.feedbackType="界面意见";break;case 2:e.feedbackType="您的新需求";break;case 3:e.feedbackType="操作意见";break;case 4:e.feedbackType="流量问题";break;case 5:e.feedbackType="其他"}return o(),e.userInfo.type=t,!0}});s(function(){o()},1e4)},e.submitFeedback=function(){6==e.userInfo.type?i.showToast("请选择反馈类型！"):0==e.userInfo.content.length?i.showToast("请输入反馈内容！"):e.globalConstant.mobileNumberRegExp.test(e.userInfo.contact)?o.setFeedback(e.userInfo.type,e.userInfo.content,e.userInfo.contact).success(function(e,t,o,s){e.success?i.showToast("提交成功"):i.showToast(e.message)}):i.showToast("请输入正确的联系方式！")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("FeedbackService",["$http","UrlService",function(e,t){this.setFeedback=function(o,i,s){var n={type:o,content:i,contact:s};return e.get(t.getUrl("FEEDBACK"),n)}}]),APP.controller("GoodsManageController",["$scope","GoodsManageService","$ionicModal","UserService","GoodsService",function(e,t,o,i,s){e.flag=[],e.isShowOnFooter=!1,e.isShowOffFooter=!1,e.moreOrCheck=!1,e.goodsList=[],e.onSaleAmount,e.offSaleAmount,e.searchGoodsList=[];var n,a=[],r=!1,c=!0,l=1,d=1;e.keywords={keyword:""},e.init=function(){e.loadData(n,l,20,242,3466),t.getGoodsList(n,0,20,242,3466).success(function(t,o,i,s){t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0})},e.loadData=function(o,i,s,n,a){t.getGoodsList(o,i,s,n,a).success(function(t,o,s,n){for(var a=0,r=t.productsList.length;a<r;a++)t.productsList[a].isSelected=!1;e.goodsList=t.productsList,1==i?t.productsList&&t.productsList.length>0?e.onSaleAmount=t.productsList.length:e.onSaleAmount=0:0==i&&(t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0)})},e.searchGoods=function(){d=1,t.searchGoods(d,5,n,e.keywords.keyword,20,242,3466).success(function(t,o,i,s){e.searchGoodsList=t.productsList})},e.searchMore=function(){d+=1,t.searchGoods(d,5,n,e.keywords.keyword,20,242,3466).success(function(t,o,i,s){e.searchGoodsList=e.searchGoodsList.concat(t.productsList)})},e.onSale=function(){if(!c){c=!0,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("onSale").style.color="#32BEFF";document.getElementById("offSale").style.color="black",l=1,e.loadData(n,l,20,242,3466)}},e.offSale=function(){if(c){c=!1,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("offSale").style.color="#32BEFF";document.getElementById("onSale").style.color="black",l=0,e.loadData(n,l,20,242,3466)}},e.showBtn=function(e){if(c){var t=document.getElementsByClassName("sm-bottom-btn-on");angular.forEach(t,function(t,o){t.style.display=o==e?"inline-block":"none"})}else{var o=document.getElementsByClassName("sm-bottom-btn-off");angular.forEach(o,function(t,o){t.style.display=o==e?"inline-block":"none"})}},e.batchOperate=function(){for(var t=document.getElementsByClassName("sm-bottom-btn-on"),o=document.getElementsByClassName("sm-bottom-btn-off"),i=0,s=e.goodsList.length;i<s;i++)t[i].style.display="none",o[i].style.display="none";c?e.isShowOnFooter=!e.isShowOnFooter:e.isShowOffFooter=!e.isShowOffFooter,e.moreOrCheck=!e.moreOrCheck},e.deleteGoods=function(t){e.goodsList[t].sku;e.flag[t]=!e.flag[t],c?e.onSaleAmount=e.onSaleAmount-1:e.offSaleAmount=e.offSaleAmount-1,e.goodsList.splice(t,1)},e.soldOut=function(o){var i=e.goodsList[o].sku;t.updateGoods(n,i,1).success(function(e){}),e.flag[o]=!e.flag[o],e.onSaleAmount=e.onSaleAmount-1,e.offSaleAmount=e.offSaleAmount+1,e.goodsList.splice(o,1)},e.putAway=function(o){var i=e.goodsList[o].sku;t.updateGoods(n,i,0).success(function(e){}),e.flag[o]=!e.flag[o],e.offSaleAmount=e.offSaleAmount-1,e.onSaleAmount=e.onSaleAmount+1,e.goodsList.splice(o,1)},e.putAwayBatch=function(){var o=a.join("@");t.updateGoodsBatch(o,0).success(function(e,t,o,i){}),e.loadData(n,0,20,242,3466),a=[]},e.soldOutBatch=function(){var o=a.join("@");t.updateGoodsBatch(o,1).success(function(e,t,o,i){}),e.loadData(n,1,20,242,3466),a=[]},e.deleteGoodsBatch=function(){a.join("@");c?e.loadData(n,1,20,242,3466):e.loadData(n,0,20,242,3466),a=[]},e.selectGoods=function(t){if(0==e.goodsList[t].isSelected)e.goodsList[t].isSelected=!0,a.push(e.goodsList[t].sku);else if(e.goodsList[t].isSelected=!1,a&&a.length>=0){var o=a.indexOf(e.goodsList[t].sku);a.splice(o,1)}r=a.length==e.goodsList.length},e.selectAll=function(){r?(angular.forEach(e.goodsList,function(e){e.isSelected=!1}),r=!1):(angular.forEach(e.goodsList,function(e){e.isSelected=!0}),r=!0)},o.fromTemplateUrl("templates/shop/GoodsSearch.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.searchModal=t}),e.openSearchModal=function(){e.searchModal.show()},e.closeSearchModal=function(){e.searchModal.hide()},e.$on("$destroy",function(){e.searchModal.remove()}),e.removeProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,s.changeChooseStateDui(o).success(function(e,t,o,i){})},e.addProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,s.changeChooseStateJia(o,"1").success(function(e,t,o,i){})},e.$on("$ionicView.beforeEnter",function(){n=i.getUser().mid,e.init()})}]),APP.service("GoodsManageService",["$http","UrlService",function(e,t){this.getGoodsList=function(o,i,s,n,a){var r={memberId:o,onShelf:i,provinceId:s,cityId:n,districtId:a};return e.get(t.getUrl("GOODS_LIST"),r)},this.deleteGoods=function(o,i){var s={memberId:o,sku:i};return e.get(t.getUrl("DELETE_GOODS"),s)},this.updateGoods=function(o,i,s){var n={memberId:o,sku:i,onShelf:s};return e.get(t.getUrl("UPDATE_GOODS"),n)},this.searchGoods=function(o,i,s,n,a,r,c){var l={pageIndex:o,pageSize:i,memberId:s,keyword:n,provinceId:a,cityId:r,districtId:c};return e.get(t.getUrl("SEARCH_GOODS"),l)},this.updateGoodsBatch=function(o,i){var s={skuStr:o,onShelf:i};return e.post(t.getUrl("UPDATE_GOODS_BATCH"),s)},this.deleteGoodsBatch=function(o){var i={skuStr:o};return e.post(t.getUrl("DELETE_GOODS_BATCH"),i)}}]),APP.controller("HelpDetailController",["$scope","$stateParams","HelpDetailService","$ionicModal","$timeout","$sce","UrlService","PlatformService",function(e,t,o,i,s,n,a,r){e.helpId=t.helpId,e.title=t.content,e.isIos=!1,e.htmlContent=t.content,e.trustSrc=function(e){return n.trustAsResourceUrl(e)},e.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?e.isIos=!0:e.isIos=!1,e.htmlContent=a.getHead()+"mstore/sg/helpDetail.html?id="+t.helpId,e.trustSrc=function(e){return n.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.service("HelpDetailService",["$http","UrlService",function(e,t){this.getHelpDetail=function(o){var i={id:o};return e.get(t.getUrl("HELP_DETAIL"),i)}}]),APP.controller("LookAssessController",["$scope","LookAssessService","$stateParams","$ionicLoading","$timeout","PlatformService","PopupService","$ionicHistory",function(e,t,o,i,s,n,a,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.show=!1,e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.goBack=function(){r.goBack()},e.closeImg=function(){e.show=!1},e.showLarge=function(t){e.show=!0,e.largeImg=t},e.init=function(o){t.getLookAssess(o).success(function(t,o,i,s){t.success?(e.assessList=t.data.comment,e.stateList=t.data,e.timeIsOrNo=(e.timeNow-e.assessList.createTime)/1e3/60/60/24<90):a.showToast(t.memessage)})},e.$on("$ionicView.beforeEnter",function(){e.cOrderSn=o.cOrderSn,e.init(e.cOrderSn),e.timeNow=Date.parse(new Date)})}]),APP.service("LookAssessService",["$http","UrlService",function(e,t){this.getLookAssess=function(o){var i={cOrderSn:o};return e.get(t.getUrl("LOOK_ASSESS_INGO"),i)}}]),APP.controller("ManageMoneyController",["$scope","ManageMoneyService","$ionicModal","$state","InAppBrowserService","$stateParams","UrlService","PopupService","$rootScope",function(e,t,o,i,s,n,a,r,c){function l(){t.checkKjtLogin().success(function(o){if(o.data.isLogin)f=o.data.token,e.promotionList=[],d(o.data.token),e.getPromoteReward(o.data.token,1,g),u(o.data.token);else{var n=$+"index.html#/manageMoney/"+S+"?page="+I,r=escape(n),c=a.getCPUrl("KQT_URL")+"?page=authorizeMain&partner_id="+m+"&return_url="+r;if(window.cordova){var l="",p="page="+$+"index.html#/homePage/",v="page="+$+"index.html#/shopRevenue";h=s.open(c),h.addEventListener("exit",function(){-1!=l.indexOf("auth_code")||-1!=l.indexOf(v)||-1!=l.indexOf(p)||e.$ionicGoBack()}),h.addEventListener("loadstart",function(o){if(l=unescape(o.url),-1!=o.url.indexOf("auth_code")){var s=o.url.indexOf("auth_code")+10,n=o.url.toString().substr(s,32);h.close(),t.getKjtToken(n).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),u(t.data.token)})}else-1!=l.indexOf(v)&&-1==l.indexOf("&return_url=")?i.go("shopRevenue"):-1!=l.indexOf(p)&&-1==l.indexOf("&return_url=")&&i.go("homePage")})}else window.location.href=c}})}function d(o){t.getHryActivityInfo(o).success(function(t){t.success&&(e.activityInfo=t.data.promotionActivityList,e.activityRule=t.data.description)})}function u(o){t.getRefCode(o).success(function(t){t.success&&(e.promoCode=t.data.promoCode,e.qrCodeUrl=t.data.qrCodeUrl)})}var p=1,g=5,m=a.getCPUrl("KQT_ID"),f="",h=null;e.activityInfo=[],e.activityRule="";var v=null,S=n.frontState,I="",$=a.getHead().replace("v3","www");e.showAgreement=!1,e.hasMoreData=!1,e.promoCode="",e.qrCodeUrl="",e.promotionList=[],e.init=function(){if(p=1,-1!=v.indexOf("auth_code")){var o=v.indexOf("auth_code")+10,i=v.toString().substr(o,32);t.getKjtToken(i).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),u(t.data.token)})}else l()},e.getPromoteReward=function(o,i,s){t.getPromoteReward(o,i,s).success(function(t){if(t.success){e.promotionList=e.promotionList.concat(t.data.promotionList);var o=e.promotionList.length;e.hasMoreData=o!=t.totalCount}else e.hasMoreData=!1})},e.getMoreData=function(){p++,e.getPromoteReward(f,p,g)},e.shareToPlatform=function(t){var o="好友力邀您来海融易，海融易为您准备了一份688大礼，快来领取吧！",i="http://m.ehaier.com/www/img/icon_inside_qrcode.png",s=e.qrCodeUrl;window.umeng?1==t?window.umeng.shareToWechatSession("快来领688元红包！",o,i,s,0,null,function(){e.sharemodal.hide()}):window.umeng.shareToWechatTimeline("快来领688元红包！",o,i,s,0,null,function(){e.sharemodal.hide()}):r.showAlert("只能在app分享","抱歉，只能在app分享")},e.skipToTTJ=function(){var e=$+"index.html#/manageMoney/"+S,t=escape(e),o=a.getCPUrl("TTQ_URL")+"?token="+f+"&loginUrl="+t+"&returnUrl="+t;if(window.cordova){var i=null;i=s.open(o),i.addEventListener("loadstart",function(e){-1!=e.url.indexOf("index.html#/manageMoney")&&i.close()})}else window.location.href=o},e.goBack=function(){"shopRevenue"==S?i.go("shopRevenue"):i.go("financialMoney",{whereId:"manageMoney"})},o.fromTemplateUrl("mm-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),o.fromTemplateUrl("mm-share-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.sharemodal=t}),e.openQRModal=function(){e.qrCodemodal.show();var t=new AraleQRCode({text:e.qrCodeUrl,size:106,image:c.imgBaseURL+"img/icon_inside_qrcode.png",imageSize:30}),o=document.getElementById("createdQrCode");0!=o.childNodes.length&&o.removeChild(o.childNodes[0]),o.appendChild(t),o.childNodes[0].style.position="relative"},e.closeQRModal=function(){e.qrCodemodal.hide()},e.openShareModal=function(){e.sharemodal.show()},e.closeShareModal=function(){e.sharemodal.hide()},e.openAgreement=function(){e.sharemodal.hide(),setTimeout(function(){e.showAgreement=!0},300)},e.closeAgreement=function(){e.showAgreement=!1},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.sharemodal.remove()}),e.$on("$ionicView.beforeEnter",function(t,o){v=window.location.href,S=n.frontState,$=a.getHead().replace("v3","www"),I="shopRevenue"==S?$+"index.html#/shopRevenue":$+"index.html#/homePage/",e.init()})}]),APP.service("ManageMoneyService",["$http","UrlService",function(e,t){this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))},this.getKjtToken=function(o){var i={authCode:o};return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:i})},this.getHryActivityInfo=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("GET_HAIRONGYI_ACTIVITYIFNO"),params:i})},this.getPromoteReward=function(o,i,s){var n={token:o,pageNo:i,pageSize:s};return e({method:"POST",url:t.getUrl("GET_PROMOTE_REWARD"),params:n})},this.getRefCode=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("GET_REF_CODE"),params:i})}}]),APP.controller("MicroSchoolController",["$scope","MicroSchoolService","HomePageService",function(e,t,o){e.microSchoolInfo=[],e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.init=function(){e.tabChange(0,8),o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.tabChange=function(t,o){for(var i=document.getElementsByClassName("sg-ws-button"),s=0,n=i.length;s<n;s++)s==t?(i[s].style.color="#32BEFF",i[s].style.borderBottom="2px solid #32BEFF"):(i[s].style.color="black",i[s].style.borderBottom="none");e.loadData(o)},e.loadData=function(o){t.getMicroSchoolInfo(o).success(function(t,o,i,s){e.microSchoolInfo=t.data}).error(function(e){})},e.$on("$ionicView.beforeEnter",function(t,i){if("back"==i.direction)return void o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1});e.init()})}]),APP.service("MicroSchoolService",["$http","UrlService",function(e,t){this.getMicroSchoolInfo=function(o){var i={childId:o};return e.get(t.getUrl("MICRO_SCHOOL"),i)},this.getMicroSchoolDetail=function(o,i){var s={childId:o,id:i};return e.get(t.getUrl(""),s)}}]),APP.controller("MicroSchoolDetailController",["$scope","$stateParams","$sce","MicroSchoolService",function(e,t,o,i){e.childId=t.childId,e.id=t.id,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.loadData(e.childId,e.id)},e.loadData=function(e,t){i.getMicroSchoolDetail(e,t).success(function(e,t,o,i){})},e.$on("$ionicView.beforeEnter",function(){e.title=t.title,e.childId=t.childId,e.id=t.id,e.init()})}]),APP.controller("MyStoreController",["$localstorage","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyStoreService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","SetShopCoverService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","ShopService","$http","GetStatisticInfoService","HomePageService",function($localstorage,$scope,$stateParams,$rootScope,$ionicHistory,$state,$ionicSideMenuDelegate,UserService,MyStoreService,$ionicSlideBoxDelegate,$ionicModal,ChooseShopTemplateService,PopupService,GoodsService,CommonAddressService,$timeout,$ionicScrollDelegate,UrlService,SetShopCoverService,BannerThemeService,SeckillService,countdownService,$interval,$ionicLoading,LoginService,CreditService,ShopService,$http,GetStatisticInfoService,HomePageService){function loadProducts(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){MyStoreService.getProductsList(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m).success(function(e){if($scope.allProducts=e.totalCount,null!=e.data.productList&&void 0!=e.data.productList&&0!=e.data.productList.length){if(1==c?($scope.productsList=e.data.productList,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=e.products,$scope.productsList=$scope.contentDataListxyz)})):($scope.productsList=$scope.productsList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=$scope.contentDataListxyz.concat(e.products),$scope.productsList=$scope.contentDataListxyz)})),$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide(),$scope.productsList){var t=$scope.productsList.length;$scope.hasMoreData=!(e.totalCount===t)}}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasMoreData=!1,$scope.allProducts=0,$scope.productsList=[],$scope.contentDataListxyz=[]})}function restParams(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?(provinceId=e.provinceId,cityId=e.cityId,districtId=e.areaId,streetId=e.streetId,$scope.address=e.regionName):(provinceId=16,cityId=17,districtId=2450,streetId=12036596,$scope.address="崂山区")}$scope.lType="templates/common/ListTemplate1.html",$scope.tType="templates/common/TitleTemplate1.html",$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.filterCategory=[!0,!1,!1],$scope.myStoreInfo={},$scope.slideImage=[],$scope.avatarImage="",$scope.address="",$scope.categorySelected=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[!0,!1],$scope.brandSelected=[!0,!1],$scope.priceSelected=[!0,!1];var firstParamsArr=["all","all","0"],secondParamsArr=[],paramIndex=0;$scope.allProducts=0,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1,$scope.coverImage=$rootScope.imgBaseURL+"img/bg_shop_4.png",$scope.countDownMsg="",$scope.screenWidth=window.innerWidth,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$scope.storeTitleName="",$scope.stockName="显示全部货",$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"];var token="";$scope.leftArrow={},$scope.mystoreTitle={},$scope.addressDiv={},$scope.addressLabel={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.leftArrow={top:"14px"},$scope.mystoreTitle={top:"18px"},$scope.addressDiv={top:"16px"},$scope.addressLabel={top:0}),$scope.messageImgFlag=!0,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="配送至",$scope.dataAdd=null,$scope.flag="STORE_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity,pageIndex=1,pageSize=5,filterData="saleDesc",fromType="2",flag="",memberId="",productCateId=0,provinceId=16,cityId=173,districtId=2450,streetId=12036596,provinceName="",cityName="",sortColumn="saleDesc";$scope.stockState=!1,$scope.showShare=!1,$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.productsList=[],$scope.contentDataListxyz=[],restParams(),MyStoreService.getStoreInfo($scope.storeId,$scope.shareStoreId).success(function(e){switch(e.data.titleLayout){case"tit-df":$scope.tType="templates/common/TitleTemplate1.html";break;case"tit-bp":$scope.tType="templates/common/TitleTemplate2.html";break;case"tit-colum2":$scope.tType="templates/common/TitleTemplate3.html"}switch(e.data.listLayout){case"layout-df":$scope.lType="templates/common/ListTemplate1.html";break;case"layout-bp":$scope.lType="templates/common/ListTemplate2.html";break;case"layout-colum2":$scope.lType="templates/common/ListTemplate3.html"}$scope.coverImage=e.data.coverUrl,$scope.myStoreInfo=e.data,$scope.slideImage=e.data.banner,$scope.avatarImage=e.data.avatarImageFileId,$scope.storeTitleName=$scope.myStoreInfo.storeName+$scope.myStoreInfo.storeTypeName,$ionicSlideBoxDelegate.$getByHandle("my_store_slider").update(),$ionicSlideBoxDelegate.loop(!0)}),ShopService.getLevelInfo(function(e){e.success(function(e){if(e.success&&($scope.avatarImageFileId=e.data.avatarImageFileId,$scope.userCurrentLevelId=e.data.userCreditWithLevel.order,$scope.userName=e.data.userCreditWithLevel.name,$scope.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel))if($scope.levelArray=[],e.data.storeCreditWithLevel.order<=3){$scope.imgCount=e.data.storeCreditWithLevel.order;for(var t=0;t<e.data.storeCreditWithLevel.order;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/StarLevel@2x.png")}else for(var t=0;t<e.data.storeCreditWithLevel.order-3;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/Diamond@2x.png")})},$scope.storeId),$timeout(function(){MyStoreService.getPositionFromCookie().success(function(response,status,headers,config){if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,$scope.address=addressInfo[0].regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)}else getCurrentPosition(),$timeout(function(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},500)})},500),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.getSeckillInfo=function(){SeckillService.getServerTime().success(function(e){var t=e.data,o=$scope.myStoreInfo.seckill.beginTime,i=$scope.myStoreInfo.seckill.endTime,s="",n=$interval(function(){t+=1,t<o?(s=countdownService.getTime(countdownService.getTimeDif(1e3*o,1e3*t)),$scope.countDownMsg="距离开始时间还有"+s):t>=o&&t<=i?(s=countdownService.getTime(countdownService.getTimeDif(1e3*i,1e3*t)),$scope.countDownMsg="距离结束时间还有"+s):t>i&&($scope.countDownMsg="秒杀活动已结束",$interval.cancel(n))},1e3)})},$scope.loadMore=function(){pageIndex+=1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)},$scope.saleNum=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="#32BEFF",e.color="white",t.backgroundColor="white",t.color="#888",o.backgroundColor="white",o.color="#888",filterData="saleDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},$scope.popularity=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="#32BEFF",t.color="white",o.backgroundColor="white",o.color="#888",filterData="isHotDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},$scope.productsFilter=function(){var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="white",t.color="#888",o.backgroundColor="#32BEFF",o.color="white",MyStoreService.getFilterList(productCateId).success(function(e,t,o,i){if(e.success)if($scope.brandList=e.data.brandList,void 0!=e.data.filterMap){$scope.otherList=e.data.filterMap.lstAttributes;for(var s=0,n=$scope.otherList.length;s<n;s++)secondParamsArr[s]=0}else $scope.otherList=[]}),$scope.filterModal.show()},$scope.chooseStockState=function(e){firstParamsArr[0]=e,$scope.stockState=!$scope.stockState,"all"==e?$scope.stockName="显示全部货":"hasStock"==e&&($scope.stockName="仅看有货")},$scope.brandFilter=function(e){firstParamsArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName;for(var t=0,o=$scope.brandList.length;t<o;t++)$scope.brandSelected[t]=t===e},$scope.priceFilter=function(e){switch(firstParamsArr[2]=e,e){case 0:$scope.priceName="全部";break;case 1:$scope.priceName="0～1000";break;case 2:$scope.priceName="1001～2000";break;case 3:$scope.priceName="2001～3000";break;case 4:$scope.priceName="3001～4000";break;case 5:$scope.priceName="4001～5000";break;case 6:$scope.priceName="5000以上"}for(var t=0;t<7;t++)$scope.priceSelected[t]=t===e},$scope.chooseOtherItem=function(e,t){for(var o=0;o<t;o++)$scope.isCurrent[o]=o===e;secondParamsArr[paramIndex]=$scope.otherList[paramIndex].lstAttributeOptions[e].id,$scope.otherName[paramIndex]=$scope.otherList[paramIndex].lstAttributeOptions[e].optionValue},$scope.filterDone=function(){restParams();var e=firstParamsArr.join("@"),t=secondParamsArr.join(";");filterData=e+"@"+t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1),$scope.filterModal.hide()},$scope.changeFilterOption=function(e){for(var t=0,o=$scope.filterCategory.length;t<o;t++)$scope.filterCategory[t]=t==e;for(var i=0,s=$scope.otherList.length;i<s;i++)$scope.otherState[i]=!1},$scope.changeOther=function(e){$scope.filterCategory=[!1,!1,!1],paramIndex=e,$scope.otherName[e]="全部";for(var t=0,o=$scope.otherList.length;t<o;t++)$scope.otherState[t]=t===e;$scope.isCurrent=[!0,!1]},$scope.category=function(){$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.changeCategory=function(e,t){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],productCateId=t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1);for(var o=0,i=$scope.categorySelected.length;o<i;o++)$scope.categorySelected[o]=o===e;$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$ionicModal.fromTemplateUrl("my-qrcode-modal.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){$scope.qrCodemodal=e}),$ionicModal.fromTemplateUrl("templates/shop/FilterShop.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.openQrcode=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.qrCodemodal.show()},$scope.backToStore=function(){$scope.filterModal.hide()},$scope.closeModal=function(){$scope.qrCodemodal.hide()},$scope.$on("$destroy",function(){$scope.qrCodemodal.remove(),$scope.filterModal.remove()}),$scope.saveQrCode=function(){var e="";e=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"DCIM/Camera/myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var t=encodeURI($scope.myStoreInfo.qrcode),o={};(new FileTransfer).download(t,e,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();PopupService.showAlert("","图片已经保存至"+t)}else PopupService.showToast("保存成功")},function(e){PopupService.showToast("保存失败！")},!0,o)},$scope.share=function(){if(!UserService.getUser().mid)return void $state.go("login");if(window.device&&window.device.hasNewShare)$scope.showShare=!$scope.showShare;else{var e=$scope.myStoreInfo.storeName,t=$scope.avatarImage,o=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.storeId+"/?fs";window.umeng?window.umeng.share(e,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",t,o,0):alert("只能在app分享,请下载app！")}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.myStoreInfo.storeName,o="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",i=$scope.avatarImage,s=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.userId+"/?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(s),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.goMessageCenter=function(){$state.go("messageCenter")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.goBuyerCenter=function(){$scope.shareStoreId?$state.go("buyerCenter",{shareStoreId:$scope.shareStoreId}):$state.go("buyerCenter")},$scope.toProductDetail=function(e,t,o,i,s,n,a,r){window.cordova&&$rootScope.gio.track("prodClickInStore",{productId:e,o2oType:t,productFirstName:n,productSecondName:a,storeId:i,storeName:$scope.storeTitleName,hasStock:r}),$state.go("productDetail",{productId:e,o2oType:t,fromType:o,storeId:i,shareStoreId:s})},$scope.goBack=function(){$ionicHistory.backView()&&$scope.$ionicGoBack()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"1px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"STORE_LOCATION",0),
$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,MyStoreService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",MyStoreService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;MyStoreService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e),$scope.closeAddressModal()})}},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("STORE_LOCATION",function(e,t){$scope.address=t["text-3"],provinceId=t["value-1"],cityId=t["value-2"],districtId=t["value-3"],provinceName=t["text-1"],streetId=t["value-4"],cityName=t["text-2"];var o=t["text-3"]+"/"+t["text-4"];GoodsService.addAddress(provinceId,cityId,districtId,o,streetId).success(function(e,t,o,i){$scope.init()})}),$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId,provinceName=t.provinceName,cityName=t.cityName,$scope.address=t.regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.dataAdd=null,$scope.defaultValue=null,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,token=$stateParams.token,token&&MyStoreService.login(token).success(function(e){if(!e.success||null==e.data.mid)return void $state.go("login");UserService.setUser(e.data),e.data.sessionValue?$localstorage.set("sg_login_token_secret","Bearer"+e.data.sessionValue):$localstorage.set("sg_login_token_secret","Bearer"+GetStatisticInfoService.generateUUID())}),$scope.buttonShow=!1,memberId=$stateParams.storeId,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$ionicScrollDelegate.scrollTop(),$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})})}]),APP.service("MyStoreService",["$http","UrlService",function(e,t){this.getActivityProductsList=function(o,i,s,n,a,r,c){var l={storeId:o,isWdHost:i,productCateId:s,provinceId:n,cityId:a,districtId:r,sortColumn:c};return e.get(t.getUrl("ACTIVITY_PRODUCTS_LIST"),l)},this.getCommonProductsList=function(o,i,s,n,a,r,c,l){var d={storeId:o,isHost:i,productCateId:s,provinceId:n,cityId:a,districtId:r,pageIndex:c,sortColumn:l,noLoading:!0};return e.get(t.getUrl("PRODUCTS_LIST"),d)},this.getPositionFromCookie=function(){var o={};return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"),o)},this.getProductsList=function(o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){var v={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,provinceName:r,cityName:c,districtName:l,pageIndex:d,pageSize:u,productCateId:p,filterData:g,fromType:m,flag:f,noLoading:h};return e.get(t.getUrl("COMMONLOADITEMNEW"),v)},this.getMyStoreInfo=function(o,i,s,n,a){var r={COOKIE_DOMAIN:o,DOMAIN_URL:i,POM_STATIC_DOMAIN_NAME:s,link:n,storeId:a,fromType:2};return e.get(t.getUrl("MY_STORE"),r)},this.getStoreInfo=function(o,i){if(i)var s={storeId:o,shareStoreId:i};else var s={storeId:o};return e.get(t.getUrl("MY_STORE_NEW"),s)},this.getMyStoreInfoNew=function(o){var i={memberId:o};return e.get(t.getUrl("SHUNGUANG_VIP"),i)},this.getFilterList=function(o){var i={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),i)},this.login=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("OTHER_LOGIN"),params:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("HelpController",["$scope","$state","HelpService","InAppBrowserService","UrlService",function(e,t,o,i,s){e.helpData=[],e.loadData=function(){o.getHelpList().success(function(t){e.helpData=t.data.second})},e.goHelpDetail=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,o).addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(){e.loadData()})}]),APP.service("HelpService",["$http","UrlService",function(e,t){this.getHelpList=function(){return e.get(t.getUrl("SHUNGUANG_HELP"))}}]),APP.controller("OrderDetailController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p){o.orderSnDetail=n.orderSn,o.cOrderSnDetail=n.cOrderSn,o.userOrder="",o.orderDetailList=[];var g=r.getUser();o.loginMemberId=g.mid,o.uname=g.userName,o.userlevel=0,o.shareStoreId="";var m=n.cOrderId;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.init=function(){p.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})},o.loadData=function(e,t){s.getOrderDetail(e,t).success(function(e){e.success&&(o.userOrder=e.data.loginMemberId==e.data.memberId,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier)})},o.goOrderTrack=function(e){i.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void a.showToast("退款受理中，请稍后刷新查看状态！");s.checkRefund(e).success(function(t){t.success?t.data&&t.data.isPackage?a.showConfirm("",t.data.packageMessage,function(t){t&&i.go("applyRefund",{cOrderSn:e})}):i.go("applyRefund",{cOrderSn:e}):a.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),a.showToastShort("复制成功")):a.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?i.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):i.go("productDetail",{productId:o.orderDetailList.productId,o2oType:o.orderDetailList.o2oType,storeId:o.orderDetailList.ckCode})},o.asse=function(e,t,o){i.go("publicationEvaluation",{cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),i=null;i=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,i.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(u.nextDirection("forward"),i.go("orderManage")):a.showToast(e.message)})}a.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,m=n.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.cOrderSnDetail,m),o.init()}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.service("OrderDetailService",["$http","UrlService",function(e,t){this.getOrderDetail=function(o,i){var s={cOrderSn:o,cOrderId:i};return e.get(t.getUrl("ORDER_DETAIL"),s)},this.checkRefund=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CHECK_REFUND"),i)},this.customService=function(){return t.getUrl("CUSTOMER_SERVE")}}]),APP.controller("OrderManageController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){function w(e){e&&(a.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),i(function(){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,"")},1e3))}function y(e){e?a.deleteOrder(b).success(function(e){e.success?t.init():(g.showToastShort(e.message),b="")}).error(function(e){g.showToastShort("删除失败！"),b=""}):b=""}t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=0,t.isIos=!1,t.BDO=!1;var T,C="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var b="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType=o.orderType?o.orderType:"全部订单",t.orderFlag=o.orderFlag?o.orderFlag:0,t.orderStatus=o.orderStatus?o.orderStatus:0,t.availableToTop(),t.loadOrderList(!1,t.orderFlag,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),$.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.batchDeleteOrder=function(){s.go("batchDeleteOrder")},t.loadOrderList=function(e,o,i,s,n,c,l,d){a.getOrderList(o,i,s,n,c,d).success(function(s){if(s.success){if("closed"==i?(T=s.data.canDeleteAll,s.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(T=!1,t.BDO=!1),t.emptySearch=!1,s.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(s.data.orders);else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=t.orderList.concat(s.data.orders);else if(l)t.searchOrderList=s.data.orders;else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=s.data.orders;l?t.hasMoreDataSearch=s.data.orderProductSize:t.hasMoreData=s.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,i){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var n=e,a="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?S.getAliPayInfo(n,i,a).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");C=e.result,window.alipay.pay({payInfo:C},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:n,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+n,price:i,notifyUrl:a},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};u.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,i,n,a){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};u.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+i+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,i,n){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};u.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):s.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,i){e.getOrderList(t).success(function(e){couponLists=e.data.couponList,couponLists.length>0&&i?s.go("Retainage",{relationOrderSn:t}):s.go("paymentxyz",{orderSn:t})})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.searchModal.hide(),s.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){s.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,i,n,a,r){r&&t.closeSearchModal(),s.go("orderDetail",{orderSn:e,cOrderSn:o,cOrderId:n})},t.goAssess=function(e,t,o){o?s.go("assess",{orderId:e,cOrderSn:t}):s.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?s.go("lookAssess",{orderId:e,cOrderSn:t}):s.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",w,"确定")},t.confirmReceive=function(e,o,i){function n(e){e&&I.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',n,"确认"):s.go("confirmReceive",{orderId:i})},t.goBack=function(){if(t.orderFlag=0,t.orderStatus="",t.search.keyWord="",t.pageIndex=0,t.hasMoreData=!1,t.orderList=[],!m.backView())return s.go("homePage"),void m.clearCache();if("batchDeleteOrder"==m.viewHistory().backView.stateName)m.goBack(-2);else{if("afterOrderSubmit"==m.viewHistory().backView.stateName)return void m.goBack(-3);if("ccbPay"==m.viewHistory().backView.stateName||"paymentxyz"==m.viewHistory().backView.stateName||"ccbfenqi"==m.viewHistory().backView.stateName||"orderConfirm"==m.viewHistory().backView.stateName)return s.go("personnalCenter"),void m.clearCache();if("payResultSuccess"==m.viewHistory().backView.stateName||"payResultFailure"==m.viewHistory().backView.stateName||"confirmReceive"==m.viewHistory().backView.stateName)return s.go("personnalCenter"),void m.clearCache()}m.backView()&&m.backView().url.indexOf("login")>0?m.goBack(-2):m.goBack()},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.BDO=!!T,"back"==o.direction?$.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1}):t.init()}),n.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){s.go("orderSearch")},t.closeSearchModal=function(){t.searchModal.hide(),t.availableToTop()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndex=0,t.loadOrderList(!1,0,"",t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){b=e,g.showConfirm("","确认删除此订单？",y,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("4")})}]),APP.service("OrderManageService",["$http","UrlService",function(e,t){this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,pageIndex:s,pageSize:n,keyword:a};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(){return e.get(t.getNewUrl("ORDER_AMOUNT"))},this.cancelOrder=function(o,i){var s={orderId:o,cancelFlag:i};return e.get(t.getUrl("CANCEL_ORDER"),s)},this.payOrder=function(o){var i={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),i)},this.deleteOrder=function(o){var i={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),i)}}]),APP.filter("cut",function(){return function(e,t,o,i){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var s=e.lastIndexOf("");-1!=s&&(e=e.substr(0,s))}return e+(i||"…")}}),APP.controller("OrderTrackingController",["$localstorage","$scope","OrderTrackingService","$stateParams","PopupService","$timeout","UrlService","$state",function(e,t,o,i,s,n,a,r){t.customerServe=function(){if(window.cordova){var o=ionic.Platform.isAndroid(),i=null;i=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&n(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else t.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+t.kfTocken);return},t.orderSn=i.orderSn,t.orderTrackingData=[],t.Tracks=[],t.loadData=function(e){o.getOrderTracking(e).success(function(e){e.success?(t.Tracks=e.data.orderWorkFlowsViewA[0].orderWorkFlowList,t.orderTrackingData=e.data.orderWorkFlowsViewA):e.message?s.showToast(e.message):s.showToast("获取物流信息失败！")})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},t.showTrajectory=function(e){o.getCDKToken().success(function(t){if(0==t.data.status){var o=a.getCPUrl("CDK_URL")+"?order_code="+e+"&token="+t.data.token;window.emc?window.emc.presentH5View(o,""):r.go("carTracking",{trackUrl:o})}else s.showToast(t.message)}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.loadData(t.orderSn)})}]),APP.service("OrderTrackingService",["$http","UrlService",function(e,t){this.getOrderTracking=function(o){var i={orderSn:o};return e.get(t.getUrl("ORDER_TRACKING"),i)},this.getCDKToken=function(){return e.get(t.getUrl("GET_CDK_TOKEN"))}}]),APP.service("PartnerDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getPartnerMessage=function(o,i){var s={ownerId:o,relationshipType:i};return e.get(t.getUrl("PARTNER_DETAIL"),s)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("RefundDetailController",["$localstorage","$http","RefundDetailService","$scope","$stateParams","PopupService","$timeout",function(e,t,o,i,s,n,a){i.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),o=null;o=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&a(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else i.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+i.kfTocken);return},i.orderProductId=s.orderProductId,i.memberId=s.memberId,i.orderTrackingData=[],i.orderTD="",i.loadData=function(e,t){o.getRefundDetail(e,t).success(function(e){e.success?(i.orderTrackingData=e.data.orderWorkFlowList,i.orderTD=e.data):e.message?n.showToast(e.message):n.showToast("获取物流信息失败！")})},i.$on("$ionicView.beforeEnter",function(){i.loadData(i.orderProductId,i.memberId)})}]),APP.service("RefundDetailService",["$http","UrlService",function(e,t){this.getRefundDetail=function(o,i){var s={orderProductId:o,memberId:i};return e.get(t.getUrl("REFUND_DETAIL"),s)}}]),APP.controller("RevenueDetailController",["$scope","$stateParams","RevenueDetailService","$rootScope","$ionicPopup","PlatformService","ionicDatePicker","$timeout",function(e,t,o,i,s,n,a,r){function c(e){var e=e.getFullYear()+"年"+(e.getMonth()+1>9?e.getMonth()+1:"0"+(e.getMonth()+1))+"月"+(e.getDate()>9?e.getDate():"0"+e.getDate())+"日";return e}function l(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,i=e.getDate(),s=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);1==o?(t=e.getFullYear()-1,o=12):o-=1,(t%4==0&&t%100!=0||t%400==0)&&(s[2]=29),s[o]<i&&(i=s[o]),i<10&&(i="0"+i),o<10&&(o="0"+o);var n=t+"年"+o+"月"+i+"日";return n}e.nulldata=!1,e.type=t.code,e.title=t.title,e.revenueList=[],e.total="",e.reward={},e.rewardO={},e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardXY=!1,e.startTime="",e.endTime="",e.rewardStart="",e.rewardEnd="",e.earningType=t.earningType;var d=0;e.init=function(){e.earningType=t.earningType,d=0,e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardYC=!1,e.isRewardXY=!1,4==e.type?(e.rewardStart=l(),e.rewardEnd=c(new Date)):(e.rewardStart="",e.rewardEnd=""),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)},e.loadData=function(t,i,s,n,a,r,c){o.getRevenueList(t,i,s,n,a,r,c).success(function(t,o,s,n){e.nulldata=!1,t.success?(e.total=t.data.total,t.data.reward&&(e.reward=t.data.reward),t.data.rewardO&&(e.rewardO=t.data.rewardO),1!=i&&"0"==e.total&&""==t.data.rewardO.expectBrokerage&&""==t.data.rewardO.expectMonth&&""==t.data.rewardO.expectOpen&&""==t.data.rewardO.expectOpenCommend&&""==t.data.rewardO.expectRecommend&&""==t.data.rewardO.expectLeader&&""==t.data.rewardO.expectDzLeader&&""==t.data.rewardO.expectXyAmount&&""==t.data.rewardO.expectThreeLevel&&(e.nulldata=!0),t.data.rewardA&&(e.isRewardA=!0),t.data.rewardB&&0!=t.data.rewardB.length&&(e.isRewardB=!0),t.data.rewardC&&0!=t.data.rewardC.length&&(e.isRewardC=!0),t.data.rewardY&&0!=t.data.rewardY.length&&(e.isRewardY=!0),t.data.rewardZ&&0!=t.data.rewardZ.length&&(e.isRewardZ=!0),t.data.rewardTZ&&0!=t.data.rewardTZ.length&&(e.isRewardTZ=!0),t.data.rewardD&&0!=t.data.rewardD.length&&(e.isRewardD=!0),t.data.rewardXY&&0!=t.data.rewardXY.length&&(e.isRewardXY=!0)):e.revenueList=[],e.$broadcast("scroll.infiniteScrollComplete")})},e.chooseTime=function(){e.startTime=e.rewardStart,e.endTime=e.rewardEnd;var t=s.show({cssClass:"xvv-popupTime",template:'<div class="xvv-Time"><div>选择时间</div><div ng-click="lookDateModel(1)"><p>开始</p><p>{{startTime}}</p></div><div><img src="http://cdn09.ehaier.com/shunguang/H5/www/img/goOrder@2x.png"/></div><div ng-click="lookDateModel(2)"><p>结束</p><p>{{endTime}}</p></div></div>',scope:e,buttons:[{text:"取消"},{text:"确定",type:"button-positive",onTap:function(o){o.preventDefault(),e.rewardStart=e.startTime,e.rewardEnd=e.endTime,t.close(),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)}}]})},e.lookDateModel=function(t){if("APP"==n.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),r(function(){1==t&&(e.startTime=n+"年"+s+"月"+i+"日"),2==t&&(e.endTime=n+"年"+s+"月"+i+"日")},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s),1==t&&(e.startTime=new Date(o).getFullYear()+"年"+i+"月"+s+"日"),2==t&&(e.endTime=new Date(o).getFullYear()+"年"+i+"月"+s+"日")}};a.openDatePicker(i)}},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()})}]),
APP.service("RevenueDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a,r,c){var l={earningType:o,type:i,rewardType:s,page:n,pageSize:a,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]),APP.controller("SecondManageController",["$scope","SecondManageService","UserService","UrlService","PopupService","CreditService",function(e,t,o,i,s,n){e.search={keyWords:""},e.pageIndex=0,e.pageSize=10,e.hasMoreData=!1,e.secondMemberDate=[],e.secondMemberList=[],e.rank=2,e.showShare=!1,e.init=function(){e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t}));o.getUser();e.rank=2,e.getCode(),e.loadData(!1,"",0,e.pageSize,e.rank)},e.getSecAndThi=function(t){e.rank=t,e.search.keyWords="",e.loadData(!1,e.search.keyWords,0,e.pageSize,e.rank)},e.getCode=function(){t.doGetCode().success(function(t){e.mid=t.data.promotionCode})},e.loadData=function(o,i,s,n,a){t.getSecAndThi(i,s,n,a).success(function(t){t.success&&(e.secondMemberDate=t.data,o?e.secondMemberList=e.secondMemberList.concat(t.data.memberInfo):(e.pageIndex=0,e.secondMemberList=t.data.memberInfo),e.hasMoreData=t.data.memberExist,(t.data.memberInfo&&t.data.memberInfo.length<10||!t.data.memberInfo)&&(e.hasMoreData=!1),e.isHaveDate=t.data.memberExist),o&&e.$broadcast("scroll.infiniteScrollComplete")})},e.loadMore=function(){e.pageIndex++,e.loadData(!0,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.searchSecondMember=function(){e.pageIndex=0,e.loadData(!1,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=o.getUser().avatarImageFileId,s=i.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?window.umeng.share("成为我的合伙人，一起赚丰厚佣金！","有梦就有店，高收入0投资，挣钱真简单～",t,s,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var s="成为我的合伙人，一起赚丰厚佣金！",a="有梦就有店，高收入0投资，挣钱真简单～",r=o.getUser().avatarImageFileId,c=i.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?(0==t?window.umeng.shareToSina(s,a,r,c,0,null,n.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(s,a,r,c,0,null,n.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(s,a,r,c,0,null,n.shareSuccessCallback):3==t?(window.umeng.shareToQQ(s,a,r,c,0,null,n.shareSuccessCallback),n.qqShare()):4==t?(window.umeng.shareToQzone(s,a,r,c,0,null,n.shareSuccessCallback),n.qqShare()):5==t&&e.copeText(c),n.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SecondManageService",["$http","UrlService",function(e,t){this.getSecAndThi=function(o,i,s,n){var a={keyword:o,pageIndex:i,pageSize:s};return 2==n?e.get(t.getUrl("SECOND_MANAGE"),a):e.get(t.getUrl("THIRD_MANAGE"),a)},this.doGetCode=function(){return e.get(t.getUrl("GETTUIGUANGMA"))}}]),APP.controller("SetShopCoverController",["$scope","SetShopCoverService","UserService","$ionicPopup",function(e,t,o,i){e.shopCoverList=[],e.storeId=o.getUser().mid,e.init=function(){e.getCover(e.storeId)},e.getCover=function(o){t.getShopCover(o).success(function(t,o,i,s){e.shopCoverList=t.data.shopCover})},e.chooseCover=function(o){var s=e.shopCoverList[o].coverUrl;t.setShopCover(s).success(function(t,o,s,n){e.getCover(e.storeId);var a=i.show({template:"修改店铺模板成功"});setTimeout(function(){a.close()},1e3)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.service("SetShopCoverService",["$http","UrlService",function(e,t){this.getShopCover=function(o){var i={storeId:o};return e.get(t.getUrl("GET_SHOP_COVER"),i)},this.setShopCover=function(o){var i={url:o};return e({method:"POST",url:t.getUrl("SET_SHOP_COVER"),params:i})}}]),APP.controller("ShopController",["$ionicViewSwitcher","$scope","UserService","ShopService","$ionicSlideBoxDelegate","$ionicScrollDelegate","MyStoreService","UrlService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","PopupService","MESSAGECENTERService","$rootScope","$state","BannerThemeService","$localstorage","VersionService","InAppBrowserService","$stateParams","$interval","$sce","CreditService","IMService","ManageMoneyService","LoginService","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,P){t.flagNum=!1,t.tabNav="shop",t.storeInfo={},t.avatarImage="",t.slideImage=[],t.shareInfo={},t.user=o.getUser(),t.storeId="",t.btnList=[{url:"shopRevenue",icon:m.imgBaseURL+"img/btn_shop_revenue.png",name:"营收"},{url:"getCouponsList",icon:m.imgBaseURL+"img/btn_shop_coupon.png",name:"优惠券"},{url:"manageMoney",icon:"img/btn_shop_licai.png",name:"投资"},{url:"orderManage",icon:m.imgBaseURL+"img/btn_order_manager.png",name:"订单"},{url:"microSchool",icon:m.imgBaseURL+"img/btn_small_school.png",name:"微学堂"},{url:"teamSupervise",icon:m.imgBaseURL+"img/btn_two_management.png",name:"合伙人"},{url:"storeTeamOwner",icon:m.imgBaseURL+"img/btn_statistics.png",name:"统计"},{url:"vip",icon:m.imgBaseURL+"img/btn_storefront_renovation.png",name:"会员中心"}],t.showShare=!1;var L="",x="";t.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.topBtnCss4IOS={top:"12px"}),t.goMemberCenter=function(){T.getGameId(function(e){f.go("vip",{gameId:e})})},t.init=function(){i.getStoreInfo().success(function(e,o,i,s){t.storeInfo=e.data,t.storeId=t.storeInfo.ownerId,v.set("storeId",t.storeInfo.ownerId)}),i.getLevelInfoBefore().success(function(e){t.slideImage=e.data.banner,s.$getByHandle("shop_slider").update(),s.$getByHandle("shop_slider").loop(!0)}),i.getLevelInfo(function(e){e.success(function(e){if(t.avatarImageFileId=e.data.avatarImageFileId,t.userCurrentLevelId=e.data.userCreditWithLevel.order,t.userName=e.data.userCreditWithLevel.name,t.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel)if(t.levelArray=[],e.data.storeCreditWithLevel.order<=3){t.imgCount=e.data.storeCreditWithLevel.order;for(var o=0;o<e.data.storeCreditWithLevel.order;o++)t.levelArray.push(m.imgBaseURL+"img/Star-Grade@2x.png")}else for(var o=0;o<e.data.storeCreditWithLevel.order-3;o++)t.levelArray.push(m.imgBaseURL+"img/Diamond-Grade@2x.png")})},L),i.getMessage().success(function(e){t.msg=e.data.list[0].content,e.data.count>0?t.flagNum=!0:t.flagNum=!1}),S.checkVersion()},t.slideImageClick=function(e){"1"==t.slideImage[e].type?"主题活动"==t.slideImage[e].activityType?f.go("bannerTheme",{bannerId:t.slideImage[e].bannerId,platformType:t.slideImage[e].platformType}):"日常活动"==t.slideImage[e].activityType&&h.getBannerTheme(t.slideImage[e].bannerId,t.slideImage[e].platformType).success(function(o){f.go("bannerDaily",{bannerId:t.slideImage[e].bannerId,layout:o.data.layout,platformType:t.slideImage[e].platformType})}):"6"==t.slideImage[e].type&&f.go("crowdFunding")},t.share=function(){if(window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else{var e=t.storeInfo.storeName+"的顺逛小店",o=t.storeInfo.avatarImageFileId,i=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?window.umeng.share(e,"买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",o,i,0):alert("只能在app分享,请下载app！")}},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.storeInfo.storeName+"的顺逛小店",i="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",s=t.storeInfo.avatarImageFileId,n=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?(0==e?window.umeng.shareToSina(o,i,s,n,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):5==e&&t.copeText(n),T.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(e){function i(e){t.avatarImage=e,u(function(){t.avatarImage=e},200);var i=function(e){d.hide(),p.showToast("上传成功");var i=JSON.parse(e.response);t.avatarImage=i.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},s=function(e){d.hide(),p.showToast("上传失败")},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var a={};n.params=a,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),i,s,n);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function s(e){}function n(e){t.avatarImage=e,u(function(){t.avatarImage=e},200);var i=function(e){p.showToast("上传成功"),d.hide();var i=JSON.parse(e.response);t.avatarImage=i.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},s=function(e){p.showToast("上传失败"),d.hide()},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var a={};n.params=a,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),i,s,n);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function a(e){}1==e?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(n,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,i),u(function(){window.plugins.actionsheet.hide()},5e3)}else c.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},t.enter=function(o){if(-1!=o.indexOf("http"))if(window.cordova)if(m.isIOS)if(window.device.hasNewBrowser){var i=null;i=I.open(o),i.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else if(window.device.hasNewBrowser){var i=null;i=I.open(o),i.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else window.open(o,"_blank","location=yes");else-1!=o.indexOf("vip")?t.goMemberCenter():(f.go(o),e.nextDirection("forwoard"))},t.goNewHand=function(){-1!=navigator.userAgent.indexOf("iPhone")?I.open(r.getHead()+"mstore/sg/helpDetail.html?id=613","新手必读").addEventListener("exit",function(e){}):f.go("helpDetail",{helpId:"613",content:"新手必读"})},t.setSwitchFun=function(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),i=!1,s=o.length-1;s>=0;s--)if(o[s].id==t)return m.isCommission=o[s].list[0].checked,m.cashSwitch=o[s].list[1].checked,m.goldRainSwitch=o[s].list[2].checked,void(i=!0);if(!i){m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var a=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(a)),m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0}},t.$on("$ionicView.beforeEnter",function(e,i){if(t.isApp=!!window.cordova||void 0,x=$.token)a.login(x).success(function(e){if(!e.success||null==e.data.mid)return void f.go("login");o.setUser(e.data),v.set("sg_login_token_secret","Bearer"+e.data.sessionValue),L=o.getUser().mid,A.checkOpenStore(L).success(function(e){e.data?(t.isBuyer="1",A.setRole(t.isBuyer),v.set("storeId",L)):(t.isBuyer="0",A.setRole(t.isBuyer),v.set("storeId",20219251))}),t.avatarImage=o.getUser().avatarImageFileId,n.scrollTop(),t.setSwitchFun(L),t.init()}).error(function(){f.go("login")});else{if(L=o.getUser().mid,t.avatarImage=o.getUser().avatarImageFileId,!o.getUser().mid)return void f.go("login");n.scrollTop(),t.setSwitchFun(L),t.init()}})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){this.getStoreInfo=function(){var o={noLoading:!0};return e({method:"POST",url:t.getUrl("GET_STORE_INFO"),params:o})},this.getLevelInfo=function(i,s){o.getGameId(function(o){i(e.get(t.getUrl("SHUNGUANG_VIP")+"?gameId="+o+"&memberId="+s))})},this.getLevelInfoBefore=function(){return e.get(t.getUrl("MY_STORE"))},this.getMessage=function(){return e.get(t.getUrl("MESSAGECENTER_INIT"))}}]),APP.controller("ShopRenovateController",["$scope","SetShopCoverService","UserService",function(e,t,o){e.shopCoverUrl="",e.storeId=o.getUser().mid,e.init=function(){t.getShopCover(e.storeId).success(function(t){for(var o=0,i=t.data.shopCover.length;o<i;o++)1==t.data.shopCover[o].selected&&(e.shopCoverUrl=t.data.shopCover[o].coverUrl)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.controller("ShopRevenueController",["$scope","$state","$ionicHistory","ShopRevenueService","PopupService","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a){function r(){i.isHasBindBankNum().success(function(e){e.success&&(u=e.data)})}function c(e){i.getAccountState(e).success(function(e){e.success&&(d=e.data)})}function l(){i.getTotalCommission().success(function(t){t.data.isLogin?e.totalCommission=t.data.totalReward:e.totalCommission=""}).error(function(e){})}e.styleFlag=!0,e.myInComeOut={},e.myTrendOut={},e.earningType="";var d=0;e.totalCommission="";var u="";e.init=function(){e.myInComeOut=[],e.myTrendOut=[],e.styleFlag=!0,e.earningType="B",e.loadData(7,e.earningType),r(),c(e.earningType),l()},e.loadData=function(t,o){i.getRevenueInfo(t,o).success(function(t,o,i,s){e.myInComeOut=t.data.myInComeOut,e.myTrendOut=t.data.myTrendOut;for(var n=echarts.init(document.getElementById("shopRevenueChart")),a=e.myTrendOut.dates,r=0;r<e.myTrendOut.dates.length;r++)a=a.replace("'","");var c={grid:{show:!0,left:"10%",top:"5%",right:"5%",bottom:"15%",padding:20,backgroundColor:new echarts.graphic.LinearGradient(0,0,1,1,[{offset:0,color:"#1188D7"},{offset:1,color:"#3CA9F1"}])},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"line",lineStyle:{color:"rgba(255,255,255,0.2)",width:2}}},xAxis:{type:"category",boundaryGap:!1,data:a.split(","),axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede",width:1}},axisTick:{lineStyle:{color:"#dedede",width:1}}},yAxis:[{type:"value",backgroundColor:"#1188D7",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbol:"circle",showSymbol:!1,symbolSize:6,smooth:!0,areaStyle:{normal:{color:"rgba(255,255,255,0.10)"}},itemStyle:{normal:{borderWidth:2,borderColor:"#ffffff",color:"#1188D7",lineStyle:{color:"#ffffff",width:2}}},data:e.myTrendOut.values.split(",")}]};n.setOption(c)})};var p=!0;e.changeProductType=function(t,o){p&&(e.styleFlag=o,p=!1,e.earningType=t,e.loadData(7,e.earningType),setTimeout(function(){p=!0},500))},e.goHelpDetail=function(){-1!=navigator.userAgent.indexOf("iPhone")?n.open(a.getHead()+"mstore/sg/helpDetail.html?id=15","营收结算规则").addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:15,content:"营收结算规则"})},e.withdraw=function(){1==d||3==d||4==d||parseInt(u)>0?e.myInComeOut?t.go("mentionCenter",{canAmount:e.myInComeOut.canAmount}):t.go("mentionCenter",{canAmount:0}):t.go("bankCard")},e.goBack=function(){if(!o.backView()||"mentionCenter"==o.viewHistory().backView.stateName)return void t.go("homePage");o.backView()&&o.backView().url.indexOf("login")>0?o.goBack(-2):o.goBack()},e.closePopup=function(){e.loginIsAuthentication=!1},e.$on("$ionicView.beforeEnter",function(){e.loginIsAuthentication=!1,e.loginIsAuthenticationClose=!0,u="",e.init()})}]),APP.service("ShopRevenueService",["$http","UrlService",function(e,t){this.getRevenueInfo=function(o,i){var s={range:o,earningType:i};return e.get(t.getUrl("REVENUE_INFO"),s)},this.getAccountState=function(o){var i={earningType:o};return e.get(t.getUrl("GET_ACCOUNT_STATE"),i)},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))},this.activation=function(){return e.get(t.getUrl("KBIND_ACTIVATION"))},this.isHasBindBankNum=function(){return e.get(t.getUrl("BANK_HASBINGNUM_NEW"))},this.realName=function(){return e.get(t.getUrl("KBIND_REALNAME"))},this.getTotalCommission=function(){var o={startDate:"",endDate:""};return e({method:"POST",url:t.getUrl("GET_TOTAL_COMMISSION"),params:o})}}]),APP.service("SpreadConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMessage=function(o,i,s){var n={partnerId:o,pageIndex:i,pageSize:s};return e.get(t.getUrl("SPREAD_CONNECTION"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("StatisticsController",["$ionicHistory","$q","$scope","$ionicHistory","$state","StatisticsService","$ionicScrollDelegate",function(e,t,o,e,i,s,n){function a(e,t){for(var o in e)e[o].storeName=s.limitStrLength(e[o].storeName,t)}function r(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=r(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=r(e[o]);return t}return e}function c(e){var o=t.defer();return o.resolve(r(e)),o.promise}o.backToLastView=function(){i.go("personnalCenter"),e.clearCache()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},o.switchType=function(e){o.typeState[e]||(o.typeState=[!1,!1],o.typeState[e]=!0,o.isPersonalStat=!o.isPersonalStat)},o.scrollToTop=function(){n.scrollTop({shouldAnimate:!0}),o.isShowScrollToTopButton=!1},o.watchScrollPosition=function(){n.getScrollPosition().top>10&&(o.isShowScrollToTopButton=!0)},o.switchConnectionType=function(e){0==o.connectionType[e]&&(o.connectionType=[!1,!1],o.connectionType[e]=!0,o.optionArr=[!0,!1],0==e&&o.hasPartner&&(c(o.partnerData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})),1==e&&o.hasConnection&&(c(o.connectionData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.connectionData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})))},o.switchOption=function(e){0==o.optionArr[e]&&(o.optionArr=[!1,!1],o.optionArr[e]=!0,o.isShowOption=!o.isShowOption)},o.closeOption=function(){o.isShowOption=!o.isShowOption},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e},o.timeTransform=function(e){var t=new Date;return t.setTime(e),t.Format("yyyy-MM-dd hh:mm:ss")},o.init=function(){s.getReportMessage().success(function(e){o.allData=e.data,0!=e.data.subLevelReportList.length?(o.hasSubLevel=!0,e.data.subLevelReportList[0]&&!$.isEmptyObject(e.data.subLevelReportList[0])?(o.hasPartner=!0,o.partnerData=e.data.subLevelReportList[0],e.data.subLevelReportList[1]&&!$.isEmptyObject(e.data.subLevelReportList[1])?(o.hasConnection=!0,o.connectionData=e.data.subLevelReportList[1],c(o.partnerData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})):(o.hasConnection=!1,c(o.partnerData.brokerageReportList).then(function(e){o.nowMonthContent=e,a(o.nowMonthContent,o.nowStoreNameLength)}),c(o.partnerData.brokerageReportList).then(function(e){o.totalContent=e,a(o.totalContent,o.totalStoreNameLength)}))):(o.hasPartner=!1,o.hasConnection=!1)):(o.hasSubLevel=!1,o.hasPartner=!1,o.hasConnection=!1)}),s.getReportMessagePlus().success(function(e){o.newBrokerageAmount=e.data.newBrokerageAmount,o.totalBrokerageAmount=e.data.totalBrokerageAmount})},o.$on("$ionicView.beforeEnter",function(){o.isPersonalStat=!1,o.typeState=[!0,!1],o.connectionType=[!0,!1],o.optionArr=[!0,!1],o.isShowOption=!1,o.isShowScrollToTopButton=!1,o.nowStoreNameLength=Math.floor(.21*(window.innerWidth-24)/13*4-3),o.totalStoreNameLength=Math.floor(.38*(window.innerWidth-24)/13*2-1),o.init()})}]),APP.service("StatisticsService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getReportMessage=function(){return e.get(t.getUrl("REPORT_DETAIL"))},this.getReportMessagePlus=function(){return e.get(t.getUrl("REPORT_DETAIL_PLUS"))},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("VRController",["$rootScope","$scope","UrlService","$sce","$ionicHistory","$stateParams",function(e,t,o,i,s,n){t.iframeUrl=i.trustAsResourceUrl(e.imgBaseURL+"VRshop/index.html");var a=n.isH5;t.goBack=function(){a?s.goBack():window.location.href="backToApp"}}]),APP.controller("WithdrawCashController",["$scope","$stateParams","WithdrawCashService","PopupService","$timeout","$ionicHistory","$state","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c){e.canAmount="",e.account="",e.canGetCash=!1,e.loadFinish=!1,e.init=function(){e.canGetCash=!1,t.canAmount?e.canAmount=t.canAmount:e.canAmount=0,e.canAmount>0&&(e.canGetCash=!0),e.loadFinish=!1,o.getMessage().success(function(t,o,s,n){t.success?t.data.kjtAccount&&(e.loadFinish=!0,e.account=t.data.kjtAccount.memberKjtpayAccount):(i.showToast(t.message),e.loadFinish=!1)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.getCashNow=function(){o.getCash(e.account).success(function(e,t,o,s){e.success?a.go("withdrawSuccess",{content:e.data.result}):i.showToast(e.message)})},e.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?r.open(c.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})}}]),APP.service("WithdrawCashService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.getCash=function(o){var i={kjtAccount:o};return e.get(t.getUrl("GETCASH_INIT"),i)}}]),APP.controller("WithdrawSuccessController",["$scope","$stateParams","$ionicHistory",function(e,t,o){e.content=t.content,e.goBack=function(){o.goBack(-2)}}]),APP.controller("batchDeleteOrderController",["$ionicHistory","$ionicPopup","$scope","PopupService","OrderManageService","BatchOrderService","$ionicScrollDelegate","$state","$ionicViewSwitcher","$rootScope",function(e,t,o,i,s,n,a,r,c,l){o.hasMoreData=!1,o.closeOrderData=[];var d=0;o.goBack=function(){c.nextDirection("enter"),r.go("orderManage")},o.loadData=function(){d=0,s.getOrderList(1,"closed",0,5,"").success(function(e){if(e.success){a.scrollTop(),o.isSelectAllOrder=!1,o.closeOrderData=e.data.orders,o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.image=[];for(var t=0;t<o.closeOrderData.length;t++)o.image[t]="img/ic_check.png"}})},o.loadMore=function(){d++,s.getOrderList(1,"closed",d,5,"").success(function(e){if(e.success){for(var t=o.closeOrderData.length;t<e.data.orders.length+o.closeOrderData.length;t++)o.image[t]="img/ic_check.png",o.isSelectAllOrder=!1;o.closeOrderData=o.closeOrderData.concat(e.data.orders),o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.$broadcast("scroll.infiniteScrollComplete")}})},o.selectOrderAddress=function(e){o.chooseOrderNum=0,-1!=o.image[e].indexOf("check")?(o.image[e]="img/ic_select.png",o.chooseOrderNum++,o.isChooseOrder=!0):(o.image[e]="img/ic_check.png",o.chooseOrderNum--),o.chooseOrderNum==o.image.length?o.isSelectAllOrder=!0:o.isSelectAllOrder=!1},o.selectAllOrder=function(){if(o.isSelectAllOrder){for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_check.png";o.chooseOrderNum=0,o.isSelectAllOrder=!1}else{for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_select.png";o.isSelectAllOrder=!0,o.chooseOrderNum=o.image.length}},o.batchDelete=function(){o.isChooseOrder=!1;for(var e=0;e<o.image.length;e++)-1!=o.image[e].indexOf("select")&&(o.isChooseOrder=!0);if(!o.isChooseOrder)return void i.showToast("请选择要删除的订单");t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){if(e){for(var t="",i=[],s=0,a=o.image.length;s<a;s++)-1!=o.image[s].indexOf("select")&&i.push(o.closeOrderData[s].orderId);t=i.join(",");var l={orderIds:t};n.batchDelete(l).success(function(e){if(e.success){if(o.isSelectAllOrder&&!o.hasMoreData)return c.nextDirection("enter"),void r.go("orderManage");o.loadData()}})}})},o.$on("$ionicView.beforeEnter",function(){a.scrollTop(),d=0,o.image=[],o.chooseOrderNum=0,o.isChooseOrder=!1,o.isSelectAllOrder=!1,window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?o.isIosAndInApp=!0:o.isIosAndInApp=!1,window.cordova?o.isApp=!0:o.isApp=!1,o.isIosAndInApp&&(o.iosStyleOne={padding:"64px 0 90px 0"},o.iosStyleTwo={top:"20px"}),o.isApp?o.bottomDivHeight={height:"40px"}:o.bottomDivHeight={height:"120px"},o.loadData()})}]),APP.service("BatchOrderService",["$http","UrlService",function(e,t){this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ORDER"),o)}}]),APP.controller("chaseEvaluateController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","chaseEvaluateService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(o){var i=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):a.showToast(o.message)},s=function(e){alert(e)},n=new FileUploadOptions,r=new Date,c=r.getTime();n.fileKey="imageFile",n.fileName=u.getUser.userName+c,n.headers={TokenAuthorization:g.get("sg_login_token_secret")},n.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),i,s,n)}function f(e){}var h=[],v=!0;e.goBack=function(){c.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?a.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(t){t?v&&(v=!1,p.submitEvaluateNew(e.wdOrderSn,e.commentObj.commentTt,h.join(",")).success(function(t){v=!0,t.success?t.data&&(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?a.showToast(t.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.$on("$ionicView.beforeEnter",function(){v=!0,e.wdOrderSn=o.cOrderSn,e.isMyOrder=1==o.isMeorder,e.commentObj={commentTt:""},e.imageCount=0,e.imageList=[],h=[]})}]),APP.service("chaseEvaluateService",["$http","UrlService",function(e,t){this.submitEvaluateNew=function(o,i,s){var n={cOrderSn:o,experienceContent:i,fileIds:s};return e({method:"POST",url:t.getUrl("ADD_ASSESS_SUBMIT"),params:n})}}]),APP.controller("criticalSuccessController",["$scope","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","UrlService","CreditService","criticalSuccessService",function(e,t,o,i,s,n,a,r,c,l,d,u){function p(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e){var t,o,i,s,n,a,r,c="",l=0;for(e=_utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),o=e.charCodeAt(l++),i=e.charCodeAt(l++),s=t>>2,n=(3&t)<<4|o>>4,a=(15&o)<<2|i>>6,r=63&i,isNaN(o)?a=r=64:isNaN(i)&&(r=64),c=c+_keyStr.charAt(s)+_keyStr.charAt(n)+_keyStr.charAt(a)+_keyStr.charAt(r);return c},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var i=e.charCodeAt(o);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}}var g=new p;e.thisTitleName="评价成功",e.goBack=function(){"lookAssess"==r.viewHistory().backView.stateName?r.goBack(-1):r.goBack(-2)},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"});var m;e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},e.shareToPlatform=function(t){m=encodeURIComponent(g.encode(e.wdOrderSn));var o=e.isCriticalShop.productName,i=e.isCriticalShop.productImg,s=l.getShareLinkHeader()+"useExperience/"+m;window.umeng?(0==t?window.umeng.shareToWechatSession("邀请评价",o,i,s,0,null,d.shareSuccessCallback):1==t&&window.umeng.shareToQQ("邀请评价",o,i,s,0,null,d.shareSuccessCallback),2==t?e.copeText(s):d.successShare()):alert("只能在app分享")},e.criticalInit=function(){u.criticalNo(e.wdOrderSn).success(function(t){t.success?(e.noCriticalOrderList=t.data.waitComments,e.isCriticalShop=t.data.productInfo,e.isMeOrder=t.data.isMyOrder,e.isStore=t.data.isStoreMember):n.showToastShort(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.thisTitleName="评价成功","lookAssess"==r.viewHistory().backView.stateName&&(e.thisTitleName="邀请评价"),e.wdOrderSn=t.cOrderSn,e.shareList=[{img:c.imgBaseURL+"img/mm-wechat.png",text:"微信"},{img:c.imgBaseURL+"img/qq.png",text:"QQ"},{img:c.imgBaseURL+"img/btn_link.png",text:"复制链接"}],e.criticalInit()})}]),APP.service("criticalSuccessService",["$http","UrlService",function(e,t){this.criticalNo=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CRITICALSUC"),i)}}]),APP.controller("evaluationSuccessController",["$scope",function(e){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.$on("$ionicView.beforeEnter",function(){})}]),APP.controller("FinancialMoneyController",["InAppBrowserService","$rootScope","$scope","$state","FinancialMoneyService","UrlService","$stateParams",function(e,t,o,i,s,n,a){var r=n.getHead().replace("v3/","www/index.html");o.ssAuth=null,t.financialMoneyWhereId="","manageMoney"!=a.whereId&&(t.financialMoneyWhereId=a.whereId),o.loginUrl=r+"#/financialMoney/"+t.financialMoneyWhereId,o.returnUrl=r+"#/"+t.financialMoneyWhereId;o.$on("$ionicView.beforeEnter",function(){var e=window.location.href.indexOf("page=")
;if(-1!=e&&-1==window.location.href.indexOf("auth_code")){var t=unescape(window.location.href).substring(e+5);return void(window.location.href=t)}o.init()}),o.init=function(){function e(){s.checkKjtLogin().success(function(e){if(e.data.isLogin)o.ssAuth=e.data.token,angular.element("#hairongyi").submit();else{var i=r+"#/"+t.financialMoneyWhereId,s=r+"#/financialMoney/"+t.financialMoneyWhereId+"?page="+i,n=escape(s),a="https://zmgs.kjtpay.com/mgs/common/page.htm?page=authorizeMain&partner_id=200000055141&return_url="+n;window.location.href=a}})}var i=unescape(window.location.href);if(-1!=i.indexOf("auth_code")){var n=i.indexOf("auth_code")+10,a=i.toString().substr(n,32);s.getToken({authCode:a}).success(function(t){o.ssAuth=t.data.token,e()})}else e()}}]),APP.service("FinancialMoneyService",["$http","UrlService","UserService",function(e,t,o){this.getToken=function(o){return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:o})},this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))}}]),APP.controller("publicationEvaluationController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(o){var i=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):a.showToast(o.message)},s=function(e){alert(e)},n=new FileUploadOptions,r=new Date,c=r.getTime();n.fileKey="imageFile",n.fileName=u.getUser.userName+c,n.headers={TokenAuthorization:p.get("sg_login_token_secret")},n.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),i,s,n)}function m(e){}var f=[],h=[],v=!0;e.goBack=function(){c.goBack()},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}f=[],e.impressionArr.forEach(function(t){f.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.evaluateMethod=function(t){e.evaluateList=t},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?a.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(o){o?v&&(v=!1,t.submitEvaluationNew(e.wdOrderSn,e.commentObj.commentTt,e.evaluateList,e.valueAll.value1,e.valueAll.value3,e.valueAll.value2,h.join(","),f.join(","),e.isMeOrder,e.isStore).success(function(t){v=!0,t.success?t.data&&(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?a.showToast(t.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.init=function(){t.evaluationInit(e.wdOrderSn).success(function(t){t.success?(e.isMeOrder=1==t.data.isMyOrder,e.isStore=0==t.data.isStoreMember,e.impressionStr=t.data.impression,e.productPic=t.data.productInfo.productImg):a.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f=[],v=!0,e.isMeOrder=!1,e.wdOrderSn=o.cOrderSn,e.productPic="",e.commentObj={commentTt:""},e.valueAll={value1:"5",value2:"5",value3:"5"},e.impressionArr=[],e.impressionStr=[],e.evaluateList=5,e.imageCount=0,e.imageList=[],h=[],e.canCommit=!1,e.init()})}]),APP.service("publicationEvaluationService",["$http","UrlService",function(e,t){this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG_NEW")},this.checkAssessText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),i)},this.evaluationInit=function(o){var i={cOrderSn:o};return e.get(t.getUrl("EVALUCTION_NEW"),i)},this.submitEvaluationNew=function(o,i,s,n,a,r,c,l,d,u){if(d||u)var p={cOrderSn:o,commentContent:i,star:s,productStar:n,serviceStar:a,shippingStar:r,fileIds:c,impressions:l};else p={cOrderSn:o,commentContent:i,star:s};return e({method:"POST",url:t.getUrl("SUBMIT_EVALUCTION_NEW"),params:p})}}]),APP.directive("commentBarNew",[function(){return{restrict:"E",template:'<div>\n        <img ng-click = "comment(0)" ng-src=\'{{commentValue>=1?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(1)" ng-src=\'{{commentValue>=2?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(2)" ng-src=\'{{commentValue>=3?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(3)" ng-src=\'{{commentValue>=4?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(4)" ng-src=\'{{commentValue>=5?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n      </div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("useExperienceController",["$scope","$stateParams","$timeout","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$localstorage","$interval","useExperienceService","publicationEvaluationService","$ionicPopup",function(e,t,o,i,s,n,a,r,c,l,d,u,p){window.onerror=function(e,t,o,i,s){setTimeout(function(){})},document.querySelector("#file").addEventListener("change",function(){var t=this;lrz(t.files[0],{width:800}).then(function(t){e.$apply(function(){e.imageCount>=5?s.showToast("最多上传5张图片"):(e.imageList.push(t.base64),g.push(t.base64.replace("base64,","base64-")),e.imageCount++)})})});var g,m=[],f=!0;e.imageCount=0,e.imageList=[],e.isCanComment=!0,e.VCodeTips="获取验证码",e.canGetVcode=!0,e.userInfo={mobile:"",captcha:"",verificationCode:""},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.removeImage=function(t){p.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){o&&(e.imageList.splice(t,1),g.splice(t,1),e.imageCount--)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?s.showToast("请输入2～500字的评价！"):0==e.userInfo.mobile.length?s.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?0==e.userInfo.verificationCode.length?s.showToast("请输入短信验证码"):u.checkAssessText(e.commentObj.commentTt).success(function(t){t?f&&(f=!1,d.submitBuyerComment(e.wdOrderSn,e.userInfo.mobile,e.userInfo.verificationCode,e.commentObj.commentTt,g,m.join(",")).success(function(e){f=!0,e.success?e.data&&(s.showToastShort("商品评价成功！"),o(function(){r.$broadcast("AFTER_COMMIT"),n.go("evaluationSuccess")},1e3)):e.message?s.showToast(e.message):s.showToast("提交失败！")})):s.showToast("您的评论里面包含敏感词！")}):s.showToast("请输入正确的手机号格式")},e.setImgCaptchaForPhone=function(){e.identifyCodeImg=d.getImgCaptchaNew()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},e.getVCode=function(){e.canGetVcode&&(e.userInfo.mobile.length<=0?s.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?e.userInfo.captcha.length<=0?s.showToast("请输入图形验证码"):d.fastLoginCaptchaNew(e.wdOrderSn,e.userInfo.mobile,e.userInfo.captcha).success(function(t){if(t.data){e.canGetVcode=!e.canGetVcode;var o=60;e.timer=l(function(){o-1<0?(e.VCodeTips="获取验证码",l.cancel(e.timer),e.canGetVcode=!0):(o--,e.VCodeTips=o+"s后可重发 ")},1e3)}else s.showToast(t.message)}):s.showToast("请输入正确的手机号格式"))},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}m=[],e.impressionArr.forEach(function(t){m.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.useExperienceInit=function(t){d.userCommentPage(t).success(function(t){t.success?(e.productObj=t.data.productInfo,e.impressionStr=t.data.impression,e.isCanComment=t.data.status):s.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){g=[],f=!0,l.cancel(e.timer),e.productObj=[],e.impressionStr=[],l.cancel(e.timer),e.wdOrderSn=t.cOrderSn,e.useExperienceInit(e.wdOrderSn),e.setImgCaptchaForPhone(),m=[],e.commentObj={commentTt:""},e.valueAll={value1:5,value2:5,value3:5},e.impressionArr=[],e.impressionStr=[],e.canCommit=!1}),e.$on("$ionicView.beforeLeave",function(){l.cancel(e.timer)})}]),APP.service("useExperienceService",["$http","UrlService",function(e,t){this.getImgCaptchaNew=function(){return t.getUrl("GET_IMG_CAPTCHA_NEW")},this.fastLoginCaptchaNew=function(o,i,s){var n={cOrderSn:o,mobile:i,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA_COMMENT"),params:n})},this.userCommentPage=function(o){var i={cOrderSn:o};return e.get(t.getUrl("USER_COMMENT_PAGE"),i)},this.submitBuyerComment=function(o,i,s,n,a,r){var c={cOrderSn:o,mobile:i,mobileCode:s,userCommentContent:n,imageFile:a,impressions:r};return e({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:t.getUrl("SUBMIT_BUYER_COMMENT"),transformRequest:function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:c})}}]),APP.controller("AllCircleController",["HomePageService","$scope","$rootScope","$state","$ionicScrollDelegate","$ionicPopup","PopupService","AllCircleService","$ionicSlideBoxDelegate","$timeout","UserService","$ionicModal",function(e,t,o,i,s,n,a,r,c,l,d,u){t.isDisplay=!1,t.moreTag=!1,t.hasmore=!0,o.toFilterCode="",t.scrollMainTop=function(){s.$getByHandle("allMainScroll").scrollTop([!0])},t.searchTag={searchKey:"",tagSearch:"",pageIndex:1,pageSize:10},t.tagsName=[],t.circleList="",t.search=function(e){},t.goBack=function(){t.$ionicGoBack()},t.inPersonalPage=function(e){i.go("personalHomepageHe",{othersId:e})},t.goShop=function(){i.go("myStore",{storeId:t.userId,shareStoreId:""})},t.toFilterTagSearch=function(){o.toFilterCode=1,i.go("qSearchBiao")},t.isClick=function(){t.isDisplay=!t.isDisplay},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&s.scrollTop(),s.resize()},t.jumpMsgCenter=function(){i.go("ClassifyMessageCenter")},t.getCircleLists=function(){t.pageNum=1;var e={pageIndex:t.pageNum,pageSize:10,tagIds:""};r.filterCircle(e).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList}).error(function(){})},t.tagsFilter=function(e,o,i){if(t.moreTag=!1,t.pageNum=1,t.searchId=e,1==i)t.tagsName[o].isChecked=!1,t.init(),s.$getByHandle("allMainScroll").scrollTop();else{angular.forEach(t.tagsName,function(e){e.isChecked=!1}),t.tagsName[o].isChecked=!0;var n={pageIndex:1,pageSize:5,tagIds:e};r.filterCircle(n).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList,s.$getByHandle("allMainScroll").scrollTop()}).error(function(){})}},t.toCirclePage=function(e){i.go("circlePage",{circleId:e})},t.toApplyCircle=function(e){t.showNum=e,r.existApplyingCircle().success(function(e){e.success?(i.go("applyCircle"),delete o.reviewCircleId):t.applyCircleModal.show()}).error(function(){})},t.getTags=function(){var e={topicId:"",noLoading:!0};r.getTags(e).success(function(e){t.tagsName=e.data.list})},t.joinCircle=function(s){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:s.id}),o.gio.track("active",{circleID:s.id})),t.itemTopicName=s.topicName;var n={ids:s.id,noLoading:!0};r.joinTopic(n).success(function(e){1==e.success?(s.isJoin=1,1==e.success?(t.inCircle=!0,l(function(){t.inCircle=!1},1e3)):a.showToast(e.message)):-2e3==e.errorCode&&(a.showToast(e.message),o.loginIsAccord2=!0)})}})},t.loadMore=function(){t.pageNum+=1;var e={tagIds:t.searchId?t.searchId:"",pageIndex:t.pageNum,pageSize:5};r.getTopicList(e).success(function(e){e.data.list.topicList&&0!=e.data.list.topicList.length?l(function(){t.totalCount=e.totalCount,t.circleList=t.circleList.concat(e.data.list.topicList),t.$broadcast("scroll.infiniteScrollComplete");var o=t.circleList.length;t.hasmore=!(o==e.totalCount),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.hideApplyCircleModal=function(){t.applyCircleModal.hide()},t.getTitleList=function(){r.getTopicTitleList().success(function(e){if(e.success){t.titleList=e.data.list,t.itemTopicList(t.titleList[0].id,0);for(var o=0;o<t.titleList.length;o++)t.titleList[o].className=""}})},t.itemTopicList=function(e,o){var i={categoryId:e};r.getTopicSecondList(i).success(function(e){if(e.success){for(var i=0;i<t.titleList.length;i++)t.titleList[i].className="";t.titleList[o].className="bac",t.secondList=e.data.list}})},t.init=function(){t.titleList=[],t.secondList=[],t.userId=d.getUser().mid,u.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.applyCircleModal=e}),t.pageNum=0,t.getTitleList(),t.getCircleLists(),t.getTags(),t.searchId="",t.moreTag=!1,t.isDisplay=!1,t.hasmore=!0,t.circleList=[],s.$getByHandle("allMainScroll").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||($("ion-header-bar").show(),t.init())})}]),APP.service("AllCircleService",["$http","UrlService",function(e,t){this.getUserMessageCount=function(){return e.post(t.getUrl("GETUSERMESSAGECOUNT"))},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.getTopicTitleList=function(){return e.get(t.getUrl("CIRCLE_GET_CIRCLE_LIST"))},this.getTopicSecondList=function(o){return e.get(t.getUrl("CIRCLE_GET_SECONDLIST"),o)},this.getTopicList=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.filterCircle=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.existApplyingCircle=function(o){return e({method:"POST",url:t.getUrl("EXIST_APPLY_TOPIC"),data:o})}}]),APP.controller("AllMembersController",["$scope","$state","$stateParams","AllMembersService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,i,s,n,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.noDisplay=function(){e.isDisplay=!1},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.goBack=function(){t.go("circlePage",{circleId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(o){e.isDisplay=!1,t.go("personalHomepageHe",{othersId:o})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.isClick=function(){e.isDisplay?e.isDisplay=!1:e.isDisplay=!0},e.toSetAdmin=function(){"true"==e.isHost||"true"==e.superAdmin?t.go("CircleSetAdmin",{topicId:e.topicId}):(e.isDisplay=!1,n.showToast("您不是圈主，不能进行此操作"))},e.toManageUser=function(){"true"==e.isAdmin||"true"==e.isHost||"true"==e.superAdmin?t.go("manageUser",{topicId:e.topicId}):(e.isDisplay=!1,n.showToast("您不是圈主或管理员，不能进行此操作"))},e.init=function(){e.isDisplay=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.hasmore=!1;var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},i.getuserlist(t).success(function(t){e.isAdmin=t.data.ifAdmin,e.isHost=t.data.ifHost,e.superAdmin=t.data.isManager,e.mainuserlist=t.data.list1,e.mainuser2list=t.data.list2,e.userNum=t.totalCount,e.userlist=t.data.list,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.mainuserlist=t.data.list1,e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list),e.$broadcast("scroll.infiniteScrollComplete");var o=e.userlist.length;e.hasmore=!(o===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("AllMembersService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)}}]),APP.factory("anchorScroll",function(){function e(e,o,i){var s=$(window).height();e=$(e),i=i>0?i:s/10,$("html, body").animate({scrollTop:o?e.offset().top-i:e.offset().top+e.outerHeight()+i-s},{duration:200,easing:"linear",complete:function(){t(e)||e[0].scrollIntoView(!!o)}})}function t(e){function t(e){return e>a&&e<r}e=$(e);var o=$(window),i=o.height(),s=e.offset().top,n=e.outerHeight(),a=o.scrollTop(),r=a+i;return!!t(s+(n>i?i:n)/2)||n>i&&t(s+n-i/2)}return{toView:e,inView:t}}),APP.controller("ApplyCircleController",["$scope","$rootScope","$state","ApplyCircleService","PopupService","$ionicActionSheet","$timeout","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$ionicModal","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,c){e.userPicUrl="",e.bigPicUrl="",t.storeId=[],t.nameStringToObj=[],t.addedTags=[],e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:2,topicId:""},e.init=function(){1==t.showApplyTag?e.showApplyBtn=!1:e.showApplyBtn=!0,d.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyCircleModal=t}),1==t.ifInit?(e.tagsName=t.allNames,t.ifInit=2):(e.topicId="",e.auditRefuseStatus="",t.allNames="",t.addedTags=[],t.nameStringToObj=[],t.frequentTags="",e.tagsName="",t.reviewCircleId&&(e.reviewApplyCircle(),e.getTags()),e.auditOpinion="",c.resize())},e.goBack=function(){e.$ionicGoBack(),t.showApplyTag="",delete t.reviewCircleId},e.warnDelete=function(o){e.isDisplay=!1;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除草稿吗？</div>',title:"删除草稿",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.deleteDraftCircle()}},{text:"放弃"}]});a(function(){},3e3)},e.hideApplyCircleModal=function(){e.applyCircleModal.hide()},e.openStatus=function(t){e.auditOpinion[t].open_status=!e.auditOpinion[t].open_status},e.jumpSelect=function(){o.go("selectTags")},e.deleteDraftCircle=function(){var o={id:t.reviewCircleId};i.delectDraft(o).success(function(o){o.success&&(delete t.reviewCircleId,e.$ionicGoBack())})},e.imgPush=function(t){n.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function s(t){e.userPicUrl=t,a(function(){e.existPhoto=!0},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.userPicUrl,encodeURI(i.uploadImage()),o,s,n)}function n(){}function c(t){e.userPicUrl=t,e.existPhoto=!0,a(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.userPicUrl,encodeURI(i.uploadImage()),o,s,n)}return 0==t?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(c,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.imgBigPush=function(t){n.show({buttons:[{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function s(t){e.applyData.topicBgImg="",e.bigPicUrl=t,e.existPhoto=!0,a(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicBgImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.bigPicUrl,encodeURI(i.uploadImage()),o,s,n)}if(0==t)return navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:640,targetHeight:180}),!0}})},e.deleteTags=function(e){t.addedTags.splice(e,1)},e.deleteFrequentTags=function(e,o){for(var i=0;i<t.frequentTags.length;i++)t.frequentTags[i].name==o&&(t.frequentTags[i].isChecked=!1);t.storeNames.splice(e,1),t.storeId.splice(e,1),t.nameStringToObj.splice(e,1)},e.commitData=function(){var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};i.judgeWords(o).success(function(n){if("没有敏感词"==n.message){var r=e.applyData;r.tagIds=t.storeId.toString(),e.pushTags=[];for(var c=0;c<t.addedTags.length;c++)e.pushTags.push(t.addedTags[c].name);r.tagNames=e.pushTags.toString(),3==e.darftStatus?(r.auditStatus=2,i.storageDraft(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})):t.reviewCircleId?i.refuseStorage(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){}):i.applyCircleInfo(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})}else s.showToast("存在敏感词"+n.data)}).error(function(){})},e.applyTopicNotice=function(){l.show({template:"<p>确认提交圈子申请吗？</p>",title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>提交</span>",type:"",onTap:function(){e.commitData()}}]});a(function(){},3e3)},e.applyTopic=function(o){e.userPicUrl?""==e.applyData.topicImg?s.showToast("图片正在上传，请稍后再试"):e.bigPicUrl&&""==e.applyData.topicBgImg?s.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?s.showToast("申请理由不能少于20字"):t.nameStringToObj.length+t.addedTags.length<3?s.showToast("选择标签不能少于三个"):e.applyTopicNotice():s.showToast("请输入圈子申请理由"):s.showToast("请输入圈子介绍"):s.showToast("请输入圈子名称"):s.showToast("亲，你没有设置背景图哦"):s.showToast("亲，你没有设置头像哦"):e.bigPicUrl&&""==e.applyData.topicBgImg?s.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?s.showToast("申请理由不能少于20字"):e.applyTopicNotice():s.showToast("请输入圈子申请理由"):s.showToast("请输入圈子介绍"):s.showToast("请输入圈子名称"):s.showToast("亲，你没有设置背景图哦"):s.showToast("亲，你没有设置头像哦")},e.$on("$ionicView.beforeEnter",function(o,i){"back"===i.direction?e.init():(e.init(),e.userPicUrl="",e.bigPicUrl="",e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:e.topicId?3:2,topicId:t.reviewCircleId?t.reviewCircleId:""})}),e.reviewApplyCircle=function(){var o={topicId:t.reviewCircleId};i.reviewEditApply(o).success(function(t){e.darftStatus=t.data.list.auditStatus,e.topicId=t.data.list.id,e.auditRefuseStatus=t.data.list.auditStatus,e.applyData.topicImg=t.data.list.topicImg,e.applyData.topicBgImg=t.data.list.topicBgImg,e.bigPicUrl=t.data.list.topicBgImg,e.userPicUrl=t.data.list.topicImg,e.applyData.topicName=t.data.list.topicName,e.applyData.topicDescription=t.data.list.topicDescription,e.applyData.topicReason=t.data.list.entryReason,e.auditOpinion=t.data.list.auditHistory,c.resize()}).error(function(){})},e.getTags=function(){var o={id:t.reviewCircleId};i.getTags(o).success(function(o){e.tags=o.data.list;for(var i=0;i<e.tags.length;i++)if(e.tags[i].approval){var s={name:e.tags[i].name};t.addedTags.push(s)}else{var n={name:e.tags[i].name};t.nameStringToObj.push(n)}})},e.storageDraft=function(){if(!(e.applyData.topicImg||e.applyData.topicBgImg||e.applyData.topicName||e.applyData.topicDescription||e.applyData.topicReason||e.applyData.topicReason))return void s.showToast("亲，请至少填一项哦");var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};e.applyData.auditStatus=3,i.judgeWords(o).success(function(o){if("没有敏感词"==o.message){var n=e.applyData;n.tagIds=t.storeId.toString(),e.pushTags=[];for(var r=0;r<t.addedTags.length;r++)e.pushTags.push(t.addedTags[r].name);n.tagNames=e.pushTags.toString(),e.topicId&&3==e.auditRefuseStatus?i.storageDraft(n).success(function(t){0==t.success?s.showToast(t.message):(e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):1==e.auditRefuseStatus?i.refuseStorage(n).success(function(t){0==t.success?s.showToast(t.message):(e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):i.applyCircleInfo(n).success(function(o){0==o.success?s.showToast(o.message):(t.reviewCircleId=o.data,e.auditRefuseStatus=3,e.topicId=o.data,e.applyData.topicId=o.data,e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){})}else s.showToast("存在敏感词"+o.data)}).error(function(){})}}]),APP.service("ApplyCircleService",["$http","UrlService",function(e,t){this.applyCircleInfo=function(o){return e({method:"POST",url:t.getUrl("APPLY_TOPIC"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})},this.reviewEditApply=function(o){return e({method:"POST",url:t.getUrl("REVIEW_APPLY_TOPIC"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.storageDraft=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_DRAFT"),data:o})},this.delectDraft=function(o){return e({method:"POST",url:t.getUrl("DELETE_APPLY_TOPIC_DRAFT"),data:o})},this.refuseStorage=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_REFUSE"),data:o})}}]),APP.controller("CircleGroupDiscussController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService","$q","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId=tlz55&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},I,$)}function S(e){alert("得到图片失败")}function I(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.groupMsg="图片文件",o.data.imageUrl=i,o.data.fileType=".jpg",o.data.groupMsgUserId=e.csId,o.data.timeStamp=new Date-0,o.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss");var s={c:"sendGroupMsg",groupId:e.groupId,msg:i,msgType:1,token:e.token};r.sendMsg(s).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(o.data)}else l.showToast("发送消息失败--发送音频后")},function(e){})}function $(e){alert("上传失败")}function w(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function y(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.circleId,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode},e.toShareListPage=function(e){s.go("shareListPage",{sl:e})};var T=c.getUser();e.groupId,e.chatId=e.groupId,e.row=0,e.token=c.getUser().sessionValue,e.isClick=function(t){t?e.isDisplay=!e.isDisplay:s.go("discussionGroup",{groupId:e.groupId,circleId:e.circleId})},e.toMemberList=function(){s.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.isSchool=!0,e.sgdMode=2,e.toggleMode=function(t){e.sgdMode=t},e.init=function(){},e.noMoreHistory=!1,e.getMsgByMun=function(){if(!e.noMoreHistory){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};r.getMsgByMun(t).success(function(t){if(t)if(t.rows&&angular.isArray(t.rows)){for(var o=0;o<t.rows.length;o++)r.filtMsg(t.rows[o]);e.messages=t.rows.concat(e.messages),t.rows.length<1e3&&(e.noMoreHistory=!0)}else consoel.warn("sg--getMsgByMun-- response  not array !! ");else l.showToast("获得 讨论组 历史聊天记录 失败")}).finally(function(){e.$broadcast("scroll.refreshComplete")})}},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=f.defer(),o=0==e.messages.length?1:0,i={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token,row:e.row,isSelf:o};return r.getMsg(i).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++)o.data.msgs[i].groupMsg&&(r.filtMsg(o.data.msgs[i]),e.messages.push(o.data.msgs[i]));e.row=o.data.row,t.resolve(1)}else t.reject(1)},function(e){alert(e)}),t.promise},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};e.CustumerParam.msg||l.showToast("发送的消息不能为空"),r.sendMsg(t).then(function(o){if(o){if(o.data&&103==o.data.rt)return void l.showToast("您已经被禁言，请联系管理员");var i={groupMsg:t.msg,groupMsgUserId:e.csId,groupMsgUserName:T.nickName,sendTimes:(new Date).pattern("yyyy-MM-dd hh:mm:ss")};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=""}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.getImg=function(e){u.getPicture(e,v,S)},e.play=function(){var e=document.getElementById("audioInCD");e&&e.play()},
e.pause=function(){var e=document.getElementById("audioInCD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInCD","audioInCD")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),u.stopCapture("sourceInCD","audioInCD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},C,b)};var C=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,i.data.groupMsg="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.groupMsgUserId=e.csId,i.data.timeStamp=new Date-0,i.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss"),e.deleteRecord();var s={c:"sendGroupMsg",groupId:e.groupId,msg:o,msgType:1,token:e.token};r.sendMsg(s).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(i.data)}else l.showToast("发送消息失败--发送音频后");e.loopGetMsg()},function(e){})},b=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");e.isPlaying||n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:A})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.chooseOne=function(e){e.isSelected=!e.isSelected},e.shareToGroup=function(){var t=[];angular.forEach(e.messages,function(e,o){e.isSelected&&t.push(e)});var o="讨论组名称$share"+JSON.stringify(t);s.go("groupsToShare",{shareList:o})},e.deleteGroupMsg=function(){},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o;var n=c.getUser();e.csId=n.mid,e.init(),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",w),window.addEventListener("native.keyboardhide",y),u.addAudioEventOnWindow(),e.groupId=i.groupId,e.circleId=i.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),"back"==s.direction?e.loopGetMsg():(e.messages=[],e.groupId=61,e.loopGetMsg())});var A=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(t,o){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",w),window.removeEventListener("native.keyboardhide",y),e.killTimer()}),e.goBack=function(){e.isPlaying||e.$ionicGoBack()}}]),APP.service("CircleGroupDiscussService",["$http","UrlService","$sce",function(e,t,o){function i(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+s[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+s[t]+'.png" />')}this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.getAllMsg=function(t){return e({method:"POST",url:"http://123.56.3.136:8181/api/invoke",params:t})},this.getMsgByMun=function(t){return e({method:"POST",url:"http:///123.56.3.136:8180/Service/chatGroup/queryPageGroupMsg",params:t})},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.sendTimes&&(e.timeStamp=new Date(e.sendTimes)-0),e.groupMsg&&e.groupMsg.indexOf("$share")>-1){var t=e.groupMsg.indexOf("$share"),o=e.groupMsg.substring(0,t),s=e.groupMsg.substring(t+6),n=/\\/g;s=s.replace(n,"");var a=JSON.parse(s),r=0;angular.isArray(a)&&(r=a.length);e.shareMsgsList=a,e.fileType="share",e.shareMsgsLength=r,e.from=o}else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.groupMsg;else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.groupMsg;else if(e.groupMsg.indexOf("[")>-1&&e.groupMsg.indexOf("]")>-1)for(var c=1;c<16;c++)e.groupMsg=i(e.groupMsg,c)};var s=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];new Date,new Date("2014-8-4 10:21:12")}]),APP.directive("resizeFootBarcd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-cd"),n=e.$getByHandle("cdScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]);var sm={groupMsg:'飞机飞啊飞哇$share[{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav\\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:22\\",\\"isSelected\\":true},{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav\\",\\"groupMsgUserId\\":1383068791,\\"groupMsgUserName\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:23\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 \\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:24\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"aaf啊积极饿哇 啊发\\",\\"groupMsgUserId\\":1234,\\"groupMsgUser\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:25\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png\\",\\"groupMsgUserId\\":1234,\\"groupMsgUserName\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:26\\",\\"isSelected\\":true}]'};Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},o={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+o[this.getDay()+""]));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var historyMsg={total:0,core:"10000",rows:[{groupId:61,companyId:138306984,groupMsg:"test1111",sendTimes:"2017-02-28 14:49:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:50:15",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:51:58",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 15:00:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test2223",sendTimes:"2017-02-28 16:27:12",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:29:49",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:30:05",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"}],footer:[]};APP.controller("CirclePageController",["HomePageService","$scope","$rootScope","$state","$stateParams","CirclePageService","$ionicScrollDelegate","NoteDetailsService","UrlService","PopupService","$ionicModal","ionicDatePicker2","ionicTimePicker","$timeout","UserService","$ionicPopup","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}t.isDisplay=!1,t.showList=!1,t.moreTag=!1,t.hasmore=!0,t.showTopBtn=!1,t.contentNum={contentNum:""},t.topicId,t.topData,t.listData=[],t.circleId,t.tagsName,t.showShare=!1,t.topicid="",t.allowPub=!0,t.topicSummary,t.signSuccess=!1,t.init=function(){o.mediaurl="",o.mediaImg="",t.userId=m.getUser().mid,t.phoneHeight=document.documentElement.clientHeight/2,t.showQQ=!1,t.isDisplay=!1,t.showList=!1,t.showWeChat=!1,t.showShare=!1,t.timeWidget={hour:"",minute:""},t.timeWidget2={hour:"",minute:""},window.cordova?t.ifInApp=!1:t.ifInApp=!0,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),t.moreTag=!1,t.ifDownload=!0,t.pageIndex=1,t.hasmore=!0,t.listData=[],t.getTags(),t.getListMsg(),t.getTopicSummary(),t.getCircleMembers(),a.$getByHandle("mainScroll").scrollTop(),t.stateIfOpen={},t.applyDiscussionData={topicId:"",entryReason:"",startDate:"",startHour:"",startMin:"",endDate:"",endHour:"",endMin:""},t.personType={isAdmin:!1},window.cordova?t.openFromBrowser=!0:t.openFromBrowser=!1},t.NumberCheck=function(e){/^\d*$/.test(e)||(isNaN(parseInt(e))?t.contentNum.contentNum=0:t.contentNum.contentNum=parseInt(e))},t.goBack=function(){t.$ionicGoBack()},t.isClick=function(){t.isDisplay=!t.isDisplay},t.goshare=function(){if(!m.getUser().mid)return void i.go("login");t.showShare=!t.showShare},t.isClick=function(){t.isDisplay=!t.isDisplay},t.showCameraList=function(){if(window.cordova&&(o.gio.track("createTopic",{circleID:t.circleId}),o.gio.track("active",{circleID:t.circleId})),t.topicSummary.isJoin){var e={topicId:t.circleId};n.circleSpeak(e).success(function(e){e.success?0==e.data.isGap&&(t.showList=!t.showList):-2e3==e.errorCode?(l.showToast(e.message),o.loginIsAccord2=!0):l.showToast("您已被禁言，不能发话题")})}else{f.show({template:"<p>亲，先加入我们再秀话题吧。</p>",title:"退出圈子",subTitle:"Please use normal things",scope:t,buttons:[{text:"<span>加入</span>",type:"",onTap:function(){t.joinCircle()}},{text:"再想想"}]});g(function(){},3e3)}},t.jumpPublishCircle=function(){i.go("publishCircle")},t.goShop=function(){i.go("myStore",{storeId:t.userId,shareStoreId:""})},t.closeDownload=function(){t.ifDownload=!1},t.jumpMsg=function(){i.go("ClassifyMessageCenter")},t.inPersonalPage=function(e){i.go("personalHomepageHe",{othersId:e})},t.toNoteDetails=function(e,o,s){t.noteIndex=s,i.go("noteDetails",{noteId:e,isShortStory:o})},t.hideList=function(){t.showList=!1},t.scrollToTop=function(){a.$getByHandle("mainScroll").scrollTop(!0),t.showTopBtn=!1},t.getScrollHeight=function(){t.scrollHeight=Math.abs(document.getElementById(t.topicSummary.topicName).getBoundingClientRect().top),t.scrollHeight>3*t.phoneHeight?t.showTopBtn=!0:t.showTopBtn=!1},t.jumpPhoto=function(e){t.showList=!1,3!=e?i.go("publishCircle",{identifierCode:"",topicId:t.circleId,topicStyle:e}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(s){i.go("publishCircle",{identifierCode:"",topicId:t.circleId,topicStyle:e});var n=JSON.parse(s),a=n.videoFile,r=n.imageFile,c=a.replace("\\",""),l=r.replace("\\","");o.mediaurla=c,o.mediaImga=l},function(e){})},t.getTags=function(){var e={id:t.circleId,flag:0};n.getTags(e).success(function(e){t.tagsName=e.data.list})},t.tagsNameList=function(e,o){t.tagsIndex=e,t.tagId=o,t.listData=[],t.pageIndex=1,t.hasmore=!0,t.getListMsg()},t.joinCircle=function(){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a={ids:t.circleId};n.joinTopic(a).success(function(e){1==e.success?(t.inCircle=!0,g(function(){t.inCircle=!1},1e3),t.topicSummary.isJoin=!0,t.getCircleMembers(),t.getTopicSummary()):l.showToast(e.message)})}}),window.cordova&&(o.gio.track("follow",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a={ids:t.circleId};n.joinTopic(a).success(function(e){1==e.success?(t.inCircle=!0,g(function(){t.inCircle=!1},1e3),t.topicSummary.isJoin=!0,t.getCircleMembers(),t.getTopicSummary()):-2e3==e.errorCode&&(l.showToast(e.message),o.loginIsAccord2=!0)})},t.signIn=function(){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else if(t.topicSummary.isJoin){var s={topicId:t.circleId,userId:t.userId,signType:2};n.circleSignIn(s).success(function(e){if(e.success){t.signInfoData=e.data;var o=f.show({template:"<div class='sign-box' flex='main:center'>\n                              <div ng-click=\"closeSign()\" class='sign-close' flex='main:right'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                              <div class='sign-bg'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_background.png\" style='width:100%;' alt=\"\" /></div>\n                              <div class='sign-content'>\n                                <div class='sign-title' flex='main:center cross:center'>\n                                  <div class='sign-icon' flex='cross:center'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                                  <div class='title-text'>签到排名<span>{{signInfoData.rank}}</span></div>\n                                </div>\n                                <p ng-if='signInfoData.golds>0'>获得<span class='sign-num'>{{signInfoData.golds}}</span>金币</p>\n                                <p ng-if='signInfoData.signRules'>连续签到<span class='sign-num'>{{signInfoData.signRules.continuitySign}}</span>天即可获取<span class='sign-num'>{{signInfoData.signRules.golds}}</span>金币</p>\n                              </div>\n                              <div class='sign-foot' ng-click='goSignInChart(circleId)'>签到排行榜</div>\n                            </div>",cssClass:"signPopup",scope:t});t.closeSign=function(){o.close(),t.getTopicSummary()},t.goSignInChart=function(e){o.close(),i.go("signInChart",{topicId:e})}}else l.showToast(e.message)})}else l.showToast("请先加入圈子")})},t.signDate=function(e,t,o){i.go("signDate",{userId:e,topicId:t,monthFlag:o})},t.jumpAllMembers=function(e){i.go("allMembers",{topicId:e})},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&a.scrollTop(),a.resize()},t.getCircleMembers=function(){var e={topicId:t.circleId};n.circleMembers(e).success(function(e){e.success&&(t.members=e.data.list,t.membersHead=e.data.list1[0])})},t.getTopicSummary=function(){var e={topicId:t.circleId};n.getCircleInfo(e).success(function(e){t.topicSummary=e.data.list[0],n.topicName=t.topicSummary.topicName,0==t.topicSummary.allowPubStory?t.allowPub=!1:1==t.topicSummary.allowPubStory&&(t.allowPub=!0),t.topicid=e.data.list.id,t.minNum=t.topicSummary.capacity;var o=t.topicSummary.dateNow.split("-"),i=Number(o[0]),s=Number(o[1]),a=Number(o[2]);t.signSucDate={signYear:i,signMonth:s,signDay:a},n.signSuccessDate=t.signSucDate})},t.extendContent=function(){if(t.contentNum.contentNum<=t.minNum)t.biggerThanFive=!0,g(function(){t.biggerThanFive=!1},3e3);else if(t.contentNum.contentNum>2e3)t.biggerThanTwoThousand=!0,g(function(){t.biggerThanTwoThousand=!1},3e3);else{var e={topicId:t.circleId,entryCapacity:t.contentNum.contentNum};n.extendContent(e).success(function(e){e.success?(t.hideBigerModal(),t.contentNum.contentNum="",o.applyBottomNotice=!0,t.isDisplay=!1,g(function(){o.applyBottomNotice=!1},3e3)):l.showToast(e.message)})}},t.noticeDownload=function(){o.downAppUrl||l.showToast("不支持该手机")},t.applyDiscussion=function(){var e=t.applyDiscussionData;e.topicId=t.circleId,n.applyDiscuss(e).success(function(e){1==e.success?(l.showToast(e.message),t.hideModal(),t.applyDiscussionData.endHour="",t.applyDiscussionData.endMin="",t.applyDiscussionData.startHour="",t.applyDiscussionData.startMin=""):l.showToast(e.message)}).error(function(){})},t.stateDiscussion=function(){var e={topicId:t.circleId};n.discussionState(e).success(function(e){1==e.success?(t.stateIfOpen=e.data,t.stateIfOpen.isAdmin=!0):l.showToast("获取讨论组 服务器异常")}).error(function(){l.showToast("获取讨论组 相关信息失败")})},t.toChat=function(){var e=t.circleId,o=t.stateIfOpen.groupId;if(!e||!o)return void l.showToast("缺少讨论组参数，错误");i.go("circleGroupDiscuss",{circleId:e,groupId:o})},t.loadMoreMsg=function(){t.pageIndex+=1;var e=v("loginId"),o=window.navigator.userAgent.toLowerCase(),i="micromessenger"==o.match(/MicroMessenger/i),s={pageIndex:t.pageIndex,pageSize:5,topicId:t.circleId,tagId:t.tagId,noLoading:!0,userCode:i?t.weChatOpenId:e};n.getCircleList(s).success(function(e){if(e.data.list&&0!=e.data.list.length){t.listData=t.listData.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete");var o=t.listData.length;t.hasmore=!(o===e.data.storeItemsCounts)}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,l.showToast("没有更多消息了")}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.loadTopicStory=function(){n.getTopStory(topData).success(function(e){})},t.showModal=function(){d.fromTemplateUrl("templates/quanzi/selectModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.selectModal=e,t.selectModal.show()})},t.hideModal=function(){t.selectModal.hide()},t.showBigerModal=function(){d.fromTemplateUrl("templates/quanzi/biggerModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.biggerModal=e,t.biggerModal.show()}),t.isDisplay=!1},t.hideBigerModal=function(){t.biggerModal.hide()},t.getListMsg=function(){var e=v("loginId"),o=window.navigator.userAgent.toLowerCase(),i="micromessenger"==o.match(/MicroMessenger/i);t.listMsg={pageIndex:1,pageSize:5,topicId:t.circleId,tagId:t.tagId,userCode:i?t.weChatOpenId:e},n.getCircleList(t.listMsg).success(function(e){t.listData=e.data.list,t.whichPersonType(),t.stateDiscussion()}).error(function(){})},t.whichPersonType=function(){var e={topicId:t.circleId,noLoading:!0};r.getPersonType(e).success(function(e){1==e.success&&(t.personType={isAdmin:e.data.isAdmin})})},t.topicPraise=function(e,i){window.cordova&&(o.gio.track("like",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a=v("loginId"),r=window.navigator.userAgent.toLowerCase(),c="micromessenger"==r.match(/MicroMessenger/i),d={id:e,noLoading:!0,userCode:c?t.weChatOpenId:a};n.pushPraise(d).success(function(e){1==e.success?1==t.listData[i].praiseFlag?(t.listData[i].praiseNumber=t.listData[i].praiseNumber-1,t.listData[i].praiseFlag=!t.listData[i].praiseFlag):(t.listData[i].praiseNumber=t.listData[i].praiseNumber+1,t.listData[i].praiseFlag=!t.listData[i].praiseFlag):g(function(){l.showToast(e.message)},200)})},t.topicFavorite=function(s,a){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{var r={id:s};n.topicFavorite(r).success(function(e){1==e.success?1==t.listData[a].collectionFlag?(t.listData[a].collectionNumber=t.listData[a].collectionNumber-1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):(t.listData[a].collectionNumber=t.listData[a].collectionNumber+1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):g(function(){l.showToast(e.message)},200)})}});var r={id:s};n.topicFavorite(r).success(function(e){1==e.success?1==t.listData[a].collectionFlag?(t.listData[a].collectionNumber=t.listData[a].collectionNumber-1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):(t.listData[a].collectionNumber=t.listData[a].collectionNumber+1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):-2e3==e.errorCode&&(l.showToast(e.message),o.loginIsAccord2=!0)})},t.shareToStore=function(){var e={flag:0,topicId:t.circleId};r.shareStore(e).success(function(e){e.success})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){l.showToastShort("复制成功")},200)):l.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o="邀请您关注"+t.topicSummary.topicName+"圈子",i="欢迎关注"+t.topicSummary.topicName+"圈子，与"+t.topicSummary.topicName+"微店主同城交流互动。",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=c.getShareLinkHeader()+"circlePage/"+t.circleId;t.circleId;window.umeng?0==e?window.umeng.shareToSina(o,i,s,n,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,n,0,null,h.shareSuccessCallback),h.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,n,0,null,h.shareSuccessCallback),h.qqShare()):5==e?t.copeText(n):h.successShare():alert("umeng undefined 只能在app分享"),t.showShare=!1,t.shareToStore()},t.dateOne="开始时间",t.dateTwo="结束时间",t.a=1,t.b=1,t.firstDatePicker=function(){var e={callback:function(e){t.dateOne=e,t.applyDiscussionData.startDate=e,t.a=2},to:new Date(t.dateTwo)};u.openDatePicker(e)},t.secondDatePicker=function(){var e={callback:function(e){t.dateTwo=e,t.applyDiscussionData.endDate=e,t.b=2},from:new Date(t.dateOne)};u.openDatePicker(e)},t.oneTimePicker=function(){var e={callback:function(e){var o=new Date(1e3*e);t.applyDiscussionData.startHour=("00"+o.getUTCHours()).substr(o.getUTCHours().toString().length),t.applyDiscussionData.startMin=("00"+o.getUTCMinutes()).substr(o.getUTCMinutes().toString().length)}};p.openTimePicker(e)},t.twoTimePicker=function(){var e={callback:function(e){var o=new Date(1e3*e);t.applyDiscussionData.endHour=("00"+o.getUTCHours()).substr(o.getUTCHours().toString().length),t.applyDiscussionData.endMin=("00"+o.getUTCMinutes()).substr(o.getUTCMinutes().toString().length)}};p.openTimePicker(e)},t.exitTopicNotice=function(){f.show({template:"<p>亲，忍心离开我们圈子了吗？</p>",title:"退出圈子",subTitle:"Please use normal things",scope:t,buttons:[{text:"<span>退出</span>",type:"",onTap:function(){t.exitTopic()}},{text:"再想想"}]});g(function(){},3e3)},t.exitTopic=function(){var e={topicId:t.circleId};n.exitTopic(e).success(function(e){e.success?(t.isDisplay=!1,t.isDisplay=!1,t.outawayCircle=!0,t.showList=!1,g(function(){t.outawayCircle=!1},1e3),t.topicSummary.isJoin=!1,t.getCircleMembers(),t.getTopicSummary()):(t.isDisplay=!1,l.showToast(e.message))}).error(function(){l.showToast(response.message)})},t.wechatOpenId=function(){r.getWeChatOpenId().success(function(e){e.success&&(e.data?(t.weChatOpenId=e.data,r.weChatOpenId=e.data,t.init()):t.wechatUrlOpenId())})},t.wechatUrlOpenId=function(){var e=$location.absUrl();r.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},t.$on("$ionicView.beforeEnter",function(e,i){t.circleId=s.circleId,t.tagId=null,t.tagsIndex=0,o.ifDeleteNoteList&&(t.listData.splice(t.noteIndex,1),o.ifDeleteNoteList=!1),"back"==i.direction?t.getTopicSummary():(window.cordova&&o.gio.track("circleEntry",{circleID:t.circleId}),$("ion-header-bar").show()),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?t.wechatOpenId():"back"==i.direction||t.init()}),t.$on("$stateChangeSuccess",function(e,i,s,n,a){o.fromState=n.name,o.toState=i.name,"publishCircle"==o.fromState&&t.init()})}]),APP.service("CirclePageService",["$http","UrlService",function(e,t){this.getCircleInfo=function(o){return e({method:"POST",url:t.getUrl("TOPIC_INFO"),data:o})},this.topicName="",this.shareinfor=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.circleMembers=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCODE"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.getTopStory=function(o){return e({method:"POST",url:t.getUrl("TOP_STORY"),data:o})},this.circleSpeak=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SPEAK"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.extendContent=function(o){return e({method:"POST",url:t.getUrl("ENLARGE_CONTENT"),data:o})},this.applyDiscuss=function(o){return e({method:"POST",url:t.getUrl("ENTRYFORUM"),data:o})},this.discussionState=function(o){return e({method:"POST",url:t.getUrl("DISCUSSION_STATE"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.getCircleList=function(o){return e({method:"POST",url:t.getUrl("LIST"),data:o})},this.exitTopic=function(o){return e({method:"POST",url:t.getUrl("EXIT_TOPIC"),data:o})},this.circleSignIn=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGNIN"),data:o})},this.signSuccessDate=""}]),APP.controller("CircleSetAdminController",["$scope","$state","$stateParams","CircleSetAdminService","$ionicScrollDelegate","PopupService",function(e,t,o,i,s,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.addAdmin=function(o){t.go("selectAdmin",{topicId:e.topicId})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.decAdmin=function(t){var o={topicId:e.topicId,userCode:t,indentityStatus:0};i.setAdmin(o).success(function(t){t.success&&e.getCircleUser()}).error(function(){})},e.getCircleUser=function(){var t={topicId:e.topicId};i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2}).error(function(){})},e.init=function(){e.pageIndex=1,e.input={isinput:""},e.getCircleUser()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("CircleSetAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("CIRCLE_CIRCLEPERSON"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,o,i){function s(){var e=t.html();o.stripBr&&"<br>"===e&&(e=""),i.$setViewValue(e)}i&&(i.$render=function(){t.html(i.$viewValue||"")},t.on("blur keyup change",function(){e.$apply(s)}))}}}),APP.controller("ClassNoteDetailsController",["$scope","$rootScope","$ionicModal","$state","$stateParams","$ionicLoading","$http","PlatformService","ClassNoteDetailsService","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","TopicdetailsService","$timeout","$ionicActionSheet","PopupService","$timeout","UrlService","NoteDetailsService","UserService","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,g,h,v,S,I){e.isDisplay=!1,e.inputShow=!0,e.praiseNum={},e.commentId="",e.circleId,e.circleDetail,e.commentList,e.commentWords={words:""},e.pinglunis=!1,e.topicheight=0,e.comment={text:"",rows:1},e.noteDetail={reply:"说点什么"},e.$watch("noteDetail.reply",function(e,t,o){}),e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,e.isImage=!1,e.showBigImg=!1,e.imgString="",e.isPublishImage=!1,e.imgA=[],e.showBigBac=!1,e.goBack=function(){e.$ionicGoBack(),t.nextPageBefore="classNoteDetails"},e.goshare=function(){if(!S.getUser().mid)return void i.go("login");e.showShare=!e.showShare,e.isDisplay=!1},e.goToScore=function(t){if($(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),"linklink"==t.target.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("all-to"==t.target.className)if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("atopic"==t.target.className){if(t.target.attributes["data-a"]){var o=t.target.attributes["data-a"].value;e.tolink(o)}else if(t.target.attributes.dataa){var o=t.target.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.className){if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.attributes.dataa){var o=t.target.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.parentNode.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.parentNode.attributes.dataa){var o=t.target.parentNode.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}},e.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},e.goShop=function(){i.go("myStore",{storeId:e.userId,shareStoreId:""})},e.noticeDownload=function(){t.downAppUrl||f.showToast("不支持该手机")},
e.jumpMsg=function(){i.go("ClassifyMessageCenter")},e.inPersonalPage=function(e){0!=e&&i.go("personalHomepageHe",{othersId:e})},e.isClick=function(){e.isDisplay=!e.isDisplay},e.downLoadPhoto=function(o){e.photoUrl=o,t.isIOS?m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(o,function(e){f.showToast("保存成功")},function(e){f.showToast("保存失败")})}}):m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW");var o=new FileTransfer,i=encodeURI(e.photoUrl);return o.download(i,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存成功")},function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}})},e.productConnect=function(){var t={productId:e.circleDetail.productId,userCode:e.circleDetail.userCode};v.connectProduct(t).success(function(t){e.products=t.data.list})},e.toProductDetail=function(e){i.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},e.editTopic=function(){i.go("publishEdit",{topicId:e.circleId})},e.showCommentView=function(t){e.commentId=t;l.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:e,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){e.insertComments()}}]});g(function(){},3e3)},e.isInputShow=function(){e.inputShow=!e.inputShow},e.pinglunshow=function(){var t=d.$getByHandle("pinglun"),o=t.getScrollPosition(),i=o.top,s=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-s,g(function(){e.pinglunis=i>e.topicheight},200)},e.nocommontId=function(){e.commontId&&(e.commontId="",e.toSomeone="",e.commentWords.words="",e.iconImageData=[])},e.focuss=function(){e.isPublishImage=!0,e.showBac=!0,e.iconImageData.length>0&&(e.isImage=!0)},e.deleteImg=function(t){e.iconImageData.splice(t,1)},e.showLarge=function(t){e.showBigBac=!0,e.showBigImg=!0,e.Url=t},e.closeBigImg=function(){e.showBigImg=!1,e.showBigBac=!1},e.closeImg=function(){e.isImage=!1,e.isPublishImage=!1,e.showBac=!1},e.imgPush=function(t){if(e.isImage=!0,e.iconImageData.length>=9)return void f.showToast("最多添加9张");m.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};g(function(){e.iconImageData.push(o),e.existPhoto=!0},200)}function i(){}if(0==t)return navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var s=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i)}e.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis,e.shuxiaoxi=!e.shuxiaoxi},e.favorite=function(){var t={id:e.circleId,noLoading:!0};c.pushPraise(t).success(function(e){})},e.follow=function(o){if(0==o){var i={id:e.circleDetail.userCode,isFollow:1};c.followNote(i).success(function(o){1==o.success?e.circleDetail.isFolled=1:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}else if(1==o){var i={id:e.circleDetail.userCode,isFollow:0};c.followNote(i).success(function(o){1==o.success?e.circleDetail.isFolled=0:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}},e.getA=function(){g(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},1e3)},e.getCircleDetails=function(){var t={id:e.circleId};c.getCircleDetails(t).success(function(t){e.circleDetail=t.data,e.circleDetail.productId&&e.productConnect()}),e.getA()},e.getComment=function(){var t={pageIndex:1,pageSize:1e4,id:e.circleId};c.getComments(t).success(function(t){e.commentNumbers=t.totalCount,e.commentList=t.data.list,e.imgString="",e.imgA=[];for(var o=0;o<e.commentList.length;o++)e.commentList[o].commentImgs&&(e.imgString=e.commentList[o].commentImgs,e.imgA=e.imgString.split(","),e.commentList[o].imgaa=e.imgA);d.resize()})},e.getFocus=function(t,o){event.stopPropagation(),e.commentWords.words="",e.iconImageData=[],e.isPublishImage=!0,e.showBac=!0,e.commontId=t,e.toSomeone="回复给："+o,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.leaveFocus=function(){e.commontId="",e.toSomeone=""},e.insertComments=function(){var t=0;if(e.commentWords.words){var o={keywords:e.commentWords.words};u.judgeWords(o).success(function(o){"没有敏感词"==o.message?0==e.iconImageData.length?e.publishTopic():angular.forEach(e.iconImageData,function(o,i){var s=function(o){n.hide(),t++;var s=JSON.parse(o.response),a=s.urls;e.imgUrlList[i]=a,t==e.iconImageData.length&&e.publishTopic()},a=function(e){n.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(v.uploadImage()),s,a,r)}):(f.showToast("存在敏感词",o.data),e.commentWords.words="")})}else f.showToast("内容不能为空")},e.publishTopic=function(t){if(e.commontId){var t={comment:e.commentWords.words,commentTo:e.commontId,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}else{var t={comment:e.commentWords.words,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}},e.insertCommentOK=function(t){c.insertComment(t).success(function(t){e.getComment(),1==t.success?(f.showToast("回复成功"),e.commentWords.words="",e.commontId="",e.toSomeone="",e.iconImageData=[],e.imgUrlList=[],e.isImage=!1,e.isPublishImage=!1,e.showBac=!1):(g(function(){f.showToast(t.message)},200),e.commentWords.words="")}).error(function(t){f.showToast("网络异常"),e.commentWords.words=""})},e.topicPraise=function(t){var o={id:t,noLoading:!0};c.pushPraise(o).success(function(t){1==t.success?(e.isPraise=!e.isPraise,e.getStoryPraiseNum(),f.showToast("点赞成功")):f.showToast(t.message)})},e.topicFavorite=function(o){var i={id:o,noLoading:!0};c.topicFavorite(i).success(function(o){1==o.success?(e.isFavorite=!e.isFavorite,e.getStoryPraiseNum(),f.showToast("收藏成功")):-2e3==o.errorCode?(f.showToast(o.message),t.loginIsAccord2=!0):f.showToast(o.message)})},e.commentPraise=function(t,o){var i={commentId:t.id};c.commentPraise(i).success(function(i){1==i.success&&(t.commentPraiseNumberFlag=!t.commentPraiseNumberFlag,e.commentPraiseNum(t,o))})},e.getStoryPraiseNum=function(){var t={id:e.circleId};c.getStoryPraise(t).success(function(t){e.praiseNum=t.data})},e.commentPraiseNum=function(t,o){var i={commentId:t.id};c.commentPraiseNum(i).success(function(t){e.commentList[o].commentPraiseNumber=t.totalCount})},e.deleteStory=function(){var t={storyId:e.circleDetail.id};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("话题删除成功"),i.go("circlePage",{circleId:e.circleDetail.topicId}))})},e.warnDeleteComments=function(o){e.isDisplay=!1,e.deleteId=o;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){e.deleteComment()}}]});g(function(){},3e3)},e.deleteComment=function(){var t={id:e.deleteId};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("删除成功"),e.getComment())})},e.shareToStore=function(){var t={flag:2,storyId:e.circleDetail.id};v.shareStore(t).success(function(e){e.success})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){f.showToastShort("复制成功")},200)):f.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.circleDetail.storyName+"-顺逛微社区",i=e.circleDetail.storyContentText.substr(0,30),s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=h.getShareLinkHeader()+"classNoteDetails/"+e.circleId;window.umeng?(0==t?window.umeng.shareToSina(o,i,s,n,0,null,I.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,I.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,I.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,s,n,0,null,I.shareSuccessCallback),I.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,s,n,0,null,I.shareSuccessCallback),I.qqShare()),5==t?e.copeText(n):I.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1,e.shareToStore()},e.closeDownload=function(){e.ifDownload=!1},e.init=function(){e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,o.fromTemplateUrl("templates/quanzi/biggerPictureModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.biggerPictureModal=t}),e.userId=S.getUser().mid,window.cordova?e.ifInApp=!1:e.ifInApp=!0,e.toSomeone="",e.showQQ=!1,e.ifDownload=!0,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.commentWords={words:""},e.showShare=!1,e.isFavorite=!0,e.isPraise=!0,e.isDisplay=!1,e.circleId=s.noteId,e.ifShort=s.isShortStory,e.personType={isAdmin:!1,isCreateStory:!1},e.getCircleDetails(),e.getComment(),e.getStoryPraiseNum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ClassNoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("GETSTORYINFO"),data:o})},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("CLASS_DELETE_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOLLECTION"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("GETSTORYCOMMENT"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("SUBMITCOMMENT"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GETSTORYPRAISEANDUNREAD"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISENUM"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})}}]),APP.controller("ClassesDetailsController",["$scope","$rootScope","$state","$stateParams","ClassesDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r){e.isClick=0,e.input={input:""},e.classInfo={courseCategory:"",courseName:"",courseStartTime:"",teacher:"",teacherIntroduce:"",forumStartTime:"",forumEndTime:"",courseDescription:"",timeOrder:""},e.membersJoin={courseId:2,createTime:"2017-01-17 11:24:00.0",id:3,type:"2",userCode:"",userImg:"",userName:""},e.teacherList={userName:2,teacherIntroduce:"2017-01-17 11:24:00.0",userImg:3,children:"2",courseName:"",courseId:""},e.messageBoardList={questionId:"",questionContent:"",questionTime:"",questionUserName:"",questionUserCode:"",questionUserImg:"",firstAnswerId:"",firstAnswerContent:"",firstAnswerTime:"",firstAnswerUserName:"",firstAnswerUserCode:"",firstAnswerUserImg:"",firstAnswerIsTeacher:"",answersTotal:"",totalCount:""},e.classesList={},e.topicList={},e.shareList={},e.init=function(){e.ifShowInput=!0,e.getClassInfo(),e.getClassesList(),e.getMessageBoardList(),e.getClassTopicList(),e.studentShare()},e.click0=function(){e.isClick=0},e.click1=function(){e.isClick=1},e.click2=function(){e.isClick=2},e.goBack=function(){e.$ionicGoBack()},e.getClassInfo=function(){var t={courseId:2};s.getClassInfo(t).success(function(t){e.classInfo=t.data.list[0],e.classJoinMember(),e.getTeacherList()})},e.classJoinMember=function(){var t={courseId:2};s.classJoinMember(t).success(function(t){e.membersJoin=t.data.list})},e.getTeacherList=function(){var t={courseId:2};s.getTeacherList(t).success(function(t){e.teacherList=t.data.list})},e.getClassesList=function(){var t={courseId:2};s.getClassesList(t).success(function(t){e.classesList=t.data.list})},e.getClassTopicList=function(){var t={courseId:2};s.getClassTopicList(t).success(function(t){e.topicList=t.data.list})},e.studentShare=function(){var t={courseId:1};s.studentShare(t).success(function(t){e.shareList=t.data.list,r.$getByHandle("mainScroll").resize()})},e.getMessageBoardList=function(){var t={courseId:1,pageSize:5,pageIndex:1};s.getMessageBoardList(t).success(function(t){e.messageBoardList=t.data.list})},e.toQuestionDetail=function(e){o.go("questionDetails",{wordsId:e})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showInput=function(){e.ifShowInput=!e.ifShowInput},e.commitAnswer=function(){var t={wordsContent:e.input.input,courseId:"",parentId:""};s.askQuestion(t).success(function(e){}).error(function(){})}}]),APP.service("ClassesDetailsService",["$http","UrlService",function(e,t){this.getClassInfo=function(o){return e({method:"POST",url:t.getUrl("COURSE_INFO"),data:o})},this.classJoinMember=function(o){return e({method:"POST",url:t.getUrl("COURSE_ALL_MEMBER"),data:o})},this.getTeacherList=function(o){return e({method:"POST",url:t.getUrl("COURSE_TEACH_LIST"),data:o})},this.getClassesList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_LIST"),data:o})},this.getClassTopicList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_TOPIC_LIST"),data:o})},this.studentShare=function(o){return e({method:"POST",url:t.getUrl("STUDENT_SHARE"),data:o})},this.getMessageBoardList=function(o){return e({method:"POST",url:t.getUrl("MESSAGE_BOARD_LIST"),data:o})},this.askQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})}}]),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$q","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(t){e.tempUrl=t;var o=r.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,S)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.imageUrl=i,o.data.fileType=".jpg",o.data.companyId=void 0,o.data.message="图片文件",o.data.companyId=void 0,e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})}function S(e){alert("上传失败")}function I(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function $(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.productObjs=[],e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.isShowRecord=!1,e.tempUrl,e.isOffLine=!1,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.userInCC.mid,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["mid","image"],values:[1111222,333]};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?l.showToast("客服暂时不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.isPlaying||e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=g.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++)r.filtMsg(o.data.msgs[i]),o.data.msgs[i].message&&e.messages.push(o.data.msgs[i]);t.resolve(1)}else t.resolve(1)},function(e){alert(e),t.resolve(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};if(!t.msg)return void l.showToast("发送消息不能为空");r.sendMsg(t).then(function(o){if(o){var i={message:t.msg,companyId:void 0};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(t){var i={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:t,desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(i).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var i={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(i).then(function(e){if(e);o.goBack()},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.transferTo=1,e.transferChat=function(){var t={cmd:"transferChat",c:e.csId,v:e.uuID,chatId:e.chatId,transNum:1,aId:e.transferTo};r.transferChat(t).then(function(t){t&&t.data?"success"==t.data.result?(e.chatId=t.data.chat1,e.csId=e.transferTo):alert("transfer chat  server response error ！！！"):alert("transfer chat  net error ！！！")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(e){u.getPicture(e,f,h)},e.play=function(){var e=document.getElementById("audioInCC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInCC","audioInCC")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),u.stopCapture("sourceInCC","audioInCC",e.transfer)},e.transfer=function(){var t=r.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,i.data.message="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(i.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};r.addEvent(s).then(function(t){t?n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败"),e.loopGetMsg()})},y=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("content");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.sendLink=function(t){var o=JSON.stringify(t),i="$prodLink"+o,s={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:i};if(!s.msg)return void l.showToast("发送消息不能为空");r.sendMsg(s).then(function(t){if(t){var o={message:s.msg,companyId:void 0};r.filtMsg(o),e.messages.push(o),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.isPlaying=!1,"back"==i.direction||(e.productObjs=[],e.init()),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",I),window.addEventListener("native.keyboardhide",$),u.addAudioEventOnWindow()});var T=void 0;e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",I),window.removeEventListener("native.keyboardhide",$)}),e.$on("play-sound-ended",function(t,o){for(var i=0;i<e.messages.length;i++)e.messages[i].imageUrl===o.id.src&&i<e.messages.length-1&&".wav"===e.messages[i+1].fileType&&e.$broadcast("play-sound-next",{id:e.messages[i+1].imageUrl})}),e.goBack=function(){e.isPlaying||e.isOffLine||(e.actSheet=d.show({buttons:[{text:"<b>非常满意</b> "},{text:"<b>比较满意</b> "},{text:"<b>一般</b> "},{text:"<b>不满意</b> "}],titleText:"评价客服",cancelText:"取消",cancel:function(){},buttonClicked:function(t){return e.opinion(t),!0}}))}}]),APP.service("CustomerConversationService",["$http","UrlService","$sce",function(e,t,o){function i(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+n[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+n[t]+'.png" />')}var s="http://123.56.3.136:8182";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke/",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.getUUID=function(){return e.get(s+"/getVistorId.dll")},this.opinion=function(t){return e.get(s+"/msg.dll",t)},this.endChat=function(t){return e.get(s+"/msg.dll",t)},this.transferChat=function(t){return e.get(s+"/msg.dll",t)},this.addEvent=function(t){return e.get(s+"/msg.dll",t)},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.message&&e.message.indexOf("$prodLink")>-1)e.message="已经发送了 商品链接";else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("[")>-1&&e.message.indexOf("]")>-1)for(var t=1;t<16;t++)e.message=i(e.message,t)};var n=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.getUploadUrl=function(){return s+"/receive3.jsp"}}]),APP.directive("resizeFootBar",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content"),n=e.$getByHandle("ccScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),APP.controller("GroupSettingController",["$scope","GroupSettingService","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","UserService","PopupService","CircleGroupDiscussService","$ionicModal","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.isShowName=!0,e.confirmData={groupName:"",groupMax:"0"};var g={userGag:0,userId:"test",userState:"0",userName:"我是路飞",userImg:"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png"},m={userGag:1,userId:"test",userState:"1",userName:"我不是是路飞",userImg:"https://git.oschina.net/uploads/80/436680_xu6767.png"};e.groupId;var f=c.getUser();e.token=f.sessionValue,e.groupUsers=[g,m,g,m,g,m,g,m,g,m,g,m],e.groupDesp={},e.groupSetting={yes:!1,userId:void 0};var h=window.innerWidth;e.jinyanHover={top:"5px",left:.1*h-21-1.5+"px"},e.groupInfo,e.query=function(){var o={groupId:e.groupId,token:e.token};t.query(o).success(function(t){t&&t.userInfo&&(e.groupUsers=t.userInfo)},function(e){alert("查询群组成员失败")})},e.init=function(){e.query(),e.queryGroup()},e.delGroupUser=function(o){var i={userId:o.userId,groupId:e.groupId};t.deleteGroupUser(i).then(function(t){t&&(l.showToast("删除用户成功"),e.query())},function(e){alert("net error--- delGroup  failed")})},e.getAllMsg=function(){var t={c:"getGroupMsg",groupId:e.groupId,token:e.token};d.getAllMsg(t).then(function(t){t&&t.data?e.historyMsgs=t.data.rows:l.showToast("获得讨论组列表失败")},function(e){alert("net error--- delGroup  failed")})},e.getMsgByMun=function(){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};d.getMsgByMun(t).then(function(e){if(e);},function(e){alert("net error--- delGroup  failed")})},u.fromTemplateUrl("templates/quanzi/groupName.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.groupName=t}),e.openName=function(){e.isShowName=!0,e.groupName.show()},e.closeName=function(){e.groupName.hide()},e.openMaxRecord=function(){e.isShowName=!1,e.groupName.show()},e.queryGroup=function(){var o={companyId:f.mid,groupId:e.groupId,token:e.token};t.queryGroup(o).then(function(t){t.data&&t.data.rows&&(e.groupInfo=t.data.rows[0],e.groupDesp=JSON.parse(e.groupInfo.desp))},function(e){alert("net error--- delGroup  failed")})},e.upDateGroup=function(){var o;if(e.confirmData.groupName){var i=JSON.parse(e.groupDesp);o={id:e.groupId,desp:"{}",token:i,groupName:e.confirmData.groupName}}if(e.confirmData.groupMax){if(!angular.isNumber(e.confirmData.groupMax))return void l.showToast("请输入一个秒数");e.groupDesp.timeSet=e.confirmData.groupMax;var i=JSON.parse(e.groupDesp);o={id:e.groupId,desp:i,token:e.token,groupName:e.confirmData.groupName}}if(!o)return void l.showToast("输入不能为空");t.updateGroup(o).then(function(t){t&&(l.showToast("更改讨论组信息成功"),e.queryGroup())},function(e){alert("net error--- addGroupUser  failed")})},e.queryGroupByMemberId=function(){var o={userId:f.mid,token:e.token};t.queryGroupByMemberId(o).then(function(e){},function(e){alert("net error--- addGroupUser  failed")})},e.addGroupUser=function(){e.groupSetting.userId||l.showToast("请输入合法的用户Id");var o={userId:e.groupSetting.userId,groupId:e.groupId};t.updateGroupUser(o).then(function(t){t&&(l.showToast("添加成员成功"),e.query())},function(e){alert("net error--- addGroupUser  failed")})},e.gagGroupUser=function(o){var i;if("null"===o.userGag||"0"===o.userGag)i=1;else{if("1"!=o.userGag)return;i=0}var s={userId:o.userId,userGagType:i,groupId:e.groupId};t.gagGroupUser(s).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.gagAll=function(){var o={groupGagType:e.groupSetting.yes?1:0,groupId:e.groupId};t.getGroupGag(o).then(function(t){t&&(l.showToast("gagAll"),e.query())},function(e){alert("net error--- gagAll  failed")})},e.$on("$ionicView.beforeEnter",function(){e.groupId=p.groupId,e.circleId=p.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),e.init()}),e.tabSelected=!0,e.switchTab=function(){e.tabSelected=!e.tabSelected},e.createGroup=function(){t.createGroup("admin","讨论组名字","讨论组介绍信息").success(function(t){e.groupId=t.groupId})},e.deleteGroup=function(){t.deleteGroup(e.groupId).success(function(e){})},e.toGroupEditMember=function(){n.go("groupEditMember",{groupId:e.groupId})},e.toGroupAddMember=function(){n.go("groupAddMember",{groupId:e.groupId,circleId:e.circleId})}}]),APP.service("GroupSettingService",["$http",function(e){var t="http://123.56.3.136:8180/Service/chatGroup";this.register=function(t){return e.get("http://123.56.3.136:8180/Service/Company/addApi",t)};this.query=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/queryGroupUser",params:t})},this.queryGroup=function(o){return e({method:"POST",url:t+"/queryGroup",params:o})},this.queryGroupByMemberId=function(o){return e({method:"POST",url:t+"/queryChatGroupUserId",params:o})},this.updateGroup=function(o){return e({method:"POST",url:t+"/updateChatGroupDesp",params:o})},this.filtGroup=function(e){};this.deleteGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/deleteGroupUser",params:t})};this.gagGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/getGroupUserGag",params:t})};this.updateGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/updateGroupUser",params:t})};this.getGroupGag=function(t){return e({method:"POST",url:"http://172.16.63.96:8080/console/Service/chatGroup/getGroupGag",params:t})};this.createGroup=function(t,o,i){return e({method:"POST",url:url,params:"http://172.16.63.98:8080/console/Service/chatGroup/getCreateGroupChat"})},this.deleteGroup=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/console/Service/chatGroup/getCloseGroupChat",params:{id:t}})}}]),APP.controller("GroupAddMemberController",["$scope","$stateParams","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","CirclePageService","$q",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.input={keywords:""},e.iconShow=!0,e.members=[],e.groupId=t.groupId;var g=l.getUser();e.token=g.sessionValue,e.circleId=408,e.members=[],e.membersHead=[],e.membersCommon=[],e.membersAdded=[],e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){
for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.getCircleMembers=function(){var t=p.defer(),o={topicId:e.circleId};return u.circleMembers(o).success(function(o){o.success?(e.membersCommon=o.data.list,e.membersHead=o.data.list1,t.resolve(1)):(d.showToast("获取圈子成员失败"),t.reject(1))}),t.promise},e.query=function(){var t={groupId:e.groupId,token:e.token};c.query(t).success(function(t){if(t&&t.userInfo){e.membersAdded=t.userInfo;for(var o=0;o<e.membersHead.length;o++){for(var i=!1,s=e.membersHead[o].memberId,n=0;n<e.membersAdded.length;n++)if(s==e.membersAdded[n].userId){i=!0;break}if(!i){var a={};a.idCate=0,a.imageFile=e.membersHead[o].img,a.nickName=e.membersHead[o].userName,a.userId=e.membersHead[o].memberId,a.userGag="0",a.userState=1,e.members.push(a)}}for(var r=0;r<e.membersCommon.length;r++){for(var c=!1,s=e.membersCommon[r].id,l=0;l<e.membersAdded.length;l++)if(s==e.membersAdded[l].userId){c=!0;break}if(!c){var a={};a.idCate=0,a.imageFile=e.membersCommon[r].userImg,a.nickName=e.membersCommon[r].userName,a.userId=e.membersCommon[r].id,a.userGag="0",a.userState=1,e.members.push(a)}}}},function(e){alert("查询群组成员失败")})},e.$on("$ionicView.beforeEnter",function(){e.members=[],e.groupId=t.groupId,e.circleId=t.circleId,e.getCircleMembers().then(function(){e.query()})}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){for(var t=[],o=0;o<e.members.length;o++)e.members[o].isSelected&&t.push(e.members[o]);for(var i=function(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=i(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=i(e[o]);return t}return e},s=i(t),n=0;n<s.length;n++)delete s[n].$$hashKey,delete s[n].isSelected;var a=JSON.stringify(s),r={groupMembers:a,groupId:e.groupId,token:e.token};c.updateGroupUser(r).then(function(t){t&&(d.showToast("添加成员成功"),e.getCircleMembers().then(function(){e.query()}))},function(e){alert("net error--- add group Members ---failed")})}}]),APP.service("GroupAddMemberService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("GroupEditMemberController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){e.input={keywords:""},e.iconShow=!0;var m=c.getUser();e.token=m.sessionValue,e.groupId=g.groupId,e.query=function(){var t={groupId:e.groupId,token:e.token};e.members=[],r.query(t).success(function(t){t&&t.userInfo&&(e.members=t.userInfo)},function(e){alert("查询群组成员失败")})},e.members=[],e.init=function(){var t=c.getUser();e.token=t.sessionValue,e.query()},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.gagOrNo=function(t){for(var o="",i=0;i<e.members.length;i++)e.members[i].isSelected&&(o=o+e.members[i].userId+",");o=o.substr(0,o.length-1);var s=t,n={userId:o,userGagType:s,groupId:e.groupId,token:e.token};r.gagGroupUser(n).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.$on("$ionicView.beforeEnter",function(){e.groupId=g.groupId,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("GroupsToShareController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupAddMemberService","UserService","PopupService","$ionicActionSheet","MediaService","GroupSettingService","CircleGroupDiscussService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){e.input={keywords:""},e.iconShow=!0,e.members=[],e.shareListStr=void 0,e.isAllSelected=!1,e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t};var m=c.getUser();e.groupId=55,e.token=m.sessionValue,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(e){},e.init=function(){var t=c.getUser();e.token=t.sessionValue;var o={userId:t.mid,token:e.token};p.queryGroupByMemberId(o).then(function(t){if(t&&t.data){for(var o=0;o<t.data.rows.length;o++)try{t.data.rows[o].despObj=JSON.parse(t.data.rows[o].desp)}catch(e){t.data.rows[o].despObj={}}e.members=t.data.rows}else l.showToast("获得讨论组列表失败")})},e.$on("$ionicView.beforeEnter",function(){e.shareListStr=i.shareList,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){var t={groupMembers:'[{"userId":"138307014","idCate":"0","nickName":"cao138307014","imageFile":"www.baidu.com"},{"userId":"138990945","idCate":"0","nickName":"15648756478","imageFile":"www.baidu.com"}]',groupId:e.groupId,token:e.token};r.addMembers(t).then(function(e){e&&l.showToast("添加成员成功")},function(e){alert("net error--- add group Members ---failed")})},e.sendToGroups=function(){for(var t="",o=0;o<e.members.length;o++)e.members[o].isSelected&&(t=t+e.members[o].groupId+",");if(!t)return void alert("no chooesed");t=t.substr(0,t.length-1);var i={c:"sendGroupMsg",groupId:t,msg:e.shareListStr,msgType:1,token:e.token};g.sendMsg(i).then(function(e){e||l.showToast("发送消息失败--发送音频后")},function(e){})}}]),APP.service("GroupsToShareService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("MessageDetailsController",["$scope","$state","$stateParams","SelectTagsService",function(e,t,o,i){}]),APP.service("MessageDetailsService",["$http","UrlService",function(e,t){}]),APP.controller("MyCirclePagesController",["$scope","$rootScope","$state","MyCirclePagesService",function(e,t,o,i){e.myTopics="",e.myCreatTopics="",e.input={keywords:""},e.iconShow=!0,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.input={keywords:""},e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo()},e.search=function(t){e.getMyCreatTopicInfo(t.target.value),e.getMyJoinedCircleInfo(t.target.value),window.cordova&&cordova.plugins.Keyboard.close()},e.viewTopic=function(e){o.go("circlePage",{circleId:e})},e.reviewApplyCircle=function(e){t.reviewCircleId=e,o.go("applyCircle")},e.clickIn=function(e,i){0==i?o.go("circlePage",{circleId:e}):2==i?(t.showApplyTag=1,t.reviewCircleId=e,o.go("applyCircle")):(t.reviewCircleId=e,o.go("applyCircle"))},e.getMyCreatTopicInfo=function(t){var o={keywords:t};i.getMyCreatTopics(o).then(function(t){e.myCreatTopics=t.data.data.list},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};i.getMyJoinedTopics(o).then(function(t){e.myTopics=t.data.data.list},function(e){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyCirclePagesService",["$http","UrlService",function(e,t){this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("MYCREATE_TOPIC"),data:o})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("MYJOINED_TOPIC"),data:o})}}]),APP.controller("MyLessonesController",["$scope","$state","MyCirclePagesService",function(e,t,o){e.goBack=function(){e.$ionicGoBack()},e.init=function(){},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyLessonesService",["$http","UrlService",function(e,t){this.getMyTopics=function(o){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:o})}}]),APP.directive("comImageBox",["$rootScope","$ionicActionSheet","PopupService","CreditService","$timeout",function(e,t,o,i,s){return{restrict:"E",template:'<div class="LightBox" style="display:none;" ><div class="ImgViewer" on-tap="hideBigImage($event)"><img src="{{Url}}"></div></div>',transclude:!1,templateNamespace:"html",scope:!1,link:{pre:function(t,o,i,n){function a(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;x=t[0].clientX,D=t[0].clientY,b=T,A=C,N=0,_=0}function r(e){var t=e.originalEvent?e.originalEvent.touches:e.touches,i=T-u*S/2+g/2,s=g-(i+u*S),n=C-p*S/2+m/2,a=m-(n+p*S);""===f&&(1===t.length?f="swipe":2===t.length&&(f="pinch",w=S,v=l(t),P=t[0].clientX-parseInt((t[0].clientX-t[1].clientX)/2,10)-o.find("img")[0].offsetLeft-b,L=t[0].clientY-parseInt((t[0].clientY-t[1].clientY)/2,10)-o.find("img")[0].offsetTop-A)),"swipe"===f?(e.preventDefault(),N=t[0].clientX-x,_=t[0].clientY-D,T=b+N,C=A+_,d(),i>0&&s>0&&(T=0,d()),n>0&&a>0&&(C=0,d())):"pinch"===f&&(e.preventDefault(),h=l(t),I=h/v,S=I*w,T=P*(1-I)+b+N,C=L*(1-I)+A+_,d(),T=0,C=0,d())}function c(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;if(!(""===f||t.length>0)){S<1?(S=1,T=0,C=0):S>y&&(S=y,I=S/w,T=P*(1-I)+b+N,C=L*(1-I)+A+_);var o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S);o>0&&i<0?(T=u*S/2-g/2,d()):o<0&&i>0&&(T=g/2-u*S/2,d()),s<0&&n>0?(C=m/2-p*S/2,d()):s>0&&n<0&&(C=p*S/2-m/2,d()),o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S),s>0&&n>0&&(C=0,d()),o>0&&i>0&&(T=0,d()),o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S),d(.1),f=""}}function l(e){var t=Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2));return parseInt(t,10)}function d(e){var t=e?"all cubic-bezier(0,0,.5,1) "+e+"s":"",i=[S,0,0,S,T,C],s="matrix("+i.join(",")+")";o.find("img").css({"-webkit-transition":t,transition:t,"-webkit-transform":s+" translate3d(0,0,0)",transform:s})}var u,p,g,m,f="",h=0,v=0,S=(!!window.cordova&&ionic.Platform.platform().indexOf("ios"),1),I=1,w=1,y=parseInt(i.maxScale,10);(isNaN(y)||y<=1)&&(y=20);var T=0,C=0,b=0,A=0,P=0,L=0,x=0,D=0,N=0,_=0;g=$(".LightBox").width(),m=$(".LightBox").height(),t.Url="",t.bigImage=!1,t.noreload=!1,t.showBigImage=function(i,s){"VIDEO"!=i.target.tagName&&void 0!=i.target.currentSrc&&(i.stopPropagation(),t.Url=i.target.currentSrc,e.picBigUrl=t.Url,t.bigImage=!0,$(".LightBox").show(150,function(){$("ion-header-bar").hide(),$(".Main .tab-nav").hide(),$(".LightBox .ImgViewer img").each(function(){$(this).css({width:"90%"}),u=$(this).width(),p=$(this).height(),$(this).css({marginLeft:u/2*-1,marginTop:p/2*-1})})}),o.find("img").on("touchstart",a),o.find("img").on("touchmove",r),o.find("img").on("touchend",c))},t.hideBigImage=function(){t.bigImage=!1,t.noreload=!0,s(function(){t.noreload=!1},500),$("ion-header-bar").show(),$(".Main .tab-nav").show(),$(".LightBox").hide(200),f="",h=0,v=0,S=1,I=1,w=1,y=parseInt(i.maxScale,10),(isNaN(y)||y<=1)&&(y=20),T=0,C=0,b=0,A=0,P=0,L=0,x=0,D=0,N=0,_=0,d()}},post:function(e,t,o,i){}}}}]),APP.directive("myfocus",["$timeout","$parse",function(e,t){return{link:function(o,i,s){var n=t(s.myfocus);o.$watch(n,function(t){!0===t?e(function(){i[0].focus()}):!1===t&&e(function(){i[0].blur()})})}}}]),APP.filter("trusted",["$sce",function(e){return function(t){return"string"==typeof t?e.trustAsHtml(t):t}}]),APP.controller("NoteDetailsController",["ionicDatePicker","HomePageService","$scope","$ionicHistory","$rootScope","$compile","$state","$ionicModal","$stateParams","$http","NoteDetailsService","$ionicLoading","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","$timeout","$ionicActionSheet","PopupService","UrlService","UserService","CreditService","PlatformService","$location",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,w,y,T){function C(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}self.touchStart=function(e){if(self.startCoordinates=getPointerCoordinates(e),!ionic.tap.ignoreScrollStart(e)){if(ionic.tap.containsOrIsTextInput(e.target))return void(self.__hasStarted=!1);self.__isSelectable=!0,self.__enableScrollY=!0,self.__hasStarted=!0,self.doTouchStart(e.touches,e.timeStamp)}},o.isDisplay=!1,o.inputShow=!0,o.praiseNum={},o.commentId="",o.circleId,o.circleDetail,o.commentList,o.products="",o.iconImageData=[],o.imgUrlList=[],o.isImage=!1,o.showBigImg=!1,o.showBac=!1,o.imgString="",o.isPublishImage=!1,o.imgA=[],o.showBigBac=!1,o.shanList="",o.commentIndex=1,o.commentWords={words:""},o.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],o.pinglunis=!1,o.topicheight=0,o.comment={text:"",rows:1},o.noteDetail={reply:"说点什么"},o.$watch("noteDetail.reply",function(e,t,o){}),o.goBack=function(){o.$ionicGoBack(),s.nextPageBefore="noteDetails"},o.goshare=function(){if(!I.getUser().mid)return void a.go("login");o.showShare=!o.showShare,o.isDisplay=!1,d.getShop().success(function(e){e.success&&e.data?o.shareUserId=o.userId:o.shareUserId=null})},o.inCirclePage=function(e){a.go("circlePage",{circleId:e})},o.inPersonalPage=function(e){0!=e&&(e==I.getUser().mid?a.go("personalHomepageMe"):a.go("personalHomepageHe",{othersId:e}))},o.goShop=function(){a.go("myStore",{storeId:o.userId,shareStoreId:""})},o.jumpMsg=function(){a.go("ClassifyMessageCenter")},o.isClick=function(){o.isDisplay=!o.isDisplay},o.downLoadPhoto=function(e){o.photoUrl=s.picBigUrl,s.isApp&&(s.isIOS?h.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){s.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(s.picBigUrl,function(e){v.showToast("保存成功")},function(e){v.showToast("保存失败")})}}):h.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){s.$broadcast("LOADING:SHOW");var e=new FileTransfer,t=encodeURI(o.photoUrl);return e.download(t,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){s.$broadcast("LOADING:HIDE"),v.showToast("保存成功")},function(e){s.$broadcast("LOADING:HIDE"),v.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}}))},o.bigvideo=function(e){s.globalConstant.showvideo=!0,f(function(){$(".video-src1").attr("src",o.video)},100)},o.hideVideo=function(e){e.target.previousElementSibling.pause(),s.globalConstant.showvideo=!1},o.playing=function(e){e.target.style.display="none",e.target.nextElementSibling.play(),o.targetv=e.target.nextElementSibling,o.targetv.addEventListener("ended",function(){e.target.style.display="block"})},o.editTopic=function(){1==o.circleDetail.isReward?1==o.circleDetail.rewardStatus?v.showToast("该悬赏贴已关闭，不能修改"):o.commentList.length>0?v.showToast("该悬赏贴已有评论，不能修改"):a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:2}):o.video?a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:3}):a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:1})},o.showCommentView=function(e){o.commentId=e;p.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:o,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){o.isOne&&(o.isOne=!1,o.insertComments())}}]});f(function(){},3e3)},o.isInputShow=function(){o.inputShow=!o.inputShow},o.pinglunshow=function(){var e=g.$getByHandle("pinglun"),t=e.getScrollPosition(),i=t.top,s=window.innerHeight-118;o.topicheight=document.getElementById("topicxiang").clientHeight-s,f(function(){o.pinglunis=i>o.topicheight},200)},o.addImage=function(){h.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function i(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},o.xiaoxishow=function(){o.xxshow=0!=o.count.count,o.isshow=!o.isshow,o.xiaoxis=!o.xiaoxis,o.shuxiaoxi=!o.shuxiaoxi},o.favorite=function(){var e={id:o.circleId};d.pushPraise(e).success(function(e){})},o.getCircleDetails=function(){var e={id:o.circleId};d.getCircleDetails(e).success(function(e){o.circleDetail=e.data,o.circleDetail.mediaInfo&&(o.video=o.circleDetail.mediaInfo[0].url,f(function(){$(".video-src").attr("src",o.video),$(".video-src").attr("poster",o.circleDetail.mainImg)},200)),o.circleDetail.rewardEndTime&&(o.circleDetail.rewardEndTime=o.circleDetail.rewardEndTime.substring(0,10)),o.circleDetail.rewardComment&&(o.circleDetail.rewardComment[0].imgaa=o.circleDetail.rewardComment[0].commentImgs.split(",")),o.imgArr=[];for(var t=1;t<=o.circleDetail.mainImgArray.length;t++)o.imgArr.push(t);o.whichPersonType(),1==o.ifShort&&o.circleDetail.productId&&o.productConnect(),o.getA()})},o.follow=function(e){if(0==e){var t={id:o.circleDetail.userCode,isFollow:1};d.followNote(t).success(function(e){1==e.success?(o.circleDetail.isFolled=1,o.alreadyFollow=!0,f(function(){o.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(v.showToast(e.message),s.loginIsAccord2=!0)})}else if(1==e){var t={id:o.circleDetail.userCode,isFollow:0};d.followNote(t).success(function(e){1==e.success?o.circleDetail.isFolled=0:-2e3==e.errorCode&&(v.showToast(e.message),s.loginIsAccord2=!0)})}},o.getComment=function(){o.commentIndex=1;var e=C("loginId"),t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:1,pageSize:10,id:o.circleId,userCode:i?o.weChatOpenId:e};d.getComments(s).success(function(e){o.commentNumbers=e.totalCount,o.commentList=e.data.list,o.commentNumbers>10&&(o.hasmore=!0),o.imgString="",o.imgA=[];for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1,o.commentList[t].commentImgs&&(o.imgString=o.commentList[t].commentImgs,o.imgA=o.imgString.split(","),o.commentList[t].imgaa=o.imgA);g.resize()})},o.loadMore=function(){o.commentIndex=o.commentIndex+1;var e=C("loginId"),t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:o.commentIndex,pageSize:10,id:o.circleId,userCode:i?o.weChatOpenId:e};d.getComments(s).success(function(e){o.commentNumbers=e.totalCount,o.commentList=o.commentList.concat(e.data.list),o.commentNumbers>o.commentList.length?o.$broadcast("scroll.infiniteScrollComplete"):(o.hasmore=!1,v.showToast("没有更多评论了")),o.imgString="",o.imgA=[];for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1,o.commentList[t].commentImgs&&(o.imgString=o.commentList[t].commentImgs,o.imgA=o.imgString.split(","),o.commentList[t].imgaa=o.imgA)})},o.getFocus=function(e,t,i){event.stopPropagation();for(var s=0;s<o.commentList.length;s++)o.commentList[s].ischecked=!1;o.commentWords.words="",o.iconImageData=[],o.isPublishImage=!0,o.showBac=!0,o.commontId=e,o.toSomeone="回复给："+t,setTimeout(function(){document.getElementById("inputId").focus()},200)},o.focuss=function(){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,o.isPublishImage=!0,o.showBac=!0,o.iconImageData.length>0&&(o.isImage=!0)},o.deleteImg=function(e){o.iconImageData.splice(e,1)},o.showLarge=function(e){o.showBigBac=!0,o.showBigImg=!0,o.Url=e},o.closeBigImg=function(){o.showBigImg=!1,o.showBigBac=!1},o.closeImg=function(){o.images=!1,o.isImage=!1,o.isPublishImage=!1,o.showBac=!1},o.imgPush=function(e){if(o.isImage=!0,o.iconImageData.length>=9)return void v.showToast("最多添加9张");h.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){var t={imgUrl:e};f(function(){o.iconImageData.push(t),o.existPhoto=!0},200)}function i(){}if(0==e)return navigator.camera.getPicture(t,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==e){var s=9-o.iconImageData.length;return window.imagePicker.getPictures(function(e){for(var t=0;t<e.length;t++){var i={imgUrl:e[t]};o.iconImageData.push(i)}o.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},o.insertCom=function(e){t.isWdHost().success(function(t){if(s.isWdHost=t.data.isHost,-1==s.isWdHost)a.go("login");else if(window.cordova&&(s.gio.track("comment",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId})),"IMG"==e.target.nodeName)if(o.commontId){var i={commentId:o.commontId,commentImgs:e.target.src,id:o.circleId};o.insertCommentOK(i)}else{var i={commentImgs:e.target.src,id:o.circleId};o.insertCommentOK(i)}})},o.insertComments=function(){t.isWdHost().success(function(e){if(s.isWdHost=e.data.isHost,-1==s.isWdHost)a.go("login");else{window.cordova&&(s.gio.track("comment",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId}));var t=0;if(o.commentWords.words){var i={keywords:o.commentWords.words};m.judgeWords(i).success(function(e){"没有敏感词"==e.message?0==o.iconImageData.length?(o.iconImageData=[],o.imgUrlList=[],o.publishTopic()):angular.forEach(o.iconImageData,function(e,i){var s=function(e){u.hide(),t++;var s=JSON.parse(e.response),n=s.urls;o.imgUrlList[i]=n,t==o.iconImageData.length&&o.publishTopic()},n=function(e){u.hide()},a={},r=new FileTransfer;r.upload(e.imgUrl,encodeURI(d.uploadImage()),s,n,a)}):(v.showToast("存在敏感词",e.data),o.commentWords.words="")})}else v.showToast("内容不能为空")}})},o.nocommontId=function(){o.isDisplay=!1;for(var e=0;e<o.commentList.length;e++)o.commentList[e].ischecked=!1;o.commontId&&(o.commontId="",o.toSomeone="",o.commentWords.words="",o.iconImageData=[])},o.publishTopic=function(e){if(o.commontId){var e={comment:o.commentWords.words,commentId:o.commontId,commentImgs:o.imgUrlList.toString(),id:o.circleId};o.insertCommentOK(e)}else{var e={comment:o.commentWords.words,commentImgs:o.imgUrlList.toString(),id:o.circleId};o.insertCommentOK(e)}},o.insertCommentOK=function(e){d.insertComment(e).success(function(e){o.getComment(),1==e.success?(v.showToast("回复成功"),o.commentWords.words="",o.commontId="",o.toSomeone="",o.iconImageData=[],o.imgUrlList=[],o.isImage=!1,o.isPublishImage=!1,o.showBac=!1,o.images=!1,o.haierImg=!1,o.shunguangImg=!1):(f(function(){v.showToast(e.message)},200),o.commentWords.words="")}).error(function(e){v.showToast("网络异常"),o.commentWords.words=""})},o.topicPraise=function(e){window.cordova&&(s.gio.track("like",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId}));var t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),n=C("loginId"),a={id:e,noLoading:!0,userCode:i?o.weChatOpenId:n};d.pushPraise(a).success(function(e){1==e.success?(o.isPraise=!o.isPraise,o.getStoryPraiseNum()):v.showToast(e.message)})},o.topicFavorite=function(e){var t={id:e,noLoading:!0};d.topicFavorite(t).success(function(e){1==e.success?(o.isFavorite=!o.isFavorite,o.getStoryPraiseNum()):-2e3==e.errorCode?(v.showToast(e.message),s.loginIsAccord2=!0):v.showToast(e.message)})},o.goToScore=function(e){if("IMG"==e.target.tagName&&(o.noreload||o.showBigImage(e)),$(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),$(".noteContent a").removeAttr("href"),"linklink dot-block"==e.target.className)if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else{var t=e.target.outerText;o.tolink(t)}else if("all-to"==e.target.className)if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;o.tolink(t)}else{var t=e.target.outerText;o.tolink(t)}else if("atopic"==e.target.className){if(e.target.attributes["data-a"]){var t=e.target.attributes["data-a"].value;o.tolink(t)}else if(e.target.attributes.dataa){var t=e.target.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.className){if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.attributes.dataa){var t=e.target.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.className){if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.className)if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}},o.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==y.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==y.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.getA=function(){f(function(){$(".detailEditor .editor a").html(function(e,t){if(!this.attributes["data-a"])return t;if(this.attributes["data-a"].value){this.setAttribute("href",this.attributes["data-a"].value);var i=this.attributes["data-a"].value;return'<div class="all-to"><img class="imgimg" src="'+o.imgBaseURL+'/img/link.png"/><span class="linklink dot-block">'+i+"</span></div>"}})},20),f(function(){$(".detailEditor .editor div").removeAttr("contenteditable"),$(".detailEditor .editor div").addClass("copy")},30),f(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},100),f(function(){$(".detailEditor .editor .imgHeight").css({height:"auto",width:"auto","background-image":"none"}),$(".detailEditor .editor .imgHeight img").css({width:"100%",display:"block"}),$(".detailEditor .editor .imgHeight span").css({display:"none"}),$(".detailEditor .editor span").css("font-size","12px")},60)},o.topicShan=function(e){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,1==o.circleDetail.isReward?v.showToast("该话题是悬赏话题，不能被打赏"):(o.showShan=!0,o.goldNum(),e?o.shanCommentId=e:(o.shanCommentId="",o.shanTopicId=o.circleId))},o.selectImg=function(){o.images=!0,o.haierImg=!0,o.shunguangImg=!1,o.yearImg=!1},o.selectHaier=function(){o.haierImg=!0,o.shunguangImg=!1,o.yearImg=!1},o.selectshun=function(){o.haierImg=!1,o.shunguangImg=!0,o.yearImg=!1},o.selectYear=function(){o.haierImg=!1,o.shunguangImg=!1,o.yearImg=!0},o.deleteShan=function(){o.reward.num="";for(var e=0;e<o.shanNum.length;e++)o.shanNum[e].isChecked=!1;o.shanGoldNum="",o.showShan=!1},o.clickMore=function(e){if(o.isDisplay=!1,o.commentList[e].ischecked)for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;else{for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;o.commentList[e].ischecked=!0}},o.toRewardList=function(){a.go("topicRewardList",{tipId:o.circleId})},o.selectGod=function(e){if(o.reward.num="",o.shanNum[e].isChecked){for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.shanGoldNum=""}else{for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.shanNum[e].isChecked=!0,o.shanGoldNum=o.shanNum[e].num}},o.otherGoldNum=function(){for(var e=0;e<o.shanNum.length;e++)o.shanNum[e].isChecked=!1;o.shanGoldNum=o.reward.num},o.noticeDownload=function(){s.downAppUrl||v.showToast("不支持该手机")},o.commentPraise=function(e,t){var i=window.navigator.userAgent.toLowerCase(),s="micromessenger"==i.match(/MicroMessenger/i),n=C("loginId"),a={commentId:e.id,noLoading:!0,userCode:s?o.weChatOpenId:n};d.commentPraise(a).success(function(i){if(1==i.success){if(o.circleDetail.rewardComment){if(e.id==o.circleDetail.rewardComment[0].id){o.circleDetail.rewardComment[0].commentPraiseNumberFlag=!o.circleDetail.rewardComment[0].commentPraiseNumberFlag;for(var s=0;s<o.commentList.length;s++)e.id==o.commentList[s].id&&(o.commentList[s].commentPraiseNumberFlag=!o.commentList[s].commentPraiseNumberFlag)}}else for(var s=0;s<o.commentList.length;s++)e.id==o.commentList[s].id&&(o.commentList[s].commentPraiseNumberFlag=!o.commentList[s].commentPraiseNumberFlag);o.getCommentPraiseNum(e,t)}else v.showToast(i.message)})},o.getStoryPraiseNum=function(){var e=window.navigator.userAgent.toLowerCase(),t="micromessenger"==e.match(/MicroMessenger/i),i=C("loginId"),s={id:o.circleId,noLoading:!0,userCode:t?o.weChatOpenId:i};d.getStoryPraise(s).success(function(e){o.praiseNum=e.data})},o.getCommentPraiseNum=function(e,t){var i=window.navigator.userAgent.toLowerCase(),s="micromessenger"==i.match(/MicroMessenger/i),n=C("loginId"),a={commentId:e.id,noLoading:!0,userCode:s?o.weChatOpenId:n};d.commentPraiseNum(a).success(function(t){if(o.circleDetail.rewardComment){if(e.id==o.circleDetail.rewardComment[0].id){o.circleDetail.rewardComment[0].commentPraiseNumber=t.totalCount
;for(var i=0;i<o.commentList.length;i++)e.id==o.commentList[i].id&&(o.commentList[i].commentPraiseNumber=t.totalCount)}}else for(var i=0;i<o.commentList.length;i++)e.id==o.commentList[i].id&&(o.commentList[i].commentPraiseNumber=t.totalCount)})},o.startTime=function(){if("APP"==y.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){f(function(){var t=e.getDate(),i=e.getMonth()+1,s=e.getFullYear(),n=new Date(e);n.setDate(e.getDate()+7);var a=n.getMonth()+1;a<10&&(a="0"+a),i<10&&(i="0"+i),t<10&&(t="0"+t);var r=s+"-"+i+"-"+t;o.start=r,o.end=n.getFullYear()+"-"+a+"-"+n.getDate()},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e);o.startOk=new Date(e);var i=new Date(e);o.endOk=i,i.setDate(t.getDate()+7);var s=new Date(e).getMonth()+1,n=new Date(e).getDate();s<10&&(s="0"+s),n<10&&(n="0"+n);var a=new Date(e).getFullYear()+"-"+s+"-"+n;o.start=a,o.end=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()}};e.openDatePicker(i)}},o.endTime=function(){if("APP"==y.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){f(function(){var t=e.getDate(),i=e.getMonth()+1,s=e.getFullYear();i<10&&(i="0"+i),t<10&&(t="0"+t);var n=s+"-"+i+"-"+t;o.end=n},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:o.startOk,to:o.endOk,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,i=new Date(e).getDate();t<10&&(t="0"+t),i<10&&(i="0"+i);var s=new Date(e).getFullYear()+"-"+t+"-"+i;o.end=s}};e.openDatePicker(i)}},o.selectStartEnd=function(){o.topStyle=1,o.startend="img/ic_select.png",o.day="img/ic_check.png"},o.selectDay=function(){o.topStyle=0,o.day="img/ic_select.png",o.startend="img/ic_check.png"},o.deleteTop=function(){o.showTop=!1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"},o.deleteJing=function(){o.showJing=!1,o.topStyle=3,o.topicJing=!0,o.isFirstJing=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"},o.selectTop=function(){o.showTop=!0},o.selectJing=function(){o.showJing=!0},o.topicTopOK=function(){o.personType.isSuperManager&&(o.topicTop?o.topicTop=!1:o.topicTop=!0)},o.topicJingOK=function(){o.personType.isSuperManager&&(o.topicJing?o.topicJing=!1:o.topicJing=!0)},o.firstTop=function(){o.isFirstTop?o.isFirstTop=!1:o.isFirstTop=!0},o.firstJing=function(){o.isFirstJing?o.isFirstJing=!1:o.isFirstJing=!0},o.topPosts=function(){if(o.isFirstTop||o.topicTop)if(0==o.topStyle||1==o.topStyle){if(1==o.topStyle){if(o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:3};o.okTop(e)}else if(o.isFirstTop&&!o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:2};o.okTop(e)}else if(!o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:1};o.okTop(e)}}else if(0==o.topStyle)if(o.topTopic.day){var t=parseInt(o.topTopic.day);if(t>0)if(t<30){if(o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:3};o.okTop(e)}else if(o.isFirstTop&&!o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:2};o.okTop(e)}else if(!o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:1};o.okTop(e)}}else v.showToast("置顶天数不能超过30天，请重新输入");else v.showToast("置顶天数需大于0天，请重新输入")}else v.showToast("请输入置顶天数")}else v.showToast("请选择置顶时间");else v.showToast("请选择置顶位置")},o.okTop=function(e){d.topStory(e).success(function(e){e.success?(v.showToast("置顶成功"),o.circleDetail.isTopicTop=!0,o.showTop=!1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"):v.showToast(e.message)})},o.JingPosts=function(){if(o.isFirstJing||o.topicJing)if(0==o.topStyle||1==o.topStyle){if(1==o.topStyle){if(o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:3};o.okJing(e)}else if(o.isFirstJing&&!o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:2};o.okJing(e)}else if(!o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:1};o.okJing(e)}}else if(0==o.topStyle)if(o.topTopic.day){var t=parseInt(o.topTopic.day);if(t>0)if(t<30){if(o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:3};o.okJing(e)}else if(o.isFirstJing&&!o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:2};o.okJing(e)}else if(!o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:1};o.okJing(e)}}else v.showToast("设置精华天数不能超过30天，请重新输入");else v.showToast("置顶天数需大于0天，请重新输入")}else v.showToast("请输入天数")}else v.showToast("请选择精华时间");else v.showToast("请选择精华位置")},o.okJing=function(e){d.JingStory(e).success(function(t){t.success?(v.showToast("设置精华成功"),o.circleDetail.isChoice=e.topicChoice,o.showJing=!1,o.topStyle=3,o.topicJing=!0,o.isFirstJing=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"):v.showToast(t.message)})},o.cancelTop=function(){var e={storyId:o.circleId};d.cancelTop(e).success(function(e){e.success?(o.circleDetail.isTopicTop=!1,o.circleDetail.isTop=!1,v.showToast(e.message)):v.showToast(e.message)})},o.cancelJing=function(){var e={storyId:o.circleId};d.cancelJing(e).success(function(e){e.success?(o.circleDetail.isChoice=0,v.showToast(e.message)):v.showToast(e.message)})},o.deleteStory=function(){var e={storyId:o.circleDetail.id};d.deleteTopic(e).success(function(e){1==e.success?(v.showToast("话题删除成功"),s.ifDeleteNoteList=!0,a.go("circlePage",{circleId:o.circleDetail.topicId})):v.showToast(e.message)})},o.warnDelete=function(e){if(o.isDisplay=!1,o.commentId=e,1==o.circleDetail.isReward&&0==o.circleDetail.rewardStatus){p.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>该话题是悬赏话题，删除金币不退回，确认删除吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:o,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){o.deleteStory()}},{text:"放弃"}]})}else{p.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除话题吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:o,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){o.deleteStory()}},{text:"放弃"}]})}f(function(){},3e3)},o.warnDeleteComments=function(e){o.isDisplay=!1,o.deleteId=e;p.show({template:'<img src="{{imgBaseURL}}img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:o,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){o.deleteComment()}}]});f(function(){},3e3)},o.deleteComment=function(e){var t={id:o.deleteId};d.deleteStory(t).success(function(e){1==e.success?(v.showToast("删除成功"),o.getComment()):v.showToast(e.message)})},o.productConnect=function(){var e={productId:o.circleDetail.productId,userCode:o.userShareId?o.userShareId:o.circleDetail.userCode};d.connectProduct(e).success(function(e){e.success&&(o.products=e.data.list)})},o.toProductDetail=function(e){a.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},o.whichPersonType=function(){var e={storyId:o.circleDetail.id,topicId:o.circleDetail.topicId};d.getPersonType(e).success(function(e){1==e.success&&(o.personType={isAdmin:e.data.isAdmin,isCreateStory:e.data.isCreateStory,isSuperManager:e.data.isSuperManager,isCircleManager:e.data.isCircleManager})})},o.shareToStore=function(){var e={flag:1,storyId:o.circleDetail.id};d.shareStore(e).success(function(e){e.success})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),f(function(){v.showToastShort("复制成功")},200)):v.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t=o.circleDetail.storyName?o.circleDetail.storyName+"-顺逛微社区":o.circleDetail.userName+"的话题-顺逛微社区",i=o.circleDetail.storyContentText.substr(0,30)||"马上进入，参与话题讨论吧...",s=o.circleDetail.mainImgArray[0]?o.circleDetail.mainImgArray[0]:"http://www.ehaier.com/mstatic/wd/v2/img/sg.png";if(o.shareUserId)var n=S.getShareLinkHeader()+"noteDetails/"+o.circleId+"/"+o.ifShort+"/"+o.shareUserId;else var n=S.getShareLinkHeader()+"noteDetails/"+o.circleId+"/"+o.ifShort+"/";if(window.umeng){var a={topicId:o.circleId},r=function(e){w.shareSuccessCallback(e,a)};0==e?window.umeng.shareToSina(t,i,s,n,0,null,r):1==e?window.umeng.shareToWechatSession(t,i,s,n,0,null,r):2==e?window.umeng.shareToWechatTimeline(t,i,s,n,0,null,r):3==e?(window.umeng.shareToQQ(t,i,s,n,0,null,r),w.qqShare()):4==e&&(window.umeng.shareToQzone(t,i,s,n,0,null,r),w.qqShare()),5==e?o.copeText(n):w.successShare()}else alert("umeng undefined 只能在app分享");o.showShare=!1,o.shareToStore()},o.closeDownload=function(){o.ifDownload=!1},o.goldNum=function(){d.getGold().success(function(e){e.success?e.data>9999?o.canShanGold=9999:e.data<0?o.canShanGold=0:o.canShanGold=e.data:-2e3==e.errorCode?(v.showToast(e.message),o.showShan=!1,s.loginIsAccord2=!0):o.showShan=!1})},o.getShanList=function(){var e={tipId:parseInt(o.circleId),pageIndex:1,pageSize:10,type:1};d.getList(e).success(function(e){o.shanList=e.data})},o.shanTopic=function(){o.shanCommentId=o.shanCommentId+"",o.shanGoldNum?o.shanOK():o.reward.num?(o.shanGoldNum=parseInt(o.reward.num),o.shanOK()):v.showToast("请选择打赏金币")},o.shanOK=function(){if(o.shanGoldNum<=9999)if(o.shanGoldNum<=o.canShanGold)if(o.shanCommentId.length>0){var e={commentId:o.shanCommentId,amount:o.shanGoldNum};d.shanComment(e).success(function(e){if(e.success){o.showShan=!1,v.showToast("打赏成功"),f(function(){o.getShanList()},1e3);for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;for(var i=0;i<o.shanNum.length;i++)o.shanNum[i].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanCommentId=""}else v.showToast(e.message)})}else{var t={storyId:parseInt(o.shanTopicId),amount:o.shanGoldNum};d.shanTopic(t).success(function(e){if(e.success){o.showShan=!1,v.showToast("打赏成功"),f(function(){o.getShanList()},1e3);for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanTopicId=""}else{o.showShan=!1;for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanTopicId="",v.showToast(e.message)}})}else v.showToast("您的金币数不足，请修改打赏金额");else v.showToast("最多可打赏9999金币，请修改打赏金额")},o.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userId})},o.cangComment=function(e){var t={id:e.id,isDisplay:e.isDisplay};d.cangComment(t).success(function(e){e.success?(v.showToast(e.message),f(function(){o.getComment()},1e3)):v.showToast(e.message)})},o.cangTopic=function(){var e={storyId:o.circleId};d.cangTopic(e).success(function(e){e.success?o.getCircleDetails():v.showToast(e.message)})},o.delCangTopic=function(){var e={storyId:o.circleId};d.delCangTopic(e).success(function(e){e.success?o.getCircleDetails():v.showToast(e.message)})},o.topicAgree=function(e){p.show({template:"<div>您是否确认采纳该回复？</div>",title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:o,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){var i={storyId:o.circleId,commentId:e};d.topicAgree(i).success(function(e){e.success?(v.showToast("已经被采纳"),o.getCircleDetails(),o.getStoryPraiseNum(),o.getComment()):v.showToast(e.message)})}}]})},o.init=function(){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,s.globalConstant.showvideo=!1,o.commentIndex=1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.topicJing=!0,o.isFirstJing=!1,o.showJing=!1,o.topTopic={day:5},o.startend="img/ic_check.png",o.day="img/ic_check.png";var e=new Date,t=parseInt(e.getMonth())+1,i=new Date(e);i.setDate(e.getDate()+7);var n=parseInt(i.getMonth())+1;o.start=e.getFullYear()+"-"+t+"-"+e.getDate(),o.end=i.getFullYear()+"-"+n+"-"+i.getDate(),o.shareUserId=null,o.userShareId=c.shareStoreId,o.circleId=c.noteId,o.shanList="",s.ifDeleteNoteList=!1,o.reward={num:""},o.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],o.getShanList(),o.userId=I.getUser().mid,window.cordova?o.ifInApp=!1:o.ifInApp=!0,o.ifDownload=!0,o.toSomeone="",o.showQQ=!1,o.showWeChat=!1,o.showShare=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.commentWords={words:""},o.showShare=!1,o.isFavorite=!0,o.isPraise=!0,o.isDisplay=!1,o.ifShort=c.isShortStory,o.personType={isAdmin:!1,isCreateStory:!1},o.getCircleDetails(),o.getStoryPraiseNum(),o.getComment(),r.fromTemplateUrl("templates/quanzi/TopDaysModal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.selectModal=e})},o.wechatOpenId=function(){d.getWeChatOpenId().success(function(e){e.success&&(e.data?(o.weChatOpenId=e.data,d.weChatOpenId=e.data,o.init()):o.wechatUrlOpenId())})},o.wechatUrlOpenId=function(){var e=T.absUrl();d.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},o.$on("$ionicView.beforeEnter",function(){o.isIOS=!!ionic.Platform.isIOS(),s.$on("$stateChangeStart",function(e,t,o,i,s){if("noteDetails"==i.name)for(var n=document.getElementsByTagName("video"),a=0;a<n.length;a++)n[a].pause()}),ionic.Platform.isAndroid()&&(o.hideBigImage(),$(".LightBox").hide(0)),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?o.wechatOpenId():o.init()}),o.$on("$ionicView.beforeLeave",function(){$("ion-header-bar").show(),$(".Main .tab-nav").show()}),o.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);o.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),o.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)},o.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);o.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),o.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)}}]),APP.service("NoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.deleteTopic=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETE_COMMON_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("TOPIC_PRAISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("COMMON_COMMENT"),data:o})},this.topStory=function(o){return e.get(t.getUrl("CIRCLE_TOP_TOPIC"),o)},this.JingStory=function(o){return e.get(t.getUrl("CIRCLE_JING_TOPIC"),o)},this.cancelJing=function(o){return e.get(t.getUrl("CIRCLE_JING_CANCLE"),o)},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("INSERT_COMMON_COMMENT"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GET_STORY_PRAISE"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("COMMENT_STORY_PRAISE"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})},this.cancelTop=function(o){return e.get(t.getUrl("CANCEL_TOP"),o)},this.cangComment=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_CANG_COMMENT"),data:o})},this.cangTopic=function(o){return e.get(t.getUrl("CIRCLE_CANG_TOPIC"),o)},this.delCangTopic=function(o){return e.get(t.getUrl("CIECLE_DEL_CANG_TOPIC"),o)},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getGold=function(){return e.get(t.getUrl("CIRCLE_GET_GOLD"))},this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)},this.getShop=function(o){return e.get(t.getUrl("CIRCLE_SELECT_SHOP"))},this.topicAgree=function(o){return e.get(t.getUrl("CIRCLE_AGREE"),o)},this.shanTopic=function(o){return e.get(t.getUrl("CIRCLE_SHAN_TOPIC"),o)},this.shanComment=function(o){return e.get(t.getUrl("CIRCLE_SHAN_COMMENT"),o)},this.getWeChatOpenId=function(){return e({method:"POST",url:t.getUrl("GET_WECHAT_OPENID")})},this.getWeChatUrlOpenId=function(o){var i={url:o};return e.post(t.getUrl("GET_WECHAT_URL")+"?url="+encodeURIComponent(i.url))},this.weChatOpenId=""}]),APP.controller("PublishCircleController",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicLoading","$ionicActionSheet","PublishCircleService","ApplyCircleService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.identifyCode="",e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.goSelectGoods=function(){o.go("selectGoods")},e.judgeWords=function(){var t={keywords:e.publishInfo.storyContent};c.judgeWords(t).success(function(e){"没有敏感词"==e.message||d.showToast(e.message)})},e.$watch("publishInfo.storyContent",function(){u.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&d.showToast("话题内容不得超过500字")}),e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.publishClick=function(i){if(i.mainImg=e.imgUrlList.toString(),e.publishInfo.topicId=e.topicId,0!=e.publishInfo.storyContent.length||e.iconImageData.length)if(e.publishInfo.storyContent.length>500)d.showToast("话题内容不得超过500字");else if(e.iconImageData.length!=e.imgUrlList.length)d.showToast("图片正在上传，请稍后再试");else{var s={keywords:e.publishInfo.storyContent};c.judgeWords(s).success(function(s){"没有敏感词"==s.message?r.publish(i).success(function(i){1==i.success?(d.showToast("发布成功"),t.publishSuccess=!0,l(function(){t.publishSuccess=!1},1e3),e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("circlePage",{circleId:e.topicId})):d.showToast(i.message)}).error(function(){}):d.showToast("存在敏感词",s.data)})}else e.publishNotice=!0,l(function(){e.publishNotice=!1},1e3)},e.imgUrlList=[],e.addPicture=function(){function t(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},s=function(e){n.hide()},a={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),i,s,a)}function o(){}return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0},e.photoAlbum=function(){var t=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i);var s=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){n.hide()},c={};(new FileTransfer).upload(i.imgUrl,encodeURI(r.uploadImage()),s,a,c)}e.$apply()},function(e){},{maximumImagesCount:t,width:800,quality:50}),!0},e.imgPush=function(t){if(e.iconImageData.length>=9)return void d.showToast("最多添加9张");a.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},s=function(e){n.hide()},a={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),i,s,a)}function i(){}if(0==t)return navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var s=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i);var s=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){n.hide()},c={};(new FileTransfer).upload(i.imgUrl,encodeURI(r.uploadImage()),s,a,c)}e.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.wordsNum=500,e.showBigImage=!1,e.iconImageData=[],e.publishInfo.storyContent="",e.topicId=i.topicId,e.identifyCode=i.identifierCode,1==e.identifyCode?e.addPicture():2==e.identifyCode&&e.photoAlbum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishCircleService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("SUBMIT_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.controller("PublishEditController",["$scope","$rootScope","$state","$stateParams","PublishEditService","PopupService","$timeout","$ionicActionSheet","$ionicLoading","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.identifyCode="",e.publishInfo={id:i.topicId,mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.$watch("publishInfo.storyContent",function(){l.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&n.showToast("话题内容不得超过500字")}),e.getNoteDetail=function(){e.iconImageData=[],e.imgUrlList=[];var t={id:i.topicId};s.getDetails(t).success(function(t){e.detailData=t.data,e.publishInfo.storyContent=e.detailData.storyContent;for(var o=0;o<e.detailData.mainImgArray.length;o++){var i={imgUrl:e.detailData.mainImgArray[o]};e.imgUrlList.push(e.detailData.mainImgArray[o]),e.iconImageData.push(i)}})},e.publishClick=function(r){var c={keywords:e.publishInfo.storyContent};s.judgeWords(c).success(function(c){"没有敏感词"==c.message?(e.publishInfo.mainImg=e.imgUrlList.toString(),0!=e.publishInfo.storyContent.length||e.publishInfo.mainImg?e.iconImageData.length!=e.imgUrlList.length?n.showToast("图片正在上传，请稍后再试"):s.publish(r).success(function(s){1==s.success?(n.showToast("发布成功"),t.editSuccess=!0,a(function(){t.editSuccess=!1},1e3),e.publishInfo={id:i.topicId,mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("noteDetails",{noteId:e.circleId,isShortStory:e.ifShort})):n.showToast(s.message)}).error(function(){}):(e.publishNotice=!0,a(function(){e.publishNotice=!1},1e3))):n.showToast("存在敏感词",c.data)}).error(function(){})},e.imgUrlList=[],e.imgPush=function(t){if(e.iconImageData.length>=9)return void n.showToast("最多添加9张");r.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};a(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){c.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(s.uploadImage()),i,n,r)}function i(){}function n(){}function r(t){var o={imgUrl:t};e.iconImageData.push(o),e.existPhoto=!0,a(function(){for(var t=0;t<e.iconImageData.length;t++);},200);var i=function(t){c.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(s.uploadImage()),i,n,r)}return 0==t?(navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(r,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.showBigImage=!1,e.circleId=i.noteId,e.ifShort=i.isShortStory,e.getNoteDetail()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishEditService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("UPDATE_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})}}]),APP.controller("QuestionDetailsController",["$scope","$rootScope","$state","$stateParams","QuestionDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r){e.getListDate={wordsId:"",pageSize:"",pageIndex:""},e.answerDate={wordsContent:"",courseId:"",parentId:""},e.init=function(){e.wordId=i.wordsId,e.getQuestionList()},e.getQuestionList=function(){var t={wordsId:e.wordId,pageSize:10,pageIndex:1};s.getQuestionDetail(t).success(function(e){}).error(function(){})},e.commitAnswer=function(){e.answerDate={wordsContent:"",courseId:"",parentId:""},s.answerQuestion(e.answerDate).success(function(e){}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QuestionDetailsService",["$http","UrlService",function(e,t){this.answerQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})},this.getQuestionDetail=function(o){return e({method:"POST",url:t.getUrl("GET_QUESTION_DETAILS"),data:o})}}]),APP.controller("SchoolGroupDiscussController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,S)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);t.data.message=t.response.imageUrl,t.data.fileType=".jpg",t.data.companyId=void 0,e.$apply(function(){e.messages.push(t.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};m.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})}function S(e){alert("上传失败")}function I(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function $(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:void 0},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode};c.getUser();e.groupId=55,e.token="21CB91E8209EA98369F5E504449497D7",e.sgdMode=0,e.toggleMode=function(t){e.sgdMode=t},e.miniTaolun=[{msg:33333},{msg:"erfjwqefjwiqawijofejwjfwe"},{msg:"大事发生反饥饿叫啊喂哦 i 发尾峰"},{msg:"一张图片"}],e.isClick=function(){e.isDisplay=!e.isDisplay},e.toMemberList=function(){s.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||m.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["exp_colum6","sss"],values:[1111222,333]};m.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId)}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token};r.getMsg(t).then(function(t){if(t&&t.data&&t.data.msgs&&0!=t.data.msgs.length)for(var o=0;o<t.data.msgs.length;o++)m.filtMsg(t.data.msgs[o]),t.data.msgs[o].message&&e.messages.push(t.data.msgs[o])},function(e){alert(e)})},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};r.sendMsg(t).then(function(o){if(o){var i={message:t.msg,companyId:void 0};m.filtMsg(i),e.messages.push(i)}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};m.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(){d.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){u.getPicture(e,f,h)}})},e.play=function(){var e=document.getElementById("audioInSD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInSD","audioInSD")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){u.stopCapture("sourceInSD","audioInSD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,o=o.replace(/8181/,"8082"),i.data.message="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(i.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};m.addEvent(s).then(function(t){t?n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败")})},y=function(e){alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){
window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){e.CustumerParam.msg=e.CustumerParam.msg+"["+t+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.messages=[{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{message:"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 ",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:2}];var s={message:"aaf啊积极饿哇  啊发[1]",companyId:1234,userName:"我zou是路飞啊啊啊",idCate:0};m.filtMsg(s),e.messages.push(s),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",I),window.addEventListener("native.keyboardhide",$),u.addAudioEventOnWindow()});var T=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",I),window.removeEventListener("native.keyboardhide",$)}),e.goBack=function(){e.$ionicGoBack()}}]),APP.directive("resizeFootBarsd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-sd"),n=e.$getByHandle("cdScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),APP.controller("SelectGoodsController",["$scope",function(e){e.init=function(){},e.$on("$ionicView.beforeEnter",function(){})}]),APP.service("SelectGoodsService",["$http","UrlService",function(e,t){}]),APP.controller("SelectTagsController",["$scope","$rootScope","$state","$stateParams","SelectTagsService","PopupService","$timeout","$ionicScrollDelegate","$interval",function(e,t,o,i,s,n,a,r,c){t.frequentTags="",t.storeId=[],t.storeNames=[],t.nameStringToObj=[],t.addedTags=t.addedTags,e.namedTags="",e.isShow=!1,e.init=function(){e.phoneHeight=document.documentElement.clientHeight/2,e.getScrollHeight=function(){e.scrollHeight=document.getElementById("aaa").scrollTop},e.timer=c(function(){e.scrollHeight=document.getElementById("aaa").scrollTop,e.scrollHeight>e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},100),e.isShow=!1,t.nameStringToObj=[],t.frequentTags.length||(e.getFrequentlyTags(),t.storeId=[],t.storeNames=[],t.nameStringToObj=[])},e.goBack=function(){c.cancel(e.timer);for(var i=0;i<t.storeNames.length;i++){var s={name:t.storeNames[i]};t.nameStringToObj.push(s)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.getFrequentlyTags=function(){var e={id:t.reviewCircleId?t.reviewCircleId:""};s.getTags(e).success(function(e){if(t.frequentTags=e.data.list,e.data.list1){for(var o=0;o<e.data.list1.length;o++)t.storeId.push(e.data.list1[o].id);for(var i=0;i<e.data.list2.length;i++)t.storeNames.push(e.data.list2[i].name)}})},e.backApply=function(){c.cancel(e.timer);for(var i=0;i<t.storeNames.length;i++){var s={name:t.storeNames[i]};t.nameStringToObj.push(s)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.showInput=function(){e.isShow=!0,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.scrollToTop=function(){r.$getByHandle("mainScroll").scrollTop(),e.showTopBtn=!1},e.submitNamedTags=function(){var o={tagName:e.namedTags};if(o.tagName){for(var i=1,r=0;r<t.addedTags.length;r++){if(t.addedTags[r].name==o.tagName){n.showToast(response.message),i=0;break}i=1}1==i&&s.confirmTag(o).success(function(o){if(1==o.data)if(t.addedTags.length<5){var i={name:e.namedTags};t.addedTags.push(i),e.namedTags="",a(function(){e.isShow=!1},200)}else n.showToast("最多添加5个自定义标签");else n.showToast(o.message)})}else n.showToast("标签名不能为空");e.deleteTags=function(e){t.addedTags.splice(e,1)}},e.ifClicked=function(e,o,i,s){if(1==i)for(var a=0;a<=t.storeId.length;a++)t.storeId[a]==o&&(t.storeId.splice(a,1),t.storeNames.splice(a,1),t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked);else t.storeId.length<10?(t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked,t.storeId.push(o),t.storeNames.push(s)):n.showToast("最多选择10个")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SelectTagsService",["$http","UrlService",function(e,t){this.getFrequentTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.confirmTag=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGNAME"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})}}]),APP.controller("ServiceConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","ServiceConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","CustomerConversationService","$ionicPopup","$stateParams","MediaService","FileUploadService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){function I(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.cId;S.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},w,y)}function $(e){alert("得到图片失败")}function w(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);o.data.message="图片文件";var i=o.data.imageUrl,s={imageUrl:i,fileType:".jpg",msg:"图片文件"};e.$apply(function(){e.messages.push(s)}),r.sendMsg(e.chatId,e.receiverId,"m",i,e.token).then(function(e){e&&e.data&&0==e.data.rt||alert("发送信息失败")})}function y(e){alert("上传失败")}function T(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function C(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.second=9,e.CustumerParam={msg:""},e.messages=[],e.token=c.getUser().sessionValue,e.cId=void 0,e.csTimer=void 0,e.receiverId="",e.chatId=void 0,e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.cId=h.to,e.receiverId=h.from,e.chatId=h.chatId,e.cId&&e.receiverId&&e.chatId&&(e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId))},e.goBack=function(){e.isPlaying||e.$ionicGoBack()},e.loginCs=function(){var t={c:"li",u:"admin",p:"123456"};e.chatId=void 0,r.login(t).then(function(t){t?(e.token=t.data.token,e.cId=t.data.ci,n(function(){e.loopGetMsg()},500)):alert("login error！！！")})},e.logoutCs=function(){},e.getLocalData=function(){n(function(){r.loadMessages(kefuData)},1200)},e.getMsg=function(){var t=d.defer();return r.getMsg(e.token).then(function(o){o&&o.data&&o.data.msgs&&0!=o.data.msgs.length?(angular.forEach(o.data.msgs,function(e,t){r.filtMsg(e),"close"==e.ty||e.ty}),r.loadMessages(o.data.msgs),e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId),t.resolve(1)):0==!o.data.msgs.length?t.resolve(1):t.reject(1)}),t.promise},e.sendMsg=function(){var t=e.CustumerParam.msg;return e.chatId&&e.receiverId?t?void r.sendMsg(e.chatId,e.receiverId,"m",t,e.token).then(function(o){if(o&&o.data&&0==o.data.rt){var i={msg:t,ty:"message"};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=""}else alert("发送信息失败")}):void l.showToast("发送消息不能为空"):void alert("no chatId or receiverId ---sendMsg failed!")},e.getImg=function(e){v.getPicture(e,I,$)},e.startRecord=function(){v.startCapture("sourceInSC","audioInSC")},e.deleteRecord=function(){v.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),v.stopCapture("sourceInSC","audioInSC",e.transfer)},e.play=function(){var e=document.getElementById("audioInSC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.cId,o=v.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),S.upload(o,t,void 0,void 0,void 0,{},b,A)};var b=function(t){var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.message="音频文件",o.data.msg=o.data.imageUrl;var s={imageUrl:i,fileType:".wav",msg:"音频文件"};e.deleteRecord(),e.$apply(function(){e.messages.push(s)}),r.sendMsg(e.chatId,e.receiverId,"m",i,e.token).then(function(t){t&&t.data&&0==t.data.rt||alert("发送信息失败"),e.loopGetMsg()})},A=function(t){e.loopGetMsg(),alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("contentS").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("contentS");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,i){e.init(),e.footerStyle={bottom:"0px"},t.chatScope=o,n(function(){e.loopGetMsg()},3e3),window.addEventListener("native.keyboardshow",T),window.addEventListener("native.keyboardhide",C),v.addAudioEventOnWindow()}),e.$on("$ionicView.afterEnter",function(t,o){e.$broadcast("$ionicParentView.afterEnter",{who:t})}),e.$on("$ionicView.beforeLeave",function(){v.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",T),window.removeEventListener("native.keyboardhide",C),e.killTimer()})}]),APP.service("ServiceConversationService",["$http","UrlService",function(e,t){function o(e,t){r.entrySet[e]=t,r.count++}function i(e){return r.entrySet[e]}function s(e){for(var t in r.entrySet)if(t===e)return!0;return!1}function n(e){s(e)&&(delete r.entrySet[e],r.count--)}function a(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var r={count:0,entrySet:{}};this.isEmptyMap=function(){return 0===r.count},this.put=o,this.get=i,this.containsKey=s,this.remove=n,this.loadMessages=function(e){if(e&&angular.isArray(e))for(var t,n,a,r=0;r<e.length;r++)t=e[r],n=t.ci+"$"+t.fr+"$"+t.to,s(n)?(a=i(n),angular.isArray(a)&&a.push(t)):o(n,[t])},r.all=[],this.getAll=function(){for(var e in r.entrySet)r.all=r.all.concat(r.entrySet[e]);return r.all},this.getEntrySet=function(){return r.entrySet};var c="http://123.56.3.136:8181/api/invoke";this.login=function(t){return e({method:"POST",url:c,params:t})},this.kefulogin=function(t){return e({method:"POST",url:c,params:{c:"li",u:t}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e({method:"POST",url:c,params:{c:"re",token:t,noLoading:!0}})},this.filtMsg=function(e){"EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0);if(e.msg&&e.msg.indexOf("$prodLink")>-1){e.fileType="prodLink";var t=e.msg.substring(9),o=JSON.parse(t);e.prodObj=o}else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("[")>-1&&e.msg.indexOf("]")>-1)for(var i=1;i<16;i++)e.msg=a(e.msg,i)};var l=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.sendMsg=function(t,o,i,s,n){return e({method:"POST",url:c,params:{c:"sd",ci:t,to:o,ty:i,msg:s,token:n}})}}]),APP.directive("resizeFootBars",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-s"),n=e.$getByHandle("scScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),APP.controller("ShareListPageController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService",function(e,t,o,i,s,n,a,r,c,l,d,u){e.input={keywords:""},e.iconShow=!0,e.members=[],e.originData=void 0,e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.originData=i.sl,e.members=e.originData.shareMsgsList}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("TestDetailsController",["$scope","$rootScope","$state","$stateParams","TestDetailsService","PopupService","$timeout","$ionicModal",function(e,t,o,i,s,n,a,r){e.examQuestionList={},e.selectedOptions=[],e.summitOptions=[],e.testResult="",e.init=function(){r.fromTemplateUrl("templates/quanzi/CommitTestPaperModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.commitPaperModal=t}),e.showTestDetails(),e.getTestResult()},e.showTestDetails=function(){var t={courseId:1};s.getTestList(t).success(function(t){e.index=0,e.examQuestionList=t.data.list})},e.getTestResult=function(){var t={courseId:1};s.getTestResult(t).success(function(t){e.testResult=t.data.list})},e.jumpQuestionDetail=function(t){e.index=t-1},e.beforeQuestion=function(){e.index-=1},e.nextQuestion=function(){e.index+=1,e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,respondentsAnswer:e.summitCourseId?e.summitOptions:""};s.getTestList(t).success(function(t){e.selectedOptions=[];for(var o=e.examQuestionList[e.index].respondentsAnswer.split(","),i=0;i<o.length;i++)e.selectedOptions.push(o[i])})},e.submitPaper=function(){e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,submitPaperFlag:1,respondentsAnswer:e.summitCourseId?e.summitOptions:""};s.getTestList(t).success(function(t){e.selectedOptions=[]}).error(function(e){n.showToast(e.message)})},e.selectAnswer=function(t,o){if(e.examId=e.examQuestionList[t].id,e.summitCourseId=e.examQuestionList[t].courseId,"单选"==e.examQuestionList[t].subjectType){for(var i=0;i<e.examQuestionList[t].optionsList.length;i++)e.examQuestionList[t].optionsList[i].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}else if("多选"==e.examQuestionList[t].subjectType)if(1==e.examQuestionList[t].optionsList[o].isSelect)for(var i=0;i<e.selectedOptions.length;i++)e.selectedOptions[i]==e.examQuestionList[t].optionsList[o].optionsName&&(e.examQuestionList[t].optionsList[o].isSelect=!1,e.selectedOptions.splice(i,1),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString());else e.examQuestionList[t].optionsList[o].isSelect=!e.examQuestionList[t].optionsList[o].isSelect,e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString();else if("判断"==e.examQuestionList[t].subjectType){for(var i=0;i<e.examQuestionList[t].optionsList.length;i++)e.examQuestionList[t].optionsList[i].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}},e.showCommitPaper=function(){e.commitPaperModal.show()},e.hideCommitPaper=function(){e.commitPaperModal.hide()},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestDetailsService",["$http","UrlService",function(e,t){this.getTestList=function(o){return e({method:"POST",url:t.getUrl("TEST_LIST"),data:o})},this.getTestResult=function(o){return e({method:"POST",url:t.getUrl("TEST_CONSULT"),data:o})}}]),APP.controller("TestPageController",["$scope","$rootScope","$state","$stateParams","TestPageService","PopupService","$timeout",function(e,t,o,i,s,n,a){e.essentialInfo={},e.init=function(){e.getEssentialInfo()},e.toTestDetails=function(){o.go("testDetails")},e.getEssentialInfo=function(){var t={courseId:1};s.getEssentialInfo(t).success(function(t){e.essentialInfo=t.data.list})},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestPageService",["$http","UrlService",function(e,t){this.getEssentialInfo=function(o){return e({method:"POST",url:t.getUrl("TEST_ESSENTIAL_INFORMATION"),data:o})}}]),APP.controller("TopicController",["$scope","$rootScope","$ionicHistory","$state","TopicService","$localstorage",function(e,t,o,i,s,n){t.xiaoxis=!1,e.shuxiaoxi=!1,e.count=0,t.msgCount="",e.init=function(){e.tabNav="qhot",s.getxiaoxi().success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.onTabSelected=function(){t.xiaoxis=!1},e.open=function(){var e="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+n.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=e);window.emc.presentH5View(e,"创意社区")}}]),APP.service("TopicService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("TopicdetailsController",["$scope","$rootScope","$ionicHistory","TopicdetailsService","$http","$ionicSlideBoxDelegate","$stateParams","$sce","$ionicScrollDelegate","$timeout",function(e,t,o,i,s,n,a,r,c,l){e.tielist="",e.pinglunlist="",e.isshow=!1,e.xxshow=!1,e.huatiid="",e.xiaoxis=!1,e.userlist="",e.topicheight=0,e.pinglunis=!1,e.count="",e.dianzans="",t.showRightTop=!1,e.goBack=function(){e.$ionicGoBack()},e.pinglunshow=function(){var t=c.$getByHandle("pinglun"),o=t.getScrollPosition(),i=o.top,s=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-s,l(function(){e.pinglunis=i>e.topicheight},200)},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis},e.addImage=function(){$ionicActionSheet.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function i(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},e.gotoxiaoxi=function(){$state.go("qzMessageCenter"),e.isshow=!1,e.xxshow=!1},e.dianzan=function(){var t={id:e.huatiid};i.dianzan(t).success(function(t,o,i,s){e.dianzans=t.success})},e.init=function(){e.huatiid=a.huatiid;var o={pageIndex:1,pageSize:5,id:0};i.getpinglun(o).success(function(t,o,i,s){return e.pinglunlist=t.data.list,t});var s={id:e.huatiid};i.gettieData(s).success(function(t,o,i,s){return e.tielist=t.data,t}).error(function(){}),i.getdianzan(s).success(function(t,o,i,s){e.count=t.data}).error(function(){}),i.getxiaoxi(s).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init(),e.huatiid=a.huatiid})}]),APP.service("TopicdetailsService",["$http","UrlService",function(e,t){this.gettieData=function(o){return e.post(t.getUrl("GETSTORYINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getdianzan=function(o){return e.post(t.getUrl("GETSTORYPRAISEANDUNREAD"),o)},this.dianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.getpinglun=function(o){return e.post(t.getUrl("GETSTORYCOMMENT"),o)}}]),APP.directive("audioPanel",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/AudioPanel.html",scope:!0,link:function(e,t,o){}}}),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","$ionicPopup",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){try{e&&e.data&&(w?(I+=e.data.length,S=S.concat(e.data)):(I=e.data.length,S=e.data,w=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function h(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=1,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.isShowRecord=!1,e.CustumerParam={msg:"说点什么"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.userInCC=c.getUser(),r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t=d.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++){if(o.data.msgs[i].message&&o.data.msgs[i].message.indexOf("http")>-1&&o.data.msgs[i].message.indexOf(".jpg")>-1)o.data.msgs[i].fileType=".jpg",o.data.msgs[i].imageUrl=o.data.msgs[i].message;else if(o.data.msgs[i].message&&o.data.msgs[i].message.indexOf("http")>-1&&o.data.msgs[i].message.indexOf(".wav")>-1){o.data.msgs[i].fileType=".wav";var s=o.data.msgs[i].message;o.data.msgs[i].imageUrl=g.trustAsResourceUrl(s)}e.messages.push(o.data.msgs[i])}t.resolve(1)}else t.reject(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};r.sendMsg(t).then(function(o){e.messages.push({message:t.msg})},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(){var t={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:"2",desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(t).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var o={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(o).then(function(e){if(e);},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.sendPic=function(){u.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){function o(t){alert("getPicSuccess"),e.avatarImage=t;var o=function(t){p.hide(),l.showToast("上传成功");var o=JSON.parse(t.response);e.avatarImage=o.data.imageUrl,o.data.message="拍照图片",e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},i=function(e){p.hide(),l.showToast("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var n={};n.userName="18560683520",s.params=n,(new FileTransfer).upload(t,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,i,s)}function i(e){alert(e)}function s(t){e.avatarImage=t;var o=function(t){l.showToast("上传成功"),p.hide();var o=JSON.parse(t.response);o.data.message="相册图片",e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},i=function(e){l.showToast("上传失败"),p.hide()},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var n={};n.userName="18560683520",s.params=n,(new FileTransfer).upload(e.avatarImage,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,i,s)}function n(e){}return 0==t?navigator.camera.getPicture(o,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==t&&navigator.camera.getPicture(s,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})};var v={},S=[],I=0;window.URL=window.URL||window.webkitURL;var $="",w=!0;e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1};var y=function(){try{window.audioinput&&!audioinput.isCapturing()&&(v={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(v));m.alert({title:"开始录音",template:"录音已经开始，按下确定结束"}).then(function(e){T()})}catch(e){alert("startCapture exception: "+e)}};e.startRecord=y;var T=function(){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),I=0;var e=new WavAudioEncoder(v.sampleRate,v.channels);e.encode([S]);var t=e.finish("audio/wav");window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory,function(e){e.getFile("xuftest123.wav",{create:!0},function(e){e.createWriter(function(o){o.write(t),setTimeout(function(){$=e.toURL(),document.getElementById("source").src=$,document.getElementById("audio").load()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};e.endRecord=T;var C=function(){window.resolveLocalFileSystemURL($,function(e){e.remove(function(){alert("delete success"),w=!1,document.getElementById("source").src="",document.getElementById("audio").load()},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};e.deleteRecord=C;var b=function(){alert("start transfer");var t=function(t){alert("上传成功");var o=JSON.parse(t.response);o.data.message="音频文件",o.data.imageUrl=g.trustAsResourceUrl(o.data.imageUrl),e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},o=function(e){alert("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName="aaa";var s={};s.userName="18560683520",i.params=s;var n=new FileTransfer,a="http://123.56.3.136:8088/live/receive.jsp?fileType=.wav&chatId="+e.chatId+"&cId=1";n.upload($,encodeURI(a),t,o,i)};e.transfer=b,e.$on("$ionicView.beforeEnter",function(){e.init(),window.addEventListener("audioinput",f,!1),window.addEventListener("audioinputerror",h,!1),e.messages=[]}),e.$on("$ionicView.afterEnter",function(){}),e.$on("$ionicView.beforeLeave",function(){window.removeEventListener("audioinput",f),window.removeEventListener("audioinputerror",h),e.killTimer()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("CustomerConversationService",["$http","UrlService",function(e,t){var o="http://123.56.3.136:8088";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8088/live//msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.getUUID=function(){return e.get(o+"/live/getVistorId.dll")},this.opinion=function(t){return e.get(o+"/live/msg.dll",t)},this.endChat=function(t){return e.get(o+"/live/msg.dll",t)},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)},this.upload=function(){},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)}}]);var fangkeData=[{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:null,event:!0,exts:{},fromUserId:"admin",message:"admin",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"EVENT_ACCEPT",viewUserId:"admin"},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"hhah",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",
message:"http://123.56.3.136:8088/file/1/20161229/24521483014076122.jpg",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014105480.wav",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null}];APP.controller("examCtrl",["$scope","$state","examService","NoteDetailsService",function(e,t,o,i){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.optionLetter=["A.","B.","C.","D."],e.answer=["a","b","c","d"],e.showWhich=[],e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.init=function(){e.isDisplay=!1,e.Qs=o.getQs(),e.showWhich[0]=!0,i.getxiaoxi().success(function(t,o,i,s){e.messageNum=t.data.count,e.ifRed=parseInt(t.data.count)}).error(function(e,t,o,i){alert("网络失败！")})},e.chooseWhich=function(t){e.showWhich=[],e.showWhich[t]=!0},e.$on("myIndex",function(t,o){e.$broadcast("yourIndex",o)}),e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("examService",[function(){var e=[{family:"一",questions:[{description:"题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目二题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目三题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目四题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目五题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目六题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目七题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]}]},{family:"二",questions:[{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"三",questions:[{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"四",questions:[{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]}];this.getQs=function(){return e}}]),APP.directive("eachRepeat",function(){return{link:function(e,t,o){e.$emit("myIndex",e.$index+1)}}}),APP.directive("receiveIndex",function(){return{link:function(e,t,o){e.$on("yourIndex",function(e,t){})}}}),APP.controller("heIssueController",["$http","$scope","$location","$anchorScroll","$cacheFactory","heIssueService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","personalHomepageHeService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T){function C(e,o,i,s){n.getMyIssue(e,o,i,s).success(function(e){1==e.success&&(t.issueData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function b(e,o,i,s){n.getMyComment(e,o,i,s).success(function(e){1==e.success&&(t.commentData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.commentList=t.commentList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function A(e,o,i){n.getMyStory(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function P(e,o,i){n.getDaShang(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.DaShangData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.DaShangList=t.DaShangList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function L(e,o,i){n.getCollection(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.CollectionList=t.CollectionList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function x(e){n.getMyJoinedTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function D(e){n.getMyCreatTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function N(e,o,i){n.getUserPraise(e,o,i).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.UserPraiseList=t.UserPraiseList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}t.titles=[{title:"TA的发布"},{title:"TA的评论"},{title:"TA的原创"}],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){t.$ionicGoBack()},t.hasmore=!1,t.init=function(e,o,i){t.cuurentUserId=o,t.pageIndex=1,t.pageSize=5,t.pageSize10=10,"original"==e?A(t.pageIndex,t.pageSize,t.cuurentUserId):"issue"==e?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"comment"==e?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"dashang"==e?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==e?L(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==e?1==i?D(t.cuurentUserId):0==i&&x(t.cuurentUserId):"zan"==e&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.loadMore=function(){"comment"==a.title?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"issue"==a.title?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"original"==a.title?A(t.pageIndex,t.pageSize,t.cuurentUserId):"dashang"==a.title?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==a.title?L(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==a.title?0==t.chooseQuanIndex?D(t.cuurentUserId):1==t.chooseQuanIndex&&x(t.cuurentUserId):"zan"==a.title&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.$on("$ionicView.beforeEnter",function(e,o){if("back"!=o.direction){switch(h.scrollTop(),t.chooseIndex=0,t.issueList=[],t.issueType=0,t.chooseComIndex=0,t.chooseQuanIndex=0,t.quanziTitle="加入",t.chooseResuIndex=0,t.commentList=[],t.commentType=0,t.MyStoryList=[],t.DaShangList=[],t.CollectionList=[],t.myTopicList=[],t.UserPraiseList=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=a.memberId,"his"==a.who?t.titleStart="TA":"mine"==a.who&&(t.titleStart="我"),a.title){case"issue":t.titleEnd="的发布";break;case"comment":t.titleEnd="的评论";break;case"original":t.titleEnd="的原创";break;case"dashang":t.titleEnd="的打赏";break;case"quanzi":t.titleEnd="的圈子";break;case"zan":t.titleEnd="的赞";break;case"shoucang":t.titleEnd="的收藏";break;default:t.titleEnd="的发布"}t.init(a.title,a.id,0)}}),t.chooseTab=function(e){h.scrollTop(),t.page=2,0==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):1==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):2==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):3==e&&(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType))},t.chooseComTab=function(e){h.scrollTop(),0==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType)):1==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType)):2==e&&(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType))},t.chooseQuanTab=function(e){0==e?(t.myTopicList=[],t.chooseQuanIndex=0,t.quanziTitle="加入",t.init("quanzi",a.id,0)):1==e&&(t.myTopicList=[],t.chooseQuanIndex=1,t.quanziTitle="创建",t.init("quanzi",a.id,1))},t.toNoteDetails=function(e,t){c.go("noteDetails",{noteId:e,isShortStory:t})},t.CommentDetails=function(e){2==e.flag?c.go("classNoteDetails",{noteId:e.storyId}):c.go("noteDetails",{noteId:e.storyId,isShortStory:e.isShortStory})},t.viewStory=function(e){2!==e.flag?c.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):c.go("classNoteDetails",{noteId:e.id})},t.topicPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:a.circleId}),f.gio.track("active",{circleID:a.circleId}));var i={id:e,noLoading:!0};n.pushPraise(i).success(function(e){1==e.success?1==t.MyStoryList[o].praiseFlag?(t.MyStoryList[o].praiseNumber=t.MyStoryList[o].praiseNumber-1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):(t.MyStoryList[o].praiseNumber=parseInt(t.MyStoryList[o].praiseNumber)+1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.CollectionPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:a.circleId}),f.gio.track("active",{circleID:a.circleId}));var i={id:e.id,noLoading:!0};1==e.flag&&n.pushPraise(i).success(function(e){1==e.success?1==t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)}),2==e.flag&&n.SchoolPraise(i).success(function(e){1==e.success?0!=t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.dealStory=function(e,o){var i;i=2!==e.flag?o:1==o?3:4;var s=e.storyTopicId?e.storyTopicId:e.id;T.dealStory(s,i).then(function(o){if(1==o.data.success){var n;switch(i){case 1:n=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?n-1:n+1,e.praiseFlag=!e.praiseFlag;break;case 2:n=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?n-1:n+1,e.collectionFlag=!e.collectionFlag;for(var a=0;a<t.CollectionList.length;a++)s==t.CollectionList[a].id&&t.CollectionList.splice(a,1);break;case 3:n=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?n-1:n+1,e.praiseFlag=!e.praiseFlag;break;case 4:for(n=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?n-1:n+1,e.collectionFlag=!e.collectionFlag,a=0;a<t.CollectionList.length;a++)s==t.CollectionList[a].id&&t.CollectionList.splice(a,1)}}},function(){w.showToast("网络错误！")})},t.viewTopic=function(e){c.go("circlePage",{circleId:e})},t.gotoqSearch=function(){c.go("qSearch")}}]),APP.service("heIssueService",["$http","UrlService",function(e,t){this.getMyIssue=function(o,i,s,n){return e({method:"post",url:t.getUrl("GET_USER_ISSUE_LIST"),data:{pageIndex:o,pageSize:i,userId:s,storyType:n}})},this.getMyStory=function(o,i,s){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyComment=function(o,i,s,n){return e({method:"post",url:t.getUrl("GET_MY_COMMENT_LIST"),data:{pageIndex:o,pageSize:i,userId:s,commentType:n}})},this.myCommentId="",this.getDaShang=function(o,i,s){return e({method:"post",url:t.getUrl("GET_UCTIP_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getCollection=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_JOINTOPIC_LIST"),data:{userCode:o}})},this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_CREATETOPIC_LIST"),data:{userCode:o}})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.SchoolPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.getUserPraise=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_PRAISE_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.filter("commentArrImg",function(){return function(e){return e.split(",")}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".padding_zero {\n  padding: 0;\n}\n\n.ionic_datepicker_popup .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_popup .padding_top_zero {\n  padding-top: 0;\n}\n.ionic_datepicker_popup .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_popup .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_popup .calendar_grid {\n  height: 215px;\n}\n.ionic_datepicker_popup .today {\n  border: 1px solid #009688;\n  border-radius: 50%;\n}\n.ionic_datepicker_popup .selected_date {\n  background-color: #009688;\n  border-radius: 50%;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_popup .popup-head {\n  background-color: #009688;\n  display: none;\n}\n.ionic_datepicker_popup .popup-head .popup-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-head .popup-sub-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body {\n  background-color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body .selected_date_full {\n  background-color: #019688;\n  margin: -10px -10px 0 -10px;\n  height: 45px;\n  text-align: center;\n  font-weight: bold;\n  color: #fff;\n  line-height: 45px;\n  font-size: 18px;\n}\n.ionic_datepicker_popup .popup-body .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_popup .popup-body .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_popup .popup-body .month_select, .ionic_datepicker_popup .popup-body .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select .input-label, .ionic_datepicker_popup .popup-body .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select select, .ionic_datepicker_popup .popup-body .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select:after, .ionic_datepicker_popup .popup-body .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-body .show_nav {\n  padding: 10px 0 0 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section {\n  padding: 5px 0;\n  text-align: left;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section {\n  padding: 5px 0;\n  text-align: right;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 45px;\n}\n.ionic_datepicker_popup .popup-buttons button {\n  background-color: #009688;\n  border-radius: 0;\n  margin-right: 1px;\n  color: #ffffff;\n}\n\n.ionic_datepicker_modal .header, .ionic_datepicker_modal .footer {\n  background-color: #009688;\n}\n.ionic_datepicker_modal .header .title, .ionic_datepicker_modal .header .button, .ionic_datepicker_modal .footer .title, .ionic_datepicker_modal .footer .button {\n  color: #ffffff;\n}\n.ionic_datepicker_modal .footer .button-block {\n  margin: 0;\n}\n.ionic_datepicker_modal .today {\n  border: 1px solid #009688;\n}\n.ionic_datepicker_modal .selected_date {\n  background-color: #009688;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_modal .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_modal .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_modal .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_modal .month_select, .ionic_datepicker_modal .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_modal .month_select .input-label, .ionic_datepicker_modal .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_modal .month_select select, .ionic_datepicker_modal .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0 10px;\n}\n.ionic_datepicker_modal .month_select:after, .ionic_datepicker_modal .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_modal .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_modal .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_modal .date_col {\n  height: 50px;\n  line-height: 50px;\n}\n.ionic_datepicker_modal .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_modal .font_22px {\n  font-size: 22px;\n}\n.platform-android .ionic_datepicker_modal .bar .title.title-left {\n  text-align: center;\n}\n.platform-android .ionic_datepicker_modal select {\n  left: 25%;\n}\n.platform-ios .ionic_datepicker_modal select {\n  left: 5%;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-modal.html",'<ion-modal-view class="ionic_datepicker_modal">\n  <ion-header-bar class="header">\n    <h1 class="title">{{selctedDateEpoch | date : mainObj.dateFormat}}</h1>\n  </ion-header-bar>\n  <ion-content class="ionic_datepicker_modal_content">\n    <div class="">\n      <div class="row text-center">\n        <div class="col col-10 left_arrow">\n          <button class="button-clear font_22px" ng-click="prevMonth()"\n                  ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n            <i class="icon ion-chevron-left"></i>\n          </button>\n        </div>\n        <div class="col col-80 text-center">\n          <div class="row select_section">\n            <div class="col-50 padding_right_5px">\n              <label class="item item-input item-select month_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n                  <option ng-repeat="month in monthsList" ng-selected="month == currentMonthSelected" value="{{month}}">\n                    {{month}}\n                  </option>\n                </select>\n              </label>\n            </div>\n            <div class="col-50 padding_left_5px">\n              <label class="item item-input item-select year_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class="col col-10 right_arrow">\n          <button class=" button-clear font_22px" ng-click="nextMonth()"\n                  ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n            <i class="icon ion-chevron-right"></i>\n          </button>\n        </div>\n      </div>\n      <div class="calendar_grid">\n        <div class="row padding-top weeks_row">\n          <div class="col text-center font_bold"\n               ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n        </div>\n        <div>\n          <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n            <div class="col padding_zero date_col" ng-repeat="col in cols track by $index"\n                 ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || (dayList[row + $index].disabled))}"\n                 ng-click="dateSelected(dayList[row + $index])">\n              <div class="date_cell">\n                {{dayList[row + col].date}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n  <ion-footer-bar class="footer">\n    <div class="row padding_zero">\n      <button class="button button-clear button-block button_set" ng-if="!mainObj.closeOnSelect"\n              ng-click="setIonicDatePickerDate()">{{mainObj.setLabel}}\n      </button>\n      <button class="button button-clear button-block button_today"  ng-if="mainObj.showTodayButton"\n              ng-click="setIonicDatePickerTodayDate()">{{mainObj.todayLabel}}\n      </button>\n      <button class="button button-clear button-block button_close"\n              ng-click="closeIonicDatePickerModal()">{{mainObj.closeLabel}}\n      </button>\n    </div>\n  </ion-footer-bar>\n</ion-modal-view>\n')}]),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-popup.html",'<div class="selected_date_full">{{selctedDateEpoch | date : mainObj.dateFormat}}</div>\n<div class="date_selection">\n  <div class="row show_nav">\n    <div class="col-10 prev_btn_section">\n      <button class="button-clear" ng-click="prevMonth()"\n              ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n        <i class="icon ion-chevron-left"></i>\n      </button>\n    </div>\n    <div class="col-80 text-center">\n      <div class="row select_section">\n        <div class="col-50 padding_right_5px">\n          <label class="item item-input item-select month_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n              <option ng-repeat="month in monthsList" ng-selected="month==currentMonthSelected" value="{{month}}">\n                {{month}}\n              </option>\n            </select>\n          </label>\n        </div>\n        <div class="col-50 padding_left_5px">\n          <label class="item item-input item-select year_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n          </label>\n        </div>\n      </div>\n    </div>\n    <div class="col-10 next_btn_section">\n      <button class="button-clear" ng-click="nextMonth()"\n              ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n        <i class="icon ion-chevron-right"></i>\n      </button>\n    </div>\n  </div>\n  <div class="calendar_grid">\n    <div class="row weeks_row">\n      <div class="col text-center font_bold"\n           ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n    </div>\n    <div>\n      <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n        <div class="col no_padding date_col" ng-repeat="col in cols track by $index"\n             ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || dayList[row + $index].disabled)}"\n             ng-click="dateSelected(dayList[row + $index])">\n          <div class="date_cell">\n            {{dayList[row + col].date}}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),APP.provider("ionicDatePicker2",function(){var e={inputDate:new Date,from:new Date(2012,8,1),to:new Date(2018,8,1),setLabel:"确定",todayLabel:"今天",closeLabel:"关闭",mondayFirst:!0,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],templateType:"popup",dateFormat:"yyyy-MM-dd",showTodayButton:!1,closeOnSelect:!1,disableWeekdays:[]};this.configDatePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup","$ionicModal","IonicDatepickerService2",function(t,o,i,s){function n(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function a(e){e.disabledDates&&0!==e.disabledDates.length?(p.disabledDates=[],angular.forEach(e.disabledDates,function(e,t){e=n(new Date(e)),p.disabledDates.push(e.getTime())})):p.disabledDates=[]}function r(e){e=n(e),p.currentDate=angular.copy(e);var t=new Date(e.getFullYear(),e.getMonth(),1).getDate(),o=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();p.monthsList=[],p.mainObj.monthsList&&12===p.mainObj.monthsList.length?p.monthsList=p.mainObj.monthsList:p.monthsList=s.monthsList,p.yearsList=s.getYearsList(p.mainObj.from,p.mainObj.to),p.dayList=[];var i,a;p.firstDayEpoch=n(new Date(e.getFullYear(),e.getMonth(),t)).getTime(),p.lastDayEpoch=n(new Date(e.getFullYear(),e.getMonth(),o)).getTime();for(var r=t;r<=o;r++)i=new Date(e.getFullYear(),e.getMonth(),r),a=i.getTime()<p.fromDate||i.getTime()>p.toDate||p.mainObj.disableWeekdays.indexOf(i.getDay())>=0,p.dayList.push({date:i.getDate(),month:i.getMonth(),year:i.getFullYear(),day:i.getDay(),epoch:i.getTime(),disabled:a});var c=p.dayList[0].day-p.mainObj.mondayFirst;c=c<0?6:c;for(var l=0;l<c;l++)p.dayList.unshift({});p.rows=[0,7,14,21,28,35],p.cols=[0,1,2,3,4,5,6],p.currentMonth=p.mainObj.monthsList[e.getMonth()],p.currentYear=e.getFullYear(),p.currentMonthSelected=angular.copy(p.currentMonth),p.currentYearSelected=angular.copy(p.currentYear),p.numColumns=7}function c(e){p.mainObj=angular.copy(e),p.selctedDateEpoch=n(p.mainObj.inputDate).getTime(),p.mainObj.weeksList&&7===p.mainObj.weeksList.length?p.weeksList=p.mainObj.weeksList:p.weeksList=["S","M","T","W","T","F","S"],p.mainObj.mondayFirst&&p.weeksList.push(p.mainObj.weeksList.shift()),p.disableWeekdays=p.mainObj.disableWeekdays,r(p.mainObj.inputDate),a(p.mainObj)}function l(){p.modal.show()}function d(){p.modal.hide()}var u={},p=t.$new();return p.today=n(new Date).getTime(),p.disabledDates=[],p.prevMonth=function(){1===p.currentDate.getMonth()&&p.currentDate.setFullYear(p.currentDate.getFullYear()),p.currentDate.setMonth(p.currentDate.getMonth()-1),p.currentMonth=p.mainObj.monthsList[p.currentDate.getMonth()],p.currentYear=p.currentDate.getFullYear(),r(p.currentDate)},p.nextMonth=function(){11===p.currentDate.getMonth()&&p.currentDate.setFullYear(p.currentDate.getFullYear()),p.currentDate.setDate(1),p.currentDate.setMonth(p.currentDate.getMonth()+1),p.currentMonth=p.mainObj.monthsList[p.currentDate.getMonth()],p.currentYear=p.currentDate.getFullYear(),r(p.currentDate)},p.dateSelected=function(e){e&&0!==Object.keys(e).length&&(p.selctedDateEpoch=e.epoch,
p.mainObj.closeOnSelect&&(p.mainObj.callback(p.selctedDateEpoch),"popup"==p.mainObj.templateType.toLowerCase()?p.popup.close():d()))},p.setIonicDatePickerTodayDate=function(){var e=new Date;r(new Date),p.selctedDateEpoch=n(e).getTime(),p.mainObj.closeOnSelect&&(p.mainObj.callback(p.selctedDateEpoch),d())},p.setIonicDatePickerDate=function(){p.mainObj.callback(p.selctedDateEpoch),d()},p.monthChanged=function(e){var t=p.monthsList.indexOf(e);p.currentDate.setMonth(t),r(p.currentDate)},p.yearChanged=function(e){p.currentDate.setFullYear(e),r(p.currentDate)},i.fromTemplateUrl("ionic-datepicker-modal.html",{scope:p,animation:"slide-in-up"}).then(function(e){p.modal=e}),p.$on("$destroy",function(){p.modal.remove()}),p.closeIonicDatePickerModal=function(){d()},u.openDatePicker=function(t){var i=[];delete p.fromDate,delete p.toDate,p.mainObj=angular.extend({},e,t),p.mainObj.from&&(p.fromDate=n(new Date(p.mainObj.from)).getTime()),p.mainObj.to&&(p.toDate=n(new Date(p.mainObj.to)).getTime()),t.disableWeekdays&&e.disableWeekdays&&(p.mainObj.disableWeekdays=t.disableWeekdays.concat(e.disableWeekdays)),c(p.mainObj),p.mainObj.closeOnSelect||(i=[{text:p.mainObj.setLabel,type:"button_set",onTap:function(e){p.mainObj.callback(p.selctedDateEpoch)}}]),p.mainObj.showTodayButton&&i.push({text:p.mainObj.todayLabel,type:"button_today",onTap:function(e){var t=new Date;r(new Date),p.selctedDateEpoch=n(t).getTime(),p.mainObj.closeOnSelect||e.preventDefault()}}),i.push({text:p.mainObj.closeLabel,type:"button_close",onTap:function(e){}}),"popup"==p.mainObj.templateType.toLowerCase()?(p.currentYear=(new Date).getFullYear(),p.popup=o.show({templateUrl:"ionic-datepicker-popup.html",scope:p,cssClass:"ionic_datepicker_popup",buttons:i})):l()},u}]}),APP.service("IonicDatepickerService2",function(){this.monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"],this.getYearsList=function(e,t){var o=[],i=1900,s=2100;i=e?new Date(e).getFullYear():i,s=t?new Date(t).getFullYear():s;for(var n=i;n<=s;n++)o.push(n);return o}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".ionic_timepicker_popup .font_28px {\n  font-size: 28px;\n}\n.ionic_timepicker_popup .margin_zero {\n  margin: 0;\n}\n.ionic_timepicker_popup .padding_zero {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup {\n  background-color: #ffffff;\n}\n.ionic_timepicker_popup .popup-head {\n  display: none;\n}\n.ionic_timepicker_popup .popup-body {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 44px;\n  height: 44px;\n}\n.ionic_timepicker_popup .popup-buttons .button:not(:last-child) {\n  margin-right: 1px;\n}\n.ionic_timepicker_popup .padding_left_15px {\n  padding-left: 15px;\n}\n.ionic_timepicker_popup .heading {\n  height: 44px;\n  background-color: #009688;\n  color: #ffffff;\n  text-align: center;\n  line-height: 44px;\n  font-size: 18px;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_colon {\n  padding-top: 45px;\n  text-align: center;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_arrows {\n  width: 100%;\n}\n.ionic_timepicker_popup .time_picker_box_text {\n  height: 40px;\n  text-align: center;\n  border: 1px solid #dddddd;\n  font-size: 16px;\n  line-height: 38px;\n}\n.ionic_timepicker_popup .overflowShow {\n  white-space: normal !important;\n}\n.ionic_timepicker_popup .button_set, .ionic_timepicker_popup .button_close {\n  background-color: #009688;\n  color: #ffffff;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-timepicker.html",'<div><div class=heading>{{time.hours}} : {{time.minutes}} <span ng-show="time.format == 12">{{time.meridian}}</span></div><div class=row ng-class="{\'padding_left_15px\':time.format == 12}"><div class="col col-25" ng-class="{\'col-offset-20 col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseHours()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.hours class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseHours()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon">:</label><div class="col col-25" ng-class="{\'col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseMinutes()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.minutes class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseMinutes()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon" ng-if="time.format == 12">:</label><div class="col col-25" ng-if="time.format == 12"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.meridian class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-down"></i></button></div></div></div>')}]),APP.provider("ionicTimePicker",function(){var e={setLabel:"确定",closeLabel:"关闭",inputTime:60*(new Date).getHours()*60+60*(new Date).getMinutes(),format:24,step:1};this.configTimePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup",function(t,o){function i(e,t){n.time.hours=Math.floor(e/3600);var o=e%3600;12==t&&(n.time.hours>12?(n.time.hours-=12,n.time.meridian="PM"):n.time.meridian="AM"),n.time.minutes=o/60,n.time.hours=n.time.hours.toFixed(0),n.time.minutes=n.time.minutes.toFixed(0),1==n.time.hours.toString().length&&(n.time.hours="0"+n.time.hours),1==n.time.minutes.toString().length&&(n.time.minutes="0"+n.time.minutes),n.time.format=n.mainObj.format}var s={},n=t.$new();return n.today=function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}(new Date).getTime(),n.time={},n.increaseHours=function(){n.time.hours=Number(n.time.hours),12==n.mainObj.format&&(12!=n.time.hours?n.time.hours+=1:n.time.hours=1),24==n.mainObj.format&&(n.time.hours=(n.time.hours+1)%24),n.time.hours=n.time.hours<10?"0"+n.time.hours:n.time.hours},n.decreaseHours=function(){n.time.hours=Number(n.time.hours),12==n.mainObj.format&&(n.time.hours>1?n.time.hours-=1:n.time.hours=12),24==n.mainObj.format&&(n.time.hours=(n.time.hours+23)%24),n.time.hours=n.time.hours<10?"0"+n.time.hours:n.time.hours},n.increaseMinutes=function(){n.time.minutes=Number(n.time.minutes),n.time.minutes=(n.time.minutes+n.mainObj.step)%60,n.time.minutes=n.time.minutes<10?"0"+n.time.minutes:n.time.minutes},n.decreaseMinutes=function(){n.time.minutes=Number(n.time.minutes),n.time.minutes=(n.time.minutes+(60-n.mainObj.step))%60,n.time.minutes=n.time.minutes<10?"0"+n.time.minutes:n.time.minutes},n.changeMeridian=function(){n.time.meridian="AM"===n.time.meridian?"PM":"AM"},s.openTimePicker=function(t){var s=[];n.mainObj=angular.extend({},e,t),i(n.mainObj.inputTime,n.mainObj.format),s.push({text:n.mainObj.setLabel,type:"button_set",onTap:function(e){var t=0;12==n.time.format?(n.time.hours=Number(n.time.hours),"PM"==n.time.meridian&&12!=n.time.hours?n.time.hours+=12:"AM"==n.time.meridian&&12==n.time.hours&&(n.time.hours-=12),t=60*n.time.hours*60+60*n.time.minutes):t=60*n.time.hours*60+60*n.time.minutes,n.mainObj.callback(t)}}),s.push({text:n.mainObj.closeLabel,type:"button_close"}),n.popup=o.show({templateUrl:"ionic-timepicker.html",scope:n,cssClass:"ionic_timepicker_popup",buttons:s})},s}]}),APP.controller("manageUserController",["$scope","$state","$stateParams","manageUserService","$ionicScrollDelegate","PopupService","anchorScroll","$ionicPopup",function(e,t,o,i,s,n,a,r){e.mainuserlist="",e.userlist="",e.topicId="",e.aList=[],e.isShut=[],e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.selectUser=function(t){for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].id==t.id&&("img/ic_select.png"==e.mainuser2list[o].ischeck?e.mainuser2list[o].ischeck="img/ic_check.png":e.mainuser2list[o].ischeck="img/ic_select.png");for(var i=0;i<e.userlist.length;i++)t.id==e.userlist[i].id&&("img/ic_select.png"==e.userlist[i].ischeck?(e.userlist[i].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[i].ischeck="img/ic_select.png",e.userCode=t.userCode))},e.allDo=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}else if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}},e.noSpeak=function(){for(var t=0;t<e.userlist.length;t++)"img/ic_select.png"==e.userlist[t].ischeck&&(e.isShut.push(e.userlist[t].isgag),e.manageList.push(e.userlist[t].userCode));if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var o=0;o<e.mainuser2list.length;o++)"img/ic_select.png"==e.mainuser2list[o].ischeck&&(e.isShut.push(e.mainuser2list[o].isgag),e.manageList.push(e.mainuser2list[o].userCode));if(e.manageList.length>0){for(var i=e.manageList.join(","),s={topicId:e.topicId,userCode:i,isGag:1},a=0;a<e.isShut.length;a++)1==e.isShut[a]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(s)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else e.yesno&&!e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,n.showToast("已选对象为禁言者，无需禁言")):e.ok(s)}else n.showToast("您还没有选择任何成员")},e.release=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&(e.isShut.push(e.mainuser2list[t].isgag),e.manageList.push(e.mainuser2list[t].userCode));for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&(e.isShut.push(e.userlist[o].isgag),e.manageList.push(e.userlist[o].userCode));if(e.manageList.length>0){for(var i=e.manageList.join(","),s={topicId:e.topicId,userCode:i,isGag:0},a=0;a<e.isShut.length;a++)1==e.isShut[a]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部解除禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(s)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else!e.yesno&&e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,n.showToast("已选对象为非禁言者，无需解除")):e.ok(s)}else n.showToast("您还没有选择任何成员")},e.ok=function(t){i.manageUser(t).success(function(t){e.allcheck="img/ic_check.png",e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,e.getallList()}).error(function(){})},e.yes=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&e.manageList.push(e.mainuser2list[t].userCode);for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&e.manageList.push(e.userlist[o].userCode);if(e.manageList.length>0){var s=e.manageList.join(","),a={topicId:e.topicId,userCodeS:s,isAll:0};i.delectUser(a).success(function(t){t.success?(e.getallList(),n.showToast("删除成功")):n.showToast(t.message)}).error(function(){})}else n.showToast("您还没有选择任何成员")},e.search=function(t){var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");for(var r=0;r<e.mainuser2list.length;r++)e.mainuser2list[r].ischeck="img/ic_check.png";for(var a=0;a<e.userlist.length;a++)e.userlist[a].ischeck="img/ic_check.png";s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.getallList=function(){var t={topicId:e.topicId,pageSize:20,pageIndex:1};i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].ischeck="img/ic_check.png";for(var i=0;i<e.userlist.length;i++)e.userlist[i].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var i=e.userlist.length;e.hasmore=!(i===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.hasmore=!1,e.yesno=!1,e.noyes=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.isShut=[],e.allcheck="img/ic_check.png",e.userCode="",e.manageList=[],e.pageIndex=1,e.input={isinput:""},e.getallList()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("manageUserService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.manageUser=function(o){return e.post(t.getUrl("CIRCLE_MANAGE_USER"),o)},this.delectUser=function(o){return e.post(t.getUrl("CIRCLE_DELECT_USER"),o)}}]),APP.controller("moreInterestingCtrl",["$scope","$state","$timeout","PopupService","myFansService",function(e,t,o,i,s){e.myInterested={pageIndex:0,pageSize:8,interestedList:[],hasMore:!0,api:function(e,t){return s.getMyInterested(e,t)}},e.init=function(){e.myInterested.hasMore=!0,e.myInterested.pageIndex=0,e.myInterested.interestedList=[],e.loadData(e.myInterested,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(t,s){void 0==s&&(s=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(i){o(function(){1==i.success&&(t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.interestedList=t.interestedList.concat(i.data.list),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络错误！")})},e.followI=function(t,n){var a=n?1:0;s.follow(t.memberId,a).success(function(i){if(1==i.success)for(var s=0;s<e.myInterested.interestedList.length;s++)t.memberId==e.myInterested.interestedList[s].memberId&&(e.myInterested.interestedList.splice(s,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3))}).error(function(){i.showToast("网络错误！")})},e.viewHim=function(e){t.go("personalHomepageHe",{othersId:e})}}]),APP.controller("myFansCtrl",["$scope","$timeout","$state","PopupService","myFansService",function(e,t,o,i,s){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFansData={pageIndex:0,pageSize:6,myFans:[],hasMore:!0,api:function(e,t){return s.getMyFans(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFansData.pageIndex=0,e.myFansData.myFans=[],e.myFansData.hasMore=!0,s.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){i.showToast("网络错误！")}),e.loadData(e.myFansData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(o,s){void 0==s&&(s=1e3),o.pageIndex=o.pageIndex+1,o.api(o.pageIndex,o.pageSize).success(function(i){t(function(){1==i.success&&(o.hasMore=o.pageIndex*o.pageSize<i.totalCount,o.myFans=o.myFans.concat(i.data.list),e.nothing=!o.myFans.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络错误！")})},e.followI=function(o,n){var a=n?1:0;s.follow(o.memberId,a).success(function(i){if(1==i.success){for(var s=0;s<e.interested.length;s++)o.memberId==e.interested[s].memberId&&e.interested.splice(s,1);n&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}}).error(function(){i.showToast("网络错误！")})},e.followF=function(o,n){var a=n?1:0,r=o.followId?o.followId:o.memberId;s.follow(r,a).success(function(o){o.success,n&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}).error(function(){i.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){o.go("moreInteresting")},e.jumpMsg=function(){o.go("messageCenter")},e.viewHim=function(e){e.followId?o.go("personalHomepageHe",{othersId:e.followId}):o.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFansService",["$http","UrlService",function(e,t){this.getMyFans=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("MY_FANS"),data:s})},this.getMyInterested=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("INTERESTED"),data:s})},this.follow=function(o,i){var s={id:o,isFollow:i};return e({method:"post",url:t.getUrl("FOLLOW"),data:s})}}]),APP.controller("myFollowCtrl",["$scope","$rootScope","$timeout","$state","PopupService","myFollowService","myFansService",function(e,t,o,i,s,n,a){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFollowsData={pageIndex:0,pageSize:6,myFollows:[],hasMore:!0,api:function(e,t){return n.getMyFollows(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFollowsData.pageIndex=0,e.myFollowsData.myFollows=[],e.myFollowsData.hasMore=!0,a.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){s.showToast("网络错误！")}),e.loadFollowData(e.myFollowsData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadFollowData=function(t,i){void 0==i&&(i=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(s){o(function(){1==s.success&&(t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.myFollows=t.myFollows.concat(s.data.list),e.nothing=!t.myFollows.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络失败！")})},e.followI=function(t,i){var n=i?1:0;a.follow(t.memberId,n).success(function(i){if(1==i.success){for(var s=0;s<e.interested.length;s++)t.memberId==e.interested[s].memberId&&(e.interested.splice(s,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3));e.nothing=!1,t.isFollow=!t.isFollow,t.followId=t.memberId,e.myFollowsData.myFollows.push(t)}}).error(function(){s.showToast("网络失败！")})},e.followF=function(t,o){var i=o?1:0,n=t.followId?t.followId:t.memberId;a.follow(n,i).success(function(t){if(1==t.success)for(var o=0;o<e.myFollowsData.myFollows.length;o++)n==e.myFollowsData.myFollows[o].followId&&(e.myFollowsData.myFollows.splice(o,1),e.myFollowsData.myFollows.length||(e.nothing=!0))}).error(function(){s.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){i.go("moreInteresting")},e.jumpMsg=function(){i.go("messageCenter")},e.viewHim=function(e){e.followId?i.go("personalHomepageHe",{othersId:e.followId}):i.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFollowService",["$http","UrlService",function(e,t){this.getMyFollows=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("MY_FOLLOWS"),data:s})}}]),APP.controller("mySettingsCtrl",["$scope","$state","$ionicPopup","mySettingsService","personalHomepageMeService","NoteDetailsService",function(e,t,o,i,s,n){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.myInfo={},e.data={},e.userId="",e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.creditDetails=function(){t.go("shop")},e.viewCredit=function(){t.go("quanziRecommend")},e.init=function(){e.userId="1",e.isDisplay=!1,s.getUserData("2",e.userId).success(function(t,o,i,s){1==t.success&&(e.myInfo=t.data)}).error(function(e,t,o,i){alert("网络失败！")})},e.apply=function(){window.alert("接口还没出来，你申请也没用，略略略……")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("mySettingsService",function(){}),APP.controller("personalHomepageHeCtrl",["HomePageService","heIssueService","$scope","$http","$rootScope","NoteDetailsService","$state","$timeout","$interval","$stateParams","$window","$location","$ionicScrollDelegate","UserService","PopupService","personalHomepageHeService","personalHomepageMeService","myFansService","communityRecommendService","UrlService","CreditService",function(HomePageService,heIssueService,$scope,$http,$rootScope,NoteDetailsService,$state,$timeout,$interval,$stateParams,$window,$location,$ionicScrollDelegate,UserService,PopupService,personalHomepageHeService,personalHomepageMeService,myFansService,communityRecommendService,UrlService,CreditService){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.contentHeight={height:"296px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.contentHeight={height:"280px"}),$scope.gotoPriLetter=function(){$state.go("privateLetter",{userCode:$scope.othersId})},$scope.user=void 0,$scope.messageNum=void 0,$scope.ifRed=void 0,$scope.isDisplay=void 0,$scope.othersId="",$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.shopList=[],$scope.shareType=void 0,$scope.byShareLink=void 0,$scope.provinceId="",$scope.cityId="",$scope.regionId="",$scope.streetId="",$scope.showShare=!1,$scope.hisStory={nums:-1,pageIndex:0,pageSize:6,storyList:[],hasMore:!0,api:function(e,t,o){return personalHomepageMeService.getMyStory(e,t,o)}},$scope.hisShare={nums:-1,pageIndex:0,pageSize:6,shareList:[],hasMore:!0,api:function(e,t,o){return personalHomepageHeService.hisShare(e,t,o)}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.init=function(tab){switch(personalHomepageHeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId}),$scope.user=UserService.getUser(),$scope.othersId=$stateParams.othersId,$scope.isDisplay=!1,$scope.byShareLink=!$rootScope.isApp,$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,$scope.tabNav="personalHomePageHe",$scope.hisLists=[{title:"dashang",icon:$rootScope.imgBaseURL+"img/homepage/dashang@2x.png",text:"TA的打赏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:$rootScope.imgBaseURL+"img/homepage/zan@2x.png",text:"TA的赞",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:$rootScope.imgBaseURL+"img/homepage/Shape@2x.png",text:"TA的收藏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"}],tab){case 0:$scope.getShopList();break;case 1:$scope.getHisStory();break;case 2:$scope.getHisShare()}personalHomepageHeService.hisShare(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisShare.nums=e.data.totalCount)}),personalHomepageMeService.getMyStory(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisStory.nums=e.data.totalCount)})},$scope.$on("$ionicView.beforeEnter",function(e,t){"forward"==t.direction||"exit"==t.direction||"none"==t.direction?$scope.init(0):"back"==t.direction&&($scope.isDisplay=!1,$scope.downRefresh($scope.selectedIndex))}),$scope.downRefresh=function(e){switch(e){case 0:$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.getShopList();break;case 1:$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisStory();break;case 2:$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisShare()}$scope.$broadcast("scroll.refreshComplete")},$scope.getShopList=function(){$scope.selectedIndex=0,$scope.hisInfo||(personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){if(1==e.success){if($scope.hisInfo=e.data,e.data.storeGride)if($scope.levelArray=[],e.data.storeGride<=3)for(var t=0;t<e.data.storeGride;t++)$scope.levelArray.push("img/StarLevel@2x.png");else for(var t=0;t<e.data.storeGride-3;t++)$scope.levelArray.push("img/DiamondLevel@2x.png");$scope.hisInfo.isStore&&$scope.shop}}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}))},$scope.loadGoods=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisGoods.goodsList=[]),e.api($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.data.storeItemsCounts,e.hasMore=e.pageIndex*e.pageSize<o.data.storeItemsCounts,e.goodsList=e.goodsList.concat(o.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisStory=function(){$scope.selectedIndex=1,$scope.hisStory.storyList||$scope.loadHisStory($scope.hisStory,0)},$scope.loadHisStory=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisStory.storyList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.storyList=e.storyList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisShare=function(){$scope.selectedIndex=2,$scope.hisShare.shareList||$scope.loadShare($scope.hisShare,0)},$scope.loadShare=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisShare.shareList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.shareList=e.shareList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.downloadSg=function(){var e=$rootScope.isIOS?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":"http://app.qq.com/#id=detail&appid=1104761357";$window.location.assign(e)},$scope.hideDownload=function(){$scope.byShareLink=!1},$scope.show=function(){$scope.isDisplay=!$scope.isDisplay},$scope.disappear=function(){$scope.isDisplay=!1},$scope.dealStory=function(e,t){var o=e.storyTopicId?e.storyTopicId:e.id;personalHomepageHeService.dealStory(o,t).then(function(o){if(1==o.data.success){var i;switch(t){case 1:i=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?i-1:i+1,e.praiseFlag=!e.praiseFlag;break;case 2:i=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?i-1:i+1,e.collectionFlag=!e.collectionFlag;break;case 3:i=parseInt(e.praiseNumber1),e.praiseNumber1=e.praiseFlag1?i-1:i+1,e.praiseFlag1=!e.praiseFlag1;break;case 4:i=parseInt(e.collectionNumber1),e.collectionNumber1=e.collectionFlag1?i-1:i+1,e.collectionFlag1=!e.collectionFlag1}}else PopupService.showToast(o.data.message)},function(){PopupService.showToast("网络错误！")})},$scope.follow=function(e){HomePageService.isWdHost().success(function(t){if($rootScope.isWdHost=t.data.isHost,-1==$rootScope.isWdHost)$state.go("login");else if(0==e){var o={id:$stateParams.othersId,isFollow:1};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.isFollow=1,$scope.hisInfo.praise+=1,$scope.alreadyFollow=!0,$timeout(function(){$scope.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}else if(1==e){var o={id:$stateParams.othersId,isFollow:0};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.praise-=1,$scope.hisInfo.isFollow=0):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}})},$scope.ToIssue=function(e,t,o){"issue"==e&&heIssueService.getMyIssue(1,5,o,0).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"comment"==e&&heIssueService.getMyComment(1,5,o,0).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"quanzi"==e&&heIssueService.getMyJoinedTopics(o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"dashang"==e&&heIssueService.getDaShang(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"zan"==e&&heIssueService.getUserPraise(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"shoucang"==e&&heIssueService.getCollection(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})})},$scope.joinTopic=function(e){var t=e.storyTopicId;communityRecommendService.joinTopic(t).then(function(t){1==t.data.success?e.topicFocusFlag=!0:-2e3==t.errorCode&&(PopupService.showToast(t.data.message),$rootScope.loginIsAccord2=!0)},function(){PopupService.showToast("网络错误")})},$scope.addToCart=function(e){var t={productId:e,number:1,o2oStoreName:"",o2omap:e+","}
;personalHomepageHeService.toCart(t).then(function(e){1==e.data.success?PopupService.showToast("加入购物车成功"):PopupService.showToast(e.data.message)},function(e){PopupService.showToast(e)})},$scope.viewHim=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.toProductDetails=function(e){$state.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId})},$scope.viewShop=function(){window.cordova&&$rootScope.gio.evar.set({source:"Community",value:$scope.shop?$scope.shop.storeId:$stateParams.othersId}),$state.go("myStore",{storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId,shareStoreId:""})},$scope.jumpMsg=function(){$state.go("messageCenter")},$scope.viewStory=function(e){var t=e.storyTopicId?e.storyTopicId:e.id;2!==e.flag?$state.go("noteDetails",{noteId:t,isShortStory:e.isShortStory}):$state.go("classNoteDetails",{noteId:t})},$scope.viewTopic=function(e){$state.go("circlePage",{circleId:e})},$scope.share=function(e){if(window.umeng){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.shareType=e}else alert("只能在app分享,请下载app！")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e,t){var o,i,s,n;t?$scope.shop&&(o=($scope.shop.storeName?$scope.shop.storeName:"他")+"的顺逛小店",i="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=UrlService.getShareLinkHeader()+"myStore/"+$scope.shop.storeId+"/"+$scope.shop.storeId+"/"):(o=($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的空间",i="欢迎关注"+($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=UrlService.getShareLinkHeader()+"personalHomePageHe/"+$scope.hisInfo.memberId),window.umeng?0==e?window.umeng.shareToSina(o,i,s,n,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,CreditService.shareSuccessCallback):3==e?window.umeng.shareToQQ(o,i,s,n,0,null,CreditService.shareSuccessCallback):4==e?window.umeng.shareToQzone(o,i,s,n,0,null,CreditService.shareSuccessCallback):5==e&&$scope.copeText(n):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("personalHomepageHeService",["$http","UrlService",function(e,t){this.hisShare=function(o,i,s){var n={pageIndex:o,pageSize:i,userCode:s};return e({method:"post",url:t.getUrl("HIS_SHARE"),data:n})},this.toCart=function(o){var i={productId:o.productId,number:o.number,o2oStoreName:o.o2oStoreName,o2omap:o.o2omap};return e({method:"get",url:t.getUrl("SHOP_ADD_CART"),params:i})},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.dealStory=function(o,i){var s,n={id:o,noLoading:!0};switch(i){case 1:s="COMMENT_PRAISE";break;case 2:s="COLLECTION_TOPIC";break;case 3:s="SCHOOLPRAISESTORY";break;case 4:s="SCHOOLCOLLECTION"}return e({method:"post",url:t.getUrl(s),data:n})}}]),APP.controller("personalHomepageMeCtrl",["$scope","heIssueService","myFollowService","myFansService","$rootScope","$state","$timeout","$interval","$ionicScrollDelegate","PopupService","UserService","personalHomepageMeService","UrlService","personalHomepageHeService","$ionicModal","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.contentHeight={height:"296px"}):(e.paddingtopClass={"margin-top":"0px"},e.contentHeight={height:"280px"}),e.goBackTo=function(){e.$ionicGoBack()},e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.userId="",e.user=void 0,e.userData={},e.data=[],e.story=void 0,e.selectedIndex=void 0,e.notApply=void 0,e.teachedList="",e.joinedList="",e.showShare=!1,e.myTopics=void 0,e.noTopic=!1,e.myStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return u.getMyStory(e,t)}},e.myCollectionStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return u.getMyCollection(e,t)}},e.init=function(t){e.tabNav="personalHomepageMe",e.hisLists=[{title:"dashang",icon:s.imgBaseURL+"img/homepage/dashang@2x.png",text:"我的打赏",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:s.imgBaseURL+"img/homepage/zan@2x.png",text:"我的赞",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:s.imgBaseURL+"img/homepage/Shape@2x.png",text:"我的收藏",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"}],m.fromTemplateUrl("templates/quanzi/ApplyTeacherModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyTeacherModal=t}),e.myTopics=void 0,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.notApply=!0,e.isDisplay=!1,e.data=[],e.selectedIndex=void 0,e.user=d.getUser(),e.userId=d.getUser().mid,u.getUserData1("2",e.userId).success(function(t){if(e.userData1=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(s.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(s.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),u.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),u.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),u.getMyCollection(1,0).then(function(t){1==t.data.success&&(e.myCollectionStory.nums=t.data.totalCount)}),e.$broadcast("scroll.refreshComplete")},e.showApplyModal=function(){u.startApply().success(function(t){t.success?0==t.data.applyStatus?e.data.isApply=!0:1==t.data.applyStatus?(e.message=t.message,e.applyStatus=1,e.applyTeacherModal.show()):(e.introduce=t.data.introduce,e.message=t.message,e.applyStatus=2,e.applyTeacherModal.show()):e.data.isApply=!1},function(e){})},e.hideApplyModal=function(){delete e.applyStatus,e.applyTeacherModal.hide()},e.jumpMyCircle=function(){n.go("myCirclePages")},e.applyStatus3=function(){e.hideApplyModal(),a(function(){e.applyStatus=3,e.applyTeacherModal.show()},500)},e.editApply=function(){e.hideApplyModal(),e.data.isApply=!0},e.getTeachedList=function(){var t={pageSize:10,pageIndex:1};u.teachedLessones(t).success(function(t){e.teachedList=t.data.list}).error(function(){})},e.getJoinededList=function(){var t={pageSize:10,pageIndex:1};u.joinedLessones(t).success(function(t){e.joinedList=t.data.list,e.classesCount=t.data}).error(function(){})},e.selectTab=function(t){switch(e.selectedIndex=t,t){case 0:e.myCollectionStory.storyList||e.loadData(e.myCollectionStory,0),a(function(){e.story=e.myCollectionStory},0);break;case 1:e.myStory.storyList||e.loadData(e.myStory,0),e.story=e.myStory;break;case 2:e.myTopics||u.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}a(function(){c.resize()},200)},e.loadData=function(t,o){null!=o&&void 0!=o||(o=1e3),t.pageIndex=t.pageIndex+1,1==t.pageIndex&&(t.storyList=[]),t.api(t.pageIndex,t.pageSize).success(function(i){a(function(){1==i.success&&(t.nums=i.totalCount,t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.storyList=t.storyList.concat(i.data.list),e.$broadcast("scroll.infiniteScrollComplete"))},o)}).error(function(){alert("网络失败！")})},e.$on("$ionicView.beforeEnter",function(t,o){"forward"==o.direction||"exit"==o.direction||"none"==o.direction?e.init(1):"back"==o.direction&&(e.isDisplay=!1,e.downRefresh(e.selectedIndex))}),e.downRefresh=function(t){switch(u.getUserData1("2",e.userId).success(function(t){if(e.userData=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(s.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(s.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),u.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),u.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),t){case 0:e.selectedIndex=0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.loadData(e.myCollectionStory,0);break;case 1:e.selectedIndex=1,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.loadData(e.myStory,0);break;case 2:e.selectedIndex=2,e.myTopics=void 0,u.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}e.$broadcast("scroll.refreshComplete")},e.noFind=function(){e.userData.img="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/user.jpg"},e.apply=function(t){var o={introduce:t,status:2==e.applyStatus?1:0};if(t)u.apply(o).then(function(t){1==t.data.success?(e.notApply=!1,l.showToast("申请已提交，等待审核……"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){});else if(3==e.applyStatus){var o={introduce:t,status:2};u.apply(o).then(function(t){1==t.data.success?(e.hideApplyModal(),e.introduce="",e.notApply=!1,l.showToast("申请已放弃"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){})}else l.showToast("申请描述不能为空，请填写……")},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.dealStory=function(t,o){var i;i=2!==t.flag?o:1==o?3:4;var s=t.storyTopicId?t.storyTopicId:t.id;g.dealStory(s,i).then(function(o){if(1==o.data.success){var n;switch(i){case 1:n=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?n-1:n+1,t.praiseFlag=!t.praiseFlag;break;case 2:if(n=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?n-1:n+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(var a=0;a<e.myCollectionStory.storyList.length;a++)s==e.myCollectionStory.storyList[a].id&&(e.myCollectionStory.storyList.splice(a,1),e.myCollectionStory.nums--);break;case 3:n=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?n-1:n+1,t.praiseFlag=!t.praiseFlag;break;case 4:if(n=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?n-1:n+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(a=0;a<e.myCollectionStory.storyList.length;a++)s==e.myCollectionStory.storyList[a].id&&(e.myCollectionStory.storyList.splice(a,1),e.myCollectionStory.nums--)}}},function(){l.showToast("网络错误！")})},e.ToMyIssue=function(e,o,i){"issue"==e&&t.getMyIssue(1,5,i,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"comment"==e&&t.getMyComment(1,5,i,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"quanzi"==e&&t.getMyJoinedTopics(i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"dashang"==e&&t.getDaShang(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"zan"==e&&t.getUserPraise(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"shoucang"==e&&t.getCollection(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})})},e.settings=function(){n.go("mySettings")},e.fans=function(){i.getMyFans(1,6).success(function(e){1==e.success?n.go("myFans"):-2e3==e.errorCode&&(l.showToast(e.message),s.loginIsAccord2=!0)})},e.follows=function(){o.getMyFollows(1,6).success(function(e){1==e.success?n.go("myFollow"):-2e3==e.errorCode&&(l.showToast(e.message),s.loginIsAccord2=!0)})},e.jumpMsg=function(){n.go("messageCenter")},e.viewTopic=function(e){n.go("circlePage",{circleId:e})},e.viewMyTopic=function(){s.xinxianshow=!1,s.myquanshow=!0,s.buttonshowl=!1,s.buttonshowr=!0,n.go("topic.qmine")},e.viewStory=function(e){2!==e.flag?n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):n.go("classNoteDetails",{noteId:e.id})},e.viewShop=function(){n.go("myStore",{storeId:e.userData.memberId,shareStoreId:""})},e.viewHim=function(e){1==e.flag&&n.go("personalHomepageHe",{othersId:e.userCode})},e.share=function(){if(!d.getUser().mid)return void n.go("login");window.umeng?e.showShare=!e.showShare:alert("只能在app分享,请下载app！")},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=(e.userData.userName?e.userData.userName:"他")+"的空间",i="欢迎关注"+(e.userData.userName?e.userData.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=p.getShareLinkHeader()+"personalHomePageHe/"+e.userData.memberId;window.umeng?0==t?window.umeng.shareToSina(o,i,s,n,0,null,f.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,f.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,f.shareSuccessCallback):3==t?window.umeng.shareToQQ(o,i,s,n,0,null,f.shareSuccessCallback):4==t?window.umeng.shareToQzone(o,i,s,n,0,null,f.shareSuccessCallback):5==t&&e.copeText(n):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("personalHomepageMeService",["$http","UrlService",function(e,t){this.getUserData1=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_ONE"),data:s})},this.getUserData2=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_TWO"),data:s})},this.getUserData3=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_THREE"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyStory=function(o,i,s){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyCollection=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.startApply=function(){return e({method:"post",url:t.getUrl("START_APPLY_LECTURER"),data:{}})},this.apply=function(o){return e({method:"post",url:t.getUrl("APPLY_LECTURER"),data:o})},this.teachedLessones=function(o){return e({method:"post",url:t.getUrl("TEACHED_COURSE"),data:o})},this.joinedLessones=function(o){return e({method:"post",url:t.getUrl("JOINED_COURSE"),data:o})}}]),APP.controller("QdatabaseController",["$scope","$rootScope","$ionicHistory","QdatabaseService","$http","$ionicSlideBoxDelegate","$timeout","$state",function(e,t,o,i,s,n,a,r){e.quanlist="",e.isshow=!1,e.topshow=!1,e.xxshow=!1,e.sshow=!1,t.xiaoxis=!1,e.shuxiaoxi=!1,e.userlist="",e.count=0,e.ziliaolist="",t.msgCount="",e.totalCount=0,e.nogengduo="没有更多数据",e.storyName={name:""},e.storyType="",t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.goBack=function(){e.$ionicGoBack()},e.soushow=function(){e.sshow=!e.sshow},e.gotoxiaoxi=function(){r.go("qzMessageCenter"),t.xiaoxis=!1},e.toMsgCenter=function(){r.go("qzMessageCenter")},e.gototiezi=function(e){r.go("topicdetails",{noteId:e.id,isShortStory:e.isShortStory})},e.inputclass=function(t){e.storyType=t.id,e.init()},e.inputname=function(t){e.storyType="",e.init(),e.sshow=!1},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,storyName:e.storyName.name,storyType:e.storyType};a(function(){i.getziliaolist(t).success(function(t,o,i,s){return e.ziliaolist=t.data.list,e.totalCount=t.totalCount,t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},200),e.isjiazai=e.pageSize*e.pageIndex,e.hasMore=e.isjiazai>e.totalCount},e.loadData=function(){a(function(){var t=e.isjiazai<=e.totalCount;if(e.isjiazai=e.pageIndex*e.pageSize,e.pageIndex=e.pageIndex+1,t){var o={pageSize:e.pageSize,pageIndex:e.pageIndex};return i.getziliaolist(o).success(function(t,o,i,s){return e.ziliaolist=e.ziliaolist.concat(t.data.list),e.totalCount=t.totalCount,t}).error(function(){}),e.hasMore=t,e.$broadcast("scroll.refreshComplete"),void e.$broadcast("scroll.infiniteScrollComplete")}e.nogengduo="没有更多数据",e.hasMore=t,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){i.gettopic().success(function(t,o,i,s){return e.quanlist=t.data,t}),i.getxiaoxi().success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.dataList=[],e.hasMore=!0,e.pageSize=5,e.pageIndex=1,e.isjiazai=0,e.totalCount="",e.initdata()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QdatabaseService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.gettopic=function(){return e.get("./data/fenlei.json")},this.getziliaolist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)}}]),APP.controller("qSearchController",["$scope","$rootScope","$ionicHistory","qSearchService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.biaoqian="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",e.$ionicGoBack()},e.goqSearchThree=function(){window.cordova&&cordova.plugins.Keyboard.close(),a.go("qSearchThree",{keywords:e.input.isinput})},e.search=function(e){a.go("qSearchThree",{keywords:e.target.value})},e.BgoqSearchTwo=function(e){a.go("qSearchThree",{keywords:e.name})},e.init=function(){e.input.isinput="";var t={isHot:0};i.getbiaoqian(t).success(function(t,o,i,s){return r(function(){e.biaoqian=t.data.list,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),setTimeout(function(){document.getElementById("qSearch").focus()},200),l.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.init(),e.showmore=!0})}]),APP.service("qSearchService",["$http","UrlService",function(e,t){this.getbiaoqian=function(o){return e.post(t.getUrl("TOPIC_TAGS"),o)}}]),APP.controller("qSearchBiaoController",["HomePageService","$scope","$rootScope","$ionicHistory","qSearchBiaoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p){t.topiclist="",t.pageIndex="",t.pageSize=10,t.keywords="",t.ismore="",t.totalCount="",t.hasMore="",t.ismoreshow="",t.showmore="",t.input={isinput:t.isinput},t.goBack=function(){1==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("allCircle")):2==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("qSearch")):r.go("qSearchThree",{keywords:t.input.isinput})},t.goqSearchTwo=function(){r.go("qSearchTwo",{keywords:t.input.isinput})},t.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},t.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),t.input.isinput=e.target.value,t.init()},t.joinCircle=function(i){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)r.go("login");else{t.itemTopicName=i.topicName;var n={ids:i.id};s.joinTopic(n).success(function(e){1==e.success?(i.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):u.showToast(e.message)}).error(function(){u.showToast("加入失败")})}}),t.itemTopicName=i.topicName;var n={ids:i.id};s.joinTopic(n).success(function(e){1==e.success?(i.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):-2e3==e.errorCode&&(u.showToast(e.message),o.loginIsAccord2=!0)}).error(function(){u.showToast("加入失败")})},t.loadData=function(){c(function(){if(t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.pageIndex=t.pageIndex+1,!t.hasMore)return u.showToast("没有更多数据"),t.hasMore;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};s.gettopic(e).success(function(e,o,i,s){return c(function(){t.topiclist=t.topiclist.concat(e.data.list),t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){u.showToast("没有更多数据")}),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3)},t.init=function(){t.keywords=t.input.isinput,t.pageIndex=1,t.pageSize=10;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};s.gettopic(e).success(function(e,o,i,s){return c(function(){t.topiclist=e.data.list,t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){}),p.scrollTop()},t.$on("$ionicView.beforeEnter",function(){t.showmore=!1,t.input={isinput:d.keywords},t.keywords=t.input.isinput,t.init(),t.showmore=!0})}]),APP.service("qSearchBiaoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchThreeController",["$scope","$rootScope","$ionicHistory","qSearchThreeService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.userlist="",e.topiclist="",e.huatilist="",e.pageIndex="",e.pageSize=3,e.showmore="",e.usershow="",e.topicshow="",e.tiezishow="",e.input={isinput:""},e.keywords=e.input.isinput,e.goBack=function(){e.input.isinput="",a.go("qSearch")},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.memberId})},e.storygotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userCode})},e.gototiezi=function(e){a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoquanezi=function(e){a.go("circlePage",{circleId:e.id})},e.goqSearchBiao=function(){e.keywords=e.input.isinput,a.go("qSearchBiao",{keywords:e.keywords})},e.BgoqSearchUser=function(){e.keywords=e.input.isinput,a.go("qSearchUser",{keywords:e.keywords})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.BgoqSearchTie=function(){e.keywords=e.input.isinput,a.go("qSearchTie",{keywords:e.keywords})},e.joinCircle=function(o){e.itemTopicName=o.topicName;var s={ids:o.id};i.joinTopic(s).success(function(i){1==i.success?(o.isJoin=1,e.init(),e.inCircle=!0,r(function(){e.inCircle=!1},1e3)):-2e3==i.errorCode&&(d.showToast(i.message),t.loginIsAccord2=!0)}).error(function(){d.showToast("加入失败")})},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=3;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return e.userlist=t.data.list,e.usershow=t.totalCount>3,t}).error(function(){});var o={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gettopic(o).success(function(t,o,i,s){return e.topiclist=t.data.list,e.topicshow=t.totalCount>3,t}).error(function(){});var s={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(s).success(function(t,o,i,s){return e.huatilist=t.data.list,e.tiezishow=t.totalCount>3,t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchThreeService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchTieController",["$scope","$rootScope","$ionicHistory","qSearchTieService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.huatilist="",e.pageIndex="",e.pageSize=10,e.keywords="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){a.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){a.go("qSearchTwo",{keywords:e.input.isinput})},e.gototiezi=function(e){a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(t).success(function(t,o,i,s){return r(function(){e.huatilist=e.huatilist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(t).success(function(t,o,i,s){return r(function(){e.huatilist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchTieService",["$http","UrlService",function(e,t){this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)}}]),APP.controller("qSearchTwoController",["$scope","$rootScope","$ionicHistory","qSearchTwoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.topiclist="",e.ismore="",e.topicListCount="",e.pageIndex="",e.pageSize=10,e.tagIds="",t.toFilterCode=2,e.ismoreshow="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",a.go("qSearch")},e.goqSearchBiao=function(){a.go("qSearchBiao",{keywords:e.input.isinput})},e.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),a.go("qSearchBiao",{keywords:e.target.value})},e.gotobiao=function(){t.toFilterCode=2,a.go("qSearchBiao",{keywords:e.input.isinput})},e.gotoquanezi=function(e){a.go("circlePage",{circleId:e.id})},e.joinCircle=function(t){e.itemTopicName=t.topicName;var o={ids:t.id};i.joinTopic(o).success(function(o){1==o.success?(t.isJoin=1,e.inCircle=!0,r(function(){e.inCircle=!1},1e3),e.init()):d.showToast(o.message)}).error(function(){d.showToast("加入失败")})},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,tagIds:e.tagIds};i.gettopic(t).success(function(t,o,i,s){return r(function(){e.topiclist=e.topiclist.concat(t.data.list.topicList),e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){t.toFilterCode=2,e.pageIndex=1,e.pageSize=10;var o={pageIndex:e.pageIndex,pageSize:e.pageSize,tagIds:e.tagIds};i.gettopic(o).success(function(t,o,i,s){return r(function(){e.topiclist=t.data.list.topicList,e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.ismore=t.data.list.createDate1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.tagIds=l.tagIds,e.input={isinput:l.tagname},e.init(),e.showmore=!0})}]),APP.service("qSearchTwoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETLISTBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchUserController",["$scope","$rootScope","$ionicHistory","qSearchUserService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.userlist="",e.pageIndex="",e.pageSize=10,e.biaoqian="",e.ismore="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){a.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){a.go("qSearchTwo",{keywords:e.input.isinput})},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.memberId})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return r(function(){e.userlist=e.userlist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.userlist<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return r(function(){e.userlist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchUserService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)}}]),APP.controller("QhotController",["$scope","$rootScope","PlatformService","HomePageService","CLASSIFYMESSAGECRNTERService","$ionicHistory","QhotService","ShopService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)")
;return(t=document.cookie.match(o))?unescape(t[2]):null}e.flagNum=!1,e.tielist="",e.quanlist="",e.lunlist="",e.selectedIndex="",t.xiaoxis=!1,e.dataList=[],e.nogengduo="",e.userdata="",e.topshow=!1,e.hasMore=!0,e.ismore=!0,e.totalCount="",e.datafist="",e.message="",e.showList=!1;var h=null;t.showRightTop=!1,t.msgCount="",e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){d.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoxiaoxi=function(){d.go("ClassifyMessageCenter")},e.gotomyzhu=function(){d.go("personalHomepageMe")},e.gotoothers=function(e){d.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){d.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){d.go("allCircle")},e.scrollToTop=function(){m.$getByHandle("qhotHandle").scrollTop(!0),e.showTopBtn=!1},e.getScrollHeight=function(){e.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),e.scrollHeight>3*e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},e.hotgo=function(){var e=m.$getByHandle("pinglun"),t=e.getScrollPosition().left,o=document.getElementById("hotdiv").offsetWidth;t>4.3*o&&d.go("allCircle")},e.gotoqSearch=function(){d.go("qSearch")},e.dianzan=function(o,i){window.cordova&&(t.gio.track("like",{circleID:e.tielist[i].topicId}),t.gio.track("active",{circleID:e.tielist[i].topicId}));var s=f("loginId"),n={id:o,noLoading:!0,userCode:s};a.postdianzan(n).success(function(t){1==t.success?1==e.tielist[i].praiseFlag?(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber-1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber+1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):u(function(){g.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?a.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):g.showToast(t.message),t}).error(function(){}):a.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=f("loginId"),o=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0,userCode:t}:{pageSize:e.pageSize,pageIndex:e.pageIndex,userCode:t};u(function(){a.getstorylist(o).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){e.pageIndex+=1;var t=f("loginId"),o={pageSize:5,pageIndex:e.pageIndex,noLoading:!0,userCode:t};a.getstorylist(o).success(function(t){t.data.list&&0!=t.data.list.length?h=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.infiniteScrollComplete");var o=e.tielist.length;e.hasmore=!(o==t.totalCount),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.jumpBannerUrl=function(e,t){if(0==e){var i=t.split("/");"noteDetails"==i[1]?d.go("noteDetails",{noteId:i[2],isShortStory:i[3]}):"circlePage"==i[1]?d.go("circlePage",{circleId:i[2]}):d.go("personalHomepageMe")}else if(1==e){var s=navigator.userAgent;s.indexOf("Android")>-1||s.indexOf("Linux")>-1?"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t):(s.indexOf("iPhone"),"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t))}},e.showCameraList=function(){e.showList=!e.showList},e.hideList=function(){e.showList=!1},e.isClick=function(){e.isDisplay=!e.isDisplay},e.jumpPhoto=function(o){i.isWdHost().success(function(i){t.isWdHost=i.data.isHost,-1==t.isWdHost?d.go("login"):(e.showList=!1,3!=o?d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(i){var s=JSON.parse(i),n=s.videoFile,a=s.imageFile,r=n.replace("\\",""),c=a.replace("\\","");t.mediaurla=r,t.mediaImga=c,d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o})},function(e){}))})},e.init=function(){e.showList=!1,e.isDisplay=!1,e.phoneHeight=document.documentElement.clientHeight/2;var o=e.quanlist?{pageIndex:1,pageSize:15,noLoading:!0}:{pageIndex:1,pageSize:15};a.gettopic(o).success(function(t,o,i,s){return e.quanlist=t.data.list,t}).error(function(){});var i=e.quanlist?{bannerType:0,noLoading:!0}:{bannerType:0};a.getlunbo(i).success(function(t,o,i,s){return e.lunlist=t.data.list,l.$getByHandle("qhot_slider").update(),t}).error(function(){});var s={noLoading:!!e.quanlist||""};a.getxiaoxi(s).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.hasMore=!0,e.initdata(),r.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(o,i){window.cordova&&t.gio.track("communityEntry"),"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),u(function(){a.getusertopic().success(function(t,o,i,s){e.datafist=t.data,e.datafist&&d.go("quanziRecommend")}).error(function(){})},1e3),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(h)})}]),APP.service("QhotService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETHOTSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getxiaoxi=function(o){return e.get(t.getUrl("UNRED_MESSAGE"),o)},this.getlunbo=function(o){return e.post(t.getUrl("GETBANNERLIST"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETHOTTOPICLIST"),o)},this.getusertopic=function(o){return e.post(t.getUrl("ADDUSER"),o)},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("QmineController",["$scope","$rootScope","$ionicHistory","QmineService","$http","$ionicSlideBoxDelegate","CLASSIFYMESSAGECRNTERService","$state","$timeout","PopupService","MyCirclePagesService",function(e,t,o,i,s,n,a,r,c,l,d){e.tielist="",e.flagNum=!1,e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";var u=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.xxshow=function(){t.xinxianshow=!0,t.myquanshow=!1,t.buttonshowl=!0,t.buttonshowr=!1},e.wdshow=function(){t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0},e.gototiezi=function(e){r.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotomyzhu=function(){r.go("personalHomepageMe")},e.gotoxiaoxi=function(){r.go("ClassifyMessageCenter")},e.gotoothers=function(e){r.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){r.go("allCircle")},e.gotoqSearch=function(){r.go("qSearch")},e.joinCircle=function(o){window.cordova&&(t.gio.track("follow",{circleID:o.id}),t.gio.track("active",{circleID:o.id})),e.itemTopicName=o.topicName;var s={ids:o.id,noLoading:!0};i.joinTopic(s).success(function(t){1==t.success?(o.isJoin=1,o.topicFocusFlag=1,e.init(),e.inCircle=!0,c(function(){e.inCircle=!1},1e3)):l.showToast(t.message)}).error(function(){l.showToast("加入失败")})},e.dianzan=function(o,s){window.cordova&&(t.gio.track("like",{circleID:e.tielist[s].topicId}),t.gio.track("active",{circleID:e.tielist[s].topicId}));var n={id:o,noLoading:!0};i.postdianzan(n).success(function(t){1==t.success?1==e.tielist[s].praiseFlag?(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber-1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber+1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):c(function(){l.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?i.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):l.showToast(t.message),t}).error(function(){}):i.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};c(function(){i.gettielist(t).success(function(t,o,i,s){if(t.success)return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){c(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return l.showToast("没有更多数据"),e.nogengduo="没有更多数据",e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};i.gettielist(t).success(function(t,o,i,s){return u=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.getMyCreatTopicInfo=function(t){var o={keywords:t};d.getMyCreatTopics(o).then(function(t){t.data.success&&(e.myCreatTopics=t.data.data.list)},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};d.getMyJoinedTopics(o).then(function(t){t.data.success&&(e.myTopics=t.data.data.list)},function(e){})},e.clickIn=function(e,o){0==o?r.go("circlePage",{circleId:e}):2==o?(t.showApplyTag=1,t.reviewCircleId=e,r.go("applyCircle")):(t.reviewCircleId=e,r.go("applyCircle"))},e.viewTopic=function(e){r.go("circlePage",{circleId:e})},e.init=function(){e.myCreatTopics=[],e.myTopics=[],e.tielist="",e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";t.showRightTop=!1,e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo(),e.selectedIndex=void 0;var o=e.quanlist?{ids:"",noLoading:!0}:{ids:""};i.gettopic(o).success(function(t,o,i,s){if(t.success)return e.quanlist=t.data.list,t}).error(function(){});var s={pageIndex:1,pageSize:3};i.gettuitopic(s).success(function(t,o,i,s){if(t.success)return e.tuiquanlist=t.data.list,t}).error(function(){});var n=e.quanlist?{noLoading:!0}:"";i.getxiaoxi(n).success(function(t,o,i,s){t.data&&0!=t.data?e.flagNum=!0:e.flagNum=!1}).error(function(){}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(){"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),t.showRightTop=!1,t.xiaoxis=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(u)})}]),APP.service("QmineService",["$http","UrlService",function(e,t){this.gettielist=function(o){return e.post(t.getUrl("GETMYFOLLOWINGSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETMYTOPICLIST"),o)},this.gettuitopic=function(o){return e.post(t.getUrl("RECOMMEND_LIST"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("communityRecommendCtrl",["$scope","$rootScope","$timeout","$state","PopupService","communityRecommendService",function(e,t,o,i,s,n){e.idArray=[],e.ids=[],e.topics=[],e.matrixes=[],e.init=function(){e.$broadcast("scroll.refreshComplete"),n.getCommunities().success(function(o){if(1==o.success){if(e.topics=o.data.list,e.topics.length>12)for(var i=0;i<Math.ceil(e.topics.length/12);i++)e.matrixes[i]=e.topics.slice(12*i,12*i+12);for(var n=0;n<e.topics.length;n++)1==e.topics[n].recommend&&(e.ids.push(e.topics[n].id),e.idArray.push(e.topics[n].id))}else-2e3==o.errorCode&&(s.showToast(o.message),t.loginIsAccord2=!0)}).error(function(){s.showToast("网络错误！")})},e.selectAll=function(t){if(e.ids.length!=e.topics.length){e.ids=[];for(var o=0;o<e.topics.length;o++)e.topics[o].isJoin||(e.topics[o].isJoin=!0),e.ids.push(e.topics[o].id)}else{for(o=0;o<e.topics.length;o++)e.topics[o].isJoin&&(e.topics[o].isJoin=!1);e.ids=[],e.ids=e.ids.concat(e.idArray)}},e.joinOrApply=function(t){if(0==t.recommend||null==t.recommend)if(t.isJoin=!t.isJoin,t.isJoin)e.ids.push(t.id);else for(var o=0;o<e.ids.length;o++)e.ids[o]==t.id&&e.ids.splice(o,1)},e.done=function(){e.ids.length?n.joinTopic(e.ids).then(function(t){1==t.data.success?(e.ids=[],i.go("topic.qhot")):s.showToast(t.data.message)},function(){}):i.go("topic.qhot")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("communityRecommendService",["$http","UrlService",function(e,t){this.joinTopic=function(o){var i={ids:o.toString()};return e({method:"post",url:t.getUrl("JOIN_TOPIC"),data:i})},this.getCommunities=function(){return e({method:"post",url:t.getUrl("LAUNGCH_RECOMMEND_LIST")})}}]),APP.controller("QwschoolController",["$scope","$rootScope","$ionicHistory","QwschoolService","$http","$state","CLASSIFYMESSAGECRNTERService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.tielist="",e.flagNum=!1,e.quanlist="",e.classlist="",e.ziliaolist="",e.buttonshowl=!1,e.buttonshowr=!0,t.xiaoxis=!1,e.isjiazai=0,e.nogengduo="",e.userdata="",e.selectedIndex=void 0,e.hasMore=!0,e.ismore=!0,e.message="",e.catelist="",e.selectCheck="";var d=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){n.go("classNoteDetails",{noteId:e.id})},e.gotomyzhu=function(){n.go("personalHomepageMe")},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userCode})},e.gotoqSearch=function(){n.go("qSearch")},e.gotoxiaoxi=function(){n.go("messageCenter")},e.gotoziliao=function(){n.go("qdatabase")},e.dianzan=function(t,o){var s={id:t,noLoading:!0};i.postdianzan(s).success(function(t){1==t.success?1==e.tielist[o].praiseFlag?(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber-1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber+1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):r(function(){c.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?i.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):c.showToast(t.message),t}).error(function(){}):i.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.selectlist=function(t){if(e.selectCheck==t)e.selectCheck="",e.storyid="",e.initdata();else{e.pageIndex=1,e.selectCheck=t,e.storyid=parseInt(t);var o={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};r(function(){i.getstorylist(o).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)}},e.initdata=function(){e.storyid="",e.selectCheck="",e.pageSize=5,e.pageIndex=1;var t=e.userdata?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};r(function(){i.getstorylist(t).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.tielist<5?e.hasMore=!1:(e.hasMore=!0,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")),t}).error(function(){})},300)},e.loadData=function(){if(e.pageIndex=e.pageIndex+1,e.storyid)var t={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};else var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};i.getstorylist(t).success(function(t,o,i,s){return d=setTimeout(function(){t.data.list.length<5?(e.hasMore=!1,c.showToast("没有更多数据"),e.nogengduo="没有更多数据"):e.hasMore=!0,e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){})},e.init=function(){e.selectedIndex=void 0;var o={noLoading:!0};i.business().success(function(t){e.catelist=t.data.list}),i.getxiaoxi(o).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount,o.data&&0!=o.data?e.flagNum=!0:e.flagNum=!1}).error(function(){});var s={id:1,type:1,noLoading:!0};i.getuserdata(s).success(function(t,o,i,s){return e.userdata=t.data,t}).error(function(){});var n={noLoading:!0};i.getclass(n).success(function(t,o,i,s){return e.classlist=t.data.list,t}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(o,i){"classNoteDetails"==t.nextPageBefore?t.nextPageBefore="":($("ion-header-bar").show(),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(d)})}]),APP.service("QwschoolService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getclass=function(o){return e.post(t.getUrl("GETCOURSEINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.postdianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.postshoucang=function(o){return e.post(t.getUrl("SCHOOLCOLLECTION"),o)},this.business=function(o){return e.post(t.getUrl("GET_BUSINESS"),o)}}]),APP.controller("qzMessageCenterController",["$scope","$state","qzMessageCenterService",function(e,t,o){e.hasmore=!1,e.selectedIndex=0,e.id="",e.platformData,e.smallClassData,e.otherData,e.param={pageSize:5,id:e.id,page:e.page,noLoading:!0},e.goBack=function(){e.$ionicGoBack()},e.goDetails=function(){t.go("messageDetails")},e.getPlatformData=function(){o.getPlatformMsg().success(function(t){e.platformData=t.data})},e.getSmallClassData=function(){o.getSmallClassMsg().success(function(t){e.smallClassData=t.data})},e.getOtherData=function(){o.getOtherMsg().success(function(t){e.otherData=t.data})},e.page=1,e.loadMore=function(){e.page+=1,e.loadMoreMsg(e.param)},e.loadMoreMsg=function(t){o.loadMoreProducts(t).success(function(t,o,i,s){if(null!=t.data.msgList&&void 0!=t.data.msgList&&0!=t.data.msgList.length){e.msgList=e.msgList.concat(t.data.msgList),e.$broadcast("scroll.infiniteScrollComplete");var n=e.msgList.length;e.hasmore=!(n===t.data.storeItemsCounts)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,e.msgList=[]})},e.init=function(){e.getPlatformData(),e.getSmallClassData(),e.getOtherData()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("qzMessageCenterService",["$http","UrlService",function(e,t){this.getPlatformMsg=function(){return e.get(t.getUrl("PLATFORM_INFO"),params)},this.getSmallClassMsg=function(){return e.get("data/smallClassMessage.json")},this.getOtherMsg=function(){return e.get("data/otherMessage.json")},this.loadMoreMessage=function(o){return params={pageSize:o.pageSize,id:o.id,page:o.page,noLoading:o.noLoading},e.get(t.getUrl(),params)}}]),APP.controller("relatedProductController",["$ionicHistory","$http","$scope","relatedProductsService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService",function($ionicHistory,$http,$scope,relatedProductsService,$stateParams,$state,$cookieStore,$ionicPopup,$timeout,LoginService,$rootScope,$ionicModal,$localstorage,PopupService){$scope.provinceId=0,$scope.cityId=0,$scope.regionId=0,$scope.streetId=0,$scope.productList=[],$scope.imgimg=[],$rootScope.image=[],$scope.isAreadyShop=!1,$scope.prolist=[],$scope.searchGoodsName="",$scope.gsPlaceholder="搜索商品",$scope.isShop=!0,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.page=1,$scope.loadMore=function(){$scope.page+=1,0==$scope.selectedIndex?$scope.searchOK?$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,2):$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5):1==$scope.selectedIndex?($scope.areadyPage+=1,$scope.areadyShop($scope.areadyPage,5)):3==$scope.selectedIndex&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,1)},$scope.onTabSelected=function(e){$scope.selectedIndex=e,$scope.page=1,$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.searchOK=!1,0==e?($scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)):1==e?($scope.shop0=!1,$scope.shop1=!0,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.areadyPage=0,$scope.productList=[],$scope.areadyShop($scope.areadyPage,5)):2==e?($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!0,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.holdPro()):3==e&&($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!0,$scope.isShop=!1,$scope.search=!0,$scope.productList=[])},$scope.loadMoreProducts=function(e,t,o,i,s,n){relatedProductsService.loadMoreProducts(e,t,o,i,s,n).success(function(e){if(null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.storeItemsCounts);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.areadyShop=function(e,t){relatedProductsService.areadyShop(e,t).success(function(e){if(null!=e.productList&&void 0!=e.productList&&0!=e.productList.length){$scope.productList=$scope.productList.concat(e.productList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.productTotal);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.holdPro=function(){relatedProductsService.holdPro().success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchHold=function(){if($scope.productList=[],""==$scope.searchName.searchHold&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchHold&&$scope.searchGoodsHold($scope.searchName.searchHold)},$scope.searchGoodsHold=function(e){relatedProductsService.searchHoldPro(e).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.todoSomething=function(e,t){13==e.keyCode&&($scope.searchProduct(t),Focus.blur())},$scope.searchProduct=function(e){if($scope.searchOK=!0,$scope.page=1,$scope.productList=[],1==e){if(""==$scope.searchName.searchAll&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchAll&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}else if(2==e){if(""==$scope.searchName.searchShop&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchShop&&$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}},$scope.searchGoods=function(e,t,o,i,s,n,a,r){relatedProductsService.searchGoods(e,t,o,i,s,n,a,r).success(function(e){if($scope.isShop=!0,null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!(e.productsList<5);for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.productOK=function(){$ionicHistory.goBack(),$rootScope.nextPageBefore="relatedProduct"},$scope.selectOrderAddress=function(e){if($rootScope.productId.length<5)if(-1!=$rootScope.image[e.productId].indexOf("check"))$rootScope.productId.push(e),$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_select.png",$scope.isChooseOrder=!0;else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else if(5==$rootScope.productId.length)if(-1!=$rootScope.image[e.productId].indexOf("check"))PopupService.showToast("最多能选择5个");else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else PopupService.showToast("最多能选择5个");$scope.imgimg=$rootScope.image},$scope.init=function(){$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.selectedIndex=0,$scope.hasmore=!1,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.productList=[],relatedProductsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.initPro()})},$scope.initPro=function(){$scope.page=1,$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.isIOS=!!ionic.Platform.isIOS(),$scope.init()}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.service("relatedProductsService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,i,s,n,a,r){var c={provinceId:o,cityId:i,districtId:s,streetId:n,pageIndex:a,pageSize:r};return e.get(t.getUrl("GET_RELATEDSHOP"),c)},this.areadyShop=function(o,i){var s={start:o,offset:5};return e.get(t.getUrl("GET_AREADYSHOP"),s)},this.holdPro=function(){return e.get(t.getUrl("GET_HOLDPRO"))},this.searchHoldPro=function(o){var i={keyword:o};return e.get(t.getUrl("SEARCH_HOLDPRO"),i)},this.searchGoods=function(o,i,s,n,a,r,c,l){var d={keyword:o,pageIndex:i,pageSize:s,provinceId:n,cityId:a,districtId:r,streetId:c,fromType:l};return e.get(t.getUrl("SEARCH_GOODS_CIRCLE"),d)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getFilterData=function(){return e.get(t.getUrl("GET_FILTER_DATA"))}}]),APP.controller("selectAdminController",["$scope","$state","$stateParams","selectAdminService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,i,s,n,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=[],e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.goBack=function(){t.go("CircleSetAdmin",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.selectUser=function(t){for(var o=0;o<e.userlist.length;o++)t.id==e.userlist[o].id?"img/ic_select.png"==e.userlist[o].ischeck?(e.userlist[o].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[o].ischeck="img/ic_select.png",e.userCode=t.userCode):e.userlist[o].ischeck="img/ic_check.png"},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var a=0;a<e.userlist.length;a++)e.userlist[a].ischeck="img/ic_check.png";s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.yes=function(){if(e.userCode.length>0){var o={topicId:e.topicId,userCode:e.userCode,indentityStatus:1};i.setAdmin(o).success(function(o){o.success?t.go("CircleSetAdmin",{topicId:e.topicId}):n.showToast(o.message)}).error(function(){})}else n.showToast("请选择管理员")},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var i=e.userlist.length;e.hasmore=!(i===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.userCode="";var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list;for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("selectAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.setAdmin=function(o){
return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("sharedMsgsList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/SharedMsgsList.html",scope:!0,link:function(e,t,o){}}}),APP.controller("signDateController",["CirclePageService","signDateService","PopupService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){function h(e,t){var o=t;i.month=t,i.fullDay=new Date(e,o,0).getDate(),i.startWeek=new Date(e,o-1,1).getDay(),i.lastMonthDay=new Date(e,o-1,0).getDate(),i.nextMonthDay=new Date(e,o+1,0).getDate(),i.total=(i.fullDay+i.startWeek)%7==0?i.fullDay+i.startWeek:i.fullDay+i.startWeek+(7-(i.fullDay+i.startWeek)%7),i.fullPrevMonth=[],i.fullNextMonth=[],i.fullCurrentMonth=[];for(var s=0;s<i.lastMonthDay;s++)i.fullPrevMonth[s]=s+1;for(var s=0;s<i.nextMonthDay;s++)i.fullNextMonth[s]=s+1;for(var s=0;s<i.signList.length;s++)i.fullCurrentMonth[s]=s+1;i.prevLast=i.fullPrevMonth.splice(i.lastMonthDay-i.startWeek,i.startWeek),i.nextFrist=i.fullNextMonth.splice(0,7-(i.fullDay+i.startWeek)%7),i.currentDays=i.prevLast.concat(i.signList).concat(i.nextFrist)}function v(e,o,s,n,a){t.getSignDate(e,o,s,n,a).success(function(e){if(e.success){i.isMoreSign=e.data.replenishSignGolds;var t=e.data.list,o=t[0].signDate.split("-");i.signList=e.data.list,i.getYear=Number(o[0]),i.getMonth=Number(o[1]),i.signCount=e.data.signCount,i.replenishSignGolds=e.data.replenishSignGolds,i.signRules=e.data.signRules,h(i.getYear,i.getMonth)}})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?i.paddingtopClass={"padding-top":"30px"}:i.paddingtopClass={"padding-top":"14px"},i.goBack=function(){i.$ionicGoBack()},i.$on("$ionicView.beforeEnter",function(e,t){"back"!=t.direction&&(i.month=(new Date).getMonth(),i.year=(new Date).getFullYear(),i.init())}),i.init=function(){i.isMoreSign="",i.signSucDate=e.signSuccessDate,i.topicName=e.topicName,i.defaultDate=i.signSucDate.signYear+"-"+i.signSucDate.signMonth+"-"+i.signSucDate.signDay,i.userId=s.userId,i.topicId=s.topicId,i.monthFlag=Number(s.monthFlag),v(i.userId,i.topicId,i.monthFlag,i.signSucDate.signYear,i.signSucDate.signMonth)},i.replenishSign=function(){i.replenishPopup=g.show({template:"<div class='rep-box'>\n                    <div class='rep-close' ng-click='closeReplenishPopup()'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                    <div class='rep-head'>选择补签日期</div>\n                    <div class='rep-content'>\n                      <div class='con-date' ng-click='selectDate()'>\n                        \n                        <div class='input'>{{defaultDate}}</div>\n                        <i><img ng-src=\"{{imgBaseURL}}img/signIn/date_icon.png\" alt=\"\" /></i>\n                      </div>\n                      <div class='con-info'>补签将消耗您<span style=\"font-size:22px;\">{{replenishSignGolds}}</span>个金币</div>\n                    </div>\n                    <div class='rep-foot' ng-click='replenishSuccess(defaultDate,2,topicId,userId)'>确认补签</div>\n                  </div>",cssClass:"replenishPopup",scope:i}),i.closeReplenishPopup=function(){i.replenishPopup.close()}},i.replenishSuccess=function(e,s,n,a){var r=e.split("-")[0],c=e.split("-")[1];r==i.signSucDate.signYear&&c==i.signSucDate.signMonth?(t.getReplenishSign(e,s,n,a).success(function(e){e.success?(i.signInfoData=e.data,i.replenishPopup.close(),i.replenishSucPopup=g.show({template:"<div class='suc-box'>\n                          <div class='suc-close' ng-click='closeReplenishSucPopup()'><img src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"\" /></div>\n                          <div class='suc-bg'><img src=\"{{imgBaseURL}}img/signIn/buqian_bg.png\" alt=\"\" /></div>\n                          <div class='suc-content'>\n                            <div class='suc-title' flex='main:center cross:center'>\n                              <div class='suc-icon' flex='cross:center'><img src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                              <div class='title-text'>签到排名<span style=\"font-size:16px;\">{{signInfoData.rank}}</span></div>\n                            </div>\n                               </div>\n                          <div class='suc-foot' ng-click='closeReplenishSucPopup()'>知道啦</div>\n                        </div>",cssClass:"replenishSucPopup",scope:i})):o.showToast(e.message)}),i.closeReplenishSucPopup=function(){i.replenishSucPopup.close(),i.init()}):o.showToast("对不起，只能补签当月")},i.selectDate=function(){if("APP"==u.getPlatform()){var e=i.signSucDate.signYear,t=i.signSucDate.signMonth,o=i.signSucDate.signDay,s={date:new Date(e,t-1,o),mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(s,function(e){c(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t),i.defaultDate=s+"-"+o+"-"+t},200)})}else{var t=i.signSucDate.signMonth,e=i.signSucDate.signYear,n={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(e,t-1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);new Date(e).getFullYear();i.defaultDate=new Date(e).getFullYear()+"-"+t+"-"+o}};p.openDatePicker(n)}},i.signChart=function(e){a.go("signInChart",{topicId:e})},i.weeks=["日","一","二","三","四","五","六"],i.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==u.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==u.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},i.signDateActive=function(e,t,o){0!=t&&(1==t?a.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:o.fromType,storeId:o.storeId}):2==t||3==t&&i.tolink(e))},i.prevMonth=function(){i.getMonth-1==0?(i.getYear-=1,i.getMonth=12):i.getMonth-=1,i.monthFlag+=1,v(i.userId,i.topicId,i.monthFlag,i.getYear,i.getMonth)},i.nextMonth=function(){i.getMonth+1==13?(i.getYear+=1,i.getMonth=1):i.getMonth+=1,i.monthFlag-=1,v(i.userId,i.topicId,i.monthFlag,i.getYear,i.getMonth)}}]),APP.service("signDateService",["$http","UrlService",function(e,t){this.getSignDate=function(o,i,s,n,a){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_DATE"),data:{userId:o,topicId:i,monthFlag:s,year:n,month:a}})},this.getReplenishSign=function(o,i,s,n){return e({method:"POST",url:t.getUrl("CIRCLE_REPLENISH_SIGN"),data:{replenishSignDate:o,signType:i,topicId:s,userId:n}})},this.getUserData=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.controller("signInChartController",["$scope","$rootScope","$state","$stateParams","$ionicScrollDelegate","signInChartService","UserService","personalHomepageMeService",function(e,t,o,i,s,n,a,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"30px"}:e.paddingtopClass={"padding-top":"14px"},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.topicId=i.topicId,e.signType=2,e.myCircleRankType=1,e.allCircleRankType=2,e.myCommunityRankType=3,e.allCommunityRankType=4,e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId)},e.getCircleChartFun=function(t,o,i){var s={rankType:t,signType:o,topicId:i};n.CurrentCircleChart(s).success(function(t){t.success&&(1==s.rankType||3==s.rankType?(e.userSignCount=t.data.rank[0].signCount,e.userRank=t.data.rank[0].rank):2!=s.rankType&&4!=s.rankType||(e.rankList=t.data.rank))})},e.$on("$ionicView.beforeEnter",function(t,o){"back"!=o.direction&&(s.scrollTop(),e.tabIndex=0,e.signListTitle="圈子",e.init())}),e.chooseTab=function(t){e.tabIndex=t,0==t?(e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId),e.signListTitle="圈子"):(e.getCircleChartFun(e.myCommunityRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCommunityRankType,e.signType,e.topicId),e.signListTitle="社区")}}]),APP.service("signInChartService",["$http","UrlService",function(e,t){this.CurrentCircleChart=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_CHART"),data:o})},this.getUserData=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.controller("topicRewardListController",["$ionicHistory","$http","$scope","topicRewardListService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService","NoteDetailsService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){o.tipId="",o.page=1,o.getList=function(){var e={tipId:parseInt(o.tipId),pageIndex:1,pageSize:5,sort:1,type:1};i.getList(e).success(function(e){o.shantotal=e.data,o.shanList=e.data.ucTips,e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)})},o.loadMore=function(){o.page=o.page+1;var e={tipId:parseInt(o.tipId),pageIndex:o.page,pageSize:5,sort:1,type:1};i.getList(e).success(function(e){o.shanList=o.shanList.concat(e.data.ucTips),o.$broadcast("scroll.infiniteScrollComplete"),e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1,g.showToast("没有更多了"))})},o.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userId})},o.follow=function(e,t){if(e.isFollow){var i={id:e.userId,isFollow:0};m.followNote(i).success(function(e){if(1==e.success)for(var i=0;i<o.shanList.length;i++)o.shanList[i].userId==o.shanList[t].userId&&(o.shanList[i].isFollow=!1);else g.showToast(e.message)})}else{var i={id:e.userId,isFollow:1};m.followNote(i).success(function(e){if(1==e.success)for(var i=0;i<o.shanList.length;i++)o.shanList[i].userId==o.shanList[t].userId&&(o.shanList[i].isFollow=!0);else g.showToast(e.message)})}},o.scrollToTop=function(){f.$getByHandle("rewardHandle").scrollTop(!0),o.showTopBtn=!1},o.getScrollHeight=function(){o.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),o.scrollHeight>2*o.phoneHeight?o.showTopBtn=!0:o.showTopBtn=!1},o.init=function(){o.phoneHeight=document.documentElement.clientHeight/2,o.hasmore=!1,o.page=1,o.tipId=s.tipId,o.getList()},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(e,t){o.init()})}]),APP.service("topicRewardListService",["$http","UrlService",function(e,t){this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)}}]),APP.controller("AddAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","ADDADDRESSService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage=s.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var m=window.innerHeight,f=m-373+"px";o.contentHeight={height:f};var h=m-250+"px";o.contentHeightStreet={height:h},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={};var v={};o.init=function(){if(o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn){var e=l.viewHistory().backView;e&&"address"==e.stateName?e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&o.addressMsgInit():(o.addressRegionName="所在地区",o.defaultImage=s.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s")}else o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.defaultOrchange&&o.hasChangeCommon();o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.hasChangeCommon=function(){o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree+" "+o.streetMsg,o.address.provinceId=o.hasChangeArr["value-1"],o.address.cityId=o.hasChangeArr["value-2"],o.address.areaId=o.hasChangeArr["value-3"],n.getLocationList(o.hasChangeArr["value-3"],o.hasChangeArr["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.addressMsgInit=function(){o.textColor="color-text-l",o.streetTextColor="color-text-l",void 0==s.addressStr?(o.defaultOrchange=!0,o.isChangeOrDefault=1,o.productChangeAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsg=JSON.parse(s.addressDefMsg),o.addressNum=o.adsMsg.pcrName.indexOf("/"),o.adsDefMsgInfo=o.adsMsg.pcrName,o.addressStreet=o.adsDefMsgInfo.substring(o.addressNum+1),o.addressRegName=o.adsMsg.pcrName.substring(o.addressNum,-1),o.addressRegionName=o.addressRegName,o.productDefaultAddress={provinceId:o.adsMsg.provinceId,cityId:o.adsMsg.cityId,areaId:o.adsMsg.regionId,streetId:o.adsMsg.streetId,regionName:o.addressRegName+" "+o.addressStreet,streetText:o.addressRegName},n.getLocationList(o.adsMsg.regionId,o.adsMsg.provinceId).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})):(o.defaultOrchange=!0,o.isChangeOrDefault=2,o.productDefaultAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsgChange=JSON.parse(s.addressStr),o.productChangeAddress={provinceId:o.adsMsgChange["value-1"],cityId:o.adsMsgChange["value-2"],areaId:o.adsMsgChange["value-3"],streetId:o.adsMsgChange["value-4"],regionName:o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"]+" "+o.adsMsgChange["text-4"]},o.addressStreet=o.adsMsgChange["text-4"],o.addressRegionName=o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"],n.getLocationList(o.adsMsgChange["value-3"],o.adsMsgChange["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")}))},o.$on("$ionicView.beforeEnter",function(){o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.commonGoBack=function(){t.confirm({template:"您当前信息未保存，是否保存信息？",cancelText:"离开",okText:"留在此页面"}).then(function(e){e||(o.panGoOn=!1,o.addressRegionName="所在地区",o.$ionicGoBack())})},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"");var t=l.viewHistory().backView;t&&"address"==t.stateName&&t.stateParams&&t.stateParams&&"YES"==t.stateParams.comeFromOrder&&(e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address?o.commonGoBack():l.goBack()}),e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&"所在地区"!=o.addressRegionName&&"街道"!=o.addressStreet?o.commonGoBack():l.goBack()}},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.setDefault=function(){0==o.defaultHide?(o.address.isDefault="0",o.defaultHide=!0):(o.address.isDefault="1",o.defaultHide=!1)},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,i,s){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=s,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,n.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var S=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var i=0;i<o.nowLevelIndex.length;i++)i>o.nowLevel&&(o.nowLevelIndex[i]=-1);o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",n.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.level=o.levelArea,n.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,n.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if(S)return;c(function(){S=!1},1500),s.$broadcast(o.flag,o.defaultValue),S=!0,o.closeAddressModal()}},300),o.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){v=a.getAddressInfo();var e=v.regionName+"/"+v.streetName;n.addAddress(v.provinceId,v.cityId,v.areaId,e,v.streetId).success(function(){var e={"text-1":v.provinceName,"text-2":v.cityName,"text-3":v.regionName,"text-4":v.streetName,"value-1":v.provinceId,"value-2":v.cityId,"value-3":v.areaId,"value-4":v.streetId};n.getLocationList(v.areaId,3).success(function(e){o.dataAddStreet=e.data;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.positionAddress={provinceId:v.provinceId,cityId:v.cityId,areaId:v.areaId,streetId:0,pca:v.provinceName+" "+v.cityName+" "+v.regionName,regionName:""},o.isPosition=!0,s.$broadcast(o.flag,e),o.streetTextColor="color-text-s",o.addressModal.hide()})}},u.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),u.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.fromOrder;var e=l.viewHistory().backView;e&&"address"==e.stateName&&e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&(o.fromOrder=!0),o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.fromOrder?o.isPosition?o.positionCommonFun():o.defaultOrchange&&1==o.isChangeOrDefault?(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.regionName):3==o.isChangeOrDefault?(o.newAddAddress(),!o.regionTrue&&o.isDef&&(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.streetText+" "+o.addressStreet)):o.defaultOrchange&&2==o.isChangeOrDefault?(o.address.provinceId=o.productChangeAddress.provinceId,o.address.cityId=o.productChangeAddress.cityId,o.address.areaId=o.productChangeAddress.areaId,o.address.streetId=o.productChangeAddress.streetId,o.address.regionName=o.productChangeAddress.regionName):4==o.isChangeOrDefault&&o.newAddAddress():o.isPosition?o.positionCommonFun():o.newAddAddress(),n.doInit(o.address).success(function(e,t,i,n){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",s.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},s.addressStr=void 0,o.isChangeOrDefault=0,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,o.fromOrder?o.$ionicGoBack(-2):o.$ionicGoBack()):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):o.globalConstant.mobileNumberRegExp.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+" "+o.addressStreet+" "+o.address.address,e.getLocation(o.allAddress,function(i,s){if("complete"==i&&s.geocodes.length){var n=s.geocodes[0].location.lat,a=s.geocodes[0].location.lng,r=[a,n];e.getAddress(r,function(e,i){if("complete"===e&&"OK"===i.info){o.township=i.regeocode.addressComponent.township,o.addressStreet=o.township;for(var s=[],n=[],s=o.dataAddStreet,a=0;a<s.length;a++)if(n.push(s[a].text),-1!=n.indexOf(o.township)){var r=n.indexOf(o.township);o.isNotDistinguish=!0,o.addChangeAddress.streetId=s[r].value,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=s[r].value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet}else o.isNotDistinguish=!1;if(o.isNotDistinguish){t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},s.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("ADDADDRESSService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,areaId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,isDefault:o.isDefault};return e({method:"POST",url:t.getUrl("ADDADDRESS_INIT"),params:i})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("AddPrizeAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","AddressPrizeService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var f=window.innerHeight,h=f-373+"px";o.contentHeight={height:h};var v=f-250+"px";o.contentHeightStreet={height:v},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={},o.init=function(){o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn?(o.addressRegionName="所在地区",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s"):(o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree),o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.$on("$ionicView.beforeEnter",function(){o.gameId=i.gameId,o.uuid=i.uuid,o.prizeId=i.prizeId,o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,
o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"")},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,i,s){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=s,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,n.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var S=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var i=0;i<o.nowLevelIndex.length;i++)i>o.nowLevel&&(o.nowLevelIndex[i]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",n.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,n.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,n.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if(S)return;c(function(){S=!1},1500),s.$broadcast(o.flag,o.defaultValue),S=!0,o.closeAddressModal()}},300),u.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),u.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.isPosition?o.positionCommonFun():o.newAddAddress(),n.doInit(o.address,o.gameId,o.uuid,o.prizeId).success(function(e,t,i,n){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",s.addressStr=void 0,o.isChangeOrDefault=0,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,r.showToast("添加成功"),setTimeout(function(){o.$ionicGoBack()},1e3)):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+o.address.address,e.getLocation(o.allAddress,function(i,s){if("complete"==i&&s.geocodes.length){var n=s.geocodes[0].location.lat,a=s.geocodes[0].location.lng,r=[a,n];e.getAddress(r,function(e,i){if("complete"===e&&"OK"===i.info){var s=i.regeocode.addressComponent;o.textThree==s.district?m.getAddressId(s.province,s.city,s.district,s.township,s.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){o.township=s.township,o.addressStreet=o.township,o.addChangeAddress.streetId=e.data.streetId,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=e.data.streetId,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet;t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}).error(function(e){o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}):o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},s.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("AddressPrizeService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n){var a={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,regionId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,gameId:i,uuid:s,prizeId:n};return e({method:"POST",url:t.getGameUrl("GAME_HAVE_PRIZE"),params:a})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)}}]),APP.controller("AddressController",["$ionicHistory","$ionicPopup","ChangeAddressService","$scope","AddressService","$state","$stateParams","$timeout","PopupService","$rootScope",function(e,t,o,i,s,n,a,r,c,l){i.image=[],i.addressMap=[],i.myData=[],i.updateResult=!0,i.updateContent="",i.goBack=function(){e.goBack()},i.init=function(){s.getAddressList().success(function(e,t,o,s){if(e.success){i.myData=e.data.addressList;for(var n=0,a=[],r=!1,c=0;c<e.data.addressList.length;c++)if("1"==e.data.addressList[c].isDefault){n=c,r=!0;break}a[0]=e.data.addressList[n];for(var d=0;d<n;d++)a[d+1]=e.data.addressList[d];for(var u=n+1;u<e.data.addressList.length;u++)a[u]=e.data.addressList[u];i.addressMap=a;for(var p=0;p<i.addressMap.length;p++)i.image[p]=l.imgBaseURL+"img/ic_check.png";r&&(i.image[0]=l.imgBaseURL+"img/ic_select.png")}})},i.setDefault=function(e){var t=i.addressMap[e];o.setDefaultAddr(t.id).success(function(e,t,o,s){1==e.success?i.init():i.showResult("修改失败")})},i.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?i.isIosAndInApp=!0:i.isIosAndInApp=!1,window.cordova?i.isApp=!0:i.isApp=!1,i.isIosAndInApp&&(i.iosStyleOne={padding:"64px 0 90px 0"},i.iosStyleTwo={top:"20px"}),i.isApp?i.bottomDivHeight={height:"40px"}:i.bottomDivHeight={height:"120px"},i.init()}),i.goToChange=function(e){var t=JSON.stringify(i.addressMap[e]);n.go("changeAddress",{addressData:t})},i.goToDelete=function(e){t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(t){if(t){var o=i.addressMap[e].id;s.deleteAddr(o).success(function(e,t,o,s){e.success?(c.showToast("删除成功"),setTimeout(function(){i.init()},1e3)):c.showToast("删除失败")})}})},i.goToConfirm=function(e){"YES"==a.comeFromOrder&&s.chooseLocation(e.id).success(function(e,t,o,s){1==e.success?i.$ionicGoBack():c.showToast("更改收货物地址失败,请重新选择")})}}]),APP.service("AddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e.get(t.getUrl("ADDRESS_INIT"))},this.deleteAddr=function(o){return e.get(t.getDeteleAddr("DETELEADDR_INIT",o))},this.chooseLocation=function(o){var i={addrId:o};return e.get(t.getUrl("CHOOSE_ADDR"),i)}}]),APP.controller("BatchDeleteAddressController",["BatchAddressService","$ionicHistory","$ionicPopup","$scope","PopupService","$rootScope",function(e,t,o,i,s,n){i.goBack=function(){t.goBack()},i.init=function(){i.image=[],i.chooseAddressNum=0,e.getAddressList().success(function(e,t,o,s){if(e.success){i.addressArray=e.data.addressList;for(var n=0,a=i.addressArray.length;n<a;n++)i.image[n]="img/ic_check.png"}})},i.selectDeleteAddress=function(e){-1!=i.image[e].indexOf("check")?(i.image[e]="img/ic_select.png",i.chooseAddressNum++):(i.image[e]="img/ic_check.png",i.chooseAddressNum--),i.chooseAddressNum==i.image.length?i.isSelectAllAddress=!0:i.isSelectAllAddress=!1},i.selectAllAddress=function(){if(i.isSelectAllAddress){for(var e=0,t=i.addressArray.length;e<t;e++)i.image[e]="img/ic_check.png";i.chooseAddressNum=0,i.isSelectAllAddress=!1}else{for(var e=0,t=i.addressArray.length;e<t;e++)i.image[e]="img/ic_select.png";i.isSelectAllAddress=!0,i.chooseAddressNum=i.image.length}},i.batchDelete=function(){if(0==i.chooseAddressNum)return void s.showToast("请选择要删除的地址");o.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){if(o){for(var s="",n=[],a=0,r=i.image.length;a<r;a++)-1!=i.image[a].indexOf("select")&&n.push(i.addressArray[a].id);s=n.join(",");var c={addrIds:s};e.batchDelete(c).success(function(e){if(e.success){if(i.isSelectAllAddress)return void t.goBack();i.init()}})}})},i.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?i.isIosAndInApp=!0:i.isIosAndInApp=!1,window.cordova?i.isApp=!0:i.isApp=!1,i.isIosAndInApp&&(i.iosStyleOne={padding:"64px 0 90px 0"},i.iosStyleTwo={top:"20px"}),i.isApp?i.bottomDivHeight={height:"40px"}:i.bottomDivHeight={height:"120px"},i.chooseAddressNum=0,i.isSelectAllAddress=!1,i.init()})}]),APP.service("BatchAddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e.get(t.getUrl("ADDRESS_INIT"))},this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ADDRESS"),o)}}]),APP.controller("ChangeAddressController",["$scope","$stateParams","$rootScope","ChangeAddressService","CommonAddressService","GoodsService","PopupService","$timeout","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d){var u=JSON.parse(t.addressData);e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.address={acceptor:u.consignee,mobile:u.mobile,detailAds:u.address,regionName:u.regionName,addrId:u.id,provinceId:u.provinceId,cityId:u.cityId,areaId:u.regionId,streetId:u.streetId},e.panGoOn=!1,e.updateResult=!0,e.updateContent="";var p=window.innerHeight,g=p-373+"px";e.contentHeight={height:g},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION",e.defaultValue=null,e.level=0;var m,f,h={};e.panGoOn=!1,e.updateResult=!0,e.updateContent="",e.init=function(){var o=JSON.parse(t.addressData);0==e.panGoOn?e.address={acceptor:o.consignee,mobile:o.mobile,detailAds:o.address,regionName:o.regionName,addrId:o.id,provinceId:o.provinceId,cityId:o.cityId,areaId:o.regionId,streetId:o.streetId}:e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree+" "+e.textFour,e.panGoOn=!1},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&d.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.init(),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.setDefault=function(){i.setDefaultAddr(e.address.addrId).success(function(t,o,i,s){1==t.success?e.$ionicGoBack():e.showResult("修改失败")})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,i,s){if(e.addressTipFlag=!1,d.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=s,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var r=0;r<e.nowLevelIndex.length;r++)r>e.nowLevel&&(e.nowLevelIndex[r]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",n.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){a.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var v=!1;e.goSelect=ionic.Utils.debounce(function(t,i){for(var s=0;s<e.nowLevelIndex.length;s++)s>e.nowLevel&&(e.nowLevelIndex[s]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=t;var i=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=i.text,e.defaultValue["value"+e.level]=i.value,e.level>-2)-1==e.level&&(e.selectProvince=i.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=d.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){1==ah&&(f=i.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){a.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(f,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,d.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){a.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=i.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=d.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=d.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(m=i.value);var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){a.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(m,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),d.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){a.showToast("获取地址信息失败！")})};else{if(v)return;r(function(){v=!1},1500),o.$broadcast(e.flag,e.defaultValue),v=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=o.globalConstant.autoPosition){h=s.getAddressInfo();var t=h.regionName+"/"+h.streetName;i.addAddress(h.provinceId,h.cityId,h.areaId,t,h.streetId).success(function(){var t={"text-1":h.provinceName,"text-2":h.cityName,"text-3":h.regionName,"text-4":h.streetName,"value-1":h.provinceId,"value-2":h.cityId,"value-3":h.areaId,"value-4":h.streetId};o.$broadcast(e.flag,t),e.addressModal.hide()})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.doChange=function(){return""==e.address.acceptor?void a.showToast("收货人不能为空"):e.address.acceptor.length>10||e.address.acceptor.length<2?void a.showToast("收货人为2-10个字符"):""==e.address.mobile?void a.showToast("手机号码不能为空"):e.globalConstant.mobileNumberRegExp.exec(e.address.mobile)?"所在区域"==e.address.regionName?void a.showToast("请选择所在区域"):/^.[^&<>]{2,29}$/.exec(e.address.detailAds)?void i.changeAddr(e.address).success(function(t,o,i,s){t.success?e.$ionicGoBack():e.showResult("修改失败")}):void a.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void a.showToast("手机号码不正确")},o.$on("CHANGEADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.address.provinceId=o["value-1"],e.address.cityId=o["value-2"],e.address.areaId=o["value-3"],e.address.streetId=o["value-4"],e.init()}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,r(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeAddressService",["$http","UrlService",function(e,t){this.changeAddr=function(o){var i={addrId:o.addrId,consignee:o.acceptor,mobile:o.mobile,regionName:o.regionName,provinceId:o.provinceId,cityId:o.cityId,areaId:o.areaId,streetId:o.streetId,address:o.detailAds};return e({method:"POST",url:t.getUrl("CHANGEADDR_INIT"),params:i})},this.setDefaultAddr=function(o){var i={addrId:o};return e.get(t.getUrl("SETDEFAULT_INIT"),i)},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("BankCardController",["$localstorage","$scope","HomePageService","$ionicHistory","InAppBrowserService","UrlService","$state","bankCardService","$ionicScrollDelegate","EasyConnectService",function(e,t,o,i,s,n,a,r,c,l){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){null==i.viewHistory().backView?a.go("personnalCenter"):"shopRevenue"==i.viewHistory().backView.stateName||"paymentxyz"==i.viewHistory().backView.stateName?i.goBack():a.go("personnalCenter")},t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.clickBind=function(){if(!window.device)return void window.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.bind().success(function(o,i,a,r){if(window.device&&window.device.hasNewBrowser){var c=ionic.Platform.isAndroid();if(c){var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}else{var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}else{var c=ionic.Platform.isAndroid();if(c){var d=cordova.InAppBrowser.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");d.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){d.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),d.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&d.close()}),d.addEventListener("exit",function(e){t.init()})}else{var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}})},t.init=function(){o.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?t.iso2o=!0:t.iso2o=!1}),r.doInit().success(function(e){e.success&&(0==e.data.isBindKJT?t.isBindKjt=!0:t.isBindKjt=!1,0==e.data.isBindYHK?t.isBindBank=!0:t.isBindBank=!1,t.hasBindKJT=e.data.isBindKJT,t.hasBindYHK=e.data.isBindYHK,t.backGroundOrImg=e.data.BankCardList,t.backGroundOrKjt=e.data.kjtAccount)})},t.$on("$ionicView.beforeEnter",function(){c.scrollTop(),t.backGroundOrKjt="",t.backGroundOrImg="",t.isBindKjt=!1,t.isBindBank=!1,t.init()})}]),APP.service("bankCardService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("HAS_BANK_LIST_NEW"))}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("bankCardDetailController",["$localstorage","$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","bankCardDetialService","$state","UrlService","EasyConnectService","InAppBrowserService","PopupService","$interval",function(e,t,o,i,s,n,a,r,c,l,d,u,p){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){r.go("bankCard")};var g="";t.nameKjt="",t.isKJT=!1,t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.VCodeTips="获取验证码",t.canGetVcode=!0,t.userInfo={verificationCode:""},t.getVCode=function(){t.canGetVcode&&a.fastLoginCaptchaNew(g).success(function(e){if(e.success){u.showToast("您正在操作解绑银行卡，短信验证码已经发送到您绑定银行卡时的预留银行手机号"+t.bankCardDetailList.phoneNo+"中，请查收并进行验证。"),t.canGetVcode=!t.canGetVcode;var o=60;t.timer=p(function(){o-1<0?(t.VCodeTips="获取验证码",p.cancel(t.timer),t.canGetVcode=!0):(o--,t.VCodeTips=o+"s后可重发 ")},1e3)}else u.showToast(e.message)})},t.unBindBank=function(){if(t.userInfo.verificationCode.length<=0)u.showToast("请输入短信验证码");else{i.confirm({template:"确认解除绑定该银行卡?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){e&&a.deleteBank(g,t.userInfo.verificationCode).success(function(e){e.success?(u.showToast("您的银行卡已经解绑成功！"),setTimeout(function(){r.go("bankCard")},2e3)):u.showToast(e.message)})})}},t.clickUnBind=function(){if(!window.device)return void window.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.unBlind().success(function(t,o,i,s){var n=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(n){var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=ionic.Platform.isAndroid();if(n){var l=cordova.InAppBrowser.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");l.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&$timeout(function(){l.executeScript({
code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),l.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&l.close()}),l.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}}})},t.init=function(){a.doInit(g).success(function(e){e.success&&(t.bankCardDetailList=e.data)})},t.$on("$ionicView.beforeEnter",function(){s.scrollTop(),g="",t.nameKjt="",t.bankCardDetailList,g=n.cardNoShow,t.nameKjt=n.nameKjt,""!=t.nameKjt?(t.isKJT=!0,t.bankCardDetailList=g):(t.isKJT=!1,t.init())})}]),APP.service("bankCardDetialService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={cardNo:o};return e.get(t.getUrl("BANK_LIST_DETAIL_NEW"),i)},this.deleteBank=function(o,i){var s={cardNo:o,captcha:i};return e.get(t.getUrl("BANK_DELETE_NEW"),s)},this.fastLoginCaptchaNew=function(o){var i={cardNo:o};return e.get(t.getUrl("BANK_DELETE_CAPTCHA"),i)}}]),APP.controller("bankSupportController",["$scope","$ionicHistory","$ionicPopup",function(e,t,o){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}]}]),APP.controller("chooseTheBankController",["$scope","$ionicHistory","$ionicPopup","$state","$rootScope",function(e,t,o,i,s){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.differentStyleHas=-1,e.differentStyle={background:"#eee"},e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}],e.chooseBank=function(o,i,n){e.differentStyleHas=o,s.$broadcast("haveChooseBank",o,i,n),t.goBack()}}]),APP.controller("mentionCenterController",["$rootScope","$ionicPopup","$localstorage","$scope","HomePageService","$ionicHistory","bankCardService","mentionCenterService","$stateParams","$state","ShopRevenueService","EasyConnectService","UrlService","InAppBrowserService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){d.getAccountState(e).success(function(e){e.success&&(accountState=e.data)})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.matchValue=0,i.account="",i.goBack=function(){null==n.viewHistory().backView?l.go("personnalCenter"):n.goBack()},i.backGroundOrPic={"03020000":{img:"1CITIC"},"01030000":{img:"2ABC"},"01020000":{img:"3ICBC"},"01050000":{img:"4CCB"},"03080000":{img:"5CMB"},"03180000":{img:"6SZPAB"},"01040000":{img:"7BOC"},"03090000":{img:"8CIB"},"03100000":{img:"9SPDB"},"03050000":{img:"10CMBC"},"03040000":{img:"11HXB"},"03030000":{img:"12CEB"},"01000000":{img:"13PSBC"},"03010000":{img:"14COMM"},"04031000":{img:"15BCCB"},"03060000":{img:"16GDB"},"03110000":{img:"17EGBANK"},"04233310":{img:"18HCCB"},"04083320":{img:"19NBCB"},88888888:{img:"20KJT"}},i.clickBank=function(e){i.matchValue=e},i.getCashNow=function(){r.getCash(i.backGroundOrKjt.memberKjtpayAccount,"KJT").success(function(e,o,i,s){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var n=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});n.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},i.withdraw=function(){if(2==accountState){var e="提现需要绑定快捷通，请点击确定去绑定快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.bind().success(function(e,t,s,n){if(window.device&&window.device.hasNewBrowser){var a=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){i.init()})}else{if(ionic.Platform.isAndroid()){var r=cordova.InAppBrowser.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");r.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){r.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),r.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&r.close()}),r.addEventListener("exit",function(e){i.init()})}else{var a=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){i.init()})}}})}})}else if(3==accountState)i.getCashNow();else if(4==accountState){var e="提现需要实名认证快捷通，请点击确定去认证快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.realName().success(function(e,t,s,n){g.open(p.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){i.init()})})}})}else if(1==accountState){var e="提现需要激活快捷通，请点击确定去激活快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.activation().success(function(e,t,s,n){g.open(p.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){i.init()})})}})}},i.clickBind=function(){if(!window.device)return void window.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");u.bind().success(function(e,t,s,n){if(window.device&&window.device.hasNewBrowser){var a=ionic.Platform.isAndroid();if(a){var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}else{var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}}else{var a=ionic.Platform.isAndroid();if(a){var c=cordova.InAppBrowser.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");c.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){c.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),c.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&c.close()}),c.addEventListener("exit",function(e){i.init()})}else{var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}}})},i.mentionCenterBankNow=function(){r.getCash(i.backGroundOrImg.cardNoShow,"YHK").success(function(e,o,i,s){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var n=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});n.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},i.init=function(){f(i.earningType),s.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?i.iso2o=!0:i.iso2o=!1}),a.doInit().success(function(e){e.success&&(i.hasBindKJT=e.data.isBindKJT,i.hasBindYHK=e.data.isBindYHK,i.backGroundOrImg=e.data.BankCardList,i.backGroundOrKjt=e.data.kjtAccount,i.hasBindYHK&&i.moneyHundred&&(i.matchValue=1))})},i.$on("$ionicView.beforeEnter",function(){i.earningType="B",i.account="",i.backGroundOrImg="",i.backGroundOrKjt="",i.canGetMount="",i.canGetMount=c.canAmount,e.canGetMount=c.canAmount,parseInt(i.canGetMount)>0?i.moneyNoone=!0:i.moneyNoone=!1,parseInt(i.canGetMount)>=1e3?i.moneyHundred=!0:i.moneyHundred=!1,i.hasBindKJT=!1,i.hasBindYHK=!1,i.init()})}]),APP.service("mentionCenterService",["$http","UrlService",function(e,t){this.getCash=function(o,i){var s={kjtAccount:o,paymentType:i};return e.get(t.getUrl("GETCASH_INIT"),s)}}]),APP.controller("historyTaskController",["$scope","$stateParams","ShareService",function(e,t,o){function i(e){for(var t in e)return!1;return!0}e.history="",e.isHistory=!1,e.loadData=function(){o.myHistoryShare().success(function(t){e.history=t.data,i(e.history)&&(e.isHistory=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.isHistory=!1}),e.$on("$ionicView.enter",function(){e.loadData()})}]),APP.controller("MissionDetailController",["$q","$scope","UrlService","MissionDetailService","PopupService","$rootScope","$stateParams","CreditService","UserService",function(e,t,o,i,s,n,a,r,c){function l(t){var o=e.defer();return i.getQrCodeUrl(t).success(function(e){o.resolve(e.data)}),o.promise}function d(e,s,a){var r=t.missionContent.taskDestWithStatusVOs[0].id,l=c.getUser().mid,d=t.name,u=t.editableContent||t.editContent,p=(t.checkImg,t.imgArr&&t.imgArr.length>0?t.imgArr[0]:null);if(window.umeng){if(window.cordova&&cordova.plugins.clipboard.copy(u),-1==e&&window.umeng.iosPlatformShared(d,u,p,[p],0,a,function(){}),4==t.taskType){var g=t.configData.linkUrl;null==p&&(p="http://www.ehaier.com/mstatic/wd/v2/img/icons/ic_default_avatar.png"),0==e?window.umeng.shareToSina(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,u,p,g,0,null,function(){i.missionShare(t.taskType,"QQ").success(function(){t.init()})}):4==e&&window.umeng.shareToQzone(d,u,p,g,0,null,function(){i.missionShare(t.taskType,"QQ空间").success(function(){t.init()})})}else if(3==t.taskType){var m=t.configData.productTitle||t.configData.productName,f=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+l+"/"+l;0==e?window.umeng.shareToSina(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"QQ").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"QQ空间").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})})}else 0==e?window.umeng.shareToSina(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"QQ").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(d,u,p,null,2);t.showShare=!1}else alert("umeng undefined 只能在app分享")}t.hasQQ=!1,t.isIOS=ionic.Platform.isIOS(),t.UserTaskStatus=null,t.needTake="",t.hideblackCover=function(){t.showShare=!1},t.savaEditContent=function(e){t.editableContent=e},t.goBack=function(){t.$ionicGoBack()},t.output=function(e){},t.copyLinkUrl=function(){window.cordova?(cordova.plugins.clipboard.copy(t.linkUrl),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},t.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastWithTime("复制成功",2e3)):s.showToast("请下载APP执行此操作")},t.share=function(){if(window.umeng){if(window.cordova&&(cordova.plugins.clipboard.copy(t.editContent),n.hasShowPasteHint||(s.showToastWithTime("请直接粘贴分享文字内容",2e3),n.hasShowPasteHint=!0)),window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else if(window.umeng){if(!t.missionContent)return void t.showPopup("网络连接失败，请稍后分享");var e=t.name,i=t.editContent,a=(t.checkImg,t.imgArr[0]),r=o.getShareLinkHeader()+"missionDetail/"+t.taskId;window.cordova&&cordova.plugins.clipboard.copy(i),window.umeng.share(e,i,a,r,2)}}else s.showAlert("只能在app分享","抱歉，只能在app分享")},t.shareToPlatform=function(e,i){var s=null,n="",a=c.getUser().mid;1==t.configData.qrcodeType||void 0==t.configData.qrcodeType?(s=t.missionContent.resultMap.qrCode,d(e,i,s)):2==t.configData.qrcodeType?(n=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+a+"/"+a,l(escape(n)).then(function(t){s=t,d(e,i,s)})):3==t.configData.qrcodeType?(n=o.getShareLinkHeader()+"register/0/"+t.missionContent.resultMap.promotionCode,l(escape(n)).then(function(t){s=t,d(e,i,s)})):0==t.configData.qrcodeType?d(e,i,null):d(e,i)},t.init=function(){i.getMissionDetail(t.taskId).success(function(e){e.success&&(t.UserTaskStatus=e.data.taskInfoWithStatusVO.userTaskStatus,t.needTake=e.data.taskInfoWithStatusVO.needTake,t.missionContent=e.data,t.xyzTaskDestId=t.missionContent.taskDestWithStatusVOs[0].id,t.name=t.missionContent.taskInfoWithStatusVO.name,t.taskType=t.missionContent.taskInfoWithStatusVO.taskType,t.isFinished=t.missionContent.taskInfoWithStatusVO.isFinished,t.configDataStr=t.missionContent.taskInfoWithStatusVO.configData,t.configData=JSON.parse(t.configDataStr),t.missionTitleArr=["","早安","晚安","分享商品","分享链接","士兵突击","图片分享","晒战绩"],t.missionTitle=t.missionTitleArr[t.taskType],t.time=new Date,t.editContent=t.missionContent.taskInfoWithStatusVO.content,t.taskAwards=t.missionContent.taskInfoWithStatusVO.taskAwards[0],0==t.taskAwards.awardType?t.taskAwardsContent=t.taskAwards.awardNum+"金币":1==t.taskAwards.awardType&&(t.taskAwardsContent=t.taskAwards.awardNum+"积分"),t.configData.imageUrls&&(t.imgArr=t.configData.imageUrls),t.configData.productName&&(t.productName=t.configData.productName),t.configData.linkUrl&&(t.linkUrl=t.configData.linkUrl))}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.taskId=a.taskId,t.checkImgIndex=[],t.checkImh=[],t.init()})}]),APP.service("MissionDetailService",["$http","UrlService","IMService",function(e,t,o){this.getMissionDetail=function(o){var i={taskId:o};return e.get(t.getUrl("MISSION_DETAIL"),i)},this.missionShare=function(i,s,n){var a={taskType:i,taskDestId:s,sharePlatform:n};return o.validateWebSocket(),e.get(t.getUrl("MISSION_SHARE"),a)},this.getQrCodeUrl=function(o){var i={requestUrl:o};return e.get(t.getUrl("GET_QRCODE"),i)}}]),APP.controller("taskShareController",["$scope","$state","ShareService","$rootScope","PopupService","$ionicHistory","UserService",function(e,t,o,i,s,n,a){function r(e){for(var t=[],o=[],i=e.length,s=i-1;s>=0;s--)5==e[s].taskType?o.push(e[s]):e[s].isFinished?t.push(e[s]):t.unshift(e[s]);return o.concat(t)}e.colorStyle1={color:"#030303"},e.colorStyle2={color:"blue"},e.share="";e.loadData=function(){o.myShare(0,100).success(function(t){e.share=r(t.data.rows)}).error(function(){})},e.goBack=function(){e.$ionicGoBack()},e.goShare=function(o,i,s){7==s?t.go("competition",{taskDestId:"",taskType:s,memberId:e.xyzMemberId}):t.go("missionDetail",{taskId:i})},e.shake=function(){alert("lover")},e.$on("$ionicView.enter",function(t,o){"back"==o.direction&&i.shareSucBack?(i.shareSucBack=!1,i.freshMission=!0,i.missionLists=function(){e.loadData()}):e.loadData()}),e.$on("$ionicView.beforeEnter",function(){e.xyzMemberId=a.getUser().mid})}]),APP.service("ShareService",["$http","UrlService",function(e,t){this.myShare=function(o,i){var s={startIndex:o,pageSize:i};return e.get(t.getUrl("SHAER_TASK"),s)},this.myHistoryShare=function(){return e.get(t.getUrl("SHAER_HISTORY_TASK"))}}]),APP.controller("PartnerController",["$ionicHistory","$scope","$state","PartnerService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){function S(e,o,s,n,a,r,c){i.partnerTeamSearch({memberId:e,cascade:o,pageNumber:s,pageSize:n,sort:a,order:r,noLoading:c}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.pageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}function I(e,o,s,n,a,r,c,l){i.anthenSearch({memberId:e,cascade:o,isAuthenticated:s,pageNumber:n,pageSize:a,sort:r,order:c,noLoading:l}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.authenticatedNum=e.data.authenticatedNum,t.UnAuthenticatedNum=e.data.unAuthenticatedNum,t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.authpageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}t.goBack=function(){t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.arrowState=[p.imgBaseURL+"img/Group@2x.png",p.imgBaseURL+"img/Group1@2x.png",p.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["asc","desc"],"asc","asc"],t.title="partner"==d.title?"合伙人":"团队",t.authenIndex=0,t.hasmore=!1,t.front=d.front,t.shareStoreId=d.shareStoreId,t.isBuyer=m.getRole(),t.userId=r.getUser().mid;t.pagesort="startTime",t.order="asc",t.memberId=d.memberId,t.cascade="partner"!=d.title,t.isAuthenticated=!0,t.init=function(){t.pageNumber=1,t.pageSize=10,S(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!1)},t.authInit=function(){t.authpageNumber=1,t.pageSize=10,I(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!1)},t.$on("$ionicView.beforeEnter",function(e,o){f.scrollTop(),t.chooseIndex=0,t.partnerChildren=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=d.memberId,t.init()}),t.loadMore=function(){1==t.chooseIndex?I(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!0):S(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!0)},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e))if(f.scrollTop(),t.page=2,0==e){t.chooseIndex=e;t.openStoreTime_index;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.partnerChildren=[],t.pagesort="startTime",t.order=1==t.openStoreTime_index?"asc":"desc",t.init()}else 1==e?(t.authenIndex=0,t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.partnerChildren=[],t.order=0==t.openStoreTime_index?"asc":"desc",t.pagesort="isAuthenticated",t.isAuthenticated=!0,t.authInit()):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.partnerChildren=[],t.filterParams="saleDesc",t.order=0==t.openStoreTime_index?"desc":"asc",t.pagesort="teamLevelOrder",t.init())},t.chooseAnthen=function(e){0==e?(t.isAuthenticated=!0,t.pagesort="isAuthenticated",t.authenIndex=0,t.partnerChildren=[],t.authInit()):1==e&&(t.isAuthenticated=!1,t.pagesort="isAuthenticated",t.authenIndex=1,t.partnerChildren=[],t.authInit())}}]),APP.service("PartnerService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,i,s,n,a,r,c,l,d,u){var p={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:u};return e.get(t.getUrl("SEARCHGOODS_INIT"),p)},this.myStoreSearch=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)},this.partnerTeamSearch=function(o){var i=t.getUrl("GET_PARTNER_TEAM");return e.get(i,o)},this.anthenSearch=function(o){var i=t.getUrl("GET_PARTNER_TEAM");return e.get(i,o)}}]),APP.controller("VisiBroHisController",["$http","$scope","$cacheFactory","VisiBroHisService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","storeTeamOwnerService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){t.chooseIndex=0,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.init=function(){t.memberId=l.getUser().mid,t.userId=27483685,t.userId=s.userId,t.daysType=s.daysType,t.hasmore=!1,i.getVisitorBrowHis(t.userId,t.daysType).success(function(e){1==e.success&&(t.productList=e.data),e.data.productsList}).error(function(e){})},t.goBack=function(){t.$ionicGoBack()},t.showPopup=function(e){var t=d.show({template:e});u(function(){t.close()},1e3)},t.$on("$ionicView.beforeLeave",function(e,o){t.watch()}),t.$on("$ionicView.beforeEnter",function(e,o){t.userInfo=$.visitorInfo,t.init(),t.showComprehensiveSub=!1,t.nowLevel=0,t.nowLevelIndex=[-1,-1,-1,-1],t.finish=!1,t.watch=t.$watch("finish",function(e,o){e&&m.$getByHandle("mainScroll").scrollTo(0,t.provinceTop)}),t.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIos1=!0:t.isIos1=!1,t.storeId=v.get("storeId",g.globalConstant.storeId),t.memberId=l.getUser().mid,t.buttonShow=!1,t.page=1,t.hasmore=!1})}]),APP.service("VisiBroHisService",["$http","UrlService",function(e,t){this.getVisitorBrowHis=function(o,i){var s={userId:o,daysType:i};return e.get(t.getUrl("GET_VISI_BROW_HIS"),s)}}]),APP.controller("AccountMessageController",["$scope","AccountMessageService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(t){var o=t[0];if(window.FileReader){var i=new FileReader;i.readAsDataURL(o),i.onloadend=function(t){e.$apply(e.iconImage=t.target.result)}}}e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.sexMap=["保密","男","女"],e.accountMessage="",e.accountName="",e.accountEmail="",e.accountSexValue="0",e.accountSex=e.sexMap[e.accountSexValue],e.accountBirthday="",e.accountNumber="",e.iconImage=o.imgBaseURL+"img/ic_login_user.png",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=a.getUser(),e.sexMap=["保密","男","女"],void 0!=e.user.avatarImageFileId&&(e.iconImage=e.user.avatarImageFileId),e.accountMessage=e.user.userName,e.accountName=e.user.nickName,e.accountSexValue=e.user.gender,e.accountSex=e.sexMap[e.accountSexValue],e.accountEmail=e.user.email,e.accountBirthday=e.user.birthday,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,a.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){i.go("guidePage")},e.changeIcon=function(){if("APP"==c.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(o){function i(o){e.iconImage=o,n(function(){e.iconImage=o},200);var i=function(t){r.hide(),e.showResult("上传成功");var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,a.setUser(e.user)},s=function(t){r.hide(),e.showResult("上传失败")},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),i,s,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function s(e){}function c(o){e.iconImage=o,n(function(){e.iconImage=o},200);var i=function(t){e.showResult("上传成功"),r.hide();var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,a.setUser(e.user)},s=function(t){e.showResult("上传失败"),r.hide()},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),i,s,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function l(e){}1==o?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(c,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,i),n(function(){window.plugins.actionsheet.hide()},5e3)}else{d.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},e.$watch("userInfo.picTempFile",function(){e.userInfo&&e.userInfo.picTempFile&&e.userInfo.picTempFile.length>0&&g(e.userInfo.picTempFile)},!1),e.unload=function(){void 0==e.user.sessionValue?(a.clearUser(),e.goGuidePage(),u.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),p.set("storeId","")):t.unloadAccount(e.accountToken,e.accountSessionId,e.accountHeaderKey).success(function(t,o,i,s){t.success&&(a.clearUser(),e.goGuidePage(),u.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),p.set("storeId",""))})},e.goToDelete=function(){d.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"}).then(function(t){t&&e.unload()})},e.selectDate=function(){if("APP"==c.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){n(function(){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),t.changeMessage(e.accountMessage,n+"-"+s+"-"+i,e.accountSexValue,e.accountName).success(function(t,o,r,c){t.success?(e.accountBirthday=n+"-"+s+"-"+i,e.user.birthday=n+"-"+s+"-"+i,a.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s);var n=new Date(o).getFullYear()+"-"+i+"-"+s;t.changeMessage(e.accountMessage,n,e.accountSexValue,e.accountName).success(function(t,o,i,s){t.success?(e.accountBirthday=n,e.user.birthday=n,a.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})}};l.openDatePicker(i)}},o.$on("SELECT_SEX",function(t,o){e.accountSexValue=o,e.accountSex=e.sexMap[e.accountSexValue],e.user.gender=o,a.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_NAME",function(t,o){e.accountName=o,e.user.nickName=o,a.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,a.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){e.$ionicGoBack()},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("AccountMessageService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,i,s){var n=o,a="Bearer "+s+" "+n,r={Authorization:a},c={sessionId:i};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("ChangeEmailController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeEmailService",function(e,t,o,i,s,n,a){e.email={value:t.email},e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName,e.updateResult=!0,e.updateContent="",e.init=function(){
e.email={value:t.email},e.gender=t.gender|JSON.parse(window.localStorage.USER_CACHE_KEY).gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){var t=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;return e.email.value?t.exec(e.email.value)?void a.changeEmail(e.userName,e.birthday,e.gender,e.nickName,e.email.value).success(function(t,i,s,a){t.success?(o.$broadcast("CHANGE_EMAIL",e.email.value),n.go("accsafe")):t.message?e.showResult(t.message):e.showResult("未知异常")}):void i.showToast("电子邮箱输入不规范"):void i.showToast("您输入的邮箱不能为空")},e.goBack=function(){n.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeEmailService",["$http","UrlService",function(e,t){this.changeEmail=function(o,i,s,n,a){var r={userName:o,birthday:i,gender:s,nickName:n,email:a};return e({method:"POST",url:t.getUrl("UPDATE_EMAIL"),params:r})}}]),APP.controller("ChangeNameController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeNameService",function(e,t,o,i,s,n,a){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){if(!e.name.value)return void i.showToast("您输入的昵称不能为空");a.changeMessage(e.userName,e.birthday,e.gender,e.name.value).success(function(t,i,s,a){t.success?(o.$broadcast("CHANGE_NAME",e.name.value),n.go("accsetting")):t.message?e.showResult(t.message):e.showResult("未知异常")})},e.goBack=function(){n.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeNameService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("ChangePasswordController",["$scope","ChangePassWordService","PopupService","$timeout","$state","UserService",function(e,t,o,i,s,n){e.user="",e.password={oldWord:"",newWord:"",makeSureWord:""},e.accountMessage="",e.accountToken="",e.updateContent="",e.updateResult=!0,e.init=function(){e.user=n.getUser(),e.accountMessage=e.user.userName,e.accountToken=e.user.token,e.password={oldWord:"",newWord:"",makeSureWord:""}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goLoginPage=function(){s.go("login")},e.doChange=function(){var s=e.globalConstant.passwordRegExp;return e.password.oldWord?e.password.newWord?s.test(e.password.newWord)?e.password.makeSureWord?e.password.makeSureWord!=e.password.newWord?void o.showToast("两次输入的新密码不相同"):void t.doInit(e.accountToken,e.accountMessage,e.password.oldWord,e.password.newWord).success(function(t,o,s,a){t.success?(e.showResult("修改成功"),n.clearUser(),i(function(){e.goLoginPage()},1e3)):e.showResult(t.message)}):void o.showToast("确认密码不能为空"):void o.showToast("新密码不符合规则"):void o.showToast("新密码不能为空"):void o.showToast("原密码不能为空")},e.goBack=function(){s.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangePassWordService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n){var a=o,r={token:a,userName:i,oldPassword:encodeURIComponent(s),password:encodeURIComponent(n)};return e({method:"POST",url:t.getUrl("UPDATEPASSWORD_INIT"),params:r})}}]),APP.controller("SelectSexController",["$scope","$stateParams","$rootScope","$state","SelectSexService","$timeout",function(e,t,o,i,s,n){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doSelect=function(t){e.sex.value=t,s.changeMessage(e.userName,e.birthday,e.sex.value,e.nickName).success(function(i,s,n,a){i.success?(o.$broadcast("SELECT_SEX",t),e.$ionicGoBack()):i.message?e.showResult(i.message):e.showResult("未知异常")})},e.goBack=function(){i.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("SelectSexService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("BuyerCenterController",["$scope","AccountMessageService","$state","UserService","LoginService","PopupService","$stateParams","RegisterService","$rootScope",function(e,t,o,i,s,n,a,r,c){e.isBuyer=s.getRole(),e.shareStoreId=a.shareStoreId,e.init=function(t){var o=i.getUser();o.avatarImageFileId?e.avatarImageFileId=o.avatarImageFileId:e.avatarImageFileId=c.imgBaseURL+"img/ic_person.png",e.mid=o.mid,e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.applyShop=function(){0==e.isBuyer?(r.wdApply().success(function(e){e.success?e.data?o.go("shopApply"):o.go("registerForStore"):n.showToast("服务端错误")}).error(function(){alert("网络错误")}),o.go("shopApply")):e.shareStoreId?o.go("myStore",{storeId:e.mid,shareStoreId:e.shareStoreId}):o.go("myStore",{storeId:e.mid})},e.logOut=function(){void 0==e.sessionId?(i.clearUser(),s.setRole(void 0),o.go("guidePage")):t.unloadAccount(e.token,e.sessionId,e.header).success(function(e,t,n,a){e.success&&(i.clearUser(),s.setRole(void 0),o.go("guidePage"))})},e.goBack=function(){o.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.isBuyer=s.getRole(),e.init(0)})}]),APP.controller("BindAccountController",["$scope","EasyConnectBindAccountService",function(e,t){e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,i,s){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("EasyConnectBindAccountService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTACCOUNT_INIT"))}}]),APP.controller("BindResultController",["$scope","EasyConnectBindResultService","$rootScope",function(e,t,o){e.iconImage=o.imgBaseURL+"img/ic_person.png",e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,i,s){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("EasyConnectBindResultService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTRESULT_INIT"))}}]),APP.controller("EasyConnectController",["$localstorage","$scope","EasyConnectService","PopupService","$timeout","$state","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r){t.bindData=[],t.account="",t.mobile="",t.updateResult=!0,t.updateContent="",t.init=function(){o.getMessage().success(function(e,o,s,n){e.success?(t.bindData=e.data.kjtAccount,e.data.kjtAccount&&e.data.kjtAccount.status&&"0"==e.data.kjtAccount.status&&(t.account=e.data.kjtAccount.memberRealName,t.mobile=e.data.kjtAccount.memberKjtpayAccount)):e.message?i.showToast(e.message):i.showToast("登录失败！")})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goToAccount=function(){n.go("bindAccount")},t.clickBind=function(){if(!window.device)return void window.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.bind().success(function(o,i,n,c){if(window.device&&window.device.hasNewBrowser){var l=ionic.Platform.isAndroid();if(l){var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}else{var l=ionic.Platform.isAndroid();if(l){var u=cordova.InAppBrowser.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");u.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&s(function(){u.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),u.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&u.close()}),u.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.clickUnBind=function(){if(!window.device)return void window.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.unBlind().success(function(o,i,n,c){var l=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(l){var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var l=ionic.Platform.isAndroid();if(l){var u=cordova.InAppBrowser.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");u.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&s(function(){u.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),u.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&u.close()}),u.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,s(function(){t.updateResult=!0},1e3)},t.goBack=function(){n.go("mine")}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("EasyConnectIframeController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.controller("ClassifyMessageCenterController",["$localstorage","$timeout","$scope","$rootScope","CLASSIFYMESSAGECRNTERService","$state","UserService","InAppBrowserService","UrlService","$http","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.goBack=function(){o.$ionicGoBack()},o.init=function(){s.getMseeageClassify().success(function(e){null==e.data.orderMesagesList?o.orderMessage="":o.orderMessage=e.data.orderMesagesList.content,o.orderNum=e.data.orderNum,null==e.data.platformMesagesList?o.platformMessage="":o.platformMessage=e.data.platformMesagesList.content,o.platformNum=e.data.platformNum,null==e.data.memberMesagesList?o.memberMessage="":o.memberMessage=e.data.memberMesagesList.content,o.memberNum=e.data.memberNum,null==e.data.communityMesagesList?o.communityMessage="":o.communityMessage=e.data.communityMesagesList.content,o.communityNum=e.data.communityNum,o.orderNum>99?o.orderNumClose="99+":o.orderNumClose=o.orderNum,o.platformNum>99?o.platformNumClose="99+":o.platformNumClose=o.platformNum,o.memberNum>99?o.memberNumClose="99+":o.memberNumClose=o.memberNum,o.communityNum>99?o.communityNumClose="99+":o.communityNumClose=o.communityNum})},o.$on("$ionicView.beforeEnter",function(){o.init()}),o.goMessageList=function(e){o.messageType=e,n.go("messageCenter",{messageType:o.messageType})},o.customerServe=function(){if(window.cordova){var i=ionic.Platform.isAndroid(),s=null;s=i?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&t(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+o.kfTocken);return}}]),APP.service("CLASSIFYMESSAGECRNTERService",["$http","UrlService","$rootScope",function(e,t,o){this.getMseeageClassify=function(){var o={messageType:0};return e.get(t.getUrl("MESSAGE_CLASSIFY"),o)},this.getMseeageClassifyNew=function(o){var i={messageType:o};return e.get(t.getUrl("MESSAGE_CLASSIFY"),i)}}]),APP.controller("DetailMessageCenterController",["$scope","$stateParams",function(e,t){e.htmlContent=t.content,e.title=t.title,e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("MessageCenterController",["$ionicScrollDelegate","$timeout","$scope","$rootScope","$stateParams","MESSAGECENTERService","$state","UserService","InAppBrowserService","UrlService","$http",function(e,t,o,i,s,n,a,r,c,l,d){o.messageMap=[],o.breakLine=[],o.mesType=s.messageType,o.messageList="",o.hasmore=!1,o.page=1,o.size=10;var u,p=1,g="";o.goBack=function(){o.$ionicGoBack()},o.init=function(){u=r.getUser(),e.scrollTop(),n.getMessageList(o.mesType,o.page,o.size).success(function(e){1==o.mesType?(o.messageList=e.data.orderMesagesList,o.count=e.data.orderCount):2==o.mesType?(o.messageList=e.data.memberMesagesList,o.count=e.data.memberCount):3==o.mesType?(o.messageList=e.data.platformMesagesList,o.count=e.data.platformCount):4==o.mesType&&(o.messageList=e.data.communityMesagesList,o.count=e.data.communityCount),g=Math.ceil(o.count/o.size),o.hasmore=!(o.page>=g)})},o.loadMore=function(){var e=o.messageList;p+=1;var t={messageType:o.mesType,page:p,size:o.size};d.get(l.getUrl("MESSAGE_CLASSIFY"),t).success(function(t){1==o.mesType?(o.messageList=e.concat(t.data.orderMesagesList),o.count=t.data.orderCount):2==o.mesType?(o.messageList=e.concat(t.data.memberMesagesList),o.count=t.data.memberCount):3==o.mesType?(o.messageList=e.concat(t.data.platformMesagesList),o.count=t.data.platformCount):4==o.mesType&&(o.messageList=e.concat(t.data.communityMesagesList),o.count=t.data.communityCount),o.hasmore=!(o.count<o.messageList.length),o.$broadcast("scroll.infiniteScrollComplete")})},o.goDetail=function(e){var t={id:e.id};n.checkRead(t).success(function(e){n.unreadMessage()});var i=navigator.userAgent;if(1==e.type)if(-1!=i.indexOf("iPhone")){var s=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);s.addEventListener("exit",function(e){})}else a.go("helpDetail",{helpId:e.relationId,content:e.title});else if(2==e.type)a.go("shopRevenue");else if(3==e.type||51==e.type)a.go("orderDetail",{orderSn:"",cOrderSn:"",cOrderId:e.relationId});else if(4==e.type)if(-1!=i.indexOf("iPhone")){var s=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);s.addEventListener("exit",function(e){})}else a.go("helpDetail",{helpId:e.relationId,content:e.title});else if(5==e.type)a.go("orderManage",{orderStatus:4});else if(601==e.type)e.relationId?a.go("noteDetails",{noteId:e.relationId,isShortStory:1}):a.go("goldRecord");else if(602==e.type)a.go("noteDetails",{noteId:e.relationId,isShortStory:0});else if(603==e.type)e.relationId?a.go("classNoteDetails",{noteId:e.relationId}):a.go("goldRecord");else if(604==e.type)a.go("myFans");else if(0==e.type){var u=r.getUser().mid;a.go("goldRecord")}else if(-3==e.type)a.go("productRated",{productId:e.relationId});else if(-4==e.type){var p=l.getUrl("ORDER_INFO"),g=$.param({orderId:e.relationId});d({method:"POST",url:p,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.success){var t=e.data.data.ordersn;a.go("orderTracking",{orderSn:t})}},function(e){})}else if(-5==e.type){var u=r.getUser().userId;a.go("refundDetail",{orderProductId:e.relationId,memberId:u})}else-6==e.type?a.go("orderManage"):-12==e.type||-11==e.type?a.go("myCouponsList"):-13==e.type||-15==e.type||-21==e.type?a.go("shopRevenue"):-14==e.type?a.go("walletDiamonds"):o.init()},o.readAll=function(){if(!r.getUser().mid)return void alert("用户id不存在");var t={};n.readAllMessage(t).success(function(t){n.unreadMessage(),e.scrollTop(),p=1,o.init()}).error(function(){alert("全部已读操作失败")})},o.$on("$ionicView.beforeEnter",function(t,i){"back"!=i.direction&&(p=1,o.init(),e.scrollTop())})}]),APP.service("MESSAGECENTERService",["$http","UrlService","$rootScope",function(e,t,o){this.msgCenter=function(o){return e.get(t.getUrl("MSG_CENTER"),o)},this.unreadMessage=function(){return e.get(t.getUrl("UNRED_MESSAGE")).success(function(e){o.unreadMessage=e.data})},this.readAllMessage=function(o){return e.get(t.getUrl("READALL"),o)},this.checkRead=function(o){return e.get(t.getUrl("CHECKREAD"),o)},this.getMessageList=function(o,i,s){var n={messageType:o,page:i,size:s};return e.get(t.getUrl("MESSAGE_CLASSIFY"),n)}}]),APP.controller("MyStoreManageController",["$scope","MyStoreManageService","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","MyStoreService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],e.levelStr="",e.userName="",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.init=function(){f.scrollTop(),e.storeId=window.localStorage.storeId,e.showQQ=!1,e.showWeChat=!1,t.mstore().success(function(t){t.success&&(e.userName=t.data,e.levelStr=e.levelArr[t.data.level],e.myStoreInfo={storeName:e.userName.storeName,qrcode:e.userName.qrCode})}),b.getMyStoreInfo("m","http://m.ehaier.com","http://www.ehaier.com/mstatic","http://m.ehaier.com/v2/mstore/sg/entrance.html",e.storeId).success(function(t){e.myStoreInfo=t.data,e.shareInfo=t.data.share,e.avatarImage=t.data.avatarImageFileId})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showShare=!1,e.myStoreInfo="",e.shareInfo={},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=t);var o=e.avatarImage,i=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?window.umeng.share(t,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",o,i,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=o);var i="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",s=e.avatarImage,n=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?(0==t?window.umeng.shareToSina(o,i,s,n,0,null,T.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,T.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,T.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()),5==t?e.copeText(n):T.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),l.fromTemplateUrl("templates/shop/FilterShop.html",{scope:e,animation:"slide-in-left",backdropClickToClose:!1}).then(function(t){e.filterModal=t}),e.openQrcode=function(){e.qrCodemodal.show()},e.backToStore=function(){e.filterModal.hide()},e.closeModal=function(){e.qrCodemodal.hide()},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.filterModal.remove()}),l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),e.saveQrCode=function(){if("undefined"!=typeof cordova){var t="";t=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var o=encodeURI(e.myStoreInfo.qrcode),i={};(new FileTransfer).download(o,t,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();u.showAlert("","图片已经保存至"+t)}else u.showToast("保存成功")},function(e){u.showToast("保存失败！")},!0,i)}}}]),APP.service("MyStoreManageService",["$http","UrlService",function(e,t){this.mstore=function(){return e.get(t.getUrl("MYSTORE"),{})}}]),APP.controller("MyIdCardAuthenController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyIdCardAuthenService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){var t={realName:e.IdCard.realName,identityNo:e.IdCard.identityNo};r.nameAuth(t).success(function(o){o.data?(e.ToMessage=o.message,s.go("myPhoneBind",t,{reload:!0})):e.ToMessage=o.message})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.isSubMint=!1,e.ToMessage="";var A=/(^\d{18}$)|(^\d{17}(\d|X|x)$)/;e.IdCardKeyup=function(){A.test(e.IdCard.identityNo)?e.isSubMint=!0:e.isSubMint=!1},e.goToPhoneBind=function(){if(e.isIdCardAuthen){if(!e.data.identity.realName)return u.showToast("请输入姓名!"),!1;var t={realName:e.data.identity.realName,identityNo:e.IdCard.identityNo};r.realNameCheck(t).success(function(e){e.data?s.go("myPhoneBind",t,{reload:!0}):u.showToast(e.message)})}else{if(!e.IdCard.realName)return u.showToast("请输入姓名!"),!1;b()}},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?(e.data=t.data,t.data.isAuth?(e.isAuth="1",e.isIdCardAuthen=!0):(e.isAuth="0",e.isIdCardAuthen=!1)):(e.isAuth="-1",e.isIdCardAuthen="",u.showToast("获取用户是否认证异常!"))})},e.$on("$ionicView.beforeEnter",function(t,o){f.scrollTop(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.ToMessage="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.FnisAuth()})}]),APP.service("MyIdCardAuthenService",["$http","UrlService",function(e,t){this.realNameAuth=function(o){return e({method:"POST",url:t.getUrl("REALNAMEAUTH"),params:o})},this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.realNameCheck=function(o){return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:o})},this.nameAuth=function(o){return e.get(t.getUrl("GET_NAMEAUTH"),o)}}]),APP.controller("MyPhoneBindController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.mobile="",e.realName="",e.identityNo="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.phone={phone:""},e.goToPhoneBindSuccess=function(){if(!e.realName)return void u.showToast("非法参数姓名！");if(!e.identityNo)return void u.showToast("非法参数证件号");if(!e.globalConstant.mobileNumberRegExp.test(e.phone.phone))return void u.showToast("非法参数手机号");var t={realName:e.realName,identityNo:e.identityNo,mobile:e.phone.phone};r.PhoneAuth(t).success(function(t){t.data?s.go("myPhoneBindNewCode",{mobile:e.phone.phone,realName:e.realName,identityNo:e.identityNo},{reload:!0}):u.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.phone.phone="",f.scrollTop(),t.realName&&t.identityNo&&(e.realName=t.realName,e.identityNo=t.identityNo)})}]),APP.service("MyPhoneBindService",["$http","UrlService",function(e,t){this.PhoneAuth=function(o){return e.get(t.getUrl("GET_PHONEAUTH"),o)}}]),APP.controller("MyPhoneBindNewCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,e.realName=t.realName,e.identityNo=t.identityNo,e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):u.showToast(t.message)})},e.goToIdCard=function(){var t={mobileNum:e.Phone,captcha:e.code.captcha,oldMobileNo:e.oldMobileNo,realName:e.realName,identityNo:e.identityNo};r.changeMobile(t).success(function(t){t.success?s.go("myPhoneBindSuccess",{phone:e.Phone},{reload:!0}):u.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2"),e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):u.showToast(t.message)})})}]),APP.controller("MyPhoneBindSuccessController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindSuccessService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.phone="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/myPhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.unload=function(){a.clearUser(),y.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),b.set("storeId",""),s.go("login")},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.phone=t.phone})}]),APP.service("MyPhoneBindSuccessService",["$http","UrlService",function(e,t){}]),APP.controller("MyPhoneCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.opacity=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,e.isAuth="-1",e.userData="",e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.opacity=!0,e.CodePhoneState=2,b()):u.showToast(t.message)})},e.goToIdCard=function(){r.checkMobile(e.code).success(function(t){if(t.success)if(1==e.isAuth){var o={
realName:e.userData.identity.realName,identityNo:e.userData.identity.identityNo};s.go("myPhoneBind",o,{reload:!0})}else 0==e.isAuth?s.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):(u.showToast("获取用户是否认证异常!"),e.FnisAuth());else u.showToast(t.message)})},e.MobileIsUnavailable=function(){1==e.isAuth?s.go("myIdCardAuthen",{isAuth:!0},{reload:!0}):0==e.isAuth?s.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):e.FnisAuth()},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?t.data.isAuth?e.isAuth="1":e.isAuth="0":e.isAuth="-1",e.userData=t.data})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.opacity=!1,e.FnisAuth(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2",e.opacity=!0),e.code={captcha:"",mobileNum:e.Phone}})}]),APP.service("MyPhoneCodeService",["$http","UrlService",function(e,t){this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.captchaMobile=function(o){var i={mobileNum:o};return e.get(t.getUrl("CAPTCHAMOBILE"),i)},this.checkMobile=function(o){return e.get(t.getUrl("CHECKMOBILE"),o)},this.changeMobile=function(o){return e({method:"POST",url:t.getUrl("CHANGEMOBILE"),params:o})}}]),APP.controller("MyPhoneManageController",["$ionicPopup","HomePageService","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneManageService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,v){o.$on("$ionicView.beforeEnter",function(){o.isUser=!1,o.isUsers=function(){t.isWdHost().success(function(t){o.isWdHost=t.data.isHost,null==t.data.o2o||1==t.data.o2o?e.show({template:"尊贵的VIP商户，请前往商户中心修改手机号。",buttons:[{text:"好的，我知道了！",onTap:function(){o.$ionicGoBack()}}]}):1==o.isWdHost?a.go("myPhoneCode"):0==o.isWdHost&&(o.isUser=!0)})},o.goUpgrade=function(){a.go("newAuthenticationHome"),o.isUser=!1},o.closePopup=function(){o.isUser=!1},v.scrollTop(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.isIosApp=!0:o.isIosApp=!1,o.GoBackImgUrl=s.imgBaseURL+"img/addressBack@2x.png",o.ResultImgUrl=s.imgBaseURL+"img/PhoneManage@2x.png",o.storeId=window.localStorage.storeId,o.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),o.Phone=o.USER_CACHE_KEY.mobile})}]),APP.service("MyPhoneManageService",["$http","UrlService",function(e,t){}]),APP.controller("ShopAddressController",["$scope","$stateParams","$rootScope","ShopAddressServicee","PopupService","$timeout",function(e,t,o,i,s,n){e.provinceId="",e.cityId="",e.regionId="",e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.textALL="",e.panGoOn=!1,e.address={value:t.default},e.detailAddress={value:t.defaultDetail},e.updateResult=!0,e.updateContent="";var a=t.hrCode,r=t.memberType;e.init=function(){a=t.hrCode;t.memberType;0==e.panGoOn&&(e.address={value:t.default},e.provinceId=t.provinceId,e.cityId=t.cityId,e.regionId=t.regionId),e.detailAddress={value:t.defaultDetail},e.panGoOn=!1},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.address.value&&e.detailAddress.value?e.detailAddress.value.length>50||e.detailAddress.value.length<2?void s.showToast("你输入的地址字符长度应在2-50之间"):void i.doInit(e.address.value,e.detailAddress.value,e.provinceId,e.cityId,e.regionId,a,r).success(function(t,i,s,n){1==t.success?(o.$broadcast("SHOP_ADDRESS",e.address.value),o.$broadcast("SHOP_DETAILADDRESS",e.detailAddress.value),e.$ionicGoBack()):e.showResult("修改失败")}):void s.showToast("您输入的地址不能为空")},o.$on("SHOPADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.provinceId=o["value-1"],e.cityId=o["value-2"],e.regionId=o["value-3"],e.textALL=e.textOne+e.textTwo+e.textThree+e.textFour,e.address={value:e.textALL}}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopAddressServicee",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n,a,r,c){var l={};if("人人服务（服务兵创业）"==c)var l={provinceId:s,cityId:n,regionId:a,regionName:o,address:i,hrCode:r,memberType:10};else var l={provinceId:s,cityId:n,regionId:a,regionName:o,address:i};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:l})}}]),APP.controller("ShopLegendController",["$scope","$stateParams","ShopLegendService","$rootScope","PopupService",function(e,t,o,i,s){e.selectText=t.default;var n=t.provinceId,a=t.cityId,r=t.regionId;e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.goToLegend=!1,e.isHaierCloud=!1,e.init=function(){e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.showAlert=!1,e.showAlertCheck=!1,"海尔云店"!=e.selectText&&(e.isHaierCloud=!1)},e.doChange=function(){e.showAlert=!1,e.showAlertCheck=!1;var t=/^(?!HR|hr|Hr|hr).*$/;if("人人服务（服务兵创业）"==e.selectText&&(e.valueUnion=10,t.exec(e.hrCode.value)||e.hrCode.value.length>20||e.hrCode.value.length<8))return void(e.showAlert=!0);e.hrCodeOld==e.hrCode.value?o.doInit(e.valueUnion,n,a,r,e.hrCode.value).success(function(t,o,n,a){1==t.success?(i.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?s.showToast(t.message):s.showToast("未知异常")}):o.check(e.hrCode.value).success(function(t,c,l,d){t?o.doInit(e.valueUnion,n,a,r,e.hrCode.value).success(function(t,o,n,a){1==t.success?(i.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?s.showToast(t.message):s.showToast("未知异常")}):e.showAlertCheck=!0})},i.$on("SHOP_SELECT_UNION",function(t,o){e.goToLegend=!0,e.textUnion=o.text,e.valueUnion=o.value,e.selectText=e.textUnion,"海尔云店"==e.selectText&&(e.isHaierCloud=!0)}),e.$on("$ionicView.beforeEnter",function(o,i){"forward"==i.direction&&(e.selectText=t.default),e.init()})}]),APP.service("ShopLegendService",["$http","UrlService",function(e,t){this.check=function(o){var i={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),i)},this.doInit=function(o,i,s,n,a){var r={memberType:o,provinceId:i,cityId:s,regionId:n,hrCode:a};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:r})}}]),APP.controller("ShopMessageController",["$scope","ShopMessageService","$rootScope","PopupService",function(e,t,o,i){e.shopMessageID="",e.shopMessageName="",e.shopMessageAddress="",e.shopMessageDetailAddress="",e.shopMessageLegend="",e.provinceId="",e.cityId="",e.regionId="",e.isHaierCloud="",e.hrCode="",e.init=function(){e.isHaierCloud=!1,t.getShopMessage().success(function(t,o,s,n){t.success?(e.shopMessageID=t.data.storeInfo.memberId,e.shopMessageName=t.data.storeInfo.storeName,e.shopMessageAddress=t.data.storeInfo.regionName,e.shopMessageDetailAddress=t.data.storeInfo.address,e.shopMessageLegend=t.data.storeInfo.memberName,e.provinceId=t.data.storeInfo.provinceId,e.cityId=t.data.storeInfo.cityId,e.regionId=t.data.storeInfo.regionId,e.hrCode=t.data.storeInfo.hrCode,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!0)):i.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),o.$on("SHOP_NAME",function(t,o){e.shopMessageName=o}),o.$on("SHOP_LEGEND",function(t,o){e.shopMessageLegend=o,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!1)}),o.$on("SHOP_ADDRESS",function(t,o){e.shopMessageAddress=o}),o.$on("SHOP_DETAILADDRESS",function(t,o){e.shopMessageDetailAddress=o})}]),APP.service("ShopMessageService",["$http","UrlService",function(e,t){this.getShopMessage=function(){return e.get(t.getUrl("SHOPINFO_INIT"))}}]),APP.controller("ShopNameController",["$scope","$stateParams","$rootScope","ShopNameService","PopupService","$timeout",function(e,t,o,i,s,n){e.name={value:t.default},e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.default}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.name.value?/[\ud800-\udbff][\udc00-\udfff]/g.test(e.name.value)?void s.showToast("亲，不可以使用表情喔!"):void i.checkName(e.name.value).success(function(t,o,n,a){t.data?i.changeName(e.name.value).success(function(t,o,i,s){t.success&&e.$ionicGoBack()}):s.showToast("您的名称中含有敏感词,请重新输入")}):void s.showToast("您输入的店铺名称不能为空")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopNameService",["$http","UrlService",function(e,t){this.checkName=function(o){var i={checkword:o};return e.get(t.getUrl("CHECKSHOPNAME_INIT"),i)},this.changeName=function(o){var i={wdName:o};return e.get(t.getUrl("CHANGESHOPNAME_INIT"),i)}}]),APP.controller("storeTeamOwnerController",["$http","$scope","$cacheFactory","storeTeamOwnerService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w){function y(e,o){i.storeInfo({visitType:e,daysType:o}).success(function(e){1==e.success&&(t.storeVisitInfo=e.data.storeVisitInfo,t.commonVisitList=e.data.commonVisitList)})}function T(e){var t=[];for(var o in e)t.push([e[o],o]);t.reverse();for(var i=t.length,e=[],o=0;o<i;o++)e.push({date:t[o][1],act:t[o][0]});return e}t.navtabs=[{title:"店铺数据"},{title:"团队数据"},{title:"个人数据"}],t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.setStorage=function(e,o,s,n,r,c){t.userinfo={img:e,name:o,time:s,where:n},i.visitorInfo=t.userinfo,i.getVisitorBrowHis(r,c).success(function(e){if(e.success){if(t.visiProductList=e.data,0==t.visiProductList.length)return!1;a.go("VisitorBrowHistory",{userId:r,daysType:c})}})},t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,t.partnerTitle="partner",t.teamTitle="team",t.switchType=function(e){t.typeState[e]||(t.typeState=[!1,!1,!1],t.typeState[e]=!0),0==e?(t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,y(t.visitType,t.daysType)):1==e?(t.storeActived=!1,t.teamActived=!0,t.ownerActived=!1,i.teamInfo().success(function(e){1==e.success&&(t.teamDetail=e.data)})):2==e&&(t.storeActived=!1,t.teamActived=!1,t.ownerActived=!0,i.ownerInfo().success(function(e){if(1==e.success){t.ownerDetail=e.data,t.ownerMonthReport=e.data.storeMemberMonthReport,t.ownerteamLevel=e.data.teamLevel,t.items=e.data.map;var o=T(e.data.map);t.lists=o}}),i.ownerCommi().success(function(e){1==e.success&&(t.predictCommi=e.data.newBrokerageAmount,t.totalCommi=e.data.totalBrokerageAmount)})),m.scrollTop()},t.dayType=function(e){t.dayState[e]||(t.dayState=[!1,!1],t.dayState[e]=!0),0==e?(t.rankText="7天访客排行榜",t.daysType="WEEK",y(t.visitType,t.daysType)):1==e&&(t.rankText="30天访客排行榜",t.daysType="MONTH",y(t.visitType,t.daysType))},t.$on("$ionicView.beforeEnter",function(e,o){if("back"==o.direction)return void w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1});t.userMemberId=$.userMemberId,t.typeState=[!0,!1,!1],t.dayState=[!0,!1],t.rankText="7天访客排行榜",t.daysType="WEEK",t.visitType="STORE",t.init()}),t.days=[{text:"最近7天"},{text:"最近30天"}],t.items={},t.openHis=function(){var e=d.show({template:"\n          <div class='his-box' scrollbar-y=\"false\">\n            <h3>历史团队活跃度</h3>\n            <h5>最近12个月</h5>\n            <div class='his-nav' flex='main:justify cross:center'>\n              <div>年/月</div>\n              <div>活跃度</div>\n            </div>\n            <div class='his-list'>\n              <div class='his-item' ng-repeat='list in lists' flex='main:justify cross:center'>\n                <div class='his-month'>{{list.date}}</div>\n                <div class='his-act'>{{list.act}}%</div>\n              </div>\n            </div>\n            <div class='his-close'>\n              <div class=\"close-img\" ng-click='closeHis()'>\n                <img ng-src=\"{{imgBaseURL}}img/hisClose@2x.png\" alt=\"关闭\" />\n              </div>\n              <span class='close-bor'></span>\n            </div>\n          </div>\n        ",scope:t});t.closeHis=function(){e.close()}},t.goBack=function(){t.$ionicGoBack()};l.getUser();t.init=function(){y(t.visitType,t.daysType),t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.PercentageCal=function(e,t){var o=parseFloat(e),i=parseFloat(t);return i>o?isNaN(o)||isNaN(i)?"-":i<=0?"0%":Math.round(o/i*1e4)/100+"%":"100%"}}]),APP.service("storeTeamOwnerService",["$http","UrlService",function(e,t){this.storeInfo=function(o){var i=t.getUrl("GET_STORE_DATA");return e.get(i,o)},this.teamInfo=function(o){var i=t.getUrl("GET_TEAM_DATA");return e.get(i,o)},this.ownerInfo=function(o){var i=t.getUrl("GET_OWNER_DATA");return e.get(i,o)},this.ownerCommi=function(o){var i=t.getUrl("REPORT_DETAIL_PLUS");return e.get(i,o)},this.visitorInfo="",this.getVisitorBrowHis=function(o,i){var s={userId:o,daysType:i};return e.get(t.getUrl("GET_VISI_BROW_HIS"),s)}}]),APP.controller("teamProductMsgController",["storeTeamOwnerService","$http","$scope","teamProductMsgService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(){var e=document.getElementById("shopRevenueChart"),t=echarts.init(e);T=t;var i=null;(i={title:{text:A,left:"30%",top:"2%",textStyle:{fontWeight:"normal",fontSize:14,color:"#172434",letterSpacing:0,lineHeight:14}},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"none"}},xAxis:{type:"category",boundaryGap:!1,data:o.statisticDays,axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}},yAxis:[{type:"value",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbolSize:8,areaStyle:{normal:{color:"#cee9f6"}},lineStyle:{color:"#37bfff"},itemStyle:{normal:{color:"#37bfff"}},data:o.data}]})&&"object"==typeof i&&(t.setOption(i,!0),t.setOption(i))}function w(e,t){return 1==e?void(b=t.storeUv):2==e?void(b=t.storePv):3==e?void(b=t.productUv):4==e?void(b=t.productPv):5==e?void(b=t.shareUv):6==e?void(b=t.sharePv):void 0}function y(e,t,i,s){for(var n=0;n<e.length;n++)o.statisticDays.push(e[n].statisticDays),1==i?o.data.push(e[n].storeUv):2==i?o.data.push(e[n].storePv):3==i?o.data.push(e[n].productUv):4==i?o.data.push(e[n].productPv):5==i?o.data.push(e[n].shareUv):6==i&&o.data.push(e[n].sharePv);"WEEK"==t?(w(i,s),C=7,A="最近"+C+"天: "+b+o.titleText):(w(i,s),C=30,A="最近"+C+"天: "+b+o.titleText)}o.data=[],o.statisticDays=[];var T="",C="",b="",A="";o.titleList=["访客数","浏览次数","商品访客数","商品浏览量","分享访问人数","分享访问次数"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.commonFun=function(e,t){i.storeInfo(e,t).success(function(e){e.success&&(o.commonVisitList=e.data.commonVisitList,o.daysType=7==e.data.commonVisitDetail.statisticDays?"WEEK":"MONTH",o.commonVisitDetail=e.data.commonVisitDetail,o.myInComeOut=e.data.commonVisitTendencyList,o.storeVisitInfo=e.data.storeVisitInfo,1==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):2==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):3==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):4==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):5==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):6==o.num&&(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()))})},o.init=function(){1!=o.num&&2!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?3!=o.num&&4!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?5!=o.num&&6!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days||(o.share="SHARE",o.commonFun(o.share,o.days)):(o.product="PRODUCT",o.commonFun(o.product,o.days)):(o.store="STORE",o.commonFun(o.store,o.days)),1==o.num||3==o.num||5==o.num?(o.personNum=!0,o.titleText="人"):2!=o.num&&4!=o.num&&6!=o.num||(o.titleText="次")},o.setStorage=function(t,i,s,n,r,c,l){if(3!=t&&4!=t)return!1;o.userinfo={img:i,name:s,time:n,where:r},e.visitorInfo=o.userinfo,e.getVisitorBrowHis(c,l).success(function(e){if(e.success){if(o.visiProductList=e.data,0==o.visiProductList.length)return!1;a.go("VisitorBrowHistory",{userId:c,daysType:l})}})},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){C="",b="",A="",o.num=s.num,o.days=s.type,o.data=[],o.statisticDays=[],o.fsfsafa=!0,o.init()}),o.$on("$ionicView.beforeLeave",function(){T&&T.dispose(),o.fsfsafa=!1})}]),APP.service("teamProductMsgService",["$http","UrlService",function(e,t){this.storeInfo=function(o,i){var s={visitType:o,daysType:i};return e.get(t.getUrl("STORE_PRODUCT"),s)}}]),APP.controller("TeamController",["$ionicHistory","$scope","TeamService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.history=[],t.hShow=!0,t.hShowB=!0;localStorage.getItem("historys");t.arrowState=[u.imgBaseURL+"img/Group@2x.png",u.imgBaseURL+"img/Group1@2x.png",u.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["openTime","openTimeDesc"],"authDesc","leaderDesc"],t.isShowUp=!1,t.isIos=!1,t.screenWidth=window.screen.width,t.front=l.front,t.shareStoreId=l.shareStoreId,t.isBuyer=g.getRole(),t.userId=a.getUser().mid;var v="",S="0";t.brand=!1,t.brandName="全部",t.brandList=[],t.filterParameterArr=["hasStock","all","0"],t.StockStateArr=["all","hasStock"],t.filterParams="",-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.screenWidth<375?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:t.screenWidth<414?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},t.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},t.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),t.clearLocal=function(){localStorage.removeItem("historys"),t.hShow=!1,t.hShowB=!0},t.$on("$ionicView.beforeEnter",function(e,o){m.scrollTop(),t.isBuyer=g.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.topStyle={top:"64px"}:t.topStyle={top:"44px"},t.showTab=!1,t.filterParams="",t.lianXC=!1,t.storeId=d.get("storeId",u.globalConstant.storeId),t.isBuyer=g.getRole(),t.userId=a.getUser().mid,"back"==o.direction?(t.hShow=!1,t.hotWordShow=!1,t.hShowB=!1):(localStorage.getItem("historys")?(t.hShow=!0,t.hShowB=!1):(t.hShow=!1,t.hShowB=!0),t.tabNav="selection",t.hasmore=!1,t.typeChoose="商品",S="0",t.gsPlaceholder="请搜索名字、型号等关键字",t.searchData=null,t.page=2,t.front=l.front,v=l.shareStoreId?l.shareStoreId:a.getUser().mid,t.searchGoodsName={name:""})}),t.loadMore=function(){0==t.front?o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,2,t.filterParams,!0).success(function(e,o,i,s){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}):1==t.front&&o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1,t.filterParams,!0).success(function(e,o,i,s){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)})},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e)){if(m.scrollTop(),t.page=2,0==e){t.chooseIndex=e;var i=1==t.openStoreTime_index?0:1;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.filterParams=tabState[1][i],t.searchData=[]}else 1==e?(t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.searchData=[]):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.filterParams="saleDesc",t.searchData=[]);o.myStoreSearch("1","5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,i,s){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})}},t.closeComprehensiveSub=function(){t.showComprehensiveSub=!t.showComprehensiveSub},t.selectComprehensiveSub=function(e,i){i.stopPropagation(),0==e&&(t.filterParams="isHotDesc"),t.lianXC=!1,t.selectComprehensiveSubIndex=e,t.showComprehensiveSub=!t.showComprehensiveSub,t.chooseIndex=0,t.productList=[],t.comprehensive_index=1,t.commission_index=0,t.price_index=0,t.filter_index=0,o.myStoreSearch("1","5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,i,s){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0,t.comprehensive_index=1,t.chooseIndex=0,t.showComprehensiveSub=!1):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})},t.chooseStockState=function(e){t.filterParameterArr[0]=t.StockStateArr[e]},t.$on("$destroy",function(){t.filterModal.remove()})}]),APP.service("TeamService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,i,s,n,a,r,c,l,d,u){var p={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:u};return e.get(t.getUrl("SEARCHGOODS_INIT"),p)},this.myStoreSearch=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)}}]),APP.controller("ApplyForWhiteController",["$scope","InAppBrowserService","UrlService","$rootScope","InAppBrowserService","ManageMoneyService","WhiteShowsService","UserService",function(e,t,o,i,t,s,n,a){e.toHelp=function(e,i){-1!=navigator.userAgent.indexOf("iPhone")?t.open(o.getHead()+"mstore/sg/helpDetail.html?id="+e,i):$state.go("helpDetail",{helpId:e,content:i})},e.goBack=function(){e.$ionicGoBack()},e.applyToWihte=function(){n.applyForOpen({backUrl:window.location.href,userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(e){e.success&&n.openApplyWhiteShows(e.data.redirectUrl,"http://m.ehaier.com/#/applyForWhite")})}}]),APP.service("WhiteShowsService",["InAppBrowserService","UrlService","$http",function(e,t,o){this.applyForOpen=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_APPLY"),params:e})},this.queryAvaliAmt=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_QUERY_AVALIAMT"),params:e})},this.payApply=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_PAY"),params:e})},this.queryIousStatus=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_QUERY_STATUS"),params:e})},this.cost=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_COST"),params:e})},this.openApplyWhiteShows=function(e,t){window.cordova?window.emc.presentH5View(e,"顺逛白条"):window.location.href=e}}]),APP.controller("MyWalletController",["$scope","$state","MyWalletService","InAppBrowserService","UrlService","UserService","WhiteShowsService",function(e,t,o,i,s,n,a){function r(){o.getWallet().success(function(t){t.success&&(e.walletInfo=t.data)}).error(function(e){alert("网速较慢，请稍候再试")}),a.queryIousStatus({userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(t){t.success&&(e.whiteShowsState=t.data.applyStatus,1==e.whiteShowsState&&a.queryAvaliAmt({token:n.getUser().accessToken}).success(function(t){t.success&&(e.crdComAmt=t.data.crdComAmt,e.crdComAvailAmt=t.data.crdComAvailAmt)}).error(function(e){alert("网速较慢，请稍候再试")}))}).error(function(e){alert("网速较慢，请稍候再试")})}e.walletInfo=[],e.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,o):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(e,t){r()}),e.toApplyForWhite=function(e){2!=e?a.applyForOpen({backUrl:window.location.href,userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(e){e.success&&a.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):t.go("applyForWhite")}}]),APP.service("MyWalletService",["$http","UrlService",function(e,t){this.getWallet=function(){return e.get(t.getUrl("GET_WALLET"))}}]),APP.controller("walletDiamCtrl",["$scope","$state","$ionicHistory","$interval","walletDiamService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,i,s,n,a,r,c,l,d){e.index=null,e.diamgetlist=[],e.pagenum1=1,e.hasmore=!1,e.usableDiamond="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){n.scrollTop(),d.getWallet().success(function(t){e.usableDiamond=t.data.usableDiamond}).error(function(){}),e.pagenum1=1,e.hasmore=!0,s.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.diamgetlist=t.data.paymentList})},e.changelist=function(t){e.diamgetlist=[],n.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,s.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.diamgetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,s.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.diamgetlist=e.diamgetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.diamgetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletDiamService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,i,s){var n={memberId:o,benefitType:"diamond",transType:s,pageNo:i,pageSize:10},a={memberId:o,benefitType:"diamond",pageNo:i,pageSize:10};return null==s?e.get(t.getUrl("GET_WALLETDETAIL"),a):e.get(t.getUrl("GET_WALLETDETAIL"),n)}}]),APP.controller("walletIntCtrl",["$scope","$state","$ionicHistory","$interval","walletIntService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,i,s,n,a,r,c,l,d){e.index=null,e.integetlist=[],e.pagenum1=1,e.hasmore=!1,e.seashellPoint="",e.seashellPointAmt="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){n.scrollTop(),d.getWallet().success(function(t){e.seashellPoint=t.data.seashellPoint,e.seashellPointAmt=t.data.seashellPointAmt}).error(function(){}),e.pagenum1=1,e.hasmore=!0,s.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.integetlist=t.data.paymentList})},e.changelist=function(t){e.integetlist=[],n.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,s.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.integetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,s.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.integetlist=e.integetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.integetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletIntService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,i,s){var n={memberId:o,benefitType:"seashell",transType:s,pageNo:i,pageSize:10},a={memberId:o,benefitType:"seashell",pageNo:i,pageSize:10};return null==s?e.get(t.getUrl("GET_WALLETDETAIL"),a):e.get(t.getUrl("GET_WALLETDETAIL"),n)}}]),APP.controller("monthRewardController",["$scope","$stateParams","HelpDetailService","UrlService","PlatformService","monthRewardService",function(e,t,o,i,s,n){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.monthList=[];e.init=function(){n.getRevenueList(e.earningType,e.type,"Y",0,10).success(function(t){e.monthList=t.data.rewardY})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("monthRewardService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a){var r={earningType:o,type:i,rewardType:s,page:n,pageSize:a};return e.get(t.getUrl("REVENUE_LIST"),r)}}]),APP.controller("otherRewardController",["$scope","$stateParams","UrlService","PlatformService","monthRewardService",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.total=0,e.otherList=[];e.init=function(){s.getRevenueList(e.earningType,e.type,"OTHER",0,10).success(function(t){e.total=t.data.rewardO.expectOtherAmount,e.otherList=t.data.rewardOther})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("someRewardController",["$scope","$stateParams","UrlService","$ionicPopup","monthRewardService",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardType=t.rewardType,e.someList=[],e.someDetail={};var n,a;e.init=function(){a="reward"+e.rewardType,s.getRevenueList(e.earningType,e.type,e.rewardType,0,10).success(function(t){t.data[a]instanceof Array?e.someList=t.data[a]:(e.someList=[],e.someList.push(t.data[a]))})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.lookReward=function(t){e.someDetail=t,n=i.show({cssClass:"xvv-popupSome",template:'<div class="xvv-some"><div>抵扣金额</div><p class="radiubox"><i></i><span></span><span></span></p><div class="xvv-overflow"><div class="xvv-det" ng-repeat="item in someDetail.sgDeductionDetails"><div><p>此单抵扣<span>{{item.deductibleAmount|currency:"&yen"}}</span></p><p>抵扣单号<span>{{item.reverseNetSn}}</span></p><p>抵扣类型<span>{{item.deductibleType}}<span></p></div></div></div><div ng-click="closesome()">确定</div></div>',scope:e})},e.closesome=function(){n.close()},e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("yongjinDetailController",["$scope","$stateParams","UrlService","yongjinDetailService","$ionicPopup",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardStart=t.start,e.rewardEnd=t.end,e.hasMoreData=!1,e.tanKdetail={};var n,a,r=0;e.loadData=function(t,o,s,n,a,r,c){i.getRevenueList(t,o,s,n,a,r,c).success(function(t){t.data.list?(e.revenueList=0==n?t.data.list:e.revenueList.concat(t.data.list),e.hasMoreData=t.data.list.length==a,e.$broadcast("scroll.infiniteScrollComplete")):e.hasMoreData=!1})},e.loadMore=function(){r+=1,e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.lookDetail=function(t){e.tanKdetail=t,1==e.type?n=s.show({cssClass:"xvv-popup",
template:'<div class="xvv-yongjin"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><p>类型</p><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p></div><div><p>{{tanKdetail.rewardTypeStr}}</p><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div ng-click="closeDetail()">确定</div></div>',scope:e}):a=s.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin2"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><div style="width:3.68rem;"><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">抵扣金额</p></div><div><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">{{tanKdetail.deductionAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div class="xvv-yongjinother" ng-repeat="i in tanKdetail.sgDeductionDetails"><div style="color:#7A87A3"><p>抵扣单号<span>{{i.reverseNetSn}}</span></p><p>抵扣类型<span>{{i.deductibleType}}</span></p><p>此单抵扣<span>{{i.deductibleAmount|currency:"&yen"}}</span></p></div></div></div><div ng-click="closeDetail()">确定</div></div>',scope:e})},e.closeDetail=function(){1==e.type?n.close():a.close()},e.init=function(){e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("yongjinDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a,r,c){var l={earningType:o,type:i,rewardType:s,page:n,pageSize:a,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]);=======
pcrName:c,memberId:l,streetId:d};return e.get(t.getUrl("PAY_CHECK_STOCK"),u)},this.getSgStoreAttribute=function(o,i,s){var n={productId:o,storeId:i,sku:s};return e.get(t.getUrl("GET_GETSGSTOREATTRIBUTE"),n)},this.getDetailAttribute=function(o,i,s,n){var a={productId:o,storeId:i,attrValueIds:s,attrIds:n};return e.get(t.getUrl("GET_GETDETAILATTRIBUTE"),a)},this.getIsShowAttr=function(o,i){var s={productId:o,storeId:i};return e.get(t.getUrl("GET_ISSHOWATTR"),s)},this.getCartNum=function(){return e.get(t.getUrl("GET_CARTNUM"))}}]),APP.controller("productEffectController",["$scope","$stateParams","$sce",function(e,t,o){e.vrUrl=o.trustAsResourceUrl(t.vrUrl)}]),APP.controller("ProductRatedController",["$scope","$stateParams","$rootScope","ProductRatedService","$ionicPopup","$timeout","$ionicScrollDelegate","$state","UserService","UrlService",function(e,t,o,i,s,n,a,r,c,l){function d(t){i.loadData(e.productId,e.pageIndex,e.pageSize,e.assessLevel,t).success(function(t,o,i,s){if(null!=t.data&&0!=t.data.length||1!=e.pageIndex){e.isHasData=!0,e.assessList=e.assessList.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete"),e.hasMore=5==t.data.length;for(var n=0;n<e.assessList.length;n++)if(null!=e.assessList[n].experienceTime){var a=e.assessList[n].experienceTime,r=e.assessList[n].createTime,c=(a-r)/1e3,l=parseInt(c/86400);e.assessList[n].dayTime=l>0?l:0}else e.assessList[n].dayTime=0}else e.isHasData=!1})}e.allComment=!0,e.goodComment=!1,e.neutralComment=!1,e.negativeComment=!1,e.havePicComment=!1,e.productId=t.productId,e.assessLevel="all",e.hasPic="",e.pageSize=5,e.pageIndex=1,e.assessList=[],e.assessListDay=[],e.isHasData=!0,e.hasMore=!1,e.productRatedSub={top:"43px"},e.productRatedContent={top:"128px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.productRatedSub={top:"63px"},e.productRatedContent={top:"148px"}),e.isCheckStyle={color:"#fff",background:"#fd4f00"},e.noCheckStyle={color:"#000",background:"#fdebeb"},e.initData=function(){i.getData(e.productId).success(function(t,o,i,s){e.assessData=t.data}),i.getTabData(e.productId).success(function(t,o,i,s){e.markData=t.data}),e.pageIndex=1,e.assessList=[],d(!1)},e.loadMore=function(){e.pageIndex=e.pageIndex+1,d(!0)},e.goBack=function(){e.$ionicGoBack()},e.clickCommentType=function(t){a.scrollTop(),e.allComment="all"==t,e.goodComment="praise"==t,e.neutralComment="neutral"==t,e.negativeComment="poor"==t,e.havePicComment="image"==t,e.assessLevel=t,e.hasPic="",e.pageIndex=1,e.assessList=[],d(!1)},e.showLarge=function(t){e.showBigImage=!0,e.largeImg=t},e.closeImg=function(){e.showBigImage=!1},e.$on("$ionicView.beforeEnter",function(){a.scrollTop(),e.isHasData=!0,e.initData()})}]),APP.service("ProductRatedService",["$http","UrlService",function(e,t){this.getData=function(o){var i={productId:o};return e.get(t.getUrl("PRODUCT_RATED_TOASSESS_LIST"),i)},this.getTabData=function(o){var i={productId:o};return e.get(t.getUrl("PRODUCT_ASSESS_MARK"),i)},this.loadData=function(o,i,s,n,a){var r={productId:o,pageIndex:i,pageSize:s,commentType:n,noLoading:a};return e.get(t.getUrl("PRODUCT_RATED_ASSESS_LIST"),r)}}]),APP.controller("SeeMoreController",["$sce","HomePageService","PopupService","$ionicPopup","UrlService","$q","$rootScope","CommonAddressService","AreaService","InAppBrowserService","CreditService","ShopService","$scope","$timeout","UserService","$state","SeeMoreService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(){var e=n.defer();return ionic.Platform.isAndroid()&&window.cordova?cordova.plugins.amap4location&&cordova.plugins.amap4location.location(function(t){a.globalConstant.lat=t.latitude,a.globalConstant.lon=t.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),a.globalConstant.positionStatus=!0},function(e){"12"==e.errorCode&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),a.globalConstant.positionStatus=!1}):c.init().then(function(t){a.globalConstant.lat=t.coords.latitude,a.globalConstant.lon=t.coords.longitude,c.getLocalArea().then(function(t){e.resolve(t.regeocode.addressComponent.adcode)}),r.addAddressInfo(),a.globalConstant.positionStatus=!0},function(e){"1"==e.code&&i.alert({title:"",cssClass:"location-popup",okText:"知道了",template:'<div style="color: #000;font-size: 14px;font-weight: bold;">此功能需获取您的位置信息</div><div style="color: #000;font-size: 12px;">请打开“定位服务”允许“顺逛”获取你的位置信息</div>'}),r.addAddressInfo(),a.globalConstant.positionStatus=!1}),e.promise}p.toHomeking=function(){h.homeking().success(function(e){if(-100!=e.data){var t=encodeURI(e.data);window.cordova?window.emc.presentH5View(t,"好慷在家"):window.location.href=t}else f.go("login")})},p.goToEmc=function(){p.isApp?t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):t.token_get().success(function(e){var t=e.data;t?window.emc.presentEmcView(s.getEnviroment(),t,""):o.showToast("您当前账号暂无法访问此服务,请使用关联手机号登录。")})}):o.showToast("请去顺逛App查看此服务")},p.openCC=function(e,i){switch(e){case 1:t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):v().then(function(e){var t=s.getCPUrl("SZD_URL"),o=t+"?token="+m.getUser().token+"&alt="+a.globalConstant.lat+"&lng="+a.globalConstant.lon+"&cityCode="+e;window.cordova?window.emc.presentH5View(o,"水之道"):window.open(o,"_blank","location=yes")})});break;case 2:window.cordova?window.emc.presentH5View(i,"游戏头条"):window.open(i,"_blank","location=yes");break;case 3:t.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else{var t="http://m.ehaier.com/v3/mstore/sg/diy/login/request.html?flag="+$localstorage.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=t);window.emc.presentH5View(t,"海尔交互定制平台")}});break;case 4:t.isWdHost().success(function(e){if(a.isWdHost=e.data.isHost,-1==e.data.isHost)f.go("login");else if(window.cordova){var t=m.getUser().accessToken;window.emc.presentWashView(a.userAccount,a.password,t)}else o.showToast("请去顺逛App查看此服务")});break;case 5:;window.open("http://m.ehaier.com/mobile/heater/index.html","_blank","location=yes");break;case 6:var n="http://uhome.haier.net:8470/acbizCms/aircircle/indexAirCircle.do";window.cordova?window.emc.presentH5View(n,"好空气"):window.open(n,"_blank","location=yes");break;case 7:var r="http://linkcook.cn/quanquan/ulist.html";window.cordova?window.emc.presentH5View(r,"馨小厨"):window.open(r,"_blank","location=yes");break;case 8:var c="http://jiuzhidao.com/wap/";window.cordova?window.emc.presentH5View(c,"酒知道"):window.open(c,"_blank","location=yes");break;case 9:var l="http://b2b.haier.com/mobiles/index.html";window.cordova?window.emc.presentH5View(l,"海尔企业购"):window.open(l,"_blank","location=yes");break;case 10:var d="http://www.saywash.com/saywash/WashCallWx/page/index.html";window.cordova?window.emc.presentH5View(d,"社区洗"):window.open(d,"_blank","location=yes")}},p.$on("$ionicView.beforeEnter",function(){window.cordova?p.isApp=!0:p.isApp=!1}),p.goToApplyForCard=function(){t.isWdHost().success(function(e){a.isWdHost=e.data.isHost,-1==e.data.isHost?f.go("login"):f.go("applyForCard")})}}]),APP.service("SeeMoreService",["$http","UrlService",function(e,t){this.personalInit=function(){return e.get(t.getNewUrl("PERSONAL_CENTER"))},this.homeking=function(){return e.get(t.getNewUrl("GET_homeking"))}}]),APP.controller("superMarketController",["$ionicHistory","BannerThemeService","$ionicScrollDelegate","$ionicSlideBoxDelegate","GoodsService","$q","HomePageService","CalculateStrLength","superMarketService","$interval","$http","$scope","$stateParams","$state","UserService","$timeout","$rootScope","PopupService","ShopService",function($ionicHistory,BannerThemeService,$ionicScrollDelegate,$ionicSlideBoxDelegate,GoodsService,$q,HomePageService,CalculateStrLength,superMarketService,$interval,$http,$scope,$stateParams,$state,UserService,$timeout,$rootScope,PopupService,ShopService){function getAddress(){var deferred=$q.defer();return GoodsService.getAddress().success(function(res){var obj=eval(res.data),regionIndex=obj[0].regionName.indexOf("/");$scope.region=obj[0].regionName.substr(0,regionIndex),deferred.resolve(obj[0])}),deferred.promise}function getFurnishAllData(e){getAddress().then(function(t){$scope.provinceId=t.provinceId,$scope.cityId=t.cityId,$scope.areaId=t.areaId,$scope.streetId=t.streetId,superMarketService.getFurnishTop(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishTop=[],$scope.furnishTop=e.data.topRecommendProducts}),superMarketService.getFurnishBottom(e,$scope.provinceId,$scope.cityId,$scope.areaId,$scope.streetId).success(function(e){$scope.furnishBottom=[],$scope.furnishBottom=e.data})})}function GetSwitchChecked(){$scope.memberId=UserService.getUser().mid;for(var e=JSON.parse(localStorage.getItem("setSwitch")),t=e.length-1;t>=0;t--)e[t].id==$scope.memberId&&($scope.settingsList=e[t].list,!0)}$scope.furnishType=["食品","母婴","运动户外","数码/电脑办公","医药保健","汽配","腕表"," "],$scope.furnishTypeId=[3275,3159,3323,2739,3353,3369,3225],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?$scope.isIosApp=!0:$scope.isIosApp=!1,$scope.iosAppTop={top:"64px"},$scope.normalTop={top:"44px"},$scope.dealPrice=CalculateStrLength.dealPrice,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",$scope.chooseType=function(e,t){-1!=e&&(getFurnishAllData($scope.supermarketCates[e].id),$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq("+e+")").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").animate({width:t.target.offsetWidth+"px",left:t.target.offsetLeft,color:"#2979FF"},{duration:300,easing:"easeOutCubic"}))},$scope.iosHead={height:"64px","padding-top":"20px"},$scope.otherHead={height:"44px","padding-top":"0px"},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case-1:BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case 0:$state.go("bannerTheme",{bannerId:o});break;case"1":var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case"2":if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.goProductDetail=function(e){$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:e,storeId:$scope.storeId})},$scope.goBranchType=function(e){$state.go("branchTypeDetail",{productCateId:"productCateId="+e})},$scope.init=function(){$ionicScrollDelegate.scrollTop(),superMarketService.getSupermarketCates().success(function(e){$scope.supermarketCates=e.data,getFurnishAllData($scope.supermarketCates[0].id)}),superMarketService.getBanner().success(function(e){$scope.bannerList=e.data,$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.$getByHandle("superMarket_slider").loop(!0)}),HomePageService.isWdHost().success(function(e){$scope.isWdHost=e.data.isHost}),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.goBack=ionic.Utils.debounce(function(){$ionicHistory.goBack()},300),$scope.$on("$ionicView.beforeLeave",function(e,t){}),$scope.$on("$ionicView.enter",function(e,t){if("back"!=$scope.direction){$ionicScrollDelegate.scrollTop();var o=$("div.superMarket_xScroll div").eq(0).width(),i=$("div.superMarket_xScroll div:eq(0)")[0].offsetLeft;$("div.superMarket_xScroll div:not(:last)").css("color","#000000"),$("div.superMarket_xScroll div:eq(0)").css("color","#2979FF"),$("div.superMarket_xScroll div.runningBox").css({width:o,left:i})}}),$scope.settingsList="",$scope.$on("$ionicView.beforeEnter",function(e,t){if(GetSwitchChecked(),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return $scope.direction="back",void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.direction="foword",$scope.storeId=UserService.getUser().mid,$scope.init()})}]),APP.service("superMarketService",["$http","UrlService",function(e,t){this.getBanner=function(){return e.get(t.getNewUrl("SUPERMARKET_BANNER"))},this.getFurnishTop=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("SUPERMARKET_TOP"),r)},this.getFurnishBottom=function(o,i,s,n,a){var r={parentCateId:o,provinceId:i,cityId:s,districtId:n,streetId:a};return e.get(t.getNewUrl("SUPERMARKET_BOTTOM"),r)},this.getSupermarketCates=function(){return e.get(t.getNewUrl("SUPERMARKET_CATES"))}}]),APP.controller("OrderConfirmSeckillController",["$scope","SeckillService","$stateParams","$rootScope","$state","OrderConfirmSeckillService","$ionicPopup","$timeout","PopupService","CacheService","SeckillDetailService","$interval",function(e,t,o,i,s,n,a,r,c,l,d,u){e.htmlContent=o.content,e.title=o.title,e.tabNav="selection",e.searchGoodsName={name:""},e.seckillId,e.numbers,e.productIds,e.invoiceHead=void 0,e.zzsInvoice=void 0,e.isEnd=!1,e.unSale,e.init=function(){if(e.isEnd=!1,t.getServerTime().then(function(t){var i=t.data.data,s=o.beginTime,n=o.endTime,a=u(function(){(i+=1)<s||i>=s&&i<=n||i==s||i>n&&(e.isEnd=!0,u.cancel(a))},1e3)}),e.orderData={},e.htmlContent=o.content,e.title=o.title,e.seckillId=o.seckillId,e.numbers=o.numbers,e.productIds=o.productIds,e.orderConfirmMessage=l.get("seckillOrderInfo"),!e.orderConfirmMessage)throw new Error("订单生成失败,fatal---error");e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle},e.$on("$ionicView.beforeEnter",function(t,o){if("back"==o.direction){var i={isFromInvoices:1};d.seckillBuy(i).success(function(t){1==t.success&&null!=t.data?(e.orderConfirmMessage=t.data,e.regAddress=e.orderConfirmMessage.ordersCommitWrapM.order.address,e.regInvoice=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.invoiceHead=e.orderConfirmMessage.ordersCommitWrapM.billCompany,e.zzsInvoice=e.orderConfirmMessage.ordersCommitWrapM.memberInvoices.invoiceTitle):e.showPopup("订单查询失败 ")}).error(function(e){alert("网络错误")})}else e.init()}),e.toInvoice=function(t){s.go("invoiceSetup",{invoiceHead:e.invoiceHead,invoiceType:t,enterPage:1})},e.toSubmit=function(){if(e.regAddress)if(/^[^&<>]+$/.test(e.regAddress))n.toSubmit(e.seckillId).success(function(t,o,i,n){if(1==t.success){var a=JSON.stringify(t.data.order);s.go("afterOrderSubmit",{messageData:a})}else 0==t.success&&e.showPopup(t.message)}).error(function(){alert("网络失败")});else{a.alert({template:"详细地址不能包含特殊字符！",okText:"知道了"})}else{a.alert({template:"收货地址必须填写！",okText:"知道了"})}},e.toPayment=function(){s.go("payment")},e.tosendGoodsTime=function(){s.go("sendGoodsTime")},e.showPopup=function(e){var t=a.show({template:e});r(function(){t.close()},1e3)}}]),APP.service("OrderConfirmSeckillService",["$http","UrlService",function(e,t){this.toSubmit=function(o){var i={remark:"",seckillId:o};return e({method:"POST",url:t.getUrl("SECKILL_CONFIRM_ORDER_INFO"),params:i})}}]),APP.controller("SeckillDetailController",["$scope","$stateParams","$rootScope","ProductDetailService","$ionicPopup","$timeout","$ionicSlideBoxDelegate","$state","UserService","UrlService","SeckillDetailService","CacheService","CommonAddressService","SeckillService","$interval","countdownService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){e.noFresh=!1,e.tabNav="selection",e.isButton=!0,e.countDownMsg="",e.seckillList=[],e.isEnd=!1,e.productId=t.productId,e.message,e.beginTime=t.beginTime,e.endTime=t.endTime,e.unSale,e.init=function(){e.isEnd=!1,g.getServerTime().then(function(t){var o=t.data.data,i=e.beginTime,s=e.endTime,n="",a=m(function(){o+=1,o<i?(n=f.getTime(f.getTimeDif(1e3*i,1e3*o)),e.countDownMsg="距开始"+n):o>=i&&o<=s||o==i?e.countDownMsg="秒杀":o>s&&(e.isEnd=!0,e.countDownMsg="秒杀活动已结束",m.cancel(a))},1e3)}),e.user=c.getUser(),e.iscompleteLoad=!1,e.storeId=t.storeId,e.o2oType=t.o2oType,e.status=t.status,e.fromType=t.fromType,e.front=t.front,e.sku=t.sku,e.seckillId=t.seckillId,e.hasStock=!0,e.memberId="",e.seckillPrice=t.seckillPrice,e.actualPrice,e.pcPrice,e.O2OStoreName,e.hasStock,e.productCount=1,e.swiperImgs=[],e.user&&e.user.mid&&(e.memberId=e.user.mid);var o=p.getAddressInfo(),i={sku:e.sku,prodId:e.productId,regionId:o.areaId,number:1,provinceId:o.provinceId,cityId:o.cityId,pcrName:o.provinceName+" "+o.cityName+" "+o.regionName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId},s={productId:e.productId,storeId:e.storeId,fromUrl:"seckillList",seckillId:e.seckillId,ts:new Date-0};d.seckillDetail(s).success(function(t){0==t.success?e.unSale=!0:(e.productModel=t.data.product,e.productModel.pcrName=t.data.pcrName,e.iscompleteLoad=!0,e.swiperImgs=t.data.swiperImgs,e.actualPrice=t.data.actualPrice,e.pcPrice=t.data.finalPrice,e.O2OStoreName=t.data.O2OStoreName,d.checkStock(i).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1}))}).error(function(e){alert("网络错误")})},o.$on("SECKILL_LOCATION_"+e.productId,function(t,o){if(e.noFresh=!0,e.productModel.pcrName=o["text-1"]+" "+o["text-2"]+" "+o["text-3"]+" "+o["text-4"],e.productModel.pcrName){var i={sku:e.sku,prodId:e.productId,regionId:o["value-3"],number:1,provinceId:o["value-1"],streetId:o["value-4"],cityId:o["value-2"],pcrName:e.productModel.pcrName,memberId:e.memberId,finalPrice:e.seckillPrice,seckillId:e.seckillId};d.checkStock(i).success(function(t){e.hasStock=t.data.hasStock,e.message=t.data.message,e.isSupportCOD=t.data.isSupportCOD,e.expectTime=t.data.expectTime,e.commission=t.data.commission,e.hasStock?e.hasStock&&(e.isButton=!0):e.isButton=!1})}}),e.goBack=function(){1==e.front?r.go("myStore"):e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()}),e.changeState=function(t){1==t?i.changeChooseStateJia(e.productModel.product.sku,"1").success(function(t,o,i,s){e.productModel.product.onShelf=!e.productModel.product.onShelf}):i.changeChooseStateDui(e.productModel.product.sku).success(function(t,o,i,s){e.productModel.product.onShelf=!e.productModel.product.onShelf})},e.changeArea=function(){r.go("commonLocation",{flag:"SECKILL_LOCATION_"+e.productId})},e.seckillBuy=function(){var t={productIds:e.productId,numbers:1,seckillId:e.seckillId,COOKIE_DOMAIN:"mk",DOMAIN_URL:"http://172.24.1.22",POM_STATIC_DOMAIN_NAME:"http://172.24.1.22/mstatic"};d.seckillBuy(t).success(function(o){1==o.success&&null!=o.data?(u.set("seckillOrderInfo",o.data),r.go("orderConfirmSeckill",{seckillId:t.seckillId,numbers:t.numbers,productIds:t.productIds,beginTime:e.beginTime,endTime:e.endTime})):0==o.success?(e.unSale=!0,e.init()):e.showPopup("立即购买失败")}).error(function(e){alert("网络错误")})},e.tianJiaShouCang=function(){i.addShouCang(e.productId,e.productModel.product.productName,e.productModel.product.defaultImageUrl,e.productModel.product.sku,e.productModel.pcrName).success(function(t){e.showPopup("收藏成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.quXiaoShouCang=function(){i.cancelShouCang(e.productId).success(function(t){e.showPopup("取消成功"),e.productModel.isCollected=!e.productModel.isCollected})},e.showPopup=function(e){var t=s.show({template:e});n(function(){t.close()},1e3)},e.customerServe=function(){var e=navigator.userAgent;e.indexOf("Android")>-1||e.indexOf("Linux")>-1?window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_blank","location=yes"):(e.indexOf("iPhone"),window.open=cordova.InAppBrowser.open("http://app.qq.com/#id=detail&appid=1104761357","_system","location=yes"))},e.share=function(){if(!c.getUser().mid)return void h.showToast("请先登录,再分享");if(window.umeng){var t=l.getShareLinkHeader()+"seckillDetail/"+e.productId+"/"+e.o2oType+"/"+e.fromType+"/"+e.storeId+"/"+e.front+"/"+e.seckillPrice+"/"+e.seckillId+"/"+e.sku+"/"+e.status+"/"+e.beginTime+"/"+e.endTime+"/"+c.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀商品,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",t,0)}}}]),APP.service("SeckillDetailService",["$http","UrlService",function(e,t){this.checkStock=function(o){var i=t.getUrl("CHECK_STOCK");return e.get(i,o)},this.seckillDetail=function(o){if(!o.productId)return void alert("无productId error");var i=t.getUrl("SECKILLDETAIL")+o.productId+".html";return e.get(i,o)},this.seckillBuy=function(o){var i=t.getUrl("SECKILLBUY");return e.get(i,o)}}]),APP.controller("SeckillListController",["$scope","$rootScope","$stateParams","$state","$timeout","UrlService","$interval","SeckillService","$localstorage","UserService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d){function u(e){var t=new Date(e),o=(t.getFullYear(),t.getMonth()+1);o=o<10?"0"+o:o;var i=t.getDate();i=i<10?"0"+i:i;var s=t.getHours();s=s<10?"0"+s:s;var n=t.getMinutes();n=n<10?"0"+n:n;var a=t.getSeconds();return a=a<10?"0"+a:a,o+"月"+i+"日"+s+":"+n+":"+a}e.storeId,e.seckillStatus=0,e.seckillList=[],e.timer=void 0,e.curTime,e.timeDiff,e.isNull;e.init=function(){e.isNull=!1,e.seckillList=[];var o=c.get("storeId",t.globalConstant.storeId);e.storeId=o,r.getServerTime().error(function(){alert("网络失败")}).then(function(t){var o=t.data.data;e.serverMs=1e3*o;new Date(e.serverMs);return r.getSeckillList()}).then(function(t){function o(e,t){return e-t}if(!t)return e.ponitList=[],void alert("网络失败");e.seckillList=t.data.data,0==e.seckillList.size&&(e.isNull=!0),e.ponitList=[],angular.forEach(e.seckillList,function(t,o){t.beginStr=u(1e3*t.beginTime),t.endStr=u(1e3*t.endTime),t.status=void 0,e.serverMs<1e3*t.beginTime?(t.status=1,e.ponitList.push(1e3*t.beginTime-e.serverMs)):e.serverMs>=1e3*t.beginTime&&e.serverMs<=1e3*t.endTime?(e.ponitList.push(1e3*t.endTime-e.serverMs),t.status=2):e.serverMs>1e3*t.endTime&&(t.status=3),angular.forEach(t.sgSeckillItemFormList,function(e,o){e.beginTime=t.beginTime,e.endTime=t.endTime})}),e.ponitList.sort(o),e.ponitList[0]&&(e.timer=s(function(){e.init()},e.ponitList[0]>36e5?36e5:e.ponitList[0]))},function(t){alert("网络失败"),e.isNull=!0})},e.toDetail=function(e,t){i.go("seckillDetail",{productId:e.productId,o2oType:0,fromType:4,storeId:o.storeId,front:0,sku:e.sku,seckillPrice:e.seckillPrice,seckillId:e.seckillId,status:t,beginTime:e.beginTime,endTime:e.endTime})},e.$on("$ionicView.beforeEnter",function(t,o){e.init()}),e.$on("$ionicView.beforeLeave",function(t,o){s.cancel(e.timer)}),e.doRefresh=function(){s(function(){e.init(),e.$broadcast("scroll.refreshComplete")},1e3)},e.share=function(){if(!l.getUser().mid)return void d.showToast("请先登录,再分享");if(window.umeng){var e=n.getShareLinkHeader()+"seckillList/"+l.getUser().mid;window.umeng.share("顺逛秒杀活动","给您推荐顺逛每日秒杀活动,不可错过哦!","http://www.ehaier.com/mstatic/wd/v2/img/sg.png",e,0)}}}]),APP.service("SeckillService",["$http","UrlService",function(e,t){this.getSeckillList=function(){var o=t.getUrl("SECKILL_LIST");return e.post(o)},this.getSeckillDetail=function(e){t.getUrl("SECKILL_LIST",e)},this.getServerTime=function(o){var i=t.getUrl("SECKILL_SERVICE_TIME",o);return e.get(i)}}]),APP.directive("countdown",["$timeout","countdownService",function(e,t){return{restrict:"E",template:"<i>{{time.dd}}</i> <span>天</span> <i>{{time.hh}}</i>{{type}}<i>{{time.mm}}</i>{{type}}<i>{{time.ss}}</i>",link:function(o,i,s){function n(i){if(a>0&&i>0){var d=new Date-0+r,i=c-d;o.time=t.changeMs2Time(i),l=e(function(){n(i)},1e3)}else s.callback?(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o[s.callback](s.callbackparam)):(o.time={dd:"00",hh:"00",mm:"00",ss:"00"},o.callback())}o.type=s.type||":";var a,r,c,l=void 0;Math.random();if(!s.endtime)return!1;s.endtime&&s.curtime&&(c=t.formatTime2Ms(s.endtime),s.curtime?(a=t.getTimeDif(s.endtime,s.curtime),r=s.curtime-new Date-0,n(1)):t.getCurrTime().then(function(e){s.curtime=e.data,a=t.getTimeDif(s.endtime,s.curtime),r=s.curtime-new Date-0,n(1)}))},controller:["$scope",function(e){e.callback=function(){},e.$on("$destroy",function(){})}]}}]),APP.factory("countdownService",["$http",function(e){return{getTimeDif:function(e,t){return this.formatTime2Ms(e)-this.formatTime2Ms(t||new Date)},formatTime2Ms:function(e){return e?Date.parse(e.toString().replace(/-/g,"/"))||e:0},changeMs2Time:function(e){if(!e||parseInt(e)<0)return{dd:"00",hh:"00",mm:"00",ss:"00"};var t=parseInt(e/864e5),o=t<10?"0"+t:t;e=parseInt(e%864e5);var i=parseInt(e/36e5),s=i<10?"0"+i:i;e-=36e5*i;var n=parseInt(e/6e4),a=n<10?"0"+n:n;e-=6e4*n;var r=parseInt(e/1e3);return{dd:o,hh:s,mm:a,ss:r<10?"0"+r:r}},getTime:function(e,t){var o=this.changeMs2Time(e);return t=t||":",":"==t?o.dd+"天"+o.hh+":"+o.mm+":"+o.ss:o.dd+"天"+o.hh+"时"+o.mm+"分"+o.ss+"秒"},getCurrTime:function(){return e.post("/currTime")}}}]),APP.controller("dataAnalysisController",["$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","dataAnalysisService",function(e,t,o,i,s,n){function a(){e.byStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function r(){e.byStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.lgStyleActive={color:"#666","border-bottom":"0 solid #2979FF"}}function c(){e.cityByStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityLgStyle={color:"#666","border-bottom":"0 solid #2979FF"}}function l(){p=[{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""},{value:"",name:""}],g=[]}function d(){var e=document.getElementById("container"),t=echarts.init(e);f=t;var o=null;(o={graphic:{type:"text",left:"center",top:"center",z:99,zLevel:100,style:{text:v,x:100,y:100,width:30,height:30}},legend:{selectedMode:!1,x:"center",y:"bottom",data:g,itemHeight:9,itemWidth:9},clickable:!1,series:[{name:"半径模式",type:"pie",radius:[15,75],center:["50%","50%"],roseType:"area",x:"50%",max:40,sort:"ascending",clickable:!1,label:{normal:{formatter:"{d}%",textStyle:{fontWeight:"normal",fontSize:12}}},itemStyle:{normal:{color:function(e){return["#FB497C","#FFBB41","#6FE621","#4FCCFF","#4D7BF3"][e.dataIndex]}}},data:p}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}function u(){var e=document.getElementById("activeContenter"),t=echarts.init(e);h=t;var o=null;(o={title:{subtext:"单位：次"},calculable:!0,xAxis:[{type:"category",axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#dedede"}},data:[{value:"分享\n店铺",textStyle:{fontSize:"12",color:"#37394C"}},{value:"分享\n商品",textStyle:{fontSize:"12",color:"#37394C"}},{value:"任务\n完成",textStyle:{fontSize:"12",color:"#37394C"}},{value:"社区\n互动",textStyle:{fontSize:"12",color:"#37394C"}},{value:"评价\n次数",textStyle:{fontSize:"12",color:"#37394C"}},{value:"登录\n次数",textStyle:{fontSize:"12",color:"#37394C"}}]}],yAxis:[{axisLabel:{textStyle:{fontSize:"12",color:"#37394C"}},type:"value",splitNumber:2,axisTick:{lineStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"完成了",type:"bar",itemStyle:{normal:{color:function(e){return["#67AAF9"][0]}}},barWidth:"7",data:m}]})&&"object"==typeof o&&(t.setOption(o,!0),t.setOption(o))}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.PercentageCal=function(e,t){return num=parseFloat(e),total=parseFloat(t),isNaN(num)||isNaN(total)?"-":total<=0?"0%":Math.round(num/total*1e4)/100+"%"};var p,g,m,f,h,v="本月",S="";e.isHasData=!1,e.init=function(){n.doInit(S).success(function(t){t.success&&(e.dataUpdate=t.data,t.data&&(e.dataUpdateAddTime=1e3*parseInt(t.data.addTime)))})},e.disbuBL=function(t){n.distributionBL(t,S).success(function(t){if(t.success){if(t.data.length<=0)return void(e.isHasData=!0);e.isHasData=!1;for(var o=0;o<t.data.length;o++)p[o].value=t.data[o].mySaleNum,p[o].name=t.data[o].cateName,g[o]=t.data[o].cateName,o==t.data.length-1&&(p.length=t.data.length,d());0==t.data.length&&d()}})},e.actyBL=function(t){n.activityBL(t,S).success(function(t){t.success&&(e.dataActivity=t.data,m[0]=t.data.STORE_SHARE,m[1]=t.data.PRODUCT_SHARE,m[2]=t.data.TASK,m[3]=t.data.COMMUNITY,m[4]=t.data.ASSESS,m[5]=t.data.LOGIN,u())})},e.salesCity=function(t){n.salesCity(t,S).success(function(t){t.success&&(t.data.length>0?e.dataRegional=t.data:e.dataRegional=null)})},e.chooseCityDate=function(t){"BY"==t?(e.salesCity(!0),c()):(e.salesCity(!1),e.cityLgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.cityByStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseDate=function(t){l(),f&&f.dispose(),"BY"==t?(v="本月",e.disbuBL("true"),a()):(v="累计",e.disbuBL("false"),e.lgStyle={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyle={color:"#666","border-bottom":"0 solid #2979FF"})},e.chooseActive=function(t){h&&h.dispose(),m=[],"BY"==t?(e.actyBL(!0),r()):(e.actyBL(!1),e.lgStyleActive={color:"#2979FF","border-bottom":"2px solid #2979FF"},e.byStyleActive={color:"#666","border-bottom":"0 solid #2979FF"})},e.$on("$ionicView.beforeEnter",function(){e.containerPic=!0,e.activeContenterPic=!0,e.isHasData=!1,v="本月",S="",S=s.memberId,a(),r(),c(),l(),m=[],i.scrollTop(),e.dataUpdate=null,e.dataUpdateAddTime=null,e.dataActivity="",e.dataRegional=null,e.init(),e.disbuBL(!0),e.actyBL(!0),e.salesCity(!0)}),e.$on("$ionicView.beforeLeave",function(){f&&f.dispose(),h&&h.dispose(),e.containerPic=!1,e.activeContenterPic=!1})}]),APP.service("dataAnalysisService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={memberId:o};return e.get(t.getUrl("DATA_ANALYSIS_UPDATE"),i)},this.distributionBL=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_DISTRIBUTION"),s)},this.activityBL=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_ACTIVITY"),s)},this.salesCity=function(o,i){var s={onlyCurrentMonth:o,memberId:i};return e.get(t.getUrl("DATA_ANALYSIS_SALES"),s)}}]),APP.controller("teamMessageController",["$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","teamMessageService","UserService","UrlService","PopupService","CreditService","$state",function(e,t,o,i,s,n,a,r,c,l){i.isBasics=!1,i.userId=e.memberId,i.selectedIndex=0,i.orderFlag=3,i.orderStatus=0,i.pageIndex=0,i.pageSize=10,i.typeTeam=e.type,i.goBack=function(){t.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingtopClasscontent={
top:"276px"}):(i.androidClass={"line-height":"44px"},i.paddingtopClasscontent={top:"260px"}),i.switchCheck=function(e){o.scrollTop(),i.isBasics=0!=e,1==e&&(i.selectedIndex=0,i.orderInit(i.selectedIndex)),1==i.checkArr[e]||(i.hasMore=!0,i.pageIndex=0,i.checkArr=[!1,!1],i.checkArr[e]=!i.checkArr[e],i.relationshipType=0==e?1:2,i.init())},i.backToLastView=function(){l.go("teamSupervise"),t.clearCache()},i.gotoPartnerDetail=function(e,t){1==t?l.go("partnerDetail",{ownerId:e}):l.go("connectionDetail",{ownerId:e})},i.gotoSpreadConnection=function(e){l.go("spreadConnection",{partnerId:e})},i.init=function(){s.getConnectionMsg(i.userId).success(function(e){e.success&&(i.productList=e.data,i.firstOrderTime=i.productList.firstOrderTime)})},i.orderInit=function(e){s.getOrderList(i.orderFlag,e,i.userId,i.pageIndex,i.pageSize).success(function(e){e.success&&(i.orders=e.data.orders,i.hasMore=e.data.orders.length<e.data.countResult)})},i.orderByList=function(e){i.selectedIndex=e,i.pageIndex=0,o.scrollTop(),i.orderInit(i.selectedIndex)},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.loadMore=function(){i.pageIndex++,s.getOrderList(i.orderFlag,i.selectedIndex,i.userId,i.pageIndex,i.pageSize).success(function(e){e.success&&(e.data.orders.length<e.data.countResult?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasMore=!0,i.orders=i.orders.concat(e.data.orders)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasMore=!1))})},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void o.scrollTop();o.scrollTop(),i.relationshipType=1,i.checkArr=[!0,!1],i.hasMore=!0,i.init(i.userID),i.orderFlag=3,i.orderStatus=0,i.pageIndex=0,i.pageSize=10})}]),APP.service("teamMessageService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o){var i={memberId:o};return e.get(t.getUrl("TEAM_USERINFO"),i)},this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,queryMemberId:s,pageIndex:n,pageSize:a,noLoading:!0};return e.get(t.getUrl("ORDER_LIST"),r)}}]),APP.controller("teamSuperviseController",["$ionicPopup","$state","UserService","$scope","CLASSIFYMESSAGECRNTERService","$localstorage","$rootScope","teamSuperviseService","$stateParams","$ionicScrollDelegate","UrlService","CreditService","PopupService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){i.productList=[],i.childrenList=[],i.rowsList=[],i.isFindTab=!0,i.selectedIndex=0,i.isUserShow=!1,i.isTeamInfo=!1,i.isUser=!1,i.page=1,i.cascade=!1,i.isTeam=!0,i.sortIndex=0,i.sortInd=0,i.sortNum=2,i.pageSize=10,i.userpageSize=10,i.orderOrTeams=!1,i.sortsIndex=1,i.messageImgFlag=!0,i.flagNum=!1,i.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png",i.arrowState=[a.imgBaseURL+"img/sortT.png",a.imgBaseURL+"img/sortF.png"],i.Math=window.Math;var m=["startTime","isAuthenticated","teamLevelOrder","isActive"],f=["shopKeepers","purchasedNum","recentBuyingTime"];i.memberId=o.getUser().mid,i.substring=window.substring,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"padding-top":"20px"},i.paddingContentClass={top:"0px"}):(i.paddingtopClass={"padding-top":"0"},i.paddingContentClass={top:"0px"}),i.init=function(){g.getUnReadMsg().success(function(e){e.data>0?i.flagNum=!0:i.flagNum=!1})},i.share=function(){if(window.device&&window.device.hasNewShare)i.showShare=!i.showShare;else{var e=o.getUser().avatarImageFileId,t=d.getShareLinkHeader()+"register/0/"+i.productList.owner.promotionCode;window.umeng?window.umeng.share("我正在使用顺逛APP，推荐给你哦","时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",e,t,0):alert("只能在app分享,请下载app！")}},i.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastWithTime("复制成功",2e3)):p.showToast("请下载APP执行此操作")},i.hideblackCover=function(){i.showShare=!1},i.shareToPlatform=function(e){var t="我正在使用顺逛APP，推荐给你哦",s="时下最流行的赚钱APP，海尔集团官方平台，一起来玩吧",n=o.getUser().avatarImageFileId,a=d.getShareLinkHeader()+"register/0/"+i.productList.owner.promotionCode;window.umeng?(0==e?window.umeng.shareToSina(t,s,n,a,0,null,u.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,s,n,a,0,null,u.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,s,n,a,0,null,u.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,s,n,a,0,null,u.shareSuccessCallback),u.qqShare()):4==e&&(window.umeng.shareToQzone(t,s,n,a,0,null,u.shareSuccessCallback),u.qqShare()),5==e?i.copyText(a):u.successShare()):alert("umeng undefined 只能在app分享"),i.showShare=!1},i.lookreferee=function(){var t=e.show({template:'<div style="color: black;font-size: 16px;border-bottom:1px solid #f2f2f2;height:30px;lineHeight:30px;margin-bottom:8px;margin-top:-12px">推荐人信息</div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">我的推荐人 : <b>{{myheader.realName}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:5px;">ID : <b>{{myheader.memberId}}</b></div><div style="text-align:start;text-indent:32px;color: black;margin-bottom:-5px;position:relative;">手机号 : <b>{{myheader.mobile}}</b>&nbsp;&nbsp;<img ng-src="{{imgBaseURL}}img/headerphone.png" width="20" heihgt="20" style="position:absolute;top:-2px;" ng-click="cellphone()"/></div>',scope:i,buttons:[{text:"<b>确定</b>",type:"button-positive",onTap:function(e){e.preventDefault(),t.close()}}]})},i.cellphone=function(){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+i.myheader.mobile,"_system"):window.open("tel:"+i.myheader.mobile)},i.userM=function(){r.userData(i.memberId,i.page,i.pageSize,f[2],i.orderIndex).success(function(e){e.success&&(i.usersNumber=e.data.total)})},i.goMemberCenter=function(){u.getGameId(function(e){t.go("vip",{gameId:e})})},i.commontFun=function(e){l.scrollTop(),0==i.selectedIndex?(i.orderOrTeams=!1,i.info=0):1==i.selectedIndex&&(i.orderOrTeams=!0,i.info=1),r.doInit(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[e],i.orderIndex,i.active,i.store).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.usercomFun=function(e){r.userData(i.memberId,i.page,i.userpageSize,f[e],i.orderIndex).success(function(e){e.success&&(i.rowsList=e.data.rows,i.hasmore=i.rowsList.length<e.data.total)})},i.teamClickFun=function(e){l.scrollTop(),i.sortInd=e,i.page=1,0==i.sortsIndex?(i.sortsIndex=1,i.orderIndex="desc",i.commontFun(i.sortInd,i.orderIndex)):1==i.sortsIndex&&(i.sortsIndex=0,i.orderIndex="asc",i.commontFun(i.sortInd,i.orderIndex))},i.teamTrueAttestation=function(e){l.scrollTop(),i.sortInd=e,i.isAuthenticated=2,i.orderIndex="desc",i.page=1,i.childrenList=[],i.commontFun(i.sortInd)},i.teamLevel=function(e){i.childrenList=[],i.sortInd=e,i.orderIndex="desc",i.page=1,i.commontFun(i.sortInd)},i.teamActive=function(e){i.sortInd=e,i.isActiveNum=2,i.isAuthenticated=2,i.orderIndex="desc",i.page=1,i.childrenList=[],i.commontFun(i.sortInd)},i.userClickFun=function(e){i.sortNum=e,i.orderIndex="desc",i.page=1,i.usercomFun(i.sortNum)},i.userNumber=function(e){i.sortNum=e,i.orderIndex="desc",i.page=1,i.usercomFun(i.sortNum)},i.userTime=function(e){i.sortNum=e,i.page=1,0==i.sortsIndex?(i.sortsIndex=1,i.orderIndex="desc",i.usercomFun(i.sortNum,i.orderIndex)):1==i.sortsIndex&&(i.sortsIndex=0,i.orderIndex="asc",i.usercomFun(i.sortNum,i.orderIndex))},i.goBack=function(){i.$ionicGoBack()},i.getShopData=function(){r.doInit(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[i.sortIndex],i.orderIndex).success(function(e){e.success&&(e.data.parent?(i.hasparent=!0,i.myheader=e.data.parent):i.hasparent=!1,i.productList=e.data,i.childrenList=e.data.children,i.unauthenticatedNum=Math.floor(e.data.total-e.data.authenticatedNum),i.unactiveNum=Math.floor(e.data.total-e.data.unActiveNum),i.hasmore=i.childrenList.length<e.data.total)})},i.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},i.Reps=function(e){if(e)return e.substring(0,1)},i.teamTab=function(e){i.selectedIndex=e,i.sortInd=0,i.page=1,i.orderIndex="desc",i.childrenList=[],i.rowsList=[],l.scrollTop(),0==i.selectedIndex?(i.sortsIndex=1,i.orderIndex="desc",i.isTeam=!0,i.isTeamInfo=!1,i.isUserShow=!1,i.isUser=!1,i.isAuthenticated=2,i.isActiveNum=2,i.commontFun(i.sortInd,i.orderIndex)):1==i.selectedIndex?(i.isTeam=!0,i.isUserShow=!1,i.isTeamInfo=!1,i.isUser=!1,i.sortsIndex=1,i.orderIndex="desc",i.isAuthenticated=2,i.isActiveNum=2,i.commontFun(i.sortInd,i.orderIndex)):2==i.selectedIndex&&(i.isTeam=!1,i.isTeamInfo=!0,i.isUserShow=!0,i.isUser=!0,i.sortNum=2,i.orderIndex="desc",i.sortsIndex=1,i.usercomFun(i.sortNum,i.orderIndex))},i.storeFun=function(e){r.newStore(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[1],i.orderIndex,e).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.storeMoreFn=function(e,t){r.storeMore(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex,t).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.Authenticated=function(e){i.isAuthenticated=e,0==e?(i.page=1,i.store=!1,i.storeFun(i.store)):1==e&&(i.page=1,i.store=!0,i.storeFun(i.store))},i.activeFun=function(e){r.newActive(i.memberId,i.orderOrTeams,i.page,i.pageSize,m[3],i.orderIndex,e).success(function(e){e.success&&(i.productList=e.data,i.childrenList=e.data.children,i.hasmore=i.childrenList.length<e.data.total)})},i.activeMoreFn=function(e,t){r.activeMore(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex,t).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.isActive=function(e){l.scrollTop(),i.isActiveNum=e,0==e?(i.page=1,i.active=!1,i.activeFun(i.active)):1==e&&(i.page=1,i.active=!0,i.activeFun(i.active))},i.userLoadMore=function(e){r.userData(i.memberId,e,i.userpageSize,f[i.sortNum],i.orderIndex).success(function(e){e.success&&(i.rowsList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.rowsList=i.rowsList.concat(e.data.rows)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.teamLoadMore=function(e){r.doInit(i.memberId,i.orderOrTeams,e,i.pageSize,m[i.sortInd],i.orderIndex).success(function(e){e.success&&(i.childrenList.length<e.data.total?(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!0,i.childrenList=i.childrenList.concat(e.data.children)):(i.$broadcast("scroll.infiniteScrollComplete"),i.hasmore=!1))})},i.loadMore=function(){0==i.sortInd&&(0==i.selectedIndex||1==i.selectedIndex)||2==i.sortNum&&2==i.selectedIndex?0==i.sortsIndex?i.orderIndex="asc":1==i.sortsIndex&&(i.orderIndex="desc"):i.orderIndex="desc",0==i.selectedIndex&&(0==i.sortInd||2==i.sortInd)||1==i.selectedIndex&&(0==i.sortInd||2==i.sortInd)?(i.page++,i.teamLoadMore(i.page)):(0!=i.selectedIndex||1!=i.sortInd&&3!=i.sortInd)&&(1!=i.selectedIndex||1!=i.sortInd&&3!=i.sortInd)||(0==i.isActiveNum?(i.active=!1,i.page++,i.activeMoreFn(i.page,i.active)):1==i.isActiveNum?(i.active=!0,i.page++,i.activeMoreFn(i.page,i.active)):0==i.isAuthenticated?(i.store=!1,i.page++,i.storeMoreFn(i.page,i.store)):1==i.isAuthenticated?(i.store=!0,i.page++,i.storeMoreFn(i.page,i.store)):(i.page++,i.teamLoadMore(i.page))),2==i.selectedIndex&&(i.page++,i.userLoadMore(i.page))},i.commonFn=function(){l.scrollTop(),i.rowsList=[],i.productList=[],i.childrenList=[],i.selectedIndex=0,i.sortInd=0,i.sortNum=2,i.page=1,i.memberId=o.getUser().mid,i.store=!0,i.active=!0,i.isTeam=!0,i.isUser=!1,i.isUserShow=!1,i.isTeamInfo=!1,i.orderIndex="desc",i.hasmore=!0,i.sortIndex=0,i.getShopData()},i.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void g.getUnReadMsg().success(function(e){e.data>0?i.flagNum=!0:i.flagNum=!1});i.commonFn(),i.userM(),i.init()})}]),APP.service("teamSuperviseService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n,a,r,c,l){var d={withParent:!0,memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r};return e.get(t.getUrl("TEAM_SUPERVISE"),d)},this.storeMore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.activeMore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newStore=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isAuthenticated:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.newActive=function(o,i,s,n,a,r,c){var l={memberId:o,cascade:i,pageNumber:s,pageSize:n,sort:a,order:r,isActive:c,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),l)},this.userData=function(o,i,s,n,a){var r={memberId:o,pageNumber:i,pageSize:s,sort:n,order:a};return e.get(t.getUrl("TEAM_USERS"),r)}}]),APP.controller("userMessageController",["$state","$stateParams","$ionicHistory","$ionicScrollDelegate","$scope","userMessageService","$rootScope",function(e,t,o,i,s,n,a){s.userId=t.memberId,s.name=t.name,s.mobile=t.mobile,s.isTeamNum=t.isTeamNum,s.page=1,s.pageSize=20,s.sortsIndex=2,s.arrowState=[a.imgBaseURL+"img/sortT.png",a.imgBaseURL+"img/sortF.png",a.imgBaseURL+"img/sort2.png"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(s.paddingtopClass={"padding-top":"20px"},s.paddingtopClasscontent={top:"246px"},s.teamInfos={top:"46%"}):(s.paddingtopClass={"padding-top":"0"},s.paddingtopClasscontent={top:"220px"},s.teamInfos={top:"36%"}),s.init=function(){n.getConnectionMsg(s.mobile,s.page,s.pageSize).success(function(e){e.success&&(s.productList=e.data,s.userList=e.data.rows,s.hasmore=s.userList.length<e.data.total)})},s.priceRange=function(e){var t=Math.floor(e/1e3);return t>=20?1e3*t+"~":1e3*t+"~"+(1e3*t+1e3)},s.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},s.goBack=function(){s.$ionicGoBack()},s.goBackMsg=function(){e.go("teamMessage",{memberId:s.userId})},s.userLoadMore=function(e){n.getConnectionMsg(s.userId,e,s.pageSize).success(function(e){e.success&&(s.userList.length<e.data.total?(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!0,s.userList=s.userList.concat(e.data.rows)):(s.$broadcast("scroll.infiniteScrollComplete"),s.hasmore=!1))})},s.loadMore=function(){s.page++,s.userLoadMore(s.page)},s.$on("$ionicView.beforeEnter",function(e,t){if("back"==t.direction)return void i.scrollTop();i.scrollTop(),s.page=1,s.pageSize=20,s.hasMore=!0,s.init(s.userId,s.page,s.pageSize)})}]),APP.service("userMessageService",["$http","UrlService",function(e,t){this.getConnectionMsg=function(o,i,s){var n={mobile:o,pageNumber:i,pageSize:s,noLoading:!0};return e.get(t.getUrl("TEAM_MESSAGE"),n)}}]),APP.controller("userSearchController",["$rootScope","$scope","userSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,i,s,n,a,r){t.memberId=i.getUser().mid,t.page=1,t.pageSize=20,t.pageNum=10,t.searchValue="",t.selectedIndex=r.selectedIndex,t.Reps=function(e){if(e)return e.substring(0,1)},t.backToLastView=function(){t.$ionicGoBack()};var c=document.querySelector("#focus");t.timeFun=function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/\//g,"-").replace(/日/g," ")},t.commonFun=function(e){o.teamSearch(t.memberId,t.searchValue,e,t.page,t.pageNum).success(function(e){e.success&&(t.searchResults=e.data.children,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.searchConnection=function(){if(""==t.searchValue)return void n.showToast("请填写搜索内容");0==t.selectedIndex&&(t.cascade=!1,t.commonFun(t.cascade)),1==t.selectedIndex&&(t.cascade=!0,t.commonFun(t.cascade)),2==t.selectedIndex&&o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults=e.data.rows,0==t.searchResults.length?t.noSearchResults=!0:t.noSearchResults=!1,t.hasMore=t.searchResults.length<e.data.total)})},t.loadMore=function(){t.page++,o.getSearchResults(t.memberId,t.page,t.pageSize,t.searchValue).success(function(e){e.success&&(t.searchResults.length<e.data.total?(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!0,t.searchResults=t.searchResults.concat(e.data.rows)):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasMore=!1))})},t.$on("$ionicView.enter",function(){"back"==t.direction?c.blur():(t.searchValue="",t.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),t.$on("$ionicView.beforeEnter",function(e,o){t.direction=o.direction,t.page=1,t.pageSize=20,t.pageNum=10,t.hasMore=!0,t.placeHolder="请输入用户名称"})}]),APP.service("userSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,i,s,n){var a={memberId:o,pageNumber:i,pageSize:s,userName:n,noLoading:!0};return e.get(t.getUrl("TEAM_USERS"),a)},this.teamSearch=function(o,i,s,n,a){var r={memberId:o,keyword:i,cascade:s,pageNumber:n,pageSize:a,noLoading:!0};return e.get(t.getUrl("TEAM_SUPERVISE"),r)}}]),APP.controller("AllCircleController",["HomePageService","$scope","$rootScope","$state","$ionicScrollDelegate","$ionicPopup","PopupService","AllCircleService","$ionicSlideBoxDelegate","$timeout","UserService","$ionicModal",function(e,t,o,i,s,n,a,r,c,l,d,u){t.isDisplay=!1,t.moreTag=!1,t.hasmore=!0,o.toFilterCode="",t.scrollMainTop=function(){s.$getByHandle("allMainScroll").scrollTop([!0])},t.searchTag={searchKey:"",tagSearch:"",pageIndex:1,pageSize:10},t.tagsName=[],t.circleList="",t.search=function(e){},t.goBack=function(){t.$ionicGoBack()},t.inPersonalPage=function(e){i.go("personalHomepageHe",{othersId:e})},t.goShop=function(){i.go("myStore",{storeId:t.userId,shareStoreId:""})},t.toFilterTagSearch=function(){o.toFilterCode=1,i.go("qSearchBiao")},t.isClick=function(){t.isDisplay=!t.isDisplay},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&s.scrollTop(),s.resize()},t.jumpMsgCenter=function(){i.go("ClassifyMessageCenter")},t.getCircleLists=function(){t.pageNum=1;var e={pageIndex:t.pageNum,pageSize:10,tagIds:""};r.filterCircle(e).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList}).error(function(){})},t.tagsFilter=function(e,o,i){if(t.moreTag=!1,t.pageNum=1,t.searchId=e,1==i)t.tagsName[o].isChecked=!1,t.init(),s.$getByHandle("allMainScroll").scrollTop();else{angular.forEach(t.tagsName,function(e){e.isChecked=!1}),t.tagsName[o].isChecked=!0;var n={pageIndex:1,pageSize:5,tagIds:e};r.filterCircle(n).success(function(e){t.totalCount=e.totalCount,t.circleList=e.data.list.topicList,s.$getByHandle("allMainScroll").scrollTop()}).error(function(){})}},t.toCirclePage=function(e){i.go("circlePage",{circleId:e})},t.toApplyCircle=function(e){t.showNum=e,r.existApplyingCircle().success(function(e){e.success?(i.go("applyCircle"),delete o.reviewCircleId):t.applyCircleModal.show()}).error(function(){})},t.getTags=function(){var e={topicId:"",noLoading:!0};r.getTags(e).success(function(e){t.tagsName=e.data.list})},t.joinCircle=function(s){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:s.id}),o.gio.track("active",{circleID:s.id})),t.itemTopicName=s.topicName;var n={ids:s.id,noLoading:!0};r.joinTopic(n).success(function(e){1==e.success?(s.isJoin=1,1==e.success?(t.inCircle=!0,l(function(){t.inCircle=!1},1e3)):a.showToast(e.message)):-2e3==e.errorCode&&(a.showToast(e.message),o.loginIsAccord2=!0)})}})},t.loadMore=function(){t.pageNum+=1;var e={tagIds:t.searchId?t.searchId:"",pageIndex:t.pageNum,pageSize:5};r.getTopicList(e).success(function(e){e.data.list.topicList&&0!=e.data.list.topicList.length?l(function(){t.totalCount=e.totalCount,t.circleList=t.circleList.concat(e.data.list.topicList),t.$broadcast("scroll.infiniteScrollComplete");var o=t.circleList.length;t.hasmore=!(o==e.totalCount),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.hideApplyCircleModal=function(){t.applyCircleModal.hide()},t.getTitleList=function(){r.getTopicTitleList().success(function(e){if(e.success){t.titleList=e.data.list,t.itemTopicList(t.titleList[0].id,0);for(var o=0;o<t.titleList.length;o++)t.titleList[o].className=""}})},t.itemTopicList=function(e,o){var i={categoryId:e};r.getTopicSecondList(i).success(function(e){if(e.success){for(var i=0;i<t.titleList.length;i++)t.titleList[i].className="";t.titleList[o].className="bac",t.secondList=e.data.list}})},t.init=function(){t.titleList=[],t.secondList=[],t.userId=d.getUser().mid,u.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.applyCircleModal=e}),t.pageNum=0,t.getTitleList(),t.getCircleLists(),t.getTags(),t.searchId="",t.moreTag=!1,t.isDisplay=!1,t.hasmore=!0,t.circleList=[],s.$getByHandle("allMainScroll").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){"back"==o.direction||($("ion-header-bar").show(),t.init())})}]),APP.service("AllCircleService",["$http","UrlService",function(e,t){this.getUserMessageCount=function(){return e.post(t.getUrl("GETUSERMESSAGECOUNT"))},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.getTopicTitleList=function(){return e.get(t.getUrl("CIRCLE_GET_CIRCLE_LIST"))},this.getTopicSecondList=function(o){return e.get(t.getUrl("CIRCLE_GET_SECONDLIST"),o)},this.getTopicList=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.filterCircle=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCONDITION"),data:o})},this.existApplyingCircle=function(o){return e({method:"POST",url:t.getUrl("EXIST_APPLY_TOPIC"),data:o})}}]),APP.controller("AllMembersController",["$scope","$state","$stateParams","AllMembersService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,i,s,n,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.noDisplay=function(){e.isDisplay=!1},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.goBack=function(){t.go("circlePage",{circleId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(o){e.isDisplay=!1,t.go("personalHomepageHe",{othersId:o})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.isClick=function(){e.isDisplay?e.isDisplay=!1:e.isDisplay=!0},e.toSetAdmin=function(){"true"==e.isHost||"true"==e.superAdmin?t.go("CircleSetAdmin",{topicId:e.topicId}):(e.isDisplay=!1,n.showToast("您不是圈主，不能进行此操作"))},e.toManageUser=function(){"true"==e.isAdmin||"true"==e.isHost||"true"==e.superAdmin?t.go("manageUser",{topicId:e.topicId}):(e.isDisplay=!1,n.showToast("您不是圈主或管理员，不能进行此操作"))},e.init=function(){e.isDisplay=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.hasmore=!1;var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},i.getuserlist(t).success(function(t){e.isAdmin=t.data.ifAdmin,e.isHost=t.data.ifHost,e.superAdmin=t.data.isManager,e.mainuserlist=t.data.list1,e.mainuser2list=t.data.list2,e.userNum=t.totalCount,e.userlist=t.data.list,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.mainuserlist=t.data.list1,e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list),e.$broadcast("scroll.infiniteScrollComplete");var o=e.userlist.length;e.hasmore=!(o===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("AllMembersService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)}}]),APP.factory("anchorScroll",function(){function e(e,o,i){var s=$(window).height();e=$(e),i=i>0?i:s/10,$("html, body").animate({scrollTop:o?e.offset().top-i:e.offset().top+e.outerHeight()+i-s},{duration:200,easing:"linear",complete:function(){t(e)||e[0].scrollIntoView(!!o)}})}function t(e){function t(e){return e>a&&e<r}e=$(e);var o=$(window),i=o.height(),s=e.offset().top,n=e.outerHeight(),a=o.scrollTop(),r=a+i;return!!t(s+(n>i?i:n)/2)||n>i&&t(s+n-i/2)}return{toView:e,inView:t}}),APP.controller("ApplyCircleController",["$scope","$rootScope","$state","ApplyCircleService","PopupService","$ionicActionSheet","$timeout","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$ionicModal","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,c){e.userPicUrl="",e.bigPicUrl="",t.storeId=[],t.nameStringToObj=[],t.addedTags=[],e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:2,topicId:""},e.init=function(){1==t.showApplyTag?e.showApplyBtn=!1:e.showApplyBtn=!0,d.fromTemplateUrl("templates/quanzi/applyCircleModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyCircleModal=t}),1==t.ifInit?(e.tagsName=t.allNames,t.ifInit=2):(e.topicId="",e.auditRefuseStatus="",t.allNames="",t.addedTags=[],t.nameStringToObj=[],t.frequentTags="",e.tagsName="",t.reviewCircleId&&(e.reviewApplyCircle(),e.getTags()),e.auditOpinion="",c.resize())},e.goBack=function(){e.$ionicGoBack(),t.showApplyTag="",delete t.reviewCircleId},e.warnDelete=function(o){e.isDisplay=!1;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除草稿吗？</div>',title:"删除草稿",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.deleteDraftCircle()}},{text:"放弃"}]});a(function(){},3e3)},e.hideApplyCircleModal=function(){e.applyCircleModal.hide()},e.openStatus=function(t){e.auditOpinion[t].open_status=!e.auditOpinion[t].open_status},e.jumpSelect=function(){o.go("selectTags")},e.deleteDraftCircle=function(){var o={id:t.reviewCircleId};i.delectDraft(o).success(function(o){o.success&&(delete t.reviewCircleId,e.$ionicGoBack())})},e.imgPush=function(t){n.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function s(t){e.userPicUrl=t,a(function(){e.existPhoto=!0},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.userPicUrl,encodeURI(i.uploadImage()),o,s,n)}function n(){}function c(t){e.userPicUrl=t,e.existPhoto=!0,a(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.userPicUrl,encodeURI(i.uploadImage()),o,s,n)}return 0==t?(navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(c,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.imgBigPush=function(t){n.show({buttons:[{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(){}function s(t){e.applyData.topicBgImg="",e.bigPicUrl=t,e.existPhoto=!0,a(function(){},200);var o=function(t){r.hide();var o=JSON.parse(t.response);e.applyData.topicBgImg=o.urls.toString()},s=function(e){r.hide()},n={};(new FileTransfer).upload(e.bigPicUrl,encodeURI(i.uploadImage()),o,s,n)}if(0==t)return navigator.camera.getPicture(s,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:640,targetHeight:180}),!0}})},e.deleteTags=function(e){t.addedTags.splice(e,1)},e.deleteFrequentTags=function(e,o){for(var i=0;i<t.frequentTags.length;i++)t.frequentTags[i].name==o&&(t.frequentTags[i].isChecked=!1);t.storeNames.splice(e,1),t.storeId.splice(e,1),t.nameStringToObj.splice(e,1)},e.commitData=function(){var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};i.judgeWords(o).success(function(n){if("没有敏感词"==n.message){var r=e.applyData;r.tagIds=t.storeId.toString(),e.pushTags=[];for(var c=0;c<t.addedTags.length;c++)e.pushTags.push(t.addedTags[c].name);r.tagNames=e.pushTags.toString(),3==e.darftStatus?(r.auditStatus=2,i.storageDraft(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})):t.reviewCircleId?i.refuseStorage(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){}):i.applyCircleInfo(r).success(function(i){0==i.success?s.showToast(i.message):(e.$ionicGoBack(),t.applyBottomNotice=!0,e.applyData={},t.nameStringToObj=[],e.userPicUrl="",e.bigPicUrl="",r="",o="",e.tagsName="",a(function(){t.applyBottomNotice=!1},3e3))}).error(function(e){})}else s.showToast("存在敏感词"+n.data)}).error(function(){})},e.applyTopicNotice=function(){l.show({template:"<p>确认提交圈子申请吗？</p>",title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>提交</span>",type:"",onTap:function(){e.commitData()}}]});a(function(){},3e3)},e.applyTopic=function(o){e.userPicUrl?""==e.applyData.topicImg?s.showToast("图片正在上传，请稍后再试"):e.bigPicUrl&&""==e.applyData.topicBgImg?s.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?s.showToast("申请理由不能少于20字"):t.nameStringToObj.length+t.addedTags.length<3?s.showToast("选择标签不能少于三个"):e.applyTopicNotice():s.showToast("请输入圈子申请理由"):s.showToast("请输入圈子介绍"):s.showToast("请输入圈子名称"):s.showToast("亲，你没有设置背景图哦"):s.showToast("亲，你没有设置头像哦"):e.bigPicUrl&&""==e.applyData.topicBgImg?s.showToast("图片正在上传，请稍后再试"):o.topicImg?o.topicBgImg?o.topicName?o.topicDescription?o.topicReason?o.topicReason.length<20?s.showToast("申请理由不能少于20字"):e.applyTopicNotice():s.showToast("请输入圈子申请理由"):s.showToast("请输入圈子介绍"):s.showToast("请输入圈子名称"):s.showToast("亲，你没有设置背景图哦"):s.showToast("亲，你没有设置头像哦")},e.$on("$ionicView.beforeEnter",function(o,i){"back"===i.direction?e.init():(e.init(),e.userPicUrl="",e.bigPicUrl="",e.applyData={topicImg:"",topicBgImg:"",topicName:"",topicDescription:"",topicReason:"",tagIds:"",tagNames:"",auditStatus:e.topicId?3:2,topicId:t.reviewCircleId?t.reviewCircleId:""})}),e.reviewApplyCircle=function(){var o={topicId:t.reviewCircleId};i.reviewEditApply(o).success(function(t){e.darftStatus=t.data.list.auditStatus,e.topicId=t.data.list.id,e.auditRefuseStatus=t.data.list.auditStatus,
e.applyData.topicImg=t.data.list.topicImg,e.applyData.topicBgImg=t.data.list.topicBgImg,e.bigPicUrl=t.data.list.topicBgImg,e.userPicUrl=t.data.list.topicImg,e.applyData.topicName=t.data.list.topicName,e.applyData.topicDescription=t.data.list.topicDescription,e.applyData.topicReason=t.data.list.entryReason,e.auditOpinion=t.data.list.auditHistory,c.resize()}).error(function(){})},e.getTags=function(){var o={id:t.reviewCircleId};i.getTags(o).success(function(o){e.tags=o.data.list;for(var i=0;i<e.tags.length;i++)if(e.tags[i].approval){var s={name:e.tags[i].name};t.addedTags.push(s)}else{var n={name:e.tags[i].name};t.nameStringToObj.push(n)}})},e.storageDraft=function(){if(!(e.applyData.topicImg||e.applyData.topicBgImg||e.applyData.topicName||e.applyData.topicDescription||e.applyData.topicReason||e.applyData.topicReason))return void s.showToast("亲，请至少填一项哦");var o={keywords:e.applyData.topicName+e.applyData.topicDescription+e.applyData.topicReason};e.applyData.auditStatus=3,i.judgeWords(o).success(function(o){if("没有敏感词"==o.message){var n=e.applyData;n.tagIds=t.storeId.toString(),e.pushTags=[];for(var r=0;r<t.addedTags.length;r++)e.pushTags.push(t.addedTags[r].name);n.tagNames=e.pushTags.toString(),e.topicId&&3==e.auditRefuseStatus?i.storageDraft(n).success(function(t){0==t.success?s.showToast(t.message):(e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):1==e.auditRefuseStatus?i.refuseStorage(n).success(function(t){0==t.success?s.showToast(t.message):(e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){}):i.applyCircleInfo(n).success(function(o){0==o.success?s.showToast(o.message):(t.reviewCircleId=o.data,e.auditRefuseStatus=3,e.topicId=o.data,e.applyData.topicId=o.data,e.draftStorgeSuccess=!0,a(function(){e.draftStorgeSuccess=!1},1e3))}).error(function(e){})}else s.showToast("存在敏感词"+o.data)}).error(function(){})}}]),APP.service("ApplyCircleService",["$http","UrlService",function(e,t){this.applyCircleInfo=function(o){return e({method:"POST",url:t.getUrl("APPLY_TOPIC"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})},this.reviewEditApply=function(o){return e({method:"POST",url:t.getUrl("REVIEW_APPLY_TOPIC"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.storageDraft=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_DRAFT"),data:o})},this.delectDraft=function(o){return e({method:"POST",url:t.getUrl("DELETE_APPLY_TOPIC_DRAFT"),data:o})},this.refuseStorage=function(o){return e({method:"POST",url:t.getUrl("STORAGE_APPLY_REFUSE"),data:o})}}]),APP.controller("CircleGroupDiscussController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService","$q","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId=tlz55&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},I,$)}function S(e){alert("得到图片失败")}function I(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.groupMsg="图片文件",o.data.imageUrl=i,o.data.fileType=".jpg",o.data.groupMsgUserId=e.csId,o.data.timeStamp=new Date-0,o.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss");var s={c:"sendGroupMsg",groupId:e.groupId,msg:i,msgType:1,token:e.token};r.sendMsg(s).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(o.data)}else l.showToast("发送消息失败--发送音频后")},function(e){})}function $(e){alert("上传失败")}function w(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function y(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.circleId,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode},e.toShareListPage=function(e){s.go("shareListPage",{sl:e})};var T=c.getUser();e.groupId,e.chatId=e.groupId,e.row=0,e.token=c.getUser().sessionValue,e.isClick=function(t){t?e.isDisplay=!e.isDisplay:s.go("discussionGroup",{groupId:e.groupId,circleId:e.circleId})},e.toMemberList=function(){s.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.isSchool=!0,e.sgdMode=2,e.toggleMode=function(t){e.sgdMode=t},e.init=function(){},e.noMoreHistory=!1,e.getMsgByMun=function(){if(!e.noMoreHistory){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};r.getMsgByMun(t).success(function(t){if(t)if(t.rows&&angular.isArray(t.rows)){for(var o=0;o<t.rows.length;o++)r.filtMsg(t.rows[o]);e.messages=t.rows.concat(e.messages),t.rows.length<1e3&&(e.noMoreHistory=!0)}else consoel.warn("sg--getMsgByMun-- response  not array !! ");else l.showToast("获得 讨论组 历史聊天记录 失败")}).finally(function(){e.$broadcast("scroll.refreshComplete")})}},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=f.defer(),o=0==e.messages.length?1:0,i={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token,row:e.row,isSelf:o};return r.getMsg(i).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++)o.data.msgs[i].groupMsg&&(r.filtMsg(o.data.msgs[i]),e.messages.push(o.data.msgs[i]));e.row=o.data.row,t.resolve(1)}else t.reject(1)},function(e){alert(e)}),t.promise},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};e.CustumerParam.msg||l.showToast("发送的消息不能为空"),r.sendMsg(t).then(function(o){if(o){if(o.data&&103==o.data.rt)return void l.showToast("您已经被禁言，请联系管理员");var i={groupMsg:t.msg,groupMsgUserId:e.csId,groupMsgUserName:T.nickName,sendTimes:(new Date).pattern("yyyy-MM-dd hh:mm:ss")};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=""}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.getImg=function(e){u.getPicture(e,v,S)},e.play=function(){var e=document.getElementById("audioInCD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInCD","audioInCD")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),u.stopCapture("sourceInCD","audioInCD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},C,b)};var C=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,i.data.groupMsg="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.groupMsgUserId=e.csId,i.data.timeStamp=new Date-0,i.data.sendTimes=(new Date).pattern("yyyy-MM-dd hh:mm:ss"),e.deleteRecord();var s={c:"sendGroupMsg",groupId:e.groupId,msg:o,msgType:1,token:e.token};r.sendMsg(s).then(function(t){if(t){if(t.data&&103==t.data.rt)return void l.showToast("您已经被禁言，请联系管理员");e.messages.push(i.data)}else l.showToast("发送消息失败--发送音频后");e.loopGetMsg()},function(e){})},b=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");e.isPlaying||n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:A})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.chooseOne=function(e){e.isSelected=!e.isSelected},e.shareToGroup=function(){var t=[];angular.forEach(e.messages,function(e,o){e.isSelected&&t.push(e)});var o="讨论组名称$share"+JSON.stringify(t);s.go("groupsToShare",{shareList:o})},e.deleteGroupMsg=function(){},e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o;var n=c.getUser();e.csId=n.mid,e.init(),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",w),window.addEventListener("native.keyboardhide",y),u.addAudioEventOnWindow(),e.groupId=i.groupId,e.circleId=i.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),"back"==s.direction?e.loopGetMsg():(e.messages=[],e.groupId=61,e.loopGetMsg())});var A=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(t,o){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",w),window.removeEventListener("native.keyboardhide",y),e.killTimer()}),e.goBack=function(){e.isPlaying||e.$ionicGoBack()}}]),APP.service("CircleGroupDiscussService",["$http","UrlService","$sce",function(e,t,o){function i(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+s[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+s[t]+'.png" />')}this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8181/api/invoke",t)},this.getAllMsg=function(t){return e({method:"POST",url:"http://123.56.3.136:8181/api/invoke",params:t})},this.getMsgByMun=function(t){return e({method:"POST",url:"http:///123.56.3.136:8180/Service/chatGroup/queryPageGroupMsg",params:t})},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.sendTimes&&(e.timeStamp=new Date(e.sendTimes)-0),e.groupMsg&&e.groupMsg.indexOf("$share")>-1){var t=e.groupMsg.indexOf("$share"),o=e.groupMsg.substring(0,t),s=e.groupMsg.substring(t+6),n=/\\/g;s=s.replace(n,"");var a=JSON.parse(s),r=0;angular.isArray(a)&&(r=a.length);e.shareMsgsList=a,e.fileType="share",e.shareMsgsLength=r,e.from=o}else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.groupMsg;else if(e.groupMsg&&e.groupMsg.indexOf("http")>-1&&e.groupMsg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.groupMsg;else if(e.groupMsg.indexOf("[")>-1&&e.groupMsg.indexOf("]")>-1)for(var c=1;c<16;c++)e.groupMsg=i(e.groupMsg,c)};var s=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];new Date,new Date("2014-8-4 10:21:12")}]),APP.directive("resizeFootBarcd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-cd"),n=e.$getByHandle("cdScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]);var sm={groupMsg:'飞机飞啊飞哇$share[{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav\\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:22\\",\\"isSelected\\":true},{\\"fileType\\":\\".wav\\",\\"imageUrl\\":\\"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav\\",\\"groupMsgUserId\\":1383068791,\\"groupMsgUserName\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:23\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 \\",\\"groupMsgUserId\\":138306984,\\"groupMsgUser\\":\\"我不是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:24\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"aaf啊积极饿哇 啊发\\",\\"groupMsgUserId\\":1234,\\"groupMsgUser\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:25\\",\\"isSelected\\":true},{\\"groupMsg\\":\\"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png\\",\\"groupMsgUserId\\":1234,\\"groupMsgUserName\\":\\"我zou是路飞啊啊啊\\",\\"$$hashKey\\":\\"object:26\\",\\"isSelected\\":true}]'};Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},o={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+o[this.getDay()+""]));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var historyMsg={total:0,core:"10000",rows:[{groupId:61,companyId:138306984,groupMsg:"test1111",sendTimes:"2017-02-28 14:49:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:50:15",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 14:51:58",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test11e",sendTimes:"2017-02-28 15:00:43",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test2223",sendTimes:"2017-02-28 16:27:12",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:29:49",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"},{groupId:61,companyId:138306984,groupMsg:"test111dddd",sendTimes:"2017-02-28 16:30:05",groupMsgUserId:"138306984",groupMsgUserName:"138306984",idCate:1,avatarImageFileid:"http://cdn22.ehaier.com/file/5872f927b702c4e3398315da.png",nickName:"张三",userGag:"0"}],footer:[]};APP.controller("CirclePageController",["HomePageService","$scope","$rootScope","$state","$stateParams","CirclePageService","$ionicScrollDelegate","NoteDetailsService","UrlService","PopupService","$ionicModal","ionicDatePicker2","ionicTimePicker","$timeout","UserService","$ionicPopup","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){function v(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}t.isDisplay=!1,t.showList=!1,t.moreTag=!1,t.hasmore=!0,t.showTopBtn=!1,t.contentNum={contentNum:""},t.topicId,t.topData,t.listData=[],t.circleId,t.tagsName,t.showShare=!1,t.topicid="",t.allowPub=!0,t.topicSummary,t.signSuccess=!1,t.init=function(){o.mediaurl="",o.mediaImg="",t.userId=m.getUser().mid,t.phoneHeight=document.documentElement.clientHeight/2,t.showQQ=!1,t.isDisplay=!1,t.showList=!1,t.showWeChat=!1,t.showShare=!1,t.timeWidget={hour:"",minute:""},t.timeWidget2={hour:"",minute:""},window.cordova?t.ifInApp=!1:t.ifInApp=!0,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){t.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){t.showWeChat=0!=e})),t.$broadcast("scroll.refreshComplete"),t.moreTag=!1,t.ifDownload=!0,t.pageIndex=1,t.hasmore=!0,t.listData=[],t.getTags(),t.getListMsg(),t.getTopicSummary(),t.getCircleMembers(),a.$getByHandle("mainScroll").scrollTop(),t.stateIfOpen={},t.applyDiscussionData={topicId:"",entryReason:"",startDate:"",startHour:"",startMin:"",endDate:"",endHour:"",endMin:""},t.personType={isAdmin:!1},window.cordova?t.openFromBrowser=!0:t.openFromBrowser=!1},t.NumberCheck=function(e){/^\d*$/.test(e)||(isNaN(parseInt(e))?t.contentNum.contentNum=0:t.contentNum.contentNum=parseInt(e))},t.goBack=function(){t.$ionicGoBack()},t.isClick=function(){t.isDisplay=!t.isDisplay},t.goshare=function(){if(!m.getUser().mid)return void i.go("login");t.showShare=!t.showShare},t.isClick=function(){t.isDisplay=!t.isDisplay},t.showCameraList=function(){if(window.cordova&&(o.gio.track("createTopic",{circleID:t.circleId}),o.gio.track("active",{circleID:t.circleId})),t.topicSummary.isJoin){var e={topicId:t.circleId};n.circleSpeak(e).success(function(e){e.success?0==e.data.isGap&&(t.showList=!t.showList):-2e3==e.errorCode?(l.showToast(e.message),o.loginIsAccord2=!0):l.showToast("您已被禁言，不能发话题")})}else{f.show({template:"<p>亲，先加入我们再秀话题吧。</p>",title:"退出圈子",subTitle:"Please use normal things",scope:t,buttons:[{text:"<span>加入</span>",type:"",onTap:function(){t.joinCircle()}},{text:"再想想"}]});g(function(){},3e3)}},t.jumpPublishCircle=function(){i.go("publishCircle")},t.goShop=function(){i.go("myStore",{storeId:t.userId,shareStoreId:""})},t.closeDownload=function(){t.ifDownload=!1},t.jumpMsg=function(){i.go("ClassifyMessageCenter")},t.inPersonalPage=function(e){i.go("personalHomepageHe",{othersId:e})},t.toNoteDetails=function(e,o,s){t.noteIndex=s,i.go("noteDetails",{noteId:e,isShortStory:o})},t.hideList=function(){t.showList=!1},t.scrollToTop=function(){a.$getByHandle("mainScroll").scrollTop(!0),t.showTopBtn=!1},t.getScrollHeight=function(){t.scrollHeight=Math.abs(document.getElementById(t.topicSummary.topicName).getBoundingClientRect().top),t.scrollHeight>3*t.phoneHeight?t.showTopBtn=!0:t.showTopBtn=!1},t.jumpPhoto=function(e){t.showList=!1,3!=e?i.go("publishCircle",{identifierCode:"",topicId:t.circleId,topicStyle:e}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(s){i.go("publishCircle",{identifierCode:"",topicId:t.circleId,topicStyle:e});var n=JSON.parse(s),a=n.videoFile,r=n.imageFile,c=a.replace("\\",""),l=r.replace("\\","");o.mediaurla=c,o.mediaImga=l},function(e){})},t.getTags=function(){var e={id:t.circleId,flag:0};n.getTags(e).success(function(e){t.tagsName=e.data.list})},t.tagsNameList=function(e,o){t.tagsIndex=e,t.tagId=o,t.listData=[],t.pageIndex=1,t.hasmore=!0,t.getListMsg()},t.joinCircle=function(){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{window.cordova&&(o.gio.track("follow",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a={ids:t.circleId};n.joinTopic(a).success(function(e){1==e.success?(t.inCircle=!0,g(function(){t.inCircle=!1},1e3),t.topicSummary.isJoin=!0,t.getCircleMembers(),t.getTopicSummary()):l.showToast(e.message)})}}),window.cordova&&(o.gio.track("follow",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a={ids:t.circleId};n.joinTopic(a).success(function(e){1==e.success?(t.inCircle=!0,g(function(){t.inCircle=!1},1e3),t.topicSummary.isJoin=!0,t.getCircleMembers(),t.getTopicSummary()):-2e3==e.errorCode&&(l.showToast(e.message),o.loginIsAccord2=!0)})},t.signIn=function(){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else if(t.topicSummary.isJoin){var s={topicId:t.circleId,userId:t.userId,signType:2};n.circleSignIn(s).success(function(e){if(e.success){t.signInfoData=e.data;var o=f.show({template:"<div class='sign-box' flex='main:center'>\n                              <div ng-click=\"closeSign()\" class='sign-close' flex='main:right'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                              <div class='sign-bg'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_background.png\" style='width:100%;' alt=\"\" /></div>\n                              <div class='sign-content'>\n                                <div class='sign-title' flex='main:center cross:center'>\n                                  <div class='sign-icon' flex='cross:center'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                                  <div class='title-text'>签到排名<span>{{signInfoData.rank}}</span></div>\n                                </div>\n                                <p ng-if='signInfoData.golds>0'>获得<span class='sign-num'>{{signInfoData.golds}}</span>金币</p>\n                                <p ng-if='signInfoData.signRules'>连续签到<span class='sign-num'>{{signInfoData.signRules.continuitySign}}</span>天即可获取<span class='sign-num'>{{signInfoData.signRules.golds}}</span>金币</p>\n                              </div>\n                              <div class='sign-foot' ng-click='goSignInChart(circleId)'>签到排行榜</div>\n                            </div>",cssClass:"signPopup",scope:t});t.closeSign=function(){o.close(),t.getTopicSummary()},t.goSignInChart=function(e){o.close(),i.go("signInChart",{topicId:e})}}else l.showToast(e.message)})}else l.showToast("请先加入圈子")})},t.signDate=function(e,t,o){i.go("signDate",{userId:e,topicId:t,monthFlag:o})},t.jumpAllMembers=function(e){i.go("allMembers",{topicId:e})},t.isMoreTag=function(){t.moreTag=!t.moreTag,0==t.moreTag&&a.scrollTop(),a.resize()},t.getCircleMembers=function(){var e={topicId:t.circleId};n.circleMembers(e).success(function(e){e.success&&(t.members=e.data.list,t.membersHead=e.data.list1[0])})},t.getTopicSummary=function(){var e={topicId:t.circleId};n.getCircleInfo(e).success(function(e){t.topicSummary=e.data.list[0],n.topicName=t.topicSummary.topicName,0==t.topicSummary.allowPubStory?t.allowPub=!1:1==t.topicSummary.allowPubStory&&(t.allowPub=!0),t.topicid=e.data.list.id,t.minNum=t.topicSummary.capacity;var o=t.topicSummary.dateNow.split("-"),i=Number(o[0]),s=Number(o[1]),a=Number(o[2]);t.signSucDate={signYear:i,signMonth:s,signDay:a},n.signSuccessDate=t.signSucDate})},t.extendContent=function(){if(t.contentNum.contentNum<=t.minNum)t.biggerThanFive=!0,g(function(){t.biggerThanFive=!1},3e3);else if(t.contentNum.contentNum>2e3)t.biggerThanTwoThousand=!0,g(function(){t.biggerThanTwoThousand=!1},3e3);else{var e={topicId:t.circleId,entryCapacity:t.contentNum.contentNum};n.extendContent(e).success(function(e){e.success?(t.hideBigerModal(),t.contentNum.contentNum="",o.applyBottomNotice=!0,t.isDisplay=!1,g(function(){o.applyBottomNotice=!1},3e3)):l.showToast(e.message)})}},t.noticeDownload=function(){o.downAppUrl||l.showToast("不支持该手机")},t.applyDiscussion=function(){var e=t.applyDiscussionData;e.topicId=t.circleId,n.applyDiscuss(e).success(function(e){1==e.success?(l.showToast(e.message),t.hideModal(),t.applyDiscussionData.endHour="",t.applyDiscussionData.endMin="",t.applyDiscussionData.startHour="",t.applyDiscussionData.startMin=""):l.showToast(e.message)}).error(function(){})},t.stateDiscussion=function(){var e={topicId:t.circleId};n.discussionState(e).success(function(e){1==e.success?(t.stateIfOpen=e.data,t.stateIfOpen.isAdmin=!0):l.showToast("获取讨论组 服务器异常")}).error(function(){l.showToast("获取讨论组 相关信息失败")})},t.toChat=function(){var e=t.circleId,o=t.stateIfOpen.groupId;if(!e||!o)return void l.showToast("缺少讨论组参数，错误");i.go("circleGroupDiscuss",{circleId:e,groupId:o})},t.loadMoreMsg=function(){t.pageIndex+=1;var e=v("loginId"),o=window.navigator.userAgent.toLowerCase(),i="micromessenger"==o.match(/MicroMessenger/i),s={pageIndex:t.pageIndex,pageSize:5,topicId:t.circleId,tagId:t.tagId,noLoading:!0,userCode:i?t.weChatOpenId:e};n.getCircleList(s).success(function(e){if(e.data.list&&0!=e.data.list.length){t.listData=t.listData.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete");var o=t.listData.length;t.hasmore=!(o===e.data.storeItemsCounts)}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,l.showToast("没有更多消息了")}).error(function(){t.$broadcast("scroll.infiniteScrollComplete")})},t.loadTopicStory=function(){n.getTopStory(topData).success(function(e){})},t.showModal=function(){d.fromTemplateUrl("templates/quanzi/selectModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.selectModal=e,t.selectModal.show()})},t.hideModal=function(){t.selectModal.hide()},t.showBigerModal=function(){d.fromTemplateUrl("templates/quanzi/biggerModal.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.biggerModal=e,t.biggerModal.show()}),t.isDisplay=!1},t.hideBigerModal=function(){t.biggerModal.hide()},t.getListMsg=function(){var e=v("loginId"),o=window.navigator.userAgent.toLowerCase(),i="micromessenger"==o.match(/MicroMessenger/i);t.listMsg={pageIndex:1,pageSize:5,topicId:t.circleId,tagId:t.tagId,userCode:i?t.weChatOpenId:e},n.getCircleList(t.listMsg).success(function(e){t.listData=e.data.list,t.whichPersonType(),t.stateDiscussion()}).error(function(){})},t.whichPersonType=function(){var e={topicId:t.circleId,noLoading:!0};r.getPersonType(e).success(function(e){1==e.success&&(t.personType={isAdmin:e.data.isAdmin})})},t.topicPraise=function(e,i){window.cordova&&(o.gio.track("like",{circleID:s.circleId}),o.gio.track("active",{circleID:s.circleId}));var a=v("loginId"),r=window.navigator.userAgent.toLowerCase(),c="micromessenger"==r.match(/MicroMessenger/i),d={id:e,noLoading:!0,userCode:c?t.weChatOpenId:a};n.pushPraise(d).success(function(e){1==e.success?1==t.listData[i].praiseFlag?(t.listData[i].praiseNumber=t.listData[i].praiseNumber-1,t.listData[i].praiseFlag=!t.listData[i].praiseFlag):(t.listData[i].praiseNumber=t.listData[i].praiseNumber+1,t.listData[i].praiseFlag=!t.listData[i].praiseFlag):g(function(){l.showToast(e.message)},200)})},t.topicFavorite=function(s,a){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)i.go("login");else{var r={id:s};n.topicFavorite(r).success(function(e){1==e.success?1==t.listData[a].collectionFlag?(t.listData[a].collectionNumber=t.listData[a].collectionNumber-1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):(t.listData[a].collectionNumber=t.listData[a].collectionNumber+1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):g(function(){l.showToast(e.message)},200)})}});var r={id:s};n.topicFavorite(r).success(function(e){1==e.success?1==t.listData[a].collectionFlag?(t.listData[a].collectionNumber=t.listData[a].collectionNumber-1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):(t.listData[a].collectionNumber=t.listData[a].collectionNumber+1,t.listData[a].collectionFlag=!t.listData[a].collectionFlag):-2e3==e.errorCode&&(l.showToast(e.message),o.loginIsAccord2=!0)})},t.shareToStore=function(){var e={flag:0,topicId:t.circleId};r.shareStore(e).success(function(e){e.success})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){l.showToastShort("复制成功")},200)):l.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o="邀请您关注"+t.topicSummary.topicName+"圈子",i="欢迎关注"+t.topicSummary.topicName+"圈子，与"+t.topicSummary.topicName+"微店主同城交流互动。",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=c.getShareLinkHeader()+"circlePage/"+t.circleId;t.circleId;window.umeng?0==e?window.umeng.shareToSina(o,i,s,n,0,null,h.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,h.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,h.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,n,0,null,h.shareSuccessCallback),h.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,n,0,null,h.shareSuccessCallback),h.qqShare()):5==e?t.copeText(n):h.successShare():alert("umeng undefined 只能在app分享"),t.showShare=!1,t.shareToStore()},t.dateOne="开始时间",t.dateTwo="结束时间",t.a=1,t.b=1,t.firstDatePicker=function(){var e={callback:function(e){t.dateOne=e,t.applyDiscussionData.startDate=e,t.a=2},to:new Date(t.dateTwo)};u.openDatePicker(e)},t.secondDatePicker=function(){var e={callback:function(e){t.dateTwo=e,t.applyDiscussionData.endDate=e,t.b=2},from:new Date(t.dateOne)};u.openDatePicker(e)},t.oneTimePicker=function(){var e={callback:function(e){var o=new Date(1e3*e);t.applyDiscussionData.startHour=("00"+o.getUTCHours()).substr(o.getUTCHours().toString().length),t.applyDiscussionData.startMin=("00"+o.getUTCMinutes()).substr(o.getUTCMinutes().toString().length)}};p.openTimePicker(e)},t.twoTimePicker=function(){var e={callback:function(e){var o=new Date(1e3*e);t.applyDiscussionData.endHour=("00"+o.getUTCHours()).substr(o.getUTCHours().toString().length),t.applyDiscussionData.endMin=("00"+o.getUTCMinutes()).substr(o.getUTCMinutes().toString().length)}};p.openTimePicker(e)},t.exitTopicNotice=function(){f.show({template:"<p>亲，忍心离开我们圈子了吗？</p>",title:"退出圈子",subTitle:"Please use normal things",scope:t,buttons:[{text:"<span>退出</span>",type:"",onTap:function(){t.exitTopic()}},{text:"再想想"}]});g(function(){},3e3)},t.exitTopic=function(){var e={topicId:t.circleId};n.exitTopic(e).success(function(e){e.success?(t.isDisplay=!1,t.isDisplay=!1,t.outawayCircle=!0,t.showList=!1,g(function(){t.outawayCircle=!1},1e3),t.topicSummary.isJoin=!1,t.getCircleMembers(),t.getTopicSummary()):(t.isDisplay=!1,l.showToast(e.message))}).error(function(){l.showToast(response.message)})},t.wechatOpenId=function(){r.getWeChatOpenId().success(function(e){e.success&&(e.data?(t.weChatOpenId=e.data,r.weChatOpenId=e.data,t.init()):t.wechatUrlOpenId())})},t.wechatUrlOpenId=function(){var e=$location.absUrl();r.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},t.$on("$ionicView.beforeEnter",function(e,i){t.circleId=s.circleId,t.tagId=null,t.tagsIndex=0,o.ifDeleteNoteList&&(t.listData.splice(t.noteIndex,1),o.ifDeleteNoteList=!1),"back"==i.direction?t.getTopicSummary():(window.cordova&&o.gio.track("circleEntry",{circleID:t.circleId}),
$("ion-header-bar").show()),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?t.wechatOpenId():"back"==i.direction||t.init()}),t.$on("$stateChangeSuccess",function(e,i,s,n,a){o.fromState=n.name,o.toState=i.name,"publishCircle"==o.fromState&&t.init()})}]),APP.service("CirclePageService",["$http","UrlService",function(e,t){this.getCircleInfo=function(o){return e({method:"POST",url:t.getUrl("TOPIC_INFO"),data:o})},this.topicName="",this.shareinfor=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.circleMembers=function(o){return e({method:"POST",url:t.getUrl("GETLISTBYCODE"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGS_BY_TOPICID"),data:o})},this.getTopStory=function(o){return e({method:"POST",url:t.getUrl("TOP_STORY"),data:o})},this.circleSpeak=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SPEAK"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.extendContent=function(o){return e({method:"POST",url:t.getUrl("ENLARGE_CONTENT"),data:o})},this.applyDiscuss=function(o){return e({method:"POST",url:t.getUrl("ENTRYFORUM"),data:o})},this.discussionState=function(o){return e({method:"POST",url:t.getUrl("DISCUSSION_STATE"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.getCircleList=function(o){return e({method:"POST",url:t.getUrl("LIST"),data:o})},this.exitTopic=function(o){return e({method:"POST",url:t.getUrl("EXIT_TOPIC"),data:o})},this.circleSignIn=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGNIN"),data:o})},this.signSuccessDate=""}]),APP.controller("CircleSetAdminController",["$scope","$state","$stateParams","CircleSetAdminService","$ionicScrollDelegate","PopupService",function(e,t,o,i,s,n){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId}),e.input={isinput:""}},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.addAdmin=function(o){t.go("selectAdmin",{topicId:e.topicId})},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.decAdmin=function(t){var o={topicId:e.topicId,userCode:t,indentityStatus:0};i.setAdmin(o).success(function(t){t.success&&e.getCircleUser()}).error(function(){})},e.getCircleUser=function(){var t={topicId:e.topicId};i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2}).error(function(){})},e.init=function(){e.pageIndex=1,e.input={isinput:""},e.getCircleUser()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("CircleSetAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("CIRCLE_CIRCLEPERSON"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,o,i){function s(){var e=t.html();o.stripBr&&"<br>"===e&&(e=""),i.$setViewValue(e)}i&&(i.$render=function(){t.html(i.$viewValue||"")},t.on("blur keyup change",function(){e.$apply(s)}))}}}),APP.controller("ClassNoteDetailsController",["$scope","$rootScope","$ionicModal","$state","$stateParams","$ionicLoading","$http","PlatformService","ClassNoteDetailsService","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","TopicdetailsService","$timeout","$ionicActionSheet","PopupService","$timeout","UrlService","NoteDetailsService","UserService","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,g,h,v,S,I){e.isDisplay=!1,e.inputShow=!0,e.praiseNum={},e.commentId="",e.circleId,e.circleDetail,e.commentList,e.commentWords={words:""},e.pinglunis=!1,e.topicheight=0,e.comment={text:"",rows:1},e.noteDetail={reply:"说点什么"},e.$watch("noteDetail.reply",function(e,t,o){}),e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,e.isImage=!1,e.showBigImg=!1,e.imgString="",e.isPublishImage=!1,e.imgA=[],e.showBigBac=!1,e.goBack=function(){e.$ionicGoBack(),t.nextPageBefore="classNoteDetails"},e.goshare=function(){if(!S.getUser().mid)return void i.go("login");e.showShare=!e.showShare,e.isDisplay=!1},e.goToScore=function(t){if($(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),"linklink"==t.target.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("all-to"==t.target.className)if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else{var o=t.target.outerText;e.tolink(o)}else if("atopic"==t.target.className){if(t.target.attributes["data-a"]){var o=t.target.attributes["data-a"].value;e.tolink(o)}else if(t.target.attributes.dataa){var o=t.target.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.className){if(t.target.parentNode.attributes["data-a"]){var o=t.target.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.attributes.dataa){var o=t.target.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}}else if("atopic"==t.target.parentNode.parentNode.className)if(t.target.parentNode.parentNode.attributes["data-a"]){var o=t.target.parentNode.parentNode.attributes["data-a"].value;e.tolink(o)}else if(t.target.parentNode.parentNode.attributes.dataa){var o=t.target.parentNode.parentNode.attributes.dataa.value;if(o.indexOf("#")>0){var i=o.indexOf("#");o.substring(i)}else e.tolink(o)}},e.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==r.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},e.goShop=function(){i.go("myStore",{storeId:e.userId,shareStoreId:""})},e.noticeDownload=function(){t.downAppUrl||f.showToast("不支持该手机")},e.jumpMsg=function(){i.go("ClassifyMessageCenter")},e.inPersonalPage=function(e){0!=e&&i.go("personalHomepageHe",{othersId:e})},e.isClick=function(){e.isDisplay=!e.isDisplay},e.downLoadPhoto=function(o){e.photoUrl=o,t.isIOS?m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(o,function(e){f.showToast("保存成功")},function(e){f.showToast("保存失败")})}}):m.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){t.$broadcast("LOADING:SHOW");var o=new FileTransfer,i=encodeURI(e.photoUrl);return o.download(i,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存成功")},function(e){t.$broadcast("LOADING:HIDE"),f.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}})},e.productConnect=function(){var t={productId:e.circleDetail.productId,userCode:e.circleDetail.userCode};v.connectProduct(t).success(function(t){e.products=t.data.list})},e.toProductDetail=function(e){i.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},e.editTopic=function(){i.go("publishEdit",{topicId:e.circleId})},e.showCommentView=function(t){e.commentId=t;l.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:e,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){e.insertComments()}}]});g(function(){},3e3)},e.isInputShow=function(){e.inputShow=!e.inputShow},e.pinglunshow=function(){var t=d.$getByHandle("pinglun"),o=t.getScrollPosition(),i=o.top,s=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-s,g(function(){e.pinglunis=i>e.topicheight},200)},e.nocommontId=function(){e.commontId&&(e.commontId="",e.toSomeone="",e.commentWords.words="",e.iconImageData=[])},e.focuss=function(){e.isPublishImage=!0,e.showBac=!0,e.iconImageData.length>0&&(e.isImage=!0)},e.deleteImg=function(t){e.iconImageData.splice(t,1)},e.showLarge=function(t){e.showBigBac=!0,e.showBigImg=!0,e.Url=t},e.closeBigImg=function(){e.showBigImg=!1,e.showBigBac=!1},e.closeImg=function(){e.isImage=!1,e.isPublishImage=!1,e.showBac=!1},e.imgPush=function(t){if(e.isImage=!0,e.iconImageData.length>=9)return void f.showToast("最多添加9张");m.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};g(function(){e.iconImageData.push(o),e.existPhoto=!0},200)}function i(){}if(0==t)return navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var s=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i)}e.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis,e.shuxiaoxi=!e.shuxiaoxi},e.favorite=function(){var t={id:e.circleId,noLoading:!0};c.pushPraise(t).success(function(e){})},e.follow=function(o){if(0==o){var i={id:e.circleDetail.userCode,isFollow:1};c.followNote(i).success(function(o){1==o.success?e.circleDetail.isFolled=1:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}else if(1==o){var i={id:e.circleDetail.userCode,isFollow:0};c.followNote(i).success(function(o){1==o.success?e.circleDetail.isFolled=0:-2e3==o.errorCode&&(f.showToast(o.message),t.loginIsAccord2=!0)})}},e.getA=function(){g(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},1e3)},e.getCircleDetails=function(){var t={id:e.circleId};c.getCircleDetails(t).success(function(t){e.circleDetail=t.data,e.circleDetail.productId&&e.productConnect()}),e.getA()},e.getComment=function(){var t={pageIndex:1,pageSize:1e4,id:e.circleId};c.getComments(t).success(function(t){e.commentNumbers=t.totalCount,e.commentList=t.data.list,e.imgString="",e.imgA=[];for(var o=0;o<e.commentList.length;o++)e.commentList[o].commentImgs&&(e.imgString=e.commentList[o].commentImgs,e.imgA=e.imgString.split(","),e.commentList[o].imgaa=e.imgA);d.resize()})},e.getFocus=function(t,o){event.stopPropagation(),e.commentWords.words="",e.iconImageData=[],e.isPublishImage=!0,e.showBac=!0,e.commontId=t,e.toSomeone="回复给："+o,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.leaveFocus=function(){e.commontId="",e.toSomeone=""},e.insertComments=function(){var t=0;if(e.commentWords.words){var o={keywords:e.commentWords.words};u.judgeWords(o).success(function(o){"没有敏感词"==o.message?0==e.iconImageData.length?e.publishTopic():angular.forEach(e.iconImageData,function(o,i){var s=function(o){n.hide(),t++;var s=JSON.parse(o.response),a=s.urls;e.imgUrlList[i]=a,t==e.iconImageData.length&&e.publishTopic()},a=function(e){n.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(v.uploadImage()),s,a,r)}):(f.showToast("存在敏感词",o.data),e.commentWords.words="")})}else f.showToast("内容不能为空")},e.publishTopic=function(t){if(e.commontId){var t={comment:e.commentWords.words,commentTo:e.commontId,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}else{var t={comment:e.commentWords.words,commentImgs:e.imgUrlList.toString(),id:e.circleId};e.insertCommentOK(t)}},e.insertCommentOK=function(t){c.insertComment(t).success(function(t){e.getComment(),1==t.success?(f.showToast("回复成功"),e.commentWords.words="",e.commontId="",e.toSomeone="",e.iconImageData=[],e.imgUrlList=[],e.isImage=!1,e.isPublishImage=!1,e.showBac=!1):(g(function(){f.showToast(t.message)},200),e.commentWords.words="")}).error(function(t){f.showToast("网络异常"),e.commentWords.words=""})},e.topicPraise=function(t){var o={id:t,noLoading:!0};c.pushPraise(o).success(function(t){1==t.success?(e.isPraise=!e.isPraise,e.getStoryPraiseNum(),f.showToast("点赞成功")):f.showToast(t.message)})},e.topicFavorite=function(o){var i={id:o,noLoading:!0};c.topicFavorite(i).success(function(o){1==o.success?(e.isFavorite=!e.isFavorite,e.getStoryPraiseNum(),f.showToast("收藏成功")):-2e3==o.errorCode?(f.showToast(o.message),t.loginIsAccord2=!0):f.showToast(o.message)})},e.commentPraise=function(t,o){var i={commentId:t.id};c.commentPraise(i).success(function(i){1==i.success&&(t.commentPraiseNumberFlag=!t.commentPraiseNumberFlag,e.commentPraiseNum(t,o))})},e.getStoryPraiseNum=function(){var t={id:e.circleId};c.getStoryPraise(t).success(function(t){e.praiseNum=t.data})},e.commentPraiseNum=function(t,o){var i={commentId:t.id};c.commentPraiseNum(i).success(function(t){e.commentList[o].commentPraiseNumber=t.totalCount})},e.deleteStory=function(){var t={storyId:e.circleDetail.id};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("话题删除成功"),i.go("circlePage",{circleId:e.circleDetail.topicId}))})},e.warnDeleteComments=function(o){e.isDisplay=!1,e.deleteId=o;l.show({template:'<img src="'+t.imgBaseURL+'img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:e,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){e.deleteComment()}}]});g(function(){},3e3)},e.deleteComment=function(){var t={id:e.deleteId};c.deleteStory(t).success(function(t){1==t.success&&(f.showToast("删除成功"),e.getComment())})},e.shareToStore=function(){var t={flag:2,storyId:e.circleDetail.id};v.shareStore(t).success(function(e){e.success})},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),g(function(){f.showToastShort("复制成功")},200)):f.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.circleDetail.storyName+"-顺逛微社区",i=e.circleDetail.storyContentText.substr(0,30),s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=h.getShareLinkHeader()+"classNoteDetails/"+e.circleId;window.umeng?(0==t?window.umeng.shareToSina(o,i,s,n,0,null,I.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,I.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,I.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,s,n,0,null,I.shareSuccessCallback),I.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,s,n,0,null,I.shareSuccessCallback),I.qqShare()),5==t?e.copeText(n):I.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1,e.shareToStore()},e.closeDownload=function(){e.ifDownload=!1},e.init=function(){e.iconImageData=[],e.imgUrlList=[],e.showBac=!1,o.fromTemplateUrl("templates/quanzi/biggerPictureModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.biggerPictureModal=t}),e.userId=S.getUser().mid,window.cordova?e.ifInApp=!1:e.ifInApp=!0,e.toSomeone="",e.showQQ=!1,e.ifDownload=!0,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t})),e.commentWords={words:""},e.showShare=!1,e.isFavorite=!0,e.isPraise=!0,e.isDisplay=!1,e.circleId=s.noteId,e.ifShort=s.isShortStory,e.personType={isAdmin:!1,isCreateStory:!1},e.getCircleDetails(),e.getComment(),e.getStoryPraiseNum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ClassNoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("GETSTORYINFO"),data:o})},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("CLASS_DELETE_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOLLECTION"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("GETSTORYCOMMENT"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("SUBMITCOMMENT"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GETSTORYPRAISEANDUNREAD"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("SCHOOLCOMMENTPARISENUM"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})}}]),APP.controller("ClassesDetailsController",["$scope","$rootScope","$state","$stateParams","ClassesDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r){e.isClick=0,e.input={input:""},e.classInfo={courseCategory:"",courseName:"",courseStartTime:"",teacher:"",teacherIntroduce:"",forumStartTime:"",forumEndTime:"",courseDescription:"",timeOrder:""},e.membersJoin={courseId:2,createTime:"2017-01-17 11:24:00.0",id:3,type:"2",userCode:"",userImg:"",userName:""},e.teacherList={userName:2,teacherIntroduce:"2017-01-17 11:24:00.0",userImg:3,children:"2",courseName:"",courseId:""},e.messageBoardList={questionId:"",questionContent:"",questionTime:"",questionUserName:"",questionUserCode:"",questionUserImg:"",firstAnswerId:"",firstAnswerContent:"",firstAnswerTime:"",firstAnswerUserName:"",firstAnswerUserCode:"",firstAnswerUserImg:"",firstAnswerIsTeacher:"",answersTotal:"",totalCount:""},e.classesList={},e.topicList={},e.shareList={},e.init=function(){e.ifShowInput=!0,e.getClassInfo(),e.getClassesList(),e.getMessageBoardList(),e.getClassTopicList(),e.studentShare()},e.click0=function(){e.isClick=0},e.click1=function(){e.isClick=1},e.click2=function(){e.isClick=2},e.goBack=function(){e.$ionicGoBack()},e.getClassInfo=function(){var t={courseId:2};s.getClassInfo(t).success(function(t){e.classInfo=t.data.list[0],e.classJoinMember(),e.getTeacherList()})},e.classJoinMember=function(){var t={courseId:2};s.classJoinMember(t).success(function(t){e.membersJoin=t.data.list})},e.getTeacherList=function(){var t={courseId:2};s.getTeacherList(t).success(function(t){e.teacherList=t.data.list})},e.getClassesList=function(){var t={courseId:2};s.getClassesList(t).success(function(t){e.classesList=t.data.list})},e.getClassTopicList=function(){var t={courseId:2};s.getClassTopicList(t).success(function(t){e.topicList=t.data.list})},e.studentShare=function(){var t={courseId:1};s.studentShare(t).success(function(t){e.shareList=t.data.list,r.$getByHandle("mainScroll").resize()})},e.getMessageBoardList=function(){var t={courseId:1,pageSize:5,pageIndex:1};s.getMessageBoardList(t).success(function(t){e.messageBoardList=t.data.list})},e.toQuestionDetail=function(e){o.go("questionDetails",{wordsId:e})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showInput=function(){e.ifShowInput=!e.ifShowInput},e.commitAnswer=function(){var t={wordsContent:e.input.input,courseId:"",parentId:""};s.askQuestion(t).success(function(e){}).error(function(){})}}]),APP.service("ClassesDetailsService",["$http","UrlService",function(e,t){this.getClassInfo=function(o){return e({method:"POST",url:t.getUrl("COURSE_INFO"),data:o})},this.classJoinMember=function(o){return e({method:"POST",url:t.getUrl("COURSE_ALL_MEMBER"),data:o})},this.getTeacherList=function(o){return e({method:"POST",url:t.getUrl("COURSE_TEACH_LIST"),data:o})},this.getClassesList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_LIST"),data:o})},this.getClassTopicList=function(o){return e({method:"POST",url:t.getUrl("CLASSES_TOPIC_LIST"),data:o})},this.studentShare=function(o){return e({method:"POST",url:t.getUrl("STUDENT_SHARE"),data:o})},this.getMessageBoardList=function(o){return e({method:"POST",url:t.getUrl("MESSAGE_BOARD_LIST"),data:o})},this.askQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})}}]),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$q","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(t){e.tempUrl=t;var o=r.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,S)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.imageUrl=i,o.data.fileType=".jpg",o.data.companyId=void 0,o.data.message="图片文件",o.data.companyId=void 0,e.$apply(function(){e.messages.push(o.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(s).then(function(e){e||l.showToast("addevent  失败")})}function S(e){alert("上传失败")}function I(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function $(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.productObjs=[],e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:""},e.footerStyle={bottom:"0px"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.isShowRecord=!1,e.tempUrl,e.isOffLine=!1,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.userInCC.mid,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["mid","image"],values:[1111222,333]};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?l.showToast("客服暂时不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.isPlaying||e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.getMsg=function(){var t=g.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++)r.filtMsg(o.data.msgs[i]),o.data.msgs[i].message&&e.messages.push(o.data.msgs[i]);t.resolve(1)}else t.resolve(1)},function(e){alert(e),t.resolve(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};if(!t.msg)return void l.showToast("发送消息不能为空");r.sendMsg(t).then(function(o){if(o){var i={message:t.msg,companyId:void 0};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(t){var i={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:t,desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(i).then(function(t){if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var i={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(i).then(function(e){if(e);o.goBack()},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.transferTo=1,e.transferChat=function(){var t={cmd:"transferChat",c:e.csId,v:e.uuID,chatId:e.chatId,transNum:1,aId:e.transferTo};r.transferChat(t).then(function(t){t&&t.data?"success"==t.data.result?(e.chatId=t.data.chat1,e.csId=e.transferTo):alert("transfer chat  server response error ！！！"):alert("transfer chat  net error ！！！")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(e){u.getPicture(e,f,h)},e.play=function(){var e=document.getElementById("audioInCC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInCC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInCC","audioInCC")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),u.stopCapture("sourceInCC","audioInCC",e.transfer)},e.transfer=function(){var t=r.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,i.data.message="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(i.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};r.addEvent(s).then(function(t){t?n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败"),e.loopGetMsg()})},y=function(t){alert("上传失败"),e.loopGetMsg()};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("content");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.sendLink=function(t){var o=JSON.stringify(t),i="$prodLink"+o,s={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:i};if(!s.msg)return void l.showToast("发送消息不能为空");r.sendMsg(s).then(function(t){if(t){var o={message:s.msg,companyId:void 0};r.filtMsg(o),e.messages.push(o),e.CustumerParam.msg=void 0}else l.showToast("发送消息失败")},function(e){})},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.isPlaying=!1,"back"==i.direction||(e.productObjs=[],e.init()),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",I),window.addEventListener("native.keyboardhide",$),u.addAudioEventOnWindow()});var T=void 0;e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",I),window.removeEventListener("native.keyboardhide",$)}),e.$on("play-sound-ended",function(t,o){for(var i=0;i<e.messages.length;i++)e.messages[i].imageUrl===o.id.src&&i<e.messages.length-1&&".wav"===e.messages[i+1].fileType&&e.$broadcast("play-sound-next",{id:e.messages[i+1].imageUrl})}),e.goBack=function(){e.isPlaying||e.isOffLine||(e.actSheet=d.show({buttons:[{text:"<b>非常满意</b> "},{text:"<b>比较满意</b> "},{text:"<b>一般</b> "},{text:"<b>不满意</b> "}],titleText:"评价客服",cancelText:"取消",cancel:function(){},buttonClicked:function(t){return e.opinion(t),!0}}))}}]),APP.service("CustomerConversationService",["$http","UrlService","$sce",function(e,t,o){function i(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+n[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+n[t]+'.png" />')}var s="http://123.56.3.136:8182";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke/",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8182/msg.dll",t)},this.getUUID=function(){return e.get(s+"/getVistorId.dll")},this.opinion=function(t){return e.get(s+"/msg.dll",t)},this.endChat=function(t){return e.get(s+"/msg.dll",t)},this.transferChat=function(t){return e.get(s+"/msg.dll",t)},this.addEvent=function(t){return e.get(s+"/msg.dll",t)},this.filtMsg=function(e){if("EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0),e.message&&e.message.indexOf("$prodLink")>-1)e.message="已经发送了 商品链接";else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("http")>-1&&e.message.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.message;else if(e.message&&e.message.indexOf("[")>-1&&e.message.indexOf("]")>-1)for(var t=1;t<16;t++)e.message=i(e.message,t)};var n=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.getUploadUrl=function(){return s+"/receive3.jsp"}}]),APP.directive("resizeFootBar",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content"),n=e.$getByHandle("ccScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),
APP.controller("GroupSettingController",["$scope","GroupSettingService","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","UserService","PopupService","CircleGroupDiscussService","$ionicModal","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.isShowName=!0,e.confirmData={groupName:"",groupMax:"0"};var g={userGag:0,userId:"test",userState:"0",userName:"我是路飞",userImg:"http://cdn21test.ehaier.com:8080/file/58648050246126ab1e39f3e8.png"},m={userGag:1,userId:"test",userState:"1",userName:"我不是是路飞",userImg:"https://git.oschina.net/uploads/80/436680_xu6767.png"};e.groupId;var f=c.getUser();e.token=f.sessionValue,e.groupUsers=[g,m,g,m,g,m,g,m,g,m,g,m],e.groupDesp={},e.groupSetting={yes:!1,userId:void 0};var h=window.innerWidth;e.jinyanHover={top:"5px",left:.1*h-21-1.5+"px"},e.groupInfo,e.query=function(){var o={groupId:e.groupId,token:e.token};t.query(o).success(function(t){t&&t.userInfo&&(e.groupUsers=t.userInfo)},function(e){alert("查询群组成员失败")})},e.init=function(){e.query(),e.queryGroup()},e.delGroupUser=function(o){var i={userId:o.userId,groupId:e.groupId};t.deleteGroupUser(i).then(function(t){t&&(l.showToast("删除用户成功"),e.query())},function(e){alert("net error--- delGroup  failed")})},e.getAllMsg=function(){var t={c:"getGroupMsg",groupId:e.groupId,token:e.token};d.getAllMsg(t).then(function(t){t&&t.data?e.historyMsgs=t.data.rows:l.showToast("获得讨论组列表失败")},function(e){alert("net error--- delGroup  failed")})},e.getMsgByMun=function(){var t={beginMun:0,groupId:e.groupId,endMun:1e3,token:e.token};d.getMsgByMun(t).then(function(e){if(e);},function(e){alert("net error--- delGroup  failed")})},u.fromTemplateUrl("templates/quanzi/groupName.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.groupName=t}),e.openName=function(){e.isShowName=!0,e.groupName.show()},e.closeName=function(){e.groupName.hide()},e.openMaxRecord=function(){e.isShowName=!1,e.groupName.show()},e.queryGroup=function(){var o={companyId:f.mid,groupId:e.groupId,token:e.token};t.queryGroup(o).then(function(t){t.data&&t.data.rows&&(e.groupInfo=t.data.rows[0],e.groupDesp=JSON.parse(e.groupInfo.desp))},function(e){alert("net error--- delGroup  failed")})},e.upDateGroup=function(){var o;if(e.confirmData.groupName){var i=JSON.parse(e.groupDesp);o={id:e.groupId,desp:"{}",token:i,groupName:e.confirmData.groupName}}if(e.confirmData.groupMax){if(!angular.isNumber(e.confirmData.groupMax))return void l.showToast("请输入一个秒数");e.groupDesp.timeSet=e.confirmData.groupMax;var i=JSON.parse(e.groupDesp);o={id:e.groupId,desp:i,token:e.token,groupName:e.confirmData.groupName}}if(!o)return void l.showToast("输入不能为空");t.updateGroup(o).then(function(t){t&&(l.showToast("更改讨论组信息成功"),e.queryGroup())},function(e){alert("net error--- addGroupUser  failed")})},e.queryGroupByMemberId=function(){var o={userId:f.mid,token:e.token};t.queryGroupByMemberId(o).then(function(e){},function(e){alert("net error--- addGroupUser  failed")})},e.addGroupUser=function(){e.groupSetting.userId||l.showToast("请输入合法的用户Id");var o={userId:e.groupSetting.userId,groupId:e.groupId};t.updateGroupUser(o).then(function(t){t&&(l.showToast("添加成员成功"),e.query())},function(e){alert("net error--- addGroupUser  failed")})},e.gagGroupUser=function(o){var i;if("null"===o.userGag||"0"===o.userGag)i=1;else{if("1"!=o.userGag)return;i=0}var s={userId:o.userId,userGagType:i,groupId:e.groupId};t.gagGroupUser(s).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.gagAll=function(){var o={groupGagType:e.groupSetting.yes?1:0,groupId:e.groupId};t.getGroupGag(o).then(function(t){t&&(l.showToast("gagAll"),e.query())},function(e){alert("net error--- gagAll  failed")})},e.$on("$ionicView.beforeEnter",function(){e.groupId=p.groupId,e.circleId=p.circleId,e.groupId||l.showAlert("严重错误","没有讨论组Id！！！"),e.init()}),e.tabSelected=!0,e.switchTab=function(){e.tabSelected=!e.tabSelected},e.createGroup=function(){t.createGroup("admin","讨论组名字","讨论组介绍信息").success(function(t){e.groupId=t.groupId})},e.deleteGroup=function(){t.deleteGroup(e.groupId).success(function(e){})},e.toGroupEditMember=function(){n.go("groupEditMember",{groupId:e.groupId})},e.toGroupAddMember=function(){n.go("groupAddMember",{groupId:e.groupId,circleId:e.circleId})}}]),APP.service("GroupSettingService",["$http",function(e){var t="http://123.56.3.136:8180/Service/chatGroup";this.register=function(t){return e.get("http://123.56.3.136:8180/Service/Company/addApi",t)};this.query=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/queryGroupUser",params:t})},this.queryGroup=function(o){return e({method:"POST",url:t+"/queryGroup",params:o})},this.queryGroupByMemberId=function(o){return e({method:"POST",url:t+"/queryChatGroupUserId",params:o})},this.updateGroup=function(o){return e({method:"POST",url:t+"/updateChatGroupDesp",params:o})},this.filtGroup=function(e){};this.deleteGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/deleteGroupUser",params:t})};this.gagGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/getGroupUserGag",params:t})};this.updateGroupUser=function(t){return e({method:"POST",url:"http://123.56.3.136:8180/Service/chatGroup/updateGroupUser",params:t})};this.getGroupGag=function(t){return e({method:"POST",url:"http://172.16.63.96:8080/console/Service/chatGroup/getGroupGag",params:t})};this.createGroup=function(t,o,i){return e({method:"POST",url:url,params:"http://172.16.63.98:8080/console/Service/chatGroup/getCreateGroupChat"})},this.deleteGroup=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/console/Service/chatGroup/getCloseGroupChat",params:{id:t}})}}]),APP.controller("GroupAddMemberController",["$scope","$stateParams","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","CirclePageService","$q",function(e,t,o,i,s,n,a,r,c,l,d,u,p){e.input={keywords:""},e.iconShow=!0,e.members=[],e.groupId=t.groupId;var g=l.getUser();e.token=g.sessionValue,e.circleId=408,e.members=[],e.membersHead=[],e.membersCommon=[],e.membersAdded=[],e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.getCircleMembers=function(){var t=p.defer(),o={topicId:e.circleId};return u.circleMembers(o).success(function(o){o.success?(e.membersCommon=o.data.list,e.membersHead=o.data.list1,t.resolve(1)):(d.showToast("获取圈子成员失败"),t.reject(1))}),t.promise},e.query=function(){var t={groupId:e.groupId,token:e.token};c.query(t).success(function(t){if(t&&t.userInfo){e.membersAdded=t.userInfo;for(var o=0;o<e.membersHead.length;o++){for(var i=!1,s=e.membersHead[o].memberId,n=0;n<e.membersAdded.length;n++)if(s==e.membersAdded[n].userId){i=!0;break}if(!i){var a={};a.idCate=0,a.imageFile=e.membersHead[o].img,a.nickName=e.membersHead[o].userName,a.userId=e.membersHead[o].memberId,a.userGag="0",a.userState=1,e.members.push(a)}}for(var r=0;r<e.membersCommon.length;r++){for(var c=!1,s=e.membersCommon[r].id,l=0;l<e.membersAdded.length;l++)if(s==e.membersAdded[l].userId){c=!0;break}if(!c){var a={};a.idCate=0,a.imageFile=e.membersCommon[r].userImg,a.nickName=e.membersCommon[r].userName,a.userId=e.membersCommon[r].id,a.userGag="0",a.userState=1,e.members.push(a)}}}},function(e){alert("查询群组成员失败")})},e.$on("$ionicView.beforeEnter",function(){e.members=[],e.groupId=t.groupId,e.circleId=t.circleId,e.getCircleMembers().then(function(){e.query()})}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){for(var t=[],o=0;o<e.members.length;o++)e.members[o].isSelected&&t.push(e.members[o]);for(var i=function(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=i(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=i(e[o]);return t}return e},s=i(t),n=0;n<s.length;n++)delete s[n].$$hashKey,delete s[n].isSelected;var a=JSON.stringify(s),r={groupMembers:a,groupId:e.groupId,token:e.token};c.updateGroupUser(r).then(function(t){t&&(d.showToast("添加成员成功"),e.getCircleMembers().then(function(){e.query()}))},function(e){alert("net error--- add group Members ---failed")})}}]),APP.service("GroupAddMemberService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("GroupEditMemberController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){e.input={keywords:""},e.iconShow=!0;var m=c.getUser();e.token=m.sessionValue,e.groupId=g.groupId,e.query=function(){var t={groupId:e.groupId,token:e.token};e.members=[],r.query(t).success(function(t){t&&t.userInfo&&(e.members=t.userInfo)},function(e){alert("查询群组成员失败")})},e.members=[],e.init=function(){var t=c.getUser();e.token=t.sessionValue,e.query()},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t},e.search=function(){if(e.input.isInput)for(var t=0;t<e.members.length;t++)-1===e.members[t].nickName.indexOf(e.input.isInput)&&(e.members[t].hidden=!0);else for(var t=0;t<e.members.length;t++)e.members[t].hidden=!1},e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.gagOrNo=function(t){for(var o="",i=0;i<e.members.length;i++)e.members[i].isSelected&&(o=o+e.members[i].userId+",");o=o.substr(0,o.length-1);var s=t,n={userId:o,userGagType:s,groupId:e.groupId,token:e.token};r.gagGroupUser(n).then(function(t){t&&(l.showToast("禁言成功"),e.query())},function(e){alert("net error--- gagGroupUser  failed")})},e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.$on("$ionicView.beforeEnter",function(){e.groupId=g.groupId,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("GroupsToShareController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupAddMemberService","UserService","PopupService","$ionicActionSheet","MediaService","GroupSettingService","CircleGroupDiscussService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){e.input={keywords:""},e.iconShow=!0,e.members=[],e.shareListStr=void 0,e.isAllSelected=!1,e.chooseOne=function(t){t.isSelected?t.isSelected=!1:t.isSelected=!0,e.checkMembers()?e.isAllSelected=!0:e.isAllSelected=!1},e.isAllSelected=!1,e.chooseAll=function(){if(e.isAllSelected){for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!1;e.isAllSelected=!1}else{for(var t=0;t<e.members.length;t++)e.members[t].isSelected=!0;e.isAllSelected=!0}},e.checkMembers=function(){for(var t=!0,o=0;o<e.members.length;o++)if(!e.members[o].isSelected){t=!1;break}return t};var m=c.getUser();e.groupId=55,e.token=m.sessionValue,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.search=function(e){},e.init=function(){var t=c.getUser();e.token=t.sessionValue;var o={userId:t.mid,token:e.token};p.queryGroupByMemberId(o).then(function(t){if(t&&t.data){for(var o=0;o<t.data.rows.length;o++)try{t.data.rows[o].despObj=JSON.parse(t.data.rows[o].desp)}catch(e){t.data.rows[o].despObj={}}e.members=t.data.rows}else l.showToast("获得讨论组列表失败")})},e.$on("$ionicView.beforeEnter",function(){e.shareListStr=i.shareList,e.init()}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()},e.addGroupMebers=function(){var t={groupMembers:'[{"userId":"138307014","idCate":"0","nickName":"cao138307014","imageFile":"www.baidu.com"},{"userId":"138990945","idCate":"0","nickName":"15648756478","imageFile":"www.baidu.com"}]',groupId:e.groupId,token:e.token};r.addMembers(t).then(function(e){e&&l.showToast("添加成员成功")},function(e){alert("net error--- add group Members ---failed")})},e.sendToGroups=function(){for(var t="",o=0;o<e.members.length;o++)e.members[o].isSelected&&(t=t+e.members[o].groupId+",");if(!t)return void alert("no chooesed");t=t.substr(0,t.length-1);var i={c:"sendGroupMsg",groupId:t,msg:e.shareListStr,msgType:1,token:e.token};g.sendMsg(i).then(function(e){e||l.showToast("发送消息失败--发送音频后")},function(e){})}}]),APP.service("GroupsToShareService",["$http","UrlService","$sce",function(e,t,o){this.getMemberList=function(t){return e.get("http://172.16.63.134:8080"+webapp+"msg.dll",t)},this.addMembers=function(t){return e({method:"POST",url:"http://172.16.63.134:8080/console/Service/chatGroup/updateGroupUser",params:t})}}]),APP.controller("MessageDetailsController",["$scope","$state","$stateParams","SelectTagsService",function(e,t,o,i){}]),APP.service("MessageDetailsService",["$http","UrlService",function(e,t){}]),APP.controller("MyCirclePagesController",["$scope","$rootScope","$state","MyCirclePagesService",function(e,t,o,i){e.myTopics="",e.myCreatTopics="",e.input={keywords:""},e.iconShow=!0,e.inputIconHide=function(){e.iconShow=!1},e.inputIconIfShow=function(){e.input.isInput.length?e.iconShow=!1:e.iconShow=!0},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.input={keywords:""},e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo()},e.search=function(t){e.getMyCreatTopicInfo(t.target.value),e.getMyJoinedCircleInfo(t.target.value),window.cordova&&cordova.plugins.Keyboard.close()},e.viewTopic=function(e){o.go("circlePage",{circleId:e})},e.reviewApplyCircle=function(e){t.reviewCircleId=e,o.go("applyCircle")},e.clickIn=function(e,i){0==i?o.go("circlePage",{circleId:e}):2==i?(t.showApplyTag=1,t.reviewCircleId=e,o.go("applyCircle")):(t.reviewCircleId=e,o.go("applyCircle"))},e.getMyCreatTopicInfo=function(t){var o={keywords:t};i.getMyCreatTopics(o).then(function(t){e.myCreatTopics=t.data.data.list},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};i.getMyJoinedTopics(o).then(function(t){e.myTopics=t.data.data.list},function(e){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyCirclePagesService",["$http","UrlService",function(e,t){this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("MYCREATE_TOPIC"),data:o})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("MYJOINED_TOPIC"),data:o})}}]),APP.controller("MyLessonesController",["$scope","$state","MyCirclePagesService",function(e,t,o){e.goBack=function(){e.$ionicGoBack()},e.init=function(){},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("MyLessonesService",["$http","UrlService",function(e,t){this.getMyTopics=function(o){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:o})}}]),APP.directive("comImageBox",["$rootScope","$ionicActionSheet","PopupService","CreditService","$timeout",function(e,t,o,i,s){return{restrict:"E",template:'<div class="LightBox" style="display:none;" ><div class="ImgViewer" on-tap="hideBigImage($event)"><img src="{{Url}}"></div></div>',transclude:!1,templateNamespace:"html",scope:!1,link:{pre:function(t,o,i,n){function a(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;x=t[0].clientX,D=t[0].clientY,b=T,A=C,N=0,_=0}function r(e){var t=e.originalEvent?e.originalEvent.touches:e.touches,i=T-u*S/2+g/2,s=g-(i+u*S),n=C-p*S/2+m/2,a=m-(n+p*S);""===f&&(1===t.length?f="swipe":2===t.length&&(f="pinch",w=S,v=l(t),P=t[0].clientX-parseInt((t[0].clientX-t[1].clientX)/2,10)-o.find("img")[0].offsetLeft-b,L=t[0].clientY-parseInt((t[0].clientY-t[1].clientY)/2,10)-o.find("img")[0].offsetTop-A)),"swipe"===f?(e.preventDefault(),N=t[0].clientX-x,_=t[0].clientY-D,T=b+N,C=A+_,d(),i>0&&s>0&&(T=0,d()),n>0&&a>0&&(C=0,d())):"pinch"===f&&(e.preventDefault(),h=l(t),I=h/v,S=I*w,T=P*(1-I)+b+N,C=L*(1-I)+A+_,d(),T=0,C=0,d())}function c(e){var t=e.originalEvent?e.originalEvent.touches:e.touches;if(!(""===f||t.length>0)){S<1?(S=1,T=0,C=0):S>y&&(S=y,I=S/w,T=P*(1-I)+b+N,C=L*(1-I)+A+_);var o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S);o>0&&i<0?(T=u*S/2-g/2,d()):o<0&&i>0&&(T=g/2-u*S/2,d()),s<0&&n>0?(C=m/2-p*S/2,d()):s>0&&n<0&&(C=p*S/2-m/2,d()),o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S),s>0&&n>0&&(C=0,d()),o>0&&i>0&&(T=0,d()),o=T-u*S/2+g/2,i=g-(o+u*S),s=C-p*S/2+m/2,n=m-(s+p*S),d(.1),f=""}}function l(e){var t=Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2));return parseInt(t,10)}function d(e){var t=e?"all cubic-bezier(0,0,.5,1) "+e+"s":"",i=[S,0,0,S,T,C],s="matrix("+i.join(",")+")";o.find("img").css({"-webkit-transition":t,transition:t,"-webkit-transform":s+" translate3d(0,0,0)",transform:s})}var u,p,g,m,f="",h=0,v=0,S=(!!window.cordova&&ionic.Platform.platform().indexOf("ios"),1),I=1,w=1,y=parseInt(i.maxScale,10);(isNaN(y)||y<=1)&&(y=20);var T=0,C=0,b=0,A=0,P=0,L=0,x=0,D=0,N=0,_=0;g=$(".LightBox").width(),m=$(".LightBox").height(),t.Url="",t.bigImage=!1,t.noreload=!1,t.showBigImage=function(i,s){"VIDEO"!=i.target.tagName&&void 0!=i.target.currentSrc&&(i.stopPropagation(),t.Url=i.target.currentSrc,e.picBigUrl=t.Url,t.bigImage=!0,$(".LightBox").show(150,function(){$("ion-header-bar").hide(),$(".Main .tab-nav").hide(),$(".LightBox .ImgViewer img").each(function(){$(this).css({width:"90%"}),u=$(this).width(),p=$(this).height(),$(this).css({marginLeft:u/2*-1,marginTop:p/2*-1})})}),o.find("img").on("touchstart",a),o.find("img").on("touchmove",r),o.find("img").on("touchend",c))},t.hideBigImage=function(){t.bigImage=!1,t.noreload=!0,s(function(){t.noreload=!1},500),$("ion-header-bar").show(),$(".Main .tab-nav").show(),$(".LightBox").hide(200),f="",h=0,v=0,S=1,I=1,w=1,y=parseInt(i.maxScale,10),(isNaN(y)||y<=1)&&(y=20),T=0,C=0,b=0,A=0,P=0,L=0,x=0,D=0,N=0,_=0,d()}},post:function(e,t,o,i){}}}}]),APP.directive("myfocus",["$timeout","$parse",function(e,t){return{link:function(o,i,s){var n=t(s.myfocus);o.$watch(n,function(t){!0===t?e(function(){i[0].focus()}):!1===t&&e(function(){i[0].blur()})})}}}]),APP.filter("trusted",["$sce",function(e){return function(t){return"string"==typeof t?e.trustAsHtml(t):t}}]),APP.controller("NoteDetailsController",["ionicDatePicker","HomePageService","$scope","$ionicHistory","$rootScope","$compile","$state","$ionicModal","$stateParams","$http","NoteDetailsService","$ionicLoading","$ionicPopup","$ionicScrollDelegate","ApplyCircleService","$timeout","$ionicActionSheet","PopupService","UrlService","UserService","CreditService","PlatformService","$location",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,w,y,T){function C(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}self.touchStart=function(e){if(self.startCoordinates=getPointerCoordinates(e),!ionic.tap.ignoreScrollStart(e)){if(ionic.tap.containsOrIsTextInput(e.target))return void(self.__hasStarted=!1);self.__isSelectable=!0,self.__enableScrollY=!0,self.__hasStarted=!0,self.doTouchStart(e.touches,e.timeStamp)}},o.isDisplay=!1,o.inputShow=!0,o.praiseNum={},o.commentId="",o.circleId,o.circleDetail,o.commentList,o.products="",o.iconImageData=[],o.imgUrlList=[],o.isImage=!1,o.showBigImg=!1,o.showBac=!1,o.imgString="",o.isPublishImage=!1,o.imgA=[],o.showBigBac=!1,o.shanList="",o.commentIndex=1,o.commentWords={words:""},o.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],o.pinglunis=!1,o.topicheight=0,o.comment={text:"",rows:1},o.noteDetail={reply:"说点什么"},o.$watch("noteDetail.reply",function(e,t,o){}),o.goBack=function(){o.$ionicGoBack(),s.nextPageBefore="noteDetails"},o.goshare=function(){if(!I.getUser().mid)return void a.go("login");o.showShare=!o.showShare,o.isDisplay=!1,d.getShop().success(function(e){e.success&&e.data?o.shareUserId=o.userId:o.shareUserId=null})},o.inCirclePage=function(e){a.go("circlePage",{circleId:e})},o.inPersonalPage=function(e){0!=e&&(e==I.getUser().mid?a.go("personalHomepageMe"):a.go("personalHomepageHe",{othersId:e}))},o.goShop=function(){a.go("myStore",{storeId:o.userId,shareStoreId:""})},o.jumpMsg=function(){a.go("ClassifyMessageCenter")},o.isClick=function(){o.isDisplay=!o.isDisplay},o.downLoadPhoto=function(e){o.photoUrl=s.picBigUrl,s.isApp&&(s.isIOS?h.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){s.$broadcast("LOADING:SHOW"),cordova.plugins.saveToPhotoAlbum.save(s.picBigUrl,function(e){v.showToast("保存成功")},function(e){v.showToast("保存失败")})}}):h.show({buttons:[{text:"保存图片到本地"}],cancelText:"取消",cancel:function(){},buttonClicked:function(){s.$broadcast("LOADING:SHOW");var e=new FileTransfer,t=encodeURI(o.photoUrl);return e.download(t,cordova.file.externalRootDirectory+"DCIM/Camera/"+(new Date).getTime()+".jpg",function(e){s.$broadcast("LOADING:HIDE"),v.showToast("保存成功")},function(e){s.$broadcast("LOADING:HIDE"),v.showToast("保存失败，请稍后再试")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),!0}}))},o.bigvideo=function(e){s.globalConstant.showvideo=!0,f(function(){$(".video-src1").attr("src",o.video)},100)},o.hideVideo=function(e){e.target.previousElementSibling.pause(),s.globalConstant.showvideo=!1},o.playing=function(e){e.target.style.display="none",e.target.nextElementSibling.play(),o.targetv=e.target.nextElementSibling,o.targetv.addEventListener("ended",function(){e.target.style.display="block"})},o.editTopic=function(){1==o.circleDetail.isReward?1==o.circleDetail.rewardStatus?v.showToast("该悬赏贴已关闭，不能修改"):o.commentList.length>0?v.showToast("该悬赏贴已有评论，不能修改"):a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:2}):o.video?a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:3}):a.go("publishEdit",{topicId:o.circleDetail.topicId,noteId:o.circleId,isShortStory:o.ifShort,topicStyle:1})},o.showCommentView=function(e){o.commentId=e;p.show({template:'<input type="text" ng-model="commentWords.words" class="bg-background">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:o,buttons:[{text:"取消"},{text:"<b>提交</b>",type:"button-positive",onTap:function(){o.isOne&&(o.isOne=!1,o.insertComments())}}]});f(function(){},3e3)},o.isInputShow=function(){o.inputShow=!o.inputShow},o.pinglunshow=function(){var e=g.$getByHandle("pinglun"),t=e.getScrollPosition(),i=t.top,s=window.innerHeight-118;o.topicheight=document.getElementById("topicxiang").clientHeight-s,f(function(){o.pinglunis=i>o.topicheight},200)},o.addImage=function(){h.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function i(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},o.xiaoxishow=function(){o.xxshow=0!=o.count.count,o.isshow=!o.isshow,o.xiaoxis=!o.xiaoxis,o.shuxiaoxi=!o.shuxiaoxi},o.favorite=function(){var e={id:o.circleId};d.pushPraise(e).success(function(e){})},o.getCircleDetails=function(){var e={id:o.circleId};d.getCircleDetails(e).success(function(e){o.circleDetail=e.data,o.circleDetail.mediaInfo&&(o.video=o.circleDetail.mediaInfo[0].url,f(function(){$(".video-src").attr("src",o.video),$(".video-src").attr("poster",o.circleDetail.mainImg)},200)),o.circleDetail.rewardEndTime&&(o.circleDetail.rewardEndTime=o.circleDetail.rewardEndTime.substring(0,10)),o.circleDetail.rewardComment&&(o.circleDetail.rewardComment[0].imgaa=o.circleDetail.rewardComment[0].commentImgs.split(",")),o.imgArr=[];for(var t=1;t<=o.circleDetail.mainImgArray.length;t++)o.imgArr.push(t);o.whichPersonType(),1==o.ifShort&&o.circleDetail.productId&&o.productConnect(),o.getA()})},o.follow=function(e){if(0==e){var t={id:o.circleDetail.userCode,isFollow:1};d.followNote(t).success(function(e){1==e.success?(o.circleDetail.isFolled=1,o.alreadyFollow=!0,f(function(){o.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(v.showToast(e.message),s.loginIsAccord2=!0)})}else if(1==e){var t={id:o.circleDetail.userCode,isFollow:0};d.followNote(t).success(function(e){1==e.success?o.circleDetail.isFolled=0:-2e3==e.errorCode&&(v.showToast(e.message),s.loginIsAccord2=!0)})}},o.getComment=function(){o.commentIndex=1;var e=C("loginId"),t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:1,pageSize:10,id:o.circleId,userCode:i?o.weChatOpenId:e};d.getComments(s).success(function(e){o.commentNumbers=e.totalCount,o.commentList=e.data.list,o.commentNumbers>10&&(o.hasmore=!0),o.imgString="",o.imgA=[];for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1,o.commentList[t].commentImgs&&(o.imgString=o.commentList[t].commentImgs,o.imgA=o.imgString.split(","),o.commentList[t].imgaa=o.imgA);g.resize()})},o.loadMore=function(){o.commentIndex=o.commentIndex+1;var e=C("loginId"),t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),s={pageIndex:o.commentIndex,pageSize:10,id:o.circleId,userCode:i?o.weChatOpenId:e};d.getComments(s).success(function(e){o.commentNumbers=e.totalCount,o.commentList=o.commentList.concat(e.data.list),o.commentNumbers>o.commentList.length?o.$broadcast("scroll.infiniteScrollComplete"):(o.hasmore=!1,v.showToast("没有更多评论了")),o.imgString="",o.imgA=[];for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1,o.commentList[t].commentImgs&&(o.imgString=o.commentList[t].commentImgs,o.imgA=o.imgString.split(","),o.commentList[t].imgaa=o.imgA)})},o.getFocus=function(e,t,i){event.stopPropagation();for(var s=0;s<o.commentList.length;s++)o.commentList[s].ischecked=!1;o.commentWords.words="",o.iconImageData=[],o.isPublishImage=!0,o.showBac=!0,o.commontId=e,o.toSomeone="回复给："+t,setTimeout(function(){document.getElementById("inputId").focus()},200)},o.focuss=function(){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,o.isPublishImage=!0,o.showBac=!0,o.iconImageData.length>0&&(o.isImage=!0)},o.deleteImg=function(e){o.iconImageData.splice(e,1)},o.showLarge=function(e){o.showBigBac=!0,o.showBigImg=!0,o.Url=e},o.closeBigImg=function(){o.showBigImg=!1,o.showBigBac=!1},o.closeImg=function(){o.images=!1,o.isImage=!1,o.isPublishImage=!1,o.showBac=!1},o.imgPush=function(e){if(o.isImage=!0,o.iconImageData.length>=9)return void v.showToast("最多添加9张");h.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){var t={imgUrl:e};f(function(){o.iconImageData.push(t),o.existPhoto=!0},200)}function i(){}if(0==e)return navigator.camera.getPicture(t,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==e){var s=9-o.iconImageData.length;return window.imagePicker.getPictures(function(e){for(var t=0;t<e.length;t++){var i={imgUrl:e[t]};o.iconImageData.push(i)}o.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},o.insertCom=function(e){t.isWdHost().success(function(t){if(s.isWdHost=t.data.isHost,-1==s.isWdHost)a.go("login");else if(window.cordova&&(s.gio.track("comment",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId})),"IMG"==e.target.nodeName)if(o.commontId){var i={commentId:o.commontId,commentImgs:e.target.src,id:o.circleId};o.insertCommentOK(i)}else{var i={commentImgs:e.target.src,id:o.circleId};o.insertCommentOK(i)}})},o.insertComments=function(){t.isWdHost().success(function(e){if(s.isWdHost=e.data.isHost,-1==s.isWdHost)a.go("login");else{window.cordova&&(s.gio.track("comment",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId}));var t=0;if(o.commentWords.words){var i={keywords:o.commentWords.words};m.judgeWords(i).success(function(e){"没有敏感词"==e.message?0==o.iconImageData.length?(o.iconImageData=[],o.imgUrlList=[],o.publishTopic()):angular.forEach(o.iconImageData,function(e,i){var s=function(e){u.hide(),t++;var s=JSON.parse(e.response),n=s.urls;o.imgUrlList[i]=n,t==o.iconImageData.length&&o.publishTopic()},n=function(e){u.hide()},a={},r=new FileTransfer;r.upload(e.imgUrl,encodeURI(d.uploadImage()),s,n,a)}):(v.showToast("存在敏感词",e.data),o.commentWords.words="")})}else v.showToast("内容不能为空")}})},o.nocommontId=function(){o.isDisplay=!1;for(var e=0;e<o.commentList.length;e++)o.commentList[e].ischecked=!1;o.commontId&&(o.commontId="",o.toSomeone="",o.commentWords.words="",o.iconImageData=[])},o.publishTopic=function(e){if(o.commontId){var e={comment:o.commentWords.words,commentId:o.commontId,commentImgs:o.imgUrlList.toString(),id:o.circleId};o.insertCommentOK(e)}else{var e={comment:o.commentWords.words,commentImgs:o.imgUrlList.toString(),id:o.circleId};o.insertCommentOK(e)}},o.insertCommentOK=function(e){d.insertComment(e).success(function(e){o.getComment(),1==e.success?(v.showToast("回复成功"),o.commentWords.words="",o.commontId="",o.toSomeone="",o.iconImageData=[],o.imgUrlList=[],o.isImage=!1,o.isPublishImage=!1,o.showBac=!1,o.images=!1,o.haierImg=!1,o.shunguangImg=!1):(f(function(){v.showToast(e.message)},200),o.commentWords.words="")}).error(function(e){v.showToast("网络异常"),o.commentWords.words=""})},o.topicPraise=function(e){window.cordova&&(s.gio.track("like",{circleID:o.circleDetail.topicId}),s.gio.track("active",{circleID:o.circleDetail.topicId}));var t=window.navigator.userAgent.toLowerCase(),i="micromessenger"==t.match(/MicroMessenger/i),n=C("loginId"),a={id:e,noLoading:!0,userCode:i?o.weChatOpenId:n};d.pushPraise(a).success(function(e){1==e.success?(o.isPraise=!o.isPraise,o.getStoryPraiseNum()):v.showToast(e.message)})},o.topicFavorite=function(e){var t={id:e,noLoading:!0};d.topicFavorite(t).success(function(e){1==e.success?(o.isFavorite=!o.isFavorite,o.getStoryPraiseNum()):-2e3==e.errorCode?(v.showToast(e.message),s.loginIsAccord2=!0):v.showToast(e.message)})},o.goToScore=function(e){if("IMG"==e.target.tagName&&(o.noreload||o.showBigImage(e)),$(".longtopic a").addClass("atopic"),$(".longtopic a").removeAttr("href"),$(".noteContent a").removeAttr("href"),"linklink dot-block"==e.target.className)if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else{var t=e.target.outerText;o.tolink(t)}else if("all-to"==e.target.className)if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;o.tolink(t)}else{var t=e.target.outerText;o.tolink(t)}else if("atopic"==e.target.className){if(e.target.attributes["data-a"]){var t=e.target.attributes["data-a"].value;o.tolink(t)
}else if(e.target.attributes.dataa){var t=e.target.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.className){if(e.target.parentNode.attributes["data-a"]){var t=e.target.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.attributes.dataa){var t=e.target.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.className){if(e.target.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.className){if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}}else if("atopic"==e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.className)if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"]){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes["data-a"].value;o.tolink(t)}else if(e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.attributes.dataa.value;o.tolink(t)}},o.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==y.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==y.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.getA=function(){f(function(){$(".detailEditor .editor a").html(function(e,t){if(!this.attributes["data-a"])return t;if(this.attributes["data-a"].value){this.setAttribute("href",this.attributes["data-a"].value);var i=this.attributes["data-a"].value;return'<div class="all-to"><img class="imgimg" src="'+o.imgBaseURL+'/img/link.png"/><span class="linklink dot-block">'+i+"</span></div>"}})},20),f(function(){$(".detailEditor .editor div").removeAttr("contenteditable"),$(".detailEditor .editor div").addClass("copy")},30),f(function(){$(".longtopic a").each(function(e){$(this).attr("dataa")||$(this).attr("dataa",this.href)})},100),f(function(){$(".detailEditor .editor .imgHeight").css({height:"auto",width:"auto","background-image":"none"}),$(".detailEditor .editor .imgHeight img").css({width:"100%",display:"block"}),$(".detailEditor .editor .imgHeight span").css({display:"none"}),$(".detailEditor .editor span").css("font-size","12px")},60)},o.topicShan=function(e){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,1==o.circleDetail.isReward?v.showToast("该话题是悬赏话题，不能被打赏"):(o.showShan=!0,o.goldNum(),e?o.shanCommentId=e:(o.shanCommentId="",o.shanTopicId=o.circleId))},o.selectImg=function(){o.images=!0,o.haierImg=!0,o.shunguangImg=!1,o.yearImg=!1},o.selectHaier=function(){o.haierImg=!0,o.shunguangImg=!1,o.yearImg=!1},o.selectshun=function(){o.haierImg=!1,o.shunguangImg=!0,o.yearImg=!1},o.selectYear=function(){o.haierImg=!1,o.shunguangImg=!1,o.yearImg=!0},o.deleteShan=function(){o.reward.num="";for(var e=0;e<o.shanNum.length;e++)o.shanNum[e].isChecked=!1;o.shanGoldNum="",o.showShan=!1},o.clickMore=function(e){if(o.isDisplay=!1,o.commentList[e].ischecked)for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;else{for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;o.commentList[e].ischecked=!0}},o.toRewardList=function(){a.go("topicRewardList",{tipId:o.circleId})},o.selectGod=function(e){if(o.reward.num="",o.shanNum[e].isChecked){for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.shanGoldNum=""}else{for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.shanNum[e].isChecked=!0,o.shanGoldNum=o.shanNum[e].num}},o.otherGoldNum=function(){for(var e=0;e<o.shanNum.length;e++)o.shanNum[e].isChecked=!1;o.shanGoldNum=o.reward.num},o.noticeDownload=function(){s.downAppUrl||v.showToast("不支持该手机")},o.commentPraise=function(e,t){var i=window.navigator.userAgent.toLowerCase(),s="micromessenger"==i.match(/MicroMessenger/i),n=C("loginId"),a={commentId:e.id,noLoading:!0,userCode:s?o.weChatOpenId:n};d.commentPraise(a).success(function(i){if(1==i.success){if(o.circleDetail.rewardComment){if(e.id==o.circleDetail.rewardComment[0].id){o.circleDetail.rewardComment[0].commentPraiseNumberFlag=!o.circleDetail.rewardComment[0].commentPraiseNumberFlag;for(var s=0;s<o.commentList.length;s++)e.id==o.commentList[s].id&&(o.commentList[s].commentPraiseNumberFlag=!o.commentList[s].commentPraiseNumberFlag)}}else for(var s=0;s<o.commentList.length;s++)e.id==o.commentList[s].id&&(o.commentList[s].commentPraiseNumberFlag=!o.commentList[s].commentPraiseNumberFlag);o.getCommentPraiseNum(e,t)}else v.showToast(i.message)})},o.getStoryPraiseNum=function(){var e=window.navigator.userAgent.toLowerCase(),t="micromessenger"==e.match(/MicroMessenger/i),i=C("loginId"),s={id:o.circleId,noLoading:!0,userCode:t?o.weChatOpenId:i};d.getStoryPraise(s).success(function(e){o.praiseNum=e.data})},o.getCommentPraiseNum=function(e,t){var i=window.navigator.userAgent.toLowerCase(),s="micromessenger"==i.match(/MicroMessenger/i),n=C("loginId"),a={commentId:e.id,noLoading:!0,userCode:s?o.weChatOpenId:n};d.commentPraiseNum(a).success(function(t){if(o.circleDetail.rewardComment){if(e.id==o.circleDetail.rewardComment[0].id){o.circleDetail.rewardComment[0].commentPraiseNumber=t.totalCount;for(var i=0;i<o.commentList.length;i++)e.id==o.commentList[i].id&&(o.commentList[i].commentPraiseNumber=t.totalCount)}}else for(var i=0;i<o.commentList.length;i++)e.id==o.commentList[i].id&&(o.commentList[i].commentPraiseNumber=t.totalCount)})},o.startTime=function(){if("APP"==y.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){f(function(){var t=e.getDate(),i=e.getMonth()+1,s=e.getFullYear(),n=new Date(e);n.setDate(e.getDate()+7);var a=n.getMonth()+1;a<10&&(a="0"+a),i<10&&(i="0"+i),t<10&&(t="0"+t);var r=s+"-"+i+"-"+t;o.start=r,o.end=n.getFullYear()+"-"+a+"-"+n.getDate()},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e);o.startOk=new Date(e);var i=new Date(e);o.endOk=i,i.setDate(t.getDate()+7);var s=new Date(e).getMonth()+1,n=new Date(e).getDate();s<10&&(s="0"+s),n<10&&(n="0"+n);var a=new Date(e).getFullYear()+"-"+s+"-"+n;o.start=a,o.end=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()}};e.openDatePicker(i)}},o.endTime=function(){if("APP"==y.getPlatform()){var t={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(t,function(e){f(function(){var t=e.getDate(),i=e.getMonth()+1,s=e.getFullYear();i<10&&(i="0"+i),t<10&&(t="0"+t);var n=s+"-"+i+"-"+t;o.end=n},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:o.startOk,to:o.endOk,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,i=new Date(e).getDate();t<10&&(t="0"+t),i<10&&(i="0"+i);var s=new Date(e).getFullYear()+"-"+t+"-"+i;o.end=s}};e.openDatePicker(i)}},o.selectStartEnd=function(){o.topStyle=1,o.startend="img/ic_select.png",o.day="img/ic_check.png"},o.selectDay=function(){o.topStyle=0,o.day="img/ic_select.png",o.startend="img/ic_check.png"},o.deleteTop=function(){o.showTop=!1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"},o.deleteJing=function(){o.showJing=!1,o.topStyle=3,o.topicJing=!0,o.isFirstJing=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"},o.selectTop=function(){o.showTop=!0},o.selectJing=function(){o.showJing=!0},o.topicTopOK=function(){o.personType.isSuperManager&&(o.topicTop?o.topicTop=!1:o.topicTop=!0)},o.topicJingOK=function(){o.personType.isSuperManager&&(o.topicJing?o.topicJing=!1:o.topicJing=!0)},o.firstTop=function(){o.isFirstTop?o.isFirstTop=!1:o.isFirstTop=!0},o.firstJing=function(){o.isFirstJing?o.isFirstJing=!1:o.isFirstJing=!0},o.topPosts=function(){if(o.isFirstTop||o.topicTop)if(0==o.topStyle||1==o.topStyle){if(1==o.topStyle){if(o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:3};o.okTop(e)}else if(o.isFirstTop&&!o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:2};o.okTop(e)}else if(!o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:1,topStartDate:o.start,topEndDate:o.end,topicTop:1};o.okTop(e)}}else if(0==o.topStyle)if(o.topTopic.day){var t=parseInt(o.topTopic.day);if(t>0)if(t<30){if(o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:3};o.okTop(e)}else if(o.isFirstTop&&!o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:2};o.okTop(e)}else if(!o.isFirstTop&&o.topicTop){var e={storyId:o.circleId,topStatus:0,topNum:t,topicTop:1};o.okTop(e)}}else v.showToast("置顶天数不能超过30天，请重新输入");else v.showToast("置顶天数需大于0天，请重新输入")}else v.showToast("请输入置顶天数")}else v.showToast("请选择置顶时间");else v.showToast("请选择置顶位置")},o.okTop=function(e){d.topStory(e).success(function(e){e.success?(v.showToast("置顶成功"),o.circleDetail.isTopicTop=!0,o.showTop=!1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"):v.showToast(e.message)})},o.JingPosts=function(){if(o.isFirstJing||o.topicJing)if(0==o.topStyle||1==o.topStyle){if(1==o.topStyle){if(o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:3};o.okJing(e)}else if(o.isFirstJing&&!o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:2};o.okJing(e)}else if(!o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:1,choiceStartDate:o.start,choiceEndDate:o.end,topicChoice:1};o.okJing(e)}}else if(0==o.topStyle)if(o.topTopic.day){var t=parseInt(o.topTopic.day);if(t>0)if(t<30){if(o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:3};o.okJing(e)}else if(o.isFirstJing&&!o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:2};o.okJing(e)}else if(!o.isFirstJing&&o.topicJing){var e={storyId:o.circleId,choiceStatus:0,choiceNum:t,topicChoice:1};o.okJing(e)}}else v.showToast("设置精华天数不能超过30天，请重新输入");else v.showToast("置顶天数需大于0天，请重新输入")}else v.showToast("请输入天数")}else v.showToast("请选择精华时间");else v.showToast("请选择精华位置")},o.okJing=function(e){d.JingStory(e).success(function(t){t.success?(v.showToast("设置精华成功"),o.circleDetail.isChoice=e.topicChoice,o.showJing=!1,o.topStyle=3,o.topicJing=!0,o.isFirstJing=!1,o.startend="img/ic_check.png",o.day="img/ic_check.png"):v.showToast(t.message)})},o.cancelTop=function(){var e={storyId:o.circleId};d.cancelTop(e).success(function(e){e.success?(o.circleDetail.isTopicTop=!1,o.circleDetail.isTop=!1,v.showToast(e.message)):v.showToast(e.message)})},o.cancelJing=function(){var e={storyId:o.circleId};d.cancelJing(e).success(function(e){e.success?(o.circleDetail.isChoice=0,v.showToast(e.message)):v.showToast(e.message)})},o.deleteStory=function(){var e={storyId:o.circleDetail.id};d.deleteTopic(e).success(function(e){1==e.success?(v.showToast("话题删除成功"),s.ifDeleteNoteList=!0,a.go("circlePage",{circleId:o.circleDetail.topicId})):v.showToast(e.message)})},o.warnDelete=function(e){if(o.isDisplay=!1,o.commentId=e,1==o.circleDetail.isReward&&0==o.circleDetail.rewardStatus){p.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>该话题是悬赏话题，删除金币不退回，确认删除吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:o,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){o.deleteStory()}},{text:"放弃"}]})}else{p.show({template:'<img src="img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除话题吗？</div>',title:"删除话题",subTitle:"Please use normal things",scope:o,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){o.deleteStory()}},{text:"放弃"}]})}f(function(){},3e3)},o.warnDeleteComments=function(e){o.isDisplay=!1,o.deleteId=e;p.show({template:'<img src="{{imgBaseURL}}img/circleIcon/pinkDelete.png" style="width: 30px" alt=""><div>确认删除评论吗？</div>',title:"删除评论",subTitle:"Please use normal things",scope:o,buttons:[{text:"放弃"},{text:"<span>确认</span>",type:"",onTap:function(){o.deleteComment()}}]});f(function(){},3e3)},o.deleteComment=function(e){var t={id:o.deleteId};d.deleteStory(t).success(function(e){1==e.success?(v.showToast("删除成功"),o.getComment()):v.showToast(e.message)})},o.productConnect=function(){var e={productId:o.circleDetail.productId,userCode:o.userShareId?o.userShareId:o.circleDetail.userCode};d.connectProduct(e).success(function(e){e.success&&(o.products=e.data.list)})},o.toProductDetail=function(e){a.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:e.storeId})},o.whichPersonType=function(){var e={storyId:o.circleDetail.id,topicId:o.circleDetail.topicId};d.getPersonType(e).success(function(e){1==e.success&&(o.personType={isAdmin:e.data.isAdmin,isCreateStory:e.data.isCreateStory,isSuperManager:e.data.isSuperManager,isCircleManager:e.data.isCircleManager})})},o.shareToStore=function(){var e={flag:1,storyId:o.circleDetail.id};d.shareStore(e).success(function(e){e.success})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),f(function(){v.showToastShort("复制成功")},200)):v.showToast("请下载APP执行此操作")},o.hideblackCover=function(){o.showShare=!1},o.shareToPlatform=function(e){var t=o.circleDetail.storyName?o.circleDetail.storyName+"-顺逛微社区":o.circleDetail.userName+"的话题-顺逛微社区",i=o.circleDetail.storyContentText.substr(0,30)||"马上进入，参与话题讨论吧...",s=o.circleDetail.mainImgArray[0]?o.circleDetail.mainImgArray[0]:"http://www.ehaier.com/mstatic/wd/v2/img/sg.png";if(o.shareUserId)var n=S.getShareLinkHeader()+"noteDetails/"+o.circleId+"/"+o.ifShort+"/"+o.shareUserId;else var n=S.getShareLinkHeader()+"noteDetails/"+o.circleId+"/"+o.ifShort+"/";if(window.umeng){var a={topicId:o.circleId},r=function(e){w.shareSuccessCallback(e,a)};0==e?window.umeng.shareToSina(t,i,s,n,0,null,r):1==e?window.umeng.shareToWechatSession(t,i,s,n,0,null,r):2==e?window.umeng.shareToWechatTimeline(t,i,s,n,0,null,r):3==e?(window.umeng.shareToQQ(t,i,s,n,0,null,r),w.qqShare()):4==e&&(window.umeng.shareToQzone(t,i,s,n,0,null,r),w.qqShare()),5==e?o.copeText(n):w.successShare()}else alert("umeng undefined 只能在app分享");o.showShare=!1,o.shareToStore()},o.closeDownload=function(){o.ifDownload=!1},o.goldNum=function(){d.getGold().success(function(e){e.success?e.data>9999?o.canShanGold=9999:e.data<0?o.canShanGold=0:o.canShanGold=e.data:-2e3==e.errorCode?(v.showToast(e.message),o.showShan=!1,s.loginIsAccord2=!0):o.showShan=!1})},o.getShanList=function(){var e={tipId:parseInt(o.circleId),pageIndex:1,pageSize:10,type:1};d.getList(e).success(function(e){o.shanList=e.data})},o.shanTopic=function(){o.shanCommentId=o.shanCommentId+"",o.shanGoldNum?o.shanOK():o.reward.num?(o.shanGoldNum=parseInt(o.reward.num),o.shanOK()):v.showToast("请选择打赏金币")},o.shanOK=function(){if(o.shanGoldNum<=9999)if(o.shanGoldNum<=o.canShanGold)if(o.shanCommentId.length>0){var e={commentId:o.shanCommentId,amount:o.shanGoldNum};d.shanComment(e).success(function(e){if(e.success){o.showShan=!1,v.showToast("打赏成功"),f(function(){o.getShanList()},1e3);for(var t=0;t<o.commentList.length;t++)o.commentList[t].ischecked=!1;for(var i=0;i<o.shanNum.length;i++)o.shanNum[i].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanCommentId=""}else v.showToast(e.message)})}else{var t={storyId:parseInt(o.shanTopicId),amount:o.shanGoldNum};d.shanTopic(t).success(function(e){if(e.success){o.showShan=!1,v.showToast("打赏成功"),f(function(){o.getShanList()},1e3);for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanTopicId=""}else{o.showShan=!1;for(var t=0;t<o.shanNum.length;t++)o.shanNum[t].isChecked=!1;o.reward.num="",o.shanGoldNum="",o.shanTopicId="",v.showToast(e.message)}})}else v.showToast("您的金币数不足，请修改打赏金额");else v.showToast("最多可打赏9999金币，请修改打赏金额")},o.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userId})},o.cangComment=function(e){var t={id:e.id,isDisplay:e.isDisplay};d.cangComment(t).success(function(e){e.success?(v.showToast(e.message),f(function(){o.getComment()},1e3)):v.showToast(e.message)})},o.cangTopic=function(){var e={storyId:o.circleId};d.cangTopic(e).success(function(e){e.success?o.getCircleDetails():v.showToast(e.message)})},o.delCangTopic=function(){var e={storyId:o.circleId};d.delCangTopic(e).success(function(e){e.success?o.getCircleDetails():v.showToast(e.message)})},o.topicAgree=function(e){p.show({template:"<div>您是否确认采纳该回复？</div>",title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:o,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){var i={storyId:o.circleId,commentId:e};d.topicAgree(i).success(function(e){e.success?(v.showToast("已经被采纳"),o.getCircleDetails(),o.getStoryPraiseNum(),o.getComment()):v.showToast(e.message)})}}]})},o.init=function(){o.images=!1,o.haierImg=!1,o.shunguangImg=!1,s.globalConstant.showvideo=!1,o.commentIndex=1,o.topStyle=3,o.topicTop=!0,o.isFirstTop=!1,o.topicJing=!0,o.isFirstJing=!1,o.showJing=!1,o.topTopic={day:5},o.startend="img/ic_check.png",o.day="img/ic_check.png";var e=new Date,t=parseInt(e.getMonth())+1,i=new Date(e);i.setDate(e.getDate()+7);var n=parseInt(i.getMonth())+1;o.start=e.getFullYear()+"-"+t+"-"+e.getDate(),o.end=i.getFullYear()+"-"+n+"-"+i.getDate(),o.shareUserId=null,o.userShareId=c.shareStoreId,o.circleId=c.noteId,o.shanList="",s.ifDeleteNoteList=!1,o.reward={num:""},o.shanNum=[{num:1,isChecked:!1},{num:5,isChecked:!1},{num:10,isChecked:!1},{num:20,isChecked:!1},{num:50,isChecked:!1},{num:100,isChecked:!1}],o.getShanList(),o.userId=I.getUser().mid,window.cordova?o.ifInApp=!1:o.ifInApp=!0,o.ifDownload=!0,o.toSomeone="",o.showQQ=!1,o.showWeChat=!1,o.showShare=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){o.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){o.showWeChat=0!=e})),o.commentWords={words:""},o.showShare=!1,o.isFavorite=!0,o.isPraise=!0,o.isDisplay=!1,o.ifShort=c.isShortStory,o.personType={isAdmin:!1,isCreateStory:!1},o.getCircleDetails(),o.getStoryPraiseNum(),o.getComment(),r.fromTemplateUrl("templates/quanzi/TopDaysModal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.selectModal=e})},o.wechatOpenId=function(){d.getWeChatOpenId().success(function(e){e.success&&(e.data?(o.weChatOpenId=e.data,d.weChatOpenId=e.data,o.init()):o.wechatUrlOpenId())})},o.wechatUrlOpenId=function(){var e=T.absUrl();d.getWeChatUrlOpenId(e).success(function(e){e.success&&(document.location.href=e.data)})},o.$on("$ionicView.beforeEnter",function(){o.isIOS=!!ionic.Platform.isIOS(),s.$on("$stateChangeStart",function(e,t,o,i,s){if("noteDetails"==i.name)for(var n=document.getElementsByTagName("video"),a=0;a<n.length;a++)n[a].pause()}),ionic.Platform.isAndroid()&&(o.hideBigImage(),$(".LightBox").hide(0)),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?o.wechatOpenId():o.init()}),o.$on("$ionicView.beforeLeave",function(){$("ion-header-bar").show(),$(".Main .tab-nav").show()}),o.oneTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);o.applyDiscussionData.startHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),o.applyDiscussionData.startMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)},o.twoTimePicker=function(){var e={callback:function(e){var t=new Date(1e3*e);o.applyDiscussionData.endHour=("00"+t.getUTCHours()).substr(t.getUTCHours().toString().length),o.applyDiscussionData.endMin=("00"+t.getUTCMinutes()).substr(t.getUTCMinutes().toString().length)}};ionicTimePicker.openTimePicker(e)}}]),APP.service("NoteDetailsService",["$http","UrlService",function(e,t){this.getCircleDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.deleteTopic=function(o){return e({method:"POST",url:t.getUrl("DELETESTORY"),data:o})},this.deleteStory=function(o){return e({method:"POST",url:t.getUrl("DELETE_COMMON_COMMENT"),data:o})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.topicFavorite=function(o){return e({method:"POST",url:t.getUrl("COLLECTION_TOPIC"),data:o})},this.commentPraise=function(o){return e({method:"POST",url:t.getUrl("TOPIC_PRAISE"),data:o})},this.getComments=function(o){return e({method:"POST",url:t.getUrl("COMMON_COMMENT"),data:o})},this.topStory=function(o){return e.get(t.getUrl("CIRCLE_TOP_TOPIC"),o)},this.JingStory=function(o){return e.get(t.getUrl("CIRCLE_JING_TOPIC"),o)},this.cancelJing=function(o){return e.get(t.getUrl("CIRCLE_JING_CANCLE"),o)},this.followNote=function(o){return e({method:"POST",url:t.getUrl("FOLLOW"),data:o})},this.insertComment=function(o){return e({method:"POST",url:t.getUrl("INSERT_COMMON_COMMENT"),data:o})},this.getPersonType=function(o){return e({method:"POST",url:t.getUrl("NOTE_PERSON_TYPE"),data:o})},this.getStoryPraise=function(o){return e({method:"POST",url:t.getUrl("GET_STORY_PRAISE"),data:o})},this.commentPraiseNum=function(o){return e({method:"POST",url:t.getUrl("COMMENT_STORY_PRAISE"),data:o})},this.shareStore=function(o){return e({method:"POST",url:t.getUrl("SHARE"),data:o})},this.connectProduct=function(o){return e({method:"POST",url:t.getUrl("CONNECT_PROUCT"),data:o})},this.cancelTop=function(o){return e.get(t.getUrl("CANCEL_TOP"),o)},this.cangComment=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_CANG_COMMENT"),data:o})},this.cangTopic=function(o){return e.get(t.getUrl("CIRCLE_CANG_TOPIC"),o)},this.delCangTopic=function(o){return e.get(t.getUrl("CIECLE_DEL_CANG_TOPIC"),o)},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getGold=function(){return e.get(t.getUrl("CIRCLE_GET_GOLD"))},this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)},this.getShop=function(o){return e.get(t.getUrl("CIRCLE_SELECT_SHOP"))},this.topicAgree=function(o){return e.get(t.getUrl("CIRCLE_AGREE"),o)},this.shanTopic=function(o){return e.get(t.getUrl("CIRCLE_SHAN_TOPIC"),o)},this.shanComment=function(o){return e.get(t.getUrl("CIRCLE_SHAN_COMMENT"),o)},this.getWeChatOpenId=function(){return e({method:"POST",url:t.getUrl("GET_WECHAT_OPENID")})},this.getWeChatUrlOpenId=function(o){var i={url:o};return e.post(t.getUrl("GET_WECHAT_URL")+"?url="+encodeURIComponent(i.url))},this.weChatOpenId=""}]),APP.controller("PublishCircleController",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicLoading","$ionicActionSheet","PublishCircleService","ApplyCircleService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.identifyCode="",e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.goSelectGoods=function(){o.go("selectGoods")},e.judgeWords=function(){var t={keywords:e.publishInfo.storyContent};c.judgeWords(t).success(function(e){"没有敏感词"==e.message||d.showToast(e.message)})},e.$watch("publishInfo.storyContent",function(){u.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&d.showToast("话题内容不得超过500字")}),e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.publishClick=function(i){if(i.mainImg=e.imgUrlList.toString(),e.publishInfo.topicId=e.topicId,0!=e.publishInfo.storyContent.length||e.iconImageData.length)if(e.publishInfo.storyContent.length>500)d.showToast("话题内容不得超过500字");else if(e.iconImageData.length!=e.imgUrlList.length)d.showToast("图片正在上传，请稍后再试");else{var s={keywords:e.publishInfo.storyContent};c.judgeWords(s).success(function(s){"没有敏感词"==s.message?r.publish(i).success(function(i){1==i.success?(d.showToast("发布成功"),t.publishSuccess=!0,l(function(){t.publishSuccess=!1},1e3),e.publishInfo={topicId:"",mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("circlePage",{circleId:e.topicId})):d.showToast(i.message)}).error(function(){}):d.showToast("存在敏感词",s.data)})}else e.publishNotice=!0,l(function(){e.publishNotice=!1},1e3)},e.imgUrlList=[],e.addPicture=function(){function t(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},s=function(e){n.hide()},a={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),i,s,a)}function o(){}return navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0},e.photoAlbum=function(){var t=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i);var s=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){n.hide()},c={};(new FileTransfer).upload(i.imgUrl,encodeURI(r.uploadImage()),s,a,c)}e.$apply()},function(e){},{maximumImagesCount:t,width:800,quality:50}),!0},e.imgPush=function(t){if(e.iconImageData.length>=9)return void d.showToast("最多添加9张");a.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};l(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},s=function(e){n.hide()},a={};(new FileTransfer).upload(o.imgUrl,encodeURI(r.uploadImage()),i,s,a)}function i(){}if(0==t)return navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}),!0;if(1==t){var s=9-e.iconImageData.length;return window.imagePicker.getPictures(function(t){for(var o=0;o<t.length;o++){var i={imgUrl:t[o]};e.iconImageData.push(i);var s=function(t){n.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},a=function(e){n.hide()},c={};(new FileTransfer).upload(i.imgUrl,encodeURI(r.uploadImage()),s,a,c)}e.$apply()},function(e){},{maximumImagesCount:s,width:800,quality:50}),!0}}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.wordsNum=500,e.showBigImage=!1,e.iconImageData=[],e.publishInfo.storyContent="",e.topicId=i.topicId,e.identifyCode=i.identifierCode,1==e.identifyCode?e.addPicture():2==e.identifyCode&&e.photoAlbum()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishCircleService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("SUBMIT_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.controller("PublishEditController",["$scope","$rootScope","$state","$stateParams","PublishEditService","PopupService","$timeout","$ionicActionSheet","$ionicLoading","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.identifyCode="",e.publishInfo={id:i.topicId,mainImg:"",storyContent:""},e.iconImageData=[],e.goBack=function(){e.$ionicGoBack()},e.$watch("publishInfo.storyContent",function(){l.scrollBottom(),e.wordsNum=500-e.publishInfo.storyContent.length,500==e.publishInfo.storyContent.length&&n.showToast("话题内容不得超过500字")}),e.getNoteDetail=function(){e.iconImageData=[],e.imgUrlList=[];var t={id:i.topicId};s.getDetails(t).success(function(t){e.detailData=t.data,e.publishInfo.storyContent=e.detailData.storyContent;for(var o=0;o<e.detailData.mainImgArray.length;o++){var i={imgUrl:e.detailData.mainImgArray[o]};e.imgUrlList.push(e.detailData.mainImgArray[o]),e.iconImageData.push(i)}})},e.publishClick=function(r){var c={keywords:e.publishInfo.storyContent};s.judgeWords(c).success(function(c){"没有敏感词"==c.message?(e.publishInfo.mainImg=e.imgUrlList.toString(),0!=e.publishInfo.storyContent.length||e.publishInfo.mainImg?e.iconImageData.length!=e.imgUrlList.length?n.showToast("图片正在上传，请稍后再试"):s.publish(r).success(function(s){1==s.success?(n.showToast("发布成功"),t.editSuccess=!0,a(function(){t.editSuccess=!1},1e3),e.publishInfo={id:i.topicId,mainImg:"",storyContent:""},e.iconImageData="",e.imgUrlList=[],o.go("noteDetails",{noteId:e.circleId,isShortStory:e.ifShort})):n.showToast(s.message)}).error(function(){}):(e.publishNotice=!0,a(function(){e.publishNotice=!1},1e3))):n.showToast("存在敏感词",c.data)}).error(function(){})},e.imgUrlList=[],e.imgPush=function(t){if(e.iconImageData.length>=9)return void n.showToast("最多添加9张");r.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(t){function o(t){var o={imgUrl:t};a(function(){e.iconImageData.push(o),e.existPhoto=!0},200);var i=function(t){c.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(s.uploadImage()),i,n,r)}function i(){}function n(){}function r(t){var o={imgUrl:t};e.iconImageData.push(o),e.existPhoto=!0,a(function(){for(var t=0;t<e.iconImageData.length;t++);},200);var i=function(t){c.hide();var o=JSON.parse(t.response),i=o.urls;e.imgUrlList.push(i),e.publishInfo.mainImg=e.imgUrlList.toString()},n=function(e){c.hide()},r={};(new FileTransfer).upload(o.imgUrl,encodeURI(s.uploadImage()),i,n,r)}return 0==t?(navigator.camera.getPicture(o,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):1==t?(navigator.camera.getPicture(r,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0):void 0}})},e.showLarge=function(t){e.showBigImage=!0,e.Url=t},e.closeImg=function(){e.showBigImage=!1},e.deleteImg=function(t){e.iconImageData.splice(t,1),e.imgUrlList.splice(t,1)},e.init=function(){e.trendHeight={height:document.getElementById("getWidth").offsetWidth+"px"},e.showBigImage=!1,e.circleId=i.noteId,
e.ifShort=i.isShortStory,e.getNoteDetail()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("PublishEditService",["$http","UrlService",function(e,t){this.publish=function(o){return e({method:"POST",url:t.getUrl("UPDATE_STORY"),data:o})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")},this.getDetails=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_STORY_INFO"),data:o})},this.judgeWords=function(o){return e({method:"POST",url:t.getUrl("BY_CONDITION"),data:o})}}]),APP.controller("QuestionDetailsController",["$scope","$rootScope","$state","$stateParams","QuestionDetailsService","PopupService","$timeout","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r){e.getListDate={wordsId:"",pageSize:"",pageIndex:""},e.answerDate={wordsContent:"",courseId:"",parentId:""},e.init=function(){e.wordId=i.wordsId,e.getQuestionList()},e.getQuestionList=function(){var t={wordsId:e.wordId,pageSize:10,pageIndex:1};s.getQuestionDetail(t).success(function(e){}).error(function(){})},e.commitAnswer=function(){e.answerDate={wordsContent:"",courseId:"",parentId:""},s.answerQuestion(e.answerDate).success(function(e){}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QuestionDetailsService",["$http","UrlService",function(e,t){this.answerQuestion=function(o){return e({method:"POST",url:t.getUrl("QUESTION_ANSWER"),data:o})},this.getQuestionDetail=function(o){return e({method:"POST",url:t.getUrl("GET_QUESTION_DETAILS"),data:o})}}]),APP.controller("SchoolGroupDiscussController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CircleGroupDiscussService","UserService","PopupService","$ionicActionSheet","MediaService","FileUploadService","$sce","CustomerConversationService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.csId;p.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},v,S)}function h(e){alert("得到图片失败")}function v(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);t.data.message=t.response.imageUrl,t.data.fileType=".jpg",t.data.companyId=void 0,e.$apply(function(){e.messages.push(t.data)});var i={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o.data.imageUrl,type:"RECORD_FILE"};m.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})}function S(e){alert("上传失败")}function I(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function $(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=138306984,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.CustumerParam={msg:void 0},e.footerStyle={bottom:"0px"},e.isShareMode=!1,e.shareShow=function(){e.isShareMode=!e.isShareMode};c.getUser();e.groupId=55,e.token="21CB91E8209EA98369F5E504449497D7",e.sgdMode=0,e.toggleMode=function(t){e.sgdMode=t},e.miniTaolun=[{msg:33333},{msg:"erfjwqefjwiqawijofejwjfwe"},{msg:"大事发生反饥饿叫啊喂哦 i 发尾峰"},{msg:"一张图片"}],e.isClick=function(){e.isDisplay=!e.isDisplay},e.toMemberList=function(){s.go("groupSetting")},e.isShowRecord=!1,e.tempUrl,e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1},e.init=function(){e.userInCC=c.getUser(),e.uuID||m.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0,keys:["exp_colum6","sss"],values:[1111222,333]};m.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId)}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t={c:"getGroupNewestMsg",groupId:e.groupId,token:e.token};r.getMsg(t).then(function(t){if(t&&t.data&&t.data.msgs&&0!=t.data.msgs.length)for(var o=0;o<t.data.msgs.length;o++)m.filtMsg(t.data.msgs[o]),t.data.msgs[o].message&&e.messages.push(t.data.msgs[o])},function(e){alert(e)})},e.sendMsg=function(){var t={c:"sendGroupMsg",groupId:e.groupId,msg:e.CustumerParam.msg,msgType:1,token:e.token};r.sendMsg(t).then(function(o){if(o){var i={message:t.msg,companyId:void 0};m.filtMsg(i),e.messages.push(i)}else l.showToast("发送消息失败")},function(e){})},e.create=function(){m.create().success(function(t){e.chatId=t.chatId})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};m.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.getImg=function(){d.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){u.getPicture(e,f,h)}})},e.play=function(){var e=document.getElementById("audioInSD");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSD");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.startRecord=function(){u.startCapture("sourceInSD","audioInSD")},e.deleteRecord=function(){u.deleteMedia()},e.stopRecord=function(){u.stopCapture("sourceInSD","audioInSD",e.transfer)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId=tlz55&cId="+e.csId,o=u.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),p.upload(o,t,void 0,void 0,void 0,{},w,y)};var w=function(t){var o,i=JSON.parse(t.response);o=i.data.imageUrl,o=o.replace(/8181/,"8082"),i.data.message="音频文件",i.data.imageUrl=o,i.data.fileType=".wav",i.data.companyId=void 0,e.deleteRecord(),e.$apply(function(){e.messages.push(i.data)});var s={cmd:"addEvent",c:e.csId,cId:e.chatId,v:e.uuID,msg:o,type:"RECORD_FILE"};m.addEvent(s).then(function(t){t?n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500):l.showToast("addevent  失败")})},y=function(e){alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("content").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.changeAudioS=function(){window.AudioToggle?e.CustumerParam.msg?AudioToggle.setAudioMode(AudioToggle.SPEAKER):AudioToggle.setAudioMode(AudioToggle.EARPIECE):alert("plugin audio toggle not found!!!")},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(o){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500),1==o?(e.isShowEmo=!0,e.isShowPicture=!1,e.isShowRecord=!1):2==o?(e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1):(e.isShowRecord=!0,e.isShowEmo=!1,e.isShowPicture=!1)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){var t=document.getElementById("content");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t.focus()},200)},e.addAudio=function(){e.messages.push({fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201702/8308.wav",companyId:void 0}),n(function(){e.$broadcast("$ionicParentView.afterEnter",{who:T})},500)},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){e.CustumerParam.msg=e.CustumerParam.msg+"["+t+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,i){t.chatScope=o,e.messages=[{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/Files/DownLoad/sound1/201612/8093.wav",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:0},{fileType:".wav",imageUrl:"http://xunlei.sc.chinaz.com/files/download/sound1/201309/3558.wav",companyId:1383068791,userName:"我不是路飞啊啊啊",idCate:1},{message:"affdsa阿拉丁；看风景啊额外了啊减肥我咯肌肤 啊金额为 i 哦分急哦反胃啊俄方阿文访问访问发完疯哇啊发 热瓦甫去啊额晚饭乏味服务范围分无法我 ",companyId:138306984,userName:"我不是路飞啊啊啊",idCate:2}];var s={message:"aaf啊积极饿哇  啊发[1]",companyId:1234,userName:"我zou是路飞啊啊啊",idCate:0};m.filtMsg(s),e.messages.push(s),e.footerStyle={bottom:"0px"},e.isShowMoreInput=!1,window.addEventListener("native.keyboardshow",I),window.addEventListener("native.keyboardhide",$),u.addAudioEventOnWindow()});var T=void 0;e.mp4url=g.trustAsResourceUrl("http://192.168.1.109:8100/mp4/1.mp4"),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){u.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",I),window.removeEventListener("native.keyboardhide",$)}),e.goBack=function(){e.$ionicGoBack()}}]),APP.directive("resizeFootBarsd",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-sd"),n=e.$getByHandle("cdScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),APP.controller("SelectGoodsController",["$scope",function(e){e.init=function(){},e.$on("$ionicView.beforeEnter",function(){})}]),APP.service("SelectGoodsService",["$http","UrlService",function(e,t){}]),APP.controller("SelectTagsController",["$scope","$rootScope","$state","$stateParams","SelectTagsService","PopupService","$timeout","$ionicScrollDelegate","$interval",function(e,t,o,i,s,n,a,r,c){t.frequentTags="",t.storeId=[],t.storeNames=[],t.nameStringToObj=[],t.addedTags=t.addedTags,e.namedTags="",e.isShow=!1,e.init=function(){e.phoneHeight=document.documentElement.clientHeight/2,e.getScrollHeight=function(){e.scrollHeight=document.getElementById("aaa").scrollTop},e.timer=c(function(){e.scrollHeight=document.getElementById("aaa").scrollTop,e.scrollHeight>e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},100),e.isShow=!1,t.nameStringToObj=[],t.frequentTags.length||(e.getFrequentlyTags(),t.storeId=[],t.storeNames=[],t.nameStringToObj=[])},e.goBack=function(){c.cancel(e.timer);for(var i=0;i<t.storeNames.length;i++){var s={name:t.storeNames[i]};t.nameStringToObj.push(s)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.getFrequentlyTags=function(){var e={id:t.reviewCircleId?t.reviewCircleId:""};s.getTags(e).success(function(e){if(t.frequentTags=e.data.list,e.data.list1){for(var o=0;o<e.data.list1.length;o++)t.storeId.push(e.data.list1[o].id);for(var i=0;i<e.data.list2.length;i++)t.storeNames.push(e.data.list2[i].name)}})},e.backApply=function(){c.cancel(e.timer);for(var i=0;i<t.storeNames.length;i++){var s={name:t.storeNames[i]};t.nameStringToObj.push(s)}e.namedTags="",o.go("applyCircle"),t.ifInit=1},e.showInput=function(){e.isShow=!0,setTimeout(function(){document.getElementById("inputId").focus()},200)},e.scrollToTop=function(){r.$getByHandle("mainScroll").scrollTop(),e.showTopBtn=!1},e.submitNamedTags=function(){var o={tagName:e.namedTags};if(o.tagName){for(var i=1,r=0;r<t.addedTags.length;r++){if(t.addedTags[r].name==o.tagName){n.showToast(response.message),i=0;break}i=1}1==i&&s.confirmTag(o).success(function(o){if(1==o.data)if(t.addedTags.length<5){var i={name:e.namedTags};t.addedTags.push(i),e.namedTags="",a(function(){e.isShow=!1},200)}else n.showToast("最多添加5个自定义标签");else n.showToast(o.message)})}else n.showToast("标签名不能为空");e.deleteTags=function(e){t.addedTags.splice(e,1)}},e.ifClicked=function(e,o,i,s){if(1==i)for(var a=0;a<=t.storeId.length;a++)t.storeId[a]==o&&(t.storeId.splice(a,1),t.storeNames.splice(a,1),t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked);else t.storeId.length<10?(t.frequentTags[e].isChecked=!t.frequentTags[e].isChecked,t.storeId.push(o),t.storeNames.push(s)):n.showToast("最多选择10个")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SelectTagsService",["$http","UrlService",function(e,t){this.getFrequentTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})},this.confirmTag=function(o){return e({method:"POST",url:t.getUrl("SELECT_TAGNAME"),data:o})},this.getTags=function(o){return e({method:"POST",url:t.getUrl("TOPIC_TAGS"),data:o})}}]),APP.controller("ServiceConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","ServiceConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","CustomerConversationService","$ionicPopup","$stateParams","MediaService","FileUploadService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S){function I(t){e.tempUrl=t;var o=m.getUploadUrl()+"?fileType=.jpg&chatId="+e.chatId+"&cId="+e.cId;S.upload(e.tempUrl,o,void 0,void 0,"image/jpeg",{},w,y)}function $(e){alert("得到图片失败")}function w(t){l.showToast("上传图片成功");var o=JSON.parse(t.response);o.data.message="图片文件";var i=o.data.imageUrl,s={imageUrl:i,fileType:".jpg",msg:"图片文件"};e.$apply(function(){e.messages.push(s)}),r.sendMsg(e.chatId,e.receiverId,"m",i,e.token).then(function(e){e&&e.data&&0==e.data.rt||alert("发送信息失败")})}function y(e){alert("上传失败")}function T(o){o.keyboardHeight&&e.$apply(function(){e.keybordH=o.keyboardHeight,e.isShowMoreInput=!1,t.isIOS?e.footerStyle={bottom:e.keybordH+"px"}:e.footerStyle={bottom:"0px"}})}function C(t){e.$apply(function(){e.isShowMoreInput||(e.footerStyle={bottom:"0px"})})}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.second=9,e.CustumerParam={msg:""},e.messages=[],e.token=c.getUser().sessionValue,e.cId=void 0,e.csTimer=void 0,e.receiverId="",e.chatId=void 0,e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.cId=h.to,e.receiverId=h.from,e.chatId=h.chatId,e.cId&&e.receiverId&&e.chatId&&(e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId))},e.goBack=function(){e.isPlaying||e.$ionicGoBack()},e.loginCs=function(){var t={c:"li",u:"admin",p:"123456"};e.chatId=void 0,r.login(t).then(function(t){t?(e.token=t.data.token,e.cId=t.data.ci,n(function(){e.loopGetMsg()},500)):alert("login error！！！")})},e.logoutCs=function(){},e.getLocalData=function(){n(function(){r.loadMessages(kefuData)},1200)},e.getMsg=function(){var t=d.defer();return r.getMsg(e.token).then(function(o){o&&o.data&&o.data.msgs&&0!=o.data.msgs.length?(angular.forEach(o.data.msgs,function(e,t){r.filtMsg(e),"close"==e.ty||e.ty}),r.loadMessages(o.data.msgs),e.messages=r.get(e.chatId+"$"+e.receiverId+"$"+e.cId),t.resolve(1)):0==!o.data.msgs.length?t.resolve(1):t.reject(1)}),t.promise},e.sendMsg=function(){var t=e.CustumerParam.msg;return e.chatId&&e.receiverId?t?void r.sendMsg(e.chatId,e.receiverId,"m",t,e.token).then(function(o){if(o&&o.data&&0==o.data.rt){var i={msg:t,ty:"message"};r.filtMsg(i),e.messages.push(i),e.CustumerParam.msg=""}else alert("发送信息失败")}):void l.showToast("发送消息不能为空"):void alert("no chatId or receiverId ---sendMsg failed!")},e.getImg=function(e){v.getPicture(e,I,$)},e.startRecord=function(){v.startCapture("sourceInSC","audioInSC")},e.deleteRecord=function(){v.deleteMedia()},e.stopRecord=function(){l.showToastShort("录音完成，正在上传..."),v.stopCapture("sourceInSC","audioInSC",e.transfer)},e.play=function(){var e=document.getElementById("audioInSC");e&&e.play()},e.pause=function(){var e=document.getElementById("audioInSC");e&&e.pause()},e.isPlaying=!1,e.operationMode="tap",e.hold=function(t){if(e.isPlaying&&"tap"==e.operationMode)return void("tap"==e.operationMode&&(e.isPlaying=!1));e.operationMode="hold",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord()},e.release=function(){if("hold"==e.operationMode){if(!e.isPlaying)return;e.isPlaying=!1}},e.tap=function(){e.isPlaying?e.isPlaying=!1:(e.operationMode="tap",e.isPlaying=!0,e.killTimer(),e.loopRecord(),e.startRecord())},e.recordTimer=void 0,e.maxSecond=10,e.recordSecond=0,e.loopRecord=function(){e.recordTimer=n(function(){e.recordSecond++,e.recordSecond>10?(e.stopRecord(),l.showToastShort("到达最大时间开始录制下一条"),n(function(){e.recordSecond=0,e.loopRecord(),e.killTimer(),e.startRecord()},1e3)):e.isPlaying?e.loopRecord():(e.stopRecord(),e.recordSecond=0,n.cancel(e.recordTimer))},1e3)},e.transfer=function(){var t=m.getUploadUrl()+"?fileType=.wav&chatId="+e.chatId+"&cId="+e.cId,o=v.getAudioUrl();o||l.showToast("音频录制失败，no audioUrl"),S.upload(o,t,void 0,void 0,void 0,{},b,A)};var b=function(t){var o=JSON.parse(t.response),i=o.data.imageUrl;o.data.message="音频文件",o.data.msg=o.data.imageUrl;var s={imageUrl:i,fileType:".wav",msg:"音频文件"};e.deleteRecord(),e.$apply(function(){e.messages.push(s)}),r.sendMsg(e.chatId,e.receiverId,"m",i,e.token).then(function(t){t&&t.data&&0==t.data.rt||alert("发送信息失败"),e.loopGetMsg()})},A=function(t){e.loopGetMsg(),alert("上传失败")};e.focusInput=function(){},e.showKeyboard=function(){document.getElementById("contentS").focus()},e.closeKeyboard=function(){window.cordova.plugins.Keyboard.close()},e.isShowMoreInput=!1,e.isShowRecord=!1,e.isShowEmo=!1,e.isShowPicture=!1,e.showMoreInput=function(){t.isIOS?(e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}):n(function(){e.isShowMoreInput=!0,e.footerStyle={bottom:e.keybordH+"px"},e.emoDivStyle={height:e.keybordH+"px"}},500)},e.showPic=function(){e.isShowPicture=!0,e.isShowEmo=!1,e.isShowRecord=!1,e.showMoreInput()},e.hideMoreInput=function(){if(!e.isPlaying){var t=document.getElementById("contentS");n(function(){e.isShowMoreInput=!1,e.footerStyle={bottom:"0px"},t&&t.focus()},200)}},e.getValue=function(){alert(e.CustumerParam.msg)},e.insertEmo=function(t){var o=t>=10?t:"0"+t;e.CustumerParam.msg=e.CustumerParam.msg+"["+o+"]"},e.keybordH=254,e.emoDivStyle={height:e.keybordH+"px"},e.$on("$ionicView.beforeEnter",function(o,i){e.init(),e.footerStyle={bottom:"0px"},t.chatScope=o,n(function(){e.loopGetMsg()},3e3),window.addEventListener("native.keyboardshow",T),window.addEventListener("native.keyboardhide",C),v.addAudioEventOnWindow()}),e.$on("$ionicView.afterEnter",function(t,o){e.$broadcast("$ionicParentView.afterEnter",{who:t})}),e.$on("$ionicView.beforeLeave",function(){v.removeAudioEventOnWindow(),window.removeEventListener("native.keyboardshow",T),window.removeEventListener("native.keyboardhide",C),e.killTimer()})}]),APP.service("ServiceConversationService",["$http","UrlService",function(e,t){function o(e,t){r.entrySet[e]=t,r.count++}function i(e){return r.entrySet[e]}function s(e){for(var t in r.entrySet)if(t===e)return!0;return!1}function n(e){s(e)&&(delete r.entrySet[e],r.count--)}function a(e,t){if(t<10){var o=new RegExp("\\[0"+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var o=new RegExp("\\["+t+"\\]","g");return e.replace(o,'<img  src="'+$rootScope.imgBaseURL+"img/sgemo/"+l[t]+'.png" />')}var r={count:0,entrySet:{}};this.isEmptyMap=function(){return 0===r.count},this.put=o,this.get=i,this.containsKey=s,this.remove=n,this.loadMessages=function(e){if(e&&angular.isArray(e))for(var t,n,a,r=0;r<e.length;r++)t=e[r],n=t.ci+"$"+t.fr+"$"+t.to,s(n)?(a=i(n),angular.isArray(a)&&a.push(t)):o(n,[t])},r.all=[],this.getAll=function(){for(var e in r.entrySet)r.all=r.all.concat(r.entrySet[e]);return r.all},this.getEntrySet=function(){return r.entrySet};var c="http://123.56.3.136:8181/api/invoke";this.login=function(t){return e({method:"POST",url:c,params:t})},this.kefulogin=function(t){return e({method:"POST",url:c,params:{c:"li",u:t}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e({method:"POST",url:c,params:{c:"re",token:t,noLoading:!0}})},this.filtMsg=function(e){"EVENT_ACCEPT"==e.type&&(e.isFirstFlag=!0);if(e.msg&&e.msg.indexOf("$prodLink")>-1){e.fileType="prodLink";var t=e.msg.substring(9),o=JSON.parse(t);e.prodObj=o}else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".jpg")>-1)e.fileType=".jpg",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("http")>-1&&e.msg.indexOf(".wav")>-1)e.fileType=".wav",e.imageUrl=e.msg;else if(e.msg&&e.msg.indexOf("[")>-1&&e.msg.indexOf("]")>-1)for(var i=1;i<16;i++)e.msg=a(e.msg,i)};var l=[0,"01","02","03","04","05","06","07","08","09","10","11","12","13","14","15"];this.sendMsg=function(t,o,i,s,n){return e({method:"POST",url:c,params:{c:"sd",ci:t,to:o,ty:i,msg:s,token:n}})}}]),APP.directive("resizeFootBars",["$ionicScrollDelegate",function(e){return{replace:!1,link:function(t,o,i,s){t.$on("taResize",function(t,i){if(i){var s=document.body.querySelector("#message-detail-content-s"),n=e.$getByHandle("scScroll"),a=i[0].offsetHeight,r=a+10;r=r>44?r:44,o[0].style.height=r+"px",s.style.bottom=r+"px",n.scrollBottom()}})}}}]),APP.controller("ShareListPageController",["$scope","$rootScope","$ionicHistory","$stateParams","$state","$timeout","$interval","GroupSettingService","UserService","PopupService","$ionicActionSheet","MediaService",function(e,t,o,i,s,n,a,r,c,l,d,u){e.input={keywords:""},e.iconShow=!0,e.members=[],e.originData=void 0,e.$on("$ionicView.beforeEnter",function(o,s){t.chatScope=o,e.originData=i.sl,e.members=e.originData.shareMsgsList}),e.$on("$ionicView.afterEnter",function(e,t){}),e.$on("$ionicView.beforeLeave",function(e,t){}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("TestDetailsController",["$scope","$rootScope","$state","$stateParams","TestDetailsService","PopupService","$timeout","$ionicModal",function(e,t,o,i,s,n,a,r){e.examQuestionList={},e.selectedOptions=[],e.summitOptions=[],e.testResult="",e.init=function(){r.fromTemplateUrl("templates/quanzi/CommitTestPaperModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.commitPaperModal=t}),e.showTestDetails(),e.getTestResult()},e.showTestDetails=function(){var t={courseId:1};s.getTestList(t).success(function(t){e.index=0,e.examQuestionList=t.data.list})},e.getTestResult=function(){var t={courseId:1};s.getTestResult(t).success(function(t){e.testResult=t.data.list})},e.jumpQuestionDetail=function(t){e.index=t-1},e.beforeQuestion=function(){e.index-=1},e.nextQuestion=function(){e.index+=1,e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,respondentsAnswer:e.summitCourseId?e.summitOptions:""};s.getTestList(t).success(function(t){e.selectedOptions=[];for(var o=e.examQuestionList[e.index].respondentsAnswer.split(","),i=0;i<o.length;i++)e.selectedOptions.push(o[i])})},e.submitPaper=function(){e.selectedOptions.toString();var t={courseId:e.summitCourseId,id:e.examId,submitPaperFlag:1,respondentsAnswer:e.summitCourseId?e.summitOptions:""};s.getTestList(t).success(function(t){e.selectedOptions=[]}).error(function(e){n.showToast(e.message)})},e.selectAnswer=function(t,o){if(e.examId=e.examQuestionList[t].id,e.summitCourseId=e.examQuestionList[t].courseId,"单选"==e.examQuestionList[t].subjectType){for(var i=0;i<e.examQuestionList[t].optionsList.length;i++)e.examQuestionList[t].optionsList[i].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}else if("多选"==e.examQuestionList[t].subjectType)if(1==e.examQuestionList[t].optionsList[o].isSelect)for(var i=0;i<e.selectedOptions.length;i++)e.selectedOptions[i]==e.examQuestionList[t].optionsList[o].optionsName&&(e.examQuestionList[t].optionsList[o].isSelect=!1,e.selectedOptions.splice(i,1),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString());else e.examQuestionList[t].optionsList[o].isSelect=!e.examQuestionList[t].optionsList[o].isSelect,e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.selectedOptions.sort(),e.summitOptions=e.selectedOptions.toString();else if("判断"==e.examQuestionList[t].subjectType){for(var i=0;i<e.examQuestionList[t].optionsList.length;i++)e.examQuestionList[t].optionsList[i].isSelect=!1,e.examQuestionList[t].optionsList[o].isSelect=!0;e.selectedOptions.push(e.examQuestionList[t].optionsList[o].optionsName),e.summitOptions=e.selectedOptions.toString(),e.selectedOptions=[]}},e.showCommitPaper=function(){e.commitPaperModal.show()},e.hideCommitPaper=function(){e.commitPaperModal.hide()},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestDetailsService",["$http","UrlService",function(e,t){this.getTestList=function(o){return e({method:"POST",url:t.getUrl("TEST_LIST"),data:o})},this.getTestResult=function(o){return e({method:"POST",url:t.getUrl("TEST_CONSULT"),data:o})}}]),APP.controller("TestPageController",["$scope","$rootScope","$state","$stateParams","TestPageService","PopupService","$timeout",function(e,t,o,i,s,n,a){e.essentialInfo={},e.init=function(){e.getEssentialInfo()},e.toTestDetails=function(){o.go("testDetails")},e.getEssentialInfo=function(){var t={courseId:1};s.getEssentialInfo(t).success(function(t){e.essentialInfo=t.data.list})},e.goBack=function(){e.$ionicGoBack()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("TestPageService",["$http","UrlService",function(e,t){this.getEssentialInfo=function(o){return e({method:"POST",url:t.getUrl("TEST_ESSENTIAL_INFORMATION"),data:o})}}]),APP.controller("TopicController",["$scope","$rootScope","$ionicHistory","$state","TopicService","$localstorage",function(e,t,o,i,s,n){t.xiaoxis=!1,e.shuxiaoxi=!1,e.count=0,t.msgCount="",e.init=function(){e.tabNav="qhot",s.getxiaoxi().success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.onTabSelected=function(){t.xiaoxis=!1},e.open=function(){var e="http://m.ehaier.com/v3/sgcommunity/diy/login/request.ajax?flag="+n.get("sg_login_token_secret").substring(6);if(!window.cordova)return void(window.location.href=e);window.emc.presentH5View(e,"创意社区")}}]),APP.service("TopicService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))}}]),APP.controller("TopicdetailsController",["$scope","$rootScope","$ionicHistory","TopicdetailsService","$http","$ionicSlideBoxDelegate","$stateParams","$sce","$ionicScrollDelegate","$timeout",function(e,t,o,i,s,n,a,r,c,l){e.tielist="",e.pinglunlist="",e.isshow=!1,e.xxshow=!1,e.huatiid="",e.xiaoxis=!1,e.userlist="",e.topicheight=0,e.pinglunis=!1,e.count="",e.dianzans="",t.showRightTop=!1,e.goBack=function(){e.$ionicGoBack()},e.pinglunshow=function(){var t=c.$getByHandle("pinglun"),o=t.getScrollPosition(),i=o.top,s=window.innerHeight-118;e.topicheight=document.getElementById("topicxiang").clientHeight-s,l(function(){e.pinglunis=i>e.topicheight},200)},e.xiaoxishow=function(){e.xxshow=0!=e.count.count,e.isshow=!e.isshow,e.xiaoxis=!e.xiaoxis},e.addImage=function(){$ionicActionSheet.show({buttons:[{text:"<b>拍照</b>"},{text:"<b>从相册选取</b>"}],titleText:"照片选取方式",cancelText:"取消",buttonClicked:function(e){function t(e){}function o(){}function i(e){}return 0==e?(navigator.camera.getPicture(t,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!1,allowEdit:!0}),!0):1==e?(navigator.camera.getPicture(i,o,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0}),!0):void 0}})},e.gotoxiaoxi=function(){$state.go("qzMessageCenter"),e.isshow=!1,e.xxshow=!1},e.dianzan=function(){var t={id:e.huatiid};i.dianzan(t).success(function(t,o,i,s){e.dianzans=t.success})},e.init=function(){e.huatiid=a.huatiid;var o={pageIndex:1,pageSize:5,id:0};i.getpinglun(o).success(function(t,o,i,s){return e.pinglunlist=t.data.list,t});var s={id:e.huatiid};i.gettieData(s).success(function(t,o,i,s){return e.tielist=t.data,t}).error(function(){}),i.getdianzan(s).success(function(t,o,i,s){e.count=t.data}).error(function(){}),i.getxiaoxi(s).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.init(),e.huatiid=a.huatiid})}]),APP.service("TopicdetailsService",["$http","UrlService",function(e,t){this.gettieData=function(o){return e.post(t.getUrl("GETSTORYINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.getdianzan=function(o){return e.post(t.getUrl("GETSTORYPRAISEANDUNREAD"),o)},this.dianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.getpinglun=function(o){return e.post(t.getUrl("GETSTORYCOMMENT"),o)}}]),APP.directive("audioPanel",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/AudioPanel.html",scope:!0,link:function(e,t,o){}}}),APP.controller("CustomerConversationController",["$scope","$rootScope","$ionicHistory","$ionicSlideBoxDelegate","$state","$timeout","$interval","CustomerConversationService","UserService","PopupService","$q","$ionicActionSheet","$ionicLoading","$sce","$ionicPopup",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){try{e&&e.data&&(w?(I+=e.data.length,S=S.concat(e.data)):(I=e.data.length,S=e.data,w=!0))}catch(e){alert("onAudioInputCapture ex: "+e)}}function h(e){alert("onAudioInputError event recieved: "+JSON.stringify(e))}e.isDisplay=!1,t.showRightTop=!1,t.msgCount="",e.serverMs,e.uuID,e.netError,e.csId=1,e.messages=[],e.csTimer=void 0,e.csUserInfo,e.isShowRecord=!1,e.CustumerParam={msg:"说点什么"},e.isClick=function(){e.isDisplay=!e.isDisplay},e.killTimer=function(){n.cancel(e.csTimer),e.csTimer=void 0},e.loopGetMsg=function(){e.getMsg().then(function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)},function(t){e.csTimer=n(function(){e.loopGetMsg()},3e3)})},e.init=function(){e.userInCC=c.getUser(),r.getUUID().then(function(t){if(t&&t.data){e.uuID=t.data.vistorId;var o={cmd:"chat",_t:new Date-0,v:e.uuID,u:e.uuID,userId:e.uuID,c:e.csId,chatType:"phone",sid:0};r.create(o).then(function(t){if(t&&t.data){"OFFLINE"==t.data.type?alert("客服 不在线"):t.data.chatId&&(e.csUserInfo=t.data.userInfo,e.chatId=t.data.chatId,e.loopGetMsg())}},function(e){alert(e)})}},function(e){alert(e)})},e.getMsg=function(){var t=d.defer(),o={cmd:"getMessage",_t:new Date-0,c:e.csId,v:e.uuID,cId:e.chatId};return r.getMsg(o).then(function(o){if(o&&o.data&&o.data.msgs&&0!=o.data.msgs.length){for(var i=0;i<o.data.msgs.length;i++){if(o.data.msgs[i].message&&o.data.msgs[i].message.indexOf("http")>-1&&o.data.msgs[i].message.indexOf(".jpg")>-1)o.data.msgs[i].fileType=".jpg",o.data.msgs[i].imageUrl=o.data.msgs[i].message;else if(o.data.msgs[i].message&&o.data.msgs[i].message.indexOf("http")>-1&&o.data.msgs[i].message.indexOf(".wav")>-1){o.data.msgs[i].fileType=".wav";var s=o.data.msgs[i].message;o.data.msgs[i].imageUrl=g.trustAsResourceUrl(s)}e.messages.push(o.data.msgs[i])}t.resolve(1)}else t.reject(1)}),t.promise},e.sendMsg=function(){var t={cmd:"addMessage",_t:new Date-0,c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId,msg:e.CustumerParam.msg};r.sendMsg(t).then(function(o){e.messages.push({message:t.msg})},function(e){})},e.create=function(){r.create().success(function(t){e.chatId=t.chatId})},e.opinion=function(){var t={cmd:"opinion",c:e.csId,v:e.uuID,u:e.uuID,op:"2",desp:"非常不错！！",b_op:4,cId:e.chatId};r.opinion(t).then(function(t){
if(t&&t.data&&"success"==t.data.result){l.showToastShort("评价成功");var o={cmd:"addEvent",c:e.csId,v:e.uuID,u:e.uuID,cusId:e.csUserInfo.userId,msg:"finn",type:"EVENT_OPINION",cId:e.chatId};r.addEvent(o).then(function(e){if(e);},function(e){alert("评价结束后 发event 错误")})}},function(e){alert("网络错误")})},e.endChat=function(){var t={cmd:"endChat",c:e.csId,v:e.uuID,u:e.uuID,cId:e.chatId};r.endChat(t).then(function(e){e&&e.data&&"success"==e.data.result&&l.showToastShort("关闭对话成功")},function(e){alert("网络错误")})},e.sendPic=function(){u.show({buttons:[{text:"拍照"},{text:"从相册选择"}],titleText:"上传照片",cancelText:"Cancel",cancel:function(){},buttonClicked:function(t){function o(t){alert("getPicSuccess"),e.avatarImage=t;var o=function(t){p.hide(),l.showToast("上传成功");var o=JSON.parse(t.response);e.avatarImage=o.data.imageUrl,o.data.message="拍照图片",e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},i=function(e){p.hide(),l.showToast("上传失败")},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var n={};n.userName="18560683520",s.params=n,(new FileTransfer).upload(t,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,i,s)}function i(e){alert(e)}function s(t){e.avatarImage=t;var o=function(t){l.showToast("上传成功"),p.hide();var o=JSON.parse(t.response);o.data.message="相册图片",e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},i=function(e){l.showToast("上传失败"),p.hide()},s=new FileUploadOptions;s.fileKey="imageFile",s.fileName=e.avatarImage.substr(e.avatarImage.lastIndexOf("/")+1),s.mimeType="image/jpeg";var n={};n.userName="18560683520",s.params=n,(new FileTransfer).upload(e.avatarImage,encodeURI("http://123.56.3.136:8088/live/receive.jsp?fileType=.jpg&chatId="+e.chatId+"&cId=1"),o,i,s)}function n(e){}return 0==t?navigator.camera.getPicture(o,i,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1}):1==t&&navigator.camera.getPicture(s,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})};var v={},S=[],I=0;window.URL=window.URL||window.webkitURL;var $="",w=!0;e.showRecord=function(){e.isShowRecord=!0},e.hideRecord=function(){e.isShowRecord=!1};var y=function(){try{window.audioinput&&!audioinput.isCapturing()&&(v={sampleRate:8e3,bufferSize:16384,channels:1,format:"PCM_16BIT",audioSourceType:0},audioinput.start(v));m.alert({title:"开始录音",template:"录音已经开始，按下确定结束"}).then(function(e){T()})}catch(e){alert("startCapture exception: "+e)}};e.startRecord=y;var T=function(){try{if(window.audioinput&&audioinput.isCapturing()){window.audioinput&&audioinput.stop(),I=0;var e=new WavAudioEncoder(v.sampleRate,v.channels);e.encode([S]);var t=e.finish("audio/wav");window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory,function(e){e.getFile("xuftest123.wav",{create:!0},function(e){e.createWriter(function(o){o.write(t),setTimeout(function(){$=e.toURL(),document.getElementById("source").src=$,document.getElementById("audio").load()},500)},function(){alert("FileWriter error!")})})})}}catch(e){alert("stopCapture exception: "+e)}};e.endRecord=T;var C=function(){window.resolveLocalFileSystemURL($,function(e){e.remove(function(){alert("delete success"),w=!1,document.getElementById("source").src="",document.getElementById("audio").load()},function(e){alert(JSON.stringify(e))},function(){alert("file not exist")})})};e.deleteRecord=C;var b=function(){alert("start transfer");var t=function(t){alert("上传成功");var o=JSON.parse(t.response);o.data.message="音频文件",o.data.imageUrl=g.trustAsResourceUrl(o.data.imageUrl),e.$apply(function(){e.messages.push(o.data)});var i={cmd:"addEvent",c:1,cId:e.chatId,v:e.uuID,cusId:"admin",msg:o.data.imageUrl,type:"RECORD_FILE"};r.addEvent(i).then(function(e){e||l.showToast("addevent  失败")})},o=function(e){alert("上传失败")},i=new FileUploadOptions;i.fileKey="imageFile",i.fileName="aaa";var s={};s.userName="18560683520",i.params=s;var n=new FileTransfer,a="http://123.56.3.136:8088/live/receive.jsp?fileType=.wav&chatId="+e.chatId+"&cId=1";n.upload($,encodeURI(a),t,o,i)};e.transfer=b,e.$on("$ionicView.beforeEnter",function(){e.init(),window.addEventListener("audioinput",f,!1),window.addEventListener("audioinputerror",h,!1),e.messages=[]}),e.$on("$ionicView.afterEnter",function(){}),e.$on("$ionicView.beforeLeave",function(){window.removeEventListener("audioinput",f),window.removeEventListener("audioinputerror",h),e.killTimer()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("CustomerConversationService",["$http","UrlService",function(e,t){var o="http://123.56.3.136:8088";this.login=function(t){return e({method:"POST",url:"http://172.16.63.98:8080/ios/api/invoke",params:{c:"li",u:"admin",p:"123456"}})},this.logout=function(){return e.get("./data/qhot.json")},this.checkStatus=function(){return e.get("./data/qhot.json")},this.getHistoryMsg=function(){return e.get("./data/qhot.json")},this.getMsg=function(t){return e.get("http://123.56.3.136:8088/live//msg.dll",t)},this.sendMsg=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.create=function(t){return e.get("http://123.56.3.136:8088/live/msg.dll",t)},this.getUUID=function(){return e.get(o+"/live/getVistorId.dll")},this.opinion=function(t){return e.get(o+"/live/msg.dll",t)},this.endChat=function(t){return e.get(o+"/live/msg.dll",t)},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)},this.upload=function(){},this.addEvent=function(t){return e.get(o+"/live/msg.dll",t)}}]);var fangkeData=[{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:null,event:!0,exts:{},fromUserId:"admin",message:"admin",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"EVENT_ACCEPT",viewUserId:"admin"},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"hhah",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014076122.jpg",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null},{category:1,chatId:"2452",class:"cn.jesong.webcall.object.message.ChatMessage",colleagueMessage:!1,command:null,companyId:1,dstUserId:"311bb4357362452fa08e3a5cbab637a4",event:!1,exts:{},fromUserId:"admin",message:"http://123.56.3.136:8088/file/1/20161229/24521483014105480.wav",reseveKey:null,toUserId:"311bb4357362452fa08e3a5cbab637a4",type:"RECORD_RECORD",viewUserId:null}];APP.controller("examCtrl",["$scope","$state","examService","NoteDetailsService",function(e,t,o,i){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.optionLetter=["A.","B.","C.","D."],e.answer=["a","b","c","d"],e.showWhich=[],e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.init=function(){e.isDisplay=!1,e.Qs=o.getQs(),e.showWhich[0]=!0,i.getxiaoxi().success(function(t,o,i,s){e.messageNum=t.data.count,e.ifRed=parseInt(t.data.count)}).error(function(e,t,o,i){alert("网络失败！")})},e.chooseWhich=function(t){e.showWhich=[],e.showWhich[t]=!0},e.$on("myIndex",function(t,o){e.$broadcast("yourIndex",o)}),e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("examService",[function(){var e=[{family:"一",questions:[{description:"题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目二题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目三题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目四题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目五题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目六题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]},{description:"题目七题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一题目一",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项B"},{selected:!1,text:"选项C"},{selected:!1,text:"选项D"}]}]},{family:"二",questions:[{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"三",questions:[{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一agadgdfsdhsdfadfgadfasdfasdfads",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]},{family:"四",questions:[{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]},{description:"题目一123456789adgdsfhsrtthrthdsfsdfgsdf",answer:[{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"},{selected:!1,text:"选项A"}]}]}];this.getQs=function(){return e}}]),APP.directive("eachRepeat",function(){return{link:function(e,t,o){e.$emit("myIndex",e.$index+1)}}}),APP.directive("receiveIndex",function(){return{link:function(e,t,o){e.$on("yourIndex",function(e,t){})}}}),APP.controller("heIssueController",["$http","$scope","$location","$anchorScroll","$cacheFactory","heIssueService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","personalHomepageHeService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T){function C(e,o,i,s){n.getMyIssue(e,o,i,s).success(function(e){1==e.success&&(t.issueData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function b(e,o,i,s){n.getMyComment(e,o,i,s).success(function(e){1==e.success&&(t.commentData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.commentList=t.commentList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function A(e,o,i){n.getMyStory(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.MyStoryList=t.MyStoryList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function P(e,o,i){n.getDaShang(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.DaShangData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.DaShangList=t.DaShangList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function L(e,o,i){n.getCollection(t.pageIndex,t.pageSize,t.cuurentUserId).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.CollectionList=t.CollectionList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}function x(e){n.getMyJoinedTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function D(e){n.getMyCreatTopics(e).success(function(e){1==e.success&&(t.myTopicData=e.data,t.myTopicList=e.data.list)})}function N(e,o,i){n.getUserPraise(e,o,i).success(function(e){1==e.success&&(t.CollectionData=e.data,null!=e.data.list&&void 0!=e.data.list&&0!=e.data.list.length?(t.UserPraiseList=t.UserPraiseList.concat(e.data.list),t.$broadcast("scroll.infiniteScrollComplete"),t.pageIndex+=1,t.hasmore=!0):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1))})}t.titles=[{title:"TA的发布"},{title:"TA的评论"},{title:"TA的原创"}],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){t.$ionicGoBack()},t.hasmore=!1,t.init=function(e,o,i){t.cuurentUserId=o,t.pageIndex=1,t.pageSize=5,t.pageSize10=10,"original"==e?A(t.pageIndex,t.pageSize,t.cuurentUserId):"issue"==e?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"comment"==e?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"dashang"==e?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==e?L(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==e?1==i?D(t.cuurentUserId):0==i&&x(t.cuurentUserId):"zan"==e&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.loadMore=function(){"comment"==a.title?b(t.pageIndex,t.pageSize,t.cuurentUserId,t.commentType):"issue"==a.title?C(t.pageIndex,t.pageSize,t.cuurentUserId,t.issueType):"original"==a.title?A(t.pageIndex,t.pageSize,t.cuurentUserId):"dashang"==a.title?P(t.pageIndex,t.pageSize,t.cuurentUserId):"shoucang"==a.title?L(t.pageIndex,t.pageSize,t.cuurentUserId):"quanzi"==a.title?0==t.chooseQuanIndex?D(t.cuurentUserId):1==t.chooseQuanIndex&&x(t.cuurentUserId):"zan"==a.title&&N(t.pageIndex,t.pageSize10,t.cuurentUserId)},t.$on("$ionicView.beforeEnter",function(e,o){if("back"!=o.direction){switch(h.scrollTop(),t.chooseIndex=0,t.issueList=[],t.issueType=0,t.chooseComIndex=0,t.chooseQuanIndex=0,t.quanziTitle="加入",t.chooseResuIndex=0,t.commentList=[],t.commentType=0,t.MyStoryList=[],t.DaShangList=[],t.CollectionList=[],t.myTopicList=[],t.UserPraiseList=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=a.memberId,"his"==a.who?t.titleStart="TA":"mine"==a.who&&(t.titleStart="我"),a.title){case"issue":t.titleEnd="的发布";break;case"comment":t.titleEnd="的评论";break;case"original":t.titleEnd="的原创";break;case"dashang":t.titleEnd="的打赏";break;case"quanzi":t.titleEnd="的圈子";break;case"zan":t.titleEnd="的赞";break;case"shoucang":t.titleEnd="的收藏";break;default:t.titleEnd="的发布"}t.init(a.title,a.id,0)}}),t.chooseTab=function(e){h.scrollTop(),t.page=2,0==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):1==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):2==e?(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType)):3==e&&(t.chooseIndex=e,t.issueType=e,t.MyStoryList=[],t.init("issue",a.id,t.issueType))},t.chooseComTab=function(e){h.scrollTop(),0==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType)):1==e?(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType)):2==e&&(t.commentList=[],t.chooseComIndex=e,t.commentType=e,t.init("comment",a.id,t.commentType))},t.chooseQuanTab=function(e){0==e?(t.myTopicList=[],t.chooseQuanIndex=0,t.quanziTitle="加入",t.init("quanzi",a.id,0)):1==e&&(t.myTopicList=[],t.chooseQuanIndex=1,t.quanziTitle="创建",t.init("quanzi",a.id,1))},t.toNoteDetails=function(e,t){c.go("noteDetails",{noteId:e,isShortStory:t})},t.CommentDetails=function(e){2==e.flag?c.go("classNoteDetails",{noteId:e.storyId}):c.go("noteDetails",{noteId:e.storyId,isShortStory:e.isShortStory})},t.viewStory=function(e){2!==e.flag?c.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):c.go("classNoteDetails",{noteId:e.id})},t.topicPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:a.circleId}),f.gio.track("active",{circleID:a.circleId}));var i={id:e,noLoading:!0};n.pushPraise(i).success(function(e){1==e.success?1==t.MyStoryList[o].praiseFlag?(t.MyStoryList[o].praiseNumber=t.MyStoryList[o].praiseNumber-1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):(t.MyStoryList[o].praiseNumber=parseInt(t.MyStoryList[o].praiseNumber)+1,t.MyStoryList[o].praiseFlag=!t.MyStoryList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.CollectionPraise=function(e,o){window.cordova&&(f.gio.track("like",{circleID:a.circleId}),f.gio.track("active",{circleID:a.circleId}));var i={id:e.id,noLoading:!0};1==e.flag&&n.pushPraise(i).success(function(e){1==e.success?1==t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)}),2==e.flag&&n.SchoolPraise(i).success(function(e){1==e.success?0!=t.CollectionList[o].praiseFlag?(t.CollectionList[o].praiseNumber=t.CollectionList[o].praiseNumber-1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):(t.CollectionList[o].praiseNumber=parseInt(t.CollectionList[o].praiseNumber)+1,t.CollectionList[o].praiseFlag=!t.CollectionList[o].praiseFlag):g(function(){w.showToast(e.message)},200)})},t.dealStory=function(e,o){var i;i=2!==e.flag?o:1==o?3:4;var s=e.storyTopicId?e.storyTopicId:e.id;T.dealStory(s,i).then(function(o){if(1==o.data.success){var n;switch(i){case 1:n=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?n-1:n+1,e.praiseFlag=!e.praiseFlag;break;case 2:n=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?n-1:n+1,e.collectionFlag=!e.collectionFlag;for(var a=0;a<t.CollectionList.length;a++)s==t.CollectionList[a].id&&t.CollectionList.splice(a,1);break;case 3:n=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?n-1:n+1,e.praiseFlag=!e.praiseFlag;break;case 4:for(n=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?n-1:n+1,e.collectionFlag=!e.collectionFlag,a=0;a<t.CollectionList.length;a++)s==t.CollectionList[a].id&&t.CollectionList.splice(a,1)}}},function(){w.showToast("网络错误！")})},t.viewTopic=function(e){c.go("circlePage",{circleId:e})},t.gotoqSearch=function(){c.go("qSearch")}}]),APP.service("heIssueService",["$http","UrlService",function(e,t){this.getMyIssue=function(o,i,s,n){return e({method:"post",url:t.getUrl("GET_USER_ISSUE_LIST"),data:{pageIndex:o,pageSize:i,userId:s,storyType:n}})},this.getMyStory=function(o,i,s){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyComment=function(o,i,s,n){return e({method:"post",url:t.getUrl("GET_MY_COMMENT_LIST"),data:{pageIndex:o,pageSize:i,userId:s,commentType:n}})},this.myCommentId="",this.getDaShang=function(o,i,s){return e({method:"post",url:t.getUrl("GET_UCTIP_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getCollection=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyJoinedTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_JOINTOPIC_LIST"),data:{userCode:o}})},this.getMyCreatTopics=function(o){return e({method:"post",url:t.getUrl("GET_USER_CREATETOPIC_LIST"),data:{userCode:o}})},this.pushPraise=function(o){return e({method:"POST",url:t.getUrl("COMMENT_PRAISE"),data:o})},this.SchoolPraise=function(o){return e({method:"POST",url:t.getUrl("SCHOOLPRAISESTORY"),data:o})},this.getUserPraise=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_PRAISE_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.filter("commentArrImg",function(){return function(e){return e.split(",")}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".padding_zero {\n  padding: 0;\n}\n\n.ionic_datepicker_popup .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_popup .padding_top_zero {\n  padding-top: 0;\n}\n.ionic_datepicker_popup .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_popup .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_popup .calendar_grid {\n  height: 215px;\n}\n.ionic_datepicker_popup .today {\n  border: 1px solid #009688;\n  border-radius: 50%;\n}\n.ionic_datepicker_popup .selected_date {\n  background-color: #009688;\n  border-radius: 50%;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_popup .popup-head {\n  background-color: #009688;\n  display: none;\n}\n.ionic_datepicker_popup .popup-head .popup-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-head .popup-sub-title {\n  color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body {\n  background-color: #ffffff;\n}\n.ionic_datepicker_popup .popup-body .selected_date_full {\n  background-color: #019688;\n  margin: -10px -10px 0 -10px;\n  height: 45px;\n  text-align: center;\n  font-weight: bold;\n  color: #fff;\n  line-height: 45px;\n  font-size: 18px;\n}\n.ionic_datepicker_popup .popup-body .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_popup .popup-body .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_popup .popup-body .month_select, .ionic_datepicker_popup .popup-body .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select .input-label, .ionic_datepicker_popup .popup-body .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select select, .ionic_datepicker_popup .popup-body .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .month_select:after, .ionic_datepicker_popup .popup-body .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-body .show_nav {\n  padding: 10px 0 0 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section {\n  padding: 5px 0;\n  text-align: left;\n}\n.ionic_datepicker_popup .popup-body .show_nav .prev_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section {\n  padding: 5px 0;\n  text-align: right;\n}\n.ionic_datepicker_popup .popup-body .show_nav .next_btn_section button {\n  padding: 0;\n}\n.ionic_datepicker_popup .popup-body .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 45px;\n}\n.ionic_datepicker_popup .popup-buttons button {\n  background-color: #009688;\n  border-radius: 0;\n  margin-right: 1px;\n  color: #ffffff;\n}\n\n.ionic_datepicker_modal .header, .ionic_datepicker_modal .footer {\n  background-color: #009688;\n}\n.ionic_datepicker_modal .header .title, .ionic_datepicker_modal .header .button, .ionic_datepicker_modal .footer .title, .ionic_datepicker_modal .footer .button {\n  color: #ffffff;\n}\n.ionic_datepicker_modal .footer .button-block {\n  margin: 0;\n}\n.ionic_datepicker_modal .today {\n  border: 1px solid #009688;\n}\n.ionic_datepicker_modal .selected_date {\n  background-color: #009688;\n  color: #fff;\n  font-weight: bold;\n}\n.ionic_datepicker_modal .pointer_events_none {\n  pointer-events: none;\n  color: #aaaaaa !important;\n}\n.ionic_datepicker_modal .select_section {\n  padding: 1px 5px;\n}\n.ionic_datepicker_modal .button-clear {\n  color: #009688;\n}\n.ionic_datepicker_modal .month_select, .ionic_datepicker_modal .year_select {\n  border: none;\n  border-bottom: 1px solid #009688;\n  padding: 0;\n}\n.ionic_datepicker_modal .month_select .input-label, .ionic_datepicker_modal .year_select .input-label {\n  padding: 2px 0;\n  width: 0;\n}\n.ionic_datepicker_modal .month_select select, .ionic_datepicker_modal .year_select select {\n  left: 10px;\n  border: none;\n  padding: 0 10px;\n}\n.ionic_datepicker_modal .month_select:after, .ionic_datepicker_modal .year_select:after {\n  right: 5px;\n  color: #009688;\n}\n.ionic_datepicker_modal .padding_left_5px {\n  padding-left: 5px;\n}\n.ionic_datepicker_modal .padding_right_5px {\n  padding-right: 5px;\n}\n.ionic_datepicker_modal .date_col {\n  height: 50px;\n  line-height: 50px;\n}\n.ionic_datepicker_modal .font_bold {\n  font-weight: bold;\n}\n.ionic_datepicker_modal .font_22px {\n  font-size: 22px;\n}\n.platform-android .ionic_datepicker_modal .bar .title.title-left {\n  text-align: center;\n}\n.platform-android .ionic_datepicker_modal select {\n  left: 25%;\n}\n.platform-ios .ionic_datepicker_modal select {\n  left: 5%;\n}"),APP.run(["$templateCache",function(e){
e.put("ionic-datepicker-modal.html",'<ion-modal-view class="ionic_datepicker_modal">\n  <ion-header-bar class="header">\n    <h1 class="title">{{selctedDateEpoch | date : mainObj.dateFormat}}</h1>\n  </ion-header-bar>\n  <ion-content class="ionic_datepicker_modal_content">\n    <div class="">\n      <div class="row text-center">\n        <div class="col col-10 left_arrow">\n          <button class="button-clear font_22px" ng-click="prevMonth()"\n                  ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n            <i class="icon ion-chevron-left"></i>\n          </button>\n        </div>\n        <div class="col col-80 text-center">\n          <div class="row select_section">\n            <div class="col-50 padding_right_5px">\n              <label class="item item-input item-select month_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n                  <option ng-repeat="month in monthsList" ng-selected="month == currentMonthSelected" value="{{month}}">\n                    {{month}}\n                  </option>\n                </select>\n              </label>\n            </div>\n            <div class="col-50 padding_left_5px">\n              <label class="item item-input item-select year_select">\n                <span class="input-label">&nbsp;</span>\n                <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class="col col-10 right_arrow">\n          <button class=" button-clear font_22px" ng-click="nextMonth()"\n                  ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n            <i class="icon ion-chevron-right"></i>\n          </button>\n        </div>\n      </div>\n      <div class="calendar_grid">\n        <div class="row padding-top weeks_row">\n          <div class="col text-center font_bold"\n               ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n        </div>\n        <div>\n          <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n            <div class="col padding_zero date_col" ng-repeat="col in cols track by $index"\n                 ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || (dayList[row + $index].disabled))}"\n                 ng-click="dateSelected(dayList[row + $index])">\n              <div class="date_cell">\n                {{dayList[row + col].date}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n  <ion-footer-bar class="footer">\n    <div class="row padding_zero">\n      <button class="button button-clear button-block button_set" ng-if="!mainObj.closeOnSelect"\n              ng-click="setIonicDatePickerDate()">{{mainObj.setLabel}}\n      </button>\n      <button class="button button-clear button-block button_today"  ng-if="mainObj.showTodayButton"\n              ng-click="setIonicDatePickerTodayDate()">{{mainObj.todayLabel}}\n      </button>\n      <button class="button button-clear button-block button_close"\n              ng-click="closeIonicDatePickerModal()">{{mainObj.closeLabel}}\n      </button>\n    </div>\n  </ion-footer-bar>\n</ion-modal-view>\n')}]),APP.run(["$templateCache",function(e){e.put("ionic-datepicker-popup.html",'<div class="selected_date_full">{{selctedDateEpoch | date : mainObj.dateFormat}}</div>\n<div class="date_selection">\n  <div class="row show_nav">\n    <div class="col-10 prev_btn_section">\n      <button class="button-clear" ng-click="prevMonth()"\n              ng-class="{\'pointer_events_none\':((firstDayEpoch - 86400000) < fromDate)}">\n        <i class="icon ion-chevron-left"></i>\n      </button>\n    </div>\n    <div class="col-80 text-center">\n      <div class="row select_section">\n        <div class="col-50 padding_right_5px">\n          <label class="item item-input item-select month_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentMonth" ng-change="monthChanged(currentMonth)">\n              <option ng-repeat="month in monthsList" ng-selected="month==currentMonthSelected" value="{{month}}">\n                {{month}}\n              </option>\n            </select>\n          </label>\n        </div>\n        <div class="col-50 padding_left_5px">\n          <label class="item item-input item-select year_select">\n            <span class="input-label">&nbsp;</span>\n            <select ng-model="currentYear" ng-change="yearChanged(currentYear)" ng-options="year for year in yearsList"></select>\n          </label>\n        </div>\n      </div>\n    </div>\n    <div class="col-10 next_btn_section">\n      <button class="button-clear" ng-click="nextMonth()"\n              ng-class="{\'pointer_events_none\':((lastDayEpoch + 86400000)> toDate)}">\n        <i class="icon ion-chevron-right"></i>\n      </button>\n    </div>\n  </div>\n  <div class="calendar_grid">\n    <div class="row weeks_row">\n      <div class="col text-center font_bold"\n           ng-repeat="weekName in weeksList track by $index" ng-bind="weekName"></div>\n    </div>\n    <div>\n      <div class="row text-center padding_top_zero" ng-repeat="row in rows track by $index">\n        <div class="col no_padding date_col" ng-repeat="col in cols track by $index"\n             ng-class="{\'selected_date\': (dayList[row + $index].epoch === selctedDateEpoch),\n                      \'today\' : (dayList[row + $index].epoch == today),\n                      \'pointer_events_none\':((disabledDates.indexOf(dayList[row + $index].epoch) >= 0) || dayList[row + $index].disabled)}"\n             ng-click="dateSelected(dayList[row + $index])">\n          <div class="date_cell">\n            {{dayList[row + col].date}}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),APP.provider("ionicDatePicker2",function(){var e={inputDate:new Date,from:new Date(2012,8,1),to:new Date(2018,8,1),setLabel:"确定",todayLabel:"今天",closeLabel:"关闭",mondayFirst:!0,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],templateType:"popup",dateFormat:"yyyy-MM-dd",showTodayButton:!1,closeOnSelect:!1,disableWeekdays:[]};this.configDatePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup","$ionicModal","IonicDatepickerService2",function(t,o,i,s){function n(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function a(e){e.disabledDates&&0!==e.disabledDates.length?(p.disabledDates=[],angular.forEach(e.disabledDates,function(e,t){e=n(new Date(e)),p.disabledDates.push(e.getTime())})):p.disabledDates=[]}function r(e){e=n(e),p.currentDate=angular.copy(e);var t=new Date(e.getFullYear(),e.getMonth(),1).getDate(),o=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();p.monthsList=[],p.mainObj.monthsList&&12===p.mainObj.monthsList.length?p.monthsList=p.mainObj.monthsList:p.monthsList=s.monthsList,p.yearsList=s.getYearsList(p.mainObj.from,p.mainObj.to),p.dayList=[];var i,a;p.firstDayEpoch=n(new Date(e.getFullYear(),e.getMonth(),t)).getTime(),p.lastDayEpoch=n(new Date(e.getFullYear(),e.getMonth(),o)).getTime();for(var r=t;r<=o;r++)i=new Date(e.getFullYear(),e.getMonth(),r),a=i.getTime()<p.fromDate||i.getTime()>p.toDate||p.mainObj.disableWeekdays.indexOf(i.getDay())>=0,p.dayList.push({date:i.getDate(),month:i.getMonth(),year:i.getFullYear(),day:i.getDay(),epoch:i.getTime(),disabled:a});var c=p.dayList[0].day-p.mainObj.mondayFirst;c=c<0?6:c;for(var l=0;l<c;l++)p.dayList.unshift({});p.rows=[0,7,14,21,28,35],p.cols=[0,1,2,3,4,5,6],p.currentMonth=p.mainObj.monthsList[e.getMonth()],p.currentYear=e.getFullYear(),p.currentMonthSelected=angular.copy(p.currentMonth),p.currentYearSelected=angular.copy(p.currentYear),p.numColumns=7}function c(e){p.mainObj=angular.copy(e),p.selctedDateEpoch=n(p.mainObj.inputDate).getTime(),p.mainObj.weeksList&&7===p.mainObj.weeksList.length?p.weeksList=p.mainObj.weeksList:p.weeksList=["S","M","T","W","T","F","S"],p.mainObj.mondayFirst&&p.weeksList.push(p.mainObj.weeksList.shift()),p.disableWeekdays=p.mainObj.disableWeekdays,r(p.mainObj.inputDate),a(p.mainObj)}function l(){p.modal.show()}function d(){p.modal.hide()}var u={},p=t.$new();return p.today=n(new Date).getTime(),p.disabledDates=[],p.prevMonth=function(){1===p.currentDate.getMonth()&&p.currentDate.setFullYear(p.currentDate.getFullYear()),p.currentDate.setMonth(p.currentDate.getMonth()-1),p.currentMonth=p.mainObj.monthsList[p.currentDate.getMonth()],p.currentYear=p.currentDate.getFullYear(),r(p.currentDate)},p.nextMonth=function(){11===p.currentDate.getMonth()&&p.currentDate.setFullYear(p.currentDate.getFullYear()),p.currentDate.setDate(1),p.currentDate.setMonth(p.currentDate.getMonth()+1),p.currentMonth=p.mainObj.monthsList[p.currentDate.getMonth()],p.currentYear=p.currentDate.getFullYear(),r(p.currentDate)},p.dateSelected=function(e){e&&0!==Object.keys(e).length&&(p.selctedDateEpoch=e.epoch,p.mainObj.closeOnSelect&&(p.mainObj.callback(p.selctedDateEpoch),"popup"==p.mainObj.templateType.toLowerCase()?p.popup.close():d()))},p.setIonicDatePickerTodayDate=function(){var e=new Date;r(new Date),p.selctedDateEpoch=n(e).getTime(),p.mainObj.closeOnSelect&&(p.mainObj.callback(p.selctedDateEpoch),d())},p.setIonicDatePickerDate=function(){p.mainObj.callback(p.selctedDateEpoch),d()},p.monthChanged=function(e){var t=p.monthsList.indexOf(e);p.currentDate.setMonth(t),r(p.currentDate)},p.yearChanged=function(e){p.currentDate.setFullYear(e),r(p.currentDate)},i.fromTemplateUrl("ionic-datepicker-modal.html",{scope:p,animation:"slide-in-up"}).then(function(e){p.modal=e}),p.$on("$destroy",function(){p.modal.remove()}),p.closeIonicDatePickerModal=function(){d()},u.openDatePicker=function(t){var i=[];delete p.fromDate,delete p.toDate,p.mainObj=angular.extend({},e,t),p.mainObj.from&&(p.fromDate=n(new Date(p.mainObj.from)).getTime()),p.mainObj.to&&(p.toDate=n(new Date(p.mainObj.to)).getTime()),t.disableWeekdays&&e.disableWeekdays&&(p.mainObj.disableWeekdays=t.disableWeekdays.concat(e.disableWeekdays)),c(p.mainObj),p.mainObj.closeOnSelect||(i=[{text:p.mainObj.setLabel,type:"button_set",onTap:function(e){p.mainObj.callback(p.selctedDateEpoch)}}]),p.mainObj.showTodayButton&&i.push({text:p.mainObj.todayLabel,type:"button_today",onTap:function(e){var t=new Date;r(new Date),p.selctedDateEpoch=n(t).getTime(),p.mainObj.closeOnSelect||e.preventDefault()}}),i.push({text:p.mainObj.closeLabel,type:"button_close",onTap:function(e){}}),"popup"==p.mainObj.templateType.toLowerCase()?(p.currentYear=(new Date).getFullYear(),p.popup=o.show({templateUrl:"ionic-datepicker-popup.html",scope:p,cssClass:"ionic_datepicker_popup",buttons:i})):l()},u}]}),APP.service("IonicDatepickerService2",function(){this.monthsList=["January","February","March","April","May","June","July","August","September","October","November","December"],this.getYearsList=function(e,t){var o=[],i=1900,s=2100;i=e?new Date(e).getFullYear():i,s=t?new Date(t).getFullYear():s;for(var n=i;n<=s;n++)o.push(n);return o}}),function(e,t){var o=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(o),o.styleSheet)o.styleSheet.disabled||(o.styleSheet.cssText=t);else try{o.innerHTML=t}catch(e){o.innerText=t}}(document,".ionic_timepicker_popup .font_28px {\n  font-size: 28px;\n}\n.ionic_timepicker_popup .margin_zero {\n  margin: 0;\n}\n.ionic_timepicker_popup .padding_zero {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup {\n  background-color: #ffffff;\n}\n.ionic_timepicker_popup .popup-head {\n  display: none;\n}\n.ionic_timepicker_popup .popup-body {\n  padding: 0;\n}\n.ionic_timepicker_popup .popup-buttons {\n  padding: 0;\n  min-height: 44px;\n  height: 44px;\n}\n.ionic_timepicker_popup .popup-buttons .button:not(:last-child) {\n  margin-right: 1px;\n}\n.ionic_timepicker_popup .padding_left_15px {\n  padding-left: 15px;\n}\n.ionic_timepicker_popup .heading {\n  height: 44px;\n  background-color: #009688;\n  color: #ffffff;\n  text-align: center;\n  line-height: 44px;\n  font-size: 18px;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_colon {\n  padding-top: 45px;\n  text-align: center;\n  font-weight: bold;\n}\n.ionic_timepicker_popup .time_picker_arrows {\n  width: 100%;\n}\n.ionic_timepicker_popup .time_picker_box_text {\n  height: 40px;\n  text-align: center;\n  border: 1px solid #dddddd;\n  font-size: 16px;\n  line-height: 38px;\n}\n.ionic_timepicker_popup .overflowShow {\n  white-space: normal !important;\n}\n.ionic_timepicker_popup .button_set, .ionic_timepicker_popup .button_close {\n  background-color: #009688;\n  color: #ffffff;\n}"),APP.run(["$templateCache",function(e){e.put("ionic-timepicker.html",'<div><div class=heading>{{time.hours}} : {{time.minutes}} <span ng-show="time.format == 12">{{time.meridian}}</span></div><div class=row ng-class="{\'padding_left_15px\':time.format == 12}"><div class="col col-25" ng-class="{\'col-offset-20 col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseHours()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.hours class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseHours()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon">:</label><div class="col col-25" ng-class="{\'col-25\':time.format == 24}"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=increaseMinutes()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.minutes class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=decreaseMinutes()><i class="icon ion-chevron-down"></i></button></div><label class="col col-10 time_picker_colon" ng-if="time.format == 12">:</label><div class="col col-25" ng-if="time.format == 12"><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-up"></i></button><div ng-bind=time.meridian class=time_picker_box_text></div><button type=button class="button button-clear button-small button-dark time_picker_arrows" ng-click=changeMeridian()><i class="icon ion-chevron-down"></i></button></div></div></div>')}]),APP.provider("ionicTimePicker",function(){var e={setLabel:"确定",closeLabel:"关闭",inputTime:60*(new Date).getHours()*60+60*(new Date).getMinutes(),format:24,step:1};this.configTimePicker=function(t){angular.extend(e,t)},this.$get=["$rootScope","$ionicPopup",function(t,o){function i(e,t){n.time.hours=Math.floor(e/3600);var o=e%3600;12==t&&(n.time.hours>12?(n.time.hours-=12,n.time.meridian="PM"):n.time.meridian="AM"),n.time.minutes=o/60,n.time.hours=n.time.hours.toFixed(0),n.time.minutes=n.time.minutes.toFixed(0),1==n.time.hours.toString().length&&(n.time.hours="0"+n.time.hours),1==n.time.minutes.toString().length&&(n.time.minutes="0"+n.time.minutes),n.time.format=n.mainObj.format}var s={},n=t.$new();return n.today=function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}(new Date).getTime(),n.time={},n.increaseHours=function(){n.time.hours=Number(n.time.hours),12==n.mainObj.format&&(12!=n.time.hours?n.time.hours+=1:n.time.hours=1),24==n.mainObj.format&&(n.time.hours=(n.time.hours+1)%24),n.time.hours=n.time.hours<10?"0"+n.time.hours:n.time.hours},n.decreaseHours=function(){n.time.hours=Number(n.time.hours),12==n.mainObj.format&&(n.time.hours>1?n.time.hours-=1:n.time.hours=12),24==n.mainObj.format&&(n.time.hours=(n.time.hours+23)%24),n.time.hours=n.time.hours<10?"0"+n.time.hours:n.time.hours},n.increaseMinutes=function(){n.time.minutes=Number(n.time.minutes),n.time.minutes=(n.time.minutes+n.mainObj.step)%60,n.time.minutes=n.time.minutes<10?"0"+n.time.minutes:n.time.minutes},n.decreaseMinutes=function(){n.time.minutes=Number(n.time.minutes),n.time.minutes=(n.time.minutes+(60-n.mainObj.step))%60,n.time.minutes=n.time.minutes<10?"0"+n.time.minutes:n.time.minutes},n.changeMeridian=function(){n.time.meridian="AM"===n.time.meridian?"PM":"AM"},s.openTimePicker=function(t){var s=[];n.mainObj=angular.extend({},e,t),i(n.mainObj.inputTime,n.mainObj.format),s.push({text:n.mainObj.setLabel,type:"button_set",onTap:function(e){var t=0;12==n.time.format?(n.time.hours=Number(n.time.hours),"PM"==n.time.meridian&&12!=n.time.hours?n.time.hours+=12:"AM"==n.time.meridian&&12==n.time.hours&&(n.time.hours-=12),t=60*n.time.hours*60+60*n.time.minutes):t=60*n.time.hours*60+60*n.time.minutes,n.mainObj.callback(t)}}),s.push({text:n.mainObj.closeLabel,type:"button_close"}),n.popup=o.show({templateUrl:"ionic-timepicker.html",scope:n,cssClass:"ionic_timepicker_popup",buttons:s})},s}]}),APP.controller("manageUserController",["$scope","$state","$stateParams","manageUserService","$ionicScrollDelegate","PopupService","anchorScroll","$ionicPopup",function(e,t,o,i,s,n,a,r){e.mainuserlist="",e.userlist="",e.topicId="",e.aList=[],e.isShut=[],e.input={isinput:""},e.goBack=function(){t.go("allMembers",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.selectUser=function(t){for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].id==t.id&&("img/ic_select.png"==e.mainuser2list[o].ischeck?e.mainuser2list[o].ischeck="img/ic_check.png":e.mainuser2list[o].ischeck="img/ic_select.png");for(var i=0;i<e.userlist.length;i++)t.id==e.userlist[i].id&&("img/ic_select.png"==e.userlist[i].ischeck?(e.userlist[i].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[i].ischeck="img/ic_select.png",e.userCode=t.userCode))},e.allDo=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var t=0;t<e.mainuser2list.length;t++)e.mainuser2list[t].ischeck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}else if("img/ic_select.png"==e.allcheck){e.allcheck="img/ic_check.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png"}else{e.allcheck="img/ic_select.png";for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_select.png"}},e.noSpeak=function(){for(var t=0;t<e.userlist.length;t++)"img/ic_select.png"==e.userlist[t].ischeck&&(e.isShut.push(e.userlist[t].isgag),e.manageList.push(e.userlist[t].userCode));if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var o=0;o<e.mainuser2list.length;o++)"img/ic_select.png"==e.mainuser2list[o].ischeck&&(e.isShut.push(e.mainuser2list[o].isgag),e.manageList.push(e.mainuser2list[o].userCode));if(e.manageList.length>0){for(var i=e.manageList.join(","),s={topicId:e.topicId,userCode:i,isGag:1},a=0;a<e.isShut.length;a++)1==e.isShut[a]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(s)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else e.yesno&&!e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,n.showToast("已选对象为禁言者，无需禁言")):e.ok(s)}else n.showToast("您还没有选择任何成员")},e.release=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&(e.isShut.push(e.mainuser2list[t].isgag),e.manageList.push(e.mainuser2list[t].userCode));for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&(e.isShut.push(e.userlist[o].isgag),e.manageList.push(e.userlist[o].userCode));if(e.manageList.length>0){for(var i=e.manageList.join(","),s={topicId:e.topicId,userCode:i,isGag:0},a=0;a<e.isShut.length;a++)1==e.isShut[a]?e.yesno=!0:e.noyes=!0;if(e.yesno&&e.noyes){r.show({template:"<p>你选择的对象有禁言和非禁言，确认全部解除禁言？</p>",title:"提示",subTitle:"Please use normal things",scope:e,buttons:[{text:"<span>确认</span>",type:"",onTap:function(){e.ok(s)}},{text:"取消",onTap:function(){e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1}}]})}else!e.yesno&&e.noyes?(e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,n.showToast("已选对象为非禁言者，无需解除")):e.ok(s)}else n.showToast("您还没有选择任何成员")},e.ok=function(t){i.manageUser(t).success(function(t){e.allcheck="img/ic_check.png",e.manageList=[],e.isShut=[],e.yesno=!1,e.noyes=!1,e.getallList()}).error(function(){})},e.yes=function(){if("true"==e.datalist.data.ifHost||"true"==e.datalist.data.isManager)for(var t=0;t<e.mainuser2list.length;t++)"img/ic_select.png"==e.mainuser2list[t].ischeck&&e.manageList.push(e.mainuser2list[t].userCode);for(var o=0;o<e.userlist.length;o++)"img/ic_select.png"==e.userlist[o].ischeck&&e.manageList.push(e.userlist[o].userCode);if(e.manageList.length>0){var s=e.manageList.join(","),a={topicId:e.topicId,userCodeS:s,isAll:0};i.delectUser(a).success(function(t){t.success?(e.getallList(),n.showToast("删除成功")):n.showToast(t.message)}).error(function(){})}else n.showToast("您还没有选择任何成员")},e.search=function(t){var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var a=0;a<e.userlist.length;a++)"#"==e.userlist[a].categoryName&&(e.userlist[a].categoryName="toOther");for(var r=0;r<e.mainuser2list.length;r++)e.mainuser2list[r].ischeck="img/ic_check.png";for(var a=0;a<e.userlist.length;a++)e.userlist[a].ischeck="img/ic_check.png";s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.getallList=function(){var t={topicId:e.topicId,pageSize:20,pageIndex:1};i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list,e.mainuser2list=t.data.list2;for(var o=0;o<e.mainuser2list.length;o++)e.mainuser2list[o].ischeck="img/ic_check.png";for(var i=0;i<e.userlist.length;i++)e.userlist[i].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var i=e.userlist.length;e.hasmore=!(i===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.hasmore=!1,e.yesno=!1,e.noyes=!1,e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.isShut=[],e.allcheck="img/ic_check.png",e.userCode="",e.manageList=[],e.pageIndex=1,e.input={isinput:""},e.getallList()},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("manageUserService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.manageUser=function(o){return e.post(t.getUrl("CIRCLE_MANAGE_USER"),o)},this.delectUser=function(o){return e.post(t.getUrl("CIRCLE_DELECT_USER"),o)}}]),APP.controller("moreInterestingCtrl",["$scope","$state","$timeout","PopupService","myFansService",function(e,t,o,i,s){e.myInterested={pageIndex:0,pageSize:8,interestedList:[],hasMore:!0,api:function(e,t){return s.getMyInterested(e,t)}},e.init=function(){e.myInterested.hasMore=!0,e.myInterested.pageIndex=0,e.myInterested.interestedList=[],e.loadData(e.myInterested,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(t,s){void 0==s&&(s=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(i){o(function(){1==i.success&&(t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.interestedList=t.interestedList.concat(i.data.list),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络错误！")})},e.followI=function(t,n){var a=n?1:0;s.follow(t.memberId,a).success(function(i){if(1==i.success)for(var s=0;s<e.myInterested.interestedList.length;s++)t.memberId==e.myInterested.interestedList[s].memberId&&(e.myInterested.interestedList.splice(s,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3))}).error(function(){i.showToast("网络错误！")})},e.viewHim=function(e){t.go("personalHomepageHe",{othersId:e})}}]),APP.controller("myFansCtrl",["$scope","$timeout","$state","PopupService","myFansService",function(e,t,o,i,s){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFansData={pageIndex:0,pageSize:6,myFans:[],hasMore:!0,api:function(e,t){return s.getMyFans(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFansData.pageIndex=0,e.myFansData.myFans=[],e.myFansData.hasMore=!0,s.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){i.showToast("网络错误！")}),e.loadData(e.myFansData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadData=function(o,s){void 0==s&&(s=1e3),o.pageIndex=o.pageIndex+1,o.api(o.pageIndex,o.pageSize).success(function(i){t(function(){1==i.success&&(o.hasMore=o.pageIndex*o.pageSize<i.totalCount,o.myFans=o.myFans.concat(i.data.list),e.nothing=!o.myFans.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},s)}).error(function(){i.showToast("网络错误！")})},e.followI=function(o,n){var a=n?1:0;s.follow(o.memberId,a).success(function(i){if(1==i.success){for(var s=0;s<e.interested.length;s++)o.memberId==e.interested[s].memberId&&e.interested.splice(s,1);n&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}}).error(function(){i.showToast("网络错误！")})},e.followF=function(o,n){var a=n?1:0,r=o.followId?o.followId:o.memberId;s.follow(r,a).success(function(o){o.success,n&&(e.alreadyFollow=!0,t(function(){e.alreadyFollow=!1},1e3))}).error(function(){i.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){o.go("moreInteresting")},e.jumpMsg=function(){o.go("messageCenter")},e.viewHim=function(e){e.followId?o.go("personalHomepageHe",{othersId:e.followId}):o.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFansService",["$http","UrlService",function(e,t){this.getMyFans=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("MY_FANS"),data:s})},this.getMyInterested=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("INTERESTED"),data:s})},this.follow=function(o,i){var s={id:o,isFollow:i};return e({method:"post",url:t.getUrl("FOLLOW"),data:s})}}]),APP.controller("myFollowCtrl",["$scope","$rootScope","$timeout","$state","PopupService","myFollowService","myFansService",function(e,t,o,i,s,n,a){e.isDisplay=!1,e.nothing=!1,e.interested=[],e.myFollowsData={pageIndex:0,pageSize:6,myFollows:[],hasMore:!0,api:function(e,t){return n.getMyFollows(e,t)}},e.init=function(){e.nothing=!1,e.isDisplay=!1,e.myFollowsData.pageIndex=0,e.myFollowsData.myFollows=[],e.myFollowsData.hasMore=!0,a.getMyInterested(1,3).then(function(t){e.interested=t.data.data.list},function(){s.showToast("网络错误！")}),e.loadFollowData(e.myFollowsData,0)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.loadFollowData=function(t,i){void 0==i&&(i=1e3),t.pageIndex=t.pageIndex+1,t.api(t.pageIndex,t.pageSize).success(function(s){o(function(){1==s.success&&(t.hasMore=t.pageIndex*t.pageSize<s.totalCount,t.myFollows=t.myFollows.concat(s.data.list),e.nothing=!t.myFollows.length,e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"))},i)}).error(function(){s.showToast("网络失败！")})},e.followI=function(t,i){var n=i?1:0;a.follow(t.memberId,n).success(function(i){if(1==i.success){for(var s=0;s<e.interested.length;s++)t.memberId==e.interested[s].memberId&&(e.interested.splice(s,1),e.alreadyFollow=!0,o(function(){e.alreadyFollow=!1},1e3));e.nothing=!1,t.isFollow=!t.isFollow,t.followId=t.memberId,e.myFollowsData.myFollows.push(t)}}).error(function(){s.showToast("网络失败！")})},e.followF=function(t,o){var i=o?1:0,n=t.followId?t.followId:t.memberId;a.follow(n,i).success(function(t){if(1==t.success)for(var o=0;o<e.myFollowsData.myFollows.length;o++)n==e.myFollowsData.myFollows[o].followId&&(e.myFollowsData.myFollows.splice(o,1),e.myFollowsData.myFollows.length||(e.nothing=!0))}).error(function(){s.showToast("网络失败！")})},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.more=function(){i.go("moreInteresting")},e.jumpMsg=function(){i.go("messageCenter")},e.viewHim=function(e){e.followId?i.go("personalHomepageHe",{othersId:e.followId}):i.go("personalHomepageHe",{othersId:e.memberId})}}]),APP.service("myFollowService",["$http","UrlService",function(e,t){this.getMyFollows=function(o,i){var s={pageIndex:o,pageSize:i};return e({method:"post",url:t.getUrl("MY_FOLLOWS"),data:s})}}]),APP.controller("mySettingsCtrl",["$scope","$state","$ionicPopup","mySettingsService","personalHomepageMeService","NoteDetailsService",function(e,t,o,i,s,n){e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.myInfo={},e.data={},e.userId="",e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.jumpMsg=function(){t.go("qzMessageCenter")},e.creditDetails=function(){t.go("shop")},e.viewCredit=function(){t.go("quanziRecommend")},e.init=function(){e.userId="1",e.isDisplay=!1,s.getUserData("2",e.userId).success(function(t,o,i,s){1==t.success&&(e.myInfo=t.data)}).error(function(e,t,o,i){alert("网络失败！")})},e.apply=function(){window.alert("接口还没出来，你申请也没用，略略略……")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("mySettingsService",function(){}),APP.controller("personalHomepageHeCtrl",["HomePageService","heIssueService","$scope","$http","$rootScope","NoteDetailsService","$state","$timeout","$interval","$stateParams","$window","$location","$ionicScrollDelegate","UserService","PopupService","personalHomepageHeService","personalHomepageMeService","myFansService","communityRecommendService","UrlService","CreditService",function(HomePageService,heIssueService,$scope,$http,$rootScope,NoteDetailsService,$state,$timeout,$interval,$stateParams,$window,$location,$ionicScrollDelegate,UserService,PopupService,personalHomepageHeService,personalHomepageMeService,myFansService,communityRecommendService,UrlService,CreditService){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?($scope.paddingtopClass={"margin-top":"16px"},$scope.contentHeight={height:"296px"}):($scope.paddingtopClass={"margin-top":"0px"},$scope.contentHeight={height:"280px"}),$scope.gotoPriLetter=function(){$state.go("privateLetter",{userCode:$scope.othersId})},$scope.user=void 0,$scope.messageNum=void 0,$scope.ifRed=void 0,$scope.isDisplay=void 0,$scope.othersId="",$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.shopList=[],$scope.shareType=void 0,$scope.byShareLink=void 0,$scope.provinceId="",$scope.cityId="",$scope.regionId="",$scope.streetId="",$scope.showShare=!1,$scope.hisStory={nums:-1,pageIndex:0,pageSize:6,storyList:[],hasMore:!0,api:function(e,t,o){
return personalHomepageMeService.getMyStory(e,t,o)}},$scope.hisShare={nums:-1,pageIndex:0,pageSize:6,shareList:[],hasMore:!0,api:function(e,t,o){return personalHomepageHeService.hisShare(e,t,o)}},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.init=function(tab){switch(personalHomepageHeService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId}),$scope.user=UserService.getUser(),$scope.othersId=$stateParams.othersId,$scope.isDisplay=!1,$scope.byShareLink=!$rootScope.isApp,$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,$scope.tabNav="personalHomePageHe",$scope.hisLists=[{title:"dashang",icon:$rootScope.imgBaseURL+"img/homepage/dashang@2x.png",text:"TA的打赏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:$rootScope.imgBaseURL+"img/homepage/zan@2x.png",text:"TA的赞",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:$rootScope.imgBaseURL+"img/homepage/Shape@2x.png",text:"TA的收藏",nums:"0",goIcon:$rootScope.imgBaseURL+"img/homepage/go2@2x.png"}],tab){case 0:$scope.getShopList();break;case 1:$scope.getHisStory();break;case 2:$scope.getHisShare()}personalHomepageHeService.hisShare(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisShare.nums=e.data.totalCount)}),personalHomepageMeService.getMyStory(1,0,$stateParams.othersId).then(function(e){1==e.data.success&&($scope.hisStory.nums=e.data.totalCount)})},$scope.$on("$ionicView.beforeEnter",function(e,t){"forward"==t.direction||"exit"==t.direction||"none"==t.direction?$scope.init(0):"back"==t.direction&&($scope.isDisplay=!1,$scope.downRefresh($scope.selectedIndex))}),$scope.downRefresh=function(e){switch(e){case 0:$scope.hisInfo=void 0,$scope.shop=void 0,$scope.shopMessage=void 0,$scope.getShopList();break;case 1:$scope.hisStory.nums=-1,$scope.hisStory.hasMore=!0,$scope.hisStory.pageIndex=0,$scope.hisStory.storyList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisStory();break;case 2:$scope.hisShare.nums=-1,$scope.hisShare.hasMore=!0,$scope.hisShare.pageIndex=0,$scope.hisShare.shareList=void 0,personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){1==e.success&&($scope.hisInfo=e.data)}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}),$scope.getHisShare()}$scope.$broadcast("scroll.refreshComplete")},$scope.getShopList=function(){$scope.selectedIndex=0,$scope.hisInfo||(personalHomepageMeService.getUserData1("2",$scope.othersId).success(function(e){if(1==e.success){if($scope.hisInfo=e.data,e.data.storeGride)if($scope.levelArray=[],e.data.storeGride<=3)for(var t=0;t<e.data.storeGride;t++)$scope.levelArray.push("img/StarLevel@2x.png");else for(var t=0;t<e.data.storeGride-3;t++)$scope.levelArray.push("img/DiamondLevel@2x.png");$scope.hisInfo.isStore&&$scope.shop}}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData2("2",$scope.othersId).success(function(e){$scope.userData2=e.data}).error(function(){alert("网络失败！")}),personalHomepageMeService.getUserData3("2",$scope.othersId).success(function(e){$scope.userData3=e.data}).error(function(){alert("网络失败！")}))},$scope.loadGoods=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisGoods.goodsList=[]),e.api($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.data.storeItemsCounts,e.hasMore=e.pageIndex*e.pageSize<o.data.storeItemsCounts,e.goodsList=e.goodsList.concat(o.data.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisStory=function(){$scope.selectedIndex=1,$scope.hisStory.storyList||$scope.loadHisStory($scope.hisStory,0)},$scope.loadHisStory=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisStory.storyList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.storyList=e.storyList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.getHisShare=function(){$scope.selectedIndex=2,$scope.hisShare.shareList||$scope.loadShare($scope.hisShare,0)},$scope.loadShare=function(e,t){void 0==t&&(t=1e3),e.pageIndex=e.pageIndex+1,1==e.pageIndex&&($scope.hisShare.shareList=[]),e.api(e.pageIndex,e.pageSize,$stateParams.othersId).success(function(o){$timeout(function(){1==o.success&&(e.nums=o.totalCount,e.hasMore=e.pageIndex*e.pageSize<o.totalCount,e.shareList=e.shareList.concat(o.data.list),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.$broadcast("scroll.refreshComplete"))},t)}).error(function(){alert("网络失败！")})},$scope.downloadSg=function(){var e=$rootScope.isIOS?"https://itunes.apple.com/cn/app/shun-guang-wei-dian/id1035160364?mt=8":"http://app.qq.com/#id=detail&appid=1104761357";$window.location.assign(e)},$scope.hideDownload=function(){$scope.byShareLink=!1},$scope.show=function(){$scope.isDisplay=!$scope.isDisplay},$scope.disappear=function(){$scope.isDisplay=!1},$scope.dealStory=function(e,t){var o=e.storyTopicId?e.storyTopicId:e.id;personalHomepageHeService.dealStory(o,t).then(function(o){if(1==o.data.success){var i;switch(t){case 1:i=parseInt(e.praiseNumber),e.praiseNumber=e.praiseFlag?i-1:i+1,e.praiseFlag=!e.praiseFlag;break;case 2:i=parseInt(e.collectionNumber),e.collectionNumber=e.collectionFlag?i-1:i+1,e.collectionFlag=!e.collectionFlag;break;case 3:i=parseInt(e.praiseNumber1),e.praiseNumber1=e.praiseFlag1?i-1:i+1,e.praiseFlag1=!e.praiseFlag1;break;case 4:i=parseInt(e.collectionNumber1),e.collectionNumber1=e.collectionFlag1?i-1:i+1,e.collectionFlag1=!e.collectionFlag1}}else PopupService.showToast(o.data.message)},function(){PopupService.showToast("网络错误！")})},$scope.follow=function(e){HomePageService.isWdHost().success(function(t){if($rootScope.isWdHost=t.data.isHost,-1==$rootScope.isWdHost)$state.go("login");else if(0==e){var o={id:$stateParams.othersId,isFollow:1};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.isFollow=1,$scope.hisInfo.praise+=1,$scope.alreadyFollow=!0,$timeout(function(){$scope.alreadyFollow=!1},1e3)):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}else if(1==e){var o={id:$stateParams.othersId,isFollow:0};NoteDetailsService.followNote(o).success(function(e){1==e.success?($scope.hisInfo.praise-=1,$scope.hisInfo.isFollow=0):-2e3==e.errorCode&&(PopupService.showToast(e.message),$rootScope.loginIsAccord2=!0)})}})},$scope.ToIssue=function(e,t,o){"issue"==e&&heIssueService.getMyIssue(1,5,o,0).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"comment"==e&&heIssueService.getMyComment(1,5,o,0).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"quanzi"==e&&heIssueService.getMyJoinedTopics(o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"dashang"==e&&heIssueService.getDaShang(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"zan"==e&&heIssueService.getUserPraise(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})}),"shoucang"==e&&heIssueService.getCollection(1,5,o).success(function(i){-2e3==i.errorCode?(PopupService.showToast(i.message),$rootScope.loginIsAccord2=!0):1==i.success&&$state.go("heIssue",{title:e,who:t,id:o})})},$scope.joinTopic=function(e){var t=e.storyTopicId;communityRecommendService.joinTopic(t).then(function(t){1==t.data.success?e.topicFocusFlag=!0:-2e3==t.errorCode&&(PopupService.showToast(t.data.message),$rootScope.loginIsAccord2=!0)},function(){PopupService.showToast("网络错误")})},$scope.addToCart=function(e){var t={productId:e,number:1,o2oStoreName:"",o2omap:e+","};personalHomepageHeService.toCart(t).then(function(e){1==e.data.success?PopupService.showToast("加入购物车成功"):PopupService.showToast(e.data.message)},function(e){PopupService.showToast(e)})},$scope.viewHim=function(e){$state.go("personalHomepageHe",{othersId:e})},$scope.toProductDetails=function(e){$state.go("productDetail",{productId:e.productId,o2oType:e.o2oType,fromType:e.fromType,storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId})},$scope.viewShop=function(){window.cordova&&$rootScope.gio.evar.set({source:"Community",value:$scope.shop?$scope.shop.storeId:$stateParams.othersId}),$state.go("myStore",{storeId:$scope.shop?$scope.shop.storeId:$stateParams.othersId,shareStoreId:""})},$scope.jumpMsg=function(){$state.go("messageCenter")},$scope.viewStory=function(e){var t=e.storyTopicId?e.storyTopicId:e.id;2!==e.flag?$state.go("noteDetails",{noteId:t,isShortStory:e.isShortStory}):$state.go("classNoteDetails",{noteId:t})},$scope.viewTopic=function(e){$state.go("circlePage",{circleId:e})},$scope.share=function(e){if(window.umeng){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare,$scope.shareType=e}else alert("只能在app分享,请下载app！")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e,t){var o,i,s,n;t?$scope.shop&&(o=($scope.shop.storeName?$scope.shop.storeName:"他")+"的顺逛小店",i="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=UrlService.getShareLinkHeader()+"myStore/"+$scope.shop.storeId+"/"+$scope.shop.storeId+"/"):(o=($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的空间",i="欢迎关注"+($scope.hisInfo.userName?$scope.hisInfo.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=UrlService.getShareLinkHeader()+"personalHomePageHe/"+$scope.hisInfo.memberId),window.umeng?0==e?window.umeng.shareToSina(o,i,s,n,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,CreditService.shareSuccessCallback):3==e?window.umeng.shareToQQ(o,i,s,n,0,null,CreditService.shareSuccessCallback):4==e?window.umeng.shareToQzone(o,i,s,n,0,null,CreditService.shareSuccessCallback):5==e&&$scope.copeText(n):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")}}]),APP.service("personalHomepageHeService",["$http","UrlService",function(e,t){this.hisShare=function(o,i,s){var n={pageIndex:o,pageSize:i,userCode:s};return e({method:"post",url:t.getUrl("HIS_SHARE"),data:n})},this.toCart=function(o){var i={productId:o.productId,number:o.number,o2oStoreName:o.o2oStoreName,o2omap:o.o2omap};return e({method:"get",url:t.getUrl("SHOP_ADD_CART"),params:i})},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.dealStory=function(o,i){var s,n={id:o,noLoading:!0};switch(i){case 1:s="COMMENT_PRAISE";break;case 2:s="COLLECTION_TOPIC";break;case 3:s="SCHOOLPRAISESTORY";break;case 4:s="SCHOOLCOLLECTION"}return e({method:"post",url:t.getUrl(s),data:n})}}]),APP.controller("personalHomepageMeCtrl",["$scope","heIssueService","myFollowService","myFansService","$rootScope","$state","$timeout","$interval","$ionicScrollDelegate","PopupService","UserService","personalHomepageMeService","UrlService","personalHomepageHeService","$ionicModal","CreditService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.contentHeight={height:"296px"}):(e.paddingtopClass={"margin-top":"0px"},e.contentHeight={height:"280px"}),e.goBackTo=function(){e.$ionicGoBack()},e.messageNum=void 0,e.ifRed=void 0,e.isDisplay=void 0,e.userId="",e.user=void 0,e.userData={},e.data=[],e.story=void 0,e.selectedIndex=void 0,e.notApply=void 0,e.teachedList="",e.joinedList="",e.showShare=!1,e.myTopics=void 0,e.noTopic=!1,e.myStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return u.getMyStory(e,t)}},e.myCollectionStory={nums:-1,pageIndex:0,pageSize:6,storyList:void 0,hasMore:!0,api:function(e,t){return u.getMyCollection(e,t)}},e.init=function(t){e.tabNav="personalHomepageMe",e.hisLists=[{title:"dashang",icon:s.imgBaseURL+"img/homepage/dashang@2x.png",text:"我的打赏",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"},{title:"zan",icon:s.imgBaseURL+"img/homepage/zan@2x.png",text:"我的赞",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"},{title:"shoucang",icon:s.imgBaseURL+"img/homepage/Shape@2x.png",text:"我的收藏",nums:"0",goIcon:s.imgBaseURL+"img/homepage/go2@2x.png"}],m.fromTemplateUrl("templates/quanzi/ApplyTeacherModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.applyTeacherModal=t}),e.myTopics=void 0,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.notApply=!0,e.isDisplay=!1,e.data=[],e.selectedIndex=void 0,e.user=d.getUser(),e.userId=d.getUser().mid,u.getUserData1("2",e.userId).success(function(t){if(e.userData1=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(s.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(s.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),u.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),u.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),u.getMyCollection(1,0).then(function(t){1==t.data.success&&(e.myCollectionStory.nums=t.data.totalCount)}),e.$broadcast("scroll.refreshComplete")},e.showApplyModal=function(){u.startApply().success(function(t){t.success?0==t.data.applyStatus?e.data.isApply=!0:1==t.data.applyStatus?(e.message=t.message,e.applyStatus=1,e.applyTeacherModal.show()):(e.introduce=t.data.introduce,e.message=t.message,e.applyStatus=2,e.applyTeacherModal.show()):e.data.isApply=!1},function(e){})},e.hideApplyModal=function(){delete e.applyStatus,e.applyTeacherModal.hide()},e.jumpMyCircle=function(){n.go("myCirclePages")},e.applyStatus3=function(){e.hideApplyModal(),a(function(){e.applyStatus=3,e.applyTeacherModal.show()},500)},e.editApply=function(){e.hideApplyModal(),e.data.isApply=!0},e.getTeachedList=function(){var t={pageSize:10,pageIndex:1};u.teachedLessones(t).success(function(t){e.teachedList=t.data.list}).error(function(){})},e.getJoinededList=function(){var t={pageSize:10,pageIndex:1};u.joinedLessones(t).success(function(t){e.joinedList=t.data.list,e.classesCount=t.data}).error(function(){})},e.selectTab=function(t){switch(e.selectedIndex=t,t){case 0:e.myCollectionStory.storyList||e.loadData(e.myCollectionStory,0),a(function(){e.story=e.myCollectionStory},0);break;case 1:e.myStory.storyList||e.loadData(e.myStory,0),e.story=e.myStory;break;case 2:e.myTopics||u.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}a(function(){c.resize()},200)},e.loadData=function(t,o){null!=o&&void 0!=o||(o=1e3),t.pageIndex=t.pageIndex+1,1==t.pageIndex&&(t.storyList=[]),t.api(t.pageIndex,t.pageSize).success(function(i){a(function(){1==i.success&&(t.nums=i.totalCount,t.hasMore=t.pageIndex*t.pageSize<i.totalCount,t.storyList=t.storyList.concat(i.data.list),e.$broadcast("scroll.infiniteScrollComplete"))},o)}).error(function(){alert("网络失败！")})},e.$on("$ionicView.beforeEnter",function(t,o){"forward"==o.direction||"exit"==o.direction||"none"==o.direction?e.init(1):"back"==o.direction&&(e.isDisplay=!1,e.downRefresh(e.selectedIndex))}),e.downRefresh=function(t){switch(u.getUserData1("2",e.userId).success(function(t){if(e.userData=t.data,t.data.storeGride)if(e.levelArray=[],t.data.storeGride<=3)for(var o=0;o<t.data.storeGride;o++)e.levelArray.push(s.imgBaseURL+"img/StarLevel@2x.png");else for(var o=0;o<t.data.storeGride-3;o++)e.levelArray.push(s.imgBaseURL+"img/DiamondLevel@2x.png")}).error(function(){alert("网络失败！")}),u.getUserData2("2",e.userId).success(function(t){e.userData2=t.data}).error(function(){alert("网络失败！")}),u.getUserData3("2",e.userId).success(function(t){e.userData3=t.data}).error(function(){alert("网络失败！")}),t){case 0:e.selectedIndex=0,e.myCollectionStory.nums=-1,e.myCollectionStory.pageIndex=0,e.myCollectionStory.storyList=void 0,e.myCollectionStory.hasMore=!0,e.loadData(e.myCollectionStory,0);break;case 1:e.selectedIndex=1,e.myStory.nums=-1,e.myStory.pageIndex=0,e.myStory.storyList=void 0,e.myStory.hasMore=!0,e.loadData(e.myStory,0);break;case 2:e.selectedIndex=2,e.myTopics=void 0,u.getMyTopics().then(function(t){e.myTopics=t.data.data.list,e.noTopic=!e.myTopics.length},function(e){})}e.$broadcast("scroll.refreshComplete")},e.noFind=function(){e.userData.img="http://cdn09.ehaier.com/shunguang/H5/www/img/quanzi/user.jpg"},e.apply=function(t){var o={introduce:t,status:2==e.applyStatus?1:0};if(t)u.apply(o).then(function(t){1==t.data.success?(e.notApply=!1,l.showToast("申请已提交，等待审核……"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){});else if(3==e.applyStatus){var o={introduce:t,status:2};u.apply(o).then(function(t){1==t.data.success?(e.hideApplyModal(),e.introduce="",e.notApply=!1,l.showToast("申请已放弃"),e.data.isApply=!1,e.userData.UserAuth=2):e.data.isApply=!1},function(e){})}else l.showToast("申请描述不能为空，请填写……")},e.show=function(){e.isDisplay=!e.isDisplay},e.disappear=function(){e.isDisplay=!1},e.dealStory=function(t,o){var i;i=2!==t.flag?o:1==o?3:4;var s=t.storyTopicId?t.storyTopicId:t.id;g.dealStory(s,i).then(function(o){if(1==o.data.success){var n;switch(i){case 1:n=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?n-1:n+1,t.praiseFlag=!t.praiseFlag;break;case 2:if(n=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?n-1:n+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(var a=0;a<e.myCollectionStory.storyList.length;a++)s==e.myCollectionStory.storyList[a].id&&(e.myCollectionStory.storyList.splice(a,1),e.myCollectionStory.nums--);break;case 3:n=parseInt(t.praiseNumber),t.praiseNumber=t.praiseFlag?n-1:n+1,t.praiseFlag=!t.praiseFlag;break;case 4:if(n=parseInt(t.collectionNumber),t.collectionNumber=t.collectionFlag?n-1:n+1,t.collectionFlag=!t.collectionFlag,0==e.selectedIndex)for(a=0;a<e.myCollectionStory.storyList.length;a++)s==e.myCollectionStory.storyList[a].id&&(e.myCollectionStory.storyList.splice(a,1),e.myCollectionStory.nums--)}}},function(){l.showToast("网络错误！")})},e.ToMyIssue=function(e,o,i){"issue"==e&&t.getMyIssue(1,5,i,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"comment"==e&&t.getMyComment(1,5,i,0).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"quanzi"==e&&t.getMyJoinedTopics(i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"dashang"==e&&t.getDaShang(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"zan"==e&&t.getUserPraise(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})}),"shoucang"==e&&t.getCollection(1,5,i).success(function(t){-2e3==t.errorCode?(l.showToast(t.message),s.loginIsAccord2=!0):1==t.success&&n.go("heIssue",{title:e,who:o,id:i})})},e.settings=function(){n.go("mySettings")},e.fans=function(){i.getMyFans(1,6).success(function(e){1==e.success?n.go("myFans"):-2e3==e.errorCode&&(l.showToast(e.message),s.loginIsAccord2=!0)})},e.follows=function(){o.getMyFollows(1,6).success(function(e){1==e.success?n.go("myFollow"):-2e3==e.errorCode&&(l.showToast(e.message),s.loginIsAccord2=!0)})},e.jumpMsg=function(){n.go("messageCenter")},e.viewTopic=function(e){n.go("circlePage",{circleId:e})},e.viewMyTopic=function(){s.xinxianshow=!1,s.myquanshow=!0,s.buttonshowl=!1,s.buttonshowr=!0,n.go("topic.qmine")},e.viewStory=function(e){2!==e.flag?n.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory}):n.go("classNoteDetails",{noteId:e.id})},e.viewShop=function(){n.go("myStore",{storeId:e.userData.memberId,shareStoreId:""})},e.viewHim=function(e){1==e.flag&&n.go("personalHomepageHe",{othersId:e.userCode})},e.share=function(){if(!d.getUser().mid)return void n.go("login");window.umeng?e.showShare=!e.showShare:alert("只能在app分享,请下载app！")},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),l.showToastShort("复制成功")):l.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=(e.userData.userName?e.userData.userName:"他")+"的空间",i="欢迎关注"+(e.userData.userName?e.userData.userName:"他")+"的个人主页，关注他（她）的动态，一起来顺逛微社区互动吧……",s="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",n=p.getShareLinkHeader()+"personalHomePageHe/"+e.userData.memberId;window.umeng?0==t?window.umeng.shareToSina(o,i,s,n,0,null,f.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,f.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,f.shareSuccessCallback):3==t?window.umeng.shareToQQ(o,i,s,n,0,null,f.shareSuccessCallback):4==t?window.umeng.shareToQzone(o,i,s,n,0,null,f.shareSuccessCallback):5==t&&e.copeText(n):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("personalHomepageMeService",["$http","UrlService",function(e,t){this.getUserData1=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_ONE"),data:s})},this.getUserData2=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_TWO"),data:s})},this.getUserData3=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO_THREE"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyStory=function(o,i,s){return e({method:"post",url:t.getUrl("GET_MY_STORY_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.getMyCollection=function(o,i,s){return e({method:"post",url:t.getUrl("GET_USER_COLLECTION_LIST"),data:{pageIndex:o,pageSize:i,userId:s}})},this.startApply=function(){return e({method:"post",url:t.getUrl("START_APPLY_LECTURER"),data:{}})},this.apply=function(o){return e({method:"post",url:t.getUrl("APPLY_LECTURER"),data:o})},this.teachedLessones=function(o){return e({method:"post",url:t.getUrl("TEACHED_COURSE"),data:o})},this.joinedLessones=function(o){return e({method:"post",url:t.getUrl("JOINED_COURSE"),data:o})}}]),APP.controller("QdatabaseController",["$scope","$rootScope","$ionicHistory","QdatabaseService","$http","$ionicSlideBoxDelegate","$timeout","$state",function(e,t,o,i,s,n,a,r){e.quanlist="",e.isshow=!1,e.topshow=!1,e.xxshow=!1,e.sshow=!1,t.xiaoxis=!1,e.shuxiaoxi=!1,e.userlist="",e.count=0,e.ziliaolist="",t.msgCount="",e.totalCount=0,e.nogengduo="没有更多数据",e.storyName={name:""},e.storyType="",t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.goBack=function(){e.$ionicGoBack()},e.soushow=function(){e.sshow=!e.sshow},e.gotoxiaoxi=function(){r.go("qzMessageCenter"),t.xiaoxis=!1},e.toMsgCenter=function(){r.go("qzMessageCenter")},e.gototiezi=function(e){r.go("topicdetails",{noteId:e.id,isShortStory:e.isShortStory})},e.inputclass=function(t){e.storyType=t.id,e.init()},e.inputname=function(t){e.storyType="",e.init(),e.sshow=!1},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,storyName:e.storyName.name,storyType:e.storyType};a(function(){i.getziliaolist(t).success(function(t,o,i,s){return e.ziliaolist=t.data.list,e.totalCount=t.totalCount,t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},200),e.isjiazai=e.pageSize*e.pageIndex,e.hasMore=e.isjiazai>e.totalCount},e.loadData=function(){a(function(){var t=e.isjiazai<=e.totalCount;if(e.isjiazai=e.pageIndex*e.pageSize,e.pageIndex=e.pageIndex+1,t){var o={pageSize:e.pageSize,pageIndex:e.pageIndex};return i.getziliaolist(o).success(function(t,o,i,s){return e.ziliaolist=e.ziliaolist.concat(t.data.list),e.totalCount=t.totalCount,t}).error(function(){}),e.hasMore=t,e.$broadcast("scroll.refreshComplete"),void e.$broadcast("scroll.infiniteScrollComplete")}e.nogengduo="没有更多数据",e.hasMore=t,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){i.gettopic().success(function(t,o,i,s){return e.quanlist=t.data,t}),i.getxiaoxi().success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.dataList=[],e.hasMore=!0,e.pageSize=5,e.pageIndex=1,e.isjiazai=0,e.totalCount="",e.initdata()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("QdatabaseService",["$http","UrlService",function(e,t){this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.gettopic=function(){return e.get("./data/fenlei.json")},this.getziliaolist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)}}]),APP.controller("qSearchController",["$scope","$rootScope","$ionicHistory","qSearchService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.biaoqian="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",e.$ionicGoBack()},e.goqSearchThree=function(){window.cordova&&cordova.plugins.Keyboard.close(),a.go("qSearchThree",{keywords:e.input.isinput})},e.search=function(e){a.go("qSearchThree",{keywords:e.target.value})},e.BgoqSearchTwo=function(e){a.go("qSearchThree",{keywords:e.name})},e.init=function(){e.input.isinput="";var t={isHot:0};i.getbiaoqian(t).success(function(t,o,i,s){return r(function(){e.biaoqian=t.data.list,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),setTimeout(function(){document.getElementById("qSearch").focus()},200),l.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.init(),e.showmore=!0})}]),APP.service("qSearchService",["$http","UrlService",function(e,t){this.getbiaoqian=function(o){return e.post(t.getUrl("TOPIC_TAGS"),o)}}]),APP.controller("qSearchBiaoController",["HomePageService","$scope","$rootScope","$ionicHistory","qSearchBiaoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p){t.topiclist="",t.pageIndex="",t.pageSize=10,t.keywords="",t.ismore="",t.totalCount="",t.hasMore="",t.ismoreshow="",t.showmore="",t.input={isinput:t.isinput},t.goBack=function(){1==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("allCircle")):2==o.toFilterCode?(o.toFilterCode=0,t.input.isinput="",r.go("qSearch")):r.go("qSearchThree",{keywords:t.input.isinput})},t.goqSearchTwo=function(){r.go("qSearchTwo",{keywords:t.input.isinput})},t.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},t.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),t.input.isinput=e.target.value,t.init()},t.joinCircle=function(i){e.isWdHost().success(function(e){if(o.isWdHost=e.data.isHost,-1==o.isWdHost)r.go("login");else{t.itemTopicName=i.topicName;var n={ids:i.id};s.joinTopic(n).success(function(e){1==e.success?(i.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):u.showToast(e.message)}).error(function(){u.showToast("加入失败")})}}),t.itemTopicName=i.topicName;var n={ids:i.id};s.joinTopic(n).success(function(e){1==e.success?(i.isJoin=1,t.init(),t.inCircle=!0,c(function(){t.inCircle=!1},1e3)):-2e3==e.errorCode&&(u.showToast(e.message),o.loginIsAccord2=!0)}).error(function(){u.showToast("加入失败")})},t.loadData=function(){c(function(){if(t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.pageIndex=t.pageIndex+1,!t.hasMore)return u.showToast("没有更多数据"),t.hasMore;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};s.gettopic(e).success(function(e,o,i,s){return c(function(){t.topiclist=t.topiclist.concat(e.data.list),t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){u.showToast("没有更多数据")}),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},1e3)},t.init=function(){t.keywords=t.input.isinput,t.pageIndex=1,t.pageSize=10;var e={pageSize:t.pageSize,pageIndex:t.pageIndex,keywords:t.keywords};s.gettopic(e).success(function(e,o,i,s){return c(function(){t.topiclist=e.data.list,t.totalCount=e.totalCount,t.ismore=t.pageSize*t.pageIndex,t.hasMore=t.ismore<=t.totalCount,t.ismoreshow=t.topiclist.length<t.totalCount,t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")},30),e}).error(function(){}),p.scrollTop()},t.$on("$ionicView.beforeEnter",function(){t.showmore=!1,t.input={isinput:d.keywords},t.keywords=t.input.isinput,t.init(),t.showmore=!0})}]),APP.service("qSearchBiaoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchThreeController",["$scope","$rootScope","$ionicHistory","qSearchThreeService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.userlist="",e.topiclist="",e.huatilist="",e.pageIndex="",e.pageSize=3,e.showmore="",e.usershow="",e.topicshow="",e.tiezishow="",e.input={isinput:""},e.keywords=e.input.isinput,e.goBack=function(){e.input.isinput="",a.go("qSearch")},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.memberId})},e.storygotoothers=function(e){a.go("personalHomepageHe",{othersId:e.userCode})},e.gototiezi=function(e){a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoquanezi=function(e){a.go("circlePage",{circleId:e.id})},
e.goqSearchBiao=function(){e.keywords=e.input.isinput,a.go("qSearchBiao",{keywords:e.keywords})},e.BgoqSearchUser=function(){e.keywords=e.input.isinput,a.go("qSearchUser",{keywords:e.keywords})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.BgoqSearchTie=function(){e.keywords=e.input.isinput,a.go("qSearchTie",{keywords:e.keywords})},e.joinCircle=function(o){e.itemTopicName=o.topicName;var s={ids:o.id};i.joinTopic(s).success(function(i){1==i.success?(o.isJoin=1,e.init(),e.inCircle=!0,r(function(){e.inCircle=!1},1e3)):-2e3==i.errorCode&&(d.showToast(i.message),t.loginIsAccord2=!0)}).error(function(){d.showToast("加入失败")})},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=3;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return e.userlist=t.data.list,e.usershow=t.totalCount>3,t}).error(function(){});var o={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gettopic(o).success(function(t,o,i,s){return e.topiclist=t.data.list,e.topicshow=t.totalCount>3,t}).error(function(){});var s={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(s).success(function(t,o,i,s){return e.huatilist=t.data.list,e.tiezishow=t.totalCount>3,t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchThreeService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETTOPICBYCONDITION"),o)},this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchTieController",["$scope","$rootScope","$ionicHistory","qSearchTieService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.huatilist="",e.pageIndex="",e.pageSize=10,e.keywords="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){a.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){a.go("qSearchTwo",{keywords:e.input.isinput})},e.gototiezi=function(e){a.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(t).success(function(t,o,i,s){return r(function(){e.huatilist=e.huatilist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.gethuati(t).success(function(t,o,i,s){return r(function(){e.huatilist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.huatilist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchTieService",["$http","UrlService",function(e,t){this.gethuati=function(o){return e.post(t.getUrl("GETSTORYBYCONDITION"),o)}}]),APP.controller("qSearchTwoController",["$scope","$rootScope","$ionicHistory","qSearchTwoService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.topiclist="",e.ismore="",e.topicListCount="",e.pageIndex="",e.pageSize=10,e.tagIds="",t.toFilterCode=2,e.ismoreshow="",e.showmore="",e.input={isinput:""},e.goBack=function(){e.input.isinput="",a.go("qSearch")},e.goqSearchBiao=function(){a.go("qSearchBiao",{keywords:e.input.isinput})},e.search=function(e){window.cordova&&cordova.plugins.Keyboard.close(),a.go("qSearchBiao",{keywords:e.target.value})},e.gotobiao=function(){t.toFilterCode=2,a.go("qSearchBiao",{keywords:e.input.isinput})},e.gotoquanezi=function(e){a.go("circlePage",{circleId:e.id})},e.joinCircle=function(t){e.itemTopicName=t.topicName;var o={ids:t.id};i.joinTopic(o).success(function(o){1==o.success?(t.isJoin=1,e.inCircle=!0,r(function(){e.inCircle=!1},1e3),e.init()):d.showToast(o.message)}).error(function(){d.showToast("加入失败")})},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,tagIds:e.tagIds};i.gettopic(t).success(function(t,o,i,s){return r(function(){e.topiclist=e.topiclist.concat(t.data.list.topicList),e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){t.toFilterCode=2,e.pageIndex=1,e.pageSize=10;var o={pageIndex:e.pageIndex,pageSize:e.pageSize,tagIds:e.tagIds};i.gettopic(o).success(function(t,o,i,s){return r(function(){e.topiclist=t.data.list.topicList,e.topicListCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.topicListCount,e.ismoreshow=e.topiclist.length<e.topicListCount,e.ismore=t.data.list.createDate1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.tagIds=l.tagIds,e.input={isinput:l.tagname},e.init(),e.showmore=!0})}]),APP.service("qSearchTwoService",["$http","UrlService",function(e,t){this.gettopic=function(o){return e.post(t.getUrl("GETLISTBYCONDITION"),o)},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})}}]),APP.controller("qSearchUserController",["$scope","$rootScope","$ionicHistory","qSearchUserService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","$stateParams","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u){e.userlist="",e.pageIndex="",e.pageSize=10,e.biaoqian="",e.ismore="",e.totalCount="",e.hasMore="",e.ismoreshow="",e.showmore="",e.input={isinput:l.keywords},e.goBack=function(){a.go("qSearchThree",{keywords:e.input.isinput})},e.goqSearchTwo=function(){a.go("qSearchTwo",{keywords:e.input.isinput})},e.gotoothers=function(e){a.go("personalHomepageHe",{othersId:e.memberId})},e.search=function(t){window.cordova&&cordova.plugins.Keyboard.close(),e.input.isinput=t.target.value,e.init()},e.loadData=function(){r(function(){if(e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return d.showToast("没有更多数据"),e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return r(function(){e.userlist=e.userlist.concat(t.data.list),e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.userlist<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){d.showToast("没有更多数据")}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.init=function(){e.keywords=e.input.isinput,e.pageIndex=1,e.pageSize=10;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,keywords:e.keywords};i.getuser(t).success(function(t,o,i,s){return r(function(){e.userlist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.ismoreshow=e.userlist.length<e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),u.scrollTop()},e.$on("$ionicView.beforeEnter",function(){e.showmore=!1,e.input={isinput:l.keywords},e.keywords=e.input.isinput,e.init(),e.showmore=!0})}]),APP.service("qSearchUserService",["$http","UrlService",function(e,t){this.getuser=function(o){return e.post(t.getUrl("GETUSERBYCONDITION"),o)}}]),APP.controller("QhotController",["$scope","$rootScope","PlatformService","HomePageService","CLASSIFYMESSAGECRNTERService","$ionicHistory","QhotService","ShopService","$http","$ionicSlideBoxDelegate","$state","$timeout","UserService","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}e.flagNum=!1,e.tielist="",e.quanlist="",e.lunlist="",e.selectedIndex="",t.xiaoxis=!1,e.dataList=[],e.nogengduo="",e.userdata="",e.topshow=!1,e.hasMore=!0,e.ismore=!0,e.totalCount="",e.datafist="",e.message="",e.showList=!1;var h=null;t.showRightTop=!1,t.msgCount="",e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){d.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotoxiaoxi=function(){d.go("ClassifyMessageCenter")},e.gotomyzhu=function(){d.go("personalHomepageMe")},e.gotoothers=function(e){d.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){d.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){d.go("allCircle")},e.scrollToTop=function(){m.$getByHandle("qhotHandle").scrollTop(!0),e.showTopBtn=!1},e.getScrollHeight=function(){e.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),e.scrollHeight>3*e.phoneHeight?e.showTopBtn=!0:e.showTopBtn=!1},e.hotgo=function(){var e=m.$getByHandle("pinglun"),t=e.getScrollPosition().left,o=document.getElementById("hotdiv").offsetWidth;t>4.3*o&&d.go("allCircle")},e.gotoqSearch=function(){d.go("qSearch")},e.dianzan=function(o,i){window.cordova&&(t.gio.track("like",{circleID:e.tielist[i].topicId}),t.gio.track("active",{circleID:e.tielist[i].topicId}));var s=f("loginId"),n={id:o,noLoading:!0,userCode:s};a.postdianzan(n).success(function(t){1==t.success?1==e.tielist[i].praiseFlag?(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber-1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):(e.tielist[i].praiseNumber=e.tielist[i].praiseNumber+1,e.tielist[i].praiseFlag=!e.tielist[i].praiseFlag):u(function(){g.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?a.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):g.showToast(t.message),t}).error(function(){}):a.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=f("loginId"),o=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0,userCode:t}:{pageSize:e.pageSize,pageIndex:e.pageIndex,userCode:t};u(function(){a.getstorylist(o).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){e.pageIndex+=1;var t=f("loginId"),o={pageSize:5,pageIndex:e.pageIndex,noLoading:!0,userCode:t};a.getstorylist(o).success(function(t){t.data.list&&0!=t.data.list.length?h=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.infiniteScrollComplete");var o=e.tielist.length;e.hasmore=!(o==t.totalCount),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3):(e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1)}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.jumpBannerUrl=function(e,t){if(0==e){var i=t.split("/");"noteDetails"==i[1]?d.go("noteDetails",{noteId:i[2],isShortStory:i[3]}):"circlePage"==i[1]?d.go("circlePage",{circleId:i[2]}):d.go("personalHomepageMe")}else if(1==e){var s=navigator.userAgent;s.indexOf("Android")>-1||s.indexOf("Linux")>-1?"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t):(s.indexOf("iPhone"),"APP"==o.getPlatform()?cordova.InAppBrowser.open(t,"_system","location=yes"):window.open(t))}},e.showCameraList=function(){e.showList=!e.showList},e.hideList=function(){e.showList=!1},e.isClick=function(){e.isDisplay=!e.isDisplay},e.jumpPhoto=function(o){i.isWdHost().success(function(i){t.isWdHost=i.data.isHost,-1==t.isWdHost?d.go("login"):(e.showList=!1,3!=o?d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o}):window.medias&&window.medias.StartMedias("5s","30s","5","50",function(i){var s=JSON.parse(i),n=s.videoFile,a=s.imageFile,r=n.replace("\\",""),c=a.replace("\\","");t.mediaurla=r,t.mediaImga=c,d.go("publishCircle",{identifierCode:"",topicId:e.circleId,topicStyle:o})},function(e){}))})},e.init=function(){e.showList=!1,e.isDisplay=!1,e.phoneHeight=document.documentElement.clientHeight/2;var o=e.quanlist?{pageIndex:1,pageSize:15,noLoading:!0}:{pageIndex:1,pageSize:15};a.gettopic(o).success(function(t,o,i,s){return e.quanlist=t.data.list,t}).error(function(){});var i=e.quanlist?{bannerType:0,noLoading:!0}:{bannerType:0};a.getlunbo(i).success(function(t,o,i,s){return e.lunlist=t.data.list,l.$getByHandle("qhot_slider").update(),t}).error(function(){});var s={noLoading:!!e.quanlist||""};a.getxiaoxi(s).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount}).error(function(){}),e.hasMore=!0,e.initdata(),r.getMessage().success(function(t){t.data.count>0?e.flagNum=!0:e.flagNum=!1})},e.$on("$ionicView.beforeEnter",function(o,i){window.cordova&&t.gio.track("communityEntry"),"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),u(function(){a.getusertopic().success(function(t,o,i,s){e.datafist=t.data,e.datafist&&d.go("quanziRecommend")}).error(function(){})},1e3),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(h)})}]),APP.service("QhotService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETHOTSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getxiaoxi=function(o){return e.get(t.getUrl("UNRED_MESSAGE"),o)},this.getlunbo=function(o){return e.post(t.getUrl("GETBANNERLIST"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETHOTTOPICLIST"),o)},this.getusertopic=function(o){return e.post(t.getUrl("ADDUSER"),o)},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("QmineController",["$scope","$rootScope","$ionicHistory","QmineService","$http","$ionicSlideBoxDelegate","CLASSIFYMESSAGECRNTERService","$state","$timeout","PopupService","MyCirclePagesService",function(e,t,o,i,s,n,a,r,c,l,d){e.tielist="",e.flagNum=!1,e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";var u=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.xxshow=function(){t.xinxianshow=!0,t.myquanshow=!1,t.buttonshowl=!0,t.buttonshowr=!1},e.wdshow=function(){t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0},e.gototiezi=function(e){r.go("noteDetails",{noteId:e.id,isShortStory:e.isShortStory})},e.gotomyzhu=function(){r.go("personalHomepageMe")},e.gotoxiaoxi=function(){r.go("ClassifyMessageCenter")},e.gotoothers=function(e){r.go("personalHomepageHe",{othersId:e.userCode})},e.gotoquanezi=function(e){r.go("circlePage",{circleId:e.id})},e.gotohotquanezi=function(){r.go("allCircle")},e.gotoqSearch=function(){r.go("qSearch")},e.joinCircle=function(o){window.cordova&&(t.gio.track("follow",{circleID:o.id}),t.gio.track("active",{circleID:o.id})),e.itemTopicName=o.topicName;var s={ids:o.id,noLoading:!0};i.joinTopic(s).success(function(t){1==t.success?(o.isJoin=1,o.topicFocusFlag=1,e.init(),e.inCircle=!0,c(function(){e.inCircle=!1},1e3)):l.showToast(t.message)}).error(function(){l.showToast("加入失败")})},e.dianzan=function(o,s){window.cordova&&(t.gio.track("like",{circleID:e.tielist[s].topicId}),t.gio.track("active",{circleID:e.tielist[s].topicId}));var n={id:o,noLoading:!0};i.postdianzan(n).success(function(t){1==t.success?1==e.tielist[s].praiseFlag?(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber-1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):(e.tielist[s].praiseNumber=e.tielist[s].praiseNumber+1,e.tielist[s].praiseFlag=!e.tielist[s].praiseFlag):c(function(){l.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?i.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):l.showToast(t.message),t}).error(function(){}):i.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.initdata=function(){e.pageSize=5,e.pageIndex=1;var t=e.quanlist?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};c(function(){i.gettielist(t).success(function(t,o,i,s){if(t.success)return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)},e.loadData=function(){c(function(){if(e.ismore=e.pageIndex*e.pageSize,e.hasMore=e.ismore<=e.totalCount,e.pageIndex=e.pageIndex+1,!e.hasMore)return l.showToast("没有更多数据"),e.nogengduo="没有更多数据",e.hasMore;var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};i.gettielist(t).success(function(t,o,i,s){return u=setTimeout(function(){e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){}),e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.getMyCreatTopicInfo=function(t){var o={keywords:t};d.getMyCreatTopics(o).then(function(t){t.data.success&&(e.myCreatTopics=t.data.data.list)},function(e){})},e.getMyJoinedCircleInfo=function(t){var o={keywords:t};d.getMyJoinedTopics(o).then(function(t){t.data.success&&(e.myTopics=t.data.data.list)},function(e){})},e.clickIn=function(e,o){0==o?r.go("circlePage",{circleId:e}):2==o?(t.showApplyTag=1,t.reviewCircleId=e,r.go("applyCircle")):(t.reviewCircleId=e,r.go("applyCircle"))},e.viewTopic=function(e){r.go("circlePage",{circleId:e})},e.init=function(){e.myCreatTopics=[],e.myTopics=[],e.tielist="",e.quanlist="",e.tuiquanlist="",e.lunlist="",e.selectedIndex="",t.xinxianshow=!1,t.myquanshow=!0,t.buttonshowl=!1,t.buttonshowr=!0,t.xiaoxis=!1,e.userdata="",e.hasMore=!0,e.ismore=!0,e.message="";t.showRightTop=!1,e.getMyCreatTopicInfo(),e.getMyJoinedCircleInfo(),e.selectedIndex=void 0;var o=e.quanlist?{ids:"",noLoading:!0}:{ids:""};i.gettopic(o).success(function(t,o,i,s){if(t.success)return e.quanlist=t.data.list,t}).error(function(){});var s={pageIndex:1,pageSize:3};i.gettuitopic(s).success(function(t,o,i,s){if(t.success)return e.tuiquanlist=t.data.list,t}).error(function(){});var n=e.quanlist?{noLoading:!0}:"";i.getxiaoxi(n).success(function(t,o,i,s){t.data&&0!=t.data?e.flagNum=!0:e.flagNum=!1}).error(function(){}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(){"noteDetails"==t.nextPageBefore?(t.nextPageBefore="",e.hasMore=!0):($("ion-header-bar").show(),t.showRightTop=!1,t.xiaoxis=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(u)})}]),APP.service("QmineService",["$http","UrlService",function(e,t){this.gettielist=function(o){return e.post(t.getUrl("GETMYFOLLOWINGSTORYLIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.gettopic=function(o){return e.post(t.getUrl("GETMYTOPICLIST"),o)},this.gettuitopic=function(o){return e.post(t.getUrl("RECOMMEND_LIST"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.joinTopic=function(o){return e({method:"POST",url:t.getUrl("JOIN_TOPIC"),data:o})},this.postdianzan=function(o){return e.post(t.getUrl("COMMENT_PRAISE"),o)},this.postshoucang=function(o){return e.post(t.getUrl("COLLECTION_TOPIC"),o)}}]),APP.controller("communityRecommendCtrl",["$scope","$rootScope","$timeout","$state","PopupService","communityRecommendService",function(e,t,o,i,s,n){e.idArray=[],e.ids=[],e.topics=[],e.matrixes=[],e.init=function(){e.$broadcast("scroll.refreshComplete"),n.getCommunities().success(function(o){if(1==o.success){if(e.topics=o.data.list,e.topics.length>12)for(var i=0;i<Math.ceil(e.topics.length/12);i++)e.matrixes[i]=e.topics.slice(12*i,12*i+12);for(var n=0;n<e.topics.length;n++)1==e.topics[n].recommend&&(e.ids.push(e.topics[n].id),e.idArray.push(e.topics[n].id))}else-2e3==o.errorCode&&(s.showToast(o.message),t.loginIsAccord2=!0)}).error(function(){s.showToast("网络错误！")})},e.selectAll=function(t){if(e.ids.length!=e.topics.length){e.ids=[];for(var o=0;o<e.topics.length;o++)e.topics[o].isJoin||(e.topics[o].isJoin=!0),e.ids.push(e.topics[o].id)}else{for(o=0;o<e.topics.length;o++)e.topics[o].isJoin&&(e.topics[o].isJoin=!1);e.ids=[],e.ids=e.ids.concat(e.idArray)}},e.joinOrApply=function(t){if(0==t.recommend||null==t.recommend)if(t.isJoin=!t.isJoin,t.isJoin)e.ids.push(t.id);else for(var o=0;o<e.ids.length;o++)e.ids[o]==t.id&&e.ids.splice(o,1)},e.done=function(){e.ids.length?n.joinTopic(e.ids).then(function(t){1==t.data.success?(e.ids=[],i.go("topic.qhot")):s.showToast(t.data.message)},function(){}):i.go("topic.qhot")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("communityRecommendService",["$http","UrlService",function(e,t){this.joinTopic=function(o){var i={ids:o.toString()};return e({method:"post",url:t.getUrl("JOIN_TOPIC"),data:i})},this.getCommunities=function(){return e({method:"post",url:t.getUrl("LAUNGCH_RECOMMEND_LIST")})}}]),APP.controller("QwschoolController",["$scope","$rootScope","$ionicHistory","QwschoolService","$http","$state","CLASSIFYMESSAGECRNTERService","$timeout","PopupService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l){e.tielist="",e.flagNum=!1,e.quanlist="",e.classlist="",e.ziliaolist="",e.buttonshowl=!1,e.buttonshowr=!0,t.xiaoxis=!1,e.isjiazai=0,e.nogengduo="",e.userdata="",e.selectedIndex=void 0,e.hasMore=!0,e.ismore=!0,e.message="",e.catelist="",e.selectCheck="";var d=null;t.showRightTop=!1,e.toggleMenu=function(){t.showRightTop=!t.showRightTop,t.xiaoxis=!t.xiaoxis},e.gototiezi=function(e){n.go("classNoteDetails",{noteId:e.id})},e.gotomyzhu=function(){n.go("personalHomepageMe")},e.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userCode})},e.gotoqSearch=function(){n.go("qSearch")},e.gotoxiaoxi=function(){n.go("messageCenter")},e.gotoziliao=function(){n.go("qdatabase")},e.dianzan=function(t,o){var s={id:t,noLoading:!0};i.postdianzan(s).success(function(t){1==t.success?1==e.tielist[o].praiseFlag?(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber-1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):(e.tielist[o].praiseNumber=e.tielist[o].praiseNumber+1,e.tielist[o].praiseFlag=!e.tielist[o].praiseFlag):r(function(){c.showToast(t.message)},200)})},e.shoucang=function(e){var t={id:e.id,noLoading:!0};0==e.collectionFlag?i.postshoucang(t).success(function(t,o,i,s){return 1==t.success?(e.collectionFlag=1,e.collectionNumber++):c.showToast(t.message),t}).error(function(){}):i.postshoucang(t).success(function(t,o,i,s){return 1==t.success&&(e.collectionFlag=0,e.collectionNumber--),t}).error(function(){})},e.selectlist=function(t){if(e.selectCheck==t)e.selectCheck="",e.storyid="",e.initdata();else{e.pageIndex=1,e.selectCheck=t,e.storyid=parseInt(t);var o={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};r(function(){i.getstorylist(o).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.ismore=e.pageSize*e.pageIndex,e.hasMore=e.ismore<=e.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete"),t}).error(function(){})},300)}},e.initdata=function(){e.storyid="",e.selectCheck="",e.pageSize=5,e.pageIndex=1;var t=e.userdata?{pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0}:{pageSize:e.pageSize,pageIndex:e.pageIndex};r(function(){i.getstorylist(t).success(function(t,o,i,s){return e.tielist=t.data.list,e.totalCount=t.totalCount,e.tielist<5?e.hasMore=!1:(e.hasMore=!0,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")),t}).error(function(){})},300)},e.loadData=function(){if(e.pageIndex=e.pageIndex+1,e.storyid)var t={pageSize:e.pageSize,pageIndex:e.pageIndex,categoryId:e.storyid,noLoading:!0};else var t={pageSize:e.pageSize,pageIndex:e.pageIndex,noLoading:!0};i.getstorylist(t).success(function(t,o,i,s){return d=setTimeout(function(){t.data.list.length<5?(e.hasMore=!1,c.showToast("没有更多数据"),e.nogengduo="没有更多数据"):e.hasMore=!0,e.tielist=e.tielist.concat(t.data.list),e.totalCount=t.totalCount,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},30),t}).error(function(){})},e.init=function(){e.selectedIndex=void 0;var o={noLoading:!0};i.business().success(function(t){e.catelist=t.data.list}),i.getxiaoxi(o).success(function(o,i,s,n){t.msgCount=o.data,e.topshow=0!=t.msgCount,o.data&&0!=o.data?e.flagNum=!0:e.flagNum=!1}).error(function(){});var s={id:1,type:1,noLoading:!0};i.getuserdata(s).success(function(t,o,i,s){return e.userdata=t.data,t}).error(function(){});var n={noLoading:!0};i.getclass(n).success(function(t,o,i,s){return e.classlist=t.data.list,t}),e.hasMore=!0,e.initdata()},e.$on("$ionicView.beforeEnter",function(o,i){"classNoteDetails"==t.nextPageBefore?t.nextPageBefore="":($("ion-header-bar").show(),t.xiaoxis=!1,t.showRightTop=!1,e.init())}),e.$on("$stateChangeStart",function(){e.hasMore=!1,clearTimeout(d)})}]),APP.service("QwschoolService",["$http","UrlService",function(e,t){this.getstorylist=function(o){return e.post(t.getUrl("GETUPDATELIST"),o)},this.getuserdata=function(o){return e.post(t.getUrl("USER_SIMPLE_INFO"),o)},this.getclass=function(o){return e.post(t.getUrl("GETCOURSEINFO"),o)},this.getxiaoxi=function(){return e.get(t.getUrl("UNRED_MESSAGE"))},this.postdianzan=function(o){return e.post(t.getUrl("SCHOOLPRAISESTORY"),o)},this.postshoucang=function(o){return e.post(t.getUrl("SCHOOLCOLLECTION"),o)},this.business=function(o){return e.post(t.getUrl("GET_BUSINESS"),o)}}]),APP.controller("qzMessageCenterController",["$scope","$state","qzMessageCenterService",function(e,t,o){e.hasmore=!1,e.selectedIndex=0,e.id="",e.platformData,e.smallClassData,e.otherData,e.param={pageSize:5,id:e.id,page:e.page,noLoading:!0},e.goBack=function(){e.$ionicGoBack()},e.goDetails=function(){t.go("messageDetails")},e.getPlatformData=function(){o.getPlatformMsg().success(function(t){e.platformData=t.data})},e.getSmallClassData=function(){o.getSmallClassMsg().success(function(t){e.smallClassData=t.data})},e.getOtherData=function(){o.getOtherMsg().success(function(t){e.otherData=t.data})},e.page=1,e.loadMore=function(){e.page+=1,e.loadMoreMsg(e.param)},e.loadMoreMsg=function(t){o.loadMoreProducts(t).success(function(t,o,i,s){if(null!=t.data.msgList&&void 0!=t.data.msgList&&0!=t.data.msgList.length){e.msgList=e.msgList.concat(t.data.msgList),e.$broadcast("scroll.infiniteScrollComplete");var n=e.msgList.length;e.hasmore=!(n===t.data.storeItemsCounts)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,e.msgList=[]})},e.init=function(){e.getPlatformData(),e.getSmallClassData(),e.getOtherData()},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("qzMessageCenterService",["$http","UrlService",function(e,t){this.getPlatformMsg=function(){return e.get(t.getUrl("PLATFORM_INFO"),params)},this.getSmallClassMsg=function(){return e.get("data/smallClassMessage.json")},this.getOtherMsg=function(){return e.get("data/otherMessage.json")},this.loadMoreMessage=function(o){return params={pageSize:o.pageSize,id:o.id,page:o.page,noLoading:o.noLoading},e.get(t.getUrl(),params)}}]),APP.controller("relatedProductController",["$ionicHistory","$http","$scope","relatedProductsService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService",function($ionicHistory,$http,$scope,relatedProductsService,$stateParams,$state,$cookieStore,$ionicPopup,$timeout,LoginService,$rootScope,$ionicModal,$localstorage,PopupService){$scope.provinceId=0,$scope.cityId=0,$scope.regionId=0,$scope.streetId=0,$scope.productList=[],$scope.imgimg=[],$rootScope.image=[],$scope.isAreadyShop=!1,$scope.prolist=[],$scope.searchGoodsName="",$scope.gsPlaceholder="搜索商品",$scope.isShop=!0,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.page=1,$scope.loadMore=function(){$scope.page+=1,0==$scope.selectedIndex?$scope.searchOK?$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,2):$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5):1==$scope.selectedIndex?($scope.areadyPage+=1,$scope.areadyShop($scope.areadyPage,5)):3==$scope.selectedIndex&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,1)},$scope.onTabSelected=function(e){$scope.selectedIndex=e,$scope.page=1,$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.searchOK=!1,0==e?($scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)):1==e?($scope.shop0=!1,$scope.shop1=!0,$scope.shop2=!1,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.areadyPage=0,$scope.productList=[],$scope.areadyShop($scope.areadyPage,5)):2==e?($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!0,$scope.shop3=!1,$scope.isShop=!0,$scope.search=!1,$scope.productList=[],$scope.holdPro()):3==e&&($scope.shop0=!1,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!0,$scope.isShop=!1,$scope.search=!0,$scope.productList=[])},$scope.loadMoreProducts=function(e,t,o,i,s,n){relatedProductsService.loadMoreProducts(e,t,o,i,s,n).success(function(e){if(null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.storeItemsCounts);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"
}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.areadyShop=function(e,t){relatedProductsService.areadyShop(e,t).success(function(e){if(null!=e.productList&&void 0!=e.productList&&0!=e.productList.length){$scope.productList=$scope.productList.concat(e.productList),$scope.$broadcast("scroll.infiniteScrollComplete");var t=$scope.productList.length;$scope.hasmore=!(t===e.productTotal);for(var o=0;o<$scope.productList.length;o++)$rootScope.image[$scope.productList[o].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[o].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[o].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.holdPro=function(){relatedProductsService.holdPro().success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchHold=function(){if($scope.productList=[],""==$scope.searchName.searchHold&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchHold&&$scope.searchGoodsHold($scope.searchName.searchHold)},$scope.searchGoodsHold=function(e){relatedProductsService.searchHoldPro(e).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){$scope.productList=$scope.productList.concat(e.data),$scope.hasmore=!1;for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.todoSomething=function(e,t){13==e.keyCode&&($scope.searchProduct(t),Focus.blur())},$scope.searchProduct=function(e){if($scope.searchOK=!0,$scope.page=1,$scope.productList=[],1==e){if(""==$scope.searchName.searchAll&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchAll&&$scope.searchGoods($scope.searchName.searchAll,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}else if(2==e){if(""==$scope.searchName.searchShop&&!$scope.gsPlaceholder)return void PopupService.showToast("请填写搜索内容");""!=$scope.searchName.searchShop&&$scope.searchGoods($scope.searchName.searchShop,$scope.page,5,$scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,e)}},$scope.searchGoods=function(e,t,o,i,s,n,a,r){relatedProductsService.searchGoods(e,t,o,i,s,n,a,r).success(function(e){if($scope.isShop=!0,null!=e.productsList&&void 0!=e.productsList&&0!=e.productsList.length){$scope.productList=$scope.productList.concat(e.productsList),$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!(e.productsList<5);for(var t=0;t<$scope.productList.length;t++)$rootScope.image[$scope.productList[t].productId]==$rootScope.imgBaseURL+"img/ic_select.png"?($rootScope.image[$scope.productList[t].productId],$rootScope.imgBaseURL):$rootScope.image[$scope.productList[t].productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasmore=!1,PopupService.showToast("没有更多商品了")}),$scope.imgimg=$rootScope.image},$scope.productOK=function(){$ionicHistory.goBack(),$rootScope.nextPageBefore="relatedProduct"},$scope.selectOrderAddress=function(e){if($rootScope.productId.length<5)if(-1!=$rootScope.image[e.productId].indexOf("check"))$rootScope.productId.push(e),$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_select.png",$scope.isChooseOrder=!0;else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else if(5==$rootScope.productId.length)if(-1!=$rootScope.image[e.productId].indexOf("check"))PopupService.showToast("最多能选择5个");else{for(var t=0;t<$rootScope.productId.length;t++)if($rootScope.productId[t].productId==e.productId){$rootScope.productId.splice(t,1);break}$rootScope.image[e.productId]=$rootScope.imgBaseURL+"img/ic_check.png"}else PopupService.showToast("最多能选择5个");$scope.imgimg=$rootScope.image},$scope.init=function(){$scope.searchName={searchShop:"",searchHold:"",searchAll:""},$scope.selectedIndex=0,$scope.hasmore=!1,$scope.shop0=!0,$scope.shop1=!1,$scope.shop2=!1,$scope.shop3=!1,$scope.search=!1,$scope.productList=[],relatedProductsService.getAddress().success(function(response){var obj=eval(response.data);$scope.provinceId=obj[0].provinceId,$scope.cityId=obj[0].cityId,$scope.regionId=obj[0].areaId,$scope.streetId=obj[0].streetId,$scope.initPro()})},$scope.initPro=function(){$scope.page=1,$scope.loadMoreProducts($scope.provinceId,$scope.cityId,$scope.regionId,$scope.streetId,$scope.page,5)},$scope.goBack=function(){$scope.$ionicGoBack()},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.isIOS=!!ionic.Platform.isIOS(),$scope.init()}),$scope.$on("$destroy",function(){$scope.filterModal.remove(),$scope.addressModal.remove()})}]),APP.service("relatedProductsService",["$http","UrlService",function(e,t){this.loadMoreProducts=function(o,i,s,n,a,r){var c={provinceId:o,cityId:i,districtId:s,streetId:n,pageIndex:a,pageSize:r};return e.get(t.getUrl("GET_RELATEDSHOP"),c)},this.areadyShop=function(o,i){var s={start:o,offset:5};return e.get(t.getUrl("GET_AREADYSHOP"),s)},this.holdPro=function(){return e.get(t.getUrl("GET_HOLDPRO"))},this.searchHoldPro=function(o){var i={keyword:o};return e.get(t.getUrl("SEARCH_HOLDPRO"),i)},this.searchGoods=function(o,i,s,n,a,r,c,l){var d={keyword:o,pageIndex:i,pageSize:s,provinceId:n,cityId:a,districtId:r,streetId:c,fromType:l};return e.get(t.getUrl("SEARCH_GOODS_CIRCLE"),d)},this.getAddress=function(){return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"))},this.getFilterData=function(){return e.get(t.getUrl("GET_FILTER_DATA"))}}]),APP.controller("selectAdminController",["$scope","$state","$stateParams","selectAdminService","$ionicScrollDelegate","PopupService","anchorScroll",function(e,t,o,i,s,n,a){e.mainuserlist="",e.userlist="",e.topicId="",e.input={isinput:""},e.aList=[],e.toAnchor=function(t){e.isDisplay=!1,"#"==t?a.toView("#toOther",!0):a.toView("#"+t,!0)},e.goBack=function(){t.go("CircleSetAdmin",{topicId:e.topicId})},e.inPersonalPage=function(e){t.go("personalHomepageHe",{othersId:e})},e.selectUser=function(t){for(var o=0;o<e.userlist.length;o++)t.id==e.userlist[o].id?"img/ic_select.png"==e.userlist[o].ischeck?(e.userlist[o].ischeck="img/ic_check.png",e.userCode=""):(e.userlist[o].ischeck="img/ic_select.png",e.userCode=t.userCode):e.userlist[o].ischeck="img/ic_check.png"},e.search=function(t){e.isDisplay=!1;var o={topicId:e.topicId,userName:t.target.value};i.getuserlist(o).success(function(t,o,i,n){e.userNum=t.totalCount,window.cordova&&cordova.plugins.Keyboard.close(),e.userlist=t.data.list;for(var a=0;a<e.userlist.length;a++)e.userlist[a].ischeck="img/ic_check.png";s.$getByHandle("mainScroll").scrollTop()}).error(function(){})},e.yes=function(){if(e.userCode.length>0){var o={topicId:e.topicId,userCode:e.userCode,indentityStatus:1};i.setAdmin(o).success(function(o){o.success?t.go("CircleSetAdmin",{topicId:e.topicId}):n.showToast(o.message)}).error(function(){})}else n.showToast("请选择管理员")},e.loadMoreMember=function(){e.pageIndex+=1;var t={topicId:e.topicId,pageSize:20,pageIndex:e.pageIndex};i.getuserlist(t).success(function(t){if(e.userNum=t.totalCount,t.data.list&&0!=t.data.list.length){e.userlist=e.userlist.concat(t.data.list);for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.$broadcast("scroll.infiniteScrollComplete");var i=e.userlist.length;e.hasmore=!(i===t.totalCount)}else e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!1,n.showToast("没有更多消息了")}).error(function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.init=function(){e.aList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","#"],e.userCode="";var t={topicId:e.topicId,pageSize:20,pageIndex:1};e.pageIndex=1,e.input={isinput:""},i.getuserlist(t).success(function(t){e.datalist=t,e.userlist=t.data.list;for(var o=0;o<e.userlist.length;o++)e.userlist[o].ischeck="img/ic_check.png";e.userNum=t.totalCount,e.userNum>20&&(e.hasmore=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.topicId=o.topicId,e.init()})}]),APP.service("selectAdminService",["$http","UrlService",function(e,t){this.getuserlist=function(o){return e.post(t.getUrl("GETLISTBYCODE"),o)},this.setAdmin=function(o){return e.post(t.getUrl("CIRCLE_SET_ADMIN"),o)}}]),APP.directive("sharedMsgsList",function(){return{restrict:"E",replace:!0,templateUrl:"templates/quanzi/SharedMsgsList.html",scope:!0,link:function(e,t,o){}}}),APP.controller("signDateController",["CirclePageService","signDateService","PopupService","$scope","$stateParams","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){function h(e,t){var o=t;i.month=t,i.fullDay=new Date(e,o,0).getDate(),i.startWeek=new Date(e,o-1,1).getDay(),i.lastMonthDay=new Date(e,o-1,0).getDate(),i.nextMonthDay=new Date(e,o+1,0).getDate(),i.total=(i.fullDay+i.startWeek)%7==0?i.fullDay+i.startWeek:i.fullDay+i.startWeek+(7-(i.fullDay+i.startWeek)%7),i.fullPrevMonth=[],i.fullNextMonth=[],i.fullCurrentMonth=[];for(var s=0;s<i.lastMonthDay;s++)i.fullPrevMonth[s]=s+1;for(var s=0;s<i.nextMonthDay;s++)i.fullNextMonth[s]=s+1;for(var s=0;s<i.signList.length;s++)i.fullCurrentMonth[s]=s+1;i.prevLast=i.fullPrevMonth.splice(i.lastMonthDay-i.startWeek,i.startWeek),i.nextFrist=i.fullNextMonth.splice(0,7-(i.fullDay+i.startWeek)%7),i.currentDays=i.prevLast.concat(i.signList).concat(i.nextFrist)}function v(e,o,s,n,a){t.getSignDate(e,o,s,n,a).success(function(e){if(e.success){i.isMoreSign=e.data.replenishSignGolds;var t=e.data.list,o=t[0].signDate.split("-");i.signList=e.data.list,i.getYear=Number(o[0]),i.getMonth=Number(o[1]),i.signCount=e.data.signCount,i.replenishSignGolds=e.data.replenishSignGolds,i.signRules=e.data.signRules,h(i.getYear,i.getMonth)}})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?i.paddingtopClass={"padding-top":"30px"}:i.paddingtopClass={"padding-top":"14px"},i.goBack=function(){i.$ionicGoBack()},i.$on("$ionicView.beforeEnter",function(e,t){"back"!=t.direction&&(i.month=(new Date).getMonth(),i.year=(new Date).getFullYear(),i.init())}),i.init=function(){i.isMoreSign="",i.signSucDate=e.signSuccessDate,i.topicName=e.topicName,i.defaultDate=i.signSucDate.signYear+"-"+i.signSucDate.signMonth+"-"+i.signSucDate.signDay,i.userId=s.userId,i.topicId=s.topicId,i.monthFlag=Number(s.monthFlag),v(i.userId,i.topicId,i.monthFlag,i.signSucDate.signYear,i.signSucDate.signMonth)},i.replenishSign=function(){i.replenishPopup=g.show({template:"<div class='rep-box'>\n                    <div class='rep-close' ng-click='closeReplenishPopup()'><img ng-src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"关闭\" /></div>\n                    <div class='rep-head'>选择补签日期</div>\n                    <div class='rep-content'>\n                      <div class='con-date' ng-click='selectDate()'>\n                        \n                        <div class='input'>{{defaultDate}}</div>\n                        <i><img ng-src=\"{{imgBaseURL}}img/signIn/date_icon.png\" alt=\"\" /></i>\n                      </div>\n                      <div class='con-info'>补签将消耗您<span style=\"font-size:22px;\">{{replenishSignGolds}}</span>个金币</div>\n                    </div>\n                    <div class='rep-foot' ng-click='replenishSuccess(defaultDate,2,topicId,userId)'>确认补签</div>\n                  </div>",cssClass:"replenishPopup",scope:i}),i.closeReplenishPopup=function(){i.replenishPopup.close()}},i.replenishSuccess=function(e,s,n,a){var r=e.split("-")[0],c=e.split("-")[1];r==i.signSucDate.signYear&&c==i.signSucDate.signMonth?(t.getReplenishSign(e,s,n,a).success(function(e){e.success?(i.signInfoData=e.data,i.replenishPopup.close(),i.replenishSucPopup=g.show({template:"<div class='suc-box'>\n                          <div class='suc-close' ng-click='closeReplenishSucPopup()'><img src=\"{{imgBaseURL}}img/signIn/sign_close.png\" alt=\"\" /></div>\n                          <div class='suc-bg'><img src=\"{{imgBaseURL}}img/signIn/buqian_bg.png\" alt=\"\" /></div>\n                          <div class='suc-content'>\n                            <div class='suc-title' flex='main:center cross:center'>\n                              <div class='suc-icon' flex='cross:center'><img src=\"{{imgBaseURL}}img/signIn/sign_icon.png\" alt=\"\" /></div>\n                              <div class='title-text'>签到排名<span style=\"font-size:16px;\">{{signInfoData.rank}}</span></div>\n                            </div>\n                               </div>\n                          <div class='suc-foot' ng-click='closeReplenishSucPopup()'>知道啦</div>\n                        </div>",cssClass:"replenishSucPopup",scope:i})):o.showToast(e.message)}),i.closeReplenishSucPopup=function(){i.replenishSucPopup.close(),i.init()}):o.showToast("对不起，只能补签当月")},i.selectDate=function(){if("APP"==u.getPlatform()){var e=i.signSucDate.signYear,t=i.signSucDate.signMonth,o=i.signSucDate.signDay,s={date:new Date(e,t-1,o),mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(s,function(e){c(function(){var t=e.getDate(),o=e.getMonth()+1,s=e.getFullYear();o<10&&(o="0"+o),t<10&&(t="0"+t),i.defaultDate=s+"-"+o+"-"+t},200)})}else{var t=i.signSucDate.signMonth,e=i.signSucDate.signYear,n={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(e,t-1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(e){var t=new Date(e).getMonth()+1,o=new Date(e).getDate();t<10&&(t="0"+t),o<10&&(o="0"+o);new Date(e).getFullYear();i.defaultDate=new Date(e).getFullYear()+"-"+t+"-"+o}};p.openDatePicker(n)}},i.signChart=function(e){a.go("signInChart",{topicId:e})},i.weeks=["日","一","二","三","四","五","六"],i.tolink=function(e){var t=navigator.userAgent;t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"APP"==u.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e):(t.indexOf("iPhone"),"APP"==u.getPlatform()?cordova.InAppBrowser.open(e,"_system","location=yes"):window.open(e))},i.signDateActive=function(e,t,o){0!=t&&(1==t?a.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:o.fromType,storeId:o.storeId}):2==t||3==t&&i.tolink(e))},i.prevMonth=function(){i.getMonth-1==0?(i.getYear-=1,i.getMonth=12):i.getMonth-=1,i.monthFlag+=1,v(i.userId,i.topicId,i.monthFlag,i.getYear,i.getMonth)},i.nextMonth=function(){i.getMonth+1==13?(i.getYear+=1,i.getMonth=1):i.getMonth+=1,i.monthFlag-=1,v(i.userId,i.topicId,i.monthFlag,i.getYear,i.getMonth)}}]),APP.service("signDateService",["$http","UrlService",function(e,t){this.getSignDate=function(o,i,s,n,a){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_DATE"),data:{userId:o,topicId:i,monthFlag:s,year:n,month:a}})},this.getReplenishSign=function(o,i,s,n){return e({method:"POST",url:t.getUrl("CIRCLE_REPLENISH_SIGN"),data:{replenishSignDate:o,signType:i,topicId:s,userId:n}})},this.getUserData=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.controller("signInChartController",["$scope","$rootScope","$state","$stateParams","$ionicScrollDelegate","signInChartService","UserService","personalHomepageMeService",function(e,t,o,i,s,n,a,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.paddingtopClass={"padding-top":"30px"}:e.paddingtopClass={"padding-top":"14px"},e.goBack=function(){e.$ionicGoBack()},e.init=function(){e.topicId=i.topicId,e.signType=2,e.myCircleRankType=1,e.allCircleRankType=2,e.myCommunityRankType=3,e.allCommunityRankType=4,e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId)},e.getCircleChartFun=function(t,o,i){var s={rankType:t,signType:o,topicId:i};n.CurrentCircleChart(s).success(function(t){t.success&&(1==s.rankType||3==s.rankType?(e.userSignCount=t.data.rank[0].signCount,e.userRank=t.data.rank[0].rank):2!=s.rankType&&4!=s.rankType||(e.rankList=t.data.rank))})},e.$on("$ionicView.beforeEnter",function(t,o){"back"!=o.direction&&(s.scrollTop(),e.tabIndex=0,e.signListTitle="圈子",e.init())}),e.chooseTab=function(t){e.tabIndex=t,0==t?(e.getCircleChartFun(e.myCircleRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCircleRankType,e.signType,e.topicId),e.signListTitle="圈子"):(e.getCircleChartFun(e.myCommunityRankType,e.signType,e.topicId),e.getCircleChartFun(e.allCommunityRankType,e.signType,e.topicId),e.signListTitle="社区")}}]),APP.service("signInChartService",["$http","UrlService",function(e,t){this.CurrentCircleChart=function(o){return e({method:"POST",url:t.getUrl("CIRCLE_SIGN_CHART"),data:o})},this.getUserData=function(o,i){var s={type:o,id:i};return e({method:"post",url:t.getUrl("USER_SIMPLE_INFO"),data:s})},this.getMyTopics=function(o,i,s){return e({method:"post",url:t.getUrl("GETMYTOPICLIST"),data:{pageIndex:o,pageSize:i,userId:s}})}}]),APP.controller("topicRewardListController",["$ionicHistory","$http","$scope","topicRewardListService","$stateParams","$state","$cookieStore","$ionicPopup","$timeout","LoginService","$rootScope","$ionicModal","$localstorage","PopupService","NoteDetailsService","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f){o.tipId="",o.page=1,o.getList=function(){var e={tipId:parseInt(o.tipId),pageIndex:1,pageSize:5,sort:1,type:1};i.getList(e).success(function(e){o.shantotal=e.data,o.shanList=e.data.ucTips,e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1)})},o.loadMore=function(){o.page=o.page+1;var e={tipId:parseInt(o.tipId),pageIndex:o.page,pageSize:5,sort:1,type:1};i.getList(e).success(function(e){o.shanList=o.shanList.concat(e.data.ucTips),o.$broadcast("scroll.infiniteScrollComplete"),e.data.total>o.shanList.length?o.hasmore=!0:(o.$broadcast("scroll.infiniteScrollComplete"),o.hasmore=!1,g.showToast("没有更多了"))})},o.gotoothers=function(e){n.go("personalHomepageHe",{othersId:e.userId})},o.follow=function(e,t){if(e.isFollow){var i={id:e.userId,isFollow:0};m.followNote(i).success(function(e){if(1==e.success)for(var i=0;i<o.shanList.length;i++)o.shanList[i].userId==o.shanList[t].userId&&(o.shanList[i].isFollow=!1);else g.showToast(e.message)})}else{var i={id:e.userId,isFollow:1};m.followNote(i).success(function(e){if(1==e.success)for(var i=0;i<o.shanList.length;i++)o.shanList[i].userId==o.shanList[t].userId&&(o.shanList[i].isFollow=!0);else g.showToast(e.message)})}},o.scrollToTop=function(){f.$getByHandle("rewardHandle").scrollTop(!0),o.showTopBtn=!1},o.getScrollHeight=function(){o.scrollHeight=Math.abs(document.getElementById("bbb").getBoundingClientRect().top),o.scrollHeight>2*o.phoneHeight?o.showTopBtn=!0:o.showTopBtn=!1},o.init=function(){o.phoneHeight=document.documentElement.clientHeight/2,o.hasmore=!1,o.page=1,o.tipId=s.tipId,o.getList()},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(e,t){o.init()})}]),APP.service("topicRewardListService",["$http","UrlService",function(e,t){this.getList=function(o){return e.get(t.getUrl("CIRCLE_SHAN_LIST"),o)}}]),APP.controller("ApplyRefundController",["$scope","$ionicActionSheet","ApplyRefundService","PopupService","$timeout","$stateParams","$ionicHistory","$timeout","$rootScope",function(e,t,o,i,s,n,a,s,r){e.cOrderSnDetail=n.cOrderSn,e.refundData=[],e.description=8,e.typeActual=0,e.applyRefund={reason:""},e.init=function(){e.applyRefundType="请选择退款原因",o.applyRefund(e.cOrderSnDetail).success(function(t){t.success&&(e.refundData=t.data,e.typeActual=t.data.orderType,1==e.typeActual?e.repairType="退货退款":e.repairType="退货不退款")})},e.openSelect=function(){var o=t.show({buttons:[{text:"七天无理由"},{text:"大小尺寸"},{text:"颜色款式"},{text:"质量问题"},{text:"配送问题"},{text:"库存问题"},{text:"地址问题"},{text:"其他"}],titleText:"请选择退款原因",buttonClicked:function(t){switch(t){case 0:e.applyRefundType="七天无理由";break;case 1:e.applyRefundType="大小尺寸";break;case 2:e.applyRefundType="颜色款式";break;case 3:e.applyRefundType="质量问题";break;case 4:e.applyRefundType="配送问题";break;case 5:e.applyRefundType="库存问题";break;case 6:e.applyRefundType="地址问题";break;case 7:e.applyRefundType="其他"}return o(),e.description=t,!0}});s(function(){o()},1e4)},e.submitRefund=function(){8==e.description?i.showToast("请选择退款原因"):o.setApplyRefund(e.cOrderSnDetail,e.typeActual,e.applyRefund.reason,e.applyRefundType).success(function(e){"S"==e.data.state?(r.$broadcast("ORDER_RETURN_BACK"),i.showToast("提交成功！"),s(function(){a.goBack()},2e3)):e.data.message?(i.showToast(e.data.message),s(function(){a.goBack()},2e3)):i.showToast("提交失败！")})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("ApplyRefundService",["$http","UrlService",function(e,t){this.setApplyRefund=function(o,i,s,n){var a={cOrderSn:o,typeActual:i,description:s,reason:n};return e.get(t.getUrl("SUBMIT_APPLY_REFUND"),a)},this.applyRefund=function(o){var i={cOrderSn:o};return e.get(t.getUrl("APPLY_REFUND"),i)}}]),APP.controller("AssessController",["$scope","AssessService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope",function(e,t,o,i,s,n,a,r,c,l){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.assessData=[],e.parameter=[],e.isAssessed=!1,e.cOrderSnData=[],e.value=[],e.click=[],e.fileIds=[],e.click[0]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.iconImageData=[],e.iconImageData[0]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""},e.value[0]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.init=function(o,i){e.show=!1,t.getAssess(o,i).success(function(t,o,i,s){if(t.success){e.isAssessed=!t.data.products||0==t.data.products.length,e.assessDataLength=t.data.products.length,e.assessData=t.data.products;for(var n=0;n<e.assessDataLength;n++)e.cOrderSnData.push({cOrderSn:t.data.products[n].cOrderSn}),e.click[n]={isClickGood:!1,isClickMiddle:!1,isClickBad:!1},e.value[n]={value1:0,value2:0,value3:0,comment:"",evalution:0},e.iconImageData[n]={imgUrl1:"",imgUrl2:"",imgUrl3:"",imgUrl4:"",imgUrl5:""};e.addTime=t.data.addTime,e.ckCode=t.data.ckCode,e.consignee=t.data.consignee,e.memberId=t.data.memberId,e.memberName=t.data.memberName,e.mobile=t.data.mobile}else e.isAssessed=!0}).error(function(){e.isAssessed=!0})},e.assessType=function(t,o){0==t?(e.click[o].isClickGood=!e.click[o].isClickGood,e.click[o].isClickMiddle=!1,e.click[o].isClickBad=!1):1==t?(e.click[o].isClickMiddle=!e.click[o].isClickMiddle,e.click[o].isClickGood=!1,e.click[o].isClickBad=!1):2==t&&(e.click[o].isClickBad=!e.click[o].isClickBad,e.click[o].isClickMiddle=!1,e.click[o].isClickGood=!1),angular.forEach(e.click,function(t,o,i){t.isClickGood?e.value[o].evalution=1:t.isClickMiddle?e.value[o].evalution=2:t.isClickBad&&(e.value[o].evalution=3)})},e.setParams=function(){e.parameter=[];for(var t=0;t<e.assessDataLength;t++)e.parameter.push({addTime:e.addTime,assString:e.value[t].comment,cOrderSn:e.cOrderSnData[t].cOrderSn,ckCode:e.ckCode,consignee:e.consignee,evalution:e.value[t].evalution,memberId:e.memberId,memberName:e.memberName,mobile:e.mobile,productScore:e.value[t].value1,serviceScore:e.value[t].value3,shippingScore:e.value[t].value2,fileUrl1:e.iconImageData[t].imgUrl1,fileUrl2:e.iconImageData[t].imgUrl2,fileUrl3:e.iconImageData[t].imgUrl3,fileUrl4:e.iconImageData[t].imgUrl4,fileUrl5:e.iconImageData[t].imgUrl5})},e.submitAssess=function(){for(var o=0;o<e.assessDataLength;o++){if(!/^.{5,300}$/.test(e.value[o].comment))return void(1==e.assessDataLength?a.showToast("请输入5～300字的评价！"):a.showToast("请于第"+(o+1)+"件商品输入5～300字的评价！"));if(0==e.value[o].evalution)return void(1==e.assessDataLength?a.showToast("请选择评价！"):a.showToast("请于第"+(o+1)+"件商品选择评价！"));if(0==e.value[o].value1)return void(1==e.assessDataLength?a.showToast("请选择商品评分！"):a.showToast("请于第"+(o+1)+"件商品选择商品评分！"));if(0==e.value[o].value2)return void(1==e.assessDataLength?a.showToast("请选择物流评分！"):a.showToast("请于第"+(o+1)+"件商品选择物流评分！"));if(0==e.value[o].value3)return void(1==e.assessDataLength?a.showToast("请选择服务评分！"):a.showToast("请于第"+(o+1)+"件商品选择服务评分！"))}for(var s="",n=0;n<e.assessDataLength;n++)s+=e.value[n].comment;t.checkAssessText(s).success(function(o){o?(a.showToast("成功"),e.setParams(),t.submitAssessInfo(e.parameter,e.fileIds).success(function(e){e.success?(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),c.goBack()},1e3)):e.message?a.showToast(e.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.uploadImg=function(o){if("APP"==s.getPlatform()){var r={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},c=function(s){function r(s){e.iconImage=s,i(function(){e.iconImage=s},200);var r=function(t){n.hide(),a.showToast("上传成功");for(var i=JSON.parse(t.response),s=i.fileIds,r=0;r<s.length;r++)e.fileIds.push(s[r]);var c=i.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:a.showToast("最多只能输入5张照片！")},c=function(e){n.hide(),a.showToast("上传失败")},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var u={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};n.show(u)}function c(e){}function l(s){e.iconImage=s,i(function(){e.iconImage=s},200);var r=function(t){n.hide(),a.showToast("上传成功");for(var i=JSON.parse(t.response),s=i.fileIds,r=0;r<s.length;r++)e.fileIds.push(s[r]);var c=i.urls;""==e.iconImageData[o].imgUrl1?e.iconImageData[o].imgUrl1=c[0]:""==e.iconImageData[o].imgUrl2?e.iconImageData[o].imgUrl2=c[0]:""==e.iconImageData[o].imgUrl3?e.iconImageData[o].imgUrl3=c[0]:""==e.iconImageData[o].imgUrl4?e.iconImageData[o].imgUrl4=c[0]:""==e.iconImageData[o].imgUrl5?e.iconImageData[o].imgUrl5=c[0]:a.showToast("最多只能输入5张照片！")},c=function(e){a.showToast("上传失败"),n.hide()},l=new FileUploadOptions;l.fileKey="imageFile",l.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),l.mimeType="image/jpeg";var d={};l.params=d,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),r,c,l);var u={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};n.show(u)}function d(e){}1==s?navigator.camera.getPicture(r,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,saveToPhotoAlbum:!0,allowEdit:!0}):2==s&&navigator.camera.getPicture(l,d,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0})};window.plugins.actionsheet.show(r,c)}else a.showToast("请下载客户端实现上传图片功能")},e.$on("$ionicView.beforeEnter",function(){e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.init(e.orderId,e.cOrderSn)}),e.showLarge=function(t){e.show=!0,e.largeImg=t},e.closeImg=function(){e.show=!1},e.deleteImg=function(){e.show=!1;for(var t=0,o=0;o<e.assessDataLength;o++){if(e.largeImg==e.iconImageData[o].imgUrl1){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl2){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl3){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl4){t=o;break}if(e.largeImg==e.iconImageData[o].imgUrl5){t=o;break}}e.largeImg==e.iconImageData[t].imgUrl1?(e.iconImageData[t].imgUrl1=e.iconImageData[t].imgUrl2,e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl2?(e.iconImageData[t].imgUrl2=e.iconImageData[t].imgUrl3,e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl3?(e.iconImageData[t].imgUrl3=e.iconImageData[t].imgUrl4,e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl4?(e.iconImageData[t].imgUrl4=e.iconImageData[t].imgUrl5,e.iconImageData[t].imgUrl5=""):e.largeImg==e.iconImageData[t].imgUrl5&&(e.iconImageData[t].imgUrl5="")},e.goBack=function(){for(var t=!1,o=0;o<e.assessDataLength;o++)if(""!=e.iconImageData[o].imgUrl1||0!=e.value[o].value1||0!=e.value[o].value2||0!=e.value[o].value3||""!=e.value[o].comment||0!=e.value[o].evalution){var t=!0;break}if(t){a.showConfirm("","您的评价未完成，您确定离开吗？",function(e){e&&c.goBack()})}else c.goBack()}}]),APP.service("AssessService",["$http","UrlService",function(e,t){this.getAssess=function(o,i){var s={orderId:o,cOrderSn:i};return e.get(t.getUrl("GET_ASSESS"),s)},this.checkAssessText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),i)},this.submitAssessInfo=function(o,i){i=i.join();var s={assessList:JSON.stringify(o),fileIds:i};return e({method:"POST",url:t.getUrl("SUBMIT_ASSESS"),params:s})},this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG")}}]),APP.directive("commentBar",[function(){return{restrict:"E",template:'<div class="col padding-top-bottom-0"><img class="padding-left-10" width="20%" ng-click="comment(0)" ng-src="{{commentValue>=1?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(1)" ng-src="{{commentValue>=2?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(2)" ng-src="{{commentValue>=3?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(3)" ng-src="{{commentValue>=4?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"><img class="padding-left-10" width="20%" ng-click="comment(4)" ng-src="{{commentValue>=5?\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png\':\'http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png\'}}"></div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),
APP.controller("BannerDailyController",["$scope","BannerDailyService","$stateParams","$rootScope","$http","$state","UserService","CommonAddressService","GoodsService","$ionicHistory","PopupService","UrlService","$localstorage","$ionicLoading","BannerThemeService","CreditService","$ionicScrollDelegate","$ionicModal","$timeout",function($scope,BannerDailyService,$stateParams,$rootScope,$http,$state,UserService,CommonAddressService,GoodsService,$ionicHistory,PopupService,UrlService,$localstorage,$ionicLoading,BannerThemeService,CreditService,$ionicScrollDelegate,$ionicModal,$timeout){function getBannerDailyProducts(e,t,o,i,s,n,a,r){BannerDailyService.getBannerDaily(e,t,o,i,s,n,a,r).success(function(e){$scope.activityProductList=[],$scope.activityProductList=e.productsList,$ionicLoading.hide()})}function getShareInfo(e,t){BannerThemeService.getBannerTheme(e,t).success(function(e){shareInfo=e.data})}$scope.shareStoreId=$stateParams.shareStoreId;var bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,provinceId="",cityId="",areaId="",streetId="";$scope.storeId="",$scope.layout=$stateParams.layout,$scope.layout="layout-colum2",$scope.activityProductList=[],$scope.districtName="";var sharePic="http://www.ehaier.com/mstatic/wd/v2/img/sg.png",shareInfo={},screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="选择地区",$scope.dataAdd=null,$scope.flag="DAILY_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity;$scope.showShare=!1,$scope.dayliTitleStyle={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.dayliTitleStyle={top:"18px"}),$rootScope.isApp?$scope.BannerTopopType={right:"50px"}:$scope.BannerTopopType={right:"10px"},$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,bannerId=$stateParams.bannerId,platformType=$stateParams.platformType,memberId=$scope.shareStoreId||UserService.getUser().mid,GoodsService.getAddress().success(function(response){if(void 0!=response.data&&response.data&&0!=response.data.length){var addressInfo=eval(response.data),regionIndex=addressInfo[0].regionName.indexOf("/");$scope.districtName=addressInfo[0].regionName.substr(0,regionIndex),getBannerDailyProducts(memberId,addressInfo[0].provinceId,addressInfo[0].cityId,addressInfo[0].areaId,addressInfo[0].streetId,addressInfo.regionName,bannerId,platformType)}else{var defaultAddressInfo=CommonAddressService.getAddressInfo();$scope.districtName=defaultAddressInfo.regionName,getBannerDailyProducts(memberId,defaultAddressInfo.provinceId,defaultAddressInfo.cityId,defaultAddressInfo.areaId,defaultAddressInfo.streetId,defaultAddressInfo.regionName,bannerId,platformType)}}).error(function(e){var t=CommonAddressService.getAddressInfo();$scope.districtName=t.regionName,getBannerDailyProducts(memberId,t.provinceId,t.cityId,t.areaId,t.streetId,t.regionName,bannerId,platformType)}),getShareInfo(bannerId,platformType)},$rootScope.$on("DAILY_LOCATION",function(e,t){$scope.districtName=t["text-3"],$scope.streetName=t["text-4"];var o=$scope.districtName+"/"+$scope.streetName;provinceId=t["value-1"],cityId=t["value-2"],areaId=t["value-3"],streetId=t["value-4"],GoodsService.addAddress(provinceId,cityId,areaId,o,streetId).success(function(e,t,o,i){e.success&&getBannerDailyProducts(memberId,provinceId,cityId,areaId,streetId,$scope.districtName,bannerId)})}),$scope.goBack=function(){$ionicHistory.goBack()},$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.dataAdd=null,$scope.defaultValue=null,$scope.goBackFlag=!0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$scope.storeId=$stateParams.shareStoreId?$stateParams.shareStoreId:$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.shareStoreId=$stateParams.shareStoreId,memberId=$scope.shareStoreId||UserService.getUser().mid,bannerId=$stateParams.bannerId,$scope.layout=$stateParams.layout,$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"DAILY_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})}),$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"COUPONSLIST",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="选择地区",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"2px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"COUPONSLIST",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):($scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;GoodsService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e)}),$scope.addressModal.hide()}},$scope.share=function(){if(window.device&&window.device.hasNewShare){if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");$scope.showShare=!$scope.showShare}else{if(!UserService.getUser().mid)return void PopupService.showToast("请先登录,再分享");if(window.umeng){var e=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid;window.umeng.share(shareInfo.title,shareInfo.content,shareInfo.imgUrl,e,0)}}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=UrlService.getShareLinkHeader()+"bannerDaily/"+bannerId+"/"+$scope.layout+"/"+UserService.getUser().mid,o=shareInfo.title,i=shareInfo.imgUrl,s=shareInfo.content;window.umeng?(0==e?window.umeng.shareToSina(o,s,i,t,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,s,i,t,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,s,i,t,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,s,i,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(o,s,i,t,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(t),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1}}]),APP.service("BannerDailyService",["$http","UrlService",function(e,t){this.getBannerDaily=function(o,i,s,n,a,r,c,l){var d={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,provinceName:void 0,cityName:void 0,districtName:r,bannerId:c,platformType:l};return e.get(t.getUrl("GET_BANNER_DAILY"),d)}}]),APP.controller("BannerThemeController",["$scope","BannerThemeService","$stateParams","$state","$ionicHistory","$localstorage","UserService","PopupService","UrlService","CreditService","InAppBrowserService","$rootScope",function(e,t,o,i,s,n,a,r,c,l,d,u){function p(o,i){t.getBannerTheme(o,i).success(function(t){e.activityImageList=t.data.productList,h=t.data})}var g=o.bannerId,m=n.get("storeId","20219251"),f=o.platformType;e.activityImageList=[];e.shareStoreId=o.shareStoreId;var h={};e.showShare=!1,e.leftArrow={},e.rightShare={top:"26px"},e.leftShare={top:"26px"},window.cordova&&ionic.Platform.isIOS,e.rightShare={top:"16px",position:"absolute",left:"8px","z-index":"10",width:"32px"},window.cordova&&ionic.Platform.isIOS,e.leftShare={top:"16px",position:"absolute",right:"8px","z-index":"10",width:"32px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(e.leftArrow={top:"14px"}),e.goDetail=function(t){var o=e.activityImageList[t];if(o.productId)i.go("productDetail",{productId:o.productId,o2oType:o.o2oType,fromType:"",storeId:m,shareStoreId:e.shareStoreId});else if(o.activityUrl)if(-1!=o.activityUrl.indexOf("VRshop")){var s=null,n=c.getHead().replace("v3","www"),a=n+"index.html#/VrPage/";s=d.open(a),s.addEventListener("loadstart",function(e){-1!=e.url.indexOf("backToApp")&&s.close()})}else if(-1!=o.activityUrl.indexOf("coupon/toList"))i.go("getCouponsList",{shareStoreId:e.shareStoreId});else if(-1!=o.activityUrl.indexOf("m.ehaier.com/www/index.html")){var r=o.activityUrl.slice(o.activityUrl.indexOf("#/"));window.location.hash=r}else window.cordova?u.isIOS?cordova.InAppBrowser.open(o.activityUrl,"_system","location=yes"):cordova.InAppBrowser.open(o.activityUrl,"_blank","location=yes"):window.open(o.activityUrl,"_blank","location=yes")},e.goBack=function(){s.backView()?s.goBack():i.go("homePage")},e.init=function(){e.showQQ=!1,e.showWeChat=!1,g=o.bannerId,f=o.platformType,p(g,f)},e.$on("$ionicView.beforeEnter",function(t,i){m=o.shareStoreId?o.shareStoreId:n.get("storeId","20219251"),e.shareStoreId=o.shareStoreId,"back"==i.direction||e.init()}),e.share=function(){if(window.device&&window.device.hasNewShare){if(!a.getUser().mid)return void r.showToast("请先登录,再分享");e.showShare=!e.showShare}else{if(!a.getUser().mid)return void r.showToast("请先登录,再分享");if(window.umeng){var t=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+a.getUser().mid;window.umeng.share(h.title,h.content,h.imgUrl,t,0)}}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),r.showToastShort("复制成功")):r.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=c.getShareLinkHeader()+"bannerTheme/"+g+"/"+a.getUser().mid,i=h.title,s=h.imgUrl,n=h.content;window.umeng?(0==t?window.umeng.shareToSina(i,n,s,o,0,null,l.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(i,n,s,o,0,null,l.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(i,n,s,o,0,null,l.shareSuccessCallback):3==t?(window.umeng.shareToQQ(i,n,s,o,0,null,l.shareSuccessCallback),l.qqShare()):4==t?(window.umeng.shareToQzone(i,n,s,o,0,null,l.shareSuccessCallback),l.qqShare()):5==t&&e.copeText(o),l.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1}}]),APP.service("BannerThemeService",["$http","UrlService",function(e,t){this.getBannerTheme=function(o,i){if(i)var s={bannerId:o,isHost:"1",backUrl:"",platformType:i};else s={bannerId:o,isHost:"1",backUrl:""};return e.get(t.getUrl("GET_BANNER_THEME"),s)}}]),APP.controller("ChooseShopTemplateController",["$rootScope","$scope","$ionicModal","ChooseShopTemplateService","UserService",function(e,t,o,i,s){t.titleTemplateArray=[],t.listTemplateArray=[],t.titleId="",t.listId="",t.previewImgIndex="",t.storeId=s.getUser().mid,t.init=function(){t.storeId=s.getUser().mid,t.getTemplate(t.storeId)},t.getTemplate=function(e){i.getShopTemplates(e).success(function(e,o,i,s){t.titleTemplateArray=e.data.titleTemplate,t.listTemplateArray=e.data.listTemplate,angular.forEach(t.titleTemplateArray,function(e){1==e.selected&&(t.titleId=e.tit)}),angular.forEach(t.listTemplateArray,function(e){1==e.selected&&(t.listId=e.layout)})}).error(function(e){})},t.setTemplate=function(e){i.setShopTemplate(e).success(function(e,o,i,s){t.getTemplate(t.storeId)})},t.chooseTitleTemplate=function(e){t.titleId=t.titleTemplateArray[e].tit;var o=t.titleId+"-"+t.listId;t.setTemplate(o)},t.chooseListTemplate=function(e){t.listId=t.listTemplateArray[e].layout;var o=t.titleId+"-"+t.listId;t.titleId,t.listId;t.setTemplate(o)},o.fromTemplateUrl("my-preview-modal.html",{scope:t,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){t.modal=e}),t.preview=function(){switch(t.listId+t.titleId){case"layout-dftit-df":t.previewImgIndex="01";break;case"layout-dftit-bp":t.previewImgIndex="02";break;case"layout-dftit-colum2":t.previewImgIndex="03";break;case"layout-bptit-df":t.previewImgIndex="04";break;case"layout-bptit-bp":t.previewImgIndex="05";break;case"layout-bptit-colum2":t.previewImgIndex="06";break;case"layout-colum2tit-df":t.previewImgIndex="07";break;case"layout-colum2tit-bp":t.previewImgIndex="08";break;case"layout-colum2tit-colum2":t.previewImgIndex="09"}t.modal.show()},t.closeModal=function(){t.modal.hide()},t.$on("$destroy",function(){t.modal.remove()}),t.$on("$ionicView.beforeEnter",function(){t.init()})}]),APP.service("ChooseShopTemplateService",["$http","UrlService",function(e,t){this.getShopTemplates=function(o){var i={storeId:o,noLoading:!0};return e.get(t.getUrl("GET_SHOP_TEMPLATES"),i)},this.setShopTemplate=function(o){var i={templateId:o,noLoading:!0};return e({method:"POST",url:t.getUrl("SET_SHOP_TEMPLATES"),params:i})}}]),APP.service("ConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMsg=function(o,i,s){var n={relationshipType:o,pageIndex:i,pageSize:s};return e.get(t.getUrl("CONNECTION_INDEX"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.service("ConnectionDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("ConnectionSearchController",["$scope","ConnectionSearchService","UserService","UrlService","PopupService","$state","$stateParams",function(e,t,o,i,s,n,a){function r(e,o){for(var i in e)e[i].storeName=t.limitStrLength(e[i].storeName,o)}e.backToLastView=function(){e.$ionicGoBack()};var c=document.querySelector("#focus");e.gotoPartnerDetail=function(e,t){1==t?n.go("partnerDetail",{ownerId:e}):n.go("connectionDetail",{ownerId:e})},e.searchConnection=function(){if(""==e.searchValue)return void s.showToast("请填写搜索内容");t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){e.searchResults=t.data.partners,r(e.searchResults,e.storeNameListLength),0==e.searchResults.length?e.noSearchResults=!0:e.noSearchResults=!1})},e.loadMore=function(){e.pageIndex++,t.getSearchResults(e.searchType,e.searchValue,e.pageIndex,e.pageNum).success(function(t){t.success&&(t.data.partners.length<e.pageNum?(e.hasMore=!1,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")):(e.hasMore=!0,r(t.data.partners,e.storeNameListLength),e.searchResults=e.searchResults.concat(t.data.partners),e.$broadcast("scroll.infiniteScrollComplete")))})},e.$on("$ionicView.enter",function(){"back"==e.direction?c.blur():(e.searchValue="",e.searchResults=[],setTimeout(function(){try{c.focus()}catch(e){}},200))}),e.$on("$ionicView.beforeEnter",function(t,o){e.direction=o.direction,e.searchType=a.searchType,e.storeNameListLength=Math.floor((window.innerWidth-82)/17*2-1),e.pageIndex=0,e.pageNum=10,e.hasMore=!0,1==e.searchType?e.placeHolder="请输入合伙人信息":e.placeHolder="请输入人脉信息"})}]),APP.service("ConnectionSearchService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getSearchResults=function(o,i,s,n){var a={relationshipType:o,keyword:i,pageIndex:s,pageSize:n};return e.get(t.getUrl("CONNECTION_INDEX"),a)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("CustomPageCtrl",["$stateParams","$scope","$rootScope","UrlService","CreditService","UserService","$state","CustomPageService","$timeout","$localstorage","$ionicSlideBoxDelegate","GetCouponsService","PopupService","BannerThemeService","GoodsService","$ionicLoading",function($stateParams,$scope,$rootScope,UrlService,CreditService,UserService,$state,CustomPageService,$timeout,$localstorage,$ionicSlideBoxDelegate,GetCouponsService,PopupService,BannerThemeService,GoodsService,$ionicLoading){$scope.customPageId=$stateParams.customPageId?$stateParams.customPageId:"",$scope.showShare=!1,$scope.shareimg="",$scope.storeId=0,$scope.hashtitle="",$scope.sharedesp="",$scope.moduleList=[],$scope.skuMap={},$scope.couponMap={},$scope.index=[],$scope.showjuanyz=!1,$scope.juanlist=[],$scope.juankeling={},$scope.juanqiangwan={},$scope.streetId=12036596,$scope.init=function(){$scope.storeId=$localstorage.get("storeId",$rootScope.globalConstant.storeId),$scope.showQQ=!1,$scope.showWeChat=!1,$scope.showShare=!1,window.cordova?$scope.isApp=!0:$scope.isApp=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(e){$scope.showQQ=0!=e}),window.umeng.checkAppInstalled("wechat",function(e){$scope.showWeChat=0!=e})),$scope.$broadcast("scroll.refreshComplete"),GoodsService.getAddress().success(function(response){if(response.success&&response.data){var addressMessage=eval(response.data)[0];void 0!=addressMessage.streetId&&($scope.streetId=addressMessage.streetId)}CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(e){if(1==e.success){$scope.hashtitle=e.data.name,$scope.moduleList=e.data.modualList,$scope.skuMap=e.data.skuMap,$scope.couponMap=e.data.couponMap,$scope.sharedesp=e.data.description;for(var t in $scope.moduleList)if("SWITCH"==$scope.moduleList[t].modualType){$scope.shareimg=$scope.moduleList[t].imageList[0].imageUrl;break}for(var o=0;o<$scope.moduleList.length;o++)$scope.moduleList[o].tabList&&($scope.index[o]=0);for(var i in e.data.couponMap)e.data.couponMap[i].totalGetNum>=e.data.couponMap[i].totalLimitNum?($scope.juankeling[i]=!0,$scope.juanqiangwan[i]=!0):(e.data.couponMap[i].getNum<e.data.couponMap[i].personLimitNum&&($scope.juankeling[i]=!0,$scope.juanqiangwan[i]=!1),e.data.couponMap[i].getNum>=e.data.couponMap[i].personLimitNum&&($scope.juankeling[i]=!1,$scope.juanqiangwan[i]=!1));$timeout(function(){$ionicSlideBoxDelegate.update(),$ionicSlideBoxDelegate.loop(!0)},200)}else PopupService.showToast(e.message)})})},$rootScope.$on("CACHE_SUCCESS",function(e,t){var o={template:"地址切换中，请稍后...",duration:1e3};$ionicLoading.show(o),$scope.init()}),$scope.changestyle=function(e,t){$scope.index[t]=e},$scope.getjuan=function(e,t){1!=$scope.juanqiangwan[e]&&0!=$scope.juankeling[e]&&(UserService.getUser().mid?GetCouponsService.doGetNewCoupons(e).success(function(t){t.success?CustomPageService.getdata($scope.customPageId,$scope.streetId).success(function(o){var i=o.data.couponMap[e].getNum,s=o.data.couponMap[e].personLimitNum;if(o.data.couponMap[e].totalGetNum>=o.data.couponMap[e].totalLimitNum)return $scope.juankeling[e]=!0,void($scope.juanqiangwan[e]=!0);i<s&&($scope.juankeling[e]=!0,$scope.juanqiangwan[e]=!1),i>=s&&($scope.juankeling[e]=!1,$scope.juanqiangwan[e]=!1),PopupService.showToast(t.message)}):PopupService.showToast(t.message)}):$state.go("login"))},$scope.goshare=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.showShare=!$scope.showShare},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.hashtitle,o=$scope.sharedesp,i=$scope.shareimg,s=UrlService.getShareLinkHeader()+"CustomPage";window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e&&(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()),5==e?$scope.copeText(s):CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.bannerClick=function(e,t,o){var i=t.split("&");switch(e){case"-1":BannerThemeService.getBannerTheme(o).success(function(e){$state.go("bannerDaily",{bannerId:o,layout:e.data.layout})});break;case"0":$state.go("bannerTheme",{bannerId:o});break;case"1":var s=i[0].slice(i[0].indexOf("=")+1);$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:s,storeId:$scope.storeId});break;case"2":if(t){var n=t.slice(t.indexOf("=")+1);$state.go("couponsDetail",{cId:n,userID:$scope.storeId,type:2})}else $state.go("getCouponsList");break;case"3":var a=t.slice(t.indexOf("=")+1);$state.go("game",{gameId:a});break;case"4":"日常活动"==i[0].slice(i[0].indexOf("=")+1)?BannerThemeService.getBannerTheme(i[1].slice(i[1].indexOf("=")+1)).success(function(e){$state.go("bannerDaily",{bannerId:i[1].slice(i[1].indexOf("=")+1),layout:e.data.layout})}):"主题活动"==i[0].slice(i[0].indexOf("=")+1)&&$state.go("bannerTheme",{bannerId:i[1].slice(i[1].indexOf("=")+1)});break;case"5":if(window.cordova)if(-1!=t.indexOf("m.ehaier.com/www/index.html")){var r=t.slice(t.indexOf("#/"));window.location.hash=r}else window.emc.presentH5View(t,"");else window.open(t,"_blank","location=yes");break;case"6":$state.go("crowdFunding");break;case"7":t?$state.go("productDetail",{fromType:"",fromUrl:"",o2oType:0,productId:t,storeId:$scope.storeId}):$state.go("newSend");break;case"8":t?$state.go("noteDetails",{noteId:i[0].slice(i[0].indexOf("=")+1),isShortStory:i[1].slice(i[1].indexOf("=")+1)}):$state.go("topic.qhot")}},$scope.$on("$ionicView.beforeEnter",function(e,t){$scope.init()})}]),APP.service("CustomPageService",["$http","UrlService",function(e,t){this.getdata=function(o,i){if(""==o)var s={streetId:i};else var s={customPageId:o,streetId:i};return e.get(t.getNewUrl("CUSTOMPAGE_MODEL"),s)}}]),APP.controller("CustomerServiceController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","CustomerServiceService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(){a.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),i(function(){t.availableToTop(),t.pageIndex=0,t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,""),t.loadOrderAmount(t.orderFlag)},1e3)}function w(e){e?a.deleteOrder(C).success(function(e){e.success?t.init():(g.showToastShort(e.message),C="")}).error(function(e){g.showToastShort("删除失败！"),C=""}):C=""}t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=5,t.isIos=!1,t.BDO=!1;var y,T="";t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderAmountData=[],t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var C="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType="全部订单",t.availableToTop(),t.loadOrderAmount(0),t.loadOrderList(!1,0,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),t.pageIndex=0},t.batchDeleteOrder=function(){s.go("batchDeleteOrder")},t.loadOrderList=function(e,o,i,s,n,c,l,d){a.getOrderList(o,i,s,n,c,d).success(function(s){if(s.success){if("closed"==i?(y=s.data.canDeleteAll,s.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(y=!1,t.BDO=!1),t.emptySearch=!1,s.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(s.data.orders);else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=t.orderList.concat(s.data.orders);else if(l)t.searchOrderList=s.data.orders;else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=s.data.orders;l?t.hasMoreDataSearch=s.data.orderProductSize:t.hasMoreData=s.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadOrderAmount=function(e){a.getOrderAmount(e).success(function(e){e.success&&(t.orderAmountData=e.data)})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"",!0)},t.payTest=function(e,o,i){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var n=e,a="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?S.getAliPayInfo(n,i,a).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");T=e.result,window.alipay.pay({payInfo:T},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:n,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+n,price:i,notifyUrl:a},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};u.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,i,n,a){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};u.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。")
;window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+i+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,i,n){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};u.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):s.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,i){e.getOrderList(t).success(function(e){couponLists=e.data.couponList,couponLists.length>0&&i?s.go("Retainage",{relationOrderSn:t}):s.go("paymentxyz",{orderSn:t})})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.closeSearchModal(),s.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){s.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,i,n,a,r){r&&t.closeSearchModal(),s.go("orderDetail",{orderSn:e,cOrderSn:o})},t.goAssess=function(e,t,o){o?s.go("assess",{orderId:e,cOrderSn:t}):s.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?s.go("lookAssess",{orderId:e,cOrderSn:t}):s.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",$,"确定")},t.confirmReceive=function(e,o,i){function n(e){e&&I.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',n,"确认"):s.go("confirmReceive",{orderId:i})},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.raiseStatusOne={background:"red",color:"#ffffff"},t.raiseStatusTwo={background:"red",color:"#ffffff"},t.raiseStatusThree={background:"red",color:"#ffffff"},t.raiseStatusFour={background:"red",color:"#ffffff"},t.orderFlag=0,t.BDO=!!y,"back"==o.direction||t.init()}),t.deleteOrder=function(e){C=e,g.showConfirm("","确认删除此订单？",w,"删除")},d.$on("AFTER_COMMIT",function(e){t.loadOrderAmount(0)})}]),APP.service("CustomerServiceService",["$http","UrlService",function(e,t){this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,pageIndex:s,pageSize:n,keyword:a};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(o){var i={chooseOrder:o};return e.get(t.getNewUrl("ORDER_AMOUNT"),i)},this.cancelOrder=function(o,i){var s={orderId:o,cancelFlag:i};return e.get(t.getUrl("CANCEL_ORDER"),s)},this.payOrder=function(o){var i={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),i)},this.deleteOrder=function(o){var i={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),i)}}]),APP.filter("cut",function(){return function(e,t,o,i){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var s=e.lastIndexOf("");-1!=s&&(e=e.substr(0,s))}return e+(i||"…")}}),APP.controller("FeedbackController",["$scope","$ionicActionSheet","FeedbackService","PopupService","$timeout",function(e,t,o,i,s){e.userInfo={type:6,content:"",contact:""},e.init=function(){e.feedbackType="请选择"},e.openSelect=function(){var o=t.show({buttons:[{text:"功能意见"},{text:"界面意见"},{text:"您的新需求"},{text:"操作意见"},{text:"流量问题"},{text:"其他"}],titleText:"请选择",buttonClicked:function(t){switch(t){case 0:e.feedbackType="功能意见";break;case 1:e.feedbackType="界面意见";break;case 2:e.feedbackType="您的新需求";break;case 3:e.feedbackType="操作意见";break;case 4:e.feedbackType="流量问题";break;case 5:e.feedbackType="其他"}return o(),e.userInfo.type=t,!0}});s(function(){o()},1e4)},e.submitFeedback=function(){6==e.userInfo.type?i.showToast("请选择反馈类型！"):0==e.userInfo.content.length?i.showToast("请输入反馈内容！"):e.globalConstant.mobileNumberRegExp.test(e.userInfo.contact)?o.setFeedback(e.userInfo.type,e.userInfo.content,e.userInfo.contact).success(function(e,t,o,s){e.success?i.showToast("提交成功"):i.showToast(e.message)}):i.showToast("请输入正确的联系方式！")},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("FeedbackService",["$http","UrlService",function(e,t){this.setFeedback=function(o,i,s){var n={type:o,content:i,contact:s};return e.get(t.getUrl("FEEDBACK"),n)}}]),APP.controller("GoodsManageController",["$scope","GoodsManageService","$ionicModal","UserService","GoodsService",function(e,t,o,i,s){e.flag=[],e.isShowOnFooter=!1,e.isShowOffFooter=!1,e.moreOrCheck=!1,e.goodsList=[],e.onSaleAmount,e.offSaleAmount,e.searchGoodsList=[];var n,a=[],r=!1,c=!0,l=1,d=1;e.keywords={keyword:""},e.init=function(){e.loadData(n,l,20,242,3466),t.getGoodsList(n,0,20,242,3466).success(function(t,o,i,s){t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0})},e.loadData=function(o,i,s,n,a){t.getGoodsList(o,i,s,n,a).success(function(t,o,s,n){for(var a=0,r=t.productsList.length;a<r;a++)t.productsList[a].isSelected=!1;e.goodsList=t.productsList,1==i?t.productsList&&t.productsList.length>0?e.onSaleAmount=t.productsList.length:e.onSaleAmount=0:0==i&&(t.productsList&&t.productsList.length>0?e.offSaleAmount=t.productsList.length:e.offSaleAmount=0)})},e.searchGoods=function(){d=1,t.searchGoods(d,5,n,e.keywords.keyword,20,242,3466).success(function(t,o,i,s){e.searchGoodsList=t.productsList})},e.searchMore=function(){d+=1,t.searchGoods(d,5,n,e.keywords.keyword,20,242,3466).success(function(t,o,i,s){e.searchGoodsList=e.searchGoodsList.concat(t.productsList)})},e.onSale=function(){if(!c){c=!0,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("onSale").style.color="#32BEFF";document.getElementById("offSale").style.color="black",l=1,e.loadData(n,l,20,242,3466)}},e.offSale=function(){if(c){c=!1,e.flag=[],e.moreOrCheck=!1,e.isShowOnFooter=!1,e.isShowOffFooter=!1;document.getElementById("offSale").style.color="#32BEFF";document.getElementById("onSale").style.color="black",l=0,e.loadData(n,l,20,242,3466)}},e.showBtn=function(e){if(c){var t=document.getElementsByClassName("sm-bottom-btn-on");angular.forEach(t,function(t,o){t.style.display=o==e?"inline-block":"none"})}else{var o=document.getElementsByClassName("sm-bottom-btn-off");angular.forEach(o,function(t,o){t.style.display=o==e?"inline-block":"none"})}},e.batchOperate=function(){for(var t=document.getElementsByClassName("sm-bottom-btn-on"),o=document.getElementsByClassName("sm-bottom-btn-off"),i=0,s=e.goodsList.length;i<s;i++)t[i].style.display="none",o[i].style.display="none";c?e.isShowOnFooter=!e.isShowOnFooter:e.isShowOffFooter=!e.isShowOffFooter,e.moreOrCheck=!e.moreOrCheck},e.deleteGoods=function(t){e.goodsList[t].sku;e.flag[t]=!e.flag[t],c?e.onSaleAmount=e.onSaleAmount-1:e.offSaleAmount=e.offSaleAmount-1,e.goodsList.splice(t,1)},e.soldOut=function(o){var i=e.goodsList[o].sku;t.updateGoods(n,i,1).success(function(e){}),e.flag[o]=!e.flag[o],e.onSaleAmount=e.onSaleAmount-1,e.offSaleAmount=e.offSaleAmount+1,e.goodsList.splice(o,1)},e.putAway=function(o){var i=e.goodsList[o].sku;t.updateGoods(n,i,0).success(function(e){}),e.flag[o]=!e.flag[o],e.offSaleAmount=e.offSaleAmount-1,e.onSaleAmount=e.onSaleAmount+1,e.goodsList.splice(o,1)},e.putAwayBatch=function(){var o=a.join("@");t.updateGoodsBatch(o,0).success(function(e,t,o,i){}),e.loadData(n,0,20,242,3466),a=[]},e.soldOutBatch=function(){var o=a.join("@");t.updateGoodsBatch(o,1).success(function(e,t,o,i){}),e.loadData(n,1,20,242,3466),a=[]},e.deleteGoodsBatch=function(){a.join("@");c?e.loadData(n,1,20,242,3466):e.loadData(n,0,20,242,3466),a=[]},e.selectGoods=function(t){if(0==e.goodsList[t].isSelected)e.goodsList[t].isSelected=!0,a.push(e.goodsList[t].sku);else if(e.goodsList[t].isSelected=!1,a&&a.length>=0){var o=a.indexOf(e.goodsList[t].sku);a.splice(o,1)}r=a.length==e.goodsList.length},e.selectAll=function(){r?(angular.forEach(e.goodsList,function(e){e.isSelected=!1}),r=!1):(angular.forEach(e.goodsList,function(e){e.isSelected=!0}),r=!0)},o.fromTemplateUrl("templates/shop/GoodsSearch.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.searchModal=t}),e.openSearchModal=function(){e.searchModal.show()},e.closeSearchModal=function(){e.searchModal.hide()},e.$on("$destroy",function(){e.searchModal.remove()}),e.removeProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,s.changeChooseStateDui(o).success(function(e,t,o,i){})},e.addProduct=function(t){var o=e.searchGoodsList[t].sku;e.searchGoodsList[t].onShelf=!e.searchGoodsList[t].onShelf,s.changeChooseStateJia(o,"1").success(function(e,t,o,i){})},e.$on("$ionicView.beforeEnter",function(){n=i.getUser().mid,e.init()})}]),APP.service("GoodsManageService",["$http","UrlService",function(e,t){this.getGoodsList=function(o,i,s,n,a){var r={memberId:o,onShelf:i,provinceId:s,cityId:n,districtId:a};return e.get(t.getUrl("GOODS_LIST"),r)},this.deleteGoods=function(o,i){var s={memberId:o,sku:i};return e.get(t.getUrl("DELETE_GOODS"),s)},this.updateGoods=function(o,i,s){var n={memberId:o,sku:i,onShelf:s};return e.get(t.getUrl("UPDATE_GOODS"),n)},this.searchGoods=function(o,i,s,n,a,r,c){var l={pageIndex:o,pageSize:i,memberId:s,keyword:n,provinceId:a,cityId:r,districtId:c};return e.get(t.getUrl("SEARCH_GOODS"),l)},this.updateGoodsBatch=function(o,i){var s={skuStr:o,onShelf:i};return e.post(t.getUrl("UPDATE_GOODS_BATCH"),s)},this.deleteGoodsBatch=function(o){var i={skuStr:o};return e.post(t.getUrl("DELETE_GOODS_BATCH"),i)}}]),APP.controller("HelpDetailController",["$scope","$stateParams","HelpDetailService","$ionicModal","$timeout","$sce","UrlService","PlatformService",function(e,t,o,i,s,n,a,r){e.helpId=t.helpId,e.title=t.content,e.isIos=!1,e.htmlContent=t.content,e.trustSrc=function(e){return n.trustAsResourceUrl(e)},e.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?e.isIos=!0:e.isIos=!1,e.htmlContent=a.getHead()+"mstore/sg/helpDetail.html?id="+t.helpId,e.trustSrc=function(e){return n.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.service("HelpDetailService",["$http","UrlService",function(e,t){this.getHelpDetail=function(o){var i={id:o};return e.get(t.getUrl("HELP_DETAIL"),i)}}]),APP.controller("LookAssessController",["$scope","LookAssessService","$stateParams","$ionicLoading","$timeout","PlatformService","PopupService","$ionicHistory",function(e,t,o,i,s,n,a,r){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.show=!1,e.orderId=o.orderId,e.cOrderSn=o.cOrderSn,e.goBack=function(){r.goBack()},e.closeImg=function(){e.show=!1},e.showLarge=function(t){e.show=!0,e.largeImg=t},e.init=function(o){t.getLookAssess(o).success(function(t,o,i,s){t.success?(e.assessList=t.data.comment,e.stateList=t.data,e.timeIsOrNo=(e.timeNow-e.assessList.createTime)/1e3/60/60/24<90):a.showToast(t.memessage)})},e.$on("$ionicView.beforeEnter",function(){e.cOrderSn=o.cOrderSn,e.init(e.cOrderSn),e.timeNow=Date.parse(new Date)})}]),APP.service("LookAssessService",["$http","UrlService",function(e,t){this.getLookAssess=function(o){var i={cOrderSn:o};return e.get(t.getUrl("LOOK_ASSESS_INGO"),i)}}]),APP.controller("ManageMoneyController",["$scope","ManageMoneyService","$ionicModal","$state","InAppBrowserService","$stateParams","UrlService","PopupService","$rootScope",function(e,t,o,i,s,n,a,r,c){function l(){t.checkKjtLogin().success(function(o){if(o.data.isLogin)f=o.data.token,e.promotionList=[],d(o.data.token),e.getPromoteReward(o.data.token,1,g),u(o.data.token);else{var n=$+"index.html#/manageMoney/"+S+"?page="+I,r=escape(n),c=a.getCPUrl("KQT_URL")+"?page=authorizeMain&partner_id="+m+"&return_url="+r;if(window.cordova){var l="",p="page="+$+"index.html#/homePage/",v="page="+$+"index.html#/shopRevenue";h=s.open(c),h.addEventListener("exit",function(){-1!=l.indexOf("auth_code")||-1!=l.indexOf(v)||-1!=l.indexOf(p)||e.$ionicGoBack()}),h.addEventListener("loadstart",function(o){if(l=unescape(o.url),-1!=o.url.indexOf("auth_code")){var s=o.url.indexOf("auth_code")+10,n=o.url.toString().substr(s,32);h.close(),t.getKjtToken(n).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),u(t.data.token)})}else-1!=l.indexOf(v)&&-1==l.indexOf("&return_url=")?i.go("shopRevenue"):-1!=l.indexOf(p)&&-1==l.indexOf("&return_url=")&&i.go("homePage")})}else window.location.href=c}})}function d(o){t.getHryActivityInfo(o).success(function(t){t.success&&(e.activityInfo=t.data.promotionActivityList,e.activityRule=t.data.description)})}function u(o){t.getRefCode(o).success(function(t){t.success&&(e.promoCode=t.data.promoCode,e.qrCodeUrl=t.data.qrCodeUrl)})}var p=1,g=5,m=a.getCPUrl("KQT_ID"),f="",h=null;e.activityInfo=[],e.activityRule="";var v=null,S=n.frontState,I="",$=a.getHead().replace("v3","www");e.showAgreement=!1,e.hasMoreData=!1,e.promoCode="",e.qrCodeUrl="",e.promotionList=[],e.init=function(){if(p=1,-1!=v.indexOf("auth_code")){var o=v.indexOf("auth_code")+10,i=v.toString().substr(o,32);t.getKjtToken(i).success(function(t){f=t.data.token,e.promotionList=[],d(t.data.token),e.getPromoteReward(t.data.token,1,g),u(t.data.token)})}else l()},e.getPromoteReward=function(o,i,s){t.getPromoteReward(o,i,s).success(function(t){if(t.success){e.promotionList=e.promotionList.concat(t.data.promotionList);var o=e.promotionList.length;e.hasMoreData=o!=t.totalCount}else e.hasMoreData=!1})},e.getMoreData=function(){p++,e.getPromoteReward(f,p,g)},e.shareToPlatform=function(t){var o="好友力邀您来海融易，海融易为您准备了一份688大礼，快来领取吧！",i="http://m.ehaier.com/www/img/icon_inside_qrcode.png",s=e.qrCodeUrl;window.umeng?1==t?window.umeng.shareToWechatSession("快来领688元红包！",o,i,s,0,null,function(){e.sharemodal.hide()}):window.umeng.shareToWechatTimeline("快来领688元红包！",o,i,s,0,null,function(){e.sharemodal.hide()}):r.showAlert("只能在app分享","抱歉，只能在app分享")},e.skipToTTJ=function(){var e=$+"index.html#/manageMoney/"+S,t=escape(e),o=a.getCPUrl("TTQ_URL")+"?token="+f+"&loginUrl="+t+"&returnUrl="+t;if(window.cordova){var i=null;i=s.open(o),i.addEventListener("loadstart",function(e){-1!=e.url.indexOf("index.html#/manageMoney")&&i.close()})}else window.location.href=o},e.goBack=function(){"shopRevenue"==S?i.go("shopRevenue"):i.go("financialMoney",{whereId:"manageMoney"})},o.fromTemplateUrl("mm-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),o.fromTemplateUrl("mm-share-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.sharemodal=t}),e.openQRModal=function(){e.qrCodemodal.show();var t=new AraleQRCode({text:e.qrCodeUrl,size:106,image:c.imgBaseURL+"img/icon_inside_qrcode.png",imageSize:30}),o=document.getElementById("createdQrCode");0!=o.childNodes.length&&o.removeChild(o.childNodes[0]),o.appendChild(t),o.childNodes[0].style.position="relative"},e.closeQRModal=function(){e.qrCodemodal.hide()},e.openShareModal=function(){e.sharemodal.show()},e.closeShareModal=function(){e.sharemodal.hide()},e.openAgreement=function(){e.sharemodal.hide(),setTimeout(function(){e.showAgreement=!0},300)},e.closeAgreement=function(){e.showAgreement=!1},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.sharemodal.remove()}),e.$on("$ionicView.beforeEnter",function(t,o){v=window.location.href,S=n.frontState,$=a.getHead().replace("v3","www"),I="shopRevenue"==S?$+"index.html#/shopRevenue":$+"index.html#/homePage/",e.init()})}]),APP.service("ManageMoneyService",["$http","UrlService",function(e,t){this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))},this.getKjtToken=function(o){var i={authCode:o};return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:i})},this.getHryActivityInfo=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("GET_HAIRONGYI_ACTIVITYIFNO"),params:i})},this.getPromoteReward=function(o,i,s){var n={token:o,pageNo:i,pageSize:s};return e({method:"POST",url:t.getUrl("GET_PROMOTE_REWARD"),params:n})},this.getRefCode=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("GET_REF_CODE"),params:i})}}]),APP.controller("MicroSchoolController",["$scope","MicroSchoolService","HomePageService",function(e,t,o){e.microSchoolInfo=[],e.flagNum=!1,e.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",e.init=function(){e.tabChange(0,8),o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1})},e.tabChange=function(t,o){for(var i=document.getElementsByClassName("sg-ws-button"),s=0,n=i.length;s<n;s++)s==t?(i[s].style.color="#32BEFF",i[s].style.borderBottom="2px solid #32BEFF"):(i[s].style.color="black",i[s].style.borderBottom="none");e.loadData(o)},e.loadData=function(o){t.getMicroSchoolInfo(o).success(function(t,o,i,s){e.microSchoolInfo=t.data}).error(function(e){})},e.$on("$ionicView.beforeEnter",function(t,i){if("back"==i.direction)return void o.getUnReadMsg().success(function(t){t.data>0?e.flagNum=!0:e.flagNum=!1});e.init()})}]),APP.service("MicroSchoolService",["$http","UrlService",function(e,t){this.getMicroSchoolInfo=function(o){var i={childId:o};return e.get(t.getUrl("MICRO_SCHOOL"),i)},this.getMicroSchoolDetail=function(o,i){var s={childId:o,id:i};return e.get(t.getUrl(""),s)}}]),APP.controller("MicroSchoolDetailController",["$scope","$stateParams","$sce","MicroSchoolService",function(e,t,o,i){e.childId=t.childId,e.id=t.id,e.title=t.title,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.loadData(e.childId,e.id)},e.loadData=function(e,t){i.getMicroSchoolDetail(e,t).success(function(e,t,o,i){})},e.$on("$ionicView.beforeEnter",function(){e.title=t.title,e.childId=t.childId,e.id=t.id,e.init()})}]),APP.controller("MyStoreController",["$localstorage","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyStoreService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","SetShopCoverService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","ShopService","$http","GetStatisticInfoService","HomePageService",function($localstorage,$scope,$stateParams,$rootScope,$ionicHistory,$state,$ionicSideMenuDelegate,UserService,MyStoreService,$ionicSlideBoxDelegate,$ionicModal,ChooseShopTemplateService,PopupService,GoodsService,CommonAddressService,$timeout,$ionicScrollDelegate,UrlService,SetShopCoverService,BannerThemeService,SeckillService,countdownService,$interval,$ionicLoading,LoginService,CreditService,ShopService,$http,GetStatisticInfoService,HomePageService){function loadProducts(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){MyStoreService.getProductsList(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m).success(function(e){if($scope.allProducts=e.totalCount,null!=e.data.productList&&void 0!=e.data.productList&&0!=e.data.productList.length){if(1==c?($scope.productsList=e.data.productList,e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=e.products,$scope.productsList=$scope.contentDataListxyz)})):($scope.productsList=$scope.productsList.concat(e.data.productList),e.data.isCanSyncGetPrice&&GoodsService.asyncPrice(e.data.queryPricePara).success(function(e){e.success&&($scope.contentDataListxyz=$scope.contentDataListxyz.concat(e.products),$scope.productsList=$scope.contentDataListxyz)})),$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide(),$scope.productsList){var t=$scope.productsList.length;$scope.hasMoreData=!(e.totalCount===t)}}else $scope.$broadcast("scroll.infiniteScrollComplete"),$scope.hasMoreData=!1,$scope.allProducts=0,$scope.productsList=[],$scope.contentDataListxyz=[]})}function restParams(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1}function getCurrentPosition(){var e=CommonAddressService.getAddressInfo();e?(provinceId=e.provinceId,cityId=e.cityId,districtId=e.areaId,streetId=e.streetId,$scope.address=e.regionName):(provinceId=16,cityId=17,districtId=2450,streetId=12036596,$scope.address="崂山区")}$scope.lType="templates/common/ListTemplate1.html",$scope.tType="templates/common/TitleTemplate1.html",$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,$scope.filterCategory=[!0,!1,!1],$scope.myStoreInfo={},$scope.slideImage=[],$scope.avatarImage="",$scope.address="",$scope.categorySelected=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],$scope.brandList=[],$scope.otherList=[],$scope.otherState=[!1,!1],$scope.isCurrent=[!0,!1],$scope.brandSelected=[!0,!1],$scope.priceSelected=[!0,!1];var firstParamsArr=["all","all","0"],secondParamsArr=[],paramIndex=0;$scope.allProducts=0,$scope.buttonShow=!1,$scope.buttonBuyerShow=!1,$scope.coverImage=$rootScope.imgBaseURL+"img/bg_shop_4.png",$scope.countDownMsg="",$scope.screenWidth=window.innerWidth,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$scope.storeTitleName="",$scope.stockName="显示全部货",$scope.brandName="全部",$scope.priceName="全部",$scope.otherName=["全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部","全部"];var token="";$scope.leftArrow={},$scope.mystoreTitle={},$scope.addressDiv={},$scope.addressLabel={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&($scope.leftArrow={top:"14px"},$scope.mystoreTitle={top:"18px"},$scope.addressDiv={top:"16px"},$scope.addressLabel={top:0}),$scope.messageImgFlag=!0,$scope.flagNum=!1,$scope.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/messageLogo@2x.png";var screenHeight=window.innerHeight,topHeight=373,contentHeight=screenHeight-topHeight+"px";$scope.contentHeight={height:contentHeight},$scope.addressTitle="配送至",$scope.dataAdd=null,$scope.flag="STORE_LOCATION",$scope.defaultValue=null,$scope.level=0;var addressMessage={},areaValue,areaValueCity,pageIndex=1,pageSize=5,filterData="saleDesc",fromType="2",flag="",memberId="",productCateId=0,provinceId=16,cityId=173,districtId=2450,streetId=12036596,provinceName="",cityName="",sortColumn="saleDesc";$scope.stockState=!1,$scope.showShare=!1,$scope.init=function(){$scope.showQQ=!1,$scope.showWeChat=!1,$scope.productsList=[],$scope.contentDataListxyz=[],restParams(),MyStoreService.getStoreInfo($scope.storeId,$scope.shareStoreId).success(function(e){switch(e.data.titleLayout){case"tit-df":$scope.tType="templates/common/TitleTemplate1.html";break;case"tit-bp":$scope.tType="templates/common/TitleTemplate2.html";break;case"tit-colum2":$scope.tType="templates/common/TitleTemplate3.html"}switch(e.data.listLayout){case"layout-df":$scope.lType="templates/common/ListTemplate1.html";break;case"layout-bp":$scope.lType="templates/common/ListTemplate2.html";break;case"layout-colum2":$scope.lType="templates/common/ListTemplate3.html"}$scope.coverImage=e.data.coverUrl,$scope.myStoreInfo=e.data,$scope.slideImage=e.data.banner,$scope.avatarImage=e.data.avatarImageFileId,$scope.storeTitleName=$scope.myStoreInfo.storeName+$scope.myStoreInfo.storeTypeName,$ionicSlideBoxDelegate.$getByHandle("my_store_slider").update(),$ionicSlideBoxDelegate.loop(!0)}),ShopService.getLevelInfo(function(e){e.success(function(e){if(e.success&&($scope.avatarImageFileId=e.data.avatarImageFileId,$scope.userCurrentLevelId=e.data.userCreditWithLevel.order,$scope.userName=e.data.userCreditWithLevel.name,$scope.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel))if($scope.levelArray=[],e.data.storeCreditWithLevel.order<=3){$scope.imgCount=e.data.storeCreditWithLevel.order;for(var t=0;t<e.data.storeCreditWithLevel.order;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/StarLevel@2x.png")}else for(var t=0;t<e.data.storeCreditWithLevel.order-3;t++)$scope.levelArray.push($rootScope.imgBaseURL+"img/Diamond@2x.png")})},$scope.storeId),$timeout(function(){MyStoreService.getPositionFromCookie().success(function(response,status,headers,config){if(null!=response.data&&void 0!=response.data&&0!=response.data.length){var addressInfo=eval(response.data);provinceId=addressInfo[0].provinceId,cityId=addressInfo[0].cityId,districtId=addressInfo[0].areaId,streetId=addressInfo[0].streetId,$scope.address=addressInfo[0].regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)}else getCurrentPosition(),$timeout(function(){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},500)})},500),HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1})},$scope.getSeckillInfo=function(){SeckillService.getServerTime().success(function(e){var t=e.data,o=$scope.myStoreInfo.seckill.beginTime,i=$scope.myStoreInfo.seckill.endTime,s="",n=$interval(function(){t+=1,t<o?(s=countdownService.getTime(countdownService.getTimeDif(1e3*o,1e3*t)),$scope.countDownMsg="距离开始时间还有"+s):t>=o&&t<=i?(s=countdownService.getTime(countdownService.getTimeDif(1e3*i,1e3*t)),$scope.countDownMsg="距离结束时间还有"+s):t>i&&($scope.countDownMsg="秒杀活动已结束",$interval.cancel(n))},1e3)})},$scope.loadMore=function(){pageIndex+=1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)},$scope.saleNum=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="#32BEFF",e.color="white",t.backgroundColor="white",t.color="#888",o.backgroundColor="white",o.color="#888",filterData="saleDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},$scope.popularity=function(){restParams();var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="#32BEFF",t.color="white",o.backgroundColor="white",o.color="#888",filterData="isHotDesc",loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1)},$scope.productsFilter=function(){var e=document.getElementById("myStoreSaleNum").style,t=document.getElementById("myStorePopularity").style,o=document.getElementById("myStoreFilter").style;e.backgroundColor="white",e.color="#888",t.backgroundColor="white",t.color="#888",o.backgroundColor="#32BEFF",o.color="white",MyStoreService.getFilterList(productCateId).success(function(e,t,o,i){if(e.success)if($scope.brandList=e.data.brandList,void 0!=e.data.filterMap){$scope.otherList=e.data.filterMap.lstAttributes;for(var s=0,n=$scope.otherList.length;s<n;s++)secondParamsArr[s]=0}else $scope.otherList=[]}),$scope.filterModal.show()},$scope.chooseStockState=function(e){firstParamsArr[0]=e,$scope.stockState=!$scope.stockState,"all"==e?$scope.stockName="显示全部货":"hasStock"==e&&($scope.stockName="仅看有货")},$scope.brandFilter=function(e){firstParamsArr[1]=0!=$scope.brandList[e].id?$scope.brandList[e].id:"all",$scope.brandName=$scope.brandList[e].brandName;for(var t=0,o=$scope.brandList.length;t<o;t++)$scope.brandSelected[t]=t===e},$scope.priceFilter=function(e){switch(firstParamsArr[2]=e,e){case 0:$scope.priceName="全部";break;case 1:$scope.priceName="0～1000";break;case 2:$scope.priceName="1001～2000";break;case 3:$scope.priceName="2001～3000";break;case 4:$scope.priceName="3001～4000";break;case 5:$scope.priceName="4001～5000";break;case 6:$scope.priceName="5000以上"}for(var t=0;t<7;t++)$scope.priceSelected[t]=t===e},$scope.chooseOtherItem=function(e,t){for(var o=0;o<t;o++)$scope.isCurrent[o]=o===e;secondParamsArr[paramIndex]=$scope.otherList[paramIndex].lstAttributeOptions[e].id,$scope.otherName[paramIndex]=$scope.otherList[paramIndex].lstAttributeOptions[e].optionValue},$scope.filterDone=function(){restParams();var e=firstParamsArr.join("@"),t=secondParamsArr.join(";");filterData=e+"@"+t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1),$scope.filterModal.hide()},$scope.changeFilterOption=function(e){for(var t=0,o=$scope.filterCategory.length;t<o;t++)$scope.filterCategory[t]=t==e;for(var i=0,s=$scope.otherList.length;i<s;i++)$scope.otherState[i]=!1},$scope.changeOther=function(e){$scope.filterCategory=[!1,!1,!1],paramIndex=e,$scope.otherName[e]="全部";for(var t=0,o=$scope.otherList.length;t<o;t++)$scope.otherState[t]=t===e;$scope.isCurrent=[!0,!1]},$scope.category=function(){$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.changeCategory=function(e,t){pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],productCateId=t,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!1);for(var o=0,i=$scope.categorySelected.length;o<i;o++)$scope.categorySelected[o]=o===e;$ionicSideMenuDelegate.$getByHandle("store_menu").toggleRight()},$scope.slideImageClick=function(e){"1"==$scope.slideImage[e].type?"主题活动"==$scope.slideImage[e].activityType?$state.go("bannerTheme",{bannerId:$scope.slideImage[e].bannerId,platformType:$scope.slideImage[e].platformType}):"日常活动"==$scope.slideImage[e].activityType&&BannerThemeService.getBannerTheme($scope.slideImage[e].bannerId,$scope.slideImage[e].platformType).success(function(t){$state.go("bannerDaily",{bannerId:$scope.slideImage[e].bannerId,layout:t.data.layout,platformType:$scope.slideImage[e].platformType})}):"6"==$scope.slideImage[e].type&&$state.go("crowdFunding")},$ionicModal.fromTemplateUrl("my-qrcode-modal.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!0}).then(function(e){$scope.qrCodemodal=e}),$ionicModal.fromTemplateUrl("templates/shop/FilterShop.html",{scope:$scope,animation:"slide-in-left",backdropClickToClose:!1}).then(function(e){$scope.filterModal=e}),$scope.openQrcode=function(){if(!UserService.getUser().mid)return void $state.go("login");$scope.qrCodemodal.show()},$scope.backToStore=function(){$scope.filterModal.hide()},$scope.closeModal=function(){$scope.qrCodemodal.hide()},$scope.$on("$destroy",function(){$scope.qrCodemodal.remove(),$scope.filterModal.remove()}),$scope.saveQrCode=function(){var e="";e=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"DCIM/Camera/myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var t=encodeURI($scope.myStoreInfo.qrcode),o={};(new FileTransfer).download(t,e,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();PopupService.showAlert("","图片已经保存至"+t)}else PopupService.showToast("保存成功")},function(e){PopupService.showToast("保存失败！")},!0,o)},$scope.share=function(){if(!UserService.getUser().mid)return void $state.go("login");if(window.device&&window.device.hasNewShare)$scope.showShare=!$scope.showShare;else{var e=$scope.myStoreInfo.storeName,t=$scope.avatarImage,o=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.storeId+"/?fs";window.umeng?window.umeng.share(e,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",t,o,0):alert("只能在app分享,请下载app！")}},$scope.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),
PopupService.showToastShort("复制成功")):PopupService.showToast("请下载APP执行此操作")},$scope.hideblackCover=function(){$scope.showShare=!1},$scope.shareToPlatform=function(e){var t=$scope.myStoreInfo.storeName,o="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",i=$scope.avatarImage,s=UrlService.getShareLinkHeader()+"myStore/"+$scope.storeId+"/"+$scope.userId+"/?fs";window.umeng?(0==e?window.umeng.shareToSina(t,o,i,s,0,null,CreditService.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(t,o,i,s,0,null,CreditService.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(t,o,i,s,0,null,CreditService.shareSuccessCallback):3==e?(window.umeng.shareToQQ(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):4==e?(window.umeng.shareToQzone(t,o,i,s,0,null,CreditService.shareSuccessCallback),CreditService.qqShare()):5==e&&$scope.copeText(s),CreditService.successShare()):alert("umeng undefined 只能在app分享"),$scope.showShare=!1},$scope.goMessageCenter=function(){$state.go("messageCenter")},$scope.isButtonShow=function(){$scope.buttonShow=!$scope.buttonShow},$scope.goBuyerCenter=function(){$scope.shareStoreId?$state.go("buyerCenter",{shareStoreId:$scope.shareStoreId}):$state.go("buyerCenter")},$scope.toProductDetail=function(e,t,o,i,s,n,a,r){window.cordova&&$rootScope.gio.track("prodClickInStore",{productId:e,o2oType:t,productFirstName:n,productSecondName:a,storeId:i,storeName:$scope.storeTitleName,hasStock:r}),$state.go("productDetail",{productId:e,o2oType:t,fromType:o,storeId:i,shareStoreId:s})},$scope.goBack=function(){$ionicHistory.backView()&&$scope.$ionicGoBack()},$scope.addressTop=function(){$scope.addressTipFlag=!1,$scope.provinceTop=0,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.addressModal.show(),$scope.dataAdd=null,$scope.defaultValue=null,$scope.selectProvince="",$scope.selectCity="",$scope.selectArea="",$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0)},$scope.addressInit=function(e,t,o,i){if($scope.addressTipFlag=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop(),$scope.addressTitle="配送至",$scope.defaultValue=e?JSON.parse(e):{},$scope.level=i,t){$scope.dataAdd=JSON.parse(t),$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var s=0;s<$scope.nowLevelIndex.length;s++)s>$scope.nowLevel&&($scope.nowLevelIndex[s]=-1)}else $scope.finish=!1,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",GoodsService.getLocationList("",0).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,$scope.finish=!0,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel;for(var t=(JSON.stringify($scope.defaultValue),JSON.stringify($scope.dataAdd),0);t<$scope.nowLevelIndex.length;t++)t>$scope.nowLevel&&($scope.nowLevelIndex[t]=-1)}).error(function(e){PopupService.showToast("获取地址信息失败！")})},$scope.bottomBorder={"border-bottom":"1px solid red"},$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!1,$scope.cityDis=!1,$scope.areaDis=!1,$scope.provinceSel=function(){$scope.addressInit(null,null,"STORE_LOCATION",0),$scope.selectCity="",$scope.selectArea="",$scope.provinceFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!1,$scope.areaDis=!1};var isGoing=!1;$scope.goSelect=ionic.Utils.debounce(function(e,t){for(var o=0;o<$scope.nowLevelIndex.length;o++)o>$scope.nowLevel&&($scope.nowLevelIndex[o]=-1);$scope.dataAdd="",$scope.nowLevelIndex[$scope.nowLevel]=e;var t=arguments[1],e=arguments[0];if($scope.level=$scope.level-1,$scope.defaultValue["text"+$scope.level]=t.text,$scope.defaultValue["value"+$scope.level]=t.value,$scope.level>-2)-1==$scope.level&&($scope.selectProvince=t.text,$scope.provinceIndex=e,$scope.provinceFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.provinceTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,$scope.nowLevel=$scope.level,$scope.nowLevel=-1*$scope.nowLevel),ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,GoodsService.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.citySel=function(){$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",$scope.level=$scope.levelArea,GoodsService.getLocationList(areaValueCity,1).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,-1),$scope.selectArea="",$scope.cityFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.cityTop)}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else if($scope.level>-4)$scope.selectCity=$scope.defaultValue["text-2"],$scope.provinceFlag=!1,$scope.cityFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!1,-3==$scope.level?($scope.selectArea=t.text,$scope.cityFlag=!1,$scope.areaFlag=!1,$scope.selectFlag=!0,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0,$scope.areaTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top):$scope.cityTop=$ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*$scope.level,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,MyStoreService.getLocationList(t.value,ah).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1,2==ah&&(areaValue=t.value);var o=JSON.stringify($scope.defaultValue),i=JSON.stringify($scope.dataAdd);$scope.addressInit(o,i,$scope.flag,$scope.level)}).error(function(e){PopupService.showToast("获取地址信息失败！")}),$scope.levelArea=$scope.level,$scope.levelArea=$scope.levelArea+1,$scope.areaSel=function(){$scope.level=$scope.levelArea,$scope.addressTip="正在获取地址信息...",$scope.addressTipFlag=!0,$scope.dataAdd="",MyStoreService.getLocationList(areaValue,2).success(function(e){$scope.dataAdd=e.data,$scope.addressTipFlag=!1;var t=JSON.stringify($scope.defaultValue),o=JSON.stringify($scope.dataAdd);$scope.addressInit(t,o,$scope.flag,$scope.level),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.areaTop),$scope.areaFlag=!0,$scope.selectFlag=!1,$scope.provinceDis=!0,$scope.cityDis=!0,$scope.areaDis=!0}).error(function(e){PopupService.showToast("获取地址信息失败！")})};else{if(isGoing)return;$timeout(function(){isGoing=!1},1500),$rootScope.$broadcast($scope.flag,$scope.defaultValue),isGoing=!0,$scope.closeAddressModal()}},300),$scope.getPosition=function(){if("定位中···"!=$rootScope.globalConstant.autoPosition){addressMessage=CommonAddressService.getAddressInfo();var e=addressMessage.regionName+"/"+addressMessage.streetName;MyStoreService.addAddress(addressMessage.provinceId,addressMessage.cityId,addressMessage.areaId,e,addressMessage.streetId).success(function(){var e={"text-1":addressMessage.provinceName,"text-2":addressMessage.cityName,"text-3":addressMessage.regionName,"text-4":addressMessage.streetName,"value-1":addressMessage.provinceId,"value-2":addressMessage.cityId,"value-3":addressMessage.areaId,"value-4":addressMessage.streetId};$rootScope.$broadcast($scope.flag,e),$scope.closeAddressModal()})}},$ionicModal.fromTemplateUrl("templates/common/CommonLocation.html",{scope:$scope,animation:"slide-in-up"}).then(function(e){$scope.addressModal=e}),$scope.closeAddressModal=function(){$scope.addressModal.hide()},$rootScope.$on("STORE_LOCATION",function(e,t){$scope.address=t["text-3"],provinceId=t["value-1"],cityId=t["value-2"],districtId=t["value-3"],provinceName=t["text-1"],streetId=t["value-4"],cityName=t["text-2"];var o=t["text-3"]+"/"+t["text-4"];GoodsService.addAddress(provinceId,cityId,districtId,o,streetId).success(function(e,t,o,i){$scope.init()})}),$rootScope.$on("CACHE_SUCCESS",function(e,t){$ionicLoading.show({template:"定位地址切换中···"}),provinceId=t.provinceId,cityId=t.cityId,districtId=t.areaId,streetId=t.streetId,provinceName=t.provinceName,cityName=t.cityName,$scope.address=t.regionName,pageIndex=1,$scope.productsList=[],$scope.contentDataListxyz=[],$scope.hasMoreData=!1,loadProducts(memberId,provinceId,cityId,districtId,streetId,provinceName,cityName,$scope.address,pageIndex,pageSize,productCateId,filterData,fromType,flag,!0)}),$scope.$on("$ionicView.beforeLeave",function(e,t){$scope.watch()}),$scope.$on("$ionicView.beforeEnter",function(e,t){if($scope.dataAdd=null,$scope.defaultValue=null,$scope.nowLevel=0,$scope.nowLevelIndex=[-1,-1,-1,-1],$scope.provinceTop=0,$scope.cityTop=0,$scope.areaTop=0,$scope.finish=!1,$scope.watch=$scope.$watch("finish",function(e,t){e&&$ionicScrollDelegate.$getByHandle("mainScroll").scrollTo(0,$scope.provinceTop)}),$timeout(function(){$ionicSlideBoxDelegate.loop(!0),$ionicSlideBoxDelegate.start(),$ionicSlideBoxDelegate.update()},200),"back"==t.direction)return void HomePageService.getUnReadMsg().success(function(e){e.data>0?$scope.flagNum=!0:$scope.flagNum=!1});$scope.isBuyer=LoginService.getRole(),$scope.userId=UserService.getUser().mid,token=$stateParams.token,token&&MyStoreService.login(token).success(function(e){if(!e.success||null==e.data.mid)return void $state.go("login");UserService.setUser(e.data),e.data.sessionValue?$localstorage.set("sg_login_token_secret","Bearer"+e.data.sessionValue):$localstorage.set("sg_login_token_secret","Bearer"+GetStatisticInfoService.generateUUID())}),$scope.buttonShow=!1,memberId=$stateParams.storeId,$scope.storeId=$stateParams.storeId,$scope.shareStoreId=$stateParams.shareStoreId,$ionicScrollDelegate.scrollTop(),$scope.init(),$scope.addressInit($scope.dataAdd,$scope.defaultValue,"STORE_LOCATION",0),$scope.$on("$destroy",function(){$scope.addressModal.remove()})})}]),APP.service("MyStoreService",["$http","UrlService",function(e,t){this.getActivityProductsList=function(o,i,s,n,a,r,c){var l={storeId:o,isWdHost:i,productCateId:s,provinceId:n,cityId:a,districtId:r,sortColumn:c};return e.get(t.getUrl("ACTIVITY_PRODUCTS_LIST"),l)},this.getCommonProductsList=function(o,i,s,n,a,r,c,l){var d={storeId:o,isHost:i,productCateId:s,provinceId:n,cityId:a,districtId:r,pageIndex:c,sortColumn:l,noLoading:!0};return e.get(t.getUrl("PRODUCTS_LIST"),d)},this.getPositionFromCookie=function(){var o={};return e.get(t.getUrl("GET_POSITION_FROM_COOLIE"),o)},this.getProductsList=function(o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){var v={memberId:o,provinceId:i,cityId:s,districtId:n,streetId:a,provinceName:r,cityName:c,districtName:l,pageIndex:d,pageSize:u,productCateId:p,filterData:g,fromType:m,flag:f,noLoading:h};return e.get(t.getUrl("COMMONLOADITEMNEW"),v)},this.getMyStoreInfo=function(o,i,s,n,a){var r={COOKIE_DOMAIN:o,DOMAIN_URL:i,POM_STATIC_DOMAIN_NAME:s,link:n,storeId:a,fromType:2};return e.get(t.getUrl("MY_STORE"),r)},this.getStoreInfo=function(o,i){if(i)var s={storeId:o,shareStoreId:i};else var s={storeId:o};return e.get(t.getUrl("MY_STORE_NEW"),s)},this.getMyStoreInfoNew=function(o){var i={memberId:o};return e.get(t.getUrl("SHUNGUANG_VIP"),i)},this.getFilterList=function(o){var i={productCateId:o};return e.get(t.getUrl("GET_FILTER_DATA"),i)},this.login=function(o){var i={token:o};return e({method:"POST",url:t.getUrl("OTHER_LOGIN"),params:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("HelpController",["$scope","$state","HelpService","InAppBrowserService","UrlService",function(e,t,o,i,s){e.helpData=[],e.loadData=function(){o.getHelpList().success(function(t){e.helpData=t.data.second})},e.goHelpDetail=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,o).addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(){e.loadData()})}]),APP.service("HelpService",["$http","UrlService",function(e,t){this.getHelpList=function(){return e.get(t.getUrl("SHUNGUANG_HELP"))}}]),APP.controller("OrderDetailController",["$localstorage","$ionicPopup","$scope","$state","OrderDetailService","$stateParams","PopupService","UserService","$rootScope","$timeout","ConfirmReceiveService","$ionicViewSwitcher","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p){o.orderSnDetail=n.orderSn,o.cOrderSnDetail=n.cOrderSn,o.userOrder="",o.orderDetailList=[];var g=r.getUser();o.loginMemberId=g.mid,o.uname=g.userName,o.userlevel=0,o.shareStoreId="";var m=n.cOrderId;o.flagNum=!1,o.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",o.init=function(){p.getUnReadMsg().success(function(e){e.data>0?o.flagNum=!0:o.flagNum=!1})},o.loadData=function(e,t){s.getOrderDetail(e,t).success(function(e){e.success&&(o.userOrder=e.data.loginMemberId==e.data.memberId,o.orderId=e.data.orderProductId,o.orderPrice=e.data.price,o.orderDetailList=e.data,o.canSubmitRepair=o.orderDetailList.canSubmitRepaier)})},o.goOrderTrack=function(e){i.go("orderTracking",{orderSn:e})},o.goApplyRefund=function(e){if(!o.orderDetailList.canSubmitRepaier)return void a.showToast("退款受理中，请稍后刷新查看状态！");s.checkRefund(e).success(function(t){t.success?t.data&&t.data.isPackage?a.showConfirm("",t.data.packageMessage,function(t){t&&i.go("applyRefund",{cOrderSn:e})}):i.go("applyRefund",{cOrderSn:e}):a.showToast(t.message)})},o.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),a.showToastShort("复制成功")):a.showToast("请下载APP执行此操作")},o.hidePcTips=function(){o.isShowPcTips=!1},o.pcProduct=function(e){e?o.isShowPcTips=!0:1==o.orderDetailList.zActivityOrder?i.go("crowd_funding_details",{zActivityId:o.orderDetailList.zActivityId}):i.go("productDetail",{productId:o.orderDetailList.productId,o2oType:o.orderDetailList.o2oType,storeId:o.orderDetailList.ckCode})},o.asse=function(e,t,o){i.go("publicationEvaluation",{cOrderSn:t})},o.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),i=null;i=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&l(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?orderid="+o.orderId+"&price="+o.orderPrice+"&flag="+o.kfTocken)},o.invoice=function(){window.cordova,i.go("invoiceHtml",{invoiceSrc:o.orderDetailList.invoicesUrl})},c.$on("ORDER_RETURN_BACK",function(e,t){}),o.confirmReceive=function(e){function t(t){t&&d.confirmReceive(e).success(function(e){e.success?(u.nextDirection("forward"),i.go("orderManage")):a.showToast(e.message)})}a.showConfirm("",'"确认收货"将代表您已收到所购商品！',t,"确认")},o.$on("$ionicView.beforeEnter",function(e,t){o.raiseStatusOne={background:"red",color:"#ffffff"},o.raiseStatusTwo={background:"red",color:"#ffffff"},o.raiseStatusThree={background:"red",color:"#ffffff"},o.raiseStatusFour={background:"red",color:"#ffffff"},o.isIos=!(!window.cordova||!ionic.Platform.isIOS()),o.isShowPcTips=!1,m=n.cOrderId,o.storeId=r.getUser().mid,o.canSubmitRepair=!0,o.loadData(o.cOrderSnDetail,m),o.init()}),o.goToDelete=function(){t.confirm({template:o.orderDetailList.phoneNumber,cancelText:"取消",okText:"确定"}).then(function(e){e&&(-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?window.open("tel:"+o.orderDetailList.phoneNumber,"_system"):window.open("tel:"+o.orderDetailList.phoneNumber))})}}]),APP.service("OrderDetailService",["$http","UrlService",function(e,t){this.getOrderDetail=function(o,i){var s={cOrderSn:o,cOrderId:i};return e.get(t.getUrl("ORDER_DETAIL"),s)},this.checkRefund=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CHECK_REFUND"),i)},this.customService=function(){return t.getUrl("CUSTOMER_SERVE")}}]),APP.controller("OrderManageController",["RetainageService","$scope","$stateParams","$timeout","$state","$ionicModal","OrderManageService","$ionicScrollDelegate","LoginService","$ionicLoading","$rootScope","PaymentService","$ionicPopup","PopupService","$ionicHistory","InAppBrowserService","UserService","EasyConnectService","AfterOrderSubmitService","ConfirmReceiveService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){function w(e){e&&(a.cancelOrder(t.cancelOrderId,"mstore").success(function(e){}),i(function(){t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.loadOrderList(!1,t.orderFlag,"",t.pageIndex,t.pageSize,"")},1e3))}function y(e){e?a.deleteOrder(b).success(function(e){e.success?t.init():(g.showToastShort(e.message),b="")}).error(function(e){g.showToastShort("删除失败！"),b=""}):b=""}t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",t.isBuyer=c.getRole(),t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=0,t.orderStatus=0,t.isIos=!1,t.BDO=!1;var T,C="";t.search={keyWord:""},t.pageIndex=0,t.pageIndexSearch=0,t.pageSize=5,t.hasMoreData=!1,t.orderList=[],t.searchOrderList=[],t.memberId,t.emptySearch=!1;var b="";t.init=function(){-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.memberId=h.getUser().mid,t.orderType=o.orderType?o.orderType:"全部订单",t.orderFlag=o.orderFlag?o.orderFlag:0,t.orderStatus=o.orderStatus?o.orderStatus:0,t.availableToTop(),t.loadOrderList(!1,t.orderFlag,t.orderStatus,0,5,""),"0"==t.isBuyer?(t.isShowDown=!1,t.isShowUp=!1):(t.isShowDown=!0,t.isShowUp=!1),$.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.batchDeleteOrder=function(){s.go("batchDeleteOrder")},t.loadOrderList=function(e,o,i,s,n,c,l,d){a.getOrderList(o,i,s,n,c,d).success(function(s){if(s.success){if("closed"==i?(T=s.data.canDeleteAll,s.data.canDeleteAll?t.BDO=!0:t.BDO=!1):(T=!1,t.BDO=!1),t.emptySearch=!1,s.data.orders.length||(t.emptySearch=!0),e)if(l)t.searchOrderList=t.searchOrderList.concat(s.data.orders);else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=t.orderList.concat(s.data.orders);else if(l)t.searchOrderList=s.data.orders;else if(3==o)for(var n=s.data.orders,a=0,c=n.length;a<c;a++)1==n[a].zActivityOrder&&t.orderList.push(n[a]);else t.orderList=s.data.orders;l?t.hasMoreDataSearch=s.data.orderProductSize:t.hasMoreData=s.data.orderProductSize,r.resize(),t.isHaveDate=0!=t.orderList.length}e&&t.$broadcast("scroll.infiniteScrollComplete"),t.$broadcast("scroll.infiniteScrollComplete")})},t.loadMore=function(){t.pageIndex++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord)},t.loadMoreSearch=function(){t.pageIndexSearch++,t.loadOrderList(!0,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.showSelect=function(){"1"==t.isBuyer&&(t.isClick=!t.isClick,t.isShowDown=!t.isClick,t.isShowUp=!t.isShowDown)},t.payTest=function(e,o,i){if(window.cordova)if("alipaymobile"==o)if(window.alipay){var n=e,a="http://m.ehaier.com/v2/h5/pay/app/alipay/notify.html";window.device&&window.device.hasNewAliPay?S.getAliPayInfo(n,i,a).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");C=e.result,window.alipay.pay({payInfo:C},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.showPay=!1},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}).error(function(e){}):window.alipay.pay({tradeNo:n,subject:"海尔顺逛微店",body:"顺逛微店-订单号:"+n,price:i,notifyUrl:a},function(e){l.show({template:"支付宝支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"支付宝支付失败 ",noBackdrop:!0,duration:3e3})})}else alert("支付宝 插件不存在");else if("wxpay"==o){window.wechatPay||alert("微信支付插件未加载 ");var r={orderSn:e};u.wPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.data){var o=JSON.stringify(e.data);window.wechatPay.pay(o,function(e){l.show({template:"微信支付成功",noBackdrop:!0,duration:3e3}),t.init()},function(e){l.show({template:"微信支付失败: "+e,noBackdrop:!0,duration:3e3})})}else alert("response.data is undefined")}).error(function(e){alert(e)})}else"kjtpay"==o&&v.getMessage().success(function(o,i,n,a){if(o.data.kjtAccount&&o.data.kjtAccount.memberKjtpayAccount){var r={orderSn:e,kjtAmount:o.data.kjtAccount.memberKjtpayAccount};u.kjtPay(r).success(function(e){if(-200==e.errorCode)return void g.showToast("库存不足，请稍后再试!");if(e.success){f.open(e.data).addEventListener("exit",function(e){t.init()})}else p.alert({template:e.message,okText:"知道了"})})}else p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")});else if("alipaymobile"==o)window.location.href="http://m.ehaier.com/v2/h5/pay/alipay/request.html?orderSn="+e;else if("wxpay"==o){var c=window.navigator.userAgent;if(!c||-1==c.indexOf("MicroMessenger"))return void g.showToast("请使用顺逛微店app支付或登录顺逛微店公众号付款。");if(c.substring(c.indexOf("MicroMessenger")+15,c.indexOf("MicroMessenger")+16)<5)return void g.showToast("微信版本过低，请使用5.0及以上版本。");window.location.href="http://m.ehaier.com/v2/h5/pay/wxpay/pay.html?showwxpaytitle=1&orderSn="+e+"&orderAmount="+i+".00"}else"kjtpay"==o&&v.getMessage().success(function(t,o,i,n){t.data.kjtAccount&&t.data.kjtAccount.memberKjtpayAccount?window.location.href="http://m.ehaier.com/v2/h5/pay/kjtpay/request.html?orderSn="+e+"&kjtAcount="+t.data.kjtAccount.memberKjtpayAccount:p.alert({template:"您还未绑定快捷通",okText:"去绑定"}).then(function(e){s.go("easyConnect")})}).error(function(){alert("网络失败")})},t.toPamentxyz=function(e){var t={orderSn:e};u.orderPayCheck(t).success(function(t){-200==t.errorCode?g.showAlert("提示",t.message,function(){}):s.go("paymentxyz",{orderSn:e})})},t.Pamentxyz=function(t,o,i){e.getOrderList(t).success(function(e){couponLists=e.data.couponList,couponLists.length>0&&i?s.go("Retainage",{relationOrderSn:t}):s.go("paymentxyz",{orderSn:t})})},t.changeOrder=function(e){t.orderList=[],t.pageIndex=0,t.availableToTop(),t.orderStatus=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.selectOrder=function(e){switch(e){case 0:t.orderType="全部订单";break;case 1:t.orderType="我的订单";break;case 2:t.orderType="用户订单"}t.availableToTop(),t.pageIndex=0,t.orderStatus="",t.search.keyWord="",t.hasMoreData=!1,t.orderList=[],t.isShowDown=!0,t.isShowUp=!1,t.isClick=!1,t.orderFlag=e,t.loadOrderList(!1,t.orderFlag,t.orderStatus,t.pageIndex,t.pageSize,"")},t.goOrderTrack=function(e){t.searchModal.hide(),s.go("orderTracking",{orderSn:e})},t.goRefundDetailk=function(e,t){s.go("refundDetail",{orderProductId:e,memberId:t})},t.goOrderDetails=function(e,o,i,n,a,r){r&&t.closeSearchModal(),s.go("orderDetail",{orderSn:e,cOrderSn:o,cOrderId:n})},t.goAssess=function(e,t,o){o?s.go("assess",{orderId:e,cOrderSn:t}):s.go("assess",{orderId:e,cOrderSn:""})},t.goLookAssess=function(e,t,o){o?s.go("lookAssess",{orderId:e,cOrderSn:t}):s.go("lookAssess",{orderId:e,cOrderSn:""})},t.orderCancel=function(e){t.cancelOrderId=e,g.showConfirm("","确认要取消此订单？",w,"确定")},t.confirmReceive=function(e,o,i){function n(e){e&&I.confirmReceive(o).success(function(e){e.success?t.init():g.showToast(e.message)})}e?g.showConfirm("",'"确认收货"将代表您已收到所购商品！',n,"确认"):s.go("confirmReceive",{orderId:i})},t.goBack=function(){if(t.orderFlag=0,t.orderStatus="",t.search.keyWord="",t.pageIndex=0,t.hasMoreData=!1,t.orderList=[],!m.backView())return s.go("homePage"),void m.clearCache();if("batchDeleteOrder"==m.viewHistory().backView.stateName)m.goBack(-2);else{if("afterOrderSubmit"==m.viewHistory().backView.stateName)return void m.goBack(-3);if("ccbPay"==m.viewHistory().backView.stateName||"paymentxyz"==m.viewHistory().backView.stateName||"ccbfenqi"==m.viewHistory().backView.stateName||"orderConfirm"==m.viewHistory().backView.stateName)return s.go("personnalCenter"),void m.clearCache();if("payResultSuccess"==m.viewHistory().backView.stateName||"payResultFailure"==m.viewHistory().backView.stateName||"confirmReceive"==m.viewHistory().backView.stateName)return s.go("personnalCenter"),void m.clearCache()}m.backView()&&m.backView().url.indexOf("login")>0?m.goBack(-2):m.goBack()},t.availableToTop=function(){r.$getByHandle("availableHandle").scrollTop()},t.$on("$ionicView.beforeEnter",function(e,o){t.BDO=!!T,"back"==o.direction?$.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1}):t.init()}),n.fromTemplateUrl("templates/shop/OrderSearch.html",{scope:t,animation:"slide-left-right"}).then(function(e){t.searchModal=e}),t.openSearchModal=function(){s.go("orderSearch")},t.closeSearchModal=function(){t.searchModal.hide(),t.availableToTop()},t.$on("$destroy",function(){t.searchModal.remove()}),t.searchOrder=function(){t.hasMoreData=!1,t.orderFlag=0,t.orderStatus="",t.pageIndex=0,t.loadOrderList(!1,0,"",t.pageIndex,t.pageSize,t.search.keyWord,!0)},t.deleteOrder=function(e){b=e,g.showConfirm("","确认删除此订单？",y,"删除")},d.$on("AFTER_COMMIT",function(e){t.changeOrder("4")})}]),APP.service("OrderManageService",["$http","UrlService",function(e,t){this.getOrderList=function(o,i,s,n,a){var r={orderFlag:o,orderStatus:i,pageIndex:s,pageSize:n,keyword:a};return e.get(t.getNewUrl("ORDER_MANAGE"),r)},this.getOrderAmount=function(){return e.get(t.getNewUrl("ORDER_AMOUNT"))},this.cancelOrder=function(o,i){var s={orderId:o,cancelFlag:i};return e.get(t.getUrl("CANCEL_ORDER"),s)},this.payOrder=function(o){var i={orderSn:o};return e.get(t.getUrl("PAY_ORDER"),i)},this.deleteOrder=function(o){var i={orderId:o};return e.get(t.getUrl("DELETE_ORDER"),i)}}]),APP.filter("cut",function(){return function(e,t,o,i){if(!e)return"";if(!(o=parseInt(o,10)))return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var s=e.lastIndexOf("");-1!=s&&(e=e.substr(0,s))}return e+(i||"…")}}),APP.controller("OrderTrackingController",["$localstorage","$scope","OrderTrackingService","$stateParams","PopupService","$timeout","UrlService","$state",function(e,t,o,i,s,n,a,r){t.customerServe=function(){if(window.cordova){var o=ionic.Platform.isAndroid(),i=null;i=o?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),i.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&n(function(){i.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),i.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&i.close()})}else t.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+t.kfTocken);return},t.orderSn=i.orderSn,t.orderTrackingData=[],t.Tracks=[],t.loadData=function(e){o.getOrderTracking(e).success(function(e){e.success?(t.Tracks=e.data.orderWorkFlowsViewA[0].orderWorkFlowList,t.orderTrackingData=e.data.orderWorkFlowsViewA):e.message?s.showToast(e.message):s.showToast("获取物流信息失败！")})},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},t.showTrajectory=function(e){o.getCDKToken().success(function(t){if(0==t.data.status){var o=a.getCPUrl("CDK_URL")+"?order_code="+e+"&token="+t.data.token;window.emc?window.emc.presentH5View(o,""):r.go("carTracking",{trackUrl:o})}else s.showToast(t.message)}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.loadData(t.orderSn)})}]),APP.service("OrderTrackingService",["$http","UrlService",function(e,t){this.getOrderTracking=function(o){var i={orderSn:o};return e.get(t.getUrl("ORDER_TRACKING"),i)},this.getCDKToken=function(){return e.get(t.getUrl("GET_CDK_TOKEN"))}}]),APP.service("PartnerDetailService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getPartnerMessage=function(o,i){var s={ownerId:o,relationshipType:i};return e.get(t.getUrl("PARTNER_DETAIL"),s)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("RefundDetailController",["$localstorage","$http","RefundDetailService","$scope","$stateParams","PopupService","$timeout",function(e,t,o,i,s,n,a){i.customerServe=function(){if(window.cordova){var t=ionic.Platform.isAndroid(),o=null;o=t?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),o.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&a(function(){o.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),o.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&o.close()})}else i.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+i.kfTocken);return},i.orderProductId=s.orderProductId,i.memberId=s.memberId,i.orderTrackingData=[],i.orderTD="",i.loadData=function(e,t){o.getRefundDetail(e,t).success(function(e){e.success?(i.orderTrackingData=e.data.orderWorkFlowList,i.orderTD=e.data):e.message?n.showToast(e.message):n.showToast("获取物流信息失败！")})},i.$on("$ionicView.beforeEnter",function(){i.loadData(i.orderProductId,i.memberId)})}]),APP.service("RefundDetailService",["$http","UrlService",function(e,t){this.getRefundDetail=function(o,i){var s={orderProductId:o,memberId:i};return e.get(t.getUrl("REFUND_DETAIL"),s)}}]),APP.controller("RevenueDetailController",["$scope","$stateParams","RevenueDetailService","$rootScope","$ionicPopup","PlatformService","ionicDatePicker","$timeout",function(e,t,o,i,s,n,a,r){function c(e){var e=e.getFullYear()+"年"+(e.getMonth()+1>9?e.getMonth()+1:"0"+(e.getMonth()+1))+"月"+(e.getDate()>9?e.getDate():"0"+e.getDate())+"日";return e}function l(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,i=e.getDate(),s=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);1==o?(t=e.getFullYear()-1,o=12):o-=1,(t%4==0&&t%100!=0||t%400==0)&&(s[2]=29),s[o]<i&&(i=s[o]),i<10&&(i="0"+i),o<10&&(o="0"+o);var n=t+"年"+o+"月"+i+"日";return n}e.nulldata=!1,e.type=t.code,e.title=t.title,e.revenueList=[],e.total="",e.reward={},e.rewardO={},e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,
e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardXY=!1,e.startTime="",e.endTime="",e.rewardStart="",e.rewardEnd="",e.earningType=t.earningType;var d=0;e.init=function(){e.earningType=t.earningType,d=0,e.isRewardA=!1,e.isRewardB=!1,e.isRewardC=!1,e.isRewardY=!1,e.isRewardZ=!1,e.isRewardTZ=!1,e.isRewardD=!1,e.isRewardYC=!1,e.isRewardXY=!1,4==e.type?(e.rewardStart=l(),e.rewardEnd=c(new Date)):(e.rewardStart="",e.rewardEnd=""),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)},e.loadData=function(t,i,s,n,a,r,c){o.getRevenueList(t,i,s,n,a,r,c).success(function(t,o,s,n){e.nulldata=!1,t.success?(e.total=t.data.total,t.data.reward&&(e.reward=t.data.reward),t.data.rewardO&&(e.rewardO=t.data.rewardO),1!=i&&"0"==e.total&&""==t.data.rewardO.expectBrokerage&&""==t.data.rewardO.expectMonth&&""==t.data.rewardO.expectOpen&&""==t.data.rewardO.expectOpenCommend&&""==t.data.rewardO.expectRecommend&&""==t.data.rewardO.expectLeader&&""==t.data.rewardO.expectDzLeader&&""==t.data.rewardO.expectXyAmount&&""==t.data.rewardO.expectThreeLevel&&(e.nulldata=!0),t.data.rewardA&&(e.isRewardA=!0),t.data.rewardB&&0!=t.data.rewardB.length&&(e.isRewardB=!0),t.data.rewardC&&0!=t.data.rewardC.length&&(e.isRewardC=!0),t.data.rewardY&&0!=t.data.rewardY.length&&(e.isRewardY=!0),t.data.rewardZ&&0!=t.data.rewardZ.length&&(e.isRewardZ=!0),t.data.rewardTZ&&0!=t.data.rewardTZ.length&&(e.isRewardTZ=!0),t.data.rewardD&&0!=t.data.rewardD.length&&(e.isRewardD=!0),t.data.rewardXY&&0!=t.data.rewardXY.length&&(e.isRewardXY=!0)):e.revenueList=[],e.$broadcast("scroll.infiniteScrollComplete")})},e.chooseTime=function(){e.startTime=e.rewardStart,e.endTime=e.rewardEnd;var t=s.show({cssClass:"xvv-popupTime",template:'<div class="xvv-Time"><div>选择时间</div><div ng-click="lookDateModel(1)"><p>开始</p><p>{{startTime}}</p></div><div><img src="http://cdn09.ehaier.com/shunguang/H5/www/img/goOrder@2x.png"/></div><div ng-click="lookDateModel(2)"><p>结束</p><p>{{endTime}}</p></div></div>',scope:e,buttons:[{text:"取消"},{text:"确定",type:"button-positive",onTap:function(o){o.preventDefault(),e.rewardStart=e.startTime,e.rewardEnd=e.endTime,t.close(),e.loadData(e.earningType,e.type,"all",d,10,e.rewardStart,e.rewardEnd)}}]})},e.lookDateModel=function(t){if("APP"==n.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),r(function(){1==t&&(e.startTime=n+"年"+s+"月"+i+"日"),2==t&&(e.endTime=n+"年"+s+"月"+i+"日")},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s),1==t&&(e.startTime=new Date(o).getFullYear()+"年"+i+"月"+s+"日"),2==t&&(e.endTime=new Date(o).getFullYear()+"年"+i+"月"+s+"日")}};a.openDatePicker(i)}},e.$on("$ionicView.beforeEnter",function(t,o){"back"==o.direction||e.init()})}]),APP.service("RevenueDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a,r,c){var l={earningType:o,type:i,rewardType:s,page:n,pageSize:a,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]),APP.controller("SecondManageController",["$scope","SecondManageService","UserService","UrlService","PopupService","CreditService",function(e,t,o,i,s,n){e.search={keyWords:""},e.pageIndex=0,e.pageSize=10,e.hasMoreData=!1,e.secondMemberDate=[],e.secondMemberList=[],e.rank=2,e.showShare=!1,e.init=function(){e.showQQ=!1,e.showWeChat=!1,window.cordova&&(window.umeng.checkAppInstalled("qq",function(t){e.showQQ=0!=t}),window.umeng.checkAppInstalled("wechat",function(t){e.showWeChat=0!=t}));o.getUser();e.rank=2,e.getCode(),e.loadData(!1,"",0,e.pageSize,e.rank)},e.getSecAndThi=function(t){e.rank=t,e.search.keyWords="",e.loadData(!1,e.search.keyWords,0,e.pageSize,e.rank)},e.getCode=function(){t.doGetCode().success(function(t){e.mid=t.data.promotionCode})},e.loadData=function(o,i,s,n,a){t.getSecAndThi(i,s,n,a).success(function(t){t.success&&(e.secondMemberDate=t.data,o?e.secondMemberList=e.secondMemberList.concat(t.data.memberInfo):(e.pageIndex=0,e.secondMemberList=t.data.memberInfo),e.hasMoreData=t.data.memberExist,(t.data.memberInfo&&t.data.memberInfo.length<10||!t.data.memberInfo)&&(e.hasMoreData=!1),e.isHaveDate=t.data.memberExist),o&&e.$broadcast("scroll.infiniteScrollComplete")})},e.loadMore=function(){e.pageIndex++,e.loadData(!0,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.searchSecondMember=function(){e.pageIndex=0,e.loadData(!1,e.search.keyWords,e.pageIndex,e.pageSize,e.rank)},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=o.getUser().avatarImageFileId,s=i.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?window.umeng.share("成为我的合伙人，一起赚丰厚佣金！","有梦就有店，高收入0投资，挣钱真简单～",t,s,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var s="成为我的合伙人，一起赚丰厚佣金！",a="有梦就有店，高收入0投资，挣钱真简单～",r=o.getUser().avatarImageFileId,c=i.getShareLinkHeader()+"register/0/"+e.mid;window.umeng?(0==t?window.umeng.shareToSina(s,a,r,c,0,null,n.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(s,a,r,c,0,null,n.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(s,a,r,c,0,null,n.shareSuccessCallback):3==t?(window.umeng.shareToQQ(s,a,r,c,0,null,n.shareSuccessCallback),n.qqShare()):4==t?(window.umeng.shareToQzone(s,a,r,c,0,null,n.shareSuccessCallback),n.qqShare()):5==t&&e.copeText(c),n.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("SecondManageService",["$http","UrlService",function(e,t){this.getSecAndThi=function(o,i,s,n){var a={keyword:o,pageIndex:i,pageSize:s};return 2==n?e.get(t.getUrl("SECOND_MANAGE"),a):e.get(t.getUrl("THIRD_MANAGE"),a)},this.doGetCode=function(){return e.get(t.getUrl("GETTUIGUANGMA"))}}]),APP.controller("SetShopCoverController",["$scope","SetShopCoverService","UserService","$ionicPopup",function(e,t,o,i){e.shopCoverList=[],e.storeId=o.getUser().mid,e.init=function(){e.getCover(e.storeId)},e.getCover=function(o){t.getShopCover(o).success(function(t,o,i,s){e.shopCoverList=t.data.shopCover})},e.chooseCover=function(o){var s=e.shopCoverList[o].coverUrl;t.setShopCover(s).success(function(t,o,s,n){e.getCover(e.storeId);var a=i.show({template:"修改店铺模板成功"});setTimeout(function(){a.close()},1e3)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.service("SetShopCoverService",["$http","UrlService",function(e,t){this.getShopCover=function(o){var i={storeId:o};return e.get(t.getUrl("GET_SHOP_COVER"),i)},this.setShopCover=function(o){var i={url:o};return e({method:"POST",url:t.getUrl("SET_SHOP_COVER"),params:i})}}]),APP.controller("ShopController",["$ionicViewSwitcher","$scope","UserService","ShopService","$ionicSlideBoxDelegate","$ionicScrollDelegate","MyStoreService","UrlService","$ionicPopup","AccountMessageService","$ionicLoading","$timeout","PopupService","MESSAGECENTERService","$rootScope","$state","BannerThemeService","$localstorage","VersionService","InAppBrowserService","$stateParams","$interval","$sce","CreditService","IMService","ManageMoneyService","LoginService","GetStatisticInfoService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,P){t.flagNum=!1,t.tabNav="shop",t.storeInfo={},t.avatarImage="",t.slideImage=[],t.shareInfo={},t.user=o.getUser(),t.storeId="",t.btnList=[{url:"shopRevenue",icon:m.imgBaseURL+"img/btn_shop_revenue.png",name:"营收"},{url:"getCouponsList",icon:m.imgBaseURL+"img/btn_shop_coupon.png",name:"优惠券"},{url:"manageMoney",icon:"img/btn_shop_licai.png",name:"投资"},{url:"orderManage",icon:m.imgBaseURL+"img/btn_order_manager.png",name:"订单"},{url:"microSchool",icon:m.imgBaseURL+"img/btn_small_school.png",name:"微学堂"},{url:"teamSupervise",icon:m.imgBaseURL+"img/btn_two_management.png",name:"合伙人"},{url:"storeTeamOwner",icon:m.imgBaseURL+"img/btn_statistics.png",name:"统计"},{url:"vip",icon:m.imgBaseURL+"img/btn_storefront_renovation.png",name:"会员中心"}],t.showShare=!1;var L="",x="";t.topBtnCss4IOS={},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.topBtnCss4IOS={top:"12px"}),t.goMemberCenter=function(){T.getGameId(function(e){f.go("vip",{gameId:e})})},t.init=function(){i.getStoreInfo().success(function(e,o,i,s){t.storeInfo=e.data,t.storeId=t.storeInfo.ownerId,v.set("storeId",t.storeInfo.ownerId)}),i.getLevelInfoBefore().success(function(e){t.slideImage=e.data.banner,s.$getByHandle("shop_slider").update(),s.$getByHandle("shop_slider").loop(!0)}),i.getLevelInfo(function(e){e.success(function(e){if(t.avatarImageFileId=e.data.avatarImageFileId,t.userCurrentLevelId=e.data.userCreditWithLevel.order,t.userName=e.data.userCreditWithLevel.name,t.storeCreditWithLevel=e.data.storeCreditWithLevel,e.data.storeCreditWithLevel)if(t.levelArray=[],e.data.storeCreditWithLevel.order<=3){t.imgCount=e.data.storeCreditWithLevel.order;for(var o=0;o<e.data.storeCreditWithLevel.order;o++)t.levelArray.push(m.imgBaseURL+"img/Star-Grade@2x.png")}else for(var o=0;o<e.data.storeCreditWithLevel.order-3;o++)t.levelArray.push(m.imgBaseURL+"img/Diamond-Grade@2x.png")})},L),i.getMessage().success(function(e){t.msg=e.data.list[0].content,e.data.count>0?t.flagNum=!0:t.flagNum=!1}),S.checkVersion()},t.slideImageClick=function(e){"1"==t.slideImage[e].type?"主题活动"==t.slideImage[e].activityType?f.go("bannerTheme",{bannerId:t.slideImage[e].bannerId,platformType:t.slideImage[e].platformType}):"日常活动"==t.slideImage[e].activityType&&h.getBannerTheme(t.slideImage[e].bannerId,t.slideImage[e].platformType).success(function(o){f.go("bannerDaily",{bannerId:t.slideImage[e].bannerId,layout:o.data.layout,platformType:t.slideImage[e].platformType})}):"6"==t.slideImage[e].type&&f.go("crowdFunding")},t.share=function(){if(window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else{var e=t.storeInfo.storeName+"的顺逛小店",o=t.storeInfo.avatarImageFileId,i=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?window.umeng.share(e,"买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",o,i,0):alert("只能在app分享,请下载app！")}},t.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),p.showToastShort("复制成功")):p.showToast("请下载APP执行此操作")},t.hideblackCover=function(){t.showShare=!1},t.shareToPlatform=function(e){var o=t.storeInfo.storeName+"的顺逛小店",i="买家电，到顺逛。品质无忧，更享精致服务。货到付款，送装一体。多种品类，不同系列，爆款家电，明星机型，更多精彩尽在我的顺逛小店!",s=t.storeInfo.avatarImageFileId,n=r.getShareLinkHeader()+"myStore/"+t.storeId+"/"+t.storeId+"/";window.umeng?(0==e?window.umeng.shareToSina(o,i,s,n,0,null,T.shareSuccessCallback):1==e?window.umeng.shareToWechatSession(o,i,s,n,0,null,T.shareSuccessCallback):2==e?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,T.shareSuccessCallback):3==e?(window.umeng.shareToQQ(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):4==e?(window.umeng.shareToQzone(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):5==e&&t.copeText(n),T.successShare()):alert("umeng undefined 只能在app分享"),t.showShare=!1},t.changeIcon=function(){if(window.cordova){var e={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(e){function i(e){t.avatarImage=e,u(function(){t.avatarImage=e},200);var i=function(e){d.hide(),p.showToast("上传成功");var i=JSON.parse(e.response);t.avatarImage=i.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},s=function(e){d.hide(),p.showToast("上传失败")},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var a={};n.params=a,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),i,s,n);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function s(e){}function n(e){t.avatarImage=e,u(function(){t.avatarImage=e},200);var i=function(e){p.showToast("上传成功"),d.hide();var i=JSON.parse(e.response);t.avatarImage=i.data.avatarImageFileId,t.user.avatarImageFileId=t.avatarImage,o.setUser(t.user)},s=function(e){p.showToast("上传失败"),d.hide()},n=new FileUploadOptions;n.fileKey="imageFile",n.fileName=t.avatarImage.substr(t.avatarImage.lastIndexOf("/")+1),n.mimeType="image/jpeg";var a={};n.params=a,(new FileTransfer).upload(t.avatarImage,encodeURI(l.uploadImage()),i,s,n);var r={template:'<div style="background:#fff;border-radius:4px;"><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};d.show(r)}function a(e){}1==e?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==e&&navigator.camera.getPicture(n,a,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(e,i),u(function(){window.plugins.actionsheet.hide()},5e3)}else c.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})},t.enter=function(o){if(-1!=o.indexOf("http"))if(window.cordova)if(m.isIOS)if(window.device.hasNewBrowser){var i=null;i=I.open(o),i.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else if(window.device.hasNewBrowser){var i=null;i=I.open(o),i.addEventListener("exit",function(e){})}else cordova.InAppBrowser.open(o,"_blank","location=yes");else window.open(o,"_blank","location=yes");else-1!=o.indexOf("vip")?t.goMemberCenter():(f.go(o),e.nextDirection("forwoard"))},t.goNewHand=function(){-1!=navigator.userAgent.indexOf("iPhone")?I.open(r.getHead()+"mstore/sg/helpDetail.html?id=613","新手必读").addEventListener("exit",function(e){}):f.go("helpDetail",{helpId:"613",content:"新手必读"})},t.setSwitchFun=function(e){var t=e;if(localStorage.getItem("setSwitch")){for(var o=JSON.parse(localStorage.getItem("setSwitch")),i=!1,s=o.length-1;s>=0;s--)if(o[s].id==t)return m.isCommission=o[s].list[0].checked,m.cashSwitch=o[s].list[1].checked,m.goldRainSwitch=o[s].list[2].checked,void(i=!0);if(!i){m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0;var n={id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]};o.push(n),localStorage.setItem("setSwitch",JSON.stringify(o))}}else{var a=[{id:t,list:[{name:"佣金",checked:!0},{name:"提现通知",checked:!0},{name:"金币雨",checked:!0}]}];localStorage.setItem("setSwitch",JSON.stringify(a)),m.isCommission=!0,m.cashSwitch=!0,m.goldRainSwitch=!0}},t.$on("$ionicView.beforeEnter",function(e,i){if(t.isApp=!!window.cordova||void 0,x=$.token)a.login(x).success(function(e){if(!e.success||null==e.data.mid)return void f.go("login");o.setUser(e.data),v.set("sg_login_token_secret","Bearer"+e.data.sessionValue),L=o.getUser().mid,A.checkOpenStore(L).success(function(e){e.data?(t.isBuyer="1",A.setRole(t.isBuyer),v.set("storeId",L)):(t.isBuyer="0",A.setRole(t.isBuyer),v.set("storeId",20219251))}),t.avatarImage=o.getUser().avatarImageFileId,n.scrollTop(),t.setSwitchFun(L),t.init()}).error(function(){f.go("login")});else{if(L=o.getUser().mid,t.avatarImage=o.getUser().avatarImageFileId,!o.getUser().mid)return void f.go("login");n.scrollTop(),t.setSwitchFun(L),t.init()}})}]),APP.service("ShopService",["$http","UrlService","CreditService",function(e,t,o){this.getStoreInfo=function(){var o={noLoading:!0};return e({method:"POST",url:t.getUrl("GET_STORE_INFO"),params:o})},this.getLevelInfo=function(i,s){o.getGameId(function(o){i(e.get(t.getUrl("SHUNGUANG_VIP")+"?gameId="+o+"&memberId="+s))})},this.getLevelInfoBefore=function(){return e.get(t.getUrl("MY_STORE"))},this.getMessage=function(){return e.get(t.getUrl("MESSAGECENTER_INIT"))}}]),APP.controller("ShopRenovateController",["$scope","SetShopCoverService","UserService",function(e,t,o){e.shopCoverUrl="",e.storeId=o.getUser().mid,e.init=function(){t.getShopCover(e.storeId).success(function(t){for(var o=0,i=t.data.shopCover.length;o<i;o++)1==t.data.shopCover[o].selected&&(e.shopCoverUrl=t.data.shopCover[o].coverUrl)})},e.$on("$ionicView.beforeEnter",function(){e.storeId=o.getUser().mid,e.init()})}]),APP.controller("ShopRevenueController",["$scope","$state","$ionicHistory","ShopRevenueService","PopupService","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a){function r(){i.isHasBindBankNum().success(function(e){e.success&&(u=e.data)})}function c(e){i.getAccountState(e).success(function(e){e.success&&(d=e.data)})}function l(){i.getTotalCommission().success(function(t){t.data.isLogin?e.totalCommission=t.data.totalReward:e.totalCommission=""}).error(function(e){})}e.styleFlag=!0,e.myInComeOut={},e.myTrendOut={},e.earningType="";var d=0;e.totalCommission="";var u="";e.init=function(){e.myInComeOut=[],e.myTrendOut=[],e.styleFlag=!0,e.earningType="B",e.loadData(7,e.earningType),r(),c(e.earningType),l()},e.loadData=function(t,o){i.getRevenueInfo(t,o).success(function(t,o,i,s){e.myInComeOut=t.data.myInComeOut,e.myTrendOut=t.data.myTrendOut;for(var n=echarts.init(document.getElementById("shopRevenueChart")),a=e.myTrendOut.dates,r=0;r<e.myTrendOut.dates.length;r++)a=a.replace("'","");var c={grid:{show:!0,left:"10%",top:"5%",right:"5%",bottom:"15%",padding:20,backgroundColor:new echarts.graphic.LinearGradient(0,0,1,1,[{offset:0,color:"#1188D7"},{offset:1,color:"#3CA9F1"}])},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"line",lineStyle:{color:"rgba(255,255,255,0.2)",width:2}}},xAxis:{type:"category",boundaryGap:!1,data:a.split(","),axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede",width:1}},axisTick:{lineStyle:{color:"#dedede",width:1}}},yAxis:[{type:"value",backgroundColor:"#1188D7",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbol:"circle",showSymbol:!1,symbolSize:6,smooth:!0,areaStyle:{normal:{color:"rgba(255,255,255,0.10)"}},itemStyle:{normal:{borderWidth:2,borderColor:"#ffffff",color:"#1188D7",lineStyle:{color:"#ffffff",width:2}}},data:e.myTrendOut.values.split(",")}]};n.setOption(c)})};var p=!0;e.changeProductType=function(t,o){p&&(e.styleFlag=o,p=!1,e.earningType=t,e.loadData(7,e.earningType),setTimeout(function(){p=!0},500))},e.goHelpDetail=function(){-1!=navigator.userAgent.indexOf("iPhone")?n.open(a.getHead()+"mstore/sg/helpDetail.html?id=15","营收结算规则").addEventListener("exit",function(e){}):t.go("helpDetail",{helpId:15,content:"营收结算规则"})},e.withdraw=function(){1==d||3==d||4==d||parseInt(u)>0?e.myInComeOut?t.go("mentionCenter",{canAmount:e.myInComeOut.canAmount}):t.go("mentionCenter",{canAmount:0}):t.go("bankCard")},e.goBack=function(){if(!o.backView()||"mentionCenter"==o.viewHistory().backView.stateName)return void t.go("homePage");o.backView()&&o.backView().url.indexOf("login")>0?o.goBack(-2):o.goBack()},e.closePopup=function(){e.loginIsAuthentication=!1},e.$on("$ionicView.beforeEnter",function(){e.loginIsAuthentication=!1,e.loginIsAuthenticationClose=!0,u="",e.init()})}]),APP.service("ShopRevenueService",["$http","UrlService",function(e,t){this.getRevenueInfo=function(o,i){var s={range:o,earningType:i};return e.get(t.getUrl("REVENUE_INFO"),s)},this.getAccountState=function(o){var i={earningType:o};return e.get(t.getUrl("GET_ACCOUNT_STATE"),i)},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))},this.activation=function(){return e.get(t.getUrl("KBIND_ACTIVATION"))},this.isHasBindBankNum=function(){return e.get(t.getUrl("BANK_HASBINGNUM_NEW"))},this.realName=function(){return e.get(t.getUrl("KBIND_REALNAME"))},this.getTotalCommission=function(){var o={startDate:"",endDate:""};return e({method:"POST",url:t.getUrl("GET_TOTAL_COMMISSION"),params:o})}}]),APP.service("SpreadConnectionService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getConnectionMessage=function(o,i,s){var n={partnerId:o,pageIndex:i,pageSize:s};return e.get(t.getUrl("SPREAD_CONNECTION"),n)},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("StatisticsController",["$ionicHistory","$q","$scope","$ionicHistory","$state","StatisticsService","$ionicScrollDelegate",function(e,t,o,e,i,s,n){function a(e,t){for(var o in e)e[o].storeName=s.limitStrLength(e[o].storeName,t)}function r(e){if(e instanceof Array){for(var t=[],o=0;o<e.length;++o)t[o]=r(e[o]);return t}if(e instanceof Object){var t={};for(var o in e)t[o]=r(e[o]);return t}return e}function c(e){var o=t.defer();return o.resolve(r(e)),o.promise}o.backToLastView=function(){i.go("personnalCenter"),e.clearCache()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.paddingtopClass={"padding-top":"30px"}:o.paddingtopClass={"padding-top":"14px"},o.switchType=function(e){o.typeState[e]||(o.typeState=[!1,!1],o.typeState[e]=!0,o.isPersonalStat=!o.isPersonalStat)},o.scrollToTop=function(){n.scrollTop({shouldAnimate:!0}),o.isShowScrollToTopButton=!1},o.watchScrollPosition=function(){n.getScrollPosition().top>10&&(o.isShowScrollToTopButton=!0)},o.switchConnectionType=function(e){0==o.connectionType[e]&&(o.connectionType=[!1,!1],o.connectionType[e]=!0,o.optionArr=[!0,!1],0==e&&o.hasPartner&&(c(o.partnerData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})),1==e&&o.hasConnection&&(c(o.connectionData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.connectionData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})))},o.switchOption=function(e){0==o.optionArr[e]&&(o.optionArr=[!1,!1],o.optionArr[e]=!0,o.isShowOption=!o.isShowOption)},o.closeOption=function(){o.isShowOption=!o.isShowOption},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e},o.timeTransform=function(e){var t=new Date;return t.setTime(e),t.Format("yyyy-MM-dd hh:mm:ss")},o.init=function(){s.getReportMessage().success(function(e){o.allData=e.data,0!=e.data.subLevelReportList.length?(o.hasSubLevel=!0,e.data.subLevelReportList[0]&&!$.isEmptyObject(e.data.subLevelReportList[0])?(o.hasPartner=!0,o.partnerData=e.data.subLevelReportList[0],e.data.subLevelReportList[1]&&!$.isEmptyObject(e.data.subLevelReportList[1])?(o.hasConnection=!0,o.connectionData=e.data.subLevelReportList[1],c(o.partnerData.brokerageReportList).then(function(e){a(e,o.nowStoreNameLength),o.nowMonthContent=e}),c(o.partnerData.brokerageReportList).then(function(e){a(e,o.totalStoreNameLength),o.totalContent=e})):(o.hasConnection=!1,c(o.partnerData.brokerageReportList).then(function(e){o.nowMonthContent=e,a(o.nowMonthContent,o.nowStoreNameLength)}),c(o.partnerData.brokerageReportList).then(function(e){o.totalContent=e,a(o.totalContent,o.totalStoreNameLength)}))):(o.hasPartner=!1,o.hasConnection=!1)):(o.hasSubLevel=!1,o.hasPartner=!1,o.hasConnection=!1)}),s.getReportMessagePlus().success(function(e){o.newBrokerageAmount=e.data.newBrokerageAmount,o.totalBrokerageAmount=e.data.totalBrokerageAmount})},o.$on("$ionicView.beforeEnter",function(){o.isPersonalStat=!1,o.typeState=[!0,!1],o.connectionType=[!0,!1],o.optionArr=[!0,!1],o.isShowOption=!1,o.isShowScrollToTopButton=!1,o.nowStoreNameLength=Math.floor(.21*(window.innerWidth-24)/13*4-3),o.totalStoreNameLength=Math.floor(.38*(window.innerWidth-24)/13*2-1),o.init()})}]),APP.service("StatisticsService",["$http","UrlService","CalculateStrLength",function(e,t,o){this.getReportMessage=function(){return e.get(t.getUrl("REPORT_DETAIL"))},this.getReportMessagePlus=function(){return e.get(t.getUrl("REPORT_DETAIL_PLUS"))},this.limitStrLength=function(e,t){return o.limitStrLength(e,t)}}]),APP.controller("VRController",["$rootScope","$scope","UrlService","$sce","$ionicHistory","$stateParams",function(e,t,o,i,s,n){t.iframeUrl=i.trustAsResourceUrl(e.imgBaseURL+"VRshop/index.html");var a=n.isH5;t.goBack=function(){a?s.goBack():window.location.href="backToApp"}}]),APP.controller("WithdrawCashController",["$scope","$stateParams","WithdrawCashService","PopupService","$timeout","$ionicHistory","$state","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r,c){e.canAmount="",e.account="",e.canGetCash=!1,e.loadFinish=!1,e.init=function(){e.canGetCash=!1,t.canAmount?e.canAmount=t.canAmount:e.canAmount=0,e.canAmount>0&&(e.canGetCash=!0),e.loadFinish=!1,o.getMessage().success(function(t,o,s,n){t.success?t.data.kjtAccount&&(e.loadFinish=!0,e.account=t.data.kjtAccount.memberKjtpayAccount):(i.showToast(t.message),e.loadFinish=!1)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.getCashNow=function(){o.getCash(e.account).success(function(e,t,o,s){e.success?a.go("withdrawSuccess",{content:e.data.result}):i.showToast(e.message)})},e.toRules=function(e,t){-1!=navigator.userAgent.indexOf("iPhone")?r.open(c.getHead()+"mstore/sg/helpDetail.html?id="+e,t):a.go("helpDetail",{helpId:e,content:t})}}]),APP.service("WithdrawCashService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.getCash=function(o){var i={kjtAccount:o};return e.get(t.getUrl("GETCASH_INIT"),i)}}]),APP.controller("WithdrawSuccessController",["$scope","$stateParams","$ionicHistory",function(e,t,o){e.content=t.content,e.goBack=function(){o.goBack(-2)}}]),APP.controller("batchDeleteOrderController",["$ionicHistory","$ionicPopup","$scope","PopupService","OrderManageService","BatchOrderService","$ionicScrollDelegate","$state","$ionicViewSwitcher","$rootScope",function(e,t,o,i,s,n,a,r,c,l){o.hasMoreData=!1,o.closeOrderData=[];var d=0;o.goBack=function(){c.nextDirection("enter"),r.go("orderManage")},o.loadData=function(){d=0,s.getOrderList(1,"closed",0,5,"").success(function(e){if(e.success){a.scrollTop(),o.isSelectAllOrder=!1,o.closeOrderData=e.data.orders,o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.image=[];for(var t=0;t<o.closeOrderData.length;t++)o.image[t]="img/ic_check.png"}})},o.loadMore=function(){d++,s.getOrderList(1,"closed",d,5,"").success(function(e){if(e.success){for(var t=o.closeOrderData.length;t<e.data.orders.length+o.closeOrderData.length;t++)o.image[t]="img/ic_check.png",o.isSelectAllOrder=!1;o.closeOrderData=o.closeOrderData.concat(e.data.orders),o.hasMoreData=e.data.countResult>o.closeOrderData.length,o.$broadcast("scroll.infiniteScrollComplete")}})},o.selectOrderAddress=function(e){o.chooseOrderNum=0,-1!=o.image[e].indexOf("check")?(o.image[e]="img/ic_select.png",o.chooseOrderNum++,o.isChooseOrder=!0):(o.image[e]="img/ic_check.png",o.chooseOrderNum--),o.chooseOrderNum==o.image.length?o.isSelectAllOrder=!0:o.isSelectAllOrder=!1},o.selectAllOrder=function(){if(o.isSelectAllOrder){for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_check.png";o.chooseOrderNum=0,o.isSelectAllOrder=!1}else{for(var e=0,t=o.closeOrderData.length;e<t;e++)o.image[e]="img/ic_select.png";o.isSelectAllOrder=!0,o.chooseOrderNum=o.image.length}},o.batchDelete=function(){o.isChooseOrder=!1;for(var e=0;e<o.image.length;e++)-1!=o.image[e].indexOf("select")&&(o.isChooseOrder=!0);if(!o.isChooseOrder)return void i.showToast("请选择要删除的订单");t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){if(e){for(var t="",i=[],s=0,a=o.image.length;s<a;s++)-1!=o.image[s].indexOf("select")&&i.push(o.closeOrderData[s].orderId);t=i.join(",");var l={orderIds:t};n.batchDelete(l).success(function(e){if(e.success){if(o.isSelectAllOrder&&!o.hasMoreData)return c.nextDirection("enter"),void r.go("orderManage");o.loadData()}})}})},o.$on("$ionicView.beforeEnter",function(){a.scrollTop(),d=0,o.image=[],o.chooseOrderNum=0,o.isChooseOrder=!1,o.isSelectAllOrder=!1,window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?o.isIosAndInApp=!0:o.isIosAndInApp=!1,window.cordova?o.isApp=!0:o.isApp=!1,o.isIosAndInApp&&(o.iosStyleOne={padding:"64px 0 90px 0"},o.iosStyleTwo={top:"20px"}),o.isApp?o.bottomDivHeight={height:"40px"}:o.bottomDivHeight={height:"120px"},o.loadData()})}]),APP.service("BatchOrderService",["$http","UrlService",function(e,t){this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ORDER"),o)}}]),APP.controller("chaseEvaluateController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","chaseEvaluateService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){function m(o){var i=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):a.showToast(o.message)},s=function(e){alert(e)},n=new FileUploadOptions,r=new Date,c=r.getTime();n.fileKey="imageFile",n.fileName=u.getUser.userName+c,n.headers={TokenAuthorization:g.get("sg_login_token_secret")},n.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),i,s,n)}function f(e){}var h=[],v=!0;e.goBack=function(){c.goBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(m,f,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?a.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(t){t?v&&(v=!1,p.submitEvaluateNew(e.wdOrderSn,e.commentObj.commentTt,h.join(",")).success(function(t){v=!0,t.success?t.data&&(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?a.showToast(t.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.$on("$ionicView.beforeEnter",function(){v=!0,e.wdOrderSn=o.cOrderSn,e.isMyOrder=1==o.isMeorder,e.commentObj={commentTt:""},e.imageCount=0,e.imageList=[],h=[]})}]),APP.service("chaseEvaluateService",["$http","UrlService",function(e,t){this.submitEvaluateNew=function(o,i,s){var n={cOrderSn:o,experienceContent:i,fileIds:s};return e({method:"POST",url:t.getUrl("ADD_ASSESS_SUBMIT"),params:n})}}]),APP.controller("criticalSuccessController",["$scope","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","UrlService","CreditService","criticalSuccessService",function(e,t,o,i,s,n,a,r,c,l,d,u){function p(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
this.encode=function(e){var t,o,i,s,n,a,r,c="",l=0;for(e=_utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),o=e.charCodeAt(l++),i=e.charCodeAt(l++),s=t>>2,n=(3&t)<<4|o>>4,a=(15&o)<<2|i>>6,r=63&i,isNaN(o)?a=r=64:isNaN(i)&&(r=64),c=c+_keyStr.charAt(s)+_keyStr.charAt(n)+_keyStr.charAt(a)+_keyStr.charAt(r);return c},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var i=e.charCodeAt(o);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}}var g=new p;e.thisTitleName="评价成功",e.goBack=function(){"lookAssess"==r.viewHistory().backView.stateName?r.goBack(-1):r.goBack(-2)},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"});var m;e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),n.showToastShort("复制成功")):n.showToast("请下载APP执行此操作")},e.shareToPlatform=function(t){m=encodeURIComponent(g.encode(e.wdOrderSn));var o=e.isCriticalShop.productName,i=e.isCriticalShop.productImg,s=l.getShareLinkHeader()+"useExperience/"+m;window.umeng?(0==t?window.umeng.shareToWechatSession("邀请评价",o,i,s,0,null,d.shareSuccessCallback):1==t&&window.umeng.shareToQQ("邀请评价",o,i,s,0,null,d.shareSuccessCallback),2==t?e.copeText(s):d.successShare()):alert("只能在app分享")},e.criticalInit=function(){u.criticalNo(e.wdOrderSn).success(function(t){t.success?(e.noCriticalOrderList=t.data.waitComments,e.isCriticalShop=t.data.productInfo,e.isMeOrder=t.data.isMyOrder,e.isStore=t.data.isStoreMember):n.showToastShort(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.thisTitleName="评价成功","lookAssess"==r.viewHistory().backView.stateName&&(e.thisTitleName="邀请评价"),e.wdOrderSn=t.cOrderSn,e.shareList=[{img:c.imgBaseURL+"img/mm-wechat.png",text:"微信"},{img:c.imgBaseURL+"img/qq.png",text:"QQ"},{img:c.imgBaseURL+"img/btn_link.png",text:"复制链接"}],e.criticalInit()})}]),APP.service("criticalSuccessService",["$http","UrlService",function(e,t){this.criticalNo=function(o){var i={cOrderSn:o};return e.get(t.getUrl("CRITICALSUC"),i)}}]),APP.controller("evaluationSuccessController",["$scope",function(e){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.$on("$ionicView.beforeEnter",function(){})}]),APP.controller("FinancialMoneyController",["InAppBrowserService","$rootScope","$scope","$state","FinancialMoneyService","UrlService","$stateParams",function(e,t,o,i,s,n,a){var r=n.getHead().replace("v3/","www/index.html");o.ssAuth=null,t.financialMoneyWhereId="","manageMoney"!=a.whereId&&(t.financialMoneyWhereId=a.whereId),o.loginUrl=r+"#/financialMoney/"+t.financialMoneyWhereId,o.returnUrl=r+"#/"+t.financialMoneyWhereId;o.$on("$ionicView.beforeEnter",function(){var e=window.location.href.indexOf("page=");if(-1!=e&&-1==window.location.href.indexOf("auth_code")){var t=unescape(window.location.href).substring(e+5);return void(window.location.href=t)}o.init()}),o.init=function(){function e(){s.checkKjtLogin().success(function(e){if(e.data.isLogin)o.ssAuth=e.data.token,angular.element("#hairongyi").submit();else{var i=r+"#/"+t.financialMoneyWhereId,s=r+"#/financialMoney/"+t.financialMoneyWhereId+"?page="+i,n=escape(s),a="https://zmgs.kjtpay.com/mgs/common/page.htm?page=authorizeMain&partner_id=200000055141&return_url="+n;window.location.href=a}})}var i=unescape(window.location.href);if(-1!=i.indexOf("auth_code")){var n=i.indexOf("auth_code")+10,a=i.toString().substr(n,32);s.getToken({authCode:a}).success(function(t){o.ssAuth=t.data.token,e()})}else e()}}]),APP.service("FinancialMoneyService",["$http","UrlService","UserService",function(e,t,o){this.getToken=function(o){return e({method:"POST",url:t.getUrl("GET_KJT_TOKEN"),params:o})},this.checkKjtLogin=function(){return e.get(t.getUrl("CHECK_KJT_LOGIN"))}}]),APP.controller("publicationEvaluationController",["$scope","publicationEvaluationService","$stateParams","$timeout","PlatformService","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$ionicActionSheet","UserService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(o){var i=function(t){var o=JSON.parse(t.response);o.success?e.$apply(function(){for(var t=0;t<9;t++)if(!h[t]){h[t]=o.data.fileId,e.imageList[t]=o.data.imgUrl,e.imageCount++;break}}):a.showToast(o.message)},s=function(e){alert(e)},n=new FileUploadOptions,r=new Date,c=r.getTime();n.fileKey="imageFile",n.fileName=u.getUser.userName+c,n.headers={TokenAuthorization:p.get("sg_login_token_secret")},n.mimeType="image/jpeg",(new FileTransfer).upload(o,encodeURI(t.uploadImage()),i,s,n)}function m(e){}var f=[],h=[],v=!0;e.goBack=function(){c.goBack()},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.addImage=function(){if(!window.cordova)return void alert("请下载客户端");d.show({buttons:[{text:"拍照"},{text:"从相册选取"}],titleText:"照片选取方式",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!1,correctOrientation:!0}):1==e&&navigator.camera.getPicture(g,m,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720}),!0}})},e.removeImage=function(t){e.imageList.splice(t,1),h.splice(t,1),e.imageCount--},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}f=[],e.impressionArr.forEach(function(t){f.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.evaluateMethod=function(t){e.evaluateList=t},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?a.showToast("请输入2～500字的评价！"):t.checkAssessText(e.commentObj.commentTt).success(function(o){o?v&&(v=!1,t.submitEvaluationNew(e.wdOrderSn,e.commentObj.commentTt,e.evaluateList,e.valueAll.value1,e.valueAll.value3,e.valueAll.value2,h.join(","),f.join(","),e.isMeOrder,e.isStore).success(function(t){v=!0,t.success?t.data&&(a.showToastShort("商品评价成功！"),i(function(){l.$broadcast("AFTER_COMMIT"),r.go("criticalSuccess",{cOrderSn:e.wdOrderSn})},1e3)):t.message?a.showToast(t.message):a.showToast("提交失败！")})):a.showToast("您的评论里面包含敏感词！")})},e.init=function(){t.evaluationInit(e.wdOrderSn).success(function(t){t.success?(e.isMeOrder=1==t.data.isMyOrder,e.isStore=0==t.data.isStoreMember,e.impressionStr=t.data.impression,e.productPic=t.data.productInfo.productImg):a.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f=[],v=!0,e.isMeOrder=!1,e.wdOrderSn=o.cOrderSn,e.productPic="",e.commentObj={commentTt:""},e.valueAll={value1:"5",value2:"5",value3:"5"},e.impressionArr=[],e.impressionStr=[],e.evaluateList=5,e.imageCount=0,e.imageList=[],h=[],e.canCommit=!1,e.init()})}]),APP.service("publicationEvaluationService",["$http","UrlService",function(e,t){this.uploadImage=function(){return t.getUrl("UPLOAD_ASSESS_IMG_NEW")},this.checkAssessText=function(o){var i={checkword:o,noLoading:!0};return e.get(t.getUrl("CHECK_ASSESS_TEXT"),i)},this.evaluationInit=function(o){var i={cOrderSn:o};return e.get(t.getUrl("EVALUCTION_NEW"),i)},this.submitEvaluationNew=function(o,i,s,n,a,r,c,l,d,u){if(d||u)var p={cOrderSn:o,commentContent:i,star:s,productStar:n,serviceStar:a,shippingStar:r,fileIds:c,impressions:l};else p={cOrderSn:o,commentContent:i,star:s};return e({method:"POST",url:t.getUrl("SUBMIT_EVALUCTION_NEW"),params:p})}}]),APP.directive("commentBarNew",[function(){return{restrict:"E",template:'<div>\n        <img ng-click = "comment(0)" ng-src=\'{{commentValue>=1?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(1)" ng-src=\'{{commentValue>=2?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(2)" ng-src=\'{{commentValue>=3?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(3)" ng-src=\'{{commentValue>=4?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n        <img ng-click = "comment(4)" ng-src=\'{{commentValue>=5?"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_unselected.png":"http://cdn09.ehaier.com/shunguang/H5/www/img/ic_eva_selected.png"}}\' >\n      </div>',replace:!0,scope:{commentValue:"=commentValue",commentChange:"&commentChange"},link:function(e,t,o){e.comment=function(t){e.commentValue=t+1,e.commentChange()}}}}]),APP.controller("useExperienceController",["$scope","$stateParams","$timeout","$ionicLoading","PopupService","$state","$ionicHistory","$rootScope","$localstorage","$interval","useExperienceService","publicationEvaluationService","$ionicPopup",function(e,t,o,i,s,n,a,r,c,l,d,u,p){window.onerror=function(e,t,o,i,s){setTimeout(function(){})},document.querySelector("#file").addEventListener("change",function(){var t=this;lrz(t.files[0],{width:800}).then(function(t){e.$apply(function(){e.imageCount>=5?s.showToast("最多上传5张图片"):(e.imageList.push(t.base64),g.push(t.base64.replace("base64,","base64-")),e.imageCount++)})})});var g,m=[],f=!0;e.imageCount=0,e.imageList=[],e.isCanComment=!0,e.VCodeTips="获取验证码",e.canGetVcode=!0,e.userInfo={mobile:"",captcha:"",verificationCode:""},e.isCheckedCss={background:"rgba(255,68,0,0.05)",color:"#FF4400"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.removeImage=function(t){p.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){o&&(e.imageList.splice(t,1),g.splice(t,1),e.imageCount--)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.submitEvaluation=function(){e.commentObj.commentTt.length<2?s.showToast("请输入2～500字的评价！"):0==e.userInfo.mobile.length?s.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?0==e.userInfo.verificationCode.length?s.showToast("请输入短信验证码"):u.checkAssessText(e.commentObj.commentTt).success(function(t){t?f&&(f=!1,d.submitBuyerComment(e.wdOrderSn,e.userInfo.mobile,e.userInfo.verificationCode,e.commentObj.commentTt,g,m.join(",")).success(function(e){f=!0,e.success?e.data&&(s.showToastShort("商品评价成功！"),o(function(){r.$broadcast("AFTER_COMMIT"),n.go("evaluationSuccess")},1e3)):e.message?s.showToast(e.message):s.showToast("提交失败！")})):s.showToast("您的评论里面包含敏感词！")}):s.showToast("请输入正确的手机号格式")},e.setImgCaptchaForPhone=function(){e.identifyCodeImg=d.getImgCaptchaNew()+"?rnd="+Math.random()+"&flag="+c.get("sg_login_token_secret").substring(6)},e.getVCode=function(){e.canGetVcode&&(e.userInfo.mobile.length<=0?s.showToast("请输入手机号"):/^1[34578]\d{9}$/.test(e.userInfo.mobile)?e.userInfo.captcha.length<=0?s.showToast("请输入图形验证码"):d.fastLoginCaptchaNew(e.wdOrderSn,e.userInfo.mobile,e.userInfo.captcha).success(function(t){if(t.data){e.canGetVcode=!e.canGetVcode;var o=60;e.timer=l(function(){o-1<0?(e.VCodeTips="获取验证码",l.cancel(e.timer),e.canGetVcode=!0):(o--,e.VCodeTips=o+"s后可重发 ")},1e3)}else s.showToast(t.message)}):s.showToast("请输入正确的手机号格式"))},e.buyerIms=function(t){if(-1==e.impressionArr.indexOf(t))e.impressionArr.push(t);else for(var o=0;o<e.impressionArr.length;o++)if(e.impressionArr[o]==t){e.impressionArr.splice(o,1);break}m=[],e.impressionArr.forEach(function(t){m.push(e.impressionStr[t].impressionsProdTypeId)})},e.isChecked=function(t){return-1!=e.impressionArr.indexOf(t)},e.useExperienceInit=function(t){d.userCommentPage(t).success(function(t){t.success?(e.productObj=t.data.productInfo,e.impressionStr=t.data.impression,e.isCanComment=t.data.status):s.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){g=[],f=!0,l.cancel(e.timer),e.productObj=[],e.impressionStr=[],l.cancel(e.timer),e.wdOrderSn=t.cOrderSn,e.useExperienceInit(e.wdOrderSn),e.setImgCaptchaForPhone(),m=[],e.commentObj={commentTt:""},e.valueAll={value1:5,value2:5,value3:5},e.impressionArr=[],e.impressionStr=[],e.canCommit=!1}),e.$on("$ionicView.beforeLeave",function(){l.cancel(e.timer)})}]),APP.service("useExperienceService",["$http","UrlService",function(e,t){this.getImgCaptchaNew=function(){return t.getUrl("GET_IMG_CAPTCHA_NEW")},this.fastLoginCaptchaNew=function(o,i,s){var n={cOrderSn:o,mobile:i,imgCaptcha:s};return e({method:"GET",url:t.getUrl("FAST_LOGIN_CAPTCHA_COMMENT"),params:n})},this.userCommentPage=function(o){var i={cOrderSn:o};return e.get(t.getUrl("USER_COMMENT_PAGE"),i)},this.submitBuyerComment=function(o,i,s,n,a,r){var c={cOrderSn:o,mobile:i,mobileCode:s,userCommentContent:n,imageFile:a,impressions:r};return e({method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:t.getUrl("SUBMIT_BUYER_COMMENT"),transformRequest:function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:c})}}]),APP.controller("AddAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","ADDADDRESSService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage=s.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var m=window.innerHeight,f=m-373+"px";o.contentHeight={height:f};var h=m-250+"px";o.contentHeightStreet={height:h},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={};var v={};o.init=function(){if(o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn){var e=l.viewHistory().backView;e&&"address"==e.stateName?e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&o.addressMsgInit():(o.addressRegionName="所在地区",o.defaultImage=s.imgBaseURL+"img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s")}else o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.defaultOrchange&&o.hasChangeCommon();o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.hasChangeCommon=function(){o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree+" "+o.streetMsg,o.address.provinceId=o.hasChangeArr["value-1"],o.address.cityId=o.hasChangeArr["value-2"],o.address.areaId=o.hasChangeArr["value-3"],n.getLocationList(o.hasChangeArr["value-3"],o.hasChangeArr["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})},o.addressMsgInit=function(){o.textColor="color-text-l",o.streetTextColor="color-text-l",void 0==s.addressStr?(o.defaultOrchange=!0,o.isChangeOrDefault=1,o.productChangeAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsg=JSON.parse(s.addressDefMsg),o.addressNum=o.adsMsg.pcrName.indexOf("/"),o.adsDefMsgInfo=o.adsMsg.pcrName,o.addressStreet=o.adsDefMsgInfo.substring(o.addressNum+1),o.addressRegName=o.adsMsg.pcrName.substring(o.addressNum,-1),o.addressRegionName=o.addressRegName,o.productDefaultAddress={provinceId:o.adsMsg.provinceId,cityId:o.adsMsg.cityId,areaId:o.adsMsg.regionId,streetId:o.adsMsg.streetId,regionName:o.addressRegName+" "+o.addressStreet,streetText:o.addressRegName},n.getLocationList(o.adsMsg.regionId,o.adsMsg.provinceId).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")})):(o.defaultOrchange=!0,o.isChangeOrDefault=2,o.productDefaultAddress={provinceId:"",cityId:"",areaId:"",streetId:""},o.adsMsgChange=JSON.parse(s.addressStr),o.productChangeAddress={provinceId:o.adsMsgChange["value-1"],cityId:o.adsMsgChange["value-2"],areaId:o.adsMsgChange["value-3"],streetId:o.adsMsgChange["value-4"],regionName:o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"]+" "+o.adsMsgChange["text-4"]},o.addressStreet=o.adsMsgChange["text-4"],o.addressRegionName=o.adsMsgChange["text-1"]+" "+o.adsMsgChange["text-2"]+" "+o.adsMsgChange["text-3"],n.getLocationList(o.adsMsgChange["value-3"],o.adsMsgChange["value-1"]).success(function(e){o.dataAddStreet=e.data}).error(function(e){r.showToast("获取地址信息失败！")}))},o.$on("$ionicView.beforeEnter",function(){o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.commonGoBack=function(){t.confirm({template:"您当前信息未保存，是否保存信息？",cancelText:"离开",okText:"留在此页面"}).then(function(e){e||(o.panGoOn=!1,o.addressRegionName="所在地区",o.$ionicGoBack())})},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"");var t=l.viewHistory().backView;t&&"address"==t.stateName&&t.stateParams&&t.stateParams&&"YES"==t.stateParams.comeFromOrder&&(e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address?o.commonGoBack():l.goBack()}),e.registerBackButtonAction(function(e){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&o.commonGoBack()}),o.goBack=function(){""!=o.address.mobile&&""!=o.address.consignee&&""!=o.address.address&&"所在地区"!=o.addressRegionName&&"街道"!=o.addressStreet?o.commonGoBack():l.goBack()}},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.setDefault=function(){0==o.defaultHide?(o.address.isDefault="0",o.defaultHide=!0):(o.address.isDefault="1",o.defaultHide=!1)},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,i,s){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=s,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,n.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var S=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var i=0;i<o.nowLevelIndex.length;i++)i>o.nowLevel&&(o.nowLevelIndex[i]=-1);o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",n.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.level=o.levelArea,n.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,n.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if(S)return;c(function(){S=!1},1500),s.$broadcast(o.flag,o.defaultValue),S=!0,o.closeAddressModal()}},300),o.getPosition=function(){if("定位中···"!=s.globalConstant.autoPosition){v=a.getAddressInfo();var e=v.regionName+"/"+v.streetName;n.addAddress(v.provinceId,v.cityId,v.areaId,e,v.streetId).success(function(){var e={"text-1":v.provinceName,"text-2":v.cityName,"text-3":v.regionName,"text-4":v.streetName,"value-1":v.provinceId,"value-2":v.cityId,"value-3":v.areaId,"value-4":v.streetId};n.getLocationList(v.areaId,3).success(function(e){o.dataAddStreet=e.data;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.positionAddress={provinceId:v.provinceId,cityId:v.cityId,areaId:v.areaId,streetId:0,pca:v.provinceName+" "+v.cityName+" "+v.regionName,regionName:""},o.isPosition=!0,s.$broadcast(o.flag,e),o.streetTextColor="color-text-s",o.addressModal.hide()})}},u.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),u.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.fromOrder;var e=l.viewHistory().backView;e&&"address"==e.stateName&&e.stateParams&&e.stateParams&&"YES"==e.stateParams.comeFromOrder&&(o.fromOrder=!0),o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.fromOrder?o.isPosition?o.positionCommonFun():o.defaultOrchange&&1==o.isChangeOrDefault?(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.regionName):3==o.isChangeOrDefault?(o.newAddAddress(),!o.regionTrue&&o.isDef&&(o.address.provinceId=o.productDefaultAddress.provinceId,o.address.cityId=o.productDefaultAddress.cityId,o.address.areaId=o.productDefaultAddress.areaId,o.address.streetId=o.productDefaultAddress.streetId,o.address.regionName=o.productDefaultAddress.streetText+" "+o.addressStreet)):o.defaultOrchange&&2==o.isChangeOrDefault?(o.address.provinceId=o.productChangeAddress.provinceId,o.address.cityId=o.productChangeAddress.cityId,o.address.areaId=o.productChangeAddress.areaId,o.address.streetId=o.productChangeAddress.streetId,o.address.regionName=o.productChangeAddress.regionName):4==o.isChangeOrDefault&&o.newAddAddress():o.isPosition?o.positionCommonFun():o.newAddAddress(),n.doInit(o.address).success(function(e,t,i,n){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",s.addressDefaultMsg={provinceId:"",cityId:"",regionId:"",streetId:"",provinceName:"",cityName:"",pcrName:""},s.addressStr=void 0,o.isChangeOrDefault=0,o.productDefaultAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.productChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,regionName:""},o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,o.fromOrder?o.$ionicGoBack(-2):o.$ionicGoBack()):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):o.globalConstant.mobileNumberRegExp.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+" "+o.addressStreet+" "+o.address.address,e.getLocation(o.allAddress,function(i,s){if("complete"==i&&s.geocodes.length){var n=s.geocodes[0].location.lat,a=s.geocodes[0].location.lng,r=[a,n];e.getAddress(r,function(e,i){if("complete"===e&&"OK"===i.info){o.township=i.regeocode.addressComponent.township,o.addressStreet=o.township;for(var s=[],n=[],s=o.dataAddStreet,a=0;a<s.length;a++)if(n.push(s[a].text),-1!=n.indexOf(o.township)){var r=n.indexOf(o.township);o.isNotDistinguish=!0,o.addChangeAddress.streetId=s[r].value,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=s[r].value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet}else o.isNotDistinguish=!1;if(o.isNotDistinguish){t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.addressStreet="请选择街道",o.streetTextColor="text-red"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},s.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],
o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("ADDADDRESSService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,areaId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,isDefault:o.isDefault};return e({method:"POST",url:t.getUrl("ADDADDRESS_INIT"),params:i})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("AddPrizeAddressController",["$ionicPlatform","$ionicPopup","$scope","$stateParams","$rootScope","AddressPrizeService","CommonAddressService","PopupService","$timeout","$ionicHistory","$state","$ionicModal","$http","$ionicScrollDelegate","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){o.textOne="",o.textTwo="",o.textThree="",o.textFour="",o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.textColor="color-text-s",o.streetTextColor="color-text-s",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.panGoOn=!1,o.panOrgoOn=!1,o.updateResult=!0,o.conserve=!1,o.regionTrue=!1,o.updateContent="",o.isNotDistinguish=!1,o.isPosition=!1,o.isChangeOrDefault=0,o.isDef=!1,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""};var f=window.innerHeight,h=f-373+"px";o.contentHeight={height:h};var v=f-250+"px";o.contentHeightStreet={height:v},o.addressTitle="配送至",o.dataAdd=null,o.dataAddStreet=null,o.flag="CHANGEADDRESS_LOCATION",o.defaultValue=null,o.hasChanged=!1,o.level=0,o.adsMsgChange={},o.adsMsg={},o.init=function(){o.conserve=!1,o.addressRegionName="所在地区",o.addressStreet="街道",0==o.panGoOn?(o.addressRegionName="所在地区",o.defaultImage="img/ic_select.png",o.defaultHide=!0,o.textColor="color-text-s",o.streetTextColor="color-text-s"):(o.textColor="color-text-l",o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree),o.panGoOn=!1},o.$on("$ionicView.beforeLeave",function(e,t){o.watch()}),o.$on("$ionicView.beforeEnter",function(){o.gameId=i.gameId,o.uuid=i.uuid,o.prizeId=i.prizeId,o.isPosition=!1,o.isNotDistinguish=!1,o.isChangeOrDefault=0,o.address.address="",o.dataAddStreet=[],o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceTop=0,o.cityTop=0,o.areaTop=0,o.finish=!1,o.textColor="color-text-s",o.streetTextColor="color-text-s",o.address.consignee="",o.address.mobile="",o.watch=o.$watch("finish",function(e,t){e&&g.$getByHandle("mainScroll").scrollTo(0,o.provinceTop)}),o.isIos=!!ionic.Platform.isIOS(),o.init(),o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0),o.$on("$destroy",function(){o.addressModal.remove(),o.addressModalStreet.remove()})}),e.on("resume",function(){o.addressModal.hide(),o.addressModalStreet.hide()}),o.goBack=function(){o.panGoOn=!1,l.goBack()},o.$watch("address",function(){o.address.mobile=o.address.mobile.replace(/([^0-9])|(-)/g,"")},!0),o.selectPhone=function(){window.cordova?window.emc.addAddressBook(function(e){var t=JSON.parse(e);o.$apply(function(){o.address.consignee=t.name,o.address.mobile=t.number.replace(/([^0-9])|(-)/g,"")})},function(){t.alert({template:"获取通讯录失败",okText:"知道了"})}):t.alert({template:"请下载客户端APP实现此功能！",okText:"知道了"})},o.StreetTop=function(){o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="","所在地区"!=o.addressRegionName?o.addressModalStreet.show():(r.showToast("请选择所在地"),o.addressStreet="街道",o.streetTextColor="color-text-s")},o.addressTop=function(){o.addressTipFlag=!1,o.provinceTop=0,o.nowLevel=0,o.nowLevelIndex=[-1,-1,-1],o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.addressModal.show(),o.dataAdd=null,o.defaultValue=null,o.selectProvince="",o.selectCity="",o.selectArea="",o.addressInit(o.dataAdd,o.defaultValue,"CHANGEADDRESS_LOCATION",0)},o.addressInit=function(e,t,i,s){if(o.addressTipFlag=!1,g.$getByHandle("mainScroll").scrollTop(),o.addressTitle="配送至",o.defaultValue=e?JSON.parse(e):{},o.level=s,t){o.dataAdd=JSON.parse(t),o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var a=0;a<o.nowLevelIndex.length;a++)a>o.nowLevel&&(o.nowLevelIndex[a]=-1)}else o.finish=!1,n.getLocationList("",0).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,o.finish=!0,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel;for(var t=(JSON.stringify(o.defaultValue),JSON.stringify(o.dataAdd),0);t<o.nowLevelIndex.length;t++)t>o.nowLevel&&(o.nowLevelIndex[t]=-1)}).error(function(e){r.showToast("获取地址信息失败！")})},o.bottomBorder={"border-bottom":"2px solid red"},o.provinceFlag=!1,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!1,o.cityDis=!1,o.areaDis=!1,o.provinceSel=function(){o.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),o.selectCity="",o.selectArea="",o.provinceFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!1,o.areaDis=!1},o.goSelectStreet=ionic.Utils.debounce(function(e,t){o.level=o.level-1,o.addressStreet=t.text,o.streetMsg=t.text,o.isChangeOrDefault=3,o.isDef=!0,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.addChangeAddress.streetId=t.value,o.positionAddress.streetId=t.value,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet,o.addressModalStreet.hide(),"街道"==o.addressStreet?o.streetTextColor="color-text-s":o.streetTextColor="color-text-l"});var S=!1;o.goSelect=ionic.Utils.debounce(function(e,t){for(var i=0;i<o.nowLevelIndex.length;i++)i>o.nowLevel&&(o.nowLevelIndex[i]=-1);o.dataAdd="",o.nowLevelIndex[o.nowLevel]=e;var t=arguments[1],e=arguments[0];if(o.level=o.level-1,o.defaultValue["text"+o.level]=t.text,o.defaultValue["value"+o.level]=t.value,o.hasChangeArr=o.defaultValue,o.level>-2)-1==o.level&&(o.selectProvince=t.text,o.provinceIndex=e,o.provinceFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.provinceTop=g.$getByHandle("mainScroll").getScrollPosition().top,o.nowLevel=o.level,o.nowLevel=-1*o.nowLevel),ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){1==ah&&(areaValueCity=t.value),o.dataAdd=e.data,o.addressTipFlag=!1;var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.citySel=function(){o.level=o.levelArea,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",n.getLocationList(areaValueCity,1).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,-1),o.selectArea="",o.cityFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,g.$getByHandle("mainScroll").scrollTo(0,o.cityTop)}).error(function(e){r.showToast("获取地址信息失败！")})};else if(o.level>-4&&-3!=o.level)o.selectCity=o.defaultValue["text-2"],o.provinceFlag=!1,o.cityFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!1,o.selectArea=t.text,o.addressStreet="街道",o.textColor="color-text-l",o.cityTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,n.getLocationList(t.value,ah).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1,o.areaSel=function(){o.addressTip="正在获取地址信息...",o.addressTipFlag=!0,o.dataAdd="",o.level=o.levelArea,n.getLocationList(areaValue,2).success(function(e){o.dataAdd=e.data,o.addressTipFlag=!1;var t=JSON.stringify(o.defaultValue),i=JSON.stringify(o.dataAdd);o.addressInit(t,i,o.flag,o.level),g.$getByHandle("mainScroll").scrollTo(0,o.areaTop),o.areaFlag=!0,o.selectFlag=!1,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0}).error(function(e){r.showToast("获取地址信息失败！")})};else if(-3==o.level)o.addressModal.hide(),o.regionTrue=!0,o.isChangeOrDefault=4,o.streetTextColor="color-text-s",o.streetTrue=!0,o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=o.defaultValue["text-1"],o.textTwo=o.defaultValue["text-2"],o.textThree=o.defaultValue["text-3"],o.address.provinceId=o.defaultValue["value-1"],o.address.cityId=o.defaultValue["value-2"],o.address.areaId=o.defaultValue["value-3"],o.address.regionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addressRegionName=o.textOne+" "+o.textTwo+" "+o.textThree,o.addChangeAddress={provinceId:o.defaultValue["value-1"],cityId:o.defaultValue["value-2"],areaId:o.defaultValue["value-3"],streetId:0,pca:o.textOne+" "+o.textTwo+" "+o.textThree,regionName:""},o.selectArea=t.text,o.cityFlag=!1,o.areaFlag=!1,o.selectFlag=!0,o.provinceDis=!0,o.cityDis=!0,o.areaDis=!0,o.areaTop=g.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*o.level,n.getLocationList(t.value,ah).success(function(e){o.dataAddStreet=e.data,2==ah&&(areaValue=t.value);var i=JSON.stringify(o.defaultValue),s=JSON.stringify(o.dataAdd);o.addressInit(i,s,o.flag,o.level)}).error(function(e){r.showToast("获取地址信息失败！")}),o.levelArea=o.level,o.levelArea=o.levelArea+1;else{if(S)return;c(function(){S=!1},1500),s.$broadcast(o.flag,o.defaultValue),S=!0,o.closeAddressModal()}},300),u.fromTemplateUrl("templates/common/CommonLocation.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModal=e}),u.fromTemplateUrl("templates/common/CommonLocationStreet.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.addressModalStreet=e}),o.closeAddressModal=function(){o.addressModal.hide(),o.addressModalStreet.hide()},o.preservation=function(){o.positionCommonFun=function(){o.address.provinceId=o.positionAddress.provinceId,o.address.cityId=o.positionAddress.cityId,o.address.areaId=o.positionAddress.areaId,o.address.streetId=o.positionAddress.streetId,o.address.regionName=o.positionAddress.regionName},o.newAddAddress=function(){o.address.provinceId=o.addChangeAddress.provinceId,o.address.cityId=o.addChangeAddress.cityId,o.address.areaId=o.addChangeAddress.areaId,o.address.streetId=o.addChangeAddress.streetId,o.address.regionName=o.addChangeAddress.regionName},o.isPosition?o.positionCommonFun():o.newAddAddress(),n.doInit(o.address,o.gameId,o.uuid,o.prizeId).success(function(e,t,i,n){1==e.success?(o.address={consignee:"",provinceId:"",cityId:"",areaId:"",streetId:"",regionName:"",mobile:"",address:"",isDefault:"0"},o.addressRegionName="",s.addressStr=void 0,o.isChangeOrDefault=0,o.addChangeAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.positionAddress={provinceId:0,cityId:0,areaId:0,streetId:0,pca:"",regionName:""},o.panGoOn=!1,r.showToast("添加成功"),setTimeout(function(){o.$ionicGoBack()},1e3)):o.isNotDistinguish||o.showResult("添加失败")})},o.doChange=function(){return""==o.address.consignee?void r.showToast("收货人不能为空"):/^([\u4E00-\u9FA5]|\w)*$/.exec(o.address.consignee)?o.address.consignee.length>10||o.address.consignee.length<2?void r.showToast("收货人为2-10个字符"):""==o.address.mobile?void r.showToast("手机号码不能为空"):/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.exec(o.address.mobile)?"所在地区"==o.addressRegionName?void r.showToast("请选择所在地区"):"请选择街道"==o.addressStreet?void r.showToast("请选择街道"):/^.[^&<>]{2,29}$/.exec(o.address.address)?void(o.conserve?o.preservation():"街道"==o.addressStreet?AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({city:"全国"});o.allAddress=o.address.regionName+o.address.address,e.getLocation(o.allAddress,function(i,s){if("complete"==i&&s.geocodes.length){var n=s.geocodes[0].location.lat,a=s.geocodes[0].location.lng,r=[a,n];e.getAddress(r,function(e,i){if("complete"===e&&"OK"===i.info){var s=i.regeocode.addressComponent;o.textThree==s.district?m.getAddressId(s.province,s.city,s.district,s.township,s.adcode).success(function(e){if(null!=e.data&&void 0!=e.data&&0!=e.data.length){o.township=s.township,o.addressStreet=o.township,o.addChangeAddress.streetId=e.data.streetId,o.addChangeAddress.regionName=o.addChangeAddress.pca+" "+o.addressStreet,o.positionAddress.streetId=e.data.streetId,o.positionAddress.regionName=o.positionAddress.pca+" "+o.addressStreet;t.confirm({template:"根据国家最新行政区域划分，我们识别到您的地址对应街道为'"+o.township+"',是否保存?",cancelText:"修改",okText:"保存"}).then(function(e){e?(o.conserve=!1,o.isOkChange=!0,o.addressStreet=o.township,o.preservation()):(o.isOkChange=!1,o.conserve=!0)})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}).error(function(e){o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}):o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})}else t.alert({template:"获取地址失败，请稍后重试！",okText:"确定"})})}else o.$apply(function(){o.streetTextColor="text-red",o.addressStreet="请选择街道"})})}):o.preservation()):void r.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void r.showToast("手机号码不正确"):void r.showToast("收货人不能包括特殊字符")},s.$on("CHANGEADDRESS_LOCATION",function(e,t){o.panGoOn=!0,o.panOrgoOn=!0,o.textOne=t["text-1"],o.textTwo=t["text-2"],o.textThree=t["text-3"],o.textFour=t["text-4"],o.address.provinceId=t["value-1"],o.address.cityId=t["value-2"],o.address.areaId=t["value-3"],o.address.streetId=t["value-4"],o.textColor="color-text-l",o.streetTextColor="color-text-l",o.init()}),o.showResult=function(e){o.updateContent=e,o.updateResult=!1,c(function(){o.updateResult=!0},1e3)}}]),APP.service("AddressPrizeService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n){var a={consignee:o.consignee,provinceId:o.provinceId,cityId:o.cityId,regionId:o.areaId,streetId:o.streetId,regionName:o.regionName,mobile:o.mobile,address:o.address,gameId:i,uuid:s,prizeId:n};return e({method:"POST",url:t.getGameUrl("GAME_HAVE_PRIZE"),params:a})},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)}}]),APP.controller("AddressController",["$ionicHistory","$ionicPopup","ChangeAddressService","$scope","AddressService","$state","$stateParams","$timeout","PopupService","$rootScope",function(e,t,o,i,s,n,a,r,c,l){i.image=[],i.addressMap=[],i.myData=[],i.updateResult=!0,i.updateContent="",i.goBack=function(){e.goBack()},i.init=function(){s.getAddressList().success(function(e,t,o,s){if(e.success){i.myData=e.data.addressList;for(var n=0,a=[],r=!1,c=0;c<e.data.addressList.length;c++)if("1"==e.data.addressList[c].isDefault){n=c,r=!0;break}a[0]=e.data.addressList[n];for(var d=0;d<n;d++)a[d+1]=e.data.addressList[d];for(var u=n+1;u<e.data.addressList.length;u++)a[u]=e.data.addressList[u];i.addressMap=a;for(var p=0;p<i.addressMap.length;p++)i.image[p]=l.imgBaseURL+"img/ic_check.png";r&&(i.image[0]=l.imgBaseURL+"img/ic_select.png")}})},i.setDefault=function(e){var t=i.addressMap[e];o.setDefaultAddr(t.id).success(function(e,t,o,s){1==e.success?i.init():i.showResult("修改失败")})},i.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?i.isIosAndInApp=!0:i.isIosAndInApp=!1,window.cordova?i.isApp=!0:i.isApp=!1,i.isIosAndInApp&&(i.iosStyleOne={padding:"64px 0 90px 0"},i.iosStyleTwo={top:"20px"}),i.isApp?i.bottomDivHeight={height:"40px"}:i.bottomDivHeight={height:"120px"},i.init()}),i.goToChange=function(e){var t=JSON.stringify(i.addressMap[e]);n.go("changeAddress",{addressData:t})},i.goToDelete=function(e){t.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(t){if(t){var o=i.addressMap[e].id;s.deleteAddr(o).success(function(e,t,o,s){e.success?(c.showToast("删除成功"),setTimeout(function(){i.init()},1e3)):c.showToast("删除失败")})}})},i.goToConfirm=function(e){"YES"==a.comeFromOrder&&s.chooseLocation(e.id).success(function(e,t,o,s){1==e.success?i.$ionicGoBack():c.showToast("更改收货物地址失败,请重新选择")})}}]),APP.service("AddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e.get(t.getUrl("ADDRESS_INIT"))},this.deleteAddr=function(o){return e.get(t.getDeteleAddr("DETELEADDR_INIT",o))},this.chooseLocation=function(o){var i={addrId:o};return e.get(t.getUrl("CHOOSE_ADDR"),i)}}]),APP.controller("BatchDeleteAddressController",["BatchAddressService","$ionicHistory","$ionicPopup","$scope","PopupService","$rootScope",function(e,t,o,i,s,n){i.goBack=function(){t.goBack()},i.init=function(){i.image=[],i.chooseAddressNum=0,e.getAddressList().success(function(e,t,o,s){if(e.success){i.addressArray=e.data.addressList;for(var n=0,a=i.addressArray.length;n<a;n++)i.image[n]="img/ic_check.png"}})},i.selectDeleteAddress=function(e){-1!=i.image[e].indexOf("check")?(i.image[e]="img/ic_select.png",i.chooseAddressNum++):(i.image[e]="img/ic_check.png",i.chooseAddressNum--),i.chooseAddressNum==i.image.length?i.isSelectAllAddress=!0:i.isSelectAllAddress=!1},i.selectAllAddress=function(){if(i.isSelectAllAddress){for(var e=0,t=i.addressArray.length;e<t;e++)i.image[e]="img/ic_check.png";i.chooseAddressNum=0,i.isSelectAllAddress=!1}else{for(var e=0,t=i.addressArray.length;e<t;e++)i.image[e]="img/ic_select.png";i.isSelectAllAddress=!0,i.chooseAddressNum=i.image.length}},i.batchDelete=function(){if(0==i.chooseAddressNum)return void s.showToast("请选择要删除的地址");o.confirm({template:"您确认要删除吗?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(o){if(o){for(var s="",n=[],a=0,r=i.image.length;a<r;a++)-1!=i.image[a].indexOf("select")&&n.push(i.addressArray[a].id);s=n.join(",");var c={addrIds:s};e.batchDelete(c).success(function(e){if(e.success){if(i.isSelectAllAddress)return void t.goBack();i.init()}})}})},i.$on("$ionicView.beforeEnter",function(){window.cordova&&-1!=ionic.Platform.platform().indexOf("ios")?i.isIosAndInApp=!0:i.isIosAndInApp=!1,window.cordova?i.isApp=!0:i.isApp=!1,i.isIosAndInApp&&(i.iosStyleOne={padding:"64px 0 90px 0"},i.iosStyleTwo={top:"20px"}),i.isApp?i.bottomDivHeight={height:"40px"}:i.bottomDivHeight={height:"120px"},i.chooseAddressNum=0,i.isSelectAllAddress=!1,i.init()})}]),APP.service("BatchAddressService",["$http","UrlService",function(e,t){this.getAddressList=function(){return e.get(t.getUrl("ADDRESS_INIT"))},this.batchDelete=function(o){return e.get(t.getUrl("BATCH_DELETE_ADDRESS"),o)}}]),APP.controller("ChangeAddressController",["$scope","$stateParams","$rootScope","ChangeAddressService","CommonAddressService","GoodsService","PopupService","$timeout","$ionicModal","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d){var u=JSON.parse(t.addressData);e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.address={acceptor:u.consignee,mobile:u.mobile,detailAds:u.address,regionName:u.regionName,addrId:u.id,provinceId:u.provinceId,cityId:u.cityId,areaId:u.regionId,streetId:u.streetId},e.panGoOn=!1,e.updateResult=!0,e.updateContent="";var p=window.innerHeight,g=p-373+"px";e.contentHeight={height:g},e.addressTitle="配送至",e.dataAdd=null,e.flag="CHANGEADDRESS_LOCATION",e.defaultValue=null,e.level=0;var m,f,h={};e.panGoOn=!1,e.updateResult=!0,e.updateContent="",e.init=function(){var o=JSON.parse(t.addressData);0==e.panGoOn?e.address={acceptor:o.consignee,mobile:o.mobile,detailAds:o.address,regionName:o.regionName,addrId:o.id,provinceId:o.provinceId,cityId:o.cityId,areaId:o.regionId,streetId:o.streetId}:e.address.regionName=e.textOne+" "+e.textTwo+" "+e.textThree+" "+e.textFour,e.panGoOn=!1},e.$on("$ionicView.beforeLeave",function(t,o){e.watch()}),e.$on("$ionicView.beforeEnter",function(){e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceTop=0,e.cityTop=0,e.areaTop=0,e.finish=!1,e.watch=e.$watch("finish",function(t,o){t&&d.$getByHandle("mainScroll").scrollTo(0,e.provinceTop)}),e.init(),e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0),e.$on("$destroy",function(){e.addressModal.remove()})}),e.setDefault=function(){i.setDefaultAddr(e.address.addrId).success(function(t,o,i,s){1==t.success?e.$ionicGoBack():e.showResult("修改失败")})},e.addressTop=function(){e.addressTipFlag=!1,e.provinceTop=0,e.nowLevel=0,e.nowLevelIndex=[-1,-1,-1,-1],e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.addressModal.show(),e.dataAdd=null,e.defaultValue=null,e.selectProvince="",e.selectCity="",e.selectArea="",e.addressInit(e.dataAdd,e.defaultValue,"CHANGEADDRESS_LOCATION",0)},e.addressInit=function(t,o,i,s){if(e.addressTipFlag=!1,d.$getByHandle("mainScroll").scrollTop(),e.addressTitle="配送至",e.defaultValue=t?JSON.parse(t):{},e.level=s,o){e.dataAdd=JSON.parse(o),e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var r=0;r<e.nowLevelIndex.length;r++)r>e.nowLevel&&(e.nowLevelIndex[r]=-1)}else e.finish=!1,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",n.getLocationList("",0).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,e.finish=!0,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel;for(var o=(JSON.stringify(e.defaultValue),JSON.stringify(e.dataAdd),0);o<e.nowLevelIndex.length;o++)o>e.nowLevel&&(e.nowLevelIndex[o]=-1)}).error(function(e){a.showToast("获取地址信息失败！")})},e.bottomBorder={"border-bottom":"2px solid red"},e.provinceFlag=!1,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!1,e.cityDis=!1,e.areaDis=!1,e.provinceSel=function(){e.addressInit(null,null,"CHANGEADDRESS_LOCATION",0),e.selectCity="",e.selectArea="",e.provinceFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!1,e.areaDis=!1};var v=!1;e.goSelect=ionic.Utils.debounce(function(t,i){for(var s=0;s<e.nowLevelIndex.length;s++)s>e.nowLevel&&(e.nowLevelIndex[s]=-1);e.dataAdd="",e.nowLevelIndex[e.nowLevel]=t;var i=arguments[1],t=arguments[0];if(e.level=e.level-1,e.defaultValue["text"+e.level]=i.text,e.defaultValue["value"+e.level]=i.value,e.level>-2)-1==e.level&&(e.selectProvince=i.text,e.provinceIndex=t,e.provinceFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.provinceTop=d.$getByHandle("mainScroll").getScrollPosition().top,e.nowLevel=e.level,e.nowLevel=-1*e.nowLevel),ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){1==ah&&(f=i.value),e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){a.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.citySel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(f,1).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,-1),e.selectArea="",e.cityFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,d.$getByHandle("mainScroll").scrollTo(0,e.cityTop)}).error(function(e){a.showToast("获取地址信息失败！")})};else if(e.level>-4)e.selectCity=e.defaultValue["text-2"],e.provinceFlag=!1,e.cityFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!1,-3==e.level?(e.selectArea=i.text,e.cityFlag=!1,e.areaFlag=!1,e.selectFlag=!0,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0,e.areaTop=d.$getByHandle("mainScroll").getScrollPosition().top):e.cityTop=d.$getByHandle("mainScroll").getScrollPosition().top,ah=-1*e.level,e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,n.getLocationList(i.value,ah).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1,2==ah&&(m=i.value);var o=JSON.stringify(e.defaultValue),s=JSON.stringify(e.dataAdd);e.addressInit(o,s,e.flag,e.level)}).error(function(e){a.showToast("获取地址信息失败！")}),e.levelArea=e.level,e.levelArea=e.levelArea+1,e.areaSel=function(){e.addressTip="正在获取地址信息...",e.addressTipFlag=!0,e.dataAdd="",e.level=e.levelArea,n.getLocationList(m,2).success(function(t){e.dataAdd=t.data,e.addressTipFlag=!1;var o=JSON.stringify(e.defaultValue),i=JSON.stringify(e.dataAdd);e.addressInit(o,i,e.flag,e.level),d.$getByHandle("mainScroll").scrollTo(0,e.areaTop),e.areaFlag=!0,e.selectFlag=!1,e.provinceDis=!0,e.cityDis=!0,e.areaDis=!0}).error(function(e){a.showToast("获取地址信息失败！")})};else{if(v)return;r(function(){v=!1},1500),o.$broadcast(e.flag,e.defaultValue),v=!0,e.closeAddressModal()}},300),e.getPosition=function(){if("定位中···"!=o.globalConstant.autoPosition){h=s.getAddressInfo();var t=h.regionName+"/"+h.streetName;i.addAddress(h.provinceId,h.cityId,h.areaId,t,h.streetId).success(function(){var t={"text-1":h.provinceName,"text-2":h.cityName,"text-3":h.regionName,"text-4":h.streetName,"value-1":h.provinceId,"value-2":h.cityId,"value-3":h.areaId,"value-4":h.streetId};o.$broadcast(e.flag,t),e.addressModal.hide()})}},c.fromTemplateUrl("templates/common/CommonLocation.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.addressModal=t}),e.closeAddressModal=function(){e.addressModal.hide()},e.doChange=function(){return""==e.address.acceptor?void a.showToast("收货人不能为空"):e.address.acceptor.length>10||e.address.acceptor.length<2?void a.showToast("收货人为2-10个字符"):""==e.address.mobile?void a.showToast("手机号码不能为空"):e.globalConstant.mobileNumberRegExp.exec(e.address.mobile)?"所在区域"==e.address.regionName?void a.showToast("请选择所在区域"):/^.[^&<>]{2,29}$/.exec(e.address.detailAds)?void i.changeAddr(e.address).success(function(t,o,i,s){t.success?e.$ionicGoBack():e.showResult("修改失败")}):void a.showToast("详细地址为3～30个字符，且不能包含特殊字符！"):void a.showToast("手机号码不正确")},o.$on("CHANGEADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.address.provinceId=o["value-1"],e.address.cityId=o["value-2"],e.address.areaId=o["value-3"],e.address.streetId=o["value-4"],e.init()}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,r(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeAddressService",["$http","UrlService",function(e,t){this.changeAddr=function(o){var i={addrId:o.addrId,consignee:o.acceptor,mobile:o.mobile,regionName:o.regionName,provinceId:o.provinceId,cityId:o.cityId,areaId:o.areaId,streetId:o.streetId,address:o.detailAds};return e({method:"POST",url:t.getUrl("CHANGEADDR_INIT"),params:i})},this.setDefaultAddr=function(o){var i={addrId:o};return e.get(t.getUrl("SETDEFAULT_INIT"),i)},this.getLocationList=function(o,i){var s={parentId:o,regionType:i};return e.get(t.getUrl("GET_REGION_BY_ID_TYPE"),s)},this.addAddress=function(o,i,s,n,a){var r={provinceId:o,cityId:i,areaId:s,regionName:n,streetId:a,noLoading:!0};return e.get(t.getUrl("ADDADDRESSSELECTION_INIT"),r)}}]),APP.controller("BankCardController",["$localstorage","$scope","HomePageService","$ionicHistory","InAppBrowserService","UrlService","$state","bankCardService","$ionicScrollDelegate","EasyConnectService",function(e,t,o,i,s,n,a,r,c,l){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){null==i.viewHistory().backView?a.go("personnalCenter"):"shopRevenue"==i.viewHistory().backView.stateName||"paymentxyz"==i.viewHistory().backView.stateName?i.goBack():a.go("personnalCenter")},t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.clickBind=function(){if(!window.device)return void window.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.bind().success(function(o,i,a,r){if(window.device&&window.device.hasNewBrowser){var c=ionic.Platform.isAndroid();if(c){var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}else{var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}else{var c=ionic.Platform.isAndroid();if(c){var d=cordova.InAppBrowser.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");d.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){d.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),d.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&d.close()}),d.addEventListener("exit",function(e){t.init()})}else{var l=s.open(n.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));l.addEventListener("exit",function(e){t.init()})}}})},t.init=function(){o.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?t.iso2o=!0:t.iso2o=!1}),r.doInit().success(function(e){e.success&&(0==e.data.isBindKJT?t.isBindKjt=!0:t.isBindKjt=!1,0==e.data.isBindYHK?t.isBindBank=!0:t.isBindBank=!1,t.hasBindKJT=e.data.isBindKJT,t.hasBindYHK=e.data.isBindYHK,t.backGroundOrImg=e.data.BankCardList,t.backGroundOrKjt=e.data.kjtAccount)})},t.$on("$ionicView.beforeEnter",function(){c.scrollTop(),t.backGroundOrKjt="",t.backGroundOrImg="",t.isBindKjt=!1,t.isBindBank=!1,t.init()})}]),APP.service("bankCardService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("HAS_BANK_LIST_NEW"))}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("bankCardDetailController",["$localstorage","$scope","$ionicHistory","$ionicPopup","$ionicScrollDelegate","$stateParams","bankCardDetialService","$state","UrlService","EasyConnectService","InAppBrowserService","PopupService","$interval",function(e,t,o,i,s,n,a,r,c,l,d,u,p){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.goBack=function(){r.go("bankCard")};var g="";t.nameKjt="",t.isKJT=!1,t.backGroundOrPic={"03020000":{img:"1CITIC",background:"#F3515E",name:"中信银行"},"01030000":{img:"2ABC",background:"#47D08F",name:"农业银行"},"01020000":{img:"3ICBC",background:"#F3515E",name:"工商银行"},"01050000":{img:"4CCB",background:"#39A8FF",name:"建设银行"},"03080000":{img:"5CMB",background:"#F3515E",name:"招商银行"},"03180000":{img:"6SZPAB",background:"#FF8F24",name:"平安银行"},"01040000":{img:"7BOC",background:"#F3515E",name:"中国银行"},"03090000":{img:"8CIB",
background:"#39A8FF",name:"兴业银行"},"03100000":{img:"9SPDB",background:"#39A8FF",name:"浦发银行"},"03050000":{img:"10CMBC",background:"#47D08F",name:"民生银行"},"03040000":{img:"11HXB",background:"#F3515E",name:"华夏银行"},"03030000":{img:"12CEB",background:"#BF70D7",name:"光大银行"},"01000000":{img:"13PSBC",background:"#47D08F",name:"邮储银行"},"03010000":{img:"14COMM",background:"#39A8FF",name:"交通银行"},"04031000":{img:"15BCCB",background:"#F3515E",name:"北京银行"},"03060000":{img:"16GDB",background:"#F3515E",name:"广发银行"},"03110000":{img:"17EGBANK",background:"#FF8F24",name:"恒丰银行"},"04233310":{img:"18HCCB",background:"#39A8FF",name:"杭州银行"},"04083320":{img:"19NBCB",background:"#FF8F24",name:"宁波银行"},88888888:{img:"20KJT",background:"#39A8FF",name:"快捷通"}},t.VCodeTips="获取验证码",t.canGetVcode=!0,t.userInfo={verificationCode:""},t.getVCode=function(){t.canGetVcode&&a.fastLoginCaptchaNew(g).success(function(e){if(e.success){u.showToast("您正在操作解绑银行卡，短信验证码已经发送到您绑定银行卡时的预留银行手机号"+t.bankCardDetailList.phoneNo+"中，请查收并进行验证。"),t.canGetVcode=!t.canGetVcode;var o=60;t.timer=p(function(){o-1<0?(t.VCodeTips="获取验证码",p.cancel(t.timer),t.canGetVcode=!0):(o--,t.VCodeTips=o+"s后可重发 ")},1e3)}else u.showToast(e.message)})},t.unBindBank=function(){if(t.userInfo.verificationCode.length<=0)u.showToast("请输入短信验证码");else{i.confirm({template:"确认解除绑定该银行卡?",cancelText:"否",cssClass:"confirmDelete",okText:"是"}).then(function(e){e&&a.deleteBank(g,t.userInfo.verificationCode).success(function(e){e.success?(u.showToast("您的银行卡已经解绑成功！"),setTimeout(function(){r.go("bankCard")},2e3)):u.showToast(e.message)})})}},t.clickUnBind=function(){if(!window.device)return void window.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");l.unBlind().success(function(t,o,i,s){var n=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(n){var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}else{var n=ionic.Platform.isAndroid();if(n){var l=cordova.InAppBrowser.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");l.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&$timeout(function(){l.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),l.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&l.close()}),l.addEventListener("exit",function(e){r.go("bankCard")})}else{var a=d.open(c.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){r.go("bankCard")})}}})},t.init=function(){a.doInit(g).success(function(e){e.success&&(t.bankCardDetailList=e.data)})},t.$on("$ionicView.beforeEnter",function(){s.scrollTop(),g="",t.nameKjt="",t.bankCardDetailList,g=n.cardNoShow,t.nameKjt=n.nameKjt,""!=t.nameKjt?(t.isKJT=!0,t.bankCardDetailList=g):(t.isKJT=!1,t.init())})}]),APP.service("bankCardDetialService",["$http","UrlService",function(e,t){this.doInit=function(o){var i={cardNo:o};return e.get(t.getUrl("BANK_LIST_DETAIL_NEW"),i)},this.deleteBank=function(o,i){var s={cardNo:o,captcha:i};return e.get(t.getUrl("BANK_DELETE_NEW"),s)},this.fastLoginCaptchaNew=function(o){var i={cardNo:o};return e.get(t.getUrl("BANK_DELETE_CAPTCHA"),i)}}]),APP.controller("bankSupportController",["$scope","$ionicHistory","$ionicPopup",function(e,t,o){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}]}]),APP.controller("chooseTheBankController",["$scope","$ionicHistory","$ionicPopup","$state","$rootScope",function(e,t,o,i,s){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(e.paddingtopClass={"margin-top":"16px"},e.paddingtopClasscontent={top:"60px"}):(e.paddingtopClass={"margin-top":"0px"},e.paddingtopClasscontent={top:"44px"}),e.differentStyleHas=-1,e.differentStyle={background:"#eee"},e.goBack=function(){t.goBack()},e.logoImgs=[{img:"1CITIC",code:"03020000",name:"中信银行"},{img:"2ABC",code:"01030000",name:"农业银行"},{img:"3ICBC",code:"01020000",name:"工商银行"},{img:"4CCB",code:"01050000",name:"建设银行"},{img:"5CMB",code:"03080000",name:"招商银行"},{img:"6SZPAB",code:"03180000",name:"平安银行"},{img:"7BOC",code:"01040000",name:"中国银行"},{img:"8CIB",code:"03090000",name:"兴业银行"},{img:"9SPDB",code:"03100000",name:"浦发银行"},{img:"10CMBC",code:"03050000",name:"民生银行"},{img:"11HXB",code:"03040000",name:"华夏银行"},{img:"12CEB",code:"03030000",name:"光大银行"},{img:"13PSBC",code:"01000000",name:"邮储银行"},{img:"14COMM",code:"03010000",name:"交通银行"},{img:"15BCCB",code:"04031000",name:"北京银行"},{img:"16GDB",code:"03060000",name:"广发银行"},{img:"17EGBANK",code:"03110000",name:"恒丰银行"},{img:"18HCCB",code:"04233310",name:"杭州银行"},{img:"19NBCB",code:"04083320",name:"宁波银行"}],e.chooseBank=function(o,i,n){e.differentStyleHas=o,s.$broadcast("haveChooseBank",o,i,n),t.goBack()}}]),APP.controller("mentionCenterController",["$rootScope","$ionicPopup","$localstorage","$scope","HomePageService","$ionicHistory","bankCardService","mentionCenterService","$stateParams","$state","ShopRevenueService","EasyConnectService","UrlService","InAppBrowserService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m){function f(e){d.getAccountState(e).success(function(e){e.success&&(accountState=e.data)})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(i.paddingtopClass={"margin-top":"16px"},i.paddingtopClasscontent={top:"60px"}):(i.paddingtopClass={"margin-top":"0px"},i.paddingtopClasscontent={top:"44px"}),i.matchValue=0,i.account="",i.goBack=function(){null==n.viewHistory().backView?l.go("personnalCenter"):n.goBack()},i.backGroundOrPic={"03020000":{img:"1CITIC"},"01030000":{img:"2ABC"},"01020000":{img:"3ICBC"},"01050000":{img:"4CCB"},"03080000":{img:"5CMB"},"03180000":{img:"6SZPAB"},"01040000":{img:"7BOC"},"03090000":{img:"8CIB"},"03100000":{img:"9SPDB"},"03050000":{img:"10CMBC"},"03040000":{img:"11HXB"},"03030000":{img:"12CEB"},"01000000":{img:"13PSBC"},"03010000":{img:"14COMM"},"04031000":{img:"15BCCB"},"03060000":{img:"16GDB"},"03110000":{img:"17EGBANK"},"04233310":{img:"18HCCB"},"04083320":{img:"19NBCB"},88888888:{img:"20KJT"}},i.clickBank=function(e){i.matchValue=e},i.getCashNow=function(){r.getCash(i.backGroundOrKjt.memberKjtpayAccount,"KJT").success(function(e,o,i,s){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var n=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});n.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},i.withdraw=function(){if(2==accountState){var e="提现需要绑定快捷通，请点击确定去绑定快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.bind().success(function(e,t,s,n){if(window.device&&window.device.hasNewBrowser){var a=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){i.init()})}else{if(ionic.Platform.isAndroid()){var r=cordova.InAppBrowser.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");r.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){r.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),r.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&r.close()}),r.addEventListener("exit",function(e){i.init()})}else{var a=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));a.addEventListener("exit",function(e){i.init()})}}})}})}else if(3==accountState)i.getCashNow();else if(4==accountState){var e="提现需要实名认证快捷通，请点击确定去认证快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.realName().success(function(e,t,s,n){g.open(p.getUrl("KBIND_REALNAME")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){i.init()})})}})}else if(1==accountState){var e="提现需要激活快捷通，请点击确定去激活快捷通";m.showConfirm("",e,function(e){if(e){if(!window.device)return void window.open(p.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");d.activation().success(function(e,t,s,n){g.open(p.getUrl("KBIND_ACTIVATION")+"?flag="+o.get("sg_login_token_secret").substring(6)).addEventListener("exit",function(e){i.init()})})}})}},i.clickBind=function(){if(!window.device)return void window.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_self","location=yes");u.bind().success(function(e,t,s,n){if(window.device&&window.device.hasNewBrowser){var a=ionic.Platform.isAndroid();if(a){var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}else{var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}}else{var a=ionic.Platform.isAndroid();if(a){var c=cordova.InAppBrowser.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6),"_blank");c.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&$timeout(function(){c.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),c.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&c.close()}),c.addEventListener("exit",function(e){i.init()})}else{var r=g.open(p.getUrl("KBIND_INIT")+"?flag="+o.get("sg_login_token_secret").substring(6));r.addEventListener("exit",function(e){i.init()})}}})},i.mentionCenterBankNow=function(){r.getCash(i.backGroundOrImg.cardNoShow,"YHK").success(function(e,o,i,s){if(e.success)l.go("withdrawSuccess",{content:e.data.result});else if("未实名"==e.message){var n=t.confirm({template:"亲，请完成实名认证才行继续操作。",cancelText:"再想想",okText:"实名认证"});n.then(function(e){e&&l.go("trueAuthentication",{type:8})})}else m.showToast(e.message)})},i.init=function(){f(i.earningType),s.isWdHost().success(function(e){null==e.data.o2o||1==e.data.o2o?i.iso2o=!0:i.iso2o=!1}),a.doInit().success(function(e){e.success&&(i.hasBindKJT=e.data.isBindKJT,i.hasBindYHK=e.data.isBindYHK,i.backGroundOrImg=e.data.BankCardList,i.backGroundOrKjt=e.data.kjtAccount,i.hasBindYHK&&i.moneyHundred&&(i.matchValue=1))})},i.$on("$ionicView.beforeEnter",function(){i.earningType="B",i.account="",i.backGroundOrImg="",i.backGroundOrKjt="",i.canGetMount="",i.canGetMount=c.canAmount,e.canGetMount=c.canAmount,parseInt(i.canGetMount)>0?i.moneyNoone=!0:i.moneyNoone=!1,parseInt(i.canGetMount)>=1e3?i.moneyHundred=!0:i.moneyHundred=!1,i.hasBindKJT=!1,i.hasBindYHK=!1,i.init()})}]),APP.service("mentionCenterService",["$http","UrlService",function(e,t){this.getCash=function(o,i){var s={kjtAccount:o,paymentType:i};return e.get(t.getUrl("GETCASH_INIT"),s)}}]),APP.controller("historyTaskController",["$scope","$stateParams","ShareService",function(e,t,o){function i(e){for(var t in e)return!1;return!0}e.history="",e.isHistory=!1,e.loadData=function(){o.myHistoryShare().success(function(t){e.history=t.data,i(e.history)&&(e.isHistory=!0)}).error(function(){})},e.$on("$ionicView.beforeEnter",function(){e.isHistory=!1}),e.$on("$ionicView.enter",function(){e.loadData()})}]),APP.controller("MissionDetailController",["$q","$scope","UrlService","MissionDetailService","PopupService","$rootScope","$stateParams","CreditService","UserService",function(e,t,o,i,s,n,a,r,c){function l(t){var o=e.defer();return i.getQrCodeUrl(t).success(function(e){o.resolve(e.data)}),o.promise}function d(e,s,a){var r=t.missionContent.taskDestWithStatusVOs[0].id,l=c.getUser().mid,d=t.name,u=t.editableContent||t.editContent,p=(t.checkImg,t.imgArr&&t.imgArr.length>0?t.imgArr[0]:null);if(window.umeng){if(window.cordova&&cordova.plugins.clipboard.copy(u),-1==e&&window.umeng.iosPlatformShared(d,u,p,[p],0,a,function(){}),4==t.taskType){var g=t.configData.linkUrl;null==p&&(p="http://www.ehaier.com/mstatic/wd/v2/img/icons/ic_default_avatar.png"),0==e?window.umeng.shareToSina(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,u,p,g,0,null,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,u,p,g,0,null,function(){i.missionShare(t.taskType,"QQ").success(function(){t.init()})}):4==e&&window.umeng.shareToQzone(d,u,p,g,0,null,function(){i.missionShare(t.taskType,"QQ空间").success(function(){t.init()})})}else if(3==t.taskType){var m=t.configData.productTitle||t.configData.productName,f=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+l+"/"+l;0==e?window.umeng.shareToSina(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"QQ").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(t.configData.productName,m,p,f,0,a,function(){i.missionShare(t.taskType,r,"QQ空间").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})})}else 0==e?window.umeng.shareToSina(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"微博").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):1==e?window.umeng.shareToWechatSession(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"微信").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):2==e?window.umeng.shareToWechatTimeline(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"朋友圈").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):3==e?window.umeng.shareToQQ(d,u,p,null,2,a,function(){i.missionShare(t.taskType,r,"QQ").success(function(){n.shareSucBack=!0,t.$ionicGoBack()})}):4==e&&window.umeng.shareToQzone(d,u,p,null,2);t.showShare=!1}else alert("umeng undefined 只能在app分享")}t.hasQQ=!1,t.isIOS=ionic.Platform.isIOS(),t.UserTaskStatus=null,t.needTake="",t.hideblackCover=function(){t.showShare=!1},t.savaEditContent=function(e){t.editableContent=e},t.goBack=function(){t.$ionicGoBack()},t.output=function(e){},t.copyLinkUrl=function(){window.cordova?(cordova.plugins.clipboard.copy(t.linkUrl),s.showToastShort("复制成功")):s.showToast("请下载APP执行此操作")},t.copyText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),s.showToastWithTime("复制成功",2e3)):s.showToast("请下载APP执行此操作")},t.share=function(){if(window.umeng){if(window.cordova&&(cordova.plugins.clipboard.copy(t.editContent),n.hasShowPasteHint||(s.showToastWithTime("请直接粘贴分享文字内容",2e3),n.hasShowPasteHint=!0)),window.device&&window.device.hasNewShare)t.showShare=!t.showShare;else if(window.umeng){if(!t.missionContent)return void t.showPopup("网络连接失败，请稍后分享");var e=t.name,i=t.editContent,a=(t.checkImg,t.imgArr[0]),r=o.getShareLinkHeader()+"missionDetail/"+t.taskId;window.cordova&&cordova.plugins.clipboard.copy(i),window.umeng.share(e,i,a,r,2)}}else s.showAlert("只能在app分享","抱歉，只能在app分享")},t.shareToPlatform=function(e,i){var s=null,n="",a=c.getUser().mid;1==t.configData.qrcodeType||void 0==t.configData.qrcodeType?(s=t.missionContent.resultMap.qrCode,d(e,i,s)):2==t.configData.qrcodeType?(n=o.getShareLinkHeader()+"productDetail/"+t.configData.productId+"/"+t.configData.o2oType+"/"+t.configData.fromType+"/"+a+"/"+a,l(escape(n)).then(function(t){s=t,d(e,i,s)})):3==t.configData.qrcodeType?(n=o.getShareLinkHeader()+"register/0/"+t.missionContent.resultMap.promotionCode,l(escape(n)).then(function(t){s=t,d(e,i,s)})):0==t.configData.qrcodeType?d(e,i,null):d(e,i)},t.init=function(){i.getMissionDetail(t.taskId).success(function(e){e.success&&(t.UserTaskStatus=e.data.taskInfoWithStatusVO.userTaskStatus,t.needTake=e.data.taskInfoWithStatusVO.needTake,t.missionContent=e.data,t.xyzTaskDestId=t.missionContent.taskDestWithStatusVOs[0].id,t.name=t.missionContent.taskInfoWithStatusVO.name,t.taskType=t.missionContent.taskInfoWithStatusVO.taskType,t.isFinished=t.missionContent.taskInfoWithStatusVO.isFinished,t.configDataStr=t.missionContent.taskInfoWithStatusVO.configData,t.configData=JSON.parse(t.configDataStr),t.missionTitleArr=["","早安","晚安","分享商品","分享链接","士兵突击","图片分享","晒战绩"],t.missionTitle=t.missionTitleArr[t.taskType],t.time=new Date,t.editContent=t.missionContent.taskInfoWithStatusVO.content,t.taskAwards=t.missionContent.taskInfoWithStatusVO.taskAwards[0],0==t.taskAwards.awardType?t.taskAwardsContent=t.taskAwards.awardNum+"金币":1==t.taskAwards.awardType&&(t.taskAwardsContent=t.taskAwards.awardNum+"积分"),t.configData.imageUrls&&(t.imgArr=t.configData.imageUrls),t.configData.productName&&(t.productName=t.configData.productName),t.configData.linkUrl&&(t.linkUrl=t.configData.linkUrl))}).error(function(e){})},t.$on("$ionicView.beforeEnter",function(){t.taskId=a.taskId,t.checkImgIndex=[],t.checkImh=[],t.init()})}]),APP.service("MissionDetailService",["$http","UrlService","IMService",function(e,t,o){this.getMissionDetail=function(o){var i={taskId:o};return e.get(t.getUrl("MISSION_DETAIL"),i)},this.missionShare=function(i,s,n){var a={taskType:i,taskDestId:s,sharePlatform:n};return o.validateWebSocket(),e.get(t.getUrl("MISSION_SHARE"),a)},this.getQrCodeUrl=function(o){var i={requestUrl:o};return e.get(t.getUrl("GET_QRCODE"),i)}}]),APP.controller("taskShareController",["$scope","$state","ShareService","$rootScope","PopupService","$ionicHistory","UserService",function(e,t,o,i,s,n,a){function r(e){for(var t=[],o=[],i=e.length,s=i-1;s>=0;s--)5==e[s].taskType?o.push(e[s]):e[s].isFinished?t.push(e[s]):t.unshift(e[s]);return o.concat(t)}e.colorStyle1={color:"#030303"},e.colorStyle2={color:"blue"},e.share="";e.loadData=function(){o.myShare(0,100).success(function(t){e.share=r(t.data.rows)}).error(function(){})},e.goBack=function(){e.$ionicGoBack()},e.goShare=function(o,i,s){7==s?t.go("competition",{taskDestId:"",taskType:s,memberId:e.xyzMemberId}):t.go("missionDetail",{taskId:i})},e.shake=function(){alert("lover")},e.$on("$ionicView.enter",function(t,o){"back"==o.direction&&i.shareSucBack?(i.shareSucBack=!1,i.freshMission=!0,i.missionLists=function(){e.loadData()}):e.loadData()}),e.$on("$ionicView.beforeEnter",function(){e.xyzMemberId=a.getUser().mid})}]),APP.service("ShareService",["$http","UrlService",function(e,t){this.myShare=function(o,i){var s={startIndex:o,pageSize:i};return e.get(t.getUrl("SHAER_TASK"),s)},this.myHistoryShare=function(){return e.get(t.getUrl("SHAER_HISTORY_TASK"))}}]),APP.controller("PartnerController",["$ionicHistory","$scope","$state","PartnerService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v){function S(e,o,s,n,a,r,c){i.partnerTeamSearch({memberId:e,cascade:o,pageNumber:s,pageSize:n,sort:a,order:r,noLoading:c}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.pageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}function I(e,o,s,n,a,r,c,l){i.anthenSearch({memberId:e,cascade:o,isAuthenticated:s,pageNumber:n,pageSize:a,sort:r,order:c,noLoading:l}).success(function(e){if(1==e.success)if(null!=e.data.children&&void 0!=e.data.children&&0!=e.data.children.length){t.partnerChildren=t.partnerChildren.concat(e.data.children),t.authenticatedNum=e.data.authenticatedNum,t.UnAuthenticatedNum=e.data.unAuthenticatedNum,t.$broadcast("scroll.infiniteScrollComplete");var o=t.partnerChildren.length;t.hasmore=!(o===e.data.total),t.authpageNumber+=1}else t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1,t.partnerChildren=[]})}t.goBack=function(){t.$ionicGoBack()},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.arrowState=[p.imgBaseURL+"img/Group@2x.png",p.imgBaseURL+"img/Group1@2x.png",p.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["asc","desc"],"asc","asc"],t.title="partner"==d.title?"合伙人":"团队",t.authenIndex=0,t.hasmore=!1,t.front=d.front,t.shareStoreId=d.shareStoreId,t.isBuyer=m.getRole(),t.userId=r.getUser().mid;t.pagesort="startTime",t.order="asc",t.memberId=d.memberId,t.cascade="partner"!=d.title,t.isAuthenticated=!0,t.init=function(){t.pageNumber=1,t.pageSize=10,S(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!1)},t.authInit=function(){t.authpageNumber=1,t.pageSize=10,I(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!1)},t.$on("$ionicView.beforeEnter",function(e,o){f.scrollTop(),t.chooseIndex=0,t.partnerChildren=[],t.openStoreTime_index=1,t.authenIndex=0,t.memberId=d.memberId,t.init()}),t.loadMore=function(){1==t.chooseIndex?I(t.memberId,t.cascade,t.isAuthenticated,t.authpageNumber,t.pageSize,t.pagesort,t.order,!0):S(t.memberId,t.cascade,t.pageNumber,t.pageSize,t.pagesort,t.order,!0)},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e))if(f.scrollTop(),t.page=2,0==e){t.chooseIndex=e;t.openStoreTime_index;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.partnerChildren=[],t.pagesort="startTime",t.order=1==t.openStoreTime_index?"asc":"desc",t.init()}else 1==e?(t.authenIndex=0,t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.partnerChildren=[],t.order=0==t.openStoreTime_index?"asc":"desc",t.pagesort="isAuthenticated",t.isAuthenticated=!0,t.authInit()):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.partnerChildren=[],t.filterParams="saleDesc",t.order=0==t.openStoreTime_index?"desc":"asc",t.pagesort="teamLevelOrder",t.init())},t.chooseAnthen=function(e){0==e?(t.isAuthenticated=!0,t.pagesort="isAuthenticated",t.authenIndex=0,t.partnerChildren=[],t.authInit()):1==e&&(t.isAuthenticated=!1,t.pagesort="isAuthenticated",t.authenIndex=1,t.partnerChildren=[],t.authInit())}}]),APP.service("PartnerService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,i,s,n,a,r,c,l,d,u){var p={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:u};return e.get(t.getUrl("SEARCHGOODS_INIT"),p)},this.myStoreSearch=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)},this.partnerTeamSearch=function(o){var i=t.getUrl("GET_PARTNER_TEAM");return e.get(i,o)},this.anthenSearch=function(o){var i=t.getUrl("GET_PARTNER_TEAM");return e.get(i,o)}}]),APP.controller("VisiBroHisController",["$http","$scope","$cacheFactory","VisiBroHisService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","storeTeamOwnerService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$){t.chooseIndex=0,-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.init=function(){t.memberId=l.getUser().mid,t.userId=27483685,t.userId=s.userId,t.daysType=s.daysType,t.hasmore=!1,i.getVisitorBrowHis(t.userId,t.daysType).success(function(e){1==e.success&&(t.productList=e.data),e.data.productsList}).error(function(e){})},t.goBack=function(){t.$ionicGoBack()},t.showPopup=function(e){var t=d.show({template:e});u(function(){t.close()},1e3)},t.$on("$ionicView.beforeLeave",function(e,o){t.watch()}),t.$on("$ionicView.beforeEnter",function(e,o){t.userInfo=$.visitorInfo,t.init(),t.showComprehensiveSub=!1,t.nowLevel=0,t.nowLevelIndex=[-1,-1,-1,-1],t.finish=!1,t.watch=t.$watch("finish",function(e,o){e&&m.$getByHandle("mainScroll").scrollTo(0,t.provinceTop)}),t.isIos=!!ionic.Platform.isIOS(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.isIos1=!0:t.isIos1=!1,t.storeId=v.get("storeId",g.globalConstant.storeId),t.memberId=l.getUser().mid,t.buttonShow=!1,t.page=1,t.hasmore=!1})}]),APP.service("VisiBroHisService",["$http","UrlService",function(e,t){this.getVisitorBrowHis=function(o,i){var s={userId:o,daysType:i};return e.get(t.getUrl("GET_VISI_BROW_HIS"),s)}}]),APP.controller("AccountMessageController",["$scope","AccountMessageService","$rootScope","$state","$ionicActionSheet","$timeout","UserService","$ionicLoading","PlatformService","ionicDatePicker","$ionicPopup","LoginService","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p){function g(t){var o=t[0];if(window.FileReader){var i=new FileReader;i.readAsDataURL(o),i.onloadend=function(t){e.$apply(e.iconImage=t.target.result)}}}e.isPhone=!!window.cordova,e.userInfo={picTempFile:""},e.user={},e.sexMap=["保密","男","女"],e.accountMessage="",e.accountName="",e.accountEmail="",e.accountSexValue="0",e.accountSex=e.sexMap[e.accountSexValue],e.accountBirthday="",e.accountNumber="",e.iconImage=o.imgBaseURL+"img/ic_login_user.png",e.accountToken="",e.accountSessionId="",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.updateResult=!0,e.updateContent="",e.init=function(){e.user=a.getUser(),e.sexMap=["保密","男","女"],void 0!=e.user.avatarImageFileId&&(e.iconImage=e.user.avatarImageFileId),e.accountMessage=e.user.userName,e.accountName=e.user.nickName,e.accountSexValue=e.user.gender,e.accountSex=e.sexMap[e.accountSexValue],e.accountEmail=e.user.email,e.accountBirthday=e.user.birthday,e.accountToken=e.user.token,e.accountSessionId=e.user.sessionValue,a.getUser().mobile?e.accountNumber=e.user.mobile:e.accountNumber="手机号未绑定",e.accountHeaderKey="2e8352919709910328ec6b6b682a74f3",e.showMobile=!0,/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/.exec(e.accountNumber)||(e.showMobile=!1)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goGuidePage=function(){i.go("guidePage")},e.changeIcon=function(){if("APP"==c.getPlatform()){var o={title:"照片选取方式：",buttonLabels:["拍照","从相册选取"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0},i=function(o){function i(o){e.iconImage=o,n(function(){e.iconImage=o},200);var i=function(t){r.hide(),e.showResult("上传成功");var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,a.setUser(e.user)},s=function(t){r.hide(),e.showResult("上传失败")},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),i,s,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function s(e){}function c(o){e.iconImage=o,n(function(){e.iconImage=o},200);var i=function(t){e.showResult("上传成功"),r.hide();var o=JSON.parse(t.response);e.iconImage=o.data.avatarImageFileId,e.user.avatarImageFileId=e.iconImage,a.setUser(e.user)},s=function(t){e.showResult("上传失败"),r.hide()},c=new FileUploadOptions;c.fileKey="imageFile",c.fileName=e.iconImage.substr(e.iconImage.lastIndexOf("/")+1),c.mimeType="image/jpeg";var l={};c.params=l,(new FileTransfer).upload(e.iconImage,encodeURI(t.uploadImage()),i,s,c);var d={template:'<div><img ng-src="{{imgBaseURL}}img/ic_refresh_01.gif" style="width: 65px;"/></div>'};r.show(d)}function l(e){}1==o?navigator.camera.getPicture(i,s,{quality:100,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!0,targetWidth:720,targetHeight:720,saveToPhotoAlbum:!0}):2==o&&navigator.camera.getPicture(c,l,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,allowEdit:!0,targetWidth:720,targetHeight:720})};window.plugins.actionsheet.show(o,i),n(function(){window.plugins.actionsheet.hide()},5e3)}else{d.alert({template:"请下载客户端实现更换头像功能",okText:"知道了"})}},e.$watch("userInfo.picTempFile",function(){e.userInfo&&e.userInfo.picTempFile&&e.userInfo.picTempFile.length>0&&g(e.userInfo.picTempFile)},!1),e.unload=function(){void 0==e.user.sessionValue?(a.clearUser(),e.goGuidePage(),u.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),p.set("storeId","")):t.unloadAccount(e.accountToken,e.accountSessionId,e.accountHeaderKey).success(function(t,o,i,s){t.success&&(a.clearUser(),e.goGuidePage(),u.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),p.set("storeId",""))})},e.goToDelete=function(){d.confirm({template:"确认退出登录?",cancelText:"取消",okText:"确定"
}).then(function(t){t&&e.unload()})},e.selectDate=function(){if("APP"==c.getPlatform()){var o={date:new Date,mode:"date",cancelButton:!1,locale:"zh-Hans"};datePicker.show(o,function(o){n(function(){var i=o.getDate(),s=o.getMonth()+1,n=o.getFullYear();s<10&&(s="0"+s),i<10&&(i="0"+i),t.changeMessage(e.accountMessage,n+"-"+s+"-"+i,e.accountSexValue,e.accountName).success(function(t,o,r,c){t.success?(e.accountBirthday=n+"-"+s+"-"+i,e.user.birthday=n+"-"+s+"-"+i,a.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})},200)})}else{var i={inputDate:new Date,weeksList:["日","一","二","三","四","五","六"],monthsList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],from:new Date(1900,1,1),to:new Date,mondayFirst:!0,closeOnSelect:!1,templateType:"popup",setLabel:"设置",closeLabel:"关闭",dateFormat:"yyyy-MM-dd",callback:function(o){var i=new Date(o).getMonth()+1,s=new Date(o).getDate();i<10&&(i="0"+i),s<10&&(s="0"+s);var n=new Date(o).getFullYear()+"-"+i+"-"+s;t.changeMessage(e.accountMessage,n,e.accountSexValue,e.accountName).success(function(t,o,i,s){t.success?(e.accountBirthday=n,e.user.birthday=n,a.setUser(e.user),e.showResult("修改成功")):e.showResult("修改失败")})}};l.openDatePicker(i)}},o.$on("SELECT_SEX",function(t,o){e.accountSexValue=o,e.accountSex=e.sexMap[e.accountSexValue],e.user.gender=o,a.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_NAME",function(t,o){e.accountName=o,e.user.nickName=o,a.setUser(e.user),e.showResult("修改成功")}),o.$on("CHANGE_EMAIL",function(t,o){e.accountEmail=o,e.user.email=o,a.setUser(e.user),e.showResult("修改成功")}),e.goBack=function(){e.$ionicGoBack()},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("AccountMessageService",["$http","UrlService",function(e,t){this.unloadAccount=function(o,i,s){var n=o,a="Bearer "+s+" "+n,r={Authorization:a},c={sessionId:i};return e.get(t.getUrl("UNLOAD_INIT"),{headers:r,params:c})},this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})},this.uploadImage=function(){return t.getUrl("UPLOAD_IMAGE")}}]),APP.controller("ChangeEmailController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeEmailService",function(e,t,o,i,s,n,a){e.email={value:t.email},e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName,e.updateResult=!0,e.updateContent="",e.init=function(){e.email={value:t.email},e.gender=t.gender|JSON.parse(window.localStorage.USER_CACHE_KEY).gender,e.userName=t.userName,e.birthday=t.birthday,e.nickName=t.nickName},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){var t=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;return e.email.value?t.exec(e.email.value)?void a.changeEmail(e.userName,e.birthday,e.gender,e.nickName,e.email.value).success(function(t,i,s,a){t.success?(o.$broadcast("CHANGE_EMAIL",e.email.value),n.go("accsafe")):t.message?e.showResult(t.message):e.showResult("未知异常")}):void i.showToast("电子邮箱输入不规范"):void i.showToast("您输入的邮箱不能为空")},e.goBack=function(){n.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeEmailService",["$http","UrlService",function(e,t){this.changeEmail=function(o,i,s,n,a){var r={userName:o,birthday:i,gender:s,nickName:n,email:a};return e({method:"POST",url:t.getUrl("UPDATE_EMAIL"),params:r})}}]),APP.controller("ChangeNameController",["$scope","$stateParams","$rootScope","PopupService","$timeout","$state","ChangeNameService",function(e,t,o,i,s,n,a){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.nickName},e.email=t.email,e.gender=t.gender,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){if(!e.name.value)return void i.showToast("您输入的昵称不能为空");a.changeMessage(e.userName,e.birthday,e.gender,e.name.value).success(function(t,i,s,a){t.success?(o.$broadcast("CHANGE_NAME",e.name.value),n.go("accsetting")):t.message?e.showResult(t.message):e.showResult("未知异常")})},e.goBack=function(){n.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,s(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangeNameService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("ChangePasswordController",["$scope","ChangePassWordService","PopupService","$timeout","$state","UserService",function(e,t,o,i,s,n){e.user="",e.password={oldWord:"",newWord:"",makeSureWord:""},e.accountMessage="",e.accountToken="",e.updateContent="",e.updateResult=!0,e.init=function(){e.user=n.getUser(),e.accountMessage=e.user.userName,e.accountToken=e.user.token,e.password={oldWord:"",newWord:"",makeSureWord:""}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goLoginPage=function(){s.go("login")},e.doChange=function(){var s=e.globalConstant.passwordRegExp;return e.password.oldWord?e.password.newWord?s.test(e.password.newWord)?e.password.makeSureWord?e.password.makeSureWord!=e.password.newWord?void o.showToast("两次输入的新密码不相同"):void t.doInit(e.accountToken,e.accountMessage,e.password.oldWord,e.password.newWord).success(function(t,o,s,a){t.success?(e.showResult("修改成功"),n.clearUser(),i(function(){e.goLoginPage()},1e3)):e.showResult(t.message)}):void o.showToast("确认密码不能为空"):void o.showToast("新密码不符合规则"):void o.showToast("新密码不能为空"):void o.showToast("原密码不能为空")},e.goBack=function(){s.go("accsafe")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,i(function(){e.updateResult=!0},1e3)}}]),APP.service("ChangePassWordService",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n){var a=o,r={token:a,userName:i,oldPassword:encodeURIComponent(s),password:encodeURIComponent(n)};return e({method:"POST",url:t.getUrl("UPDATEPASSWORD_INIT"),params:r})}}]),APP.controller("SelectSexController",["$scope","$stateParams","$rootScope","$state","SelectSexService","$timeout",function(e,t,o,i,s,n){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday,e.updateResult=!0,e.updateContent="",e.init=function(){e.sex={value:t.gender},e.nickName=t.nickName,e.email=t.email,e.userName=t.userName,e.birthday=t.birthday},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doSelect=function(t){e.sex.value=t,s.changeMessage(e.userName,e.birthday,e.sex.value,e.nickName).success(function(i,s,n,a){i.success?(o.$broadcast("SELECT_SEX",t),e.$ionicGoBack()):i.message?e.showResult(i.message):e.showResult("未知异常")})},e.goBack=function(){i.go("accsetting")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("SelectSexService",["$http","UrlService",function(e,t){this.changeMessage=function(o,i,s,n){var a={userName:o,birthday:i,gender:s,nickName:n};return e({method:"POST",url:t.getUrl("UPDATEMEMBER_INIT"),params:a})}}]),APP.controller("BuyerCenterController",["$scope","AccountMessageService","$state","UserService","LoginService","PopupService","$stateParams","RegisterService","$rootScope",function(e,t,o,i,s,n,a,r,c){e.isBuyer=s.getRole(),e.shareStoreId=a.shareStoreId,e.init=function(t){var o=i.getUser();o.avatarImageFileId?e.avatarImageFileId=o.avatarImageFileId:e.avatarImageFileId=c.imgBaseURL+"img/ic_person.png",e.mid=o.mid,e.sessionId=o.sessionValue,e.token=o.token,e.header="2e8352919709910328ec6b6b682a74f3"},e.applyShop=function(){0==e.isBuyer?(r.wdApply().success(function(e){e.success?e.data?o.go("shopApply"):o.go("registerForStore"):n.showToast("服务端错误")}).error(function(){alert("网络错误")}),o.go("shopApply")):e.shareStoreId?o.go("myStore",{storeId:e.mid,shareStoreId:e.shareStoreId}):o.go("myStore",{storeId:e.mid})},e.logOut=function(){void 0==e.sessionId?(i.clearUser(),s.setRole(void 0),o.go("guidePage")):t.unloadAccount(e.token,e.sessionId,e.header).success(function(e,t,n,a){e.success&&(i.clearUser(),s.setRole(void 0),o.go("guidePage"))})},e.goBack=function(){o.go("homePage")},e.$on("$ionicView.beforeEnter",function(){e.isBuyer=s.getRole(),e.init(0)})}]),APP.controller("BindAccountController",["$scope","EasyConnectBindAccountService",function(e,t){e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,i,s){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.service("EasyConnectBindAccountService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTACCOUNT_INIT"))}}]),APP.controller("BindResultController",["$scope","EasyConnectBindResultService","$rootScope",function(e,t,o){e.iconImage=o.imgBaseURL+"img/ic_person.png",e.account="",e.mobile="",e.personId="",e.init=function(){t.doInit().success(function(t,o,i,s){t.success&&(e.account=t.data.memberKjtpays.memberRealName,e.mobile=t.data.memberKjtpays.memberKjtpayAccount,e.personId=t.data.memberKjtpays.memberIdCard)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("EasyConnectBindResultService",["$http","UrlService",function(e,t){this.doInit=function(){return e.get(t.getUrl("EASYCONNECTRESULT_INIT"))}}]),APP.controller("EasyConnectController",["$localstorage","$scope","EasyConnectService","PopupService","$timeout","$state","InAppBrowserService","UrlService",function(e,t,o,i,s,n,a,r){t.bindData=[],t.account="",t.mobile="",t.updateResult=!0,t.updateContent="",t.init=function(){o.getMessage().success(function(e,o,s,n){e.success?(t.bindData=e.data.kjtAccount,e.data.kjtAccount&&e.data.kjtAccount.status&&"0"==e.data.kjtAccount.status&&(t.account=e.data.kjtAccount.memberRealName,t.mobile=e.data.kjtAccount.memberKjtpayAccount)):e.message?i.showToast(e.message):i.showToast("登录失败！")})},t.$on("$ionicView.beforeEnter",function(){t.init()}),t.goToAccount=function(){n.go("bindAccount")},t.clickBind=function(){if(!window.device)return void window.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.bind().success(function(o,i,n,c){if(window.device&&window.device.hasNewBrowser){var l=ionic.Platform.isAndroid();if(l){var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}else{var l=ionic.Platform.isAndroid();if(l){var u=cordova.InAppBrowser.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");u.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/registerandbind")>-1&&s(function(){u.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),u.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&u.close()}),u.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.clickUnBind=function(){if(!window.device)return void window.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_self","location=yes");o.unBlind().success(function(o,i,n,c){var l=ionic.Platform.isAndroid();if(window.device&&window.device.hasNewBrowser)if(l){var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}else{var l=ionic.Platform.isAndroid();if(l){var u=cordova.InAppBrowser.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6),"_blank");u.addEventListener("loadstop",function(e){e.url.indexOf("https://m.kjtpay.com/bindmember/cancelBind")>-1&&s(function(){u.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '44px';newDiv.style.height = '44px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.top = '0px';newDiv.style.left = '0px';newDiv.style.position = 'absolute';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},2e3)}),u.addEventListener("loadstart",function(e){(e.url.indexOf("close=true")>-1||e.url.indexOf("mstore")>-1)&&u.close()}),u.addEventListener("exit",function(e){t.init()})}else{var d=a.open(r.getUrl("KUNBIND_INIT")+"?flag="+e.get("sg_login_token_secret").substring(6));d.addEventListener("exit",function(e){t.init()})}}})},t.showResult=function(e){t.updateContent=e,t.updateResult=!1,s(function(){t.updateResult=!0},1e3)},t.goBack=function(){n.go("mine")}}]),APP.service("EasyConnectService",["$http","UrlService",function(e,t){this.getMessage=function(){return e.get(t.getUrl("EASYCONNECT_INIT"))},this.unBlind=function(){return e.get(t.getUrl("KUNBIND_INIT"))},this.bind=function(){return e.get(t.getUrl("KBIND_INIT"))}}]),APP.controller("EasyConnectIframeController",["$scope","$stateParams","$sce",function(e,t,o){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)},e.init=function(){e.htmlContent=t.content,e.trustSrc=function(e){return o.trustAsResourceUrl(e)}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goUpPage=function(){e.$ionicGoBack()}}]),APP.controller("ClassifyMessageCenterController",["$localstorage","$timeout","$scope","$rootScope","CLASSIFYMESSAGECRNTERService","$state","UserService","InAppBrowserService","UrlService","$http","$stateParams",function(e,t,o,i,s,n,a,r,c,l,d){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.goBack=function(){o.$ionicGoBack()},o.init=function(){s.getMseeageClassify().success(function(e){null==e.data.orderMesagesList?o.orderMessage="":o.orderMessage=e.data.orderMesagesList.content,o.orderNum=e.data.orderNum,null==e.data.platformMesagesList?o.platformMessage="":o.platformMessage=e.data.platformMesagesList.content,o.platformNum=e.data.platformNum,null==e.data.memberMesagesList?o.memberMessage="":o.memberMessage=e.data.memberMesagesList.content,o.memberNum=e.data.memberNum,null==e.data.communityMesagesList?o.communityMessage="":o.communityMessage=e.data.communityMesagesList.content,o.communityNum=e.data.communityNum,o.orderNum>99?o.orderNumClose="99+":o.orderNumClose=o.orderNum,o.platformNum>99?o.platformNumClose="99+":o.platformNumClose=o.platformNum,o.memberNum>99?o.memberNumClose="99+":o.memberNumClose=o.memberNum,o.communityNum>99?o.communityNumClose="99+":o.communityNumClose=o.communityNum})},o.$on("$ionicView.beforeEnter",function(){o.init()}),o.goMessageList=function(e){o.messageType=e,n.go("messageCenter",{messageType:o.messageType})},o.customerServe=function(){if(window.cordova){var i=ionic.Platform.isAndroid(),s=null;s=i?cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no"):cordova.InAppBrowser.open("http://m.ehaier.com/v2/h5/sg/common/customService.html","_blank","location=no,toolbar=no"),s.addEventListener("loadstop",function(e){e.url.indexOf("downt.ntalker")>-1&&t(function(){s.executeScript({code:"var r= document.getElementsByTagName('div');var newDiv  = document.createElement('span');newDiv.style.width = '35px';newDiv.style.height = '35px';newDiv.style.background = 'transparent';newDiv.style.zIndex = '999';r[0].appendChild(newDiv);newDiv.style.position = 'absolute';newDiv.style.top = '10px';newDiv.style.left = '12px';newDiv.style.borderRadius = '17.5px';newDiv.onclick = function(){window.location.href = window.location.href+'&close=true';};"},function(){})},1e3)}),s.addEventListener("loadstart",function(e){e.url.indexOf("close=true")>-1&&s.close()})}else o.kfTocken=e.get("sg_login_token_secret").substring(6),window.open("http://m.ehaier.com/v3/h5/sg/common/customService.html?flag="+o.kfTocken);return}}]),APP.service("CLASSIFYMESSAGECRNTERService",["$http","UrlService","$rootScope",function(e,t,o){this.getMseeageClassify=function(){var o={messageType:0};return e.get(t.getUrl("MESSAGE_CLASSIFY"),o)},this.getMseeageClassifyNew=function(o){var i={messageType:o};return e.get(t.getUrl("MESSAGE_CLASSIFY"),i)}}]),APP.controller("DetailMessageCenterController",["$scope","$stateParams",function(e,t){e.htmlContent=t.content,e.title=t.title,e.init=function(){e.htmlContent=t.content,e.title=t.title},e.$on("$ionicView.beforeEnter",function(){e.init()})}]),APP.controller("MessageCenterController",["$ionicScrollDelegate","$timeout","$scope","$rootScope","$stateParams","MESSAGECENTERService","$state","UserService","InAppBrowserService","UrlService","$http",function(e,t,o,i,s,n,a,r,c,l,d){o.messageMap=[],o.breakLine=[],o.mesType=s.messageType,o.messageList="",o.hasmore=!1,o.page=1,o.size=10;var u,p=1,g="";o.goBack=function(){o.$ionicGoBack()},o.init=function(){u=r.getUser(),e.scrollTop(),n.getMessageList(o.mesType,o.page,o.size).success(function(e){1==o.mesType?(o.messageList=e.data.orderMesagesList,o.count=e.data.orderCount):2==o.mesType?(o.messageList=e.data.memberMesagesList,o.count=e.data.memberCount):3==o.mesType?(o.messageList=e.data.platformMesagesList,o.count=e.data.platformCount):4==o.mesType&&(o.messageList=e.data.communityMesagesList,o.count=e.data.communityCount),g=Math.ceil(o.count/o.size),o.hasmore=!(o.page>=g)})},o.loadMore=function(){var e=o.messageList;p+=1;var t={messageType:o.mesType,page:p,size:o.size};d.get(l.getUrl("MESSAGE_CLASSIFY"),t).success(function(t){1==o.mesType?(o.messageList=e.concat(t.data.orderMesagesList),o.count=t.data.orderCount):2==o.mesType?(o.messageList=e.concat(t.data.memberMesagesList),o.count=t.data.memberCount):3==o.mesType?(o.messageList=e.concat(t.data.platformMesagesList),o.count=t.data.platformCount):4==o.mesType&&(o.messageList=e.concat(t.data.communityMesagesList),o.count=t.data.communityCount),o.hasmore=!(o.count<o.messageList.length),o.$broadcast("scroll.infiniteScrollComplete")})},o.goDetail=function(e){var t={id:e.id};n.checkRead(t).success(function(e){n.unreadMessage()});var i=navigator.userAgent;if(1==e.type)if(-1!=i.indexOf("iPhone")){var s=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);s.addEventListener("exit",function(e){})}else a.go("helpDetail",{helpId:e.relationId,content:e.title});else if(2==e.type)a.go("shopRevenue");else if(3==e.type||51==e.type)a.go("orderDetail",{orderSn:"",cOrderSn:"",cOrderId:e.relationId});else if(4==e.type)if(-1!=i.indexOf("iPhone")){var s=c.open(l.getHead()+"mstore/sg/helpDetail.html?id="+e.relationId,e.title);s.addEventListener("exit",function(e){})}else a.go("helpDetail",{helpId:e.relationId,content:e.title});else if(5==e.type)a.go("orderManage",{orderStatus:4});else if(601==e.type)e.relationId?a.go("noteDetails",{noteId:e.relationId,isShortStory:1}):a.go("goldRecord");else if(602==e.type)a.go("noteDetails",{noteId:e.relationId,isShortStory:0});else if(603==e.type)e.relationId?a.go("classNoteDetails",{noteId:e.relationId}):a.go("goldRecord");else if(604==e.type)a.go("myFans");else if(0==e.type){var u=r.getUser().mid;a.go("goldRecord")}else if(-3==e.type)a.go("productRated",{productId:e.relationId});else if(-4==e.type){var p=l.getUrl("ORDER_INFO"),g=$.param({orderId:e.relationId});d({method:"POST",url:p,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.success){var t=e.data.data.ordersn;a.go("orderTracking",{orderSn:t})}},function(e){})}else if(-5==e.type){var u=r.getUser().userId;a.go("refundDetail",{orderProductId:e.relationId,memberId:u})}else-6==e.type?a.go("orderManage"):-12==e.type||-11==e.type?a.go("myCouponsList"):-13==e.type||-15==e.type||-21==e.type?a.go("shopRevenue"):-14==e.type?a.go("walletDiamonds"):o.init()},o.readAll=function(){if(!r.getUser().mid)return void alert("用户id不存在");var t={};n.readAllMessage(t).success(function(t){n.unreadMessage(),e.scrollTop(),p=1,o.init()}).error(function(){alert("全部已读操作失败")})},o.$on("$ionicView.beforeEnter",function(t,i){"back"!=i.direction&&(p=1,o.init(),e.scrollTop())})}]),APP.service("MESSAGECENTERService",["$http","UrlService","$rootScope",function(e,t,o){this.msgCenter=function(o){return e.get(t.getUrl("MSG_CENTER"),o)},this.unreadMessage=function(){return e.get(t.getUrl("UNRED_MESSAGE")).success(function(e){o.unreadMessage=e.data})},this.readAllMessage=function(o){return e.get(t.getUrl("READALL"),o)},this.checkRead=function(o){return e.get(t.getUrl("CHECKREAD"),o)},this.getMessageList=function(o,i,s){var n={messageType:o,page:i,size:s};return e.get(t.getUrl("MESSAGE_CLASSIFY"),n)}}]),APP.controller("MyStoreManageController",["$scope","MyStoreManageService","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","MyStoreService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.levelArr=["士兵","班长","排长","连长","营长","团长","旅长","师长","军长","司令","盟主"],e.levelStr="",e.userName="",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.init=function(){f.scrollTop(),e.storeId=window.localStorage.storeId,e.showQQ=!1,e.showWeChat=!1,t.mstore().success(function(t){t.success&&(e.userName=t.data,e.levelStr=e.levelArr[t.data.level],e.myStoreInfo={storeName:e.userName.storeName,qrcode:e.userName.qrCode})}),b.getMyStoreInfo("m","http://m.ehaier.com","http://www.ehaier.com/mstatic","http://m.ehaier.com/v2/mstore/sg/entrance.html",e.storeId).success(function(t){e.myStoreInfo=t.data,e.shareInfo=t.data.share,e.avatarImage=t.data.avatarImageFileId})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.showShare=!1,e.myStoreInfo="",e.shareInfo={},e.share=function(){if(window.device&&window.device.hasNewShare)e.showShare=!e.showShare;else{var t=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=t);var o=e.avatarImage,i=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?window.umeng.share(t,"在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",o,i,0):alert("只能在app分享,请下载app！")}},e.copeText=function(e){window.cordova?(cordova.plugins.clipboard.copy(e),u.showToastShort("复制成功")):u.showToast("请下载APP执行此操作")},e.hideblackCover=function(){e.showShare=!1},e.shareToPlatform=function(t){var o=e.myStoreInfo.storeName;0==e.shareInfo.content.length&&(e.shareInfo.content=o);var i="在顺逛上有一个挺不错的店铺，伙伴们快来看看，好东西不容错过~",s=e.avatarImage,n=h.getShareLinkHeader()+"myStore/"+e.storeId+"/"+e.storeId+"/";window.umeng?(0==t?window.umeng.shareToSina(o,i,s,n,0,null,T.shareSuccessCallback):1==t?window.umeng.shareToWechatSession(o,i,s,n,0,null,T.shareSuccessCallback):2==t?window.umeng.shareToWechatTimeline(o,i,s,n,0,null,T.shareSuccessCallback):3==t?(window.umeng.shareToQQ(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()):4==t&&(window.umeng.shareToQzone(o,i,s,n,0,null,T.shareSuccessCallback),T.qqShare()),5==t?e.copeText(n):T.successShare()):alert("umeng undefined 只能在app分享"),e.showShare=!1},l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),l.fromTemplateUrl("templates/shop/FilterShop.html",{scope:e,animation:"slide-in-left",backdropClickToClose:!1}).then(function(t){e.filterModal=t}),e.openQrcode=function(){e.qrCodemodal.show()},e.backToStore=function(){e.filterModal.hide()},e.closeModal=function(){e.qrCodemodal.hide()},e.$on("$destroy",function(){e.qrCodemodal.remove(),e.filterModal.remove()}),l.fromTemplateUrl("my-qrcode-modal.html",{scope:e,animation:"slide-in-up",backdropClickToClose:!0}).then(function(t){e.qrCodemodal=t}),e.saveQrCode=function(){if("undefined"!=typeof cordova){var t="";t=ionic.Platform.isAndroid()?cordova.file.externalRootDirectory+"myQRCode.jpg":cordova.file.documentsDirectory+"myQRCode.jpg";var o=encodeURI(e.myStoreInfo.qrcode),i={};(new FileTransfer).download(o,t,function(e){if(ionic.Platform.isAndroid()){var t=e.toURL();u.showAlert("","图片已经保存至"+t)}else u.showToast("保存成功")},function(e){u.showToast("保存失败！")},!0,i)}}}]),APP.service("MyStoreManageService",["$http","UrlService",function(e,t){this.mstore=function(){return e.get(t.getUrl("MYSTORE"),{})}}]),APP.controller("MyIdCardAuthenController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyIdCardAuthenService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){var t={realName:e.IdCard.realName,identityNo:e.IdCard.identityNo};r.nameAuth(t).success(function(o){o.data?(e.ToMessage=o.message,s.go("myPhoneBind",t,{reload:!0})):e.ToMessage=o.message})}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.isSubMint=!1,e.ToMessage="";var A=/(^\d{18}$)|(^\d{17}(\d|X|x)$)/;e.IdCardKeyup=function(){A.test(e.IdCard.identityNo)?e.isSubMint=!0:e.isSubMint=!1},e.goToPhoneBind=function(){if(e.isIdCardAuthen){if(!e.data.identity.realName)return u.showToast("请输入姓名!"),!1;var t={realName:e.data.identity.realName,identityNo:e.IdCard.identityNo};r.realNameCheck(t).success(function(e){e.data?s.go("myPhoneBind",t,{reload:!0}):u.showToast(e.message)})}else{if(!e.IdCard.realName)return u.showToast("请输入姓名!"),!1;b()}},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?(e.data=t.data,t.data.isAuth?(e.isAuth="1",e.isIdCardAuthen=!0):(e.isAuth="0",e.isIdCardAuthen=!1)):(e.isAuth="-1",e.isIdCardAuthen="",u.showToast("获取用户是否认证异常!"))})},e.$on("$ionicView.beforeEnter",function(t,o){f.scrollTop(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.isAuth="-1",e.isIdCardAuthen=!1,e.data="",e.ToMessage="",e.IdCard={mobile:e.USER_CACHE_KEY.mobile,identityNo:"",realName:"",memberId:e.USER_CACHE_KEY.mid},e.FnisAuth()})}]),APP.service("MyIdCardAuthenService",["$http","UrlService",function(e,t){this.realNameAuth=function(o){return e({method:"POST",url:t.getUrl("REALNAMEAUTH"),params:o})},this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.realNameCheck=function(o){return e({method:"POST",url:t.getUrl("GET_NAMEORID"),params:o})},this.nameAuth=function(o){return e.get(t.getUrl("GET_NAMEAUTH"),o)}}]),APP.controller("MyPhoneBindController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.mobile="",e.realName="",e.identityNo="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.phone={phone:""},e.goToPhoneBindSuccess=function(){if(!e.realName)return void u.showToast("非法参数姓名！");if(!e.identityNo)return void u.showToast("非法参数证件号");if(!e.globalConstant.mobileNumberRegExp.test(e.phone.phone))return void u.showToast("非法参数手机号");var t={realName:e.realName,identityNo:e.identityNo,mobile:e.phone.phone};r.PhoneAuth(t).success(function(t){t.data?s.go("myPhoneBindNewCode",{mobile:e.phone.phone,realName:e.realName,identityNo:e.identityNo},{reload:!0}):u.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.phone.phone="",f.scrollTop(),t.realName&&t.identityNo&&(e.realName=t.realName,e.identityNo=t.identityNo)})}]),APP.service("MyPhoneBindService",["$http","UrlService",function(e,t){this.PhoneAuth=function(o){return e.get(t.getUrl("GET_PHONEAUTH"),o)}}]),APP.controller("MyPhoneBindNewCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,e.realName=t.realName,e.identityNo=t.identityNo,e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):u.showToast(t.message)})},e.goToIdCard=function(){var t={mobileNum:e.Phone,captcha:e.code.captcha,oldMobileNo:e.oldMobileNo,realName:e.realName,identityNo:e.identityNo};r.changeMobile(t).success(function(t){t.success?s.go("myPhoneBindSuccess",{phone:e.Phone},{reload:!0}):u.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.oldMobileNo=e.USER_CACHE_KEY.mobile,e.Phone=t.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2"),e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.CodePhoneState=2,b()):u.showToast(t.message)})})}])
;APP.controller("MyPhoneBindSuccessController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneBindSuccessService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate","$localstorage",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f,b){-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.phone="",e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/myPhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.unload=function(){a.clearUser(),y.setRole(void 0),window.localStorage.setItem("isLogin",a.isUserLogin()),b.set("storeId",""),s.go("login")},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.phone=t.phone})}]),APP.service("MyPhoneBindSuccessService",["$http","UrlService",function(e,t){}]),APP.controller("MyPhoneCodeController",["$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneCodeService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,f){function b(){m(function(){e.PhoneTime>0?(e.PhoneTime=e.PhoneTime-1,e.switchState=!1,b()):(e.CodePhoneState="1",e.switchState=!0,e.PhoneTime="59")},1e3)}-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?e.isIosApp=!0:e.isIosApp=!1,e.opacity=!1,e.GoBackImgUrl=o.imgBaseURL+"img/addressBack@2x.png",e.ResultImgUrl=o.imgBaseURL+"img/PhoneManage@2x.png",e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,e.isAuth="-1",e.userData="",e.code={captcha:"",mobileNum:e.Phone},e.switchState=!0,e.PhoneTime="59",e.CodePhoneState="0",e.getCodePhone=function(){e.switchState&&r.captchaMobile(e.Phone).success(function(t){t.success?(e.opacity=!0,e.CodePhoneState=2,b()):u.showToast(t.message)})},e.goToIdCard=function(){r.checkMobile(e.code).success(function(t){if(t.success)if(1==e.isAuth){var o={realName:e.userData.identity.realName,identityNo:e.userData.identity.identityNo};s.go("myPhoneBind",o,{reload:!0})}else 0==e.isAuth?s.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):(u.showToast("获取用户是否认证异常!"),e.FnisAuth());else u.showToast(t.message)})},e.MobileIsUnavailable=function(){1==e.isAuth?s.go("myIdCardAuthen",{isAuth:!0},{reload:!0}):0==e.isAuth?s.go("myIdCardAuthen",{isAuth:!1},{reload:!0}):e.FnisAuth()},e.FnisAuth=function(){r.isRealNameAuth().success(function(t){t.success?t.data.isAuth?e.isAuth="1":e.isAuth="0":e.isAuth="-1",e.userData=t.data})},e.$on("$ionicView.beforeEnter",function(){f.scrollTop(),e.CodePhoneState="0",e.opacity=!1,e.FnisAuth(),e.storeId=window.localStorage.storeId,e.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),e.Phone=e.USER_CACHE_KEY.mobile,59!=e.PhoneTime&&(e.CodePhoneState="2",e.opacity=!0),e.code={captcha:"",mobileNum:e.Phone}})}]),APP.service("MyPhoneCodeService",["$http","UrlService",function(e,t){this.isRealNameAuth=function(){return e.get(t.getUrl("ISREALNAMEAUTH"),{})},this.captchaMobile=function(o){var i={mobileNum:o};return e.get(t.getUrl("CAPTCHAMOBILE"),i)},this.checkMobile=function(o){return e.get(t.getUrl("CHECKMOBILE"),o)},this.changeMobile=function(o){return e({method:"POST",url:t.getUrl("CHANGEMOBILE"),params:o})}}]),APP.controller("MyPhoneManageController",["$ionicPopup","HomePageService","$scope","$stateParams","$rootScope","$ionicHistory","$state","$ionicSideMenuDelegate","UserService","MyPhoneManageService","$ionicSlideBoxDelegate","$ionicModal","ChooseShopTemplateService","PopupService","GoodsService","CommonAddressService","$timeout","$ionicScrollDelegate","UrlService","BannerThemeService","SeckillService","countdownService","$interval","$ionicLoading","LoginService","CreditService","$http","$ionicScrollDelegate",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w,y,T,C,b,A,v){o.$on("$ionicView.beforeEnter",function(){o.isUser=!1,o.isUsers=function(){t.isWdHost().success(function(t){o.isWdHost=t.data.isHost,null==t.data.o2o||1==t.data.o2o?e.show({template:"尊贵的VIP商户，请前往商户中心修改手机号。",buttons:[{text:"好的，我知道了！",onTap:function(){o.$ionicGoBack()}}]}):1==o.isWdHost?a.go("myPhoneCode"):0==o.isWdHost&&(o.isUser=!0)})},o.goUpgrade=function(){a.go("newAuthenticationHome"),o.isUser=!1},o.closePopup=function(){o.isUser=!1},v.scrollTop(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?o.isIosApp=!0:o.isIosApp=!1,o.GoBackImgUrl=s.imgBaseURL+"img/addressBack@2x.png",o.ResultImgUrl=s.imgBaseURL+"img/PhoneManage@2x.png",o.storeId=window.localStorage.storeId,o.USER_CACHE_KEY=JSON.parse(window.localStorage.USER_CACHE_KEY),o.Phone=o.USER_CACHE_KEY.mobile})}]),APP.service("MyPhoneManageService",["$http","UrlService",function(e,t){}]),APP.controller("ShopAddressController",["$scope","$stateParams","$rootScope","ShopAddressServicee","PopupService","$timeout",function(e,t,o,i,s,n){e.provinceId="",e.cityId="",e.regionId="",e.textOne="",e.textTwo="",e.textThree="",e.textFour="",e.textALL="",e.panGoOn=!1,e.address={value:t.default},e.detailAddress={value:t.defaultDetail},e.updateResult=!0,e.updateContent="";var a=t.hrCode,r=t.memberType;e.init=function(){a=t.hrCode;t.memberType;0==e.panGoOn&&(e.address={value:t.default},e.provinceId=t.provinceId,e.cityId=t.cityId,e.regionId=t.regionId),e.detailAddress={value:t.defaultDetail},e.panGoOn=!1},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.address.value&&e.detailAddress.value?e.detailAddress.value.length>50||e.detailAddress.value.length<2?void s.showToast("你输入的地址字符长度应在2-50之间"):void i.doInit(e.address.value,e.detailAddress.value,e.provinceId,e.cityId,e.regionId,a,r).success(function(t,i,s,n){1==t.success?(o.$broadcast("SHOP_ADDRESS",e.address.value),o.$broadcast("SHOP_DETAILADDRESS",e.detailAddress.value),e.$ionicGoBack()):e.showResult("修改失败")}):void s.showToast("您输入的地址不能为空")},o.$on("SHOPADDRESS_LOCATION",function(t,o){e.panGoOn=!0,e.textOne=o["text-1"],e.textTwo=o["text-2"],e.textThree=o["text-3"],e.textFour=o["text-4"],e.provinceId=o["value-1"],e.cityId=o["value-2"],e.regionId=o["value-3"],e.textALL=e.textOne+e.textTwo+e.textThree+e.textFour,e.address={value:e.textALL}}),e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopAddressServicee",["$http","UrlService",function(e,t){this.doInit=function(o,i,s,n,a,r,c){var l={};if("人人服务（服务兵创业）"==c)var l={provinceId:s,cityId:n,regionId:a,regionName:o,address:i,hrCode:r,memberType:10};else var l={provinceId:s,cityId:n,regionId:a,regionName:o,address:i};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:l})}}]),APP.controller("ShopLegendController",["$scope","$stateParams","ShopLegendService","$rootScope","PopupService",function(e,t,o,i,s){e.selectText=t.default;var n=t.provinceId,a=t.cityId,r=t.regionId;e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.goToLegend=!1,e.isHaierCloud=!1,e.init=function(){e.hrCode={value:t.hrCode},e.hrCodeOld=t.hrCode,e.showAlert=!1,e.showAlertCheck=!1,"海尔云店"!=e.selectText&&(e.isHaierCloud=!1)},e.doChange=function(){e.showAlert=!1,e.showAlertCheck=!1;var t=/^(?!HR|hr|Hr|hr).*$/;if("人人服务（服务兵创业）"==e.selectText&&(e.valueUnion=10,t.exec(e.hrCode.value)||e.hrCode.value.length>20||e.hrCode.value.length<8))return void(e.showAlert=!0);e.hrCodeOld==e.hrCode.value?o.doInit(e.valueUnion,n,a,r,e.hrCode.value).success(function(t,o,n,a){1==t.success?(i.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?s.showToast(t.message):s.showToast("未知异常")}):o.check(e.hrCode.value).success(function(t,c,l,d){t?o.doInit(e.valueUnion,n,a,r,e.hrCode.value).success(function(t,o,n,a){1==t.success?(i.$broadcast("SHOP_LEGEND",e.selectText),e.showAlert=!1,e.$ionicGoBack()):t.message?s.showToast(t.message):s.showToast("未知异常")}):e.showAlertCheck=!0})},i.$on("SHOP_SELECT_UNION",function(t,o){e.goToLegend=!0,e.textUnion=o.text,e.valueUnion=o.value,e.selectText=e.textUnion,"海尔云店"==e.selectText&&(e.isHaierCloud=!0)}),e.$on("$ionicView.beforeEnter",function(o,i){"forward"==i.direction&&(e.selectText=t.default),e.init()})}]),APP.service("ShopLegendService",["$http","UrlService",function(e,t){this.check=function(o){var i={hrCode:o};return e.get(t.getUrl("CHECKHRCODE_INIT"),i)},this.doInit=function(o,i,s,n,a){var r={memberType:o,provinceId:i,cityId:s,regionId:n,hrCode:a};return e({method:"POST",url:t.getUrl("EDITSHOP_INIT"),params:r})}}]),APP.controller("ShopMessageController",["$scope","ShopMessageService","$rootScope","PopupService",function(e,t,o,i){e.shopMessageID="",e.shopMessageName="",e.shopMessageAddress="",e.shopMessageDetailAddress="",e.shopMessageLegend="",e.provinceId="",e.cityId="",e.regionId="",e.isHaierCloud="",e.hrCode="",e.init=function(){e.isHaierCloud=!1,t.getShopMessage().success(function(t,o,s,n){t.success?(e.shopMessageID=t.data.storeInfo.memberId,e.shopMessageName=t.data.storeInfo.storeName,e.shopMessageAddress=t.data.storeInfo.regionName,e.shopMessageDetailAddress=t.data.storeInfo.address,e.shopMessageLegend=t.data.storeInfo.memberName,e.provinceId=t.data.storeInfo.provinceId,e.cityId=t.data.storeInfo.cityId,e.regionId=t.data.storeInfo.regionId,e.hrCode=t.data.storeInfo.hrCode,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!0)):i.showToast(t.message)})},e.$on("$ionicView.beforeEnter",function(){e.init()}),o.$on("SHOP_NAME",function(t,o){e.shopMessageName=o}),o.$on("SHOP_LEGEND",function(t,o){e.shopMessageLegend=o,"海尔云店"==e.shopMessageLegend&&(e.isHaierCloud=!1)}),o.$on("SHOP_ADDRESS",function(t,o){e.shopMessageAddress=o}),o.$on("SHOP_DETAILADDRESS",function(t,o){e.shopMessageDetailAddress=o})}]),APP.service("ShopMessageService",["$http","UrlService",function(e,t){this.getShopMessage=function(){return e.get(t.getUrl("SHOPINFO_INIT"))}}]),APP.controller("ShopNameController",["$scope","$stateParams","$rootScope","ShopNameService","PopupService","$timeout",function(e,t,o,i,s,n){e.name={value:t.default},e.updateResult=!0,e.updateContent="",e.init=function(){e.name={value:t.default}},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.doChange=function(){return e.name.value?/[\ud800-\udbff][\udc00-\udfff]/g.test(e.name.value)?void s.showToast("亲，不可以使用表情喔!"):void i.checkName(e.name.value).success(function(t,o,n,a){t.data?i.changeName(e.name.value).success(function(t,o,i,s){t.success&&e.$ionicGoBack()}):s.showToast("您的名称中含有敏感词,请重新输入")}):void s.showToast("您输入的店铺名称不能为空")},e.showResult=function(t){e.updateContent=t,e.updateResult=!1,n(function(){e.updateResult=!0},1e3)}}]),APP.service("ShopNameService",["$http","UrlService",function(e,t){this.checkName=function(o){var i={checkword:o};return e.get(t.getUrl("CHECKSHOPNAME_INIT"),i)},this.changeName=function(o){var i={wdName:o};return e.get(t.getUrl("CHANGESHOPNAME_INIT"),i)}}]),APP.controller("storeTeamOwnerController",["$http","$scope","$cacheFactory","storeTeamOwnerService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService","PersonalCenterService","HomePageService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I,$,w){function y(e,o){i.storeInfo({visitType:e,daysType:o}).success(function(e){1==e.success&&(t.storeVisitInfo=e.data.storeVisitInfo,t.commonVisitList=e.data.commonVisitList)})}function T(e){var t=[];for(var o in e)t.push([e[o],o]);t.reverse();for(var i=t.length,e=[],o=0;o<i;o++)e.push({date:t[o][1],act:t[o][0]});return e}t.navtabs=[{title:"店铺数据"},{title:"团队数据"},{title:"个人数据"}],t.flagNum=!1,t.messageImgUrl="http://cdn09.ehaier.com/shunguang/H5/www/img/message_gray@2x.png",-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(t.paddingtopClass={"margin-top":"16px"},t.paddingtopClasscontent={top:"60px"}):(t.paddingtopClass={"margin-top":"0px"},t.paddingtopClasscontent={top:"44px"}),t.setStorage=function(e,o,s,n,r,c){t.userinfo={img:e,name:o,time:s,where:n},i.visitorInfo=t.userinfo,i.getVisitorBrowHis(r,c).success(function(e){if(e.success){if(t.visiProductList=e.data,0==t.visiProductList.length)return!1;a.go("VisitorBrowHistory",{userId:r,daysType:c})}})},t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,t.partnerTitle="partner",t.teamTitle="team",t.switchType=function(e){t.typeState[e]||(t.typeState=[!1,!1,!1],t.typeState[e]=!0),0==e?(t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,y(t.visitType,t.daysType)):1==e?(t.storeActived=!1,t.teamActived=!0,t.ownerActived=!1,i.teamInfo().success(function(e){1==e.success&&(t.teamDetail=e.data)})):2==e&&(t.storeActived=!1,t.teamActived=!1,t.ownerActived=!0,i.ownerInfo().success(function(e){if(1==e.success){t.ownerDetail=e.data,t.ownerMonthReport=e.data.storeMemberMonthReport,t.ownerteamLevel=e.data.teamLevel,t.items=e.data.map;var o=T(e.data.map);t.lists=o}}),i.ownerCommi().success(function(e){1==e.success&&(t.predictCommi=e.data.newBrokerageAmount,t.totalCommi=e.data.totalBrokerageAmount)})),m.scrollTop()},t.dayType=function(e){t.dayState[e]||(t.dayState=[!1,!1],t.dayState[e]=!0),0==e?(t.rankText="7天访客排行榜",t.daysType="WEEK",y(t.visitType,t.daysType)):1==e&&(t.rankText="30天访客排行榜",t.daysType="MONTH",y(t.visitType,t.daysType))},t.$on("$ionicView.beforeEnter",function(e,o){if("back"==o.direction)return void w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1});t.userMemberId=$.userMemberId,t.typeState=[!0,!1,!1],t.dayState=[!0,!1],t.rankText="7天访客排行榜",t.daysType="WEEK",t.visitType="STORE",t.init()}),t.days=[{text:"最近7天"},{text:"最近30天"}],t.items={},t.openHis=function(){var e=d.show({template:"\n          <div class='his-box' scrollbar-y=\"false\">\n            <h3>历史团队活跃度</h3>\n            <h5>最近12个月</h5>\n            <div class='his-nav' flex='main:justify cross:center'>\n              <div>年/月</div>\n              <div>活跃度</div>\n            </div>\n            <div class='his-list'>\n              <div class='his-item' ng-repeat='list in lists' flex='main:justify cross:center'>\n                <div class='his-month'>{{list.date}}</div>\n                <div class='his-act'>{{list.act}}%</div>\n              </div>\n            </div>\n            <div class='his-close'>\n              <div class=\"close-img\" ng-click='closeHis()'>\n                <img ng-src=\"{{imgBaseURL}}img/hisClose@2x.png\" alt=\"关闭\" />\n              </div>\n              <span class='close-bor'></span>\n            </div>\n          </div>\n        ",scope:t});t.closeHis=function(){e.close()}},t.goBack=function(){t.$ionicGoBack()};l.getUser();t.init=function(){y(t.visitType,t.daysType),t.storeActived=!0,t.teamActived=!1,t.ownerActived=!1,w.getUnReadMsg().success(function(e){e.data>0?t.flagNum=!0:t.flagNum=!1})},t.PercentageCal=function(e,t){var o=parseFloat(e),i=parseFloat(t);return i>o?isNaN(o)||isNaN(i)?"-":i<=0?"0%":Math.round(o/i*1e4)/100+"%":"100%"}}]),APP.service("storeTeamOwnerService",["$http","UrlService",function(e,t){this.storeInfo=function(o){var i=t.getUrl("GET_STORE_DATA");return e.get(i,o)},this.teamInfo=function(o){var i=t.getUrl("GET_TEAM_DATA");return e.get(i,o)},this.ownerInfo=function(o){var i=t.getUrl("GET_OWNER_DATA");return e.get(i,o)},this.ownerCommi=function(o){var i=t.getUrl("REPORT_DETAIL_PLUS");return e.get(i,o)},this.visitorInfo="",this.getVisitorBrowHis=function(o,i){var s={userId:o,daysType:i};return e.get(t.getUrl("GET_VISI_BROW_HIS"),s)}}]),APP.controller("teamProductMsgController",["storeTeamOwnerService","$http","$scope","teamProductMsgService","$stateParams","$ionicSlideBoxDelegate","$state","$ionicSideMenuDelegate","$cookieStore","UserService","$ionicPopup","$timeout","LoginService","$rootScope","$ionicScrollDelegate","$ionicModal","BannerThemeService","$localstorage","VersionService","PopupService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h,v,S,I){function $(){var e=document.getElementById("shopRevenueChart"),t=echarts.init(e);T=t;var i=null;(i={title:{text:A,left:"30%",top:"2%",textStyle:{fontWeight:"normal",fontSize:14,color:"#172434",letterSpacing:0,lineHeight:14}},tooltip:{trigger:"axis",formatter:"{c}",axisPointer:{type:"none"}},xAxis:{type:"category",boundaryGap:!1,data:o.statisticDays,axisLabel:{interval:0,rotate:0,textStyle:{fontSize:8,color:"#7b7b7b"}},splitLine:{lineStyle:{color:["#ffffff"],width:1}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}},yAxis:[{type:"value",splitLine:{show:!1},axisLabel:{textStyle:{fontSize:8,color:"#7b7b7b"}},axisLine:{lineStyle:{color:"#dedede"}},axisTick:{lineStyle:{color:"#dedede"}}}],series:[{name:"统计",type:"line",symbolSize:8,areaStyle:{normal:{color:"#cee9f6"}},lineStyle:{color:"#37bfff"},itemStyle:{normal:{color:"#37bfff"}},data:o.data}]})&&"object"==typeof i&&(t.setOption(i,!0),t.setOption(i))}function w(e,t){return 1==e?void(b=t.storeUv):2==e?void(b=t.storePv):3==e?void(b=t.productUv):4==e?void(b=t.productPv):5==e?void(b=t.shareUv):6==e?void(b=t.sharePv):void 0}function y(e,t,i,s){for(var n=0;n<e.length;n++)o.statisticDays.push(e[n].statisticDays),1==i?o.data.push(e[n].storeUv):2==i?o.data.push(e[n].storePv):3==i?o.data.push(e[n].productUv):4==i?o.data.push(e[n].productPv):5==i?o.data.push(e[n].shareUv):6==i&&o.data.push(e[n].sharePv);"WEEK"==t?(w(i,s),C=7,A="最近"+C+"天: "+b+o.titleText):(w(i,s),C=30,A="最近"+C+"天: "+b+o.titleText)}o.data=[],o.statisticDays=[];var T="",C="",b="",A="";o.titleList=["访客数","浏览次数","商品访客数","商品浏览量","分享访问人数","分享访问次数"],-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?(o.paddingtopClass={"margin-top":"16px"},o.paddingtopClasscontent={top:"60px"}):(o.paddingtopClass={"margin-top":"0px"},o.paddingtopClasscontent={top:"44px"}),o.commonFun=function(e,t){i.storeInfo(e,t).success(function(e){e.success&&(o.commonVisitList=e.data.commonVisitList,o.daysType=7==e.data.commonVisitDetail.statisticDays?"WEEK":"MONTH",o.commonVisitDetail=e.data.commonVisitDetail,o.myInComeOut=e.data.commonVisitTendencyList,o.storeVisitInfo=e.data.storeVisitInfo,1==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):2==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):3==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):4==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):5==o.num?(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()):6==o.num&&(y(o.myInComeOut,t,o.num,o.storeVisitInfo),$()))})},o.init=function(){1!=o.num&&2!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?3!=o.num&&4!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days?5!=o.num&&6!=o.num||"WEEK"!=o.days&&"MONTH"!=o.days||(o.share="SHARE",o.commonFun(o.share,o.days)):(o.product="PRODUCT",o.commonFun(o.product,o.days)):(o.store="STORE",o.commonFun(o.store,o.days)),1==o.num||3==o.num||5==o.num?(o.personNum=!0,o.titleText="人"):2!=o.num&&4!=o.num&&6!=o.num||(o.titleText="次")},o.setStorage=function(t,i,s,n,r,c,l){if(3!=t&&4!=t)return!1;o.userinfo={img:i,name:s,time:n,where:r},e.visitorInfo=o.userinfo,e.getVisitorBrowHis(c,l).success(function(e){if(e.success){if(o.visiProductList=e.data,0==o.visiProductList.length)return!1;a.go("VisitorBrowHistory",{userId:c,daysType:l})}})},o.goBack=function(){o.$ionicGoBack()},o.$on("$ionicView.beforeEnter",function(){C="",b="",A="",o.num=s.num,o.days=s.type,o.data=[],o.statisticDays=[],o.fsfsafa=!0,o.init()}),o.$on("$ionicView.beforeLeave",function(){T&&T.dispose(),o.fsfsafa=!1})}]),APP.service("teamProductMsgService",["$http","UrlService",function(e,t){this.storeInfo=function(o,i){var s={visitType:o,daysType:i};return e.get(t.getUrl("STORE_PRODUCT"),s)}}]),APP.controller("TeamController",["$ionicHistory","$scope","TeamService","$ionicPopup","$timeout","$ionicActionSheet","UserService","MyStoreService","CommonAddressService","$stateParams","$localstorage","$rootScope","PopupService","LoginService","$ionicScrollDelegate","$ionicModal","GoodsService",function(e,t,o,i,s,n,a,r,c,l,d,u,p,g,m,f,h){t.goBack=function(){t.$ionicGoBack()},t.history=[],t.hShow=!0,t.hShowB=!0;localStorage.getItem("historys");t.arrowState=[u.imgBaseURL+"img/Group@2x.png",u.imgBaseURL+"img/Group1@2x.png",u.imgBaseURL+"img/Group4@2x.png"],t.openStoreTime_index=1,tabState=[["openTime","openTimeDesc"],"authDesc","leaderDesc"],t.isShowUp=!1,t.isIos=!1,t.screenWidth=window.screen.width,t.front=l.front,t.shareStoreId=l.shareStoreId,t.isBuyer=g.getRole(),t.userId=a.getUser().mid;var v="",S="0";t.brand=!1,t.brandName="全部",t.brandList=[],t.filterParameterArr=["hasStock","all","0"],t.StockStateArr=["all","hasStock"],t.filterParams="",-1!=navigator.userAgent.indexOf("iPhone")?t.isIos=!0:t.isIos=!1,t.screenWidth<375?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"48%"}:t.screenWidth<414?t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"55%"}:t.searchInputStyle={position:"absolute",top:"7px",right:"55px",width:"58%"},t.searchTopRight={position:"absolute",right:"10px",top:"5px"},-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova&&(t.searchInputStyle={position:"absolute",top:"24px",right:"13%",width:"58%"},t.searchTopRight={position:"absolute",right:"-1%",top:"24px"}),t.clearLocal=function(){localStorage.removeItem("historys"),t.hShow=!1,t.hShowB=!0},t.$on("$ionicView.beforeEnter",function(e,o){m.scrollTop(),t.isBuyer=g.getRole(),-1!=ionic.Platform.platform().indexOf("ios")&&window.cordova?t.topStyle={top:"64px"}:t.topStyle={top:"44px"},t.showTab=!1,t.filterParams="",t.lianXC=!1,t.storeId=d.get("storeId",u.globalConstant.storeId),t.isBuyer=g.getRole(),t.userId=a.getUser().mid,"back"==o.direction?(t.hShow=!1,t.hotWordShow=!1,t.hShowB=!1):(localStorage.getItem("historys")?(t.hShow=!0,t.hShowB=!1):(t.hShow=!1,t.hShowB=!0),t.tabNav="selection",t.hasmore=!1,t.typeChoose="商品",S="0",t.gsPlaceholder="请搜索名字、型号等关键字",t.searchData=null,t.page=2,t.front=l.front,v=l.shareStoreId?l.shareStoreId:a.getUser().mid,t.searchGoodsName={name:""})}),t.loadMore=function(){0==t.front?o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,2,t.filterParams,!0).success(function(e,o,i,s){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)}):1==t.front&&o.myStoreSearch(t.page,"5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1,t.filterParams,!0).success(function(e,o,i,s){void 0!=e.productsList&&0!=e.productsList.length?(t.searchData=t.searchData.concat(e.productsList),t.$broadcast("scroll.infiniteScrollComplete"),t.page+=1):(t.$broadcast("scroll.infiniteScrollComplete"),t.hasmore=!1)})},t.chooseTab=function(e){if(!(t.chooseIndex==e&&1==e||t.chooseIndex==e&&2==e)){if(m.scrollTop(),t.page=2,0==e){t.chooseIndex=e;var i=1==t.openStoreTime_index?0:1;t.openStoreTime_index=1==t.openStoreTime_index?2:1,t.filterParams=tabState[1][i],t.searchData=[]}else 1==e?(t.lianXC=!1,t.chooseIndex=e,t.openStoreTime_index=0,t.searchData=[]):2==e&&(t.openStoreTime_index=0,t.lianXC=!1,t.chooseIndex=e,t.filterParams="saleDesc",t.searchData=[]);o.myStoreSearch("1","5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,i,s){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})}},t.closeComprehensiveSub=function(){t.showComprehensiveSub=!t.showComprehensiveSub},t.selectComprehensiveSub=function(e,i){i.stopPropagation(),0==e&&(t.filterParams="isHotDesc"),t.lianXC=!1,t.selectComprehensiveSubIndex=e,t.showComprehensiveSub=!t.showComprehensiveSub,t.chooseIndex=0,t.productList=[],t.comprehensive_index=1,t.commission_index=0,t.price_index=0,t.filter_index=0,o.myStoreSearch("1","5",v,t.searchGoodsName.name,S,provinceId,cityId,districtId,streetId,1==t.front?1:2,t.filterParams,!1).success(function(e,o,i,s){e.productsList?(t.emptySearch=!1,t.searchData=e.productsList,t.showTab=!0,t.hasmore=!0,t.comprehensive_index=1,t.chooseIndex=0,t.showComprehensiveSub=!1):(t.emptySearch=!0,t.hShow=!0,t.hotWordShow=!0,t.hShowB=!1,t.showTab=!1)})},t.chooseStockState=function(e){t.filterParameterArr[0]=t.StockStateArr[e]},t.$on("$destroy",function(){t.filterModal.remove()})}]),APP.service("TeamService",["$http","UrlService",function(e,t){this.selectionSearch=function(o,i,s,n,a,r,c,l,d,u){var p={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,noLoading:u};return e.get(t.getUrl("SEARCHGOODS_INIT"),p)},this.myStoreSearch=function(o,i,s,n,a,r,c,l,d,u,p,g){var m={pageIndex:o,pageSize:i,memberId:s,keyword:n,searchType:a,provinceId:r,cityId:c,districtId:l,streetId:d,fromType:u,filterData:p,noLoading:g};return e.get(t.getUrl("SEARCH_GOODS"),m)}}]),APP.controller("ApplyForWhiteController",["$scope","InAppBrowserService","UrlService","$rootScope","InAppBrowserService","ManageMoneyService","WhiteShowsService","UserService",function(e,t,o,i,t,s,n,a){e.toHelp=function(e,i){-1!=navigator.userAgent.indexOf("iPhone")?t.open(o.getHead()+"mstore/sg/helpDetail.html?id="+e,i):$state.go("helpDetail",{helpId:e,content:i})},e.goBack=function(){e.$ionicGoBack()},e.applyToWihte=function(){n.applyForOpen({backUrl:window.location.href,userId:a.getUser().ucId,token:a.getUser().accessToken}).success(function(e){e.success&&n.openApplyWhiteShows(e.data.redirectUrl,"http://m.ehaier.com/#/applyForWhite")})}}]),APP.service("WhiteShowsService",["InAppBrowserService","UrlService","$http",function(e,t,o){this.applyForOpen=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_APPLY"),params:e})},this.queryAvaliAmt=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_QUERY_AVALIAMT"),params:e})},this.payApply=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_PAY"),params:e})},this.queryIousStatus=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_QUERY_STATUS"),params:e})},this.cost=function(e){return o({method:"POST",url:t.getWhiteShowsUrl("WHITE_SHOWS_COST"),params:e})},this.openApplyWhiteShows=function(e,t){window.cordova?window.emc.presentH5View(e,"顺逛白条"):window.location.href=e}}]),APP.controller("MyWalletController",["$scope","$state","MyWalletService","InAppBrowserService","UrlService","UserService","WhiteShowsService",function(e,t,o,i,s,n,a){function r(){o.getWallet().success(function(t){t.success&&(e.walletInfo=t.data)}).error(function(e){alert("网速较慢，请稍候再试")}),a.queryIousStatus({userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(t){t.success&&(e.whiteShowsState=t.data.applyStatus,1==e.whiteShowsState&&a.queryAvaliAmt({token:n.getUser().accessToken}).success(function(t){t.success&&(e.crdComAmt=t.data.crdComAmt,e.crdComAvailAmt=t.data.crdComAvailAmt)}).error(function(e){alert("网速较慢，请稍候再试")}))}).error(function(e){alert("网速较慢，请稍候再试")})}e.walletInfo=[],e.toRules=function(e,o){-1!=navigator.userAgent.indexOf("iPhone")?i.open(s.getHead()+"mstore/sg/helpDetail.html?id="+e,o):t.go("helpDetail",{helpId:e,content:o})},e.$on("$ionicView.beforeEnter",function(e,t){r()}),e.toApplyForWhite=function(e){2!=e?a.applyForOpen({backUrl:window.location.href,userId:n.getUser().ucId,token:n.getUser().accessToken}).success(function(e){e.success&&a.openApplyWhiteShows(e.data.redirectUrl,window.location.href)}):t.go("applyForWhite")}}]),APP.service("MyWalletService",["$http","UrlService",function(e,t){this.getWallet=function(){return e.get(t.getUrl("GET_WALLET"))}}]),APP.controller("walletDiamCtrl",["$scope","$state","$ionicHistory","$interval","walletDiamService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,i,s,n,a,r,c,l,d){e.index=null,e.diamgetlist=[],e.pagenum1=1,e.hasmore=!1,e.usableDiamond="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){n.scrollTop(),d.getWallet().success(function(t){e.usableDiamond=t.data.usableDiamond}).error(function(){}),e.pagenum1=1,e.hasmore=!0,s.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.diamgetlist=t.data.paymentList})},e.changelist=function(t){e.diamgetlist=[],n.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,s.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.diamgetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,s.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.diamgetlist=e.diamgetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.diamgetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletDiamService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,i,s){var n={memberId:o,benefitType:"diamond",transType:s,pageNo:i,pageSize:10},a={memberId:o,benefitType:"diamond",pageNo:i,pageSize:10};return null==s?e.get(t.getUrl("GET_WALLETDETAIL"),a):e.get(t.getUrl("GET_WALLETDETAIL"),n)}}]),APP.controller("walletIntCtrl",["$scope","$state","$ionicHistory","$interval","walletIntService","$ionicScrollDelegate","$rootScope","$localstorage","$stateParams","UserService","MyWalletService",function(e,t,o,i,s,n,a,r,c,l,d){e.index=null,e.integetlist=[],e.pagenum1=1,e.hasmore=!1,e.seashellPoint="",e.seashellPointAmt="",e.userId=l.getUser().mid,e.goBack=function(){o.goBack()},e.init=function(){n.scrollTop(),d.getWallet().success(function(t){e.seashellPoint=t.data.seashellPoint,e.seashellPointAmt=t.data.seashellPointAmt}).error(function(){}),e.pagenum1=1,e.hasmore=!0,s.getWalletDetail(e.userId,e.pagenum1,null).success(function(t){e.integetlist=t.data.paymentList})},e.changelist=function(t){e.integetlist=[],n.scrollTop(),e.hasmore=!0,e.index=t,e.pagenum1=1,s.getWalletDetail(e.userId,e.pagenum1,t).success(function(t){e.integetlist=t.data.paymentList})},e.loadMore=function(){e.pagenum1++,s.getWalletDetail(e.userId,e.pagenum1,e.index).success(function(t){e.integetlist=e.integetlist.concat(t.data.paymentList),e.$broadcast("scroll.infiniteScrollComplete"),e.hasmore=!(e.integetlist.length==t.data.totalCount)})},e.$on("$ionicView.beforeEnter",function(){e.index=null,e.init()})}]),APP.service("walletIntService",["$http","UrlService","$interval",function(e,t,o){this.getWalletDetail=function(o,i,s){var n={memberId:o,benefitType:"seashell",transType:s,pageNo:i,pageSize:10},a={memberId:o,benefitType:"seashell",pageNo:i,pageSize:10};return null==s?e.get(t.getUrl("GET_WALLETDETAIL"),a):e.get(t.getUrl("GET_WALLETDETAIL"),n)}}]),APP.controller("monthRewardController",["$scope","$stateParams","HelpDetailService","UrlService","PlatformService","monthRewardService",function(e,t,o,i,s,n){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.monthList=[];e.init=function(){n.getRevenueList(e.earningType,e.type,"Y",0,10).success(function(t){e.monthList=t.data.rewardY})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("monthRewardService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a){var r={earningType:o,type:i,rewardType:s,page:n,pageSize:a};return e.get(t.getUrl("REVENUE_LIST"),r)}}]),APP.controller("otherRewardController",["$scope","$stateParams","UrlService","PlatformService","monthRewardService",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.total=0,e.otherList=[];e.init=function(){
s.getRevenueList(e.earningType,e.type,"OTHER",0,10).success(function(t){e.total=t.data.rewardO.expectOtherAmount,e.otherList=t.data.rewardOther})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("someRewardController",["$scope","$stateParams","UrlService","$ionicPopup","monthRewardService",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardType=t.rewardType,e.someList=[],e.someDetail={};var n,a;e.init=function(){a="reward"+e.rewardType,s.getRevenueList(e.earningType,e.type,e.rewardType,0,10).success(function(t){t.data[a]instanceof Array?e.someList=t.data[a]:(e.someList=[],e.someList.push(t.data[a]))})},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.lookReward=function(t){e.someDetail=t,n=i.show({cssClass:"xvv-popupSome",template:'<div class="xvv-some"><div>抵扣金额</div><p class="radiubox"><i></i><span></span><span></span></p><div class="xvv-overflow"><div class="xvv-det" ng-repeat="item in someDetail.sgDeductionDetails"><div><p>此单抵扣<span>{{item.deductibleAmount|currency:"&yen"}}</span></p><p>抵扣单号<span>{{item.reverseNetSn}}</span></p><p>抵扣类型<span>{{item.deductibleType}}<span></p></div></div></div><div ng-click="closesome()">确定</div></div>',scope:e})},e.closesome=function(){n.close()},e.goBack=function(){e.$ionicGoBack()}}]),APP.controller("yongjinDetailController",["$scope","$stateParams","UrlService","yongjinDetailService","$ionicPopup",function(e,t,o,i,s){e.title=t.title,e.type=t.code,e.earningType=t.earningType,e.rewardStart=t.start,e.rewardEnd=t.end,e.hasMoreData=!1,e.tanKdetail={};var n,a,r=0;e.loadData=function(t,o,s,n,a,r,c){i.getRevenueList(t,o,s,n,a,r,c).success(function(t){t.data.list?(e.revenueList=0==n?t.data.list:e.revenueList.concat(t.data.list),e.hasMoreData=t.data.list.length==a,e.$broadcast("scroll.infiniteScrollComplete")):e.hasMoreData=!1})},e.loadMore=function(){r+=1,e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.lookDetail=function(t){e.tanKdetail=t,1==e.type?n=s.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><p>类型</p><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p></div><div><p>{{tanKdetail.rewardTypeStr}}</p><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div ng-click="closeDetail()">确定</div></div>',scope:e}):a=s.show({cssClass:"xvv-popup",template:'<div class="xvv-yongjin2"><div>佣金详情</div><div>{{tanKdetail.createTime}}创建</div><p class="radiubox"><i></i><span></span><span></span></p><div><div style="width:3.68rem;"><p>状态</p><p>商品数量</p><p>金额</p><p>提成</p><p>收益</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">抵扣金额</p></div><div><p>{{tanKdetail.nodeStateStr}}&nbsp</p><p>{{tanKdetail.productCount}}件</p><p>{{tanKdetail.netActualPrice|currency:"&yen"}}</p><p>{{(tanKdetail.brokeragePersent|currency:"&yen").replace("¥","")}}%</p><p>{{tanKdetail.brokerageDeductAmount|currency:"&yen"}}</p><p ng-if="tanKdetail.sgDeductionDetails&&(tanKdetail.sgDeductionDetails.length>0)">{{tanKdetail.deductionAmount|currency:"&yen"}}</p></div><div style="clear: both"></div><div class="xvv-yongjinother" ng-repeat="i in tanKdetail.sgDeductionDetails"><div style="color:#7A87A3"><p>抵扣单号<span>{{i.reverseNetSn}}</span></p><p>抵扣类型<span>{{i.deductibleType}}</span></p><p>此单抵扣<span>{{i.deductibleAmount|currency:"&yen"}}</span></p></div></div></div><div ng-click="closeDetail()">确定</div></div>',scope:e})},e.closeDetail=function(){1==e.type?n.close():a.close()},e.init=function(){e.loadData(e.earningType,e.type,"",r,10,e.rewardStart,e.rewardEnd)},e.$on("$ionicView.beforeEnter",function(){e.init()}),e.goBack=function(){e.$ionicGoBack()}}]),APP.service("yongjinDetailService",["$http","UrlService",function(e,t){this.getRevenueList=function(o,i,s,n,a,r,c){var l={earningType:o,type:i,rewardType:s,page:n,pageSize:a,beginDate:r,endDate:c};return e.get(t.getUrl("REVENUE_LIST"),l)}}]);>>>>>>> .r181827
